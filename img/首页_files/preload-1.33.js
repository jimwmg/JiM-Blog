if(!Array.prototype.indexOf){Array.prototype.indexOf=function(searchElement,fromIndex){var k;if(this==null){throw new TypeError('"this" is null or not defined')}var o=Object(this);var len=o.length>>>0;if(len===0){return-1}var n=fromIndex|0;if(n>=len){return-1}k=Math.max(n>=0?n:len-Math.abs(n),0);while(k<len){if(k in o&&o[k]===searchElement){return k}k++}return-1}}function checkBrowserVersion(){var userAgent=navigator.userAgent.toLowerCase();var regStr_ie=/msie [\d.]+;/gi;if(userAgent.indexOf("msie")>0){var browser=userAgent.match(regStr_ie);var verinfo=(browser+"").replace(/[^0-9.]/gi,"");if(parseInt(verinfo)<=parseInt("9.0")){return true}}return false}var _preloadDomainName={labs:{"default":"//labs.cloud.italent.cn"},production:{907:"//approval.italent.cn",906:"//demo-cloud.italent.cn",925:"//cloud.upaas.io",922:"//ckcfo.italent.cn",967:"//bcshome.crmpower.cn/","default":"//cloud.italent.cn"},develop:{907:"//approval.italent-inc.cn",906:"//cloud.italent-inc.cn","default":"//cloud.italent-inc.cn"},testing:{907:"//approval.italent.link",925:"//cloud.upaas.link",906:"//demo-cloud.italent.link","default":"//cloud.italent.link"},sandbox:{907:"//approval.upaas.in",925:"//cloud.upaas.in"}};var preloadDomainName=window.__preloadBCAppDomainName||_preloadDomainName;var domainName=preloadDomainName[BSGlobal.env.toLowerCase()];var startPreview=window.__previewBCApp||[];var delayTime=1e4;var preloadViewList={907:"/PreLoad/ApprovalCentre",908:"/PreLoad/tenantbase",909:"/PreLoad/attendance",960:"/PreLoad/compensation",925:"/PreLoad/youkecrm",922:"/PreLoad/CCYCloud",967:"/PreLoad/CropSciencePower",906:"/PreLoad/beisenclouddemo"};var needPreLoginAppId=925;var needPreLoginFlag={925:false};function isYoukeMenuId(appId){if(!needPreLoginFlag[needPreLoginAppId]){return true}else{var _currentMenuId=getCurrentMenuId();var _wantMenuId=parseInt(getMenuHref(appId).match(/\d+/)[0]);return _currentId==_wantMenuId}}function getMenuHref(appId){var menuHref;var navigateData=window.BSGlobal&&window.BSGlobal.newNavigation;for(var i in navigateData){var nav=navigateData[i];if(nav.appId==appId&&nav.children.length>0){menuHref=nav.children[0]["href"];return menuHref}}}var needPreloadView={};var newNavigation=BSGlobal.newNavigation||{};var siteMap=BSGlobal.siteMap||{};window._preloadView={};for(var i in newNavigation){var appId=newNavigation[i].appId;if(appId&&startPreview.indexOf(appId)!=-1){needPreloadView[appId]=preloadViewList[appId]}}for(var j in siteMap){var appId=siteMap[j].appId;if(appId&&startPreview.indexOf(appId)!=-1){needPreloadView[appId]=preloadViewList[appId]}var children=siteMap.children||[];if(children.length>0){for(var k in children){if(appId&&startPreview.indexOf(appId)!=-1){needPreloadView[appId]=preloadViewList[appId]}}}}function registerEventPreload(appId){window.iTalentSDK.register({listenEvent:"beisencloud_preload_"+appId+"_end",cb:function(data){var appId=data.appId;var appAll=window._preloadView[appId];var _currentId=isCurrentTalentPreload();appAll["loaded"]=true;if(window.beisenCloadLoadData&&parseInt(window.beisenCloadLoadData["appId"])==parseInt(appId)){if(_currentId&&_currentId!=needPreLoginAppId&&needPreLoginFlag[needPreLoginAppId]&&parseInt(appId)==needPreLoginAppId){return}if(!_currentId&&needPreLoginAppId&&parseInt(appId)==needPreLoginAppId&&needPreLoginFlag[needPreLoginAppId]){}else{$(".tu-main-container-inner").css("display","none")}appAll["view"].$el.css("display","block");window.iTalentSDK.sendMessage({publishEvent:"beisencloud_preload_"+appId+"_nav_start",data:window.beisenCloadLoadData});window.beisenCloadLoadData=null}}})}function registerEvent302(appId){window.iTalentSDK.register({listenEvent:"beisencloud_302_"+appId+"_end",cb:function(data){var appId=data.appId;var appAll=window._preloadView[appId];data.iframeId="iTalentFrame";if(appAll&&appAll.loaded){var view=appAll["view"];view.$el.css("display","none");window.iTalentSDK.sendMessage({publishEvent:"beisencloud_preload_"+appId+"_nav_start",data:data});window.beisenCloadLoadData=null}else{window.beisenCloadLoadData=data;if(!(appAll&&appAll["view"])&&!checkBrowserVersion()){loadIframe(appId)}}}})}function registerEventRoute(appId){window.iTalentSDK.register({listenEvent:"beisencloud_preload_route_"+appId,cb:function(data){var appId=data.appId;if(!window.destoryId)window.destoryId=[];window.destoryId.push(parseInt(appId))}})}function removePreloadDom(appId){if(window._preloadView[appId]){delete window._preloadView[appId]}$("div[data-name='main-container-innner-region-preload-"+appId+"']").remove()}function hashChangeSuccess(appId){window.iTalentSDK.register({listenEvent:"beisencloud_preload_hash_change_success"+appId,cb:function(data){var appId=data.appId,_currentId=isCurrentTalentPreload();if(!_currentId&&needPreLoginAppId&&parseInt(appId)==needPreLoginAppId&&needPreLoginFlag[needPreLoginAppId]){$(".tu-main-container-inner").css("display","none");$("div[data-name='main-container-innner-region']").css("display","block")}else{var appAll=window._preloadView[appId];var view=appAll["view"];$(".tu-main-container-inner").css("display","none");view.$el.css("display","block")}}})}function isCurrentTalentPreload(){var hash=decodeURIComponent(decodeURIComponent(location.hash||""));var menuId=hash.match(/menuId=(\d{4,5})/);menuId=menuId&&menuId[1]||null;if(!menuId){return}menuId=parseInt(menuId);var appId;var navigateData=window.BSGlobal&&window.BSGlobal.newNavigation;for(var i in navigateData){var nav=navigateData[i];if(needPreloadView[nav.appId]){if(!nav.children&&nav.id&&nav.id==menuId){appId=nav.appId}else if(nav.children.length>0){for(var j in nav.children){var navChild=nav.children[j];if(navChild.id==menuId){appId=navChild.appId}}}}}return appId}function loadIframe(appId){if(window._preloadView[appId]){return}var dName=domainName[appId]?domainName[appId]:domainName["default"];var src=dName+needPreloadView[appId];var preloadView=new PreloadView({appId:appId,src:src});preloadView.render();window._preloadView[appId]={};window._preloadView[appId]["view"]=preloadView;$('div[data-name="main-container-region"]').append(preloadView.$el)}var PreloadView=Talent.ItemView.extend({defaults:{iTalentFrame:"",iTalentFrameType:"",iTalentNavId:"",iTalentNavCode:"",iTalentWidgetUpdateSize:false},initialize:function(options){this.options=options},className:"tu-main-container-inner tu-clearfix _beisencloud-preload",template:Talent._.template('<div class="tu-height-full"></div>'),onRender:function(){this._setIfrmeUrl(needPreLoginAppId);this.$el.attr("data-name","main-container-innner-region-preload-"+this.options.appId);this.$el.attr("style","display:none;margin-right: 0px; width: 100%; min-height: 461px; height: 100%; overflow: hidden;")},_setIfrmeUrl:function(_needPreLoginAppId){var self=this;var src=this.options.src,appId=this.options.appId,iframe=document.createElement("iframe");var _youkeMenudId=isYoukeMenuId(_needPreLoginAppId);if(parseInt(this.options.appId)==_needPreLoginAppId&&_youkeMenudId){var _src=getMenuHref(_needPreLoginAppId);iframe.src=_src}else{iframe.src=src+"?appId="+this.options.appId}iframe.setAttribute("frameborder",0);iframe.setAttribute("marginwidth",0);iframe.setAttribute("marginheight",0);iframe.setAttribute("scrolling","auto");iframe.setAttribute("width","100%");iframe.setAttribute("height","100%");iframe.setAttribute("class","tu-scroll");iframe.setAttribute("id","iTalentFrame_preload_cloud_"+appId);if(startPreview.indexOf(_needPreLoginAppId)!=-1&&_needPreLoginAppId&&parseInt(appId)==_needPreLoginAppId&&!needPreLoginFlag[_needPreLoginAppId]&&_youkeMenudId){iframe.onload=function(){iframe.src=src+"?appId="+self.options.appId;needPreLoginFlag[_needPreLoginAppId]=true;iframe.onload=function(){}}}this.$el.find(".tu-height-full")[0].appendChild(iframe)}});for(var i in needPreloadView){var appId=i;registerEventPreload(appId);registerEvent302(appId);hashChangeSuccess(appId);registerEventRoute(appId)}Talent.app.vent.off("__Italent_MasterLayout_OnShow");Talent.app.vent.on("__Italent_MasterLayout_OnShow",function(){var _currentId=isCurrentTalentPreload();if(_currentId==needPreLoginAppId){needPreLoginFlag[needPreLoginAppId]=true}if(_currentId&&!checkBrowserVersion()){setTimeout(function(){loadIframe(_currentId)},1e3)}});var activeMenuId;Talent.app.vent.off("__iTalent_Sidebar_Click");Talent.app.vent.on("__iTalent_Sidebar_Click",function(options){var appId=options&&options.appId;$("._beisencloud-preload").css("display","none");if(!appId){if(!getCurrentMenuId){$("._beisencloud-preload").css("display","none")}return}var _destoryIndexOf=window.destoryId&&window.destoryId.indexOf(appId);if(window.destoryId&&_destoryIndexOf!=undefined&&_destoryIndexOf!=-1){removePreloadDom(appId);window.destoryId.splice(_destoryIndexOf,1)}if(needPreloadView&&needPreloadView[appId]&&!_preloadView[appId]&&!checkBrowserVersion()){loadIframe(appId)}if(window.beisenCloadLoadData&&activeMenuId!==options.id){window.beisenCloadLoadData=null}if(!needPreloadView[appId]){$("._beisencloud-preload").css("display","none")}activeMenuId=options.id});function getCurrentMenuId(){var hash=decodeURIComponent(decodeURIComponent(location.hash||""));var currentMenuId=hash.match(/menuId=(\d{4,5})/);currentMenuId=currentMenuId&&currentMenuId[1]||null;if(!currentMenuId){return}currentMenuId=parseInt(currentMenuId);return currentMenuId}if(!checkBrowserVersion()){var _currentId=isCurrentTalentPreload();var delayTime=_currentId?15e3:5e3;setTimeout(function(){for(var i in needPreloadView){loadIframe(i)}},delayTime)}