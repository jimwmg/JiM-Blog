!function($){"use strict";var Modal=function(element,options){this.options=options;$("body").on("click",".tu-modal",function(e){e&&e.stopPropagation()});$("body").on("click",".tu-modal-backdrop",function(e){e&&e.stopPropagation()});if(element===null){var TPL=""+'<div class="tu-modal hide-modal fade-modal" role="dialog" id={%id%} data-hidetype="remove">'+'<div class="modal-dialog">'+'<div class="modal-content">'+(options.hashead?'<div class="header-modal">'+(options.closeBtn?'<button type="button" class="close-modal" data-dismiss="modal" aria-hidden="true">&times;</button>':"")+'<h4 class="title-modal">{%title%}</h4>'+"</div>":"")+'<div class="body-modal '+(options.hasfoot?"":"no-foot")+'"><div class="body-modal-context"></div></div>'+(options.hasfoot?'<div class="footer-modal">'+(options.excessBtn?'<button type="button" class="left-float tu-btn tu-btn-sure tu-btn-small" data-excess="modal">{%excess_btn%}</button>':"")+(options.cancelBtn?'<button type="button" class="tu-btn btn-default tu-btn-small" data-dismiss="modal">{%cancel_btn%}</button>':"")+'<button type="button" class="tu-btn tu-btn-sure tu-btn-small" data-ok="modal">{%ok_btn%}</button>'+"</div>":"")+"</div>"+"</div>"+"</div>";element=$(TPL.replace("{%title%}",options.title).replace("{%id%}",options.id).replace("{%ok_btn%}",options.okBtn).replace("{%cancel_btn%}",options.cancelBtn).replace("{%excess_btn%}",options.excessBtn));element.find(".body-modal-context").html(options.body);$("body").append(element)}this.$element=$(element);this.$buttonSure=this.$element.find('[data-ok="modal"]');this.$buttonCancel=this.$element.find('[data-dismiss="modal"]');if(!options.transition){$(element).removeClass("fade-modal")}this.init()};Modal.prototype={constructor:Modal,init:function(){var ele=this.$element,opt=this.options,w=opt.width,h=opt.height,self=this,windowW=$(window).width(),windowH=$(window).height(),standardW={small:440,normal:590,large:790};ele.on("click.dismiss.modal",'[data-dismiss="modal"]',$.proxy(this.cancelHide,this)).on("click.ok.modal",':not(.disabled)[data-ok="modal"]',$.proxy(this.okHide,this)).on("click.excess.modal",':not(.disabled)[data-excess="modal"]',$.proxy(this.excessHide,this));if(w){if(w==="auto"){w=windowW*.55<800?800:windowW*.55}else{standardW[w]&&(w=standardW[w])}ele.width(w).css("margin-left",-parseInt(w)/2)}h==="auto"&&(h=windowH*.8<170?170:windowH*.8);if(opt.hasHead){h-=50}if(opt.hasfoot){h-=40}h&&ele.find(".body-modal").height(h);if(typeof this.options.remote=="string"){this.$element.find(".body-modal").load(this.options.remozte)}if(!opt.hashead&&!opt.hasfoot&&opt.radius){ele.css("border-radius",opt.radius)}ele.data("okToggle",this.okToggle)},setTitle:function(title){this.$element.find(".title-modal").html(title)},setBtnTitle:function(title,type){type=type||"ok";this.$element.find("[data-"+type+"=modal]").html(title)},okToggle:function(option){var ele=this.$element;if(typeof option=="string"&&option=="disabled"){ele.find('[data-ok="modal"]').addClass("disabled")}else{ele.find('[data-ok="modal"]').removeClass("disabled")}},toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var self=this,e=$.Event("show"),ele=this.$element;ele.trigger(e);if(this.isShown||e.isDefaultPrevented())return;this.isShown=true;this.escape();this.backdrop(function(){var transition=$.support.transition&&ele.hasClass("fade-modal");if(!ele.parent().length){ele.appendTo(document.body)}if(window.top!==window.self){window.iTalentSDK&&window.iTalentSDK.sendMessage({publishEvent:"uxNavMenu_fullScreenShadow",data:{show:true}})}self.resize();ele.show();if(transition){ele[0].offsetWidth}ele.addClass("in-modal").attr("aria-hidden",false);self.enforceFocus();transition?ele.one($.support.transition.end,function(){callbackAfterTransition(self)}):callbackAfterTransition(self);function callbackAfterTransition(self){self.$element.focus().trigger("shown");if(self.options.timeout>0){self.timeid=setTimeout(function(){self.hide()},self.options.timeout)}}});return ele},hide:function(e){e&&e.stopPropagation();e&&e.preventDefault();var $ele=this.$element,e=$.Event("hide");this.hideReason!="ok"&&$ele.trigger("cancelHide");$ele.trigger(e);if(!this.isShown||e.isDefaultPrevented())return;this.isShown=false;this.escape();$(document).off("focusin.modal");this.timeid&&clearTimeout(this.timeid);$ele.removeClass("in-modal").attr("aria-hidden",true);$.support.transition&&$ele.hasClass("fade-modal")?this.hideWithTransition():this.hideModal();if(window.top!==window.self){window.iTalentSDK&&window.iTalentSDK.sendMessage({publishEvent:"uxNavMenu_fullScreenShadow",data:{show:false}})}return $ele},cancelHide:function(e){var fn=this.options.cancelHide,ifNeedHide=true;if(!fn){var eventArr=$._data(this.$element[0],"events").hide;if(eventArr&&eventArr.length){fn=eventArr[eventArr.length-1].handler}}typeof fn=="function"&&(ifNeedHide=fn.call(this,e));if(ifNeedHide!==false){this.hide(e)}},okHide:function(e){e&&e.stopPropagation();var self=this;if(!e){hideWithOk();return}var fn=this.options.okHide,ifNeedHide=true;if(!fn){var eventArr=$._data(this.$element[0],"events").okHide;if(eventArr&&eventArr.length){fn=eventArr[eventArr.length-1].handler}}typeof fn=="function"&&(ifNeedHide=fn.call(this,e));if(ifNeedHide!==false){hideWithOk()}function hideWithOk(){self.hideReason="ok";self.hide(e)}return self.$element},excessHide:function(e){e&&e.stopPropagation();var fn=this.options.excessHide,ifNeedHide=true;if(!fn){var eventArr=$._data(this.$element[0],"events").hide;if(eventArr&&eventArr.length){fn=eventArr[eventArr.length-1].handler}}typeof fn=="function"&&(ifNeedHide=fn.call(this,e));if(ifNeedHide!==false){this.hide(e)}},shadeIn:function(){var $ele=this.$element;if($ele.find(".shade").length)return;var $shadeEle=$('<div class="shade in" style="background:'+this.options.bgcolor+'"></div>');$shadeEle.appendTo($ele);this.hasShaded=true;return this.$element},shadeOut:function(){this.$element.find(".shade").remove();this.hasShaded=false;return this.$element},shadeToggle:function(){return this[!this.hasShaded?"shadeIn":"shadeOut"]()},resize:function(){var ele=this.$element,eleH=ele.height(),winH=$(window).height(),mt=0;if(eleH>=winH){mt=-winH/2;ele.css("margin-top",parseInt(mt))}else{mt=(winH-eleH)/(1+1.618)-winH/2;ele.css("margin-top",parseInt(mt))}return ele},enforceFocus:function(){var self=this;$(document).off("focusin.modal").on("focusin.modal",function(e){if(self.$element[0]!==e.target&&!self.$element.has(e.target).length){self.$element.focus()}})},escape:function(){var self=this;if(this.isShown&&this.options.keyboard){this.$element.on("keyup.dismiss.modal",function(e){e.which==27&&self.hide()})}else if(!this.isShown){this.$element.off("keyup.dismiss.modal")}},hideWithTransition:function(){var self=this,timeout=setTimeout(function(){self.$element.off($.support.transition.end);self.hideModal()},300);this.$element.one($.support.transition.end,function(){clearTimeout(timeout);self.hideModal()})},hideModal:function(){var self=this,ele=this.$element;ele.hide();this.backdrop(function(){self.removeBackdrop();ele.trigger(self.hideReason=="ok"?"okHidden":"cancelHidden");self.hideReason=null;ele.trigger("hidden");ele.data("hidetype")=="remove"&&ele.remove()})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(callback){var self=this,animate=this.$element.hasClass("fade-modal")?"fade-modal":"",opt=this.options;if(this.isShown){var doAnimate=$.support.transition&&animate;if(opt.backdrop!==false){this.$backdrop=$('<div class="tu-modal-backdrop '+animate+'" style="background:'+opt.bgcolor+'"/>').appendTo(document.body);this.$backdrop.click(opt.backdrop=="static"?$.proxy(this.$element[0].focus,this.$element[0]):$.proxy(this.hide,this));if(doAnimate)this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in-modal ");if(!callback)return;doAnimate?this.$backdrop.one($.support.transition.end,callback):callback()}else{callback&&callback()}}else{if(this.$backdrop){this.$backdrop.removeClass("in-modal");$.support.transition&&this.$element.hasClass("fade-modal")?this.$backdrop.one($.support.transition.end,callback):callback()}else{callback&&callback()}}}};var old=$.fn.modal;$.fn.modal=function(option,callback){var self=this;return this.each(function(){var $this=$(this),data=$this.data("modal"),options=$.extend({},$.fn.modal.defaults,$this.data(),typeof option=="object"&&option);if(!data)$this.data("modal",data=new Modal(this,options));if(typeof option=="string"){data[option](callback)}else{data.show()}})};$.fn.modal.defaults={backdrop:true,bgcolor:"#34434E",keyboard:true,hasfoot:true,hashead:true,closeBtn:true,transition:true,excessBtn:false};$.fn.modal.Constructor=Modal;$.fn.modal.noConflict=function(){$.fn.modal=old;return this};$(document).on("click.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("modal")?"toggle":$this.data();e.preventDefault();$target.modal(option).one("hide",function(){$this.focus()})});$.extend({_modal:function(dialogCfg,customCfg){var modalId=+new Date,finalCfg=$.extend({},$.fn.modal.defaults,dialogCfg,{id:modalId,okBtn:"确定"},typeof customCfg=="string"?{body:customCfg}:customCfg);var dialog=new Modal(null,finalCfg),$ele=dialog.$element;_bind(modalId,finalCfg);$ele.data("modal",dialog).modal("show");function _bind(id,eList){var eType=["show","shown","hide","hidden","okHidden","cancelHidden","excessHidden"];$.each(eType,function(k,v){if(typeof eList[v]=="function"){$(document).on(v,"#"+id,$.proxy(eList[v],$("#"+id)[0]))}})}return $ele},alert:function(customCfg){var dialogCfg={type:"alert",title:"注意"};return $._modal(dialogCfg,customCfg)},confirm:function(customCfg){var dialogCfg={type:"confirm",title:"提示",cancelBtn:"取消"};return $._modal(dialogCfg,customCfg)}})}(window.jQuery);define("$.modal",function(){});!function($){function TPagination(opts){this.itemsCount=opts.itemsCount;this.pageSize=opts.pageSize;this.displayPage=opts.displayPage<5?5:opts.displayPage;this.pages=Math.ceil(opts.itemsCount/opts.pageSize)||1;this.total=$.isNumeric(opts.pages)&&(this.pages=opts.pages);this.currentPage=opts.currentPage;this.styleClass=opts.styleClass;this.onSelect=opts.onSelect;this.showCtrl=opts.showCtrl||false;this.remote=opts.remote;this.displayInfoType=opts.displayInfoType}TPagination.prototype={_draw:function(){var tpl='<div class="tu-pagination-container tu-clearfix"><div class="tu-pagination-total"></div><div class="tu-pagination';for(var i=0;i<this.styleClass.length;i++){tpl+=" "+this.styleClass[i]}tpl+='"></div></div>';this.hookNode.html(tpl);this._drawInner();this._drawTotal()},_drawTotal:function(){if(!this.itemsCount)return;if(!this.displayInfoType)return;var totalArea=this.hookNode.find(".tu-pagination-total"),startNum=this.pageSize*this.currentPage-this.pageSize+1,endNumb=this.currentPage==this.pages?this.itemsCount:this.pageSize*this.currentPage;var tpl="显示 <span>"+startNum+"</span>－<span>"+endNumb+"</span> 项，共<span>"+this.itemsCount+"</span>项";totalArea.html(tpl)},_drawInner:function(){var outer=this.hookNode.find(".tu-pagination");var tpl="<ul>"+'<li class="prev'+(this.currentPage-1<=0?" disabled":" ")+'"><a href="javascript:void(0)"  data="'+(this.currentPage-1)+'">&lt;</a></li>';if(this.pages<=this.displayPage||this.pages==this.displayPage+1){for(var i=1;i<this.pages+1;i++){i==this.currentPage?tpl+='<li class="active"><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>":tpl+='<li><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>"}}else{if(this.currentPage<this.displayPage-1){for(var i=1;i<this.displayPage;i++){i==this.currentPage?tpl+='<li class="active"><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>":tpl+='<li><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>"}tpl+='<li class="dotted"><span>...</span></li>';tpl+='<li><a href="javascript:void(0)"  data="'+this.pages+'">'+this.pages+"</a></li>"}else if(this.currentPage>this.pages-this.displayPage+2&&this.currentPage<=this.pages){tpl+='<li><a href="javascript:void(0)"  data="1">1</a></li>';tpl+='<li class="dotted"><span>...</span></li>';for(var i=this.pages-this.displayPage+2;i<=this.pages;i++){i==this.currentPage?tpl+='<li class="active"><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>":tpl+='<li><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>"}}else{tpl+='<li><a href="javascript:void(0)"  data="1">1</a></li>';tpl+='<li class="dotted"><span>...</span></li>';var frontPage,backPage,middle=(this.displayPage-3)/2;if((this.displayPage-3)%2==0){frontPage=backPage=middle}else{frontPage=Math.floor(middle);backPage=Math.ceil(middle)}for(var i=this.currentPage-frontPage;i<=this.currentPage+backPage;i++){i==this.currentPage?tpl+='<li class="active"><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>":tpl+='<li><a href="javascript:void(0)"  data="'+i+'">'+i+"</a></li>"}tpl+='<li class="dotted"><span>...</span></li>';tpl+='<li><a href="javascript:void(0)"  data="'+this.pages+'">'+this.pages+"</a></li>"}}tpl+='<li class="next'+(this.currentPage+1>this.pages?" disabled":" ")+'"><a href="javascript:void(0)"  data="'+(this.currentPage+1)+'">&gt;</a></li>'+"</ul>";if(this.pages==1){tpl=""}this.showCtrl&&(tpl+=this._drawCtrl());outer.html(tpl)},_drawCtrl:function(){var tpl="<div>&nbsp;"+"<span>"+"&nbsp;到&nbsp;"+'<input type="text" class="page-num"/><button class="page-confirm">确定</button>'+"&nbsp;页"+"</span>"+"</div>";return tpl},_ctrl:function(){var self=this,pag=self.hookNode.children(".tu-pagination");function doPagination(){var tmpNum=parseInt(pag.find(".page-num").val());if($.isNumeric(tmpNum)&&tmpNum<=self.pages&&tmpNum>0){if(!self.remote){self.currentPage=tmpNum;self._drawInner()}if($.isFunction(self.onSelect)){self.onSelect.call($(this),tmpNum)}}}pag.on("click",".page-confirm",function(e){doPagination.call(this)});pag.on("keypress",".page-num",function(e){e.which==13&&doPagination.call(this)})},_select:function(){var self=this;self.hookNode.find(".tu-pagination").on("click","a",function(e){e.preventDefault();var tmpNum=parseInt($(this).attr("data"));if(!$(this).parent().hasClass("disabled")&&!$(this).parent().hasClass("active")){if(!self.remote){self.currentPage=tmpNum;self._drawInner();self._drawTotal()}if($.isFunction(self.onSelect)){self.onSelect.call($(this),tmpNum)}}})},init:function(opts,hookNode){this.hookNode=hookNode;this._draw();this._select();this.showCtrl&&this._ctrl();return this},updateItemsCount:function(itemsCount,pageToGo){this.itemsCount=itemsCount;$.isNumeric(itemsCount)&&(this.pages=Math.ceil(itemsCount/this.pageSize));this.currentPage=this.currentPage>this.pages?this.pages:this.currentPage;$.isNumeric(pageToGo)&&(this.currentPage=pageToGo);this._drawInner();this._drawTotal()},updatePages:function(pages,pageToGo){$.isNumeric(pages)&&(this.pages=pages);this.currentPage=this.currentPage>this.pages?this.pages:this.currentPage;$.isNumeric(pageToGo)&&(this.currentPage=pageToGo);this._drawInner();this._drawTotal()},goToPage:function(page){if($.isNumeric(page)&&page<=this.pages&&page>0){this.currentPage=page;this._drawInner();this._drawTotal()}}};var old=$.fn.TPagination;$.fn.TPagination=function(options){var opts=$.extend({},$.fn.TPagination.defaults,typeof options=="object"&&options);if(typeof options=="string"){args=$.makeArray(arguments);args.shift()}var $this=$(this),pag=$this.data("tu-pagination");if(!pag)$this.data("tu-pagination",pag=new TPagination(opts).init(opts,$(this)));else if(typeof options=="string"){pag[options].apply(pag,args)}return pag};$.fn.TPagination.Constructor=TPagination;$.fn.TPagination.noConflict=function(){$.fn.pagination=old;return this};$.fn.TPagination.defaults={pageSize:20,pages:null,displayPage:8,currentPage:1,itemsCount:0,displayInfoType:true,styleClass:[],onSelect:null,remote:false}}(window.jQuery);define("$.pagination",function(){});define("css",[],function(){if(typeof window=="undefined")return{load:function(n,r,load){load()}};var head=document.getElementsByTagName("head")[0];var engine=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0;var useImportLoad=false;var useOnload=true;if(engine[1]||engine[7])useImportLoad=parseInt(engine[1])<6||parseInt(engine[7])<=9;else if(engine[2]||engine[8]||"WebkitAppearance"in document.documentElement.style)useOnload=false;else if(engine[4])useImportLoad=parseInt(engine[4])<18;var cssAPI={};cssAPI.pluginBuilder="./css-builder";var curStyle,curSheet;var createStyle=function(){curStyle=document.createElement("style");head.appendChild(curStyle);curSheet=curStyle.styleSheet||curStyle.sheet};var ieCnt=0;var ieLoads=[];var ieCurCallback;var createIeLoad=function(url){curSheet.addImport(url);curStyle.onload=function(){processIeLoad()};ieCnt++;if(ieCnt==31){createStyle();ieCnt=0}};var processIeLoad=function(){ieCurCallback();var nextLoad=ieLoads.shift();if(!nextLoad){ieCurCallback=null;return}ieCurCallback=nextLoad[1];createIeLoad(nextLoad[0])};var importLoad=function(url,callback){if(!curSheet||!curSheet.addImport)createStyle();if(curSheet&&curSheet.addImport){if(ieCurCallback){ieLoads.push([url,callback])}else{createIeLoad(url);ieCurCallback=callback}}else{curStyle.textContent='@import "'+url+'";';var loadInterval=setInterval(function(){try{curStyle.sheet.cssRules;clearInterval(loadInterval);callback()}catch(e){}},10)}};var linkLoad=function(url,callback){var link=document.createElement("link");link.type="text/css";link.rel="stylesheet";if(useOnload)link.onload=function(){link.onload=function(){};setTimeout(callback,7)};else var loadInterval=setInterval(function(){for(var i=0;i<document.styleSheets.length;i++){var sheet=document.styleSheets[i];if(sheet.href==link.href){clearInterval(loadInterval);return callback()}}},10);link.href=url;head.appendChild(link)};cssAPI.normalize=function(name,normalize){if(name.substr(name.length-4,4)==".css")name=name.substr(0,name.length-4);return normalize(name)};cssAPI.load=function(cssId,req,load,config){(useImportLoad?importLoad:linkLoad)(req.toUrl(cssId+".css"),load)};return cssAPI});define("TitaWidget",["talent","UserSelector","$.tipsy","moment","Uploader","simplemodal","$.infotip","$.modal","jquery.ui","$.pagination","css"],function(Talent,UserSelector,Ttipsy,moment,Uploader,Simplemodal,Infotip,modal,JqueryUI,Pagination,css){var jst=function(){this["JST"]=this["JST"]||{};this["JST"]["add-user/add-user-composite"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="title-pl">'+((__t=title)==null?"":__t)+'</div>\n<div class="list-pl">\n\n';if(!showType){__p+='\n	<em class="ux_add_btn tu-icon-add" data-name="add-item"></em>\n'}__p+='\n\n<ul class="tu-clearfix ';if(!showType){__p+="ul-style_detial"}else{__p+="ul-style_name"}__p+='"></ul>\n\n';if(showType){__p+='\n	<a href="javascript:void(0)" class="ux_add-item" data-name="add-item">添加</a>\n'}__p+="\n</div>"}return __p};this["JST"]["add-user/add-user-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showType=="nameOnly"){__p+="\n	<!-- 只要名字 -->\n	<span>"+((__t=Name?Name:name)==null?"":__t)+'</span><span class="tu-icon-cross del-item" data-name="del-item"></span>\n'}else{__p+="\n	";if(typeof type!=="undefined"&&type=="department"){__p+='\n		<a href="javascript:void(0)" title="删除:'+((__t=name)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" class="square">'+((__t=_.TitaWidget_substring(name,2,false))==null?"":__t)+"</a>\n	"}else if(typeof"UserAvatar"!="undefined"){__p+='\n		<a href="javascript:void(0)" title="删除:'+((__t=Name)==null?"":__t)+'" id="'+((__t=Id)==null?"":__t)+'" class="ux_user_area">'+((__t=_.convertImage({src:UserAvatar.Small,size:30,name:Name,bgColor:UserAvatar.Color}))==null?"":__t)+"</a>\n	"}else{__p+='\n		<a href="javascript:void(0)" title="删除:'+((__t=Name?Name:name)==null?"":__t)+'" id="'+((__t=UserId?UserId:Id)==null?"":__t)+'" class="ux_user_area">'+((__t=_.convertImage({src:Avatar.Small,size:30,name:Name?Name:name,bgColor:Avatar.Color}))==null?"":__t)+"</a>\n	"}__p+="\n"}__p+="\n"}return __p};this["JST"]["attachment-list/attachment-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="left_afb" data-name="tita-upload-preview-icon">\n	<span class=" tu-icon-'+((__t=fileType)==null?"":__t)+' ico_afb" style="color:'+((__t=iconColor)==null?"":__t)+'"></span>\n</div>\n<div class="center_afb">\n	<div class="name" >\n		<span '+((__t=isImage?'data-name="name_up" class="tu-cp"':"")==null?"":__t)+' data-toggle="infotip" data-infotip-txt="'+((__t=fileFullName)==null?"":__t)+'">'+((__t=fileName)==null?"":__t)+'</span>\n		<span class="status" data-name="status-tip">\n		';if(!verifyStatus){__p+='\n			<span class="status-error">'+((__t=verifyErrorMsg)==null?"":__t)+"</span>\n		"}__p+="\n		</span>\n	</div>\n	";if(uploadStatus==2){__p+='\n	<div class="progress">\n		<div class="progress-bar" style="width: '+((__t=percentComplete)==null?"":__t)+'%"></div>\n	</div>\n	'}__p+='\n</div>\n<div class="right_afb">\n	';if(uploadStatus==4&&verifyStatus){__p+='\n	<a href="javascript:void(0);" class="tu-icon-restart－circle action-iocn " data-name="tita-upload-reUpload" data-toggle="infotip" data-infotip-txt="重新上传"></a>\n	'}__p+="\n	";if(uploadStatus==3){__p+='\n	<a href="'+((__t=downloadUrl)==null?"":__t)+'" class="tu-icon-download-circle action-iocn " data-toggle="infotip" data-infotip-txt="下载" ';if(isFromYFY){__p+=' target="_blank" '}__p+="></a>\n	";if(previewUrl!=null&&previewUrl!=""){__p+="\n		";if(isImage){__p+='\n			<a href="javascript:void(0);" class="tu-icon-magnifier-circle action-iocn " data-name="tita-upload-img-preview" data-toggle="infotip" data-infotip-txt="预览"></a>\n		'}else{__p+='\n			<a href="'+((__t=previewUrl)==null?"":__t)+'" class="tu-icon-magnifier-circle action-iocn " data-toggle="infotip" data-infotip-txt="预览" target="_blank"></a>\n		'}__p+="\n	"}__p+="\n	"}__p+="\n\n	\n\n	";if(uploadStatus==2){__p+='\n	<a href="javascript:void(0);" class="tu-icon-cross action-iocn " data-name="tita-upload-deleted" data-toggle="infotip" data-infotip-txt="取消上传"></a>\n	'}__p+="\n	";if(uploadStatus>2&&deleteable){__p+='\n	<a href="javascript:void(0);" class="tu-icon-cross action-iocn action-iocn-delete tu-vam" data-name="attachment-deleted" data-toggle="infotip" data-infotip-txt="删除" data-document-id="'+((__t=documentId)==null?"":__t)+'"></a>\n	'}__p+="\n</div>\n\n\n\n"}return __p};this["JST"]["class/class-component"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(viewType!=="special"){__p+='\n<div class="tu-clearfix">\n	<div class="shelf-area">\n\n		<div class="tu-tabbable-custom tu-tabbable-custom-min">\n			<ul class="tu-nav-tabs " data-name="klass-tab">\n				';_.each(tabData,function(item){__p+='\n					<li class="item-tab"  data-type="'+((__t=item.tabType)==null?"":__t)+'">\n						<a href="javascript:void(0);">'+((__t=item.name)==null?"":__t)+"</a>\n					</li>\n				"});__p+='\n			</ul>\n			\n			<div class="tu-nav-content">\n				';if(isShowSearch){__p+='\n				<div data-name="klass-search" class="class-search"></div>\n				'}__p+='\n				<div class="klass-content">\n					<div class="class-tree-content tu-scroll"  data-name="klass-content"></div>\n				</div>\n			</div>\n			';if(viewType=="single"){__p+='\n			<a href="javascript:void(0);" class="tab-reset" data-name="button-reset">清空已选</a>\n			'}__p+="\n		</div>\n\n	</div>\n	";if(viewType=="multi"){__p+='\n	<div data-name="result-area"></div>\n	'}__p+='\n</div>\n<div class="bottom-area tu-clearfix">\n		';if(TaskLabel){__p+="\n			";if(isShowSetting){__p+='\n				<a href="'+((__t=setUrl)==null?"":__t)+'" target="_blank" class="goto-edit" data-name="goto-edit">分类设置</a>\n				'}__p+="\n			"}__p+='\n	<button class="tu-btn tu-btn-small"  data-name="button-cancel">取消</button>\n	<button class="tu-btn tu-btn-small tu-btn-sure"  data-name="button-sure">确定</button>\n</div>\n'}else{__p+='\n<div data-name="klass-content"></div>\n<div class="bottom-area tu-clearfix">\n	<button class="tu-btn tu-btn-small tu-btn-sure button-new" data-name="button-add">添加分类</button>\n</div>\n'}__p+="\n"}return __p};this["JST"]["class/class-new"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="	";if(type!="rename"){__p+='\n	<div class="title_tv">\n	'}__p+='\n\n		<form class="tu-form" data-name="file-move-new-form">\n		<div class="tu-input-edit tu-mb-15">\n		    <div class="tu-input-default" data-name="file-move-new-input-warp">\n		    	<label class="placeholder" for="edit" data-name="file-move-new-placeholder">输入分类名称</label>\n		        <input type=\'text\' id=\'edit\'  value="'+((__t=name)==null?"":__t)+'" autocomplete="off">\n		        <div class="error-tip" data-name="file-move-new-input-tip"></div>\n		    </div>\n		    <div class="action-input">\n		    	<button class="tu-btn tu-btn-sure tu-btn-mini"   data-name="file-move-new-submit">确定</button>\n		        <button class="tu-btn tu-btn-mini" data-name="file-move-new-cancel">取消</button>\n		    </div>\n		</div>\n		</form>\n	';if(type!="rename"){__p+="\n	</div>\n	"}__p+="\n\n\n"}return __p};this["JST"]["class/class-search"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="tu-input-default" data-name="search-body">\n    <label class="placeholder" for="'+((__t=searchName)==null?"":__t)+'" data-name="placeholder">'+((__t=placeholder)==null?"":__t)+'</label>\n    <input type="text" id="'+((__t=searchName)==null?"":__t)+'" data-name="input">\n    <div class="right-action tu-clearfix">\n        <span class="tu-icon-close cancel-btn" data-name="cancel-btn"></span>\n        <span class="tu-icon-search" data-name="search-btn"></span>\n    </div>\n</div>'}return __p};this["JST"]["class/class-tree-delete"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="cont-cd">该类别可能已是某些项目或任务的分类，<br>删除后将会影响项目、任务的筛选</div>\n';if(deleteChild){__p+='\n<label class="tu-checkbox-pretty tu-inline" for="is-del-children">\n	<input type="checkbox" id="is-del-children">\n	<span class="tu-icon- input-faux">同时删除该分类所有子分类</span>\n</label>\n'}}return __p};this["JST"]["class/class-tree-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="title_tv tu-clearfix " data-name="title" id="'+((__t=id)==null?"":__t)+'">\n	<div class="left_tv">\n		';if(id!=="0"&&isMove){__p+='\n			<div class="ico-move">\n				<span class="tu-icon-three-point-shu2"  data-name="move" id="'+((__t=id)==null?"":__t)+'"></span>\n			</div>\n		'}__p+="\n		\n\n		";if(!isEnd){__p+="\n			";if(!isOpen){__p+='\n				<span class="tu-icon-open  icon_tv"  data-name="toggle" id="'+((__t=id)==null?"":__t)+'"></span>\n			'}else{__p+='\n				<span class="tu-icon-pack-up icon_tv"  data-name="toggle" id="'+((__t=id)==null?"":__t)+'"></span>\n			'}__p+="\n		"}else{__p+='\n			<span class="icon-empty_tv"  data-name="toggle" id="'+((__t=id)==null?"":__t)+'"></span>\n		'}__p+="\n\n		";if(typeof IsTenant!="undefined"&&IsTenant){__p+='\n			<span class="tu-icon-company icon_tv" data-name="infotip" data-tip="企业分类"></span>\n		'}else if(typeof IsTenant!="undefined"&&!IsTenant){__p+='\n			<span class="tu-icon-assigner icon_tv" data-name="infotip" data-tip="个人分类"></span>\n		'}__p+='\n		\n	</div>\n\n	<div class="text_tv_parent" data-name="title-name-box">\n		<div class="text_tv" data-name="title-name">'+__e(name)+"</div>\n	</div>\n\n	";if(id!=0&&viewType=="special"){__p+="\n\n		";if(!IsAllowSetPersonalLable&&dataSourceObjType==1){__p+='\n		<a href="javascript:void(0);" class="tu-icon-locked lock-ttv" data-name="lock" data-end="'+((__t=isEnd)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" data-toggle="infotip"  data-tip="该分类下不允许添加个人分类"></a>\n		'}__p+='\n		<div class="action_ttv" data-name="klass-item-action">\n			<a href="javascript:void(0);" class="add-category" data-name="add-category" id="'+((__t=id)==null?"":__t)+'" data-toggle="infotip" data-tip="添加子分类">添加子分类</a>\n			';if(isMove){__p+='\n			<a href="javascript:void(0);" class="tu-icon-angleup-circle move-top" data-name="move-top" id="'+((__t=id)==null?"":__t)+'" data-toggle="infotip" data-tip="移至最前"></a>\n			'}__p+="\n			";if(IsTenant&&dataSourceObjType==2){__p+='\n			<a href="javascript:void(0);" class="tu-icon-setting" data-name="limit" data-end="'+((__t=isEnd)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" data-toggle="infotip"  data-tip="设置权限"></a>\n			'}__p+="\n			";if(dataSourceObjType==2||dataSourceObjType==1&&ObjType==1&&isEdit){__p+='\n			<a href="javascript:void(0);" class="tu-icon-edit" data-name="edit" data-end="'+((__t=isEnd)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" data-toggle="infotip" data-align=\'right\' data-tip="编辑分类"></a>\n			<a href="javascript:void(0);" class="tu-icon-delete" data-name="deleted" data-end="'+((__t=isEnd)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" data-toggle="infotip"  data-align=\'right\'  data-tip="删除分类"></a>\n			'}__p+="\n		</div> \n	\n	"}__p+="\n</div>\n<ul></ul>"}return __p};this["JST"]["class/class-tree-limit"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n	<ul class="tu-dropdown-menu">\n		';if(isShowRange){__p+="\n		<li class=\"tu-menuitem\" data-name='limit-scope'>设置可见范围</li>\n		"}__p+='\n		<li class="tu-menuitem" data-name=\'limit-add\'>是否允许添加个人分类</li>\n	</ul>\n<div class="tu-dropdown limit-add-dropdown" data-name="limit-add-dropdown">\n	<ul class="tu-dropdown-menu">\n		<li class="tu-menuitem ';if(IsAllowSetPersonalLable){__p+="active"}__p+='" data-name="allow">允许添加</li>\n		<li class="tu-menuitem ';if(!IsAllowSetPersonalLable){__p+="active"}__p+='" data-name="unAllow">不允许添加</li>\n	</ul>\n</div>'}return __p};this["JST"]["class/class"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div data-name="tree"></div>\n'}return __p};this["JST"]["class/result-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="result-action"><span class="tu-icon-cross"  data-name="deleted"  id="'+((__t=id)==null?"":__t)+'"></span></div>\n'+__e(name)}return __p};this["JST"]["class/result"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="result-tilte tu-clearfix">\n	<div class="result-name">已选类别<span class="result-number" data-name="result-number">'+((__t=total)==null?"":__t)+'</span></div>\n	<a href="javascript:void(0);" class="result-reset" data-name="button-reset">清空已选</a>\n</div>\n<ul class="result-list tu-scroll" data-name="result-list">\n\n</ul>\n'}return __p};this["JST"]["class/work-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(!isSearch){__p+='\n<div class="title_kw" data-name="work-title">\n	<span class="tu-icon-pack-up icon_tv" data-name="toggle"></span><span>'+__e(title)+"</span>\n</div>\n"}__p+='\n<ul data-name="work-list"></ul>'}return __p};this["JST"]["date-time-picker/date-time-cycle"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<h2>设置循环时间</h2>\n<div class="cycle_task_container">\n	<div class="cycle_type_list" data-name="date-time-picker-tab">\n		<ul>\n			<li cyctype="2">\n				<a href="javascript:void(0)" class="radio ';if(cycType==2){__p+="radio-checked"}__p+='"></a>\n				<span>每个工作日</span>\n			</li>\n			<li cyctype="1">\n				<a href="javascript:void(0)" class="radio ';

if(cycType==1){__p+="radio-checked"}__p+='"></a>\n				<span>每天</span>\n			</li>\n			<li cyctype="3">\n				<a href="javascript:void(0)" class="radio ';if(cycType==3){__p+="radio-checked"}__p+='"></a>\n				<span>每周</span>\n			</li>\n			<li cyctype="4">\n				<a href="javascript:void(0)" class="radio ';if(cycType==4){__p+="radio-checked"}__p+='"></a>\n				<span>每月</span>\n			</li>\n		</ul>\n	</div>\n	<div class="cycle_type_date">\n		<div class="cycle_time clearfix">\n			<span>开始时间</span>\n			';if(cycType==3||cycType==4){__p+='\n				<div class="day_time_nst first-col">\n					<a class="triday_nst" href="javascript:void(0)" data-name="date-time-set-btn"></a>\n					<label data-name="date-time-set-btn">'+((__t=cycStartDayTxt)==null?"":__t)+'</label>\n					<ul class="dayvalues_nst" data-name="date-time-dropdown">\n						';_.each(dateData,function(date,index){__p+="\n							<li ";if(cycStartDayTxt==date){__p+='class="cur_nst"'}__p+='>\n								<a href="javascript:void(0)" index="'+((__t=index)==null?"":__t)+'" data-type="1">'+((__t=date)==null?"":__t)+"</a>\n							</li>\n						"});__p+="\n					</ul>\n				</div>\n			"}__p+='\n			<div class="day_time_nst">\n				<a class="triday_nst" href="javascript:void(0)" data-name="date-time-set-btn"></a>\n				<label data-name="date-time-set-btn">'+((__t=cycStartHour)==null?"":__t)+'</label>\n				<ul class="dayvalues_nst"  data-name="date-time-dropdown">\n					';_.each(hours,function(hour){__p+="\n						<li ";if(cycStartHour==hour){__p+='class="cur_nst"'}__p+='>\n							<a href="javascript:void(0)" hour="'+((__t=hour)==null?"":__t)+'" data-type="3">'+((__t=hour)==null?"":__t)+"</a>\n						</li>\n					"});__p+='\n				</ul>\n			</div>\n			<div class="date-time-colon">:</div>\n			<div class="day_time_nst">\n				<a class="triday_nst" href="javascript:void(0)" data-name="date-time-set-btn"></a>\n				<label data-name="date-time-set-btn">'+((__t=cycStartMinute)==null?"":__t)+'</label>\n				<ul class="dayvalues_nst" data-name="date-time-dropdown">\n					';_.each(minites,function(minite){__p+="\n						<li ";if(cycStartMinute==minite){__p+='class="cur_nst"'}__p+='>\n							<a href="javascript:void(0)" minite="'+((__t=minite)==null?"":__t)+'" data-type="5">'+((__t=minite)==null?"":__t)+"</a>\n						</li>\n					"});__p+='\n				</ul>\n			</div>\n		</div>\n		<div class="cycle_time clearfix">\n			<span>结束时间</span>\n			';if(cycType==3||cycType==4){__p+='\n				<div class="day_time_nst first-col">\n					<a class="triday_nst" href="javascript:void(0)" data-name="date-time-set-btn"></a>\n					<label data-name="date-time-set-btn">'+((__t=cycEndDayTxt)==null?"":__t)+'</label>\n					<ul class="dayvalues_nst" data-name="date-time-dropdown">\n						';_.each(dateData,function(date,index){__p+="\n							<li ";if(cycEndDayTxt==date){__p+='class="cur_nst"'}__p+='>\n								<a href="javascript:void(0)" index="'+((__t=index)==null?"":__t)+'" data-type="2">'+((__t=date)==null?"":__t)+"</a>\n							</li>\n						"});__p+="\n					</ul>\n				</div>\n			"}__p+='\n			<div class="day_time_nst">\n				<a class="triday_nst" href="javascript:void(0)" data-name="date-time-set-btn"></a>\n				<label data-name="date-time-set-btn">'+((__t=cycEndHour)==null?"":__t)+'</label>\n				<ul class="dayvalues_nst" data-name="date-time-dropdown">\n					';_.each(hours,function(hour){__p+="\n						<li ";if(cycEndHour==hour){__p+='class="cur_nst"'}__p+=' >\n							<a href="javascript:void(0)" hour="'+((__t=hour)==null?"":__t)+'" data-type="4">'+((__t=hour)==null?"":__t)+"</a>\n						</li>\n					"});__p+='\n				</ul>\n			</div>\n			<div class="date-time-colon">:</div>\n			<div class="day_time_nst">\n				<a class="triday_nst" href="javascript:void(0)" data-name="date-time-set-btn"></a>\n				<label data-name="date-time-set-btn">'+((__t=cycEndMinute)==null?"":__t)+'</label>\n				<ul class="dayvalues_nst" data-name="date-time-dropdown">\n					';_.each(minites,function(minite){__p+="\n						<li ";if(cycEndMinute==minite){__p+='class="cur_nst"'}__p+='>\n							<a href="javascript:void(0)" minite="'+((__t=minite)==null?"":__t)+'" data-type="6">'+((__t=minite)==null?"":__t)+"</a>\n						</li>\n					"});__p+='\n				</ul>\n			</div>\n		</div>\n	</div>\n</div>\n<div class="buttons clearfix">\n	<a href="javascript:void(0)" class="btn btn-cancel reset-cycle" data-name="data-time-picker-reset-cycle">取消循环</a>\n	<div class="right-part">\n		<a href="javascript:void(0)" class="btn btn-sure" data-name="data-time-picker-sure-cycle">确定</a>\n		<a href="javascript:void(0)" class="btn btn-cancel" data-name="data-time-picker-close-cycle">取消</a>\n	</div>\n</div>'}return __p};this["JST"]["date-time-picker/date-time-long"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="clearfix">\n	<div class="date-long-left" data-name="date-time-long-date">\n	</div>\n	<div class="date-long-right">\n		<div class="date-check" data-name="date-time-long-check">\n			<span class="checkbox checkbox-checked" data-name="date-time-long-input"></span><span>长期</span>\n		</div>\n	</div>\n</div>\n<div class="buttons clearfix">\n	<span class="btn btn-cancel cancel-long" data-name="date-time-long-candellong">取消长期</span>\n	<span class="btn btn-sure" data-name="date-time-long-sure">确定</span>\n	<span class="btn btn-cancel" data-name="date-time-long-candel">取消</span>\n	\n</div>'}return __p};this["JST"]["date-time-picker/date-time-picker-tab"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n	";if(isShowDateView){__p+='\n	<li class="item-tab ';if(viewType=="date"){__p+="active"}__p+='" data-type="date">起止时间</li>\n	'}__p+="\n	";if(isShowCycleView){__p+='\n	<li class="item-tab ';if(viewType=="cycle"){__p+="active"}__p+='" data-type="cycle" >循环时间</li>\n	'}__p+="\n	";if(isShowLongView){__p+='\n	<li class="item-tab ';if(viewType=="long"){__p+="active"}__p+='" data-type="long" >长期</li>\n	'}}return __p};this["JST"]["date-time-picker/date-time-picker"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="cont-box" data-name="date-time-picker-content"></div>'}return __p};this["JST"]["emotion/emotion-body"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<table class="emotion-table-size-'+((__t=currentData.size)==null?"":__t)+'">\n	';var emotions=currentData.emticons,colNum=currentData.size=="small"?14:7,rowNum=Math.ceil(emotions.length/colNum),item=null;__p+="\n	";for(var i=0;i<rowNum;i++){__p+="\n		<tr>\n			";for(var j=0;j<colNum&&i*colNum+j<emotions.length;j++){__p+="\n				";item=emotions[i*colNum+j];__p+='\n				<td>\n					<span class="td-border"></span>\n					<img data-name="emotion-img" src="'+((__t=currentData.host+item.address)==null?"":__t)+'"  title="'+((__t=item.name)==null?"":__t)+'">\n				</td>\n			'}__p+="\n		</tr>		\n	"}__p+="\n		\n</table>"}return __p};this["JST"]["emotion/emotion-tab"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){for(var i=0,len=data.length;i<len;i++){__p+='\n	<div class="emotion-tab-item '+((__t=data[i].name==currentTab?"tab-active":"")==null?"":__t)+'" data-id="'+((__t=data[i].name)==null?"":__t)+'">\n		'+((__t=data[i].name)==null?"":__t)+"\n	</div>\n"}}return __p};this["JST"]["emotion/emotion"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="emotion-tab-container" data-name="emotion-tab-container">\n\n</div>\n<div class="emotion-body-container" data-name="emotion-body-container">\n\n</div>'}return __p};this["JST"]["empty-view/empty"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="content_emptyinit">\n	<div class="className">'+((__t=emptyContext)==null?"":__t)+"</div>\n</div>"}return __p};this["JST"]["evaluation/evaluation-dimension-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<label class="dimension-title">'+__e(name)+'</label>\n<div class="star-list-container" data-name="star-container">\n</div>'}return __p};this["JST"]["evaluation/evaluation-dimension"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<label class="evaluation-title">维度评分</label>\n<div class="evaluation-dimension-container eval-item">\n	<ul></ul>\n</div>'}return __p};this["JST"]["evaluation/evaluation-edit"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<ul class="evaluation-list">\n';if(isShowScores){__p+='\n<li class="evaluation-score" data-name="evaluation-edit-score">\n</li>\n'}__p+="\n";if(isShowDimensions){__p+='\n<li class="evaluation-dimension" data-name="evaluation-edit-dimension">\n</li>\n'}__p+="\n";if(isShowMedal){__p+='\n<li class="evaluation-medal clearfix" data-name="evaluation-edit-medal">\n</li>\n'}__p+='\n<li class="evaluation-comment">\n	<label class="evaluation-title">评语</label>\n	<div class="evaluation-comment eval-item">\n		<textarea class="comment" placeholder="完成的不错，继续努力！" data-name="comment">'+__e(remark)+'</textarea>\n	</div>\n</li>\n</ul>\n<div class="evaluation-operate">\n	<span class="btn btn-sure  btn-disabled" data-name="evaluation-save">确定</span><span class="btn btn-cancel"  data-name="evaluation-cancel">取消</span>\n	\n</div>\n'}return __p};this["JST"]["evaluation/evaluation-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(evaluateInfos.length&&(scoreInfos||medalInfos)){__p+='\n	<div class="evaluation-item">\n	  <div class="evaluation-preview clearfix">\n	  	';if(editable){__p+='\n			<div class="preview-operate">\n				<span class="btn btn-sure" data-name="evaluation-edit">修改评价</span>\n			</div>\n		'}__p+='\n		<div class="preview-detail">\n			<div class="evaluation-user" origin-title="'+__e(user.Name)+'">\n				'+((__t=_.convertImage({className:"",src:user.Avatar.Small,size:30,shape:"radius",name:user.Name,bgColor:user.Avatar.Color}))==null?"":__t)+'\n				\n		    </div>\n		    <ul class="preview-list">\n		    	<li class="preview-score">\n		    		 ';if(medalInfos.length){__p+='\n			    		 <div class="label-name">奖章</div>\n			    		 <div class="evaluation-result">\n			    		 	'+((__t=_.TitaWidget_evaluation(medalInfos[0]))==null?"":__t)+"\n			    		</div>\n		    		 "}__p+="\n		    		 ";if(scoreInfos.length){__p+='\n			    		 <div class="label-name">评分</div> \n			    		 <div class="evaluation-result">\n			    		 	'+((__t=_.TitaWidget_evaluation(scoreInfos[0],{showStar:true}))==null?"":__t)+"\n			    		</div>\n		    		 "}__p+='\n		    	</li>\n		    	<li class="preview-comment">\n		    		<div class="label-name">评语</div>\n		    		<p class="evaluation-result">\n		    			';if(substringRemark!=remark){__p+="\n			    			";if(commentShowAll==false){__p+="\n			    		        "+__e(substringRemark)+'<a href="javascript:void(0);"  class="show-all" data-name="show-comment">展开</a>	\n			    		     '}else{__p+="\n			    		        "+__e(remark)+'<a href="javascript:void(0);" class="show-all" data-name="show-comment">收起</a>	\n			    		     '}__p+="\n		    			"}else{__p+="\n							"+__e(remark)+"\n		    			"}__p+="\n	    			</p>\n		    	</li>\n		    </ul>\n		    ";if(viewMode=="simple"&&dimensionInfos&&dimensionInfos.length>0){__p+='\n				<a href="javascript:void(0)" class="show-detail" data-name="showDetail-top">维度评分<span class="icon-arrow-down-double"></span></a>\n			'}__p+="\n		</div>\n		";if(viewMode=="detailed"&&dimensionInfos.length){__p+='\n			<div class="evaluation-dimension" data-name="evaluation-weidu-list">\n				<ul class="clearfix" >\n					';_.each(dimensionInfos,function(item,index){__p+='\n			   			<li class="preview-dimension-item">\n							<label>'+__e(item.name)+'：</label>\n							<span class="item-value"><span class="score-value">'+__e(item.value)+"</span>分</span>\n						</li>\n					"});__p+='\n				</ul>\n				<a href="javascript:void(0)" class="show-detail arrow-up" data-name="showDetail">维度评分<span class="icon-arrow-up-double"></span></a>\n			</div>\n		'}__p+=" \n	</div>  \n"}else{__p+="\n	";if(isAdd){__p+='\n	<div class="evaluation-item">\n		<div class="evaluation-none">\n			<span class="text_none">'+((__t=evaluationObject)==null?"":__t)+"</span>\n			";if(editable){__p+='\n			<span class="btn btn-sure" data-name="do-evaluation">现在评价</span>\n			'}__p+="\n		</div>\n	</div>\n	"}__p+="\n"}}return __p};this["JST"]["evaluation/evaluation-medal"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(!isShowRadio){__p+='\n<label class="evaluation-title">奖章鼓励</label>\n'}else{__p+='\n<label class="evaluation-title radio" data-name="radio">奖章鼓励</label>\n'}__p+='\n<div class="evaluation-medal-containner eval-item clearfix" data-name="evaluation-edit-medal">\n	';_.each(data,function(item,index){__p+="\n		";if(cType==item.cType&&type==2){__p+='\n		<div class="medal medal-active-'+((__t=index)==null?"":__t)+" medal-hover-"+((__t=index)==null?"":__t)+'" data-ctype="'+__e(item.cType-1)+'"  data-value="'+__e(item.value)+'" data-index="'+((__t=index)==null?"":__t)+'">\n			<span class="'+((__t=item.className)==null?"":__t)+' "></span>\n			<span>'+__e(item.name)+"</span>\n		</div>\n		"}else{__p+='\n		<div class="medal medal-hover-'+((__t=index)==null?"":__t)+'" data-ctype="'+__e(item.cType)+'"  data-value="'+__e(item.value)+'" data-index="'+((__t=index)==null?"":__t)+'">\n			<span class="'+((__t=item.className)==null?"":__t)+'"></span>\n			<span>'+__e(item.name)+"</span>\n		</div>\n		"}__p+="\n	"});__p+="\n</div>"}return __p};this["JST"]["evaluation/evaluation-score"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(!isShowRadio){__p+='\n	<label class="evaluation-title">'+((__t=name||"综合评分")==null?"":__t)+"</label>\n"}else{__p+='\n	<label class="evaluation-title radio" data-name="radio">'+((__t=name||"综合评分")==null?"":__t)+"</label>\n"}__p+="\n<div class=\"evaluation-score-container eval-item\" data-name='evaluation-edit-score'></div>\n\n\n"}return __p};this["JST"]["evaluation/evaluation-star"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<ul class="evaluation-star-list">\n	';for(var i=1;i<=lvl;i++){var dataValue=i*goal;__p+="\n		";if(dataValue<=value){__p+='\n		   <li class="star-ico tu-icon-star-solid" original-title="评分:'+__e(dataValue)+'分" data-value="'+__e(dataValue)+"\" data-index='"+__e(i-1)+'\' data-name="star"></li>\n		'}else{__p+='\n		   <li class="star-ico tu-icon-star" original-title="评分:'+__e(dataValue)+'分" data-value="'+__e(dataValue)+"\" data-index='"+__e(i-1)+'\' data-name="star"></li>\n		'}__p+="\n    "}__p+="\n</ul>\n";if(value){__p+='\n<div class="last-score">\n	<span class="score-value">'+__e(value)+'</span><span class="value-unit">分</span>\n</div>\n'}}return __p};this["JST"]["experience/experience"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<!-- <div class="head-ev">填写心得</div> -->\n<div data-name="experience-contant"></div>'}return __p};this["JST"]["feed/feed-action-more"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n	<ul>\n		";if(detail){__p+='<li data-name="feed-action-detail"><a href="'+((__t=detailUrl)==null?"":__t)+'" target="_blank">查看详情</a></li>'}__p+="\n		";if(deleted){__p+='<li data-name="feed-action-del">删除</li>'}__p+="\n		";if(setTop){__p+='<li data-name="feed-action-top">';if(!isTop){__p+="置顶"}else{__p+="取消置顶"}__p+="</li>"}__p+="\n	</ul>\n"}return __p};this["JST"]["feed/feed-action"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="refer_fb">\n	<span class="time_fb">'+((__t=createDate)==null?"":__t)+"</span>\n	&nbsp;&nbsp;<span>"+((__t=postSource)==null?"":__t)+'</span>\n</div>\n<ul class="action_fb">\n	\n	';if(isShowReply){__p+='\n		<li data-name="feed-action-reply">\n			<span class="tu-icon-talk"></span><span>回复</span>\n		</li>\n	'}__p+="\n	";if(isShowCollect){__p+='\n		<li class="line_afb">|</li>\n		<li data-name="feed-action-collect">\n			<span class="tu-icon-heart"></span><span>';if(isCollect){__p+="取消收藏"}else{__p+="收藏"}__p+="</span>\n		</li>\n		\n	"}__p+="\n	";if(isShowPraise){__p+='\n		<li class="line_afb">|</li>\n		<li data-name="feed-action-praise">\n			<span class="tu-icon-like"></span><span>';if(isPraise){__p+="取消赞"}else{__p+="赞"}__p+="</span>\n		</li>\n	"}__p+="\n	";if(isShowTaoShang){__p+='\n	<li class="line_afb">|</li>\n	<li data-name="feed-action-beg">\n		<span class="tu-icon-taoshang"></span><span>讨赏</span>\n	</li>\n	'}__p+="\n	";if(isShowDaShang){__p+='\n	<li class="line_afb">|</li>\n	<li data-name="feed-action-reward">\n		<span class="tu-icon-dashang"></span><span>打赏 ';if(counter.dashangTotal){__p+=(__t=counter.dashangTotal)==null?"":__t}__p+="</span>\n	</li>\n	"}__p+="\n	";if(isShowAddTag){__p+='\n	<li class="line_afb">|</li>\n	<li data-name="feed-action-tag">\n		<span class="tu-icon-tag"></span><span>标签</span>\n	</li>\n	'}__p+="\n</ul>"}return __p};this["JST"]["feed/feed-attachment-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="img_afb_wrapper">\n	';if(isImage){__p+='\n	<img src="'+((__t=smallUrl)==null?"":__t)+'" class="img_afb tu-cp" data-name="feed-attachment-img">\n	'}else{__p+='\n	<span class="ico_afb tu-icon-'+((__t=fileType)==null?"":__t)+'" style="color:'+((__t=iconColor)==null?"":__t)+'"></span>\n	'}__p+='\n</div>\n<p data-name="name_up" class="name_afb '+((__t=isImage?"tu-cp":"")==null?"":__t)+'" data-toggle="infotip" data-body="'+((__t=fileFullName)==null?"":__t)+'">'+((__t=fileFullName)==null?"":__t)+'</p>\n<div class="operation_afb">\n	<a href="'+((__t=downloadUrl)==null?"":__t)+'"  data-name="attachment-download"  ';if(documentSource==3){__p+='target="_blank" '}__p+=">下载</a>\n	";if(isPreview){__p+="\n		";if(isImage&&documentSource==1){__p+='\n			<a href="'+((__t=previewUrl)==null?"":__t)+'" data-name="feed-attachment-preview" target="_blank">预览</a>\n		'}else{__p+='\n			<a href="';if(documentSource==1){__p+=(__t=webHost.host)==null?"":__t}__p+=((__t=previewUrl)==null?"":__t)+'" data-name="feed-attachment-preview-other" target="_blank">预览</a>&nbsp;\n		'}__p+="\n	"}__p+="\n</div>\n"}return __p};this["JST"]["feed/feed-attachment-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<ul class="list_afb"></ul>'}return __p};this["JST"]["feed/feed-comment-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n	<div class="left_cb">\n		'+((__t=_.convertImage({className:"avatar_small_fl",src:publishUser.avatar.medium,size:30,shape:"radius",name:publishUser.name,isExternal:publishUser.userType===2,bgColor:publishUser.avatar.color,userId:publishUser.userId}))==null?"":__t)+'\n		\n	</div>\n	<div class="right_cb tu-font-a2">\n		<div class="dynamic_cb tu-ft_m2 tu-cf">\n			<span class="name_box_ccb tu-fl tu-ft_m1">\n			'+((__t=_.convertUserName({userId:publishUser.userId,name:publishUser.name,isExternal:publishUser.userType==2,isExternalClass:"name_dcb tu-ft_m1 tu-ft-hv_m1",className:"name_dcb tu-ft_m1 tu-ft-hv_c3"}))==null?"":__t)+"\n			";if(commentType==2){__p+="&nbsp;回复&nbsp;\n			"+((__t=_.convertUserName({userId:parentUser.userId,name:parentUser.name,isExternal:parentUser.userType==2,isExternalClass:"name_dcb tu-ft_m1 tu-ft-hv_m1",className:"name_dcb tu-ft_m1  tu-ft-hv_c3"}))==null?"":__t)+'&nbsp;<span class="dehua_dcb tu-ft-hv_c3" data-name="feed-dehua" data-parent-id="'+((__t=parentCommentId)==null?"":__t)+'">的话</span>'}__p+='\n			：</span><span class="conent_cb">'+((__t=content)==null?"":__t)+'</span>\n		</div>\n		<div data-name="feed-comment-attachment"></div>\n		<div class="refer_cb tu-cf">\n			';if(isPrivate){__p+='\n			<span class="icon-lock-thin lock_fb" data-name="feed-comment-lock" original-title=""></span>\n			'}__p+='\n			<span class="time_cb tu-ft_m3">'+((__t=createDate)==null?"":__t)+'</span>\n			<div class="action_cb">\n				';if(isEdit){__p+='\n				<a href="javascript:void(0);" data-name="feed-comment-deleted" id="'+((__t=commentId)==null?"":__t)+'">删除</a>&nbsp;\n				'}__p+='\n				<a href="javascript:void(0);" data-name="feed-comment-reply" id="'+((__t=commentId)==null?"":__t)+'">回复</a>\n			</div>\n		</div>\n	</div>\n'}return __p};this["JST"]["feed/feed-comment-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(total&&total>4){__p+='\n<div class="total_fl tu-ft_m3 tu-font-a2 tu-ft-hv_c3" data-name="feed-comment-total">\n	<b class="ico_tfl tu-icon-angles-down" data-name="feed-comment-total-ico">\n		全部沟通&nbsp;<span data-name="feed-comment-total-num">'+((__t=total)==null?"":__t)+"</span>\n	</b>\n</div>\n"}__p+="\n";if(comments&&comments.length>0){__p+='\n<div data-name="comment-list"></div>\n'}__p+="\n"}return __p};this["JST"]["feed/feed-daily-overview"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<!-- \n<div class="hr_fb">\n	<div class="left_hr"></div>\n	<div class="line_hr"></div>\n	<div class="right_hr"></div>\n</div> -->\n\n<div class="overview_fb">\n	<a class="txt-gray cursor" data-name="show-detial" href="'+((__t=webHost.webHost)==null?"":__t)+"#more/dailyinfo?id="+((__t=feedId)==null?"":__t)+'" target="_blank">\n		';if(taskOverviewTotal.finishTotal){__p+='\n			<span class="tu-font-h4 overview_item">\n				当'+((__t=reportName)==null?"":__t)+'完成任务\n				&nbsp;\n				<span class="font16 ';if(taskOverviewTotal.finishTotal==0){__p+="txt-gray "}else{__p+="txt-green"}__p+='">'+((__t=taskOverviewTotal.finishTotal)==null?"":__t)+"\n				</span>\n			</span>\n		"}__p+="\n		";if(taskOverviewTotal.expireTotal){__p+='\n			<span class="tu-font-h4 overview_item">\n				当'+((__t=reportName)==null?"":__t)+'过期任务\n				&nbsp;\n				<span class="font16 ';if(taskOverviewTotal.expireTotal==0){__p+="txt-gray "}else{__p+="txt-red"}__p+='">'+((__t=taskOverviewTotal.expireTotal)==null?"":__t)+"\n				</span>\n			</span>\n		"}__p+="\n		";if(taskOverviewTotal.doingTotal){__p+='\n			<span class="tu-font-h4 overview_item">\n				当'+((__t=reportName)==null?"":__t)+'进行中任务\n				&nbsp;\n				<span class="font16 ';if(taskOverviewTotal.doingTotal==0){__p+="txt-gray "}else{__p+="txt-blue"}__p+='">'+((__t=taskOverviewTotal.doingTotal)==null?"":__t)+"\n				</span>\n			</span>\n		"}__p+="\n\n	</a>\n	";if(contentRichText){__p+='\n	<dl>\n		<dt class="tu-font-h4"><span class="left_line"></span>总结与障碍</dt>\n		<dd class="tu-scroll editor-style">\n			'+((__t=contentRichText)==null?"":__t)+"\n		</dd>	\n	</dl>\n	"}__p+="\n	";if(workPlanRichText){__p+='\n	<dl>\n		<dt class="tu-font-h4"><span class="left_line"></span>下一步工作安排</dt>\n		<dd class="editor-style">\n			'+((__t=workPlanRichText)==null?"":__t)+"\n		</dd>	\n	</dl>\n	"}__p+="\n</div>"}return __p};this["JST"]["feed/feed-daily"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<dl class="cont_tfb daily tu-font-h4">\n	<dt>\n		<span class="type_tfb">'+((__t=dailyType)==null?"":__t)+'</span>\n		<div class="daily_date name_warp_tfb">\n			<a href="'+((__t=webHost.webHost)==null?"":__t)+"#more/dailyinfo?id="+((__t=feedId)==null?"":__t)+'" data-name="daily-name" class="name_tfb" target="_blank">'+((__t=name)==null?"":__t)+'</a>\n			<b class="icos_tfb ">\n				<!-- 日报 -->\n				';if(reportType==8){__p+='\n					<span class="icon-daily-'+((__t=reportTypeIcon)==null?"":__t)+' calendar-icon">\n						<span class="icon-font tu-icon-cn-'+((__t=dateInfo)==null?"":__t)+'"></span>\n					</span>\n				'}__p+="\n				\n				<!-- 周报 -->\n				";if(reportType==26){__p+='\n					<span class="icon-daily-'+((__t=reportTypeIcon)==null?"":__t)+'  calendar-icon">\n						<span class="icon-font tu-icon-'+((__t=dateInfo)==null?"":__t)+'"></span>\n					</span>\n				'}__p+="\n				\n				<!-- 月报 -->\n				";if(reportType==27){__p+='\n					<span class="icon-daily-'+((__t=reportTypeIcon)==null?"":__t)+'  calendar-icon">\n						<span class="icon-font tu-icon-'+((__t=dateInfo)==null?"":__t)+'"></span>\n					</span>\n				'}__p+="\n			</b>\n			";if(submitState==1){__p+='\n				<span class="submit-satatus color-green"><span class="tu-icon-check-active"></span><span class="font12">按时提交</span></span>\n			'}else{__p+='\n				<span class="submit-satatus color-purple"><span class="tu-icon-check-active"></span><span class="font12">延时提交</span></span>\n			'}__p+="\n		</div>\n	</dt>\n</dl>\n";if(evaluation){__p+='\n	<dl class="evaluation">\n		<dt>\n			'+((__t=evaluation)==null?"":__t)+"\n		</dt>\n	</dl>\n"}__p+="\n\n\n"}return __p};this["JST"]["feed/feed-extra-info-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<span class="key_eifb">'+((__t=name)==null?"":__t)+'：</span><span class="value_eifb">';if(valueType==1){__p+='<a href="'+((__t=value)==null?"":__t)+'" target="_blank">'+((__t=value)==null?"":__t)+"</a>"}else{__p+=(__t=value)==null?"":__t}__p+="</span>\n\n"}return __p};this["JST"]["feed/feed-item-source"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(feedType==8){__p+="\n	";if(app.appUrl){__p+='\n		<a href="'+((__t=app.appUrl)==null?"":__t)+'" hidefocus="true" class="app_ifb" target="_blank">'+((__t=app.appName)==null?"":__t)+"</a>\n	"}else{__p+='\n		<span class="app_ifb" span>'+((__t=app.appName)==null?"":__t)+"</span>\n	"}__p+="\n"}else if(feedType==6||feedType==7||feedType==9||feedType==10||feedType==12){__p+="\n	";if(workType==6){__p+='\n		<a href="'+((__t=obj.objUrl+"&workType=6")==null?"":__t)+'" hidefocus="true" class="app_ifb" target="_blank">OKR目标</a>\n	'}else{__p+="\n		"+((__t=_.convertUserName({userId:publishUser.userId,name:_.substringWithM(publishUser.name,12,true),isExternal:publishUser.userType==2,isExternalClass:"name_ifb tu-ft_m1 tu-ft-hv_m1",className:"name_ifb tu-ft_m1 tu-ft-hv_c3"}))==null?"":__t)+"\n	"}__p+="\n	";if(publishUser.userMark){__p+='<img src="'+((__t=publishUser.userMark.logo)==null?"":__t)+'" original-title="'+((__t=publishUser.userMark.mark_name)==null?"":__t)+'" class="mark_fb" data-name="feed-user-mark">'}__p+='\n	<span class="cont_ifb">'+((__t=sourceTypeCont)==null?"":__t)+"</span>\n"}else{__p+="\n	";if(app&&isInAppPage==false){__p+="\n		";if(app.appUrl){__p+='\n		<a href="'+((__t=app.appUrl)==null?"":__t)+'" hidefocus="true" class="app_ifb" target="_blank">'+((__t=app.appName)==null?"":__t)+"</a>\n		"}else{__p+='\n			<span class="app_ifb" span>'+((__t=app.appName)==null?"":__t)+"</span>\n		"}__p+="\n	"}__p+="\n	";if(obj&&isInAppPage==false){__p+="\n		";if(obj.objType==15){__p+='\n		<span class="app_ifb" target="_blank">'+((__t=obj.objName)==null?"":__t)+"</span> \n		"}else{__p+='\n		<a href="'+((__t=obj.objUrl+(workType==6?"&workType=6":""))==null?"":__t)+'" hidefocus="true" class="app_ifb" target="_blank">'+((__t=obj.objName)==null?"":__t)+"</a> \n		"}__p+='\n		<span class="cont_ifb">'+((__t=sourceCont)==null?"":__t)+"</span>\n		\n	"}__p+="\n	"+((__t=_.convertUserName({userId:publishUser.userId,name:_.substringWithM(publishUser.name,12,true),isExternal:publishUser.userType==2,isExternalClass:"name_ifb tu-ft_m1 tu-ft-hv_m1",className:"name_ifb tu-ft_m1 tu-ft-hv_c3"}))==null?"":__t);if(publishUser.userMark){__p+='<img src="'+((__t=publishUser.userMark.logo)==null?"":__t)+'" original-title="'+((__t=publishUser.userMark.mark_name)==null?"":__t)+'" class="mark_fb" data-name="feed-user-mark">'}__p+='\n	<span class="cont_ifb">'+((__t=sourceTypeCont)==null?"":__t)+"</span>\n"}__p+="\n";if(counter&&counter.dashangTotal){__p+='<span class="dashang_ico" data-name="dashang-ico" original-title="收到打赏"></span>'}__p+="\n";if(isTop){__p+='<span class="top_fl"></span>'}__p+="\n\n"}return __p};this["JST"]["feed/feed-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="left_fb" data-name="feed-left">\n	\n</div>\n<div class="right_fb">\n	<div data-name="feed-main"></div>\n	<div data-name="feed-content"></div>\n	<div data-name="feed-actoin" class="feed-actoin"></div>\n	<div data-name="feed-tag" style="';if(!tagData.length){__p+="display: none;"}__p+='"></div>\n</div>\n<div class="submain_fb" data-name="feed-sub-main">\n	<div data-name="feed-comment"></div>\n</div>\n<div data-name="feed-pubblog"></div>'}return __p};this["JST"]["feed/feed-left"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(app&&isInAppPage==false){__p+="\n	";if(feedType==8){__p+="\n		"+((__t=_.convertImage({className:"avatar_fl",src:app.appLogo,size:50,shape:"radius",name:"",href:app.url,bgColor:""}))==null?"":__t)+"\n	"}else if(workType==6){__p+="\n		"+((__t=_.convertImage({className:"avatar_fl",src:"//st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-target.png",size:50,shape:"radius",name:"",href:app.url+"&workType=6",bgColor:""}))==null?"":__t)+"\n	"}else if(feedType==6||feedType==7||feedType==9||feedType==10||feedType==12){__p+="\n		"+((__t=_.convertImage({className:"avatar_fl",src:publishUser.avatar.medium,tag:publishUser.tag&&publishUser.tag.tagName,tagColor:publishUser.tag&&publishUser.tag.color,size:50,shape:"radius",userId:publishUser.userId,name:publishUser.name,isExternal:publishUser.userType===2,bgColor:publishUser.avatar.color}))==null?"":__t)+"\n	"}else{__p+="\n		"+((__t=_.convertImage({className:"avatar_fl",src:app.appLogo,size:50,shape:"radius",name:"",href:app.url,bgColor:""}))==null?"":__t)+"\n\n	"}__p+="\n\n"}else{__p+="\n	";if(typeof obj!=="undefined"&&obj&&isInAppPage==false&&feedType!=6&&feedType!=10){__p+="\n		";if(obj.objSubType==6){__p+="\n			"+((__t=_.convertImage({className:"",src:"//st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-target.png",size:50,shape:"radius",name:"",href:obj.objUrl+"&workType=6",bgColor:""}))==null?"":__t)+"\n		\n		"}else if(obj.objType==3||obj.objType==4){__p+="\n			"+((__t=_.convertImage({className:"",src:obj.objLogo,size:50,shape:"radius",name:"",href:obj.objUrl,bgColor:""}))==null?"":__t)+"\n\n		"}else if(obj.objType==15){__p+="\n			"+((__t=_.convertImage({className:"avatar_fl",src:"",size:50,shape:"radius",name:obj.objName,bgColor:obj.objColor}))==null?"":__t)+"\n		"}else{__p+="\n			"+((__t=_.convertImage({className:"avatar_fl",src:publishUser.avatar.medium,tag:publishUser.tag&&publishUser.tag.tagName,tagColor:publishUser.tag&&publishUser.tag.color,size:50,shape:"radius",name:publishUser.name,isExternal:publishUser.userType===2,bgColor:publishUser.avatar.color,userId:publishUser.userId}))==null?"":__t)+"\n		"}__p+="\n	"}else{__p+="\n		";if(workType==6&&!isInAppPage){__p+="\n			"+((__t=_.convertImage({className:"",src:"//st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-target.png",size:50,shape:"radius",name:"",href:obj.objUrl+"&workType=6",bgColor:""}))==null?"":__t)+"\n		"}else{__p+="\n\n			"+((__t=_.convertImage({className:"avatar_fl",src:publishUser.avatar.medium,tag:publishUser.tag&&publishUser.tag.tagName,tagColor:publishUser.tag&&publishUser.tag.color,size:50,shape:"radius",name:publishUser.name,bgColor:publishUser.avatar.color,userId:publishUser.userId,isExternal:publishUser.userType===2}))==null?"":__t)+"\n		";

}__p+="\n	"}__p+="\n"}}return __p};this["JST"]["feed/feed-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div data-name="feed-list-box"></div>\n';if(!isEnd){__p+='\n<div class="more_fl" data-name="feed-more">\n	<span data-name="feed-more-text">查看更多</span>&nbsp;<span class="icon-arrow-down"></span>\n</div>\n'}}return __p};this["JST"]["feed/feed-main"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="edit_fb" data-name="feed-top-action">\n	';if(isShowSlideMore){__p+='\n	<span class="down_fb" data-name="feed-action-slide"><b class="icon-arrow-down"></b></span>\n	'}__p+='\n</div>\n<div class="lock_area_fb">\n	';if(isPrivate){__p+='<span class="icon-lock-round lock_lafb"></span>'}__p+=((__t=privateTipText)==null?"":__t)+'\n</div>\n<div class="info_fb" data-name="feed-source">\n	\n</div>\n<div class="clearfix clear_fb"></div>\n\n'}return __p};this["JST"]["feed/feed-okr"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="right_wfb">\n\n	<div class="person_wfb">\n		';if(status!=2&&principalUser){__p+="\n		当前处理人："+((__t=_.substringWithM(principalUser.name,12,true))==null?"":__t)+"\n		"+((__t=_.convertImage({className:"avatar_small_fl",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,userId:principalUser.userId,bgColor:principalUser.avatar.color}))==null?"":__t)+"\n		"}else{__p+='\n		评分：<span class="score_wfb">'+((__t=score)==null?"":__t)+"</span>分\n		"}__p+='\n	</div>\n	<div class="time_wtb">\n			'+((__t=startDate)==null?"":__t)+"—"+((__t=deadline)==null?"":__t)+'\n	</div>\n</div>\n\n<dl class="cont_wfb">\n	<dt>\n		<div class="type_wfb">考核</div>\n		<div class="title_wfb">\n			<a href="'+((__t=url)==null?"":__t)+'" class="name_tfb" data-name="feed-task-name" target="_blank">'+((__t=assessName)==null?"":__t)+'</a>\n		</div>\n	</dt>\n	<dd data-name="feed-work-flow">\n		\n		\n	</dd>\n</dl>\n\n'}return __p};this["JST"]["feed/feed-plan"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<dt>\n	<span class="type_stfb">\n		';if(feedType==2){__p+="\n		目标\n		"}else if(feedType==3){__p+="\n		考核表\n		"}else{__p+="\n		计划表\n		"}__p+="\n	</span>\n	";if(app&&app.appObj){__p+="\n		";if(app.appObj.appObjeUrl&&app.appObj.appObjeUrl!=""){__p+='\n			<a href="'+((__t=app.appObj.appObjeUrl)==null?"":__t)+'" hidefocus="true" class="skip_mmfed" target="_blank">'+((__t=app.appObj.appObjTitle)==null?"":__t)+"</a>\n		"}else{__p+='\n			<span class="skip_mmfed">'+((__t=app.appObj.appObjTitle)==null?"":__t)+"</span>\n		"}__p+="\n	"}else{__p+='\n		<a href="'+((__t=planTableUrl)==null?"":__t)+'" class="name_stfb" target="_blank">'+((__t=planTableName)==null?"":__t)+"</a>\n	"}__p+="\n</dt>\n"}return __p};this["JST"]["feed/feed-praise"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n	<div class="cont_pfb">\n		<span class="icon-hand-round-';if(isPraise){__p+="-active"}else{__p+="highlight"}__p+=' icos_prb" data-name="feed-praise-praise"></span>\n		';if(total>10){__p+='<span data-name="feed-praise-all">'}__p+="\n		";_.each(praisesList,function(item,index){__p+='\n		<a href="'+((__t=item.url)==null?"":__t)+'">'+((__t=item.name)==null?"":__t)+"</a>";if(index+1<praisesList.length){__p+=","}__p+="\n		"});__p+="&nbsp;";if(total>10){__p+="等&nbsp;"+((__t=total)==null?"":__t)+"&nbsp;"}__p+="人觉得很赞";if(total>10){__p+="</span>"}__p+="\n	</div>\n"}return __p};this["JST"]["feed/feed-share"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(isShowIco){__p+='<span class="icon-quotes-left"></span>&nbsp;'}__p+="\n"+((__t=content)==null?"":__t)+"\n";if(contentMax){__p+="\n\n	";if(!contentShowAll){__p+='\n	<a href="javascript:void(0);" class="slide_fb" data-name="content-slide">展开&nbsp;<b class="icon-drop-down" ></b></a>\n	'}else{__p+='\n	<a href="javascript:void(0);" class="slide_fb" data-name="content-slide">收起&nbsp;<b class="icon-drop-up" ></b></a>\n	'}__p+="\n"}__p+="\n";if(isShowIco){__p+='&nbsp;<span class="icon-quotes-right"></span>'}__p+="\n"}return __p};this["JST"]["feed/feed-signin-track"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";_.each(timeSites,function(item,index){__p+="\n<li ";if(index==timeSites.length-1){__p+='class="end_ssfb"'}__p+=">\n	";if(index==0){__p+='\n		<span class="ico_ssfb tu-icon-uparrow tu-ft_f4 tu-icon-a1"></span>\n	'}else{__p+='\n		<span class="ico_ssfb tu-icon-downarrow tu-ft_f6 tu-icon-a1"></span>\n	'}__p+='\n	<span class="time_ssfb">'+((__t=item.time)==null?"":__t)+'</span><span class="text_ssfb">签到地点：<span class="pos_ssfb">'+((__t=item.site)==null?"":__t)+"</span></span>\n	";if(timeSites.length>defaultCount&&index==timeSites.length-1){__p+='\n	&nbsp;&nbsp;&nbsp;&nbsp;\n	<a href="javascript:void(0);" class="slide_fb" data-name="feed-signin-slide">\n		';if(singinTrackShowAll){__p+='\n		收起（5）<b class="icon-drop-up"></b>\n		'}else{__p+='\n		展开（5）<b class="icon-drop-down"></b>\n		'}__p+="\n	</a>\n	"}__p+="\n</li>\n\n"})}return __p};this["JST"]["feed/feed-signin"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="cont_sfb">\n	<span class="type_sfb">移动签到</span>\n	<span class="name_sfb">'+((__t=date)==null?"":__t)+'</span>\n	&nbsp;&nbsp;&nbsp;&nbsp;<span class="des_dfb">工作计时：</span><span class="full_sfb">'+((__t=workHours)==null?"":__t)+"小时</span>\n</div>\n"}return __p};this["JST"]["feed/feed-step"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<span class="des_wfb">进度</span>\n<ul class="workflow_fb clearfix ';if(status==2){__p+="complete-all"}__p+='">\n	';_.each(step,function(item,index){__p+="\n		";if(status==2&&index==step.length-1){__p+='\n		<li class="'+((__t=item.className)==null?"":__t)+' active">\n			<div class="content"><span class="ico-complete"></span>&nbsp;'+((__t=item.stepName)==null?"":__t)+"</div>\n		</li>\n		"}else if(status==2&&index==0&&total>=4){__p+='\n		<li class="'+((__t=item.className)==null?"":__t)+'" ';if(step.length==4){__p+='\n				style="width:15.62%"\n			'}else{__p+='\n				style="width:23%"\n			'}__p+='>\n			<div class="content"><span class="tu-icon-diot"></span></div>\n		</li>	\n		'}else if(item.status==2){__p+='\n		<li class="'+((__t=item.className)==null?"":__t)+' active">\n			<div class="content">'+((__t=item.stepName)==null?"":__t)+"</div>\n		</li>\n		"}else{__p+='\n			<li class="'+((__t=item.className)==null?"":__t)+" ";if(index==step.length-1){__p+="last_wfb"}__p+='" ';if(step.length==4){__p+='\n					style="width:15.62%"\n				'}else{__p+='\n					style="width:23%"\n				'}__p+='>\n				<div class="content">\n					';if(total>=4&&item.status==1&&index==0&&activeIndex>1){__p+='\n						<span class="tu-icon-diot"></span>\n					'}else if(total>=4&&item.status!=2&&index==3&&activeIndex<total-2){__p+='\n						<span class="tu-icon-diot"></span>\n					'}else if(item.status==1){__p+='\n						<span class="tu-icon-check-active"></span>\n					'}else if(item.status==3){__p+="\n						&nbsp;\n					"}__p+="\n				</div>\n			</li>\n		"}__p+="\n	"});__p+="\n</ul>"}return __p};this["JST"]["feed/feed-task-app"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="right_tfb">\n\n	<span class="status_tfb icon-status-'+((__t=status)==null?"":__t)+'"></span>\n	<div class="person_tfb">\n		';if(counter.workTimeTotal>0){__p+='\n		<b class="hour_tfb">\n			<span class="icon-work-hour-small"></span>\n			'+((__t=counter.workTimeTotal)==null?"":__t)+"\n		</b>\n		"}__p+="\n		";if((principalUser&&principalUser.userId)!=publishUser.userId){__p+="\n\n				"+((__t=_.convertImage({className:"avatar_small_fl",src:publishUser.avatar.small,size:30,shape:"radius",name:publishUser.name,bgColor:publishUser.avatar.color,userId:publishUser.userId}))==null?"":__t)+"\n\n			";if(app&&app.appId==901){__p+="提交给"}else{__p+="安排给"}__p+="\n		"}else{__p+="\n		负责人："+((__t=_.substringWithM(principalUser.name,12,true))==null?"":__t)+"\n		"}__p+="\n		\n		"+((__t=_.convertImage({className:"avatar_small_fl",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,userId:principalUser.userId,bgColor:principalUser.avatar.color}))==null?"":__t)+'\n	\n	</div>\n	<div class="time_ftb">\n		';if(!evaluation&&status!="2"){__p+="\n			";if(typeof isLongTerm!=="undefined"&&isLongTerm){__p+="\n			长期"}else{__p+=(__t=date)==null?"":__t}__p+="\n		"}else{__p+="\n			"+((__t=evaluation)==null?"":__t)+"\n		"}__p+='\n	</div>\n</div>\n\n<dl class="cont_tfb">\n	<dt>\n		<span class="type_tfb">';if(isCycle){__p+="循环"}__p+=((__t=typeName)==null?"":__t)+"</span>\n		<div>\n			";if(isPush){__p+='\n				<a href="'+((__t=webHost.host)==null?"":__t)+""+((__t=url)==null?"":__t)+'" class="name_tfb" data-name="feed-task-name" target="_blank">'+((__t=taskName)==null?"":__t)+"</a>\n			"}else{__p+='\n				<a href="'+((__t=webHost.host)==null?"":__t)+""+((__t=url)==null?"":__t)+'" class="name_tfb" target="_blank">'+((__t=taskName)==null?"":__t)+"</a>\n			"}__p+='\n			<b class="icos_tfb">\n				';if(counter.taskTotal>0){__p+='\n					<span class="icon-plan-task item_icon_tfb" original-title="有任务"></span>\n					<span>'+((__t=counter.taskTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.businessTripTotal>0){__p+='\n					<span class="icon-plan-trip item_icon_tfb" original-title="有出差"></span>\n					<span>'+((__t=counter.businessTripTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.experienceTotal>0){__p+='\n					<span class="icon-plan-summarize item_icon_tfb" original-title="有进展"></span>\n					<span>'+((__t=counter.experienceTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.meetTotal>0){__p+='\n					<span class="icon-plan-meeting item_icon_tfb" original-title="有会议"></span>\n					<span>'+((__t=counter.meetTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.attachmentTotal>0){__p+='\n					<span class="tu-icon-cus-fujian item_icon_tfb" original-title="有附件"></span>\n					<span>'+((__t=counter.attachmentTotal)==null?"":__t)+"</span>\n				"}__p+='\n			</b>\n		</div>\n	</dt>\n	<dd>\n		<span class="des_tfb">';if(!description){__p+="暂无描述"}else{__p+=(__t=description)==null?"":__t}__p+="</span>\n	</dd>\n</dl>\n\n"}return __p};this["JST"]["feed/feed-task"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="right_tfb">\n\n	<span class="status_tfb icon-status-'+((__t=status)==null?"":__t)+'"></span>\n	<div class="person_tfb">\n		';if(counter.workTimeTotal>0){__p+='\n		<b class="hour_tfb">\n			<span class="icon-work-hour-small"></span>\n			'+((__t=counter.workTimeTotal)==null?"":__t)+"h\n		</b>\n		"}__p+="\n		";if((principalUser&&principalUser.userId)!=publishUser.userId){__p+="\n			\n				"+((__t=_.convertImage({className:"avatar_small_fl",src:publishUser.avatar.small,size:30,shape:"radius",name:publishUser.name,bgColor:publishUser.avatar.color,userId:publishUser.userId}))==null?"":__t)+"\n		\n			";if(app&&app.appId==901){__p+="提交给"}else{__p+="安排给"}__p+="\n		"}else{__p+="\n		负责人："+((__t=_.substringWithM(principalUser.name,12,true))==null?"":__t)+"\n		"}__p+="\n		"+((__t=_.convertImage({className:"avatar_small_fl",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,bgColor:principalUser.avatar.color,userId:principalUser.userId}))==null?"":__t)+'\n\n	</div>\n	<div class="time_ftb">\n		';if(!evaluation&&status!="2"){__p+="\n			";if(typeof isLongTerm!=="undefined"&&isLongTerm){__p+="\n			长期"}else{__p+=(__t=date)==null?"":__t}__p+="\n		"}else{__p+="\n			"+((__t=evaluation)==null?"":__t)+"\n		"}__p+='\n	</div>\n</div>\n\n<dl class="cont_tfb">\n	<dt>\n		<span class="type_tfb">';if(isCycle){__p+="循环"}__p+=((__t=typeName)==null?"":__t)+'</span>\n		<div class="name_warp_tfb">\n			';if(isPush){__p+='\n				<a href="'+((__t=webHost.host)==null?"":__t)+""+((__t=url)==null?"":__t)+'" class="name_tfb" data-name="feed-task-name" target="_blank">'+((__t=taskName)==null?"":__t)+"</a>\n			"}else{__p+='\n				<a href="'+((__t=webHost.host)==null?"":__t)+""+((__t=url)==null?"":__t)+'" class="name_tfb" target="_blank">'+((__t=taskName)==null?"":__t)+"</a>\n			"}__p+='\n			<b class="icos_tfb">\n				';if(counter.taskTotal>0){__p+='\n					<span class="icon-plan-task item_icon_tfb" original-title="有任务"></span>\n					<span>'+((__t=counter.taskTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.businessTripTotal>0){__p+='\n					<span class="icon-plan-trip item_icon_tfb" original-title="有出差"></span>\n					<span>'+((__t=counter.businessTripTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.experienceTotal>0){__p+='\n					<span class="icon-plan-summarize item_icon_tfb" original-title="有进展"></span>\n					<span>'+((__t=counter.experienceTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.meetTotal>0){__p+='\n					<span class="icon-plan-meeting item_icon_tfb" original-title="有会议"></span>\n					<span>'+((__t=counter.meetTotal)==null?"":__t)+"</span>\n				"}__p+="\n				";if(counter.attachmentTotal>0){__p+='\n					<span class="tu-icon-cus-fujian item_icon_tfb" original-title="有附件"></span>\n					<span>'+((__t=counter.attachmentTotal)==null?"":__t)+"</span>\n				"}__p+='\n			</b>\n		</div>\n	</dt>\n	<dd>\n		<div class="label_tfb" data-name="feed-lable">\n			';if(labelType==4){__p+='\n			<span class="icon-work-small ico_tfb"></span>\n			'}else if(labelType){__p+='\n			<span class="icon-app-micro-'+((__t=labelType)==null?"":__t)+' ico_tfb"></span>\n			'}__p+="<span>"+((__t=labelName)==null?"":__t)+'</span>\n		</div>\n		<span class="des_tfb">';if(!description){__p+="暂无描述"}else{__p+=(__t=description)==null?"":__t}__p+="</span>\n	</dd>\n</dl>\n\n"}return __p};this["JST"]["feed/feed-track"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="hr_fb">\n	<div class="left_hr"></div>\n	<div class="line_hr"></div>\n	<div class="right_hr"></div>\n</div>\n<div class="track_fb tu-font-a2">\n	';if(total>defaultCount){__p+='\n	<div class="total_fl tu-ft_m3 tu-ft_c3 tu-ft-hv_c3" data-name="task-track-slide">\n		';if(taskTrackShowAll){__p+='\n		<b class="ico_tfl tu-icon-angles-up">\n			全部操作&nbsp;<span data-name="feed-comment-total-num">'+((__t=total)==null?"":__t)+"</span>\n		</b>\n		"}else{__p+='\n		<b class="ico_tfl tu-icon-angles-down">全部操作&nbsp;<span data-name="feed-comment-total-num">'+((__t=total)==null?"":__t)+"</span></b>\n		"}__p+="\n	</div>\n	"}__p+="\n\n	<dl>\n		";_.each(comments,function(item,index){__p+='\n		<dd class="tu-font-a2 ';if(comments.length===1&&item.thisYeare){__p+="one_tkfb"}__p+='">\n			';if(item.year){__p+='\n			<div class="year_tkfb tu-cf tu-pt-5">\n				<span class="year-ico_tkfb tu-ft_f4 tu-bg_success-light tu-dib tu-tac">'+((__t=item.year)==null?"":__t)+'年</span>\n				<div class="line_tkfb tu-bg_m4"></div>\n				<span class="dot_tkfb tu-bd_f4 tu-dib tu-bg_m8"></span>\n			</div>\n			'}__p+="\n			";_.each(item.data,function(iData,idx){__p+='\n			<div class="item_tkfb tu-cf tu-pt-5 ';if(isLatest&&index==comments.length-1&&idx==item.data.length-1){__p+="latest_tkfb"}__p+='">\n				<div class="left_tkfb tu-fl">\n					';if(iData.f_month){__p+='<span class="date_tkfb tu-ft_m3">'+((__t=iData.f_month)==null?"":__t)+"</span>"}__p+='<span class="tu-ft_m2">'+((__t=iData.f_time)==null?"":__t)+'</span>\n				</div>\n				<div class="cont_tkfb tu-ml-20">\n					<span class="dot_tkfb tu-bg_m4 tu-dib"></span>\n					<span class="tu-ft_m1">'+((__t=_.substringWithM(iData.publishUser.name,12,true))==null?"":__t)+'</span>&nbsp;<span class="tu-ft_m2">'+((__t=iData.content)==null?"":__t)+"</span>\n\n					";if(iData.attachments&&iData.attachments.length){__p+="\n						<span>附件：</span>\n						";_.each(iData.attachments,function(fileItem){__p+='\n							<a href="'+((__t=fileItem.downloadUrl)==null?"":__t)+'">'+((__t=fileItem.fileName)==null?"":__t)+"</a>\n						"});__p+="\n					"}__p+="\n				</div>\n				";if(comments.length==1&&item.thisYeare&&item.data.length==1){__p+="\n				\n				"}else{__p+='\n					<div class="line_tkfb tu-bg_m4 ';if(index==comments.length-1&&idx==item.data.length-1){__p+="line-last_tkfb"}__p+="  ";if(comments.length===1&&item.thisYeare&&idx==0){__p+="one-line_tkfb"}__p+='""></div>\n				'}__p+="\n			</div>\n			"});__p+="\n			\n			\n		</dd>\n		"});__p+="\n		\n	</dl>\n</div>"}return __p};this["JST"]["feed/feed-type12"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(app.appObj){__p+='\n<dl class="cont_wfb">\n	<dt>\n		<div class="type_wfb"><span>'+((__t=app.appObj.appObjName)==null?"":__t)+"</span></div>\n		<div>\n			";if(app.appObj.appObjUrl&&app.appObj.appObjUrl!=""){__p+='\n				<a href="'+((__t=app.appObj.appObjUrl)==null?"":__t)+'" class="name_wfb" data-name="feed-task-name" target="_blank">'+((__t=app.appObj.appObjTitle)==null?"":__t)+"</a>\n			"}else{__p+='\n				<span class="name_wfb" data-name="feed-task-name">'+((__t=app.appObj.appObjTitle)==null?"":__t)+"</span>\n			"}__p+="\n		</div>\n	</dt>\n</dl>\n"}__p+="\n\n"}return __p};this["JST"]["feed/feed-type8"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(app.appObj){__p+='\n<dl class="cont_wfb">\n	<dt>\n		<div class="type_wfb"><span>'+((__t=app.appObj.appObjName)==null?"":__t)+"</span></div>\n		<div>\n			";if(app.appObj.appObjUrl&&app.appObj.appObjUrl!=""){__p+='\n				<a href="'+((__t=app.appObj.appObjUrl)==null?"":__t)+'" class="name_wfb" data-name="feed-task-name" target="_blank">'+((__t=app.appObj.appObjTitle)==null?"":__t)+"</a>\n			"}else{__p+='\n				<span class="name_wfb" data-name="feed-task-name">'+((__t=app.appObj.appObjTitle)==null?"":__t)+"</span>\n			"}__p+="\n		</div>\n	</dt>\n</dl>\n"}__p+="\n\n"}return __p};this["JST"]["feed/feed-type9"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="right_wfb">\n\n	<div class="person_wfb">\n		';if(typeof obj!=="principalUser"&&principalUser){__p+="\n		当前处理人："+((__t=_.substringWithM(principalUser.name,12,true))==null?"":__t)+"\n		"+((__t=_.convertImage({className:"avatar_small_fl",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,bgColor:principalUser.avatar.color,userId:principalUser.userId}))==null?"":__t)+"\n		"}__p+='\n	</div>\n</div>\n\n<dl class="cont_wfb">\n	<dt>\n		<div class="type_wfb">'+((__t=app&&app.appObj.appObjName)==null?"":__t)+'</div>\n		<div class="title_wfb">\n			';if(app&&app.appObj&&app.appObj.appObjUrl){__p+='\n			<a href="'+((__t=app&&app.appObj.appObjUrl)==null?"":__t)+'" class="name_tfb" data-name="feed-task-name" target="_blank">'+((__t=app&&app.appObj.appObjTitle)==null?"":__t)+"</a>\n			"}else{__p+='\n			<span class="name_tfb" data-name="feed-task-name" >'+((__t=app&&app.appObj.appObjTitle)==null?"":__t)+"</span>\n			"}__p+='\n		</div>\n	</dt>\n	<dd data-name="feed-work-flow">\n		\n		\n	</dd>\n</dl>\n\n'}return __p};this["JST"]["feed/feed-work"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="right_wfb">\n\n	<span class="status_wfb icon-status-'+((__t=status)==null?"":__t)+'"></span>\n	<div class="person_wfb">\n		';if(counter.workTimeTotal>0){__p+='\n		<b class="hour_wfb">\n			<span class="icon-work-hour-small"></span>\n			'+((__t=counter.workTimeTotal)==null?"":__t)+"\n		</b>\n		"}__p+="\n		";if((principalUser&&principalUser.userId)!=publishUser.userId){__p+="\n			\n				"+((__t=_.convertImage({className:"avatar_small_fl",src:publishUser.avatar.small,size:30,shape:"radius",name:publishUser.name,bgColor:publishUser.avatar.color,userId:publishUser.userId}))==null?"":__t)+"\n			\n			";if(app&&app.appId==901){__p+="提交给"}else{__p+="安排给"}__p+="\n		"}else{__p+="\n		负责人："+((__t=_.substringWithM(principalUser.name,12,true))==null?"":__t)+"\n		"}__p+="\n		\n		"+((__t=_.convertImage({className:"avatar_small_fl",src:principalUser.avatar.small,size:30,shape:"radius",name:principalUser.name,bgColor:principalUser.avatar.color,userId:principalUser.userId}))==null?"":__t)+'\n		\n	</div>\n	<div class="time_wtb">\n		';if(!evaluation&&status!="2"){__p+="\n			";if(typeof isLongTerm!=="undefined"&&isLongTerm){__p+="\n			长期"}else{__p+=(__t=date)==null?"":__t}__p+="\n		"}else{__p+="\n			"+((__t=evaluation)==null?"":__t)+"\n		"}__p+='\n	</div>\n</div>\n\n<dl class="cont_wfb">\n	<dt>\n		<div class="type_wfb">'+((__t=labIcoType.text)==null?"":__t)+'</div>\n		<div>\n			<a href="'+((__t=webHost.host)==null?"":__t)+""+((__t=obj&&obj.objUrl+(workType==6?"&workType=6":""))==null?"":__t)+'" class="name_tfb" data-name="feed-task-name" target="_blank">'+((__t=workName)==null?"":__t)+'</a>\n		\n		</div>\n	</dt>\n	<dd>\n		<span class="des_wfb">';if(!description){__p+="暂无描述"}else{__p+=(__t=description)==null?"":__t}__p+="</span>\n	</dd>\n</dl>\n\n";if(!app){__p+='\n<ul class="info_wfb">\n	<li>起止时间：'+((__t=startDate)==null?"":__t)+" - ";if(workType==2){__p+="长期"}else{__p+=(__t=deadline)==null?"":__t}__p+="</li>\n	";if(typeof progress!=="undefined"){__p+='\n	<li>进度：<span class="progress-bar"><div class="progress-value tu-clearfix" style="width:'+((__t=progress)==null?"":__t)+'">';if(progress!="0%"&&progress!="100%"){__p+='<span class="progress-slider"></span>'}__p+='</div></span><span class="progress-num">'+((__t=progress)==null?"":__t)+"</span></li>\n	"}__p+="\n</ul>\n"}__p+="\n\n"}return __p};this["JST"]["feed/search-form"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<form>\r\n<div class="input-default">\r\n	<a href="javascript:void(0);" title="" class="button_sfl" data-type="submit-content" ><span class="icon-search"></span></a>\r\n	<input type="text" data-type="new-content" autocomplete="off" />\r\n</div>\r\n</form>'}return __p};this["JST"]["img-preview/img-preview-content-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="img_ip">\n	<div class="img_border"></div>\n	<img src="'+((__t=smallUrl)==null?"":__t)+'" >\n	\n</div>'}return __p};this["JST"]["img-preview/img-preview-content"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="bg_ip" data-name="img-preview-overlay" style="width:'+((__t=dialogW)==null?"":__t)+"px;height:"+((__t=dialogH)==null?"":__t)+'px"></div>\n<div class="wrap_ip">\n	<div data-name="img-preview-info"></div>\n	<div class="contant_ip">\n		<div class="origin_ip">\n			';if(thumbListLen>1){__p+='\n				\n				<span class="tu-icon-angle-left left_oip"  data-name="origin-left" style="margin-top:'+((__t=originPageTop)==null?"":__t)+"px;";if(thumbIndex==0){__p+="display: none;"}__p+='"></span>\n				\n				<span class="tu-icon-angle-right right_oip" data-name="origin-right" style="margin-top:'+((__t=originPageTop)==null?"":__t)+"px;";if(thumbListLen==thumbIndex+1){__p+="display: none;"}__p+='"></span>\n			'}__p+='\n			<div class="see_ip" data-name="origin-box">\n				<img src="" data-name="origin-img">\n			</div>\n			<div class="visible-area" data-name="visible-area"></div>\n		</div>\n		<div class="thumbnail_ip">\n			<div class="action_tip" data-name="thumb-pre"><span class="tu-icon-arrow-up"></span></div>\n			<div class="list_tip" data-name="thumb-list-box">\n				<ul data-name="thumb-list">\n				</ul>\n			</div>\n			<div class="action_tip" data-name="thumb-next"><span class="tu-icon-arrow-down"></span></div>\n		</div>\n	</div>\n</div>\n\n'}return __p};this["JST"]["img-preview/img-preview-info"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<span class="name_ip">'+((__t=fileName)==null?"":__t)+'</span>\n<ul class="action_ip">\n	<li class="action_ip_item img-zoom" data-name="img-zoom" data-zoom-type="In"><a href="javascript:;"><span class="tu-icon-f-enlarge icon-circle" data-name="icon-circle"></span><span data-name="icon-fn-name">查看原图</span></a></li>\n	<li class="action_ip_item"><a href="'+((__t=downloadUrl)==null?"":__t)+'"><span class="tu-icon-download icon-circle"></span>下载</a></li>\n	<li class="action_ip_item" data-name="img-close"><a href="javascript:;"><span class="tu-icon-close icon-close"></span></a></li>\n</ul>'}return __p};this["JST"]["img-preview/img-preview-visible-area"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="visible-img-wrap" data-name="visible-img-wrap"></div>\n<div class="visible-layer">\n	<div class="visible-layer-item visible-layer-left" data-name="visible-layer-left"></div>\n	<div class="visible-layer-item visible-layer-top" data-name="visible-layer-top"></div>\n	<div class="visible-layer-item visible-layer-right" data-name="visible-layer-right"></div>\n	<div class="visible-layer-item visible-layer-bottom" data-name="visible-layer-bottom"></div>\n	<div class="visible-scope" data-name="visible-scope"></div>\n</div>'}return __p};this["JST"]["img-preview/img-preview"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+=""}return __p};this["JST"]["membership/membership-tab-component"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="membership_right">\n	<div class="membership_tab_top">\n			<ul class="membership_tab_title">\n				<li data-name="membership" data-trigger="false" data-body="团队">\n					<span class="membership_icon_st"></span>\n					<a href="javascript:void(0)">团队</a>\n				</li>\n				\n				';if(showShare){__p+='\n				<li data-name="share" data-trigger="false" data-body="共享">\n					<span class="membership_icon_share"></span>\n					<a href="javascript:void(0)">共享</a>\n				</li>\n				'}__p+='\n						\n			</ul>\n	</div>\n	<div class="rightBar__tip">\n		查看下属工作，戳这里\n		<img class="tu-ml-10" src="//xfile5.tita.com/ux/tita-web-v4/release/app/extras/images/deSe.png" />\n		<div class="right-arrow"></div>\n	</div>\n	<div class="membership_arrow membership_arrow_left">\n		<span class="membership_arrow_icon"></span>\n		<span class="membership_arrow_line"></span>\n	</div>\n	<div id="membership_tab"></div>\n</div>'}return __p};this["JST"]["membership/membership-tab-composite"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<li class="membership_item_container" style="position:relative" data-id='+((__t=Id)==null?"":__t)+" level="+((__t=level)==null?"":__t)+">\n	";if(level==3){__p+='\n		<div class="membership_item_long membership_item_level_'+((__t=level)==null?"":__t)+" ";if(Type==1){__p+=" membership_item_dashed"}__p+='">\n			<div class="membership_image_container">\n				'+((__t=_.convertImage({className:"membership_image_large",shape:"radius",size:50,src:UserAvatar.Medium,name:Name,bgColor:UserAvatar.Color}))==null?"":__t)+"\n				";if(subordinateCount>0&&!Type){__p+='\n					<div class="membreship_subordinate_btn">\n						<span></span>\n					</div>\n				'}__p+='\n			</div>\n			<div class="membership_span_container">\n				<span class="item_long_name" title='+((__t=Name)==null?"":__t)+">"+((__t=subName)==null?"":__t)+'</span>\n				<span class="item_long_position" title='+((__t=Department)==null?"":__t)+">部门："+((__t=Department)==null?"":__t)+"</span>\n				";if(Position){__p+='<span class="item_long_description" title='+((__t=Position)==null?"":__t)+">职位："+((__t=Position)==null?"":__t)+"</span>"}__p+='\n			</div>\n			<div class="membership_line membership_line_level'+((__t=level)==null?"":__t)+' ">\n			</div>\n		</div>\n	'}else{__p+="\n		";if(Id!=0){__p+='\n			<div class="membership_item_short  membership_item_level_'+((__t=level)==null?"":__t)+'">\n				'+((__t=_.convertImage({className:"membership_image_short",shape:"radius",size:30,src:UserAvatar.Small,name:Name,bgColor:UserAvatar.Color}))==null?"":__t)+"\n				\n				<span>"+((__t=subName)==null?"":__t)+'</span>\n				<div class="membership_line membership_line_level'+((__t=level)==null?"":__t)+' ">\n				</div>\n			</div>\n		'}else{__p+="\n			<div></div>\n		"}__p+='\n		<div class="membership_subordinate_container"></div>\n	'}__p+="\n</li>"}return __p};this["JST"]["membership/membership-tab-layout"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="membership_back">\n	<div class="membership_back_btn">\n		返回最上级\n	</div>\n</div>\n<div class="membership_tab_staff_container"  id="membership_scroll_container">\n	\n</div>'}return __p};this["JST"]["membership/membership-tab-limits-tip"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="membership_none_limit_tip">\r\n	<div class="title_mnlt">隔级查看是什么</div>\r\n	<p class="text_mnlt">所谓隔级查看，就是管理者可以一层一层向下盘点。比如老板可以看到一线员工的'+((__t=i18n.plan_1)==null?"":__t)+'和任务执行情况、简档、工作报表、动态等。该功能为管理者快速查看间接下级的工作提供便利，从整体上把控现状，让管理更加深入细致，同时也对员工工作起到监督作用。<br/>\r\n	如下图所示，该租户开通了隔级查看后，纪小国可通过张小庆查看到他的下属罗小翀的全部状况。</p>\r\n	<div class="img_mnlt">\r\n		<img src="'+((__t=imgUrl)==null?"":__t)+'" alt="" />\r\n	</div>\r\n	<br/><br/>\r\n</div>'}return __p};this["JST"]["membership/membership-tab-thumb-composite"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div id="membership_scroll_container">\n	<ul class="membership_thumb_container"></ul>\n</div>'}return __p};this["JST"]["membership/membership-tab-thumb-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(mode=="wide"){__p+="\n	"+((__t=_.convertImage({className:"membership_thumb_img",shape:"radius",size:50,src:UserAvatar.Small,name:Name,bgColor:UserAvatar.Color}))==null?"":__t)+"\n"}else{__p+="\n	"+((__t=_.convertImage({className:"membership_thumb_img",shape:"radius",size:30,src:UserAvatar.Small,name:Name,bgColor:UserAvatar.Color}))==null?"":__t)+"\n"}__p+="\n"}return __p};this["JST"]["membership/membership-tip-limits"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="membership_askfor">\r\n	<p class="tiptext">您的企业尚未开通 <br />隔级查看功能</p>\r\n	<p class="gohelp"><a href="javascript:void(0);" title="">什么是隔级查看？</a></p>\r\n	<a href="javascript:void(0);" title="" class="btn btn-success" data-type="askForButton">立即申请开通</a>\r\n\r\n	<p class="concat">如有任何问题，请咨询在线客服 <br />或拨打 <strong>400 650 3180</strong></p>\r\n</div>\r\n<div class="membership_askfor_success">\r\n	<p class="tiptext"><span class="ico"></span><span>已经提交申请</span></p>\r\n	<p class="comfort">我们会尽快审核，审核通过后，<br />tita客服会联系帮您开通，请耐心等待！</p>\r\n</div>'}return __p};this["JST"]["multiple-task-list/multiple-task-list-composite"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(combineName){__p+='\n	<div class="tu-ft_m3 tu-font-a2 project-lotSize__task-milepost-name">'+((__t=combineName)==null?"":__t)+"</div>\n"}__p+='\n<ul class="project-lotSize__task-list"></ul>'}return __p};this["JST"]["multiple-task-list/multiple-task-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<!-- 未接受，已完成审批中任务置灰显示 status 2 已完成，status 5 未接受 isApply 审批中-->\n<li class="tu-clearfix tu-font-a1 tu-ft_m1 tu-por project-lotSize__task_border project-lotSize__task-li">\n	<div class="'+((__t=checked?checkedIcons.checked:checkedIcons.unchecked)==null?"":__t)+" "+((__t=isApply&&listSpecialStyle?"icon-gray":"tu-cp")==null?"":__t)+'  project-lotSize__task-grid-checked project-lotSize__task-grid-checked-lineHeight" '+((__t=isApply&&listSpecialStyle?'data-body="审批中不可操作"':'data-name="changeCheck"')==null?"":__t)+' ></div>\n	<div class="project-lotSize__task-grid-name tu-ft_m3">\n		\n		';

if(level>2){__p+="\n			";for(var i=0;i<2*(level-2);i++){__p+='\n				<a href="javascript:void(0)" class="project-lotSize__task-icon-empty"></a>\n			'}__p+="\n		"}__p+="\n\n		";if(level!=1){__p+='\n			<span class="tu-icon-fold-arrow project-lotSize__task-icon_size tu-pl-20"></span>\n		'}__p+="\n		<!-- 只显示5层 -->\n		";if(hasSubTask&&level<5){__p+="\n			";if(showChildren){__p+='\n				<span class="tu-icon-pack-up tu-ft_m3 tu-cp project-lotSize__task-icon_size" data-name="hideChildern"></span>\n			'}else{__p+='\n				<span class="tu-icon-open tu-ft_m3 tu-cp project-lotSize__task-icon_size" data-name="showChildern"></span>\n			'}__p+="\n		"}else{__p+='\n			<a href="javascript:void(0)" class="project-lotSize__task-icon-empty"></a>\n		'}__p+="\n		";if(isApply&&listSpecialStyle){__p+='\n			<span class="icon-approval tu-poa"></span>\n		'}__p+="\n		";if(showTip){__p+='\n		<a href="'+((__t=host)==null?"":__t)+"id="+((__t=taskId)==null?"":__t)+'" data-body="'+__e(taskName)+'"\n		'}else{__p+='\n		<a href="'+((__t=host)==null?"":__t)+"id="+((__t=taskId)==null?"":__t)+'"\n		'}__p+='\n		<a href="'+((__t=host)==null?"":__t)+"id="+((__t=taskId)==null?"":__t)+'" '+((__t=showTip?'data-body="'+rawTaskName+'"':"")==null?"":__t)+'  class="project-lotSize__task-name '+((__t=(status==2||status==5||isApply)&&listSpecialStyle?"tu-ft_m3":"tu-ft_c2")==null?"":__t)+' " target="_blank">\n			'+((__t=taskName)==null?"":__t)+'\n		</a>\n	</div>\n	<div class="project-lotSize__task-grid-status '+((__t=(status==2||status==5||isApply)&&listSpecialStyle?"tu-ft_m3":"tu-ft_m1")==null?"":__t)+'">'+((__t=statusName)==null?"":__t)+'</div>\n	<div class="project-lotSize__task-grid-status '+((__t=(status==2||status==5||isApply)&&listSpecialStyle?"tu-ft_m3":"tu-ft_m1")==null?"":__t)+'">'+((__t=_.substring(principalUser.name,6,true))==null?"":__t)+'</div>\n	<div class="project-lotSize__task-grid-startTime '+((__t=(status==2||status==5||isApply)&&listSpecialStyle?"tu-ft_m3":"tu-ft_m1")==null?"":__t)+'">'+((__t=startDate)==null?"":__t)+"</div>\n	";if(!isLongTerm){__p+='\n	<div class="project-lotSize__task-grid-EndTime '+((__t=(status==2||status==5||isApply)&&listSpecialStyle?"tu-ft_m3":"tu-ft_m1")==null?"":__t)+'">'+((__t=deadLine)==null?"":__t)+"</div>\n	"}else{__p+='\n	<div class="project-lotSize__task-grid-EndTime '+((__t=(status==2||status==5||isApply)&&listSpecialStyle?"tu-ft_m3":"tu-ft_m1")==null?"":__t)+'">长期</div>\n	'}__p+='\n</li>\n<ul class="project-lotSize__task-childern '+((__t=showChildren?"tu-db":"tu-dn")==null?"":__t)+'" data-name="task-childern"></ul>\n'}return __p};this["JST"]["multiple-task-list/multiple-task-list-main"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<ul class="tu-ml-5">\n	<li class="tu-clearfix tu-ft_m2 tu-font-a2 project-lotSize__task-header tu-mt-15 tu-pb-5">\n		';if(multiple){__p+='\n			<div class="'+((__t=allCheckedState?"tu-icon-check-active":"tu-icon-checkbox-have")==null?"":__t)+' project-lotSize__task-grid-checked tu-cp" data-name="changeAllCheck"></div>\n		'}else{__p+='\n			<div class="project-lotSize__task-grid-checked project-lotSize__task-grid-checked-height tu-cp"></div>\n		'}__p+='\n		<div class="project-lotSize__task-grid-name tu-pl-20">任务名称</div>\n		<div class="project-lotSize__task-grid-status">状态</div>\n		<div class="project-lotSize__task-grid-status">负责人</div>\n		<div class="project-lotSize__task-grid-startTime">开始时间</div>\n		<div class="project-lotSize__task-grid-EndTime">结束时间</div>\n	</li>\n	<ul class="project-lotSize__task-milepost">\n		\n	</ul>\n</ul>'}return __p};this["JST"]["operation-status/operation-status"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n  <!-- <div class="tu-dropdown">   -->\n	<ul class="tu-dropdown-menu">\n		<li status="2" class="tu-menuitem">\n			<span class="tu-icon-check-active changestatusview__ico">已完成</span>\n		</li>\n		<li status="1" class="tu-menuitem">\n			<span class="tu-icon-ing changestatusview__ico">进行中</span>\n		</li>\n		<li status="4" class="tu-menuitem">\n			<span class="tu-icon-cross2 changestatusview__ico">已取消</span>\n		</li>\n		<li status="3" class="tu-menuitem">\n			<span class="tu-icon-delay changestatusview__ico">已延迟</span>\n		</li>\n		<li status="6" class="tu-menuitem">\n			<span class="tu-icon-pause changestatusview__ico">暂停中</span>\n		</li>\n		<li status="0" class="tu-menuitem">\n			<span class="tu-icon-checkbox-have changestatusview__ico">未开始</span>\n		</li>\n	</ul>\n <!-- </div>  -->\n'}return __p};this["JST"]["private-range/private-range"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="qunartip-view">\n	<ul>\n		';_.each(data,function(item){__p+="\n			";if(item.type=="public"){__p+='\n				<li class="public_qunat active" id="1" data-visibility="1" >'+((__t=item.name)==null?"":__t)+"</li>\n			"}else if(item.type=="department"){__p+='\n				<li class="private_qunat ';if(depId==0){__p+="disabled"}__p+='" id="3" objId="'+((__t=depId)==null?"":__t)+'" objType="15" data-visibility="2" >'+((__t=departmentOptions.name)==null?"":__t)+"</li>\n			"}else{__p+='\n				<li class="private_qunat" id="2" data-visibility="2" >'+((__t=privateOptions.name)==null?"":__t)+"</li>\n			"}__p+="\n		"});__p+="\n	</ul>\n</div>"}return __p};this["JST"]["publish-dynamic/publish-mblog"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\r\n<div class="box_pm" data-name="mblog-box">\r\n	<div class="content_pm input_default" data-name ="new-content-wrap">\r\n		';if(defaultValue){__p+='\r\n			<div><label data-name="new-defaultvalue">'+((__t=defaultValue)==null?"":__t)+"</label></div>\r\n		"}__p+='\r\n		<div class="input_pm">\r\n			<textarea  data-name="new-content" style="resize:none;">'+((__t=value)==null?"":__t)+'</textarea>\r\n		</div>\r\n		<div class="count_pm">\r\n			';if(isLimit){__p+='\r\n				<div class="num_pm" data-name="count">\r\n					您已输入 <span data-name="count_num"> '+((__t=total)==null?"":__t)+" </span>字，最多可输入 "+((__t=maxlength)==null?"":__t)+"\r\n				</div>\r\n			"}__p+='\r\n		</div>\r\n	</div>\r\n	<div class="action_pm tu-clearfix">\r\n		<ul class="list_pm">\r\n			';if(isShowAttachment){__p+='\r\n			<li class="ament_pm uploader_container" data-name="reference-node">\r\n				<a href="javascript:;" class="ament_pm-a" data-name="file"></a>\r\n			</li>\r\n			'}__p+="\r\n			";if(isShowAt){__p+='\r\n			<li class="at_pm" data-name="at">\r\n				<span class="tu-icon-at"></span>\r\n				<span class="btn-txt">'+((__t=atText)==null?"":__t)+"</span>\r\n			</li>\r\n			"}__p+="\r\n			";if(WorkExternal){__p+="\r\n				";if(isShowAtExtend){__p+='\r\n					<li class="atall_pm" data-name="atExtend">\r\n						<span class="tu-icon-at"></span>\r\n						<span class="btn-txt">'+((__t=atExtendText)==null?"":__t)+"</span>\r\n					</li>\r\n					"}__p+="\r\n				"}__p+="\r\n			";if(isShowAtAll){__p+='\r\n			<li class="atall_pm" data-name="atall">\r\n				<span class="tu-icon-at"></span>\r\n				<span class="btn-txt">'+((__t=atAllText)==null?"":__t)+"</span>\r\n			</li>\r\n			"}__p+="\r\n			\r\n\r\n			";if(isShowEmotion){__p+='\r\n			<li class="emotion_pm" data-name="emotion">\r\n				<span class="tu-icon-emoji"></span>\r\n				<span class="btn-txt">'+((__t=emotionText)==null?"":__t)+"</span>\r\n			</li>\r\n			"}__p+="\r\n\r\n			";if(isShowShang){__p+='\r\n				<li class="dashang_pm" data-name="dashang" data-body="'+((__t=dashangText)==null?"":__t)+'">\r\n					<span class="tu-icon-dashang"></span>\r\n					<span class="btn-txt">'+((__t=dashangText)==null?"":__t)+"</span>\r\n				</li>\r\n			"}__p+='\r\n		</ul>\r\n		<div class="right-btn_pm">\r\n			';if(isShowSendSms){__p+='\r\n				<span class="pub_message" data-name="mblog-sms">\r\n					<span class="tu-icon-checkbox-have checkbox-icon" data-name="mblog-sms-input"></span>\r\n					<span  data-name="mblog-sms-text">短信通知</span>\r\n				</span>\r\n			'}__p+="\r\n			";if(isShowRange){__p+='\r\n			<span class="quna_pm" id="1" isvisible="0" data-name="range"><span data-name="range-cont">'+((__t=privateText)==null?"":__t)+'</span><i class="tu-icon-sort-down range-cont-icon tu-ft_m3" data-name="range-caret"></i></span>\r\n			'}__p+='\r\n			<button class="cancel_pm" data-name="cancel">取消</button>\r\n			<button class="tu-btn tu-btn-small tu-btn-sure disabled" data-name="submit">'+((__t=submitText)==null?"":__t)+'</button>\r\n		</div>\r\n		\r\n	</div>\r\n	<div id="attachmentViewBox_homeMblog" class="error_container"></div>\r\n	<div id="attachmentViewBox_homeMblog" class="preview_container"></div>\r\n	<div id="attachmentViewBox_homeMblog" class="loading_container"></div>\r\n</div>\r\n'}return __p};this["JST"]["publish-dynamic/publist-mblog-toreply"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<span>回复</span>&nbsp;<span class="closed_pm" data-name="to-reply-closed">'+((__t=toUserName)==null?"":__t)+'&nbsp;<span class="tu-icon-cross"></span></span>'}return __p};this["JST"]["pull-screen/push-screen-app"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+=""}return __p};this["JST"]["pull-screen/push-screen-layout"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='	\n	<div class="action" data-name="pull-screen-action">\n		<span class="close-pull-screen tu-icon-cross2" data-name="pull-screen-close"></span>\n		';if(showFullScreenButton){__p+='\n		<a href="javascript:void(0);" class="open-screen tu-icon-fullscreen" data-name="open-full-screen-button" target="_blank"></a>\n		'}__p+='\n		\n	</div>\n	<div data-name="pull-screen-content">\n		<iframe src="" width="100%" frameborder="0"  style="display:none" data-name="pull-screen-iframe"></iframe>\n	</div>\n	<div data-name="pull-screen-load"></div>\n'}return __p};this["JST"]["reward/reward-detail-userlist-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+=((__t=_.convertImage({className:"avatar-item",src:user.avatar.small,size:30,shape:"radius",name:user.name,bgColor:user.avatar.color}))==null?"":__t)+"\n"}return __p};this["JST"]["reward/reward-detail-userlist"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n    <div class="title"><span>共收到 '+((__t=totalCount)==null?"":__t)+' 次打赏 来自以下的人</span></div>\n    <div class="all-user" data-name="user-list">\n    ';if(beyond){__p+='<span class="more" data-name="more">…</span>'}__p+="\n	</div>\n"}return __p};this["JST"]["reward/reward-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+=""}return __p};this["JST"]["reward/reward-give"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(payStatus==0){__p+='\n<div class="reward-app-content">\n	<span class="reward-close" data-name="close"></span>\n	<div class="cont-box">\n		<!-- 头像 -->\n		<div class="head-wrap" data-name="head-box">\n\n			';if(isEditUser==true&&rewardType=="give"&&isShowOtherBtn){__p+='\n				<a href="javascript:;" class="user-others" data-name="others">打赏给其他成员?</a>\n			'}__p+="\n			";if(isEditUser){__p+='\n			<span class="ico-edit-pen" data-name="ico-change-user"></span>\n			'}__p+='\n			<div class="user-avatar" data-name="change-user">\n				';if(user&&user.userId){__p+=" \n					"+((__t=_.convertImage({className:"",src:user.avatar.medium,size:80,shape:"radius",name:user.name,bgColor:user.avatar.color}))==null?"":__t)+"\n				"}else{__p+='\n					<span class="none-user radius_img80"></span>\n				'}__p+='\n			</div>\n			<div data-name="user-name" class="user-name">'+((__t=_.TitaWidget_substring(user.name,14,true))==null?"":__t)+"</div>\n			\n		</div>\n		";if(stage==1){__p+='\n			<div class="contet-area" data-name="part-first">\n			\n			';if(rewardType=="give"){__p+='\n				<div class="input-wrap">\n					<span class="ico-refresh" data-name="refresh"></span>\n					<div class="error-tip" data-name="error-tip">单笔赏金不能超过'+((__t=maxMoney)==null?"":__t)+'元</div>\n					<input type="text" data-name="set-money" value="" maxlength="6" autocomplete="off">\n				</div>\n				<form action="">\n				<div class="input-wrap">\n					<textarea type="text" data-name="intro" maxlength="20" value="" autocomplete="off"></textarea>\n					<div class="total"><span class=\'num\' data-name="num">0</span>/20</div>\n				</div>	\n				</form>\n			'}else{__p+='\n				<div class="input-wrap">\n					<textarea class="beg-intro" data-name="intro" maxlength="20" autocomplete="off"></textarea>\n					<div class="total"><span class=\'num\' data-name="num">0</span>/20</div>\n					<div class="additional">打赏一个呗</div>\n					<span class="ico-refresh"  data-name="refresh"></span>\n				</div>\n\n			'}__p+='\n			\n			</div>\n			<button class="reward-button ';if(!user||!user.userId){__p+="disabled"}__p+=' " data-name="submit-btn">';if(rewardType=="give"){__p+="下一步"}else{__p+="向ta讨赏"}__p+="</button>\n			";if(rewardType=="give"){__p+='\n				<a href="'+((__t=capitalManageUrl)==null?"":__t)+'" target="_blank" class="capital-manage-url">去提现</a>\n			'}__p+="\n			\n		"}else{__p+='\n			<div class="code-wrap"  data-name="part-second">\n				<p class="money-all">￥'+((__t=money)==null?"":__t)+'</p>\n				<div class="wx-img">\n					<div class="reward-loading"  data-name="erwerma">\n						<img src="" alt="" width="150" height="150">\n						<p>二维码搬运中，请稍后</p>\n					</div>\n					<div class="wx-img-error"  data-name="erwerma-tip">\n						<span></span>\n						<p>搬运失败，请点击重新生成</p>\n					</div>\n				</div>\n				<div class="scanning-tip">\n					<span>请打开微信扫一扫</span>打赏无悔，赏金概不退款哦~\n				</div>\n			</div>\n		'}__p+="\n	</div>\n</div>\n"}else if(payStatus==1){__p+='\n	<div class="reward-pay-success">\n		<span class="close-pay"  data-name="close"></span>\n		<div class="tip">打赏成功</div>\n		<div class="txt">有了你的鼓励, Ta 一定会十二分努力哒</div>\n	</div>\n'}else if(payStatus==-1){__p+='\n	<div class="reward-pay-fail">\n		<span class="close-pay"  data-name="close"></span>\n		<div class="tip">打赏失败</div>\n	</div>\n'}}return __p};this["JST"]["reward/reward-user-select-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+="\n"+((__t=_.convertImage({className:"avatar_small_fl",src:avatar.Medium,size:30,shape:"radius",name:name,bgColor:avatar.Color}))==null?"":__t)+'\n\n<div class="name">'+((__t=name)==null?"":__t)+"</div>\n"}return __p};this["JST"]["reward/reward-user-select"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<span class="reward-caret-top"></span>\n<div class="reward-loading"></div>\n<ul class="clearfix">\n</ul>'}return __p};this["JST"]["search-sort-filter/drop-down-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(title=="baseline"){__p+='\n	<li class="baseline"></li>\n'}else{__p+='\n<li class="';if(itemActive){__p+="active"}__p+=" ";if(isMult){__p+="mult-item"}else{__p+="list-item"}__p+='" ';if(isMult){__p+="data-checked="+((__t=checked)==null?"":__t)}__p+=' data-name="list-item" data-title="'+((__t=title)==null?"":__t)+'" data-order="'+((__t=nowOrder)==null?"":__t)+'" ';if(showTip){__p+=' data-placement="top" data-toggle="infotip" data-body="'+((__t=tipTxt)==null?"":__t)+'"'}__p+=" >\n	";if(isMult){__p+='\n	<span class="check-box"><span class="tu-icon-check-active"></span><span class="tu-icon-checkbox-have"></span></span>\n	'}__p+="\n	"+((__t=title)==null?"":__t)+"\n	";if(order.length>1){__p+='\n		<span class="right-icon">\n			';_.each(order,function(el,index){__p+='\n				<span class="direction-icon ';if(activeOrder==el){__p+="active"}__p+=" ";if(index){__p+="tu-icon-simple-sort-up "}else{__p+="tu-icon-simple-sort-down"}__p+='"></span>\n			'});__p+="\n		</span>\n	"}__p+="\n</li>\n"}__p+="\n"}return __p};this["JST"]["search-sort-filter/drop-down-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(isMult){__p+='\n<div class="mult-box">\n	<div class="mult-all ';if(checkAll){__p+="active"}__p+='" data-name="checkall">\n		<span class="check-box"><span class="check-box-all tu-icon-check-active"></span><span class="check-box-all tu-icon-checkbox-have"></span></span>'+((__t=allCheckedName)==null?"":__t)+'\n	</div>\n	<ul class="mult-list"  data-name="list-container">\n		\n	</ul>\n</div>\n'}else{__p+='\n<div class="single-box">\n	<ul class="single-list" data-name="list-container">\n		\n	</ul>\n</div>\n'}__p+="\n\n";if(save&&activeOrder){__p+='\n	<div class="btn-box">\n		<button class="tu-btn tu-btn-mini tu-btn-sure" data-name="save-btn">记住排序</button>\n	</div>\n'}else if(isMult){__p+='\n	<div class="btn-box">\n		<button class="tu-btn tu-btn-small tu-btn-sure" data-name="mult-enter">确定</button>\n	</div>\n'}}return __p};this["JST"]["search-sort-filter/filter-result-group-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<span class="';if(!isValid&&isValid!=undefined){__p+="error"}__p+=' list-val tu-icon-">'+((__t=val)==null?"":__t)+'</span><a href="javascript:;" class="close-btn tu-icon-cross" data-name="close-btn"></a>'}return __p};this["JST"]["search-sort-filter/filter-result-group"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<dt class="result-group-tt" data-name="result-group-tt">'+((__t=groupTittle)==null?"":__t)+"</dt>\n<dd class=\"result-group-list\" data-name='result-group-list'></dd>\n"}return __p};this["JST"]["search-sort-filter/filter-result"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="filter-result-wrap tu-clearfix" data-name="filter-result-wrap"></div>'}return __p};this["JST"]["search-sort-filter/search-filter-tab-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){_.each(normalTabListData,function(item,index){__p+='\n	<li class="filter-tab-item" data-name="tab-item" data-tab-name="'+((__t=item.tabName)==null?"":__t)+'" data-leftlist="'+((__t=item.tabLeftLine)==null?"":__t)+'">\n	';if(item.tabName=="more"){__p+='\n		<span class="tu-icon-diot tab-more" data-name="tab-more-btn"></span>\n		<ul class="tt-new-filter-dropdownlist filter-more-tab " data-name="more-tab-list">\n			';_.each(item.moreData,function(i){__p+='\n				<li class="list-item" data-name="more-tab-list-item"  data-tab-name="'+((__t=i.tabName)==null?"":__t)+'">\n					'+((__t=i.tabTitle)==null?"":__t)+"\n				</li>\n			"});__p+="\n		</ul>\n	"}else{__p+='\n		<div class="filter-tab-item-wrap">\n			<span data-name="item-name" class="name">';if(item.tabTitle=="分类"&&!TaskLabel){__p+="项目"}else{__p+=(__t=item.tabTitle)==null?"":__t}__p+='</span>\n			<span class="icon tu-icon-sort-down"></span>\n		</div>\n	'}__p+="\n	</li>	\n"});__p+="\n";if(hasLeftlineTabListData.length){__p+='\n	<span class="group-line">|</span>\n	';_.each(hasLeftlineTabListData,function(item,index){__p+='\n		<li class="filter-tab-item" data-name="tab-item" data-tab-name="'+((__t=item.tabName)==null?"":__t)+'" data-leftlist="'+((__t=item.tabLeftLine)==null?"":__t)+'">\n			<div class="filter-tab-item-wrap">\n				<span data-name="item-name" class="name">'+((__t=item.tabTitle)==null?"":__t)+'</span>\n				<span class="icon tu-icon-sort-down"></span>\n			</div>\n		</li>	\n	'});__p+="\n"}}return __p};this["JST"]["search-sort-filter/search-filter-tab"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div data-name="filter-tab-list"></div>\n<div data-name="result-wrap"></div>'}return __p};this["JST"]["search-sort-filter/search-filter"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="filter-left-wrap" data-name="filter-tab-wrap"></div>\n<div class="filter-right-wrap tu-clearfix">\n	<div class="filter-seach__container" data-name="search-wrap"></div>\n	<div class="filter-orther-btn">\n		';if(chart.show){__p+='\n			<button class="tu-btn chart-btn" data-name="chart-btn"><span class="tu-icon-chart"></span></button>\n		'}__p+="\n	</div>\n</div>"}return __p};this["JST"]["search-sort-filter/search"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div data-name="search-box">\n	<div class="tu-input-default" data-name="search-body">\n	    <label class="placeholder" for="'+((__t=searchName)==null?"":__t)+'" data-name="placeholder">'+((__t=placeholder)==null?"":__t)+'</label>\n	    <input type="text" id="'+((__t=searchName)==null?"":__t)+'" data-name="input">\n	    <div class="right-action tu-clearfix">\n	        ';if(isShowDelete){__p+='<span class="tu-icon-close cancel-btn" data-name="cancel-btn"></span>'}__p+='\n	        <span class="tu-icon-search" data-name="search-btn"></span>\n	    </div>\n	</div>\n</div>\n'}return __p};this["JST"]["search-view/search"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<form>\n<div class="tu-input-default" data-name="search-body">\n    <label class="placeholder" for="'+((__t=searchName)==null?"":__t)+'" data-name="placeholder">'+((__t=placeholder)==null?"":__t)+'</label>\n    <input type="text" id="'+((__t=searchName)==null?"":__t)+'" data-name="input">\n    <div class="right-action tu-clearfix">\n        <span class="tu-icon-close cancel-btn" style="display: none;" data-name="cancel-btn"></span>\n        <span class="tu-icon-search" data-name="search-btn"></span>\n    </div>\n</div>\n</form>\n'}return __p};this["JST"]["set-notice/set-notice"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="tt-noticesetting__time tu-clearfix">\n	<span class="title">提醒时间</span>\n	<div class="tt-noticesetting__time-set">\n		<div class="tt-noticesetting__time-set-item">\n			<div class="tu-input-default" data-name="day-input">\n				<div class="input" cyctype="0" uservalue="'+((__t=today)==null?"":__t)+'" data-name="day-input-value">'+((__t=today)==null?"":__t)+'</div>\n				<div class="right-action tu-clearfix">\n					<span class="tu-icon-sort-down"></span>\n				</div>\n			</div>\n			<div class="tt-noticesetting__time-set-dropdown box-border" data-name="day-dropdown">\n				\n				<ul>\n					'+((__t=day7)==null?"":__t)+'\n					<li data-type="dropdown-item" label="其它日期" uservalue="0" class="other_nst " data-name="day-other">\n						<div class="inner underline">\n							其它日期 <span class="tu-icon-angle-right"></span>\n							\n						</div>\n					</li>\n					<li data-type="dropdown-item" class="everyday_nst" label="每天" uservalue="1" data-name="day-every-day">\n						<div class="inner">\n							每天\n						</div>\n					</li>\n					<li data-type="dropdown-item" class="everyworkday_nst" label="每个工作日" uservalue="2" data-name="day-every-weekday">\n						<div class="inner">\n							每个工作日\n						</div>\n					</li>\n					<li data-type="dropdown-item" label="每周" uservalue="3" class="weektime_nst" data-name="day-every-week">\n						<div class="inner">\n							每周\n							\n						</div>\n					</li>\n					<li data-type="dropdown-item" label="每月" uservalue="11" class="monthtime_nst" data-name="day-every-month">\n						<div class="inner">\n							每月\n						</div>\n					</li>\n				</ul>\n\n				<div class="day-timepicker box-border" data-name="day-dropdown-datepicker"></div>\n				<ul class="tt-noticesetting__time-set-dropdown-second box-border" data-name="day-dropdown-week">\n					<li uservalue="2" label="每周一">周一</li>\n					<li uservalue="3" label="每周二">周二</li>\n					<li uservalue="4" label="每周三">周三</li>\n					<li uservalue="5" label="每周四">周四</li>\n					<li uservalue="6" label="每周五">周五</li>\n					<li uservalue="7" label="每周六">周六</li>\n					<li uservalue="1" label="每周日">周日</li>\n				</ul>\n				<ul class="tt-noticesetting__time-set-dropdown-second box-border" data-name="day-dropdown-month">\n					'+((__t=month31)==null?"":__t)+'\n				</ul>\n			</div>\n		</div><!-- 此处注释符号不可去掉，用来消除 display：inline-block 产生的边距\n	--><div class="tt-noticesetting__time-set-item">\n			<div class="tu-input-default" data-name="hour-wrap">\n				<div class="input" uservalue="'+((__t=nowHour)==null?"":__t)+'" label="'+((__t=nowHour)==null?"":__t)+'" data-name="hour-input-value">'+((__t=nowHourLabel)==null?"":__t)+'</div>\n				<div class="right-action tu-clearfix">\n					<span class="tu-icon-sort-down"></span>\n				</div>\n				<div class="tt-noticesetting__time-set-dropdown box-border" data-name="hour-dropdown">\n					<ul>\n						'+((__t=hour24)==null?"":__t)+'\n					</ul>\n				</div>\n			</div>\n		</div><!-- 此处注释符号不可去掉，用来消除 display：inline-block 产生的边距\n	--><div class="tt-noticesetting__time-set-item">\n			<div class="tu-input-default" data-name="minite-wrap">\n				<div class="input" uservalue = "00" label="00" data-name="minite-input-value">00</div>\n				<div class="right-action tu-clearfix">\n					<span class="tu-icon-sort-down"></span>\n				</div>\n				<div class="tt-noticesetting__time-set-dropdown box-border" data-name="minute-dropdown">\n					<ul>\n						'+((__t=minite12)==null?"":__t)+'\n					</ul>\n				</div>\n			</div>\n		</div>\n		<div class="tt-noticesetting__time-errortip errortip" data-name="time-error-tip"></div>\n	</div>\n</div>\n\n\n<div class="tt-noticesetting__setuser tu-clearfix">\n	<span class="title">提醒对象</span>\n	<div class="tt-noticesetting__setuser-input">\n		<div class="tu-input-default" data-name="set-user-wrap">\n			<div class="input" data-name="person-list"></div>\n		</div>\n		<div class="tt-noticesetting__setuser-errortip errortip" data-name="user-error-tip"></div>\n	</div>\n</div>\n\n<div class="tt-noticesetting__setcontent tu-clearfix">\n	<span class="title">提醒内容</span>\n	<div class="tt-noticesetting__setcontent-input">\n		<div class="tu-input-default" data-name="remind-desc-wrap">\n			<textarea class="default_nst" defaultValue="提醒内容" data-name="remind-desc-input">提醒内容</textarea>\n		</div>\n		<div class="tt-noticesetting__setcontent-errortip errortip" data-name="content-error-tip"></div>\n	</div>\n</div>'}return __p};this["JST"]["tag/tag-add-dialog/tag-add-dialog-input-checkcolor"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){for(var i=1;i<7;i++){__p+="\n	";if(i==color){__p+='\n		<span class="color'+((__t=i)==null?"":__t)+' tu-icon-tick" data-color="'+((__t=i)==null?"":__t)+'"></span>\n	'}else{__p+='\n		<span class="color'+((__t=i)==null?"":__t)+'" data-color="'+((__t=i)==null?"":__t)+'"></span>\n	'}__p+="\n"}}return __p};this["JST"]["tag/tag-add-dialog/tag-add-dialog-input"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<span class="check-color-btn" original-title="更换颜色">\n<span class="color'+((__t=color)==null?"":__t)+'"></span>\n</span>\n<button data-name="add" class="tag-input-add tu-button-disabled">添加</button>\n<div class="tu-input-default" data-name="input-box">\n<div><label class="placeholder" for="q">添加或搜索标签</label></div>\n<form data-name="form">\n<input type="text" id="q" data-name="input" autocomplete="off">\n</form>\n</div>\n<p class="input-tip"></p>'}return __p};this["JST"]["tag/tag-add-dialog/tag-add-dialog-tag-box"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div data-name="my-tag"></div>\n<div data-name="share-tag"></div>'}return __p};this["JST"]["tag/tag-add-dialog/tag-add-dialog"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div data-name="loading"></div>\n<div data-name="input"></div>\n<div data-name="tag-cont" class="tag-cont"></div>'}return __p};this["JST"]["tag/tag-add"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="project_tag_item clearfix">\n	<span id="add-tag" class="add-tag tu-icon-add" data-name="add-tag"></span>\n	<div class="tag-container" data-name="tag-container"></div>\n</div>'}return __p};this["JST"]["tag/tag-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="tag-box ';if(beCheck||del){__p+="be-check"}__p+=" ";if(del){__p+="beDel"}__p+=' " data-name="tag-box">\n<div class="tag-wrap clearfix" data-name="tag-wrap">\n	<div class="tag-main " data-name="tag-main">\n		';if(beCheck&&!gray){__p+='\n		<span class="tu-icon-check checked ';if(gray){__p+="gray"}else{__p+="color"+((__t=color)==null?"":__t)}__p+='"></span>\n		'}__p+='\n		<span class="tag-color-wrap">\n			<span class="';if(gray){__p+="gray"}else{__p+="color"+((__t=color)==null?"":__t)}__p+='"></span>\n		</span>\n		<span class="text">'+__e(_.escape(tagName))+"</span>\n		";if(del&&!gray){__p+='\n		<span class="del tu-icon-cross" data-name="tag-del"></span>\n		'}__p+="\n	</div>\n	";if(showOrter){__p+='\n	<div class="tag-other" data-name="tag-other">\n		';if(getWay==2){__p+='\n		<span class="share-in tu-icon-changeperson" original-title="来自'+((__t=fromUserName)==null?"":__t)+'的共享" data-name="share-in"></span>\n		'}__p+="\n		";if(shareType==1){__p+='\n		<span class="share-out tu-icon-cp-right" original-title="已共享给直属下级" data-name="share-out"></span>\n		'}__p+="\n		";if(objCount){__p+='\n		<span class="count" original-title="标签下工作事项数量" data-name="count">'+__e(objCount)+"</span>\n		"}__p+="\n	</div>\n	"}__p+="\n</div>\n</div>"}return __p};this["JST"]["task-apply/task-apply-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="apply_left">\n    <div class="apply_date">\n        <span class="blue_date">'+((__t=startDate)==null?"":__t)+"</span><span>"+((__t=startHour)==null?"":__t)+"</span>\n    </div>\n    ";if(type!="approval"){__p+='\n        <div class="apply_date ">\n            <span class="blue_date">';if(startDate!=endDate){__p+=(__t=endDate)==null?"":__t}__p+="</span><span>"+((__t=endHour)==null?"":__t)+"</span>\n        </div>\n    "}__p+='\n    <div class="apply_middel">\n    	';if(type=="approval"){__p+='<div class="apply_pen"></div>'}__p+="\n	    ";if(type=="argeed"){__p+='<div class="apply_ok"></div>'}__p+="\n	    ";if(type=="rejected"){__p+='<div class="apply_wrong"></div>'}__p+="\n	    ";if(type!="approval"){__p+='\n	        <div class="apply_tree"></div>\n	        <div class="apply_end"></div>\n	    '}__p+="\n	    ";if(type=="approval"&&!isEditApplyAble){__p+='\n	        <div class="apply_tree"></div>\n	        <div class="apply_end"></div>\n	    '}__p+=' \n	</div>\n</div>\n\n<div class="apply_right">\n    <div class="apply_msg">'+((__t=txtTemplate)==null?"":__t)+"</div>\n   ";if(type!=="approval"){__p+='\n        <div class="apply_msg">'+((__t=applyUser.name)==null?"":__t)+"：<span>";if(type=="argeed"){__p+="已同意"}else if(type=="rejected"){__p+="已驳回"}__p+="</span></div>\n   "}__p+="\n   ";if(!isEditApplyAble&&type=="approval"){__p+='\n        <div class="apply_msg">待审批</div>\n   '}__p+="\n";if(isEditApplyAble){__p+='\n    <div class="apply_item_edit">\n        <button class="tu-btn tu-btn-small tu-btn-sure" data-name="sure-item">同意</button>\n        <button class="tu-btn tu-btn-small" data-name="cancel-item">驳回</button>\n    </div>\n'}__p+="\n</div>\n";if(applyDescription){__p+='\n	<div class="apply_refuse_content">驳回理由：<span>'+((__t=applyDescription)==null?"":__t)+"</span></div>\n"}__p+="\n"}return __p};this["JST"]["task-apply/task-apply"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(isShowAllButton){__p+='\n<div class="apply_all" data-name="task-apply-all">\n	<button class="btn btn-sure" data-name="task-apply-sure-all">全部同意</button>\n	<button class="btn btn-cancel" data-name="task-apply-cancel-all">全部驳回</button>\n</div>\n';

}__p+='\n<div data-name="task-apply-list"></div>'}return __p};this["JST"]["task-create/task-create-add-user-composite"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(label){__p+='\n<label class="tu-fl tu-font-h5">'+((__t=label)==null?"":__t)+"</label>\n"}__p+='\n<em class="ux_add_btn tu-fl tu-btn-add tu-btn tu-btn-mini tu-icon-add " data-name="add-user-btn"></em>\n<ul></ul>'}return __p};this["JST"]["task-create/task-create-add-user-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(departmentTag){__p+='\n	<a href="javascript:void(0)" title="删除:'+((__t=Name)==null?"":__t)+'" id="'+((__t=id)==null?"":__t)+'" class="ux_user_area department">'+((__t=imgTemplate)==null?"":__t)+"</a>\n"}else{__p+='\n	<a href="javascript:void(0)" title="删除:'+((__t=Name)==null?"":__t)+'" id="'+((__t=Id)==null?"":__t)+'" class="ux_user_area">'+((__t=imgTemplate)==null?"":__t)+"</a>\n"}}return __p};this["JST"]["task-create/task-create-apply-user"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+='\n	<span class="task-create-tools-item task-create-applyuser-wraper" title="审批人">\n		<a class="task-create-tools-link tu-pr-5" href="javascript:void(0)" data-name="task-create-applyuser">\n			<span class="tu-icon-signet  ico-style">审批人：</span>\n			';if(applyUser&&applyUser.Name){__p+="\n				"+((__t=_.substring(applyUser.Name,6,true))==null?"":__t)+" \n			"}else{__p+="\n				无\n			"}__p+="\n		</a>\n		";if(applyUser&&applyUser.Name){__p+='\n			<span data-name="task-create-delete-applyuserr"  data-id="'+((__t=applyUser.Id)==null?"":__t)+'" class="task-create-delete-applyuser-wraper"><span  class="tu-icon-close"  data-name="task-create-delete-applyuser" ></span></span>\n		'}__p+="\n	</span>\n\n"}return __p};this["JST"]["task-create/task-create-bottom"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="task-create-bottom-wraper clearfix">\n	';if(isShowFileUpload){__p+='\n	<div class="uploader_container" style="position: relative;"><a title="" href="javascript:void(0);" data-name="file" ></a></div>\n	'}__p+='\n	<div class="ux_publish">\n		<span data-name="publish-wraper" class="publish-wraper '+((__t=packUp&&isShowPackUpBtn?"packup":"")==null?"":__t)+'">\n			';if(isShowMessage){__p+='\n				<div class="msg">\n					<a href="javascript:void(0);" class="ico-style check  '+((__t=sendUserStatus?"tu-icon-check-active":"tu-icon-checkbox-have")==null?"":__t)+'" data-name="data-message">\n					</a>\n					<span class="txt" data-body="'+((__t=sendUserStatus?"取消短信通知负责人":"短信通知负责人")==null?"":__t)+'">短信通知</span>\n				</div>\n				\n			'}__p+="\n			";if(isShowPrivateBtn){__p+='\n			<div class="set-private-area" data-name="task-create-private">\n			'+((__t=privateText.name=="私密"?"仅相关成员可见":privateText.name)==null?"":__t)+'<i class="tu-icon-sort-down" data-name="range-caret"></i>\n			</div>\n			'}__p+="\n		</span>\n		\n		";if(isShowPackUpBtn){__p+='\n		<span class="toggle" data-name="toggle">\n			<span class="l">'+((__t=packUp?"更多信息":"收起")==null?"":__t)+'</span>\n			<span class="r tu-icon-arrow-'+((__t=packUp?"down":"up")==null?"":__t)+'"></span>\n		</span>\n		'}__p+='\n\n		<a class="tu-btn tu-btn-small tu-btn-sure disabled" href="javascript:void(0);" title="'+((__t=pubBtnText)==null?"":__t)+'" data-name="set-pub-btn">'+((__t=pubBtnText)==null?"":__t)+'</a>\n	</div>\n</div>\n<div class="error_container"></div>\n<div class="preview_container"></div>\n<div class="loading_container"></div> '}return __p};this["JST"]["task-create/task-create-class"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n	";if(showBorderLeft){__p+='\n		<span class="border"></span>\n	'}__p+='\n	<div class="task-create-class-innder '+((__t=disable?"disable":"")==null?"":__t)+'" data-name="task-create-class">\n		<span data-name="task-create-class-name" class="task-create-class-name klass_ttpl">\n			';if(labelId&&labelName){__p+="\n				"+((__t=_.substringWithM(labelName,6,true))==null?"":__t)+"\n			"}else{__p+="\n				";if(TaskLabel){__p+="\n					分类/项目\n				"}else{__p+="\n					所属项目\n				"}__p+="\n			\n			"}__p+="\n		</span>\n		";if(labelType!=4){__p+='\n			<span class="tu-icon-sort-down icon-sort-down"></span>\n		'}__p+="\n	</div>\n\n\n\n"}return __p};this["JST"]["task-create/task-create-customize-date-richeditor"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-create-laytout-input layout-border" data-name="task-create-add-input">\n	<div class="task-create-add-task-container" data-name="task-create-add-task-container">\n		<div class="task-create-date-container" data-name="task-create-date"></div>\n	</div>\n	\n</div>\n<div class="task-create-richeditor" data-name="task-create-richeditor"  id="task-create-newEditor-'+((__t=timestamp)==null?"":__t)+'"></div>\n<div class="task-create-bottom" data-name="task-create-bottom"></div>\n\n'}return __p};this["JST"]["task-create/task-create-customize-work-hour"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-create-laytout-input layout-border" data-name="task-create-add-input">\n	<div class="task-create-add-task-container" data-name="task-create-add-task-container">\n		<div class="task-create-name-container" data-name="task-create-name"></div>\n		<div class="task-create-right-part">\n			<div class="task-create-date-container" data-name="task-create-date"></div>\n			<div class="task-create-tools-item-wraper" data-name="task-create-hour-date"></div>\n		</div>\n	</div>\n	\n</div>\n<div class="task-create-richeditor" data-name="task-create-richeditor" id="task-create-newEditor-'+((__t=timestamp)==null?"":__t)+'"></div>\n<div class="task-create-bottom" data-name="task-create-bottom"></div>\n\n'}return __p};this["JST"]["task-create/task-create-date"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+="\n";if(isCycle){__p+='\n	<div class="task-create-date-inner" data-name="task-create-date-box" data-body="'+((__t=cycleTip)==null?"":__t)+'">\n		<span class="ico tu-icon-refresh ico-style" data-name="task-create-date-ico">时间</span>\n	</div>\n'}else{__p+='\n	<div class="task-create-date-inner" data-name="task-create-date-box" data-body="'+((__t=dateTip)==null?"":__t)+'">\n			<span class="ico tu-icon-calendar ico-style" data-name="task-create-date-ico">时间</span>\n	</div>\n'}}return __p};this["JST"]["task-create/task-create-external-person"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+='\n<span class="task-create-tools-item" data-name="task-create-extend-person" title="外部联系人">\n	<a href="javascript:void(0)" class="task-create-tools-link">\n		<span class="tu-icon-open ico-style"></span>\n		外部联系人\n	</a>\n</span>\n'}return __p};this["JST"]["task-create/task-create-follow"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+='\n	<span data-name="task-create-follow" class="task-create-tools-item task-create-follow" title="'+((__t=followCount?followCount+"人":"添加关注者")==null?"":__t)+'">\n			<a href="javascript:void(0)" class="task-create-tools-link">\n				<span class="tu-icon-link-1 ico-style"></span>\n				'+((__t=followCount?"关注者："+followCount+"人":"关注者")==null?"":__t)+"\n			</a>\n		</span>\n\n"}return __p};this["JST"]["task-create/task-create-name"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+="\n\n";if(iconShow){__p+='\n	<span class="ico-name '+((__t=iconClassName)==null?"":__t)+'"></span>\n'}__p+='\n<form action="" data-name="task-create-name-form">\n	<input class="'+((__t=iconShow?"has-icon":"")==null?"":__t)+'" data-name="task-create-name" type="text" placeholder="'+((__t=defaultText)==null?"":__t)+'" value="'+((__t=taskTitle)==null?"":__t)+'" autocomplete="off"/>\n</form>\n\n<div data-name="task-create-name-dropdown" ';if(dropdownData.length){__p+='class="tu-dropdown"'}__p+="></div>\n\n"}return __p};this["JST"]["task-create/task-create-participator"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<span class="border"></span>\n<span data-name="task-create-participator" class="task-create-tools-item task-create-participator" title="'+((__t=participatorsCount?participatorsCount+"人":"添加参与人")==null?"":__t)+'">\n	<a href="javascript:void(0)" class="task-create-tools-link">\n		<span class="tu-icon-participator ico-style"></span>\n		'+((__t=participatorsCount?"参与人："+participatorsCount+"人":"参与人")==null?"":__t)+"\n	</a>\n</span>"}return __p};this["JST"]["task-create/task-create-principle"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+='\n<div class="task-create-principle">\n	<div class="task-create-principle-inner" data-name="task-create-principle-inner">\n		<span class="tu-icon-assigner ico-style" data-name=\'task-create-principle-label\'>'+((__t=_.substring(principalUser.Name,6,true))==null?"":__t)+"负责</span>\n	</div>\n</div>\n"}return __p};this["JST"]["task-create/task-create-replace"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+='\n\n	<div class="task-create-tools-item task-create-replace '+((__t=isCanReplace?"":"disable")==null?"":__t)+'" data-body="'+((__t=isCanReplace?"点击可切换任务发起人":"不可以代自己发起任务")==null?"":__t)+'">\n				\n		<span class="task-create-replace-check-wraper" data-name="task-create-replace-check-wraper">\n			';if(isCanReplace){__p+="\n				";if(replaceRadioChecked){__p+='\n					<span class="task-create-replace-check  tu-icon-check-active" data-name="task-create-replace-check"></span>\n				'}else{__p+='\n					<span class="task-create-replace-check  tu-icon-checkbox-have ico-style" data-name="task-create-replace-check"></span>\n				'}__p+="\n			"}else{__p+='\n				<!-- <span class="task-create-replace-check checkbox-default-disable"></span> -->\n				<span class="tu-icon-checkbox-have disable"></span>\n			'}__p+='\n</span>\n<span class="task-create-replace-label" data-name="task-create-replace-label">代领导发起</span>\n<span class="task-create-help">\n	<a href="http://service.tita.com/pages/viewpage.action?pageId=590556" target="_blank" class="tu-icon-wiki icon-wiki"></a>\n</span>\n</div>\n\n\n\n'}return __p};this["JST"]["task-create/task-create-workhour"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(showBorderLeft){__p+='\n	<span class="border"></span>\n'}__p+='\n<span class="task-create-tools-item task-create-workhour"  data-name="task-create-workhour"\n	title="'+((__t=hourDate||minuteDate?"修改工时":"设置工时")==null?"":__t)+'">\n	<a class="task-create-tools-link">\n		<span class="task-create-add-hour-icon ico-style tu-icon-open '+((__t=workHour?"active":"")==null?"":__t)+'"></span>\n		<span class="task-create-add-hour-text">'+((__t=workHour?workHour+" 小时":"工时")==null?"":__t)+"</span>\n	</a>\n</span>\n"}return __p};this["JST"]["task-create/task-create"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-create-laytout-input layout-border" data-name="task-create-add-input">\n	<div class="task-create-add-task-container" data-name="task-create-add-task-container">\n				\n		<div class="task-create-name-container" data-name="task-create-name"></div>\n		<div class="task-create-right-part">\n			<div class="task-create-principle-area" data-name="task-create-principle-area"></div>\n			<div class="task-create-date-container" data-name="task-create-date"></div>\n		</div>\n	</div>\n	\n</div>\n<div class="task-create-layout-tools clearfix" data-name="task-create-tools">\n		<div class="task-create-tools-item-wraper" data-name="task-create-class"></div>	\n		<div class="task-create-tools-item-wraper" data-name="task-create-hour-date"></div>\n		<div class="task-create-tools-item-wraper" data-name="task-create-participator"></div>\n		<div class="task-create-tools-item-wraper" data-name="task-create-follow"></div>\n		<div class="task-create-tools-item-wraper" data-name="task-create-apply-user"></div>\n		<div class="task-create-tools-item-wraper" data-name="task-create-external-person"></div>\n		<div class="task-create-tools-item-wraper" data-name="task-create-replace"></div>\n\n</div>\n<div class="layout-border task-create-layout-extend" data-name="task-create-layout-extend">\n	<div class="task-create-layout-member-list " data-name="task-create-member-list"></div>\n	<div class="task-create-layout-extend-user " data-name="task-create-extend"></div>\n</div>\n\n<!-- <div data-name="editor-container"> -->\n	<div class="tt-task-create-editor" id="task-create-newEditor-'+((__t=timestamp)==null?"":__t)+'" data-name="task-create-richeditor"></div>\n\n<!-- </div> -->\n\n<div class="task-create-bottom" data-name="task-create-bottom"></div>\n\n'}return __p};this["JST"]["task-detail/error-layout-message"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n	<div class="noaccess tu-tac">\n		<div class="img_na"></div>\n		<div class="text_ma tu-font-h4 tu-mt-20">\n			'+((__t=content)==null?"":__t)+"\n		</div>\n	</div>\n"}return __p};this["JST"]["task-detail/share-range-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<a href="javascript:void(0);" ';if(Type!=0){__p+='style="cursor: default;"'}__p+=">\n\n	";if(User.UserAvatar.HasAvatar==false){__p+="\n								\n		"+((__t=_.convertImage({className:"",src:User.Avatar,size:30,shape:"radius",name:User.Name,bgColor:User.UserAvatar.Color}))==null?"":__t)+"\n	"}else{__p+='\n		<img class="radius_img30" alt="'+((__t=User.Name)==null?"":__t)+'" src="'+((__t=User.UserAvatar.Small)==null?"":__t)+'">\n	'}__p+="\n	";if(Type==0){__p+='<span class="del_sr" id="'+((__t=User.Id)==null?"":__t)+'" data-name="deleted"><i class="ico"></i></span>'}__p+="\n</a>\n\n"}return __p};this["JST"]["task-detail/share-range"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n<h4>"+((__t=title)==null?"":__t)+'</h4>\n<ul class="list_sr">\n	';if(isAdd){__p+='\n	<li class="button_sr" data-body='+((__t=addBtnTips)==null?"":__t)+'><a href="javascript:void(0);" title="" class="add_sr tu-btn tu-btn-mini tu-btn-add tu-icon-add" data-name="add"><span></span></a></li>\n	'}__p+="\n</ul>\n"}return __p};this["JST"]["task-detail/task-accept-pop"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="title">'+((__t=title)==null?"":__t)+'</div>\n\n<div class="pop_container">\n	<h2>所属分类/项目:</h2>\n	\n	<div class="classes">\n		';if(labelType==4){__p+='\n			<span class="sys-icon-xiangmu pop_container__icon"></span>\n		'}__p+="\n		<span>"+((__t=labelName)==null?"":__t)+'</span>\n	</div>\n</div>\n<div class="pop_container start-end-date" data-name="task-detail-accept-date-box">\n	<h2>起止时间:</h2>\n	<div class="input-default">\n		';if(classEditable){__p+='\n			<input type="text" title="" value="'+((__t=startDate)==null?"":__t)+" - "+((__t=isLongTerm?"长期":endDate)==null?"":__t)+'" data-name="task-detail-accept-date" ';if(cycleId>0){__p+='style="color:#aaa;"'}__p+=">\n		"}else{__p+='\n			<span class="input" ';if(cycleId>0){__p+='style="color:#aaa;"'}__p+=">\n				"+((__t=startDate)==null?"":__t)+" - "+((__t=isLongTerm?"长期":endDate)==null?"":__t)+'"\n			</span>\n		'}__p+='\n	</div>\n</div>\n\n<div class="uibutton">\n	<a href="javascript:void(0);" class="btn btn-sure sure_dialog" data-name="task-detail-accept-sure"><span>确定</span></a>\n	<a href="javascript:void(0);" class="btn btn-cancel cancel_dialog" data-name="task-detail-accept-cancel">取消</a>\n</div>\n'}return __p};this["JST"]["task-detail/task-action"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="tt-task-detail-topbar__main">\n	<div class="tu-clearfix">\n		<div class="tt-task-detail-topbar__main-status">\n			';if(editStatusable){__p+='\n				<div class="tt-task-detail-topbar__main-status-set tu-cp" data-name="task-set-status">\n					<a href="javascript:void(0);" class="tt-task-detail-topbar__main-status-set-icon '+((__t=iconName)==null?"":__t)+'" ></a>'+((__t=StatusTip)==null?"":__t)+"\n				</div>\n			"}else{__p+='\n				<div class="tt-task-detail-topbar__main-status-set">\n					<a href="javascript:void(0);" class="tt-task-detail-topbar__main-status-set-icon_disable '+((__t=iconName)==null?"":__t)+'" ></a>'+((__t=StatusTip)==null?"":__t)+"\n				</div>\n			"}__p+="\n		</div>\n		";if(isApply){__p+='\n			<span class="tt-task-detail-topbar__main-apply icon-approval-ing"></span>\n		'}__p+='\n\n		<ul class="tt-task-detail-topbar__main-action tu-clearfix">\n			';if(webimAble){__p+='\n			<li class="tt-task-detail-topbar__main-action-list" data-name="webim">\n				<span class="tt-task-detail-topbar__main-action-list-icon tt-task-detail-topbar__main-action-list-icon_webim header-icon-titaim" data-infotip-body="进入群聊"></span>\n				<span class="tt-task-detail-topbar__main-action-list-line"></span>\n			</li>\n			'}__p+="\n\n			";if(taoShangAble||daShangeAble){__p+='\n			<li class="tt-task-detail-topbar__main-action-list">\n				';if(taoShangAble){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon tt-task-detail-topbar__main-action-list-icon_taoshang tu-icon-taoshang" data-infotip-body="讨赏" data-name="reward-tao"></span>\n				'}__p+="\n\n				";if(daShangeAble){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon tt-task-detail-topbar__main-action-list-icon_dashang tu-icon-dashang" data-infotip-body="打赏" data-name="reward-shang"></span>\n				'}__p+='\n				<span class="tt-task-detail-topbar__main-action-list-line"></span>\n			</li>\n			'}__p+='\n\n			<li class="tt-task-detail-topbar__main-action-list">\n				';if(starAble){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon tt-task-detail-topbar__main-action-list-icon_star tu-icon-star ';if(isMark){__p+="active"}__p+='" data-name="set-task-star" data-infotip-body="';if(isMark){__p+="取消星标"}else{__p+="标为星标"}__p+='"></span>\n				'}__p+="\n\n				";if(followAble){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon\n				tt-task-detail-topbar__main-action-list-icon_follow tu-icon-link-1 '+((__t=isFollow?"tt-task-detail-topbar__main-action-list_isfollow":"")==null?"":__t)+' " data-infotip-body="'+((__t=isFollow?"取消关注":"关注")==null?"":__t)+'" data-name="follow-btn"></span>	\n				'}__p+="\n\n				";if(remindAble){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon  tt-task-detail-topbar__main-action-list-icon_watch tu-icon-clock ';if(isRemind){__p+="active"}__p+='" data=\'{"objid":"'+((__t=taskId)==null?"":__t)+'","objType":"7"}\' data-name="set-task-notice" data-infotip-body="';if(isRemind){__p+="已设提醒"}else{__p+="设置提醒"}__p+='"></span>\n				'}__p+="\n\n				";if(deleteable){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon tt-task-detail-topbar__main-action-list-icon_delete tu-icon-delete" data-infotip-body="删除" data-name="set-task-deleted"></span>\n				'}__p+="\n\n				";if(quitAble){__p+='\n				<span class="tt-task-detail-topbar__main-action-list-icon tt-task-detail-topbar__main-action-list-icon_quit tu-icon-quit" data-infotip-body="退出参与" data-name="quit-task"></span>\n				'}__p+='\n				<span class="tt-task-detail-topbar__main-action-list-line"></span>\n			</li>\n		</ul>\n	</div>\n	';if(WorkExternal){__p+="\n		";if(showCaution){__p+='\n			<div class="tu-caution tu-mt-10">外部联系人可以查看当前任务，请注意企业信息保密！</div>\n			'}__p+="\n	"}__p+="\n</div>"}return __p};this["JST"]["task-detail/task-add-do"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(isShowTask){__p+='\n<a href="javascript:void(0)" class="tu-btn tu-btn-small tu-btn-sure" data-name="distribute_task">分解'+((__t=i18n["task_1"])==null?"":__t)+"</a>\n"}__p+="\n";if(isShowWorkTime){__p+='\n<a href="javascript:void(0)" class="tu-btn tu-btn-small tu-btn-sure" data-name="task-work-hour">添加工时</a>\n'}__p+="\n";if(isShowMeeting){__p+='\n	<a href="javascript:void(0)" class="tu-btn tu-btn-small tu-btn-sure" data-name="task-meet">添加会议</a>\n'}__p+="\n";if(isShowTravel){__p+='\n	<a href="javascript:void(0)" class="tu-btn tu-btn-small tu-btn-sure" data-name="task-travel">添加出差</a>\n'}__p+="\n";if(isShowShare){__p+='\n<a href="javascript:void(0)" class="tu-btn tu-btn-small tu-btn-sure" data-name="task-share">添加进展</a>\n'}__p+="\n"}return __p};this["JST"]["task-detail/task-apply-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-detail-moduletitle">\n	<div class="icon tu-bg_c3">\n		<span class="tu-icon-signet icon-dt"></span>\n	</div>\n	<div class="text">审批(<span data-name="task-detail-apply-total">'+((__t=total)==null?"":__t)+'</span>)</div>\n</div>\n\n\n<div class="module-content">\n	<div data-name="task-detail-apply-list"></div>\n</div>	\n'}return __p};this["JST"]["task-detail/task-base-info"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<dl class="task-relate edit-able_handler" data-name="task-relate-container">\n	<dt data-toggle="tip" data-tip="只有发起人和负责人可以编辑关联" class="task-relate__title" data-name="task-relate-text">\n		<i class="tu-icon-link-2 ico-eb"></i>\n		<span class="tu-ft_m2">关联任务</span>\n	</dt>\n	<dd class="task-relate__text">\n		';if(parentId){__p+='\n			<span class="edit-task-link tu-ft_c2 pointer" id="'+((__t=parentId)==null?"":__t)+'" data-name="edit-task-link">\n				'+((__t=parentName)==null?"":__t)+"\n			</span>\n		"}else{__p+='\n			<span class="tu-ft_m3">暂无关联</span>\n		'}__p+="\n	</dd>\n	";if(relateEditable){__p+='\n		<div class="tu-icon-edit edit-able" data-name="task-relate-change" data-toggle="tip" data-tip="修改关联"></div>\n		\n		<a class="tu-icon-wiki tu-ft_m3 tu-ft-hv_c3 task-relate__wiki" href="http://service.tita.com/pages/viewpage.action?pageId=590574" target="_blank" data-toggle="tip" data-tip="了解关联任务"></a>\n	'}__p+="\n</dl>\n\n\n";if(cycleId&&cycleId!=""&&status!=2&&!isDeadLine){__p+='\n	<div class="ux_editask_base__item edit-able_handler" data-name="cycle-area">\n		<div class="left-eb tu-ft_m2">\n			<span class="tu-icon-refresh ico-eb"></span>\n			<span>循环周期</span>\n		</div>\n		';if(cycleable){__p+='\n			<span data-name="task-edit-cycle">'+((__t=cycleHtml)==null?"":__t)+"</span>\n		"}else if(!cycleable){__p+='\n			<span data-name="task-edit-cycle">'+((__t=cycleHtml)==null?"":__t)+"</span>\n		"}__p+="\n		";if(cycleable){__p+='\n			<div class="tu-icon-edit edit-able" data-name="task-edit-cycle-edit" data-toggle="tip" data-tip="编辑"></div>\n			<div class="tu-icon-close edit-able edit-able_del" data-name="task-detail-cancel-cycle" data-toggle="tip" data-tip="取消循环"></div>\n		'}__p+="\n		\n	</div>\n"}__p+='\n\n<div class="tu-ft_m1 ux_editask_base__item edit-able_handler" data-name="date-area">\n	<div class="left-eb tu-ft_m2">\n		<span class="tu-icon-calendar ico-eb"></span>\n		<span>起止时间</span>\n	</div>\n\n	';if(editable&&cycleId==0){__p+="\n		";if(!startDate&&!deadLine){__p+='\n			<span data-name="task-dem">开始时间 - 结束时间</span>\n		'}else{__p+='\n			<span data-name="set-task-date">'+((__t=startDate)==null?"":__t)+" -- ";if(isLongTerm){__p+="长期"}else{__p+=(__t=deadLine)==null?"":__t}__p+="</span>\n		"}__p+="\n		\n	"}else{__p+="\n		";if(!startDate&&!deadLine){__p+="\n			未设置\n		"}else{__p+="\n			"+((__t=startDate)==null?"":__t)+" - ";if(isLongTerm){__p+="长期"}else{__p+=(__t=deadLine)==null?"":__t}__p+="\n		"}__p+="\n	"}__p+="\n	";if(editable&&cycleId==0){__p+='\n	<div class="tu-icon-edit edit-able" data-name="task-detail-date-edit" data-toggle="tip" data-tip="编辑"></div>\n	'}__p+="\n	";if(!isLongTerm&&status!=2&&startDate){__p+="\n		";if(isDeadLine){__p+='\n			<span class="tu-ft_error left">已过期 ';if(remainDay!=0){__p+='<span class="due-num">'+((__t=remainDay)==null?"":__t)+"</span> 天"}__p+="</span>\n		"}else{__p+='\n			<span class="tu-ft_m2 left">剩余 <span class="remain-num">'+((__t=remainDay)==null?"":__t)+"</span>	天</span>\n		"}__p+="\n	"}__p+='\n\n	<div class="ux_editask_base__toggle" data-name="task-detail-toggle">\n	';if(!isPackUp){__p+='\n		<span class="txt" data-name="toggle-txt">展开详情</span><span class="icon tu-icon-arrow-down" data-nme="toggle-ico"></span>\n	'}else{__p+='\n		<span class="txt" data-name="toggle-txt">收起</span><span class="icon tu-icon-arrow-up" data-nme="toggle-ico"></span>\n	'}__p+='\n	</div>\n</div>\n	\n\n<ul class="all-more" data-name="task-detail-all-info" style="display:';if(!isPackUp){__p+="none"}else{__p+="block"}__p+='">\n	<li class="item-am edit-able_handler">\n		<div class="base-item-warp tu-ft_m1">\n			<div class="ux_editask_base__item" data-name="prical-area">\n				<div class="left-eb tu-ft_m2">\n					<span class="tu-icon-assigner ico-eb"></span>\n					<span>负责人</span>\n				</div>\n				'+((__t=principalUser.name)==null?"":__t)+"\n				";if(editable){__p+='\n					<div class="tu-icon-edit edit-able" data-name="task-transfer-user" data-toggle="tip" data-tip="编辑"></div>\n				'}__p+='\n			</div>\n		</div>\n		<div class="base-item-warp tu-ft_m1">\n			<div class="ux_editask_base__item">\n				<div class="left-eb tu-ft_m2">\n					<span class="tu-icon-founder ico-eb"></span>\n					<span>发起人</span>\n				</div>\n				'+((__t=user.name)==null?"":__t)+'\n			</div>\n		</div>\n	</li>\n	<li class="item-am">\n			';if(TaskParticipants){__p+='\n				<div class="base-item-warp tu-ft_m1">\n						<div class="ux_editask_base__item '+((__t=participators.length?"edit-able_handler":"edit-able_show")==null?"":__t)+'" data-name="participators-area">\n							<div class="left-eb tu-ft_m2">\n								<span class="tu-icon-participator ico-eb"></span>\n								<span>参与人</span>\n							</div>\n							<ul class="ux_editask_base__partner ux_editask_base__users-radius" data-name="partner">\n								';if(participators.length>0){__p+="\n									";_.each(participators,function(user){__p+='\n											<li class="ux_editask_base__users-radius_item ';if(editable){__p+="eidt-del"}__p+='">\n												<span>'+((__t=user.name)==null?"":__t)+"</span>\n												";if(editable){__p+='\n												<em class="tu-icon-cross tu-cp" id="'+((__t=user.userId)==null?"":__t)+'" data-name="task-detail-parnter-delete"></em>\n												'}__p+="\n											</li>\n										"});__p+="\n								"}else if(!editable&&!participators.length){__p+='\n									<li class="tu-ft_m3">未设置参与人</li>\n								'}__p+="\n								";if(editable){__p+='\n									<li class="last-add ux_editask_base__users-radius_item">\n										<div class="tu-icon-edit edit-able margin-left-0" data-name="task-add-partner" data-toggle="tip" data-tip="添加"></div>\n									</li>\n								'}__p+="\n							</ul>\n						</div>\n					</div>\n			"}__p+="\n			";if(TaskApply){__p+='\n				<div class="base-item-warp tu-ft_m1 '+((__t=applyUser&&applyUser.name?"edit-able_handler":"edit-able_show")==null?"":__t)+'">\n						<div class="ux_editask_base__item" data-name="apply-area">\n							<div class="left-eb tu-ft_m2">\n								<span class="tu-icon-signet ico-eb"></span>\n								<span>审批人</span>\n							</div>\n							<span data-name="task-apply-wrap ">\n							';if(applyUser&&applyUser.name){__p+='\n							<ul class="ux_editask_base__users-radius apply-eb">\n								<li ';if(editApplyUserable){__p+='class="eidt-del ux_editask_base__users-radius_item"'}__p+=">\n									<span>"+((__t=applyUser.name)==null?"":__t)+"</span>\n									";if(editApplyUserable){__p+='\n										<em class="tu-icon-cross tu-cp" data-id="'+((__t=applyUser.userId)==null?"":__t)+'" data-name="task-apply-user-delete" data-toggle="tip" data-tip="不需要审批人关注，可将审批人删除"></em>\n									'}__p+="\n								</li>\n							</ul>\n							"}else{__p+="\n								";if(!editable){__p+='\n									<span class="tu-ft_m3 tu-pt-5">未设置审批人</span>\n								'}else{__p+='\n									<div class="tu-icon-edit edit-able margin-left-0" data-name="task-apply-user-add" data-toggle="tip" data-tip="设置审批人"></div>\n								'}__p+="\n							"}__p+="\n							";if(editApplyUserable&&applyUser&&applyUser.name){__p+='\n								<div class="tu-icon-edit edit-able" data-name="task-apply-user-edit" data-toggle="tip" data-tip="变更审批人"></div>\n							'}__p+="\n							</span>\n						</div>\n					</div>\n			"}__p+=" \n			";if(!TaskParticipants&&TaskApply||TaskParticipants&&!TaskApply){__p+='\n				<div class="base-item-warp tu-ft_m1">\n						<div class="ux_editask_base__item edit-able_handler" data-name="class-container-wrap">\n							<div class="left-eb tu-ft_m2">\n								<span class="tu-icon-squares ico-eb"></span>\n								<span>\n									';if(TaskLabel){__p+="\n										分类/项目\n										"}else{__p+="\n											所属项目\n											"}__p+='\n									</span>\n							</div>\n							<span data-name="task-class-text" class="task-class-name">\n							';if(labelType==4){__p+='\n								<span class="sys-icon-xiangmu"></span>&nbsp;\n								<a href="/SiteUrlByRoute/'+((__t=userInfo.Id)==null?"":__t)+"/SiteUrlByRoute/WorkRoute?appId="+((__t=app&&app.appId?app.appId:1)==null?"":__t)+"&workId="+((__t=labelId)==null?"":__t)+'" target="_blank">\n									'+((__t=labelName)==null?"":__t)+"\n								</a>\n							"}else if(labelType==17){__p+="\n								"+((__t=labelName)==null?"":__t)+"\n							"}else{__p+="\n								"+((__t=labelName)==null?"":__t)+"\n							"}__p+="\n							</span>\n			\n							";if(labelEditable){__p+='\n								<div class="tu-icon-edit edit-able" data-name="task-edit-class" data-toggle="tip" data-tip="编辑"></div>\n								<div  data-name="class-area"></div>\n							'}__p+="\n						</div>\n					</div>\n				"}__p+='\n	</li>\n	<li class="item-am">\n			';if(!TaskParticipants&&TaskApply||TaskParticipants&&!TaskApply){__p+="\n			"}else{__p+='\n				<div class="base-item-warp tu-ft_m1">\n						<div class="ux_editask_base__item edit-able_handler" data-name="class-container-wrap">\n							<div class="left-eb tu-ft_m2">\n								<span class="tu-icon-squares ico-eb"></span>\n								<span>';if(TaskLabel){__p+="\n									分类/项目\n									"}else{__p+="\n										所属项目\n										"}__p+='</span>\n							</div>\n							<span data-name="task-class-text" class="task-class-name">\n							';if(labelType==4){__p+='\n								<span class="sys-icon-xiangmu"></span>&nbsp;\n								<a href="/SiteUrlByRoute/'+((__t=userInfo.Id)==null?"":__t)+"/SiteUrlByRoute/WorkRoute?appId="+((__t=app&&app.appId?app.appId:1)==null?"":__t)+"&workId="+((__t=labelId)==null?"":__t)+'" target="_blank">\n									'+((__t=labelName)==null?"":__t)+"\n								</a>\n							"}else if(labelType==17){__p+="\n								"+((__t=labelName)==null?"":__t)+"\n							"}else{__p+="\n								"+((__t=labelName)==null?"":__t)+"\n							"}__p+="\n							</span>\n			\n							";if(labelEditable){
__p+='\n								<div class="tu-icon-edit edit-able" data-name="task-edit-class" data-toggle="tip" data-tip="编辑"></div>\n								<div  data-name="class-area"></div>\n							'}__p+="\n						</div>\n					</div>\n				"}__p+='\n\n		<div class="base-item-warp tu-ft_m1">\n			<div class="ux_editask_base__item">\n				<div class="left-eb tu-ft_m2">\n					<span class="tu-icon-lock ico-eb"></span>\n					<span>可见范围</span>\n				</div>\n				'+((__t=privateText)==null?"":__t)+'\n			</div>\n		</div>\n	</li>\n</ul>\n\n	<div class="slide-border"></div>\n	<div class="ux_editask_base__item attachment-height uploader tu-mt-10" data-name="task-detail-attachment">\n		<div class="left-eb tu-ft_m2">\n			<span class="tu-icon-cus-fujian ico-eb"></span>\n			<span>附件</span>\n		</div>\n		';if(addAttachmentAble){__p+='\n		<div class="uploader_container" data-name="task-detail-attachment-button"></div>\n		<div class="error_container"></div>\n		<div class="loading_container"></div>\n		'}__p+='\n	</div>\n	<div class="ux_editask_base__attachments" data-name="task-detail-attachment-list" ></div>\n'}return __p};this["JST"]["task-detail/task-detail-layout"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div data-name="task-detail-unaccept"></div>\n<div data-name="task-detail-relate"></div>\n<div data-name="task-detail-action"></div>\n<div data-name="task-detail-scroll" '+((__t=isShowDetialScroll?'class="task-detail-scroll"':"")==null?"":__t)+' >\n	<div data-name="task-detail-info"></div>\n	<div class="task-extra-info" data-name="ux-customizetDatas"></div>\n	<div data-name="task-detail-evaluation"></div>\n	<div data-name="task-detail-base-info"></div>\n	<div data-name="task-detail-container">\n		\n		<div data-name="task-detail-add-do"></div>\n		<div data-name="ux-edittask-area"></div>\n		<div data-name="task-apply"></div>\n		<div data-name="task-detail-task-list"></div>\n		<div data-name="task-detail-work-hour"></div>\n		<div data-name="task-detail-meet"></div>\n		<div data-name="task-detail-travel"></div>\n		<div data-name="task-detail-share"></div>\n		<div data-name="task-detail-comment"></div>\n		<div data-name="task-detail-track"></div>\n		<div data-name="task-detail-follower"></div>\n		';if(TaskFollower){__p+='\n			<div class="task-share-user" data-name="task-share-user">\n				</div>\n		'}__p+="\n			\n	</div>\n</div>"}return __p};this["JST"]["task-detail/task-feed"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="task-detail-moduletitle">\n	<div class="icon icon_green">\n		<span class="tu-icon-talk icon-dt"></span>\n	</div>\n	<div class="text tu-font-h4">沟通</div>\n</div>\n<div class="module-content" data-name="task-detail-task-feed"></div>\n'}return __p};this["JST"]["task-detail/task-file"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="ux_edittask_upload">\n	<span class="icon-task-upload-enable"></span>\n	<span>'+((__t=i18n["task_1"])==null?"":__t)+'附件</span>\n</div>\n<div class="ux_edittask_fileupload" data-name="ux-upload-list"></div>\n<div class=""'}return __p};this["JST"]["task-detail/task-info"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n\n<div class="ux-edittask__info-status icon-status-'+((__t=status)==null?"":__t)+'"></div>\n\n\n';if(editable){__p+='\n	<div class="ux-edittask__info-name"  data-name="task-detail-name">\n		<input type="text" class="ux-edittask__info-name-input tu-font-h3 tu-ft_m1" />\n		<div class="ux-edittask__info-name-title tu-font-h3 tu-ft_m1" data-name="task-name">'+((__t=taskName)==null?"":__t)+'</div>\n		<div class="ux-edittask__info-name-extra" data-name="edit-extra">\n			<!-- <span class="ux-edittask__info-name-error" data-name=\'error-input\'></span> -->\n			<div class="ux-edittask__info-name-error" data-name="error-tip"></div>\n			<div class="ux-edittask__info-name-btns">\n				<button class="tu-btn tu-btn-small " data-name=\'cancel\'>取消</button>\n				<button class="tu-btn tu-btn-small tu-btn-sure" data-name=\'confirm\'>确定</button>\n			</div>\n		</div>\n	</div>\n'}else{__p+='\n	<div class="tu-font-h3 tu-ft_m1" data-name="task-name">'+((__t=taskName)==null?"":__t)+"</div>\n"}__p+='\n	\n<div class="ux-edittask__description" data-name="description-container">\n	';if(editable){__p+="\n		";if(!description||description==""){__p+='\n			<a href="javascript:void(0)"  data-name="task-detail-descript-add" class="ux-edittask__description-add">添加描述</a>\n			<div class="ux-edittask__description_show editor-style"  data-name="task-detail-descript" style="display:none">'+((__t=description)==null?"":__t)+"</div>\n		"}else{__p+='\n			<a href="javascript:void(0)"  data-name="task-detail-descript-add"  class="ux-edittask__description-add" style="display:none">添加描述</a>\n			<div class="ux-edittask__description_show editor-style clearfix"  data-name="task-detail-descript" >'+((__t=description)==null?"":__t)+"</div>\n		"}__p+="\n	"}else{__p+='\n		<div class="ux-edittask__description-title editor-style clearfix">\n			';if(description){__p+="\n				"+((__t=description)==null?"":__t)+"\n			"}__p+="\n		</div>\n	"}__p+='\n\n	<div data-name="task-detail-descript-edit" class="ux-edittask__description_edit">\n		<div class="ux-edittask__description_editor" id="taskDes'+((__t=taskId)==null?"":__t)+'"></div>\n	</div>\n</div>\n\n'}return __p};this["JST"]["task-detail/task-meet-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-detail-moduletitle">\n	<div class="icon icon_purple">\n		<span class="tu-icon-meeting icon-dt"></span>\n	</div>\n	<div class="text tu-font-h4">会议(<span data-name="task-detail-meet-total">'+((__t=total)==null?"":__t)+'</span>)</div>\n</div>\n\n<div class="module-content" data-name="task-travel-list">\n	<div class="_tt_loading_m">努力加载中…</div>\n</div>'}return __p};this["JST"]["task-detail/task-quick"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(isShowAll){__p+='\n<ul data-name="task-quick-list">\n	';_.each(quickList,function(quick,index){__p+="\n		";if(quick.isShow){__p+='\n		<li class="item-tq radius-tq" data-key="'+((__t=quick.key)==null?"":__t)+'" data-body="'+((__t=quick.name)==null?"":__t)+'">\n			<span class="ico ico-'+((__t=quick.icon)==null?"":__t)+'"></span>\n		</li>\n		';if(index+1!=quickList.length){__p+='\n			<li class="border"></li>\n		'}__p+="\n		"}__p+="\n	"});__p+='\n</ul>\n<div class="radius_all" data-name="task-quick-all" data-body="收起">\n	<a href="javascript:void(0)" class="ico ico-all" data-name="quick-do"></a>\n</div>\n'}}return __p};this["JST"]["task-detail/task-relate-modal"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="task-relate__filter" data-name="task-relate-filter"></div>\n\n<div class="task-relate__list" data-name="task-relate-list"></div>\n<div data-name="pagination"></div>'}return __p};this["JST"]["task-detail/task-share-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-detail-moduletitle" name="share">\n	<div class="icon icon_purple">\n		<span class="tu-icon-xinde icon-dt"></span>\n	</div>\n	<div class="text tu-font-h4">进展(<span data-name="task-detail-share-total">'+((__t=experienceTotal)==null?"":__t)+'</span>)</div>\n</div>\n<div class="module-content" data-name="task-detail-share-list"></div>'}return __p};this["JST"]["task-detail/task-share-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="item-left-line ';if(isLast){__p+="last"}__p+='">\n	<span class="item-left-line-icon '+((__t=iconClass)==null?"":__t)+'"></span>\n</div>\n<div class="item-user">\n	<span class="item-user-name">\n		'+((__t=publishUser.name)==null?"":__t)+'\n	</span>添加了进展\n</div>\n<div class="item-content">\n	';if(isEdit){__p+='\n		<div class="clearfix editor-style" data-name="task-detail-share-content" data-node-name="task-detail-share-content-'+((__t=commentId)==null?"":__t)+'"\n		 id="'+((__t=commentId)==null?"":__t)+'">\n			'+((__t=content)==null?"":__t)+'\n		</div>\n		<div data-name="task-detail-share-rich-warp">\n			<div data-name="task-detail-share-rich" id="task-detail-share-rich-item-'+((__t=timestamp)==null?"":__t)+'"></div>\n		</div>\n		'}else{__p+='\n			<div class="clearfix editor-style">\n				'+((__t=content)==null?"":__t)+"\n			</div>\n			"}__p+='\n\n				<div class="bar">\n					<div class="left">\n						';if(isEdit){__p+='\n							<a href="javascript:void(0);" class="editable" data-name="task-detail-share-time" id="'+((__t=commentId)==null?"":__t)+'">进展日期:\n								'+((__t=dateText)==null?"":__t)+"\n							</a>\n							"}else{__p+="\n								<span>进展日期:\n									"+((__t=dateText)==null?"":__t)+"\n								</span>\n								"}__p+="\n					</div>\n\n\n					";if(isEdit){__p+='\n						<span class="edit tu-icon-edit" data-name="task-detail-share-edit" id="'+((__t=commentId)==null?"":__t)+'"></span>\n						<span class="del tu-icon-delete" data-name="task-detail-share-delete" id="'+((__t=commentId)==null?"":__t)+'"></span>\n						'}__p+='\n				</div>\n</div>\n<div data-name="task-detail-share-attachment"></div>'}return __p};this["JST"]["task-detail/task-share-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(isShowCreate){__p+='\n<div class="add-area">\n	<div class="topinput" data-name="task-detail-share-new">填写进展</div>\n	<div class="share-new" data-name="task-detail-share-new-box"></div>\n</div>\n'}__p+='\n<ul data-name="task-detail-share-list"></ul>\n';if(isShowMore){__p+='\n<div class="task-detail-show-more" data-name="task-detail-share-more" >\n	<span class="txt" data-name="task-detail-share-more-text">展开</span>&nbsp;<span class="tip_title">全部进展</span>&nbsp;<em class="tu-icon-arrow-down" data-name="task-detail-share-icon"></em>\n</div>\n'}}return __p};this["JST"]["task-detail/task-task-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="task-detail-moduletitle">\n	<div class="icon tu-bg_c3">\n		<span class="tu-icon-task icon-dt"></span>\n	</div>\n	<div class="text tu-font-h4">'+((__t=iTask)==null?"":__t)+'(<span data-name="task-detail-task-total">'+((__t=total)==null?"":__t)+'</span>)</div>\n</div>\n\n\n<div class="module-content">\n	<div data-name="task-detail-task-add"></div>\n	<div data-name="task-detail-task-list"></div>\n	<div class="work_hour_content_wraper" data-name="task-detail-work-hour-list-box">\n		<ul data-name="task-detail-work-hour-list"></ul>\n		';if(isShowMore){__p+='\n		<div class="task-detail-show-more" data-name="task-detail-task-more" >\n			<span class="txt" data-name="task-detail-task-more-text">展开</span>&nbsp;<span class="tip_title">全部'+((__t=iTask)==null?"":__t)+'</span>&nbsp;<em class="tu-icon-arrow-down vertical-control" data-name="task-detail-task-icon"></em>\n		</div>\n		'}__p+="\n	</div>	\n"}return __p};this["JST"]["task-detail/task-title"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="_tt_moduletitle">\n	<div class="icon task"><b></b><em></em></div>\n	<div class="text">'+((__t=task_1)==null?"":__t)+'（<span class="tasknum">11</span>）</div>\n</div>'}return __p};this["JST"]["task-detail/task-track"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="task-detail-moduletitle">\n	<div class="icon tu-bg_c3">\n		<span class="tu-icon-wenjian icon-dt"></span>\n	</div>\n	<div class="text tu-font-h4">操作记录</div>\n</div>\n<div class="module-content" data-name="task-detail-task-track" ></div>'}return __p};this["JST"]["task-detail/task-travel-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-detail-moduletitle">\n	<div class="icon icon_purple">\n		<span class="tu-icon-airplane icon-dt"></span>\n	</div>\n	<div class="text">出差(<span data-name="task-detail-travel-total">'+((__t=total)==null?"":__t)+'</span>)</div>\n</div>\n\n\n<div class="module-content" data-name="task-travel-list">\n	<div class="_tt_loading_m">努力加载中…</div>\n</div>'}return __p};this["JST"]["task-detail/task-travel-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="common-list-item tu-bg-hv_m4 tu-ft_m1 tu-clearfix" data-name="list-item-left"> \n	<div class="common-item-title '+((__t=editable?"editable":"")==null?"":__t)+'" data-name="item-title">'+((__t=title)==null?"":__t)+"</div>\n	";if(editable){__p+='\n		<div class="common-item-title-edit input-default input-focus" data-name="item-edit">\n			<input type="text"  value="'+((__t=title)==null?"":__t)+'" data-name="item-title-input">\n		</div>\n	'}__p+='\n	<div class="common-list-item-right">\n		<div class="toggle-item-detail" data-name="toggle-item-detail">\n			';if(!open){__p+='\n				<a href="javascript:void(0)" class="txt">详情 <em class="tu-icon-arrow-down"></em></a>\n				\n			'}else{__p+='\n				<a href="javascript:void(0)" class="txt">收起 <em class="tu-icon-arrow-up"></em></a>\n			'}__p+="\n		</div>\n	";if(editable){__p+='\n		<span class="item-delete-wraper">\n			<a href="javascript:void(0)" class="item-delete tu-icon-delete" id="'+((__t=id)==null?"":__t)+'" data-name="item-delete"></a>\n		</span>\n	'}__p+='\n	</div>\n	\n</div>\n<!-- <div >\n	\n</div> -->\n<div class="common-list-item-detail tu-bg_m4" data-name="item-detail" style="display:';if(open){__p+="block"}else{__p+="none"}__p+='">\n	<div class="common-list-item-detail__left">\n		<div class="detail-item clearfix">\n			<span class="detail-item-left">创建人:</span>\n			<span class="detail-item-right">'+((__t=publisher.name)==null?"":__t)+"</span>\n		</div>\n\n		";if(editable){__p+='\n			<div class="detail-item clearfix" data-name="contract-user">\n				<span class="detail-item-left">外部联系人：</span>\n				<div class="detail-item-right">\n					';if(contractUser){__p+='\n					<span class="contractUserTitle">'+((__t=contractUser)==null?"":__t)+'</span>\n					<div class="contract-wraper tu-input-default tu-input-focus" data-name="contract-edit">\n						<input  type="text"  value="'+((__t=contractUser)==null?"":__t)+'" data-name="contract-edit-input">\n					</div>\n					'}else{__p+='\n						<a href="javascript:void(0)" data-name="addContractUser">添加</a>\n						<span class="contractUserTitle" style="display:none"></span>\n						<div class="contract-wraper tu-input-default tu-input-focus"  data-name="contract-edit">\n							<input  type="text"  value="'+((__t=contractUser)==null?"":__t)+'" data-name="contract-edit-input">\n						</div>\n					'}__p+="\n				</div>\n			</div>\n		"}else if(contractUser){__p+='\n			<div class="detail-item clearfix" data-name="contract-user">\n				<span class="detail-item-left">外部联系人：</span>\n				<div class="detail-item-right">\n					'+((__t=contractUser)==null?"":__t)+"\n				</div>\n			</div>\n		"}else{__p+='\n			<div class="detail-item clearfix" data-name="contract-user">\n				<span class="detail-item-left">外部联系人：</span>\n				<div class="detail-item-right">\n					<span class="no-message">暂无信息</span>\n				</div>\n			</div>\n		'}__p+='\n	</div>\n	\n	<div class="common-list-item-detail__right">\n		<div class="detail-item clearfix" data-name="item-time">\n			<span class="detail-item-left">时间：</span>\n			<div class="detail-item-right item-time" data-name="detail-time-right">\n				<span  data-body="起止时间：'+((__t=startDate)==null?"":__t)+" - "+((__t=endDate)==null?"":__t)+'">\n					<span class="'+((__t=editable?"link-style":"")==null?"":__t)+'" data-name="startDate">'+((__t=startDate)==null?"":__t)+'</span>\n					 - \n					<span class="'+((__t=editable?"link-style":"")==null?"":__t)+'" data-name="endDate">'+((__t=endDate)==null?"":__t)+"</span>\n				</span>\n				";if(editable){__p+='\n					<a href="javascript:void(0)" class="item-time__edit" data-name="item-time-container">编辑</a>\n				'}__p+="\n			</div>\n		</div>\n\n		";if(viewType==1){__p+="\n			";if(editable){__p+='\n				<div class="detail-item">\n					<span class="detail-item-left">参与人：</span>\n					<div class="detail-item-right" data-name="detail-participator">\n						\n					</div>\n				</div>\n			'}else if(!editable&&participantUsers&&participantUsers.length){__p+='\n				<div class="detail-item">\n					<span class="detail-item-left">参与人：</span>\n					<div class="detail-item-right">\n						';_.each(participantUsers,function(user){__p+="\n							"+((__t=user.name)==null?"":__t)+"\n						"});__p+="\n					</div>\n				</div>\n			"}else{__p+='\n				<div class="detail-item">\n					<span class="detail-item-left">参与人：</span>\n					<div class="detail-item-right">\n						<span class="no-message">暂无信息</span>\n					</div>\n				</div>\n			'}__p+="\n		"}__p+='\n	</div>\n	\n	<div class="common-list-item-detail__bottom clearfix">\n		<div class="detail-item clearfix">\n			<span class="detail-item-left">备注:</span>\n			<div class="detail-item-right">\n				';if(editable){__p+='\n					<div data-name="detail-description" class="detail-description editor-style editable" ';if(!description){__p+='style="display:none;"'}__p+=">"+((__t=description)==null?"":__t)+'</div>\n					<div data-name="richeditor-area-wrap" class="richeditor-area-wrap">\n						<div  data-name="richeditor-area" id="task-travel-list-item-'+((__t=timestamp)==null?"":__t)+'" style="display:none;"></div>\n					</div>\n					<a href="javascript:void(0)" data-name="add-description-btn" ';if(description){__p+='style="display:none;"'}__p+=">添加</a>\n				"}else{__p+='\n					<div class="detail-description editor-style">';if(description){__p+=(__t=description)==null?"":__t}else{__p+='<span class="no-message">暂无信息</span>'}__p+="</div>\n				"}__p+="\n				\n			</div>\n		</div>\n\n		";if(attachments&&attachments.length||editable){__p+='\n			<div class="detail-item clearfix">\n				<span class="detail-item-left">附件：</span>\n				<div data-name="detail-attachment" class="detail-item-right uploader_container '+((__t=editable?"addFileClass":"")==null?"":__t)+'">\n				</div>\n			</div>\n		'}else{__p+='\n			<div class="detail-item clearfix">\n				<span class="detail-item-left">附件：</span>\n				<div data-name="detail-attachment" class="detail-item-right uploader_container">\n					<span class="no-message">暂无附件</span>\n				</div>\n			</div>\n		'}__p+="\n	</div>\n</div>"}return __p};this["JST"]["task-detail/task-travel-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div data-name="task-create-container"></div>\n<ul class="task-detail-common-list-module" data-name="task-detail-travel-list">\n</ul>'}return __p};this["JST"]["task-detail/task-unaccept"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+="\n";if(relation==2&&!isAccept){__p+='\n	<div class="ux_edittask_accept">\n		<div class="ux_edittask_accept_local">\n			<div class="width238">\n				<button href="javascript:void(0)" class="tu-btn tu-btn-larger tu-btn-sure" data-name="participate-task">参与'+((__t=i18n.task_1)==null?"":__t)+'</button>\n				<button href="javascript:void(0)" class="tu-btn tu-btn-larger tu-ml-20" data-name="refuse-task">不参与</button>\n			</div>\n		</div>\n	</div>\n'}else{__p+="\n	";if(!isAccept&&isTransfer==false){__p+='\n		<div class="ux_edittask_accept">\n			<div class="ux_edittask_accept_local" data-name="accept-container">\n				<div class="width238" >\n					<button href="javascript:void(0)" class="tu-btn tu-btn-larger tu-btn-sure" data-name="accept-task" data-type="2">接受'+((__t=i18n.task_1)==null?"":__t)+'</button>\n					<button class="tu-btn tu-btn-larger tu-ml-20" data-name="transfer-task">转交他人</button>\n				</div>\n				<div data-name="accept-area"></div>\n			</div>\n		</div>\n	'}__p+="\n	";if(isTransfer==true){__p+='\n		<div class="ux_edittask_accept">\n			<div class="ux_edittask_accept_other" data-name="ux-edittask-appe" >\n				<span>此'+((__t=i18n.task_1)==null?"":__t)+"转交给"+((__t=_.substring(transferUser.name,6,true))==null?"":__t)+'负责</span>\n				<a href="javascript:void(0)" class="tu-btn tu-btn-small tu-btn-sure" data-name="sure-transfer">确定</a>\n				<a href="javascript:void(0)" class="tu-btn tu-btn-small" data-name="cancel-transfer">取消</a>\n			</div>\n		</div>	\n	'}__p+="\n"}__p+="\n"}return __p};this["JST"]["task-detail/task-work-hour-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<div class="task-detail-moduletitle">\n	<div class="icon tu-bg_warning">\n		<span class="tu-icon-stop-watch icon-dt"></span>\n	</div>\n	<div class="text tu-font-h4">工时(<span data-name="task-detail-work-hour-total">'+((__t=workHourTotal)==null?"":__t)+'</span>)</div>\n</div>\n\n\n<div class="module-content task-detail" data-name="task-detail-work-hour-list">\n	<div class="_tt_loading_m">努力加载中…</div>\n\n'}return __p};this["JST"]["task-detail/task-work-hour-list-item-detail"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="description clearfix">\n	<span class="title">备注</span>\n	<div class="content">\n		';if(editable){__p+='\n			<a href="javascript:void(0)"  data-name="task-detail-workhour-des-add" style="display:'+((__t=!description||description==""?"":"none")==null?"":__t)+'">添加</a>\n			<div data-name="task-detail-workhour-des-edit" class="des_text editor-style"  style="display:'+((__t=!description||description==""?"none":"")==null?"":__t)+'">'+((__t=description)==null?"":__t)+'</div>\n			<div data-name="task-detail-workhour-des-rich-wrap">\n			<div class="" data-name="task-detail-workhour-des-rich" id="task-detail-workhour-des-rich-item-'+((__t=timestamp)==null?"":__t)+'"></div>\n			</div>\n		'}else{__p+='\n			<div class="redactor_editor editor-style">\n				';if(description){__p+="\n					"+((__t=description)==null?"":__t)+"\n				"}else{__p+="\n					未添加备注\n				"}__p+="\n			</div>\n		"}__p+="\n	</div>\n</div>\n";if(attachments.length||editable){__p+='\n	<div class="description clearfix">\n		<span class="title">附件</span>\n		<div class="content uploader_container" data-name="task-detail-work-hour-attachment-add">\n			<div data-name="task-detail-workhour-attachment-list"></div>\n		</div>\n	</div>\n'}}return __p};this["JST"]["task-detail/task-work-hour-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="item-box clearfix">\n	<div class="item_left">\n		<div class="name_il" data-name="task-detail-workhour-name">'+__e(name)+"</div>\n		";if(editable){__p+='\n		<div class="name_input input-default input-focus" data-name="task-detail-workhour-name-input">\n			<input type="text"/>\n		</div>\n		'}__p+='\n	</div>\n	<div class="task_item_right" data-name="task-detail-workhour-right">\n		';if(editable){__p+='\n			<span class="work_hour ';if(isLoginUser){__p+="pointer"}__p+='" id="'+((__t=id)==null?"":__t)+'"  data-name="task-detail-workhour-hour">'+((__t=hoursTotal)==null?"":__t)+"h</span>\n		"}else{__p+='\n			<span class="work_hour ';if(isLoginUser){__p+="pointer"}__p+='" >'+((__t=hoursTotal)==null?"":__t)+"h</span>\n		"}__p+="\n		";if(editable){__p+='\n			<span class="date_il ';if(isLoginUser){__p+="pointer"}__p+='" id="'+((__t=id)==null?"":__t)+'" data-name="task-detail-workhour-date" >'+((__t=time)==null?"":__t)+"</span>\n		"}else{__p+='\n			<span class="date_il" id="'+((__t=id)==null?"":__t)+'" >'+((__t=time)==null?"":__t)+"</span>\n		"}__p+="\n		";if(editable){__p+='\n			<span class="del_il">\n					<a href="javascript:void(0)" id="'+((__t=id)==null?"":__t)+'" data-name="task-detail-workhour-delete" class="tu-icon-delete"></a>\n			</span>\n		'}__p+='\n\n		<span class="detail_il" data-name="task-detail-workhour-item-detail-btn">\n			<span class="txt">详情</span>\n			<em class="tu-icon-arrow-down icon-arrow"></em>\n		</span>\n		\n	</div>\n</div>\n<div  data-name="task-detail-workhour-item-detail-box">\n	\n</div>'}return __p};this["JST"]["task-detail/task-work-hour-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="title_wh">\n	<div class="left">\n		'+((__t=_.convertImage({className:"radius_img30 avatar",src:user.avatar.Small,size:30,name:user.name,bgColor:user.avatar.Color}))==null?"":__t)+"\n		<span >"+((__t=user.name)==null?"":__t)+'的工时总计：</span>\n	</div>\n	<span class="work_hour" data-name="task-detail-work-hour-total">'+((__t=totalHours)==null?"":__t)+'h</span>\n	<div class="right" data-name="task-detail-work-hour-user-toggle">\n		';if(showList){__p+='\n			<span class="txt">收起</span>\n			<em class="tu-icon-arrow-up icon-arrow" data-name="task-detail-work-hour-user-toggle-ico"></em>\n		'}else{__p+='\n			<span class="txt">详情</span>\n			<em class="tu-icon-arrow-down icon-arrow" data-name="task-detail-work-hour-user-toggle-ico"></em>\n		'}__p+='\n	</div>\n</div>\n<div class="work_hour_content_wraper" data-name="task-detail-work-hour-list-box" ';if(showList){__p+='style="display:block"'}else{__p+='style="display:none"'}__p+='>\n	<ul data-name="task-detail-work-hour-list"></ul>\n	';if(isShowMore){__p+='\n	<div class="task-detail-show-more" data-name="task-detail-work-hour-more" >\n		<span class="txt" data-name="task-detail-work-hour-more-text">展开</span>&nbsp;<span class="tip_title">全部工时</span>&nbsp;<em class="tu-icon-arrow-down" data-name="task-detail-work-hour-icon"></em>\n	</div>\n	'}__p+="\n</div>	\n\n\n\n"}return __p};this["JST"]["task-detail/user-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<em class="ux_add_btn tu-btn tu-btn-mini tu-btn-add tu-icon-add"></em>\n<ul></ul>'}return __p};this["JST"]["task-list/plan-item-status"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='\n<ul>\n	<li status="2"><a href="javascript:void(0);" title="">\n		<span class="ico icon-taskStatus'+((__t=isChildTask?"-s":"")==null?"":__t)+'-2"></span>已完成\n	</a></li>\n	<li status="1"><a href="javascript:void(0);" title="" >\n		<span class="ico icon-taskStatus'+((__t=isChildTask?"-s":"")==null?"":__t)+'-1"></span>进行中</a></li>\n	<li status="4"><a href="javascript:void(0);" title="" >\n		<span class="ico icon-taskStatus'+((__t=isChildTask?"-s":"")==null?"":__t)+'-4"></span>已取消\n	</a></li>\n	<li status="3"><a href="javascript:void(0);" title="" >\n		<span class="ico icon-taskStatus'+((__t=isChildTask?"-s":"")==null?"":__t)+'-3"></span>已延迟\n	</a></li>\n	<li status="6"><a href="javascript:void(0);" title="" >\n		<span class="ico icon-taskStatus'+((__t=isChildTask?"-s":"")==null?"":__t)+'-6"></span>暂停中\n	</a></li>\n	<li status="0"><a href="javascript:void(0);" title="" >\n		<span class="ico icon-taskStatus'+((__t=isChildTask?"-s":"")==null?"":__t)+'-0"></span>未开始\n	</a></li>\n</ul>\n\n\n\n\n\n'}return __p};this["JST"]["task-list/task-list-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="list-li" data-name="list-item">\n	';if(drag){__p+='\n	<span class="handle tu-icon-a1 tu-icon-three-point-shu2"></span>\n	'}__p+='\n	<div class="right_ttpl">\n	\n	';if(moveTop&&showMoveTopBtn){__p+='\n		<span data-name="move-top" data-toggle="infotip"  data-body="移至最前" class="tu-icon-a1 tu-icon-angleup-circle move-top"></span>\n	'}__p+="\n	";if(isShowKclass){__p+="\n		";if(editLableable){__p+='\n			<div class="klass_box_ttpl pointer tu-ft_m2" data-id="'+((__t=taskId)==null?"":__t)+'" data-name="update-klass" data-lab="'+((__t=labelId)==null?"":__t)+'" data-type="'+((__t=labelType)==null?"":__t)+'">\n		'}else{__p+='\n			<div class="klass_box_ttpl tu-ft_m2">\n		'}__p+='\n		<div class="kclass" data-name="kclass-area"></div>\n		';if(labelName&&labelName!="未分类"){__p+="\n			";if(labelType==4){__p+="\n				";if(appId==402){__p+='\n				<span class="sys-icon-mubiao app-icon mubiao-app"></span>\n				'}else if(appId==203){__p+='\n				<span class="sys-icon-zhiwei app-icon zhiwei-app"></span>\n				'}else if(appId==902){__p+='\n				<span class="sys-icon-shenpi app-icon shenpi-app"></span>\n				'}else{__p+='\n				<span class="sys-icon-xiangmu app-icon"></span>\n				'}__p+='\n				<span class="klass_ttpl">'+((__t=_.substringWithM(labelName,8,false))==null?"":__t)+"</span>  \n			"}else{__p+='\n				<span class="tu-icon-squares ico-eb"></span>\n				<span class="klass_ttpl">'+((__t=_.substringWithM(labelName,10,false))==null?"":__t)+"</span>  \n			"}__p+="\n		"}__p+="\n		</div>\n	"}__p+="\n			\n\n	";if(status==2&&evaluateModel){__p+="\n		"+((__t=_.TitaWidget_evaluation(evaluateModel,{showStar:true}))==null?"":__t)+"\n	"}else{__p+="\n		\n		";if(!isLongTerm){__p+="\n			";if(status==2){__p+='\n				<span class="date tu-ft_m3">'+((__t=deadLine)==null?"":__t)+"</span>\n			"}else{__p+="\n				";if(ables.date){__p+='\n					<span data-name="date" data-id="'+((__t=taskId)==null?"":__t)+'" class="date tu-ft_m3 tu-cp '+((__t=isDeadLine?"expire":fromNow==1?"warn":"")==null?"":__t)+'" >\n						<span data-toggle="infotip" data-body="修改时间" >'+((__t=fromNow>0&&fromNow<4?"剩余"+fromNow+"天":deadLine)==null?"":__t)+"</span>\n					</span>\n				"}else{__p+='\n					<span class="date tu-ft_m3 '+((__t=isDeadLine?"expire":fromNow==1?"warn":"")==null?"":__t)+'" >\n						<span >'+((__t=fromNow>0&&fromNow<4?"剩余"+fromNow+"天":deadLine)==null?"":__t)+"</span>\n					</span>\n				"}__p+="\n			"}__p+="\n		"}else{__p+="\n			";if(ables.date){__p+='\n			<span class="date tu-cp tu-ft_m3" data-name="date" data-id="'+((__t=taskId)==null?"":__t)+'">\n				<span  data-toggle="infotip" data-body="修改时间" >长期</span>\n			</span>\n			'}else{__p+='\n			<span class="date tu-ft_m3">长期</span>\n			'}__p+="\n		"}__p+="\n\n		";if(ables.principal){__p+='\n			<span data-name="principle" class="principle tu-cp tu-ft_m3" data-id="'+((__t=taskId)==null?"":__t)+'" >\n				<span data-toggle="infotip" data-body="转交负责人">'+((__t=_.TitaWidget_substring(principalUser.name,6,true,2))==null?"":__t)+"</span>\n			</span>\n		"}else{__p+='\n			<span data-name="principle" class="principle tu-ft_m3" >'+((__t=_.TitaWidget_substring(principalUser.name,6,true,2))==null?"":__t)+"</span>\n		"}__p+="\n\n		";if(isShowStar){__p+="\n			";if(isMark){__p+='\n				<span class="sup-set-mark tu-icon-a1 tu-icon-star-solid tu-cp active" data-toggle="infotip" data-body="取消星标" data-id="'+((__t=taskId)==null?"":__t)+'" data-name="set-mark"></span>\n			'}else{__p+='\n				<span class="sup-set-mark tu-icon-a1 tu-icon-star tu-cp" data-toggle="infotip" data-body="标为星标" data-id="'+((__t=taskId)==null?"":__t)+'" data-name="set-mark"></span>\n			'}__p+="\n		"}__p+="\n		";if(isShowDelete){__p+="\n			";if(deleteable){__p+='\n				<span class="sup-delete"  data-name="plan-delete" data-id="'+((__t=taskId)==null?"":__t)+'">删除</span>\n			'}else{__p+='	\n				<span class="sup-delete-placeholder"></span>\n			'}__p+="\n		"}__p+="\n	"}__p+='\n	</div>\n\n	<div class="left_left">\n		';if(hasSubTask||typeof tasks!=="undefined"&&tasks.length){__p+="\n			";if(typeof tasks!=="undefined"&&tasks.length){__p+='\n				<span data-id="'+((__t=taskId)==null?"":__t)+'" data-name="packup" class="packup tu-ft_m3 tu-icon-a1 '+((__t=currentDeploy?"tu-icon-pack-up":"tu-icon-open")==null?"":__t)+'"></span>\n			'}else{__p+='\n				<span data-id="'+((__t=taskId)==null?"":__t)+'" data-name="packup" class="packup tu-ft_m3 tu-icon-a1 tu-icon-open"></span>\n			'}__p+="\n		"}__p+="\n		";if(isApply){__p+='\n			<div class="apply_status icon-approval"></div>\n		'}else{__p+='\n			<span class="status_ttpl_wraper">	\n				<a href="javascript:void(0);" class="status_ttpl tu-icon-a1 '+((__t=StatusIcon)==null?"":__t)+" "+((__t=editStatusable?"tu-ft_c3":"disable tu-ft_m3")==null?"":__t)+" "+((__t=editStatusable?"":"status_disabled")==null?"":__t)+'" data-toggle="infotip" data-tip="'+((__t=StatusTip)==null?"":__t)+'" data-id="'+((__t=taskId)==null?"":__t)+'"><span class="ico"></span></a>\n				\n			</span>\n		';

}__p+='\n		\n			\n			\n	</div>\n	<div class="left_ttpl '+((__t=isChildTask?"p1":isShowKclass?"p3":"p2")==null?"":__t)+'">\n		\n		';if(status==2||status==4||status==6){__p+="\n			";if(isPush){__p+='\n				<span  id="'+((__t=taskId)==null?"":__t)+'" data-name="taskName" class="tu-ft_m3 '+((__t=isChildTask?"child":"")==null?"":__t)+' task-name disable tu-ft_m3">'+((__t=taskName)==null?"":__t)+"</span>\n			"}else{__p+='\n				<a id="'+((__t=taskId)==null?"":__t)+'" href="'+((__t=taskUrl)==null?"":__t)+'" target="_blank" class="tu-ft_m3 '+((__t=isChildTask?"child":"")==null?"":__t)+' task-name tu-ft_m3 disable">'+((__t=taskName)==null?"":__t)+"</a>\n			"}__p+="\n			\n		"}else{__p+="\n			";if(isPush){__p+='\n				<span id="'+((__t=taskId)==null?"":__t)+'" data-name="taskName" class="'+((__t=isChildTask?"child":"")==null?"":__t)+" task-name "+((__t=isDeadLine?"warn":"tu-ft_m1")==null?"":__t)+' tu-ft_m2 tu-ft-hv_c2">'+((__t=taskName)==null?"":__t)+"</span>\n			"}else{__p+='\n				<a id="'+((__t=taskId)==null?"":__t)+'" href="'+((__t=taskUrl)==null?"":__t)+'" class="'+((__t=isChildTask?"child":"")==null?"":__t)+" task-name "+((__t=isDeadLine?"warn":"tu-ft_m1")==null?"":__t)+' tu-ft_m2 tu-ft-hv_c2" target="_blank">'+((__t=taskName)==null?"":__t)+"</a>\n			"}__p+="\n		"}__p+="\n		";if(cycleId>0){__p+='\n			<span class="task-cycle tu-icon-refresh tu-icon-a1 tu-mr-10 tu-ft_m3 tu-ft-hv_f2"  data-name="task-cycle" data-id="'+((__t=taskId)==null?"":__t)+'" data-cys="'+((__t=cycleId)==null?"":__t)+'"></span>\n		'}__p+="\n\n		";if(appId==203||appId==902){__p+='\n			<span class="ico-position ico-position-'+((__t=taskType)==null?"":__t)+' tu-mr-10">\n				'+((__t={6:"面",7:"offer",8:"职",16:"筛",20:"审",21:"申"}[taskType])==null?"":__t)+"\n			</span>\n		"}__p+="\n		";if(isShowOwnerTag){__p+="\n			";if(userRelation==1){__p+='\n				<span class="mine-tag task-tag tu-ml_10 tu-mr-10 tu-font-a2">'+((__t=quirkOwnerTag?"ta":"我")==null?"":__t)+"派发的</span>\n			"}else if(userRelation==2){__p+='\n				<span class="task-tag tu-mr-10 tu-font-a2">上级安排</span>\n			'}else if(userRelation==3){__p+='\n				<span class="join-tag task-tag tu-mr-10 tu-font-a2">'+((__t=quirkOwnerTag?"ta":"我")==null?"":__t)+"参与的</span>\n			"}else{__p+="\n			"}__p+="\n		"}__p+="\n\n		";if(counter.workTimeTotal&&isShowWorkTime){__p+="\n			";if(ables.workTime){__p+='\n				<span data-id="'+((__t=taskId)==null?"":__t)+'" data-name="add-workTime" class="work_hour tu-cp tu-ft_m3 tu-ft-hv_f5"  data-toggle="infotip" data-body="点击添加工时">'+((__t=counter.workTimeTotal)==null?"":__t)+"h</span>\n			"}else{__p+='\n				<span class="work_hour tu-ft_m3">'+((__t=counter.workTimeTotal)==null?"":__t)+"h</span>\n			"}__p+="\n		"}__p+="\n		";if(counter.taskTotal>0||counter.experienceTotal>0||counter.commentTotal>0){__p+='\n		<div class="all-icons tu-mr-10">\n			';if(counter.taskTotal>0&&isShowTaskTotal){__p+="\n				";if(ables.workTime){__p+='\n					<span data-id="'+((__t=taskId)==null?"":__t)+'" data-name="add-task" class="tu-icon-a1 tu-icon-task icon tu-cp tu-ft_m3 tu-ft-hv_f5" data-toggle="infotip" data-body="点击分解任务">'+((__t=counter.finishTaskTotal)==null?"":__t)+"/"+((__t=counter.taskTotal)==null?"":__t)+"</span>\n				"}else{__p+='\n					<span class="tu-icon-a1 tu-icon-task icon tu-ft_m3" data-toggle="infotip" data-body="有任务">'+((__t=counter.finishTaskTotal)==null?"":__t)+"/"+((__t=counter.taskTotal)==null?"":__t)+"</span>\n				"}__p+="\n			"}__p+="\n			\n			";if(counter.experienceTotal>0&&isShowExperienceTotal){__p+="\n				";if(ables.experience){__p+='\n				<span data-id="'+((__t=taskId)==null?"":__t)+'" data-name="add-experience" data-tip="点击查看最近进展" class="tu-icon-a1 tu-icon-xinde icon tu-cp tu-ft-hv_f5 tu-ft_m3">'+((__t=counter.experienceTotal)==null?"":__t)+"</span>\n				"}else{__p+='\n					<span class="tu-icon-a1 tu-icon-xinde icon tu-ft_m3" data-toggle="infotip" data-body="有进展">'+((__t=counter.experienceTotal)==null?"":__t)+"</span>\n				"}__p+="\n			"}__p+="\n\n			";if(counter.commentTotal>0&&isShowCommentTotal){__p+="\n				";if(ables.comment){__p+='\n					<span data-id="'+((__t=taskId)==null?"":__t)+'" data-name="add-comment" data-tip="点击查看最近沟通"  class="tu-icon-a1 tu-icon-talk icon tu-cp tu-ft-hv_f5 tu-ft_m3">'+((__t=counter.commentTotal)==null?"":__t)+"</span>\n				"}else{__p+='\n					<span class="tu-icon-talk icon tu-ft_m3" data-name="add-comment">'+((__t=counter.commentTotal)==null?"":__t)+"</span>\n				"}__p+="\n			"}__p+="\n		</div>\n		"}__p+='\n		<div class="all-icons">\n			';if(!counter.taskTotal&&isShowTaskTotal&&ables.addTask){__p+='\n				<span class="tu-icon-a1 tu-icon-task new tu-cp tu-ft-hv_f5 tu-ft_m3" data-toggle="infotip" data-body="点击分解任务" data-id="'+((__t=taskId)==null?"":__t)+'" data-name="add-task"><span class="tu-icon-add2 add-ico"></span></span>\n			'}__p+="\n			";if(!counter.commentTotal&&isShowCommentTotal&&ables.comment){__p+='\n				<span class="tu-icon-a1 tu-icon-talk new tu-cp tu-ft-hv_f5 tu-ft_m3" data-toggle="infotip" data-body="点击快速回复" data-id="'+((__t=taskId)==null?"":__t)+'" data-name="add-comment"><span class="tu-icon-add2 add-ico"></span></span>\n			'}__p+='\n		</div>\n	</div>	\n</div>\n<div class="child-list-wraper '+((__t=isChildTask?"p3":isShowKclass?"p1":"p2")==null?"":__t)+'">\n	\n	<ul class="child-list '+((__t=currentDeploy?"":"hide")==null?"":__t)+'  "></ul>\n</div>'}return __p};this["JST"]["task-list/task-list-quick-comment"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="tu-font-a2 tu-mt-5 tu-cf">\n	最新'+((__t=typeName)==null?"":__t)+'：\n	<span class="tu-icon-cross2 tu-icon-a4 tu-fr tu-ft-hv_f1 tu-cp" data-name="closed"></div>\n</div>\n<div class="quick-cat__content tu-font-a2 tu-mt-5 tu-ft_m6">'+((__t=content)==null?"":__t)+'</div>\n<div class="tu-font-a2 tu-mt-5 tu-ft_m3">'+((__t=_.substringWithM(publishUser.name,12,true))==null?"":__t)+" "+((__t=createTime)==null?"":__t)+'</div>\n<div class="quick-cat__button tu-cf tu-font-a2 tu-ft_m4 tu-tac tu-mt-15">\n	<span data-name="quick-comment-all" class="quick-cat__btn tu-dib tu-fl tu-cp">查看所有'+((__t=typeName)==null?"":__t)+'</span>\n	<span data-name="quick-comment-add" class="quick-cat__btn tu-dib tu-fl tu-ml-10 tu-cp">快速添加'+((__t=typeName)==null?"":__t)+"</span>\n</div>"}return __p};this["JST"]["task-list/task-list"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<ul class="list-container">\n\n</ul>\n<div class="showmore" data-name="showmore">\n	<a href="javascript:void(0);"  class="text_fsm">\n		<span>查看更多</span>\n	</a>\n</div>'}return __p};this["JST"]["tdialog/dialog"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="arrow"></div>\n';if(settings.showClosed){__p+='\n	<span class="icon-dialog-closed closed_dialog"></span>\n'}__p+='\n<div class="content_dialog"></div>\n\n';if(settings.sure!=false||settings.cancel!=false){__p+='\n<div class="uibutton">\n	';if(settings.sure){__p+='\n		<a data-bypass href="'+((__t=settings.sureLink?settings.sureLink:"javascript:void(0);")==null?"":__t)+'"   class="btn btn-sure sure_dialog">'+((__t=settings.sureText)==null?"":__t)+"</a>\n		"}__p+="\n	";if(settings.cancel){__p+='\n	<a href="javascript:void(0);" title="" class="btn btn-cancel cancel_dialog">'+((__t=settings.cancelText)==null?"":__t)+"</a>\n	"}__p+="\n</div>\n"}}return __p};this["JST"]["uploader/existFile-component"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="left_afb">\n        ';if(isImage){__p+='\n        <img src="'+((__t=smallUrl)==null?"":__t)+'" class="img_afb">\n        '}else{__p+='\n        <span class="ico_afb tu-icon-'+((__t=fileType)==null?"":__t)+'" style="color:'+((__t=iconColor)==null?"":__t)+'"></span>\n        '}__p+='\n    </div>\n    <div class="center_afb">\n        <div class="name">\n            <span data-name="name_up" data-toggle="infotip" data-body="'+((__t=fileFullName)==null?"":__t)+'">'+((__t=fileName)==null?"":__t)+'</span>\n        </div>\n    </div>\n    <div class="right_afb">\n        <a href="'+((__t=DownloadUrl)==null?"":__t)+'" class="tu-icon-download-circle action-iocn" data-toggle="infotip" data-body="下载" ';if(documentSource==3){__p+='target="_blank" '}__p+="></a>&nbsp;\n        ";if(IsPreview){__p+="\n            ";if(isImage&&documentSource==1){__p+='\n                <a href="'+((__t=PreviewUrl)==null?"":__t)+'" class="tu-icon-magnifier-circle action-iocn" data-toggle="infotip" data-name="feed-attachment-preview" data-body="预览"  target="_blank"></a>\n            '}else{__p+='\n                <a href="';if(documentSource==1){__p+=(__t=webHost.host)==null?"":__t}__p+=((__t=PreviewUrl)==null?"":__t)+'" data-toggle="infotip" class="tu-icon-magnifier-circle action-iocn" data-body="预览" target="_blank"></a>&nbsp;\n            '}__p+="\n        "}__p+="\n        ";if(deleteable){__p+='\n            <a href="javascript:void(0);" data-name="attachment-deleted" class="tu-icon-cross action-iocn" data-toggle="infotip" id="'+((__t=DocumentId)==null?"":__t)+'" data-body="删除"></a>&nbsp;\n        '}__p+="\n    </div>\n    "}return __p};this["JST"]["uploader/uploader-component-preview-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='\n<div class="cont_up">\n	<div class="left_up" data-name="tita-upload-preview-icon">\n		<span class="tu-icon-'+((__t=fileType)==null?"":__t)+' ico_up" style="color:'+((__t=iconColor)==null?"":__t)+'"></span>	\n	</div>\n	<div class="center_up">\n		<div class="name" >\n			<span data-toggle="infotip" data-body="'+((__t=fileFullName)==null?"":__t)+'">'+((__t=fileFullName)==null?"":__t)+'</span>\n			<span class="status" data-name="status-tip">\n			';if(!verifyStatus){__p+='\n			<span class="status-error">'+((__t=verifyErrorMsg)==null?"":__t)+"</span>\n			"}__p+="\n			</span>\n		</div>\n		";if(uploadStatus==2){__p+='\n		<div class="progress">\n			<div class="progress-bar" style="width: '+((__t=percentComplete)==null?"":__t)+'%"></div>\n		</div>\n		'}__p+='\n	</div>\n	<div class="right_up">\n		';if(uploadStatus==4&&verifyStatus){__p+='\n		<a href="javascript:void(0);" class="tu-icon-restart－circle action-iocn " data-name="tita-upload-reUpload" data-toggle="infotip" data-body="重新上传"></a>\n		'}__p+="\n		";if(uploadStatus==2){__p+='\n		<a href="javascript:void(0);" class="tu-icon-cross action-iocn action-iocn-delete" data-toggle="infotip" data-name="tita-upload-deleted" data-body="取消上传"></a>\n		'}__p+="\n		";if(uploadStatus==3&&downloadUrl&&isFromYFY){__p+='\n			<a href="'+((__t=downloadUrl)==null?"":__t)+'" class="tu-icon-magnifier-circle action-iocn " data-toggle="infotip" data-body="预览" target="_blank"></a>\n		'}else if(uploadStatus==3&&isImage){__p+='\n			<a href="javascript:void(0);" class="tu-icon-magnifier-circle action-iocn " data-name="tita-upload-img-preview" data-toggle="infotip" data-body="预览"></a>\n		'}__p+="\n		";if(uploadStatus>2){__p+='\n		<a href="javascript:void(0);" class="tu-icon-cross action-iocn action-iocn-delete" data-toggle="infotip" data-name="tita-upload-deleted" data-body="删除"></a>\n		'}__p+="\n	</div>\n</div>\n\n\n\n"}return __p};this["JST"]["uploader/uploader-component"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<a href="javascript:void(0);" title="" class="upload_node ';if(!openYFY){__p+="upload_new_file"}__p+='" data-name="file">\n	<i class="tu-icon-cus-fujian"></i>\n	附件\n</a>\n';if(openYFY){__p+='\n	<div class="tt_upload_type_container" data-name="upload-type">\n		<dl class="upload_type_item"><span class="upload_new_file" data-name="dfs-upload">本地上传</span></dl>\n		<dl class="upload_type_item"><span id="fc_upload" class="fang_cloud_btn">亿方云上传</span></dl>\n	</div>\n'}}return __p};this["JST"]["uploader/yfy-login-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<iframe frameborder="0" name="yfy_login" style="display: none;"></iframe>\n<form action="'+((__t=host)==null?"":__t)+'/open/yfy_user/login" method="POST" target="yfy_login" style="display:none">\n    <input type="hidden" name="enterprise_id" value="'+((__t=enterprise_id)==null?"":__t)+'">\n    <input type="hidden" name="platform_id" value="'+((__t=platform_id)==null?"":__t)+'">\n    <input type="hidden" name="version" value="'+((__t=version)==null?"":__t)+'">\n    <input type="hidden" name="timestamp" value="'+((__t=timestamp)==null?"":__t)+'">\n    <input type="hidden" name="token" value="'+((__t=token)==null?"":__t)+'">\n    <input type="hidden" name="email" value="'+((__t=email)==null?"":__t)+'">\n</form>'}return __p};this["JST"]["work-hour/work-hour"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){__p+='<div class="task-create-work-hour-pop">\n	<div class="ux_hour_list">\n		<h2>小时</h2>\n		<div class="hour_list">\n			';for(var i=0;i<25;i++){__p+='\n				<a href="javascript:void(0)" ';if(hourDate!=""&&hourDate==i){__p+='class="current"'}__p+='data-time="'+((__t=i)==null?"":__t)+'">\n					';if(i<=9){__p+="\n						0"+((__t=i)==null?"":__t)+"\n					"}else{__p+="\n						"+((__t=i)==null?"":__t)+"\n					"}__p+="\n				</a>\n			"}__p+='\n			\n		</div>\n	</div>\n	<div class="ux_minite_list">\n		<h2>分钟</h2>\n		<div class="minite_list">\n			<a href="javascript:void(0)"  data-time="0" ';if(minuteDate!==""&&minuteDate==0){__p+='class="current"'}__p+='>00</a>\n			<a href="javascript:void(0)"  data-time="15" ';if(minuteDate==15){__p+='class="current"'}__p+='>15</a>\n			<a href="javascript:void(0)"  data-time="30" ';if(minuteDate==30){__p+='class="current"'}__p+='>30</a>\n			<a href="javascript:void(0)"  data-time="45" ';if(minuteDate==45){__p+='class="current"'}__p+=">45</a>\n		</div>\n	</div>\n</div>"}return __p};this["JST"]["year-month-week-dropdown/year-month-week-dropdown-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape,__j=Array.prototype.join;function print(){__p+=__j.call(arguments,"")}with(obj){if(type=="year"){__p+='\n    <li class="'+((__t=Active?"tt-timeDropdown__list-active":"")==null?"":__t)+' tt-timeDropdown__list-item tu-font-a2 tu-pt-5" data-name="select" data-type="year" data-id="'+((__t=GroupId)==null?"":__t)+'">'+((__t=GroupName)==null?"":__t)+" 年</li>\n"}else if(type=="month"){__p+="\n    ";if(TagId!=14){__p+='\n        <li class="'+((__t=Active?"tt-timeDropdown__list-active":"")==null?"":__t)+' tt-timeDropdown__list-item tu-font-a2 tu-pt-5" data-name="select" data-type="month" data-id="'+((__t=TagId)==null?"":__t)+'">\n            ';if(TagId==1){__p+="\n                "+((__t=TagName)==null?"":__t)+"\n            "}else{__p+="\n                "+((__t=TagName.replace(/[^0-9]/gi,""))==null?"":__t)+" 月\n            "}__p+="\n        </li>\n    "}__p+="\n"}else{__p+='\n    <li class="'+((__t=Active?"tt-timeDropdown__list-active":"")==null?"":__t)+' tt-timeDropdown__list-item tu-font-a2 tu-pt-5" data-name="select" data-type="week" data-id="'+((__t=PlanTableId)==null?"":__t)+'">\n        ';if(PlanTableType==4){__p+="\n            第 "+((__t=Name.replace(/[^0-9]/gi,""))==null?"":__t)+" 周\n        "}else{__p+="\n            "+((__t=Name)==null?"":__t)+"\n        "}__p+="\n    </li>\n"}__p+="\n"}return __p};this["JST"]["year-month-week-dropdown/year-month-week-dropdown"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;with(obj){__p+='<div class="tt-timeDropdown__title">\n    <ul>\n        <li class="tt-timeDropdown__title-item">年</li>\n        <li class="tt-timeDropdown__title-item">月</li>\n        <li class="tt-timeDropdown__title-item">周</li>\n    </ul>\n</div>\n<div class="tt-timeDropdown__content" data-name="timeDropdown__content">\n    \n</div>\n\n<div class="tt-timeDropdown__btn">\n    <button class="tu-btn tu-btn-small tu-btn-sure" data-name="sure">确定</button>\n</div>'}return __p};return this["JST"]}();var BaseCollection={request:function(options){var deferred=new Talent.$.Deferred;options=Talent._.extend({},options);options.url=options.url||this.url;options.url=Context.getApiUrl(options.url);if(options.mockData){action(options.mockData)}else{Talent.$.ajax(options).done(action)}return deferred.promise();function action(resp){var code=resp.Code;if(code==1){var data=resp.Data;if(resp.ExtendedData){data=Talent._.extend({},resp.Data,resp.ExtendedData)}deferred.resolve(data)}else{if(code==401){login()}deferred.reject(resp.Message)}}function login(){location.href=Context.getLoginUrl();throw new Error("401")}},requestV2:function(options){var deferred=new Talent.$.Deferred;options=Talent._.extend({},options);options.url=options.url||this.url;options.url=Context.getApiUrlV2(options.url);if(options.mockData){action(options.mockData)}else{Talent.$.ajax(options).done(action)}return deferred.promise();function action(resp){var code=resp.Code;if(code==1){var data=resp.Data;if(resp.ExtendedData){data=Talent._.extend({},resp.Data,resp.ExtendedData)}deferred.resolve(data)}else{if(code==401){}deferred.reject(resp.Message)}}function login(){location.href=Context.getLoginUrl();throw new Error("401")}},batch:function(options){var deferred=new Talent.$.Deferred;var urls=[];options=Talent._.extend({},options);options.url=options.url||this.url;for(var i=0;i<options.url.length;i++){urls.push(Context.getApiUrl(options.url[i]))}if(options.mockData){action(options.mockData)}else{Talent.$.ajax({url:Context.getApiUrl("batch"),type:"POST",headers:{"x-bs-batch":1},data:"['"+urls.join("','")+"']",contentType:"application/json; charset=UTF-8"}).done(action)}return deferred.promise();function action(resp){for(x in resp){resp[x].Data=eval("("+resp[x].Data+")")}deferred.resolve(resp)}},batchV2:function(options){var deferred=new Talent.$.Deferred;var urls=[];options=Talent._.extend({},options);options.url=options.url||this.url;for(var i=0;i<options.url.length;i++){urls.push(Context.getApiUrlV2(options.url[i]))}if(options.mockData){action(options.mockData)}else{Talent.$.ajax({url:Context.getApiUrl("batch"),type:"POST",headers:{"x-bs-batch":1},data:"['"+urls.join("','")+"']",contentType:"application/json; charset=UTF-8"}).done(action)}return deferred.promise();function action(resp){for(x in resp){resp[x].Data=eval("("+resp[x].Data+")")}deferred.resolve(resp)}}};var CommentV2={commentCount:4,feedFount:20,getCommentGet:function(options){var defaults={feed_id:"",comment_type:0};var options=Talent._.extend({},defaults,options);var url="comment/Get";var defeered=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"]+"&comment_type="+options["comment_type"];BaseCollection.requestV2({url:url+params,type:"Get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},postCommentAdd:function(options){var defaults={FeedId:"",CommentId:"",Content:"",FileUrl:"",ObjId:"",ObjType:""};var options=Talent._.extend({},defaults,options);var url="comment/Add";var defeered=new Talent.$.Deferred;BaseCollection.requestV2({url:url,type:"Post",data:options}).done(function(resp){defeered.resolve(resp);if(options.ObjType===0){if(options.CommentId===0){Talent._.actionAnalysis("[feed-reply-success]",options.FeedId)}else{Talent._.actionAnalysis("[feed-reply-reply-success]"+options.FeedId,options.CommentId)}}}).fail(function(message){defeered.reject(message)});return defeered.promise()},getCommentGetByIds:function(options){var defaults={comment_id:""};var options=Talent._.extend({},defaults,options);var url="comment/GetByIds";var defeered=new Talent.$.Deferred;var params="?comment_id="+options["comment_id"];BaseCollection.requestV2({url:url+params,type:"get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteCommentGetByIds:function(options){var defaults={comment_id:"",feed_id:""};var options=Talent._.extend({},defaults,options);var url="comment/Delete";var defeered=new Talent.$.Deferred;var params="?comment_id="+options["comment_id"]+"&feed_id="+options["feed_id"];BaseCollection.requestV2({url:url+params,type:"DELETE"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getCommentRevGet:function(options){var defaults={count:"",comment_type:0,feed_id:""};var options=Talent._.extend({},defaults,options);var url="comment/RevGet";var defeered=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"]+"&comment_type="+options["comment_type"]+"&count="+options["count"];BaseCollection.requestV2({url:url+params,type:"Get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var EmotionCollection={getEmotionData:function(options){var self=this;var deferred=new Talent.$.Deferred;var defaults={};var options=Talent._.extend({},defaults,options);var url="tenant/Eomticon";if(this.emotionData){return deferred.resolve(this.emotionData)}BaseCollection.request({url:url,type:"get",data:options}).done(function(resp){deferred.resolve(resp.packages);self.emotionData=resp.packages}).fail(function(message){deferred.reject(message)});return deferred}};var ExperienceCollection={deleteShare:function(options){var url="Experience/Delete";var defaults={obj_id:"",obj_type:"7",experience_id:""};var options=Talent._.extend({},defaults,options);var params="?experience_id="+options["experience_id"]+"&obj_id="+options["obj_id"]+"&obj_type="+options["obj_type"];var defeered=new Talent.$.Deferred;BaseCollection.requestV2({url:url+params,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},editShareContent:function(options){var defaults={experience_id:"",content:""};var url="Experience/Update";var options=Talent._.extend({},defaults,options);var params="?experience_id="+options["experience_id"];var deferred=new Talent.$.Deferred;BaseCollection.requestV2({url:url+params,type:"POST",data:{content:options["content"]}}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},editShareDate:function(options){var defaults={experience_id:"",startDate:"",endDate:""};var url="Experience/UpdateDate";var options=Talent._.extend({},defaults,options);var params="?experience_id="+options["experience_id"]+"&startDate="+options["startDate"]+"&endDate="+options["endDate"];var defeered=new Talent.$.Deferred;BaseCollection.requestV2({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addShare:function(options){var defaults={ObjId:"",ObjType:"7",Content:"",StartDate:"",EndDate:"",FileUrls:"",DocumentModels:[]};var url="Experience/Add";var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;BaseCollection.requestV2({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var LableCollection={searchClassData:function(options){var deferred=new Talent.$.Deferred;var defaults={};var options=Talent._.extend({},defaults,options);var url="Lable/Search";BaseCollection.request({url:url,type:"POST",data:{"":options["filter"]}}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={obj_id:"",obj_type:"1",type:0};var options=Talent._.extend({},defaults,options);var url="lable/get";if(options["obj_type"]==2){url=url+"?obj_id="+options["obj_id"]+"&obj_type="+options["obj_type"]}if(options["obj_type"]==1){url+="?type="+options.type;if(options.to_userId){url+="?to_userId="+options.to_userId}}BaseCollection.request({url:url,type:"Get"}).done(function(resp){var resp=resp&&resp["lables"]||[];var total=resp.length;var data={};data["lables"]=resp;data["total"]=total+1;var new_data=[{id:"0",parent_id:"0",name:"类别",path:"类别",pathId:"0",isOpen:true,isAllowSetPersonalLable:true}];var url="lable/Get";var date=new Date;var index_0=Talent._.where(resp,{parent_id:"0"});index_0=Talent._.compact(index_0);getPId(new_data);function getPId(datas,pData){Talent._.each(datas,function(item){var item_id=item["id"];if(pData){item["path"]=pData["path"]+"/"+item["name"];item["pathId"]=pData["pathId"]+"/"+item["id"]}var children_data=Talent._.where(resp,{parent_id:item_id});if(children_data.length){item["children"]=children_data;item["isEnd"]=false}else{item["children"]=null;item["isEnd"]=true}item["isActive"]=false;if(item_id!=="0"){item["isOpen"]=false}getPId(children_data,item)})}data["lables"]=new_data;deferred.resolve(data)}).fail(function(message){deferred.reject(message)});return deferred},getSeeUserList:function(options){var deferred=new Talent.$.Deferred;var defaults={lable_id:""};var options=Talent._.extend({},defaults,options);var url="lable/GetLablePrivilegedUsers";url=url+"?lable_id="+options["lable_id"];BaseCollection.request({url:url,type:"GET"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},putRenameLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={lable_id:"",name:""};var options=Talent._.extend({},defaults,options);var url="lable/name";BaseCollection.request({url:url,type:"Post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},sortLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={ownerObjType:"",ownerObjId:"",referenceObjId:"",movingObjId:"",positionType:""};var options=Talent._.extend({},defaults,options);var url="lable/sort?ownerObjType="+options.ownerObjType+"&ownerObjId="+options["ownerObjId"]+"&referenceObjId="+options.referenceObjId+"&positionType="+options.positionType+"&movingObjId="+options.movingObjId;BaseCollection.request({url:url,type:"get"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},deleteLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={lable_id:"",type:0};var options=Talent._.extend({},defaults,options);var url="lable/remove";url=url+"?lable_id="+options["lable_id"]+"&type="+options.type;BaseCollection.request({url:url,type:"delete"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},postAddLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={obj_id:"",obj_type:"1",name:"",parent_id:""};var options=Talent._.extend({},defaults,options);var url="lable/add";BaseCollection.request({url:url,type:"post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getLabelFullName:function(options){var deferred=new Talent.$.Deferred;var defaults={lableId:0};var options=Talent._.extend({},defaults,options);var url="Lable/GetFullName?lableId="+options.lableId;BaseCollection.request({url:url,type:"get"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},ifAddClassLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={lable_id:"",is_allow:""};var options=Talent._.extend({},defaults,options);var url="lable/allow"+"?lable_id="+options["lable_id"]+"&is_allow="+options["is_allow"];BaseCollection.request({url:url,type:"GET"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},classPerEnterLableData:function(options){var deferred=new Talent.$.Deferred;var defaults={LableId:"",AddObjectModels:""};var options=Talent._.extend({},defaults,options);var url="lable/UpdateUsers";BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.resolve(message)});return deferred}};var MeetCollection={updateMeet:function(options){var defaults={Title:"",StartDate:"",DeadLine:"",MeetType:"",meet_id:"",StartDate:"",DeadLine:"",ContractUser:""};var options=Talent._.extend({},defaults,options);var url="Meet/Update?meet_id="+options["meet_id"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getDetail:function(options){var defaults={obj_id:"",obj_type:"7",meet_id:""};var options=Talent._.extend({},defaults,options);var url="Meet/Get?meet_id="+options["meet_id"]+"&obj_id="+options["obj_id"]+"&obj_type="+options["obj_type"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"GET"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addMeet:function(options){var defaults={ObjId:"",ObjType:7,Title:"",ContractUser:"",StartDate:"",DeadLine:"",FileUrls:"",MeetType:"",Description:""};var options=Talent._.extend({},defaults,options);var url="Meet/AddV2";var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteMeet:function(options){var url="Meet/Delete?id="+options.id;var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addAttachment:function(options){var url="Meet/AddAttachmentV2";var defeered=new Talent.$.Deferred;var defaults={objId:"",dfsUrls:"",documents:[]};options=Talent._.extend({},defaults,options);BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteAttachment:function(options){var url="Meet/DeleteAttachment";var defeered=new Talent.$.Deferred;var defaults={meet_id:"",document_id:""};options=Talent._.extend({},defaults,options);var params="meet_id="+options["meet_id"]+"&document_id="+options["document_id"];BaseCollection.request({url:url+"?"+params,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addParticipator:function(options){var url="Meet/AddParticipatorV2";var defeered=new Talent.$.Deferred;var defaults={meet_id:"",add_objects:""};options=Talent._.extend({},defaults,options);var params="meet_id="+options["meet_id"];BaseCollection.request({url:url+"?"+params,type:"POST",contentType:"application/json",data:JSON.stringify(options["add_objects"])}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteParticipator:function(options){var url="Meet/DeleteParticipator";var defeered=new Talent.$.Deferred;var defaults={meet_id:"",to_user_id:""};options=Talent._.extend({},defaults,options);var params="meet_id="+options["meet_id"]+"&to_user_id="+options["to_user_id"];BaseCollection.request({url:url+"?"+params,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var OrgCollection={getToUserIdSuperior:function(options){var self=this;var options=options||{};var deferred=new Talent.$.Deferred;var url="org/Superiors?to_user_id="+options["to_user_id"]+"&lv=2";BaseCollection.request({url:url,type:"Get"}).done(function(resp){var data=resp||[];if(data.length){deferred.resolve(data[0]["ParentUser"])}else{deferred.resolve(resp)}}).fail(function(message){deferred.reject(message)});return deferred},getData:function(data){var deferred=new $.Deferred;

var userId=Talent.Context.getUserInfo().Id;var id=parseInt(data.id);var activeId=data.activeId&&parseInt(data.activeId)||0;var self=this;BaseCollection.request({url:"org/all",type:"Get"}).done(function(resp){if(!resp["Res"]){deferred.resolve(resp["Res"]);return}resp=resp["Data"];resp=self.getSuperiorAndSubordinate(resp);var activeData=Talent._.where(resp,{Id:parseInt(id)});var subordinate=Talent._.pluck(Talent._.where(resp,{Superior:id}),"Id");subordinate=Talent._.compact(subordinate);var index=Talent._.indexOf(subordinate,activeId);if(index!=-1){subordinate=subordinate.slice(0,index).concat(subordinate.slice(index+1,subordinate.length));subordinate=[activeId].concat(subordinate)}var superior=activeData&&activeData[0]&&activeData[0]["Superior"]||0;var ids=[superior,id].concat(subordinate).join();UserCollection.getData({ids:ids}).done(function(rel){var subordinateData=Talent._.map(subordinate,function(value){var itemData=rel[value];if(!itemData)return;itemData.subordinateCount=Talent._.where(resp,{Superior:value}).length;itemData.level=3;return itemData});subordinateData=Talent._.compact(subordinateData);var activeData=rel[id]||{Id:0};activeData.subordinateCount=Talent._.where(resp,{Superior:id}).length;activeData.level=2;activeData.subordinate=subordinateData;var superiorData=rel[superior]||{Id:0};superiorData.level=1;superiorData.subordinateCount=Talent._.where(resp,{Superior:superior}).length;superiorData.subordinate=[activeData];var result=[superiorData];deferred.resolve(result)})}).fail(function(message){deferred.reject(message)});return deferred.promise()},getDataType:function(data){var deferred=new $.Deferred;var userId=Talent.Context.getUserInfo().Id;var id=parseInt(data.id);var activeId=data.activeId&&parseInt(data.activeId)||0;var self=this;var url="org/allByType";if(data.type==1){var url=url+"?type=1"}BaseCollection.request({url:url,type:"Get"}).done(function(resp){if(!resp["Res"]){deferred.resolve(resp["Res"]);return}resp=resp["Data"];var jsonResp=resp;resp=self.getSuperiorAndSubordinate(resp);var activeData=Talent._.where(resp,{Id:parseInt(id)});var subordinate=Talent._.pluck(Talent._.where(resp,{Superior:id}),"Id");subordinate=Talent._.compact(subordinate);var index=Talent._.indexOf(subordinate,activeId);if(index!=-1){subordinate=subordinate.slice(0,index).concat(subordinate.slice(index+1,subordinate.length));subordinate=[activeId].concat(subordinate)}var superior=activeData&&activeData[0]&&activeData[0]["Superior"]||0;var ids=[superior,id].concat(subordinate).join();UserCollection.getData({ids:ids}).done(function(rel){var subordinateData=Talent._.map(subordinate,function(value){var itemData=rel[value];if(!itemData)return;itemData.subordinateCount=Talent._.where(resp,{Superior:value}).length;itemData.level=3;return itemData});subordinateData=Talent._.compact(subordinateData);Talent._.map(subordinateData,function(item,index){var child=Talent._.where(jsonResp,{Id:item["Id"]});if(child.length>1){var child=Talent._.where(child,{Superior:id})}item["Type"]=child&&child[0]?child[0]["Type"]:0});Talent._.sortBy(subordinateData,"Type");var activeData=rel[id]||{Id:0};activeData.subordinateCount=Talent._.where(resp,{Superior:id}).length;activeData.level=2;activeData.subordinate=subordinateData;var superiorData=rel[superior]||{Id:0};superiorData.level=1;superiorData.subordinateCount=Talent._.where(resp,{Superior:superior}).length;superiorData.subordinate=[activeData];var result=[superiorData];deferred.resolve(result,rel)})}).fail(function(message){deferred.reject(message)});return deferred.promise()},getSubordinateData:function(options){var self=this,defaults={lv:2,type:0};var options=Talent._.extend({},defaults,options);var deferred=new Talent.$.Deferred;var url="org/GetMySubordinates",params="?lv="+options["lv"]+"&type="+options["type"];BaseCollection.request({url:url+params,type:"Get"}).done(function(resp){if(!resp||!resp.length){deferred.resolve([])}var subordinateData=[];Talent._.each(resp,function(item){item["User"]["Type"]=item["Type"];subordinateData.push(item["User"])});deferred.resolve(subordinateData)}).fail(function(message){deferred.reject(message)});return deferred},getSuperior:function(options){var deferred=new $.Deferred;var self=this;var userId=Talent.Context.getUserInfo().Id;var id=parseInt(options.id);BaseCollection.request({url:"org/allByType",type:"Get"}).done(function(resp){resp=resp["Data"];var resp=self.getSuperiorAndSubordinate(resp);var activeData=Talent._.where(resp,{Id:id});if(activeData.length==0){var activeId=0}else{var activeId=activeData[0].Superior||0}deferred.resolve(activeId)});return deferred.promise()},getOpenUserOrg:function(){var deferred=new $.Deferred;var self=this;BaseCollection.request({url:"org/AppOpenUserOrg",type:"POST"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},getSuperiorAndSubordinate:function(resp){var userId=Talent.Context.getUserInfo().Id;var userData=Talent._.where(resp,{Id:userId})[0];if(Talent._.isEmpty(resp))return resp;if(userData.Superior==0){return resp}else{var data=[];var superiorId=userData.Superior;data.push({Id:userId,Superior:0});getSuborinate(userId);return data}function getSuborinate(id){var subordinate=Talent._.where(resp,{Superior:id});Talent._.each(subordinate,function(value,key){data.push(value);if(value.Type==1)return;getSuborinate(value.Id)})}},checkDottedLineSubs:function(options){var self=this;var defaults={to_user_id:""};var options=Talent._.extend({},defaults,options);var deferred=new Talent.$.Deferred;var url="org/CheckDottedLineSubs",params="?to_user_id="+options.to_user_id;BaseCollection.request({url:url+params,type:"Get"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred}};var PlanDataJson={taglist:[{GroupId:1,GroupName:"2013",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"d66be84a-ec3b-4335-88c6-0ad898ca3fd4",PlanTableType:1,StartDate:"2013年1月1日",EndDate:"2013年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"dc443e88-de59-46eb-b092-eab0875c38c6",PlanTableType:2,StartDate:"2013年1月1日",EndDate:"2013年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"c8773247-617d-469f-b249-fb06f3ae5753",PlanTableType:2,StartDate:"2013年4月1日",EndDate:"2013年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"256e8486-e270-4910-8fe3-d9d88aad775d",PlanTableType:2,StartDate:"2013年7月1日",EndDate:"2013年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"e682669d-ca4f-4b5b-aae0-c38ab93b9cb1",PlanTableType:2,StartDate:"2013年10月1日",EndDate:"2013年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"58c077dd-5c0e-45e2-8733-1446dad3ff13",PlanTableType:3,StartDate:"2013年1月1日",EndDate:"2013年1月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"ebdd2fc3-fba3-41bf-8d13-9121b0921cd3",PlanTableType:4,StartDate:"2012年12月31日",EndDate:"2013年1月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"cfa2cbc7-7b03-4311-a5f6-0b645ff484e2",PlanTableType:4,StartDate:"2013年1月7日",EndDate:"2013年1月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"dc494344-3747-4a1b-ae1a-b5981f49c4cc",PlanTableType:4,StartDate:"2013年1月14日",EndDate:"2013年1月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"7aab381d-4ccc-4476-9b3a-b383ff485fee",PlanTableType:4,StartDate:"2013年1月21日",EndDate:"2013年1月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"c4c7df92-1264-4f5b-849f-19212ab64500",PlanTableType:4,StartDate:"2013年1月28日",EndDate:"2013年2月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"24298576-c48e-44ac-9708-a582da16525c",PlanTableType:3,StartDate:"2013年2月1日",EndDate:"2013年2月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"6db9ef30-04f2-4dfd-a4ca-16eaba9b1896",PlanTableType:4,StartDate:"2013年2月4日",EndDate:"2013年2月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"ac2a85b0-618a-4d4f-906c-cd00bdaa84c4",PlanTableType:4,StartDate:"2013年2月11日",EndDate:"2013年2月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"e6b66815-c3b2-480a-9106-aa32d78f3cf4",PlanTableType:4,StartDate:"2013年2月18日",EndDate:"2013年2月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"c847579e-d7cd-4cc1-be6a-dc31a666f456",PlanTableType:4,StartDate:"2013年2月25日",EndDate:"2013年3月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"2e18c73e-1407-41f1-bfeb-bc10d100031b",PlanTableType:3,StartDate:"2013年3月1日",EndDate:"2013年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"a5e55f00-ffec-451b-878c-21f33319e2f6",PlanTableType:4,StartDate:"2013年3月4日",EndDate:"2013年3月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"6041f9ed-db4c-42e6-af6d-18cc02c62d5b",PlanTableType:4,StartDate:"2013年3月11日",EndDate:"2013年3月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"dbd3ae4d-7e2a-4ed7-a74b-880c6412b7c0",PlanTableType:4,StartDate:"2013年3月18日",EndDate:"2013年3月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"0acea7a8-2f8e-458e-9be2-5122d7ada5ee",PlanTableType:4,StartDate:"2013年3月25日",EndDate:"2013年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"61224aa5-c191-4448-aabd-c72249a594f7",PlanTableType:3,StartDate:"2013年4月1日",EndDate:"2013年4月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"aeac5af6-8955-4d67-a69d-6ef0037151a2",PlanTableType:4,StartDate:"2013年4月1日",EndDate:"2013年4月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"5d78398c-8c27-4e01-ad74-1361fa2c2667",PlanTableType:4,StartDate:"2013年4月8日",EndDate:"2013年4月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"9dbb380c-1fd6-4438-9c83-b9085f7663fa",PlanTableType:4,StartDate:"2013年4月15日",EndDate:"2013年4月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"4ae49a1d-a7b5-41e3-bb7c-b5069a4d252f",PlanTableType:4,StartDate:"2013年4月22日",EndDate:"2013年4月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"0d1b1672-3d49-4523-8980-6cd87533006d",PlanTableType:4,StartDate:"2013年4月29日",EndDate:"2013年5月5日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"c1a9a11b-7a61-4578-943c-25499322aeea",PlanTableType:3,StartDate:"2013年5月1日",EndDate:"2013年5月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"c9d74c19-bf2b-48fd-bccd-ab99e331b0b5",PlanTableType:4,StartDate:"2013年5月6日",EndDate:"2013年5月12日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"ea4c1b39-d254-4b66-9b39-325e0580d9d4",PlanTableType:4,StartDate:"2013年5月13日",EndDate:"2013年5月19日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"697806eb-e89b-48ef-aa4b-cebef6b92123",PlanTableType:4,StartDate:"2013年5月20日",EndDate:"2013年5月26日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"b1d86326-5f6e-4368-9245-611c027a0517",PlanTableType:4,StartDate:"2013年5月27日",EndDate:"2013年6月2日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"fbaea0c9-45d4-4a69-b5fd-333e80d392a9",PlanTableType:3,StartDate:"2013年6月1日",EndDate:"2013年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"855b9320-30c0-4404-9337-88a93724a2e5",PlanTableType:4,StartDate:"2013年6月3日",EndDate:"2013年6月9日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"d98a00c4-271a-4b22-b539-9f7b0c32c300",PlanTableType:4,StartDate:"2013年6月10日",EndDate:"2013年6月16日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d627a90c-6fb4-46f7-9c4a-a2ca0c88173b",PlanTableType:4,StartDate:"2013年6月17日",EndDate:"2013年6月23日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"7f9d5abe-005a-4961-82e5-57bf6f00f8c6",PlanTableType:4,StartDate:"2013年6月24日",EndDate:"2013年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"3c788377-b9d2-45b0-a8b0-e4947a030a38",PlanTableType:3,StartDate:"2013年7月1日",EndDate:"2013年7月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"51551619-239c-4691-a563-a6085d34c27b",PlanTableType:4,StartDate:"2013年7月1日",EndDate:"2013年7月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"66e014c3-0975-4b0e-b436-53005fdd4fe0",PlanTableType:4,StartDate:"2013年7月8日",EndDate:"2013年7月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"75b7f36d-77d0-479c-b720-686be1ea24c6",PlanTableType:4,StartDate:"2013年7月15日",EndDate:"2013年7月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"d05436cf-eebe-4399-b066-76034c982f21",PlanTableType:4,StartDate:"2013年7月22日",EndDate:"2013年7月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"01e173a2-c1b6-4862-a775-aad626312e38",PlanTableType:4,StartDate:"2013年7月29日",EndDate:"2013年8月4日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"6a647758-3bdb-4669-8ad8-5526a535e176",PlanTableType:3,StartDate:"2013年8月1日",EndDate:"2013年8月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"aa4d0b58-62d0-4ef7-9f37-56256dfbf62f",PlanTableType:4,StartDate:"2013年5月5日",EndDate:"2013年8月11日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"e1f1b8a9-901c-4cde-bc9b-10c43063356a",PlanTableType:4,StartDate:"2013年8月12日",EndDate:"2013年8月18日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"31ba2858-7296-4683-bc63-5f377658c310",PlanTableType:4,StartDate:"2013年8月19日",EndDate:"2013年8月25日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"deda146f-9351-4f4e-a3db-160db6a4ac4a",PlanTableType:4,StartDate:"2013年8月26日",EndDate:"2013年9月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"559c85b1-a151-4722-bb06-888e29629d34",PlanTableType:3,StartDate:"2013年9月1日",EndDate:"2013年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"535bd243-25f3-4c50-895a-45fdfb6f3fee",PlanTableType:4,StartDate:"2013年9月2日",EndDate:"2013年9月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"40b84eff-a0d3-4dad-a5e5-a2c821ff6182",PlanTableType:4,StartDate:"2013年9月9日",EndDate:"2013年9月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d523ddd7-5896-45a2-9127-f26366550234",PlanTableType:4,StartDate:"2013年9月16日",EndDate:"2013年9月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"9ee3546c-83f9-4d00-b412-4988dddbac48",PlanTableType:4,StartDate:"2013年9月23日",EndDate:"2013年9月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"91da1b33-bdb2-43bc-b47e-ba504db0b216",PlanTableType:4,StartDate:"2013年9月30日",EndDate:"2013年10月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"643f6886-dc7b-40e9-a7e0-6e45be410a12",PlanTableType:3,StartDate:"2013年10月1日",EndDate:"2013年10月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"1d8d4725-05de-456a-9013-f2a4f18314d4",PlanTableType:4,StartDate:"2013年10月7日",EndDate:"2013年10月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"237b945b-bee6-4afc-b61d-d2d450d87d38",PlanTableType:4,StartDate:"2013年10月14日",EndDate:"2013年10月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"a626af9c-5c13-45bd-9b11-3d0e4009a76d",PlanTableType:4,StartDate:"2013年10月21日",EndDate:"2013年10月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"901f1ace-bc94-4b39-890e-8b16842d17a3",PlanTableType:4,StartDate:"2013年10月28日",EndDate:"2013年11月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"6db951ce-677d-4e3d-907d-67956828a312",PlanTableType:3,StartDate:"2013年11月1日",EndDate:"2013年11月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"5d443711-6851-44bd-8b15-4274f9f9e37e",PlanTableType:4,StartDate:"2013年11月4日",EndDate:"2013年11月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c2cd353f-c367-4919-b2d3-e4a44b22e798",PlanTableType:4,StartDate:"2013年11月11日",EndDate:"2013年11月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"3c615b2c-2b58-41a7-befd-c973b8d1a769",PlanTableType:4,StartDate:"2013年11月18日",EndDate:"2013年11月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"c397c397-a8b3-4593-8630-92ad2f4d13b9",PlanTableType:4,StartDate:"2013年11月25日",EndDate:"2013年12月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"3f538e12-5b69-4e36-80c1-fc1c92cc56db",PlanTableType:3,StartDate:"2013年12月1日",EndDate:"2013年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"849cf074-c872-478f-9cf5-8a5290da5f7a",PlanTableType:4,StartDate:"2013年12月2日",EndDate:"2013年12月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"4c276125-a530-42c8-83a1-3aaed54d4fad",PlanTableType:4,StartDate:"2013年12月9日",EndDate:"2013年12月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"3af3506b-4b46-456c-8155-fe57614e8d4a",PlanTableType:4,StartDate:"2013年12月16日",EndDate:"2013年12月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"3ee41d52-c8bf-45c5-85b0-444788ffa3ec",PlanTableType:4,StartDate:"2013年12月23日",EndDate:"2013年12月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2017年1月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:2,GroupName:"2014",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"943e8cdd-5034-49ca-a6ca-169e3be402de",PlanTableType:1,StartDate:"2014年1月1日",EndDate:"2014年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"af0306d0-505e-4187-b5ed-e6d8c205294f",PlanTableType:2,StartDate:"2014年1月1日",EndDate:"2014年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"ba37638d-702b-448d-bc18-96804a69289d",PlanTableType:2,StartDate:"2014年4月1日",EndDate:"2014年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"2f74cae4-5837-4f14-a06e-40994b088371",PlanTableType:2,StartDate:"2014年7月1日",EndDate:"2014年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"62a7c461-8c34-4d44-b77c-9c802c01df6f",PlanTableType:2,StartDate:"2014年10月1日",EndDate:"2014年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"367fbc6c-a7f8-4469-952c-a77bfb0d07d5",PlanTableType:3,StartDate:"2014年1月1日",EndDate:"2014年1月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"5ac69bfe-6096-43ed-9104-4cfdfaa6b12f",PlanTableType:4,StartDate:"2013年12月30日",EndDate:"2014年1月5日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"879556af-87c1-4466-ba10-70fb22d056b4",PlanTableType:4,StartDate:"2014年1月6日",EndDate:"2014年1月12日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d3571fa6-b75c-4671-ae2d-04b0d4680bf1",PlanTableType:4,StartDate:"2014年1月13日",EndDate:"2014年1月19日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"33272d95-0d41-4d9f-b485-3d55198ff5a6",PlanTableType:4,StartDate:"2014年1月20日",EndDate:"2014年1月26日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"2bb8fe4e-5709-473e-98f9-99c7d2868946",PlanTableType:4,StartDate:"2014年1月27日",EndDate:"2014年2月2日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"31a13001-e002-4be7-9cd9-21180c7babbb",PlanTableType:3,StartDate:"2014年2月1日",EndDate:"2014年2月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"53addd60-e892-4f33-988b-520ae4b666c2",PlanTableType:4,StartDate:"2014年2月3日",EndDate:"2014年2月9日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"262dc59b-6319-4b9b-8df9-e7db9c12072e",PlanTableType:4,StartDate:"2014年2月10日",EndDate:"2014年2月16日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"0934abf0-a576-4bc0-86d7-4a54c9ee6fd0",PlanTableType:4,StartDate:"2014年2月17日",EndDate:"2014年2月23日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"4f0b854a-e7d4-44b8-a251-7aaf2dbd4d73",PlanTableType:4,StartDate:"2014年2月24日",EndDate:"2014年3月2日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"6321490b-c69c-423e-8365-a26618d510f2",PlanTableType:3,StartDate:"2014年3月1日",EndDate:"2014年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"045da08d-304f-4d97-86f5-7c52ff3cd910",PlanTableType:4,StartDate:"2014年3月3日",EndDate:"2014年3月9日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"fdb86894-d784-4514-a9fe-189fb4b3bc1e",PlanTableType:4,StartDate:"2014年3月10日",EndDate:"2014年3月16日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"b96089d6-3227-4bba-b840-4dd64a182458",PlanTableType:4,StartDate:"2014年3月17日",EndDate:"2014年3月23日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"ef02ec93-4165-4b75-b4ff-299d36356723",PlanTableType:4,StartDate:"2014年3月24日",EndDate:"2014年3月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"fd4d2ba6-88b2-480d-afdb-b6376e109e75",PlanTableType:4,StartDate:"2014年3月31日",EndDate:"2014年4月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"c57c4108-c96e-44f6-b808-c17d4f082b95",PlanTableType:3,StartDate:"2014年4月1日",EndDate:"2014年4月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"cd0d8f4a-7588-400d-a25c-b4e48071f828",PlanTableType:4,StartDate:"2014年4月7日",EndDate:"2014年4月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"df99b899-96d4-4a8c-acaa-eb7b8421cf49",PlanTableType:4,StartDate:"2014年4月14日",EndDate:"2014年4月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"5f40affb-3d6d-4c0a-936c-06b87dd14df0",PlanTableType:4,StartDate:"2014年4月21日",EndDate:"2014年4月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"be1b34f0-f531-4eb4-b960-b82a7c0f4bb3",PlanTableType:4,StartDate:"2014年4月28日",EndDate:"2014年5月4日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"bff7b74d-b5e4-45b7-96dc-e089f53a4004",PlanTableType:3,StartDate:"2014年5月1日",EndDate:"2014年5月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"b624855d-c35d-4f3f-b778-59ed67a0d1a0",PlanTableType:4,StartDate:"2014年5月5日",EndDate:"2014年5月11日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c0a1297d-e6a1-455a-b68b-272452298a3b",PlanTableType:4,StartDate:"2014年5月12日",EndDate:"2014年5月18日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"7bc1d3f9-ec1c-47cd-8898-fc58f5d38691",PlanTableType:4,StartDate:"2014年5月19日",EndDate:"2014年5月25日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"514e0a4b-7cc3-4bfd-b925-c86208f20e41",PlanTableType:4,StartDate:"2014年5月26日",EndDate:"2014年6月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"0b17026f-7fe9-4f42-b98f-db1e51dcd090",PlanTableType:3,StartDate:"2014年6月1日",EndDate:"2014年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"0181bd76-043e-4acf-8c2e-fc2bd11f2fcd",PlanTableType:4,StartDate:"2014年6月2日",EndDate:"2014年6月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c044ba56-3ee5-406a-9013-142d5c392be8",PlanTableType:4,StartDate:"2014年6月9日",EndDate:"2014年6月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"30a2a685-c410-437a-9372-7924639efb50",PlanTableType:4,StartDate:"2014年6月16日",EndDate:"2014年6月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"b57310ec-abb1-4ea2-9d89-e3ab05c07089",PlanTableType:4,StartDate:"2014年6月23日",EndDate:"2014年6月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"ba56b6c1-690f-4d27-85ad-136958ba356e",PlanTableType:4,StartDate:"2014年6月30日",EndDate:"2014年7月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"63384367-47c7-4857-871c-fec05b69f7b6",PlanTableType:3,StartDate:"2014年7月1日",EndDate:"2014年7月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"4cabd5b2-bcf2-4ecd-ab83-a08da8073111",PlanTableType:4,StartDate:"2014年7月7日",EndDate:"2014年7月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"45e8a8dd-3f3a-4c67-848e-46bf2c58fcd1",PlanTableType:4,StartDate:"2014年7月14日",EndDate:"2014年7月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"32aa5c04-30dc-40fc-a822-c9e9f9244f3b",PlanTableType:4,StartDate:"2014年7月21日",EndDate:"2014年7月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"5ba234e5-58c5-48d0-b1b3-84270c18893b",PlanTableType:4,StartDate:"2014年7月28日",EndDate:"2014年8月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"99f48567-7a97-4413-a4bd-19d4bfe87e6b",PlanTableType:3,StartDate:"2014年8月1日",EndDate:"2014年8月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"7ab3019c-88ff-442d-bde0-699691d061ba",PlanTableType:4,StartDate:"2014年8月4日",EndDate:"2014年8月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"773e6fe0-9060-404e-9ccf-70155794c2a3",PlanTableType:4,StartDate:"2014年8月11日",EndDate:"2014年8月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"c2dc3134-e4fa-46f3-9696-084ab9489140",PlanTableType:4,StartDate:"2014年8月18日",EndDate:"2014年8月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"8d7977f7-7e1c-4b45-86d6-d6ac3566d7b0",PlanTableType:4,StartDate:"2014年8月25日",EndDate:"2014年8月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"8e4b9716-0aa0-420a-b254-4af9972e05de",PlanTableType:3,StartDate:"2014年9月1日",EndDate:"2014年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"c756951f-ec78-4718-b030-438730895314",PlanTableType:4,StartDate:"2014年9月1日",EndDate:"2014年9月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"0d2b4bd4-8fbb-48da-ab07-5f34890cbfc9",PlanTableType:4,StartDate:"2014年9月8日",EndDate:"2014年9月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"a87b92b1-b049-44b5-ac6c-e6a4c4378609",PlanTableType:4,StartDate:"2014年9月15日",EndDate:"2014年9月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"b5aa31e1-3f47-48c2-88ef-8a57abcc7a1e",PlanTableType:4,StartDate:"2014年9月22日",EndDate:"2014年9月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"815fd745-57f6-4e36-ac69-d927096e0101",PlanTableType:4,StartDate:"2014年9月29日",EndDate:"2014年10月5日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b9cdc0cf-77c6-4527-885c-08dcf3ec024d",PlanTableType:3,StartDate:"2014年10月1日",EndDate:"2014年10月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"06d0fa01-b1dd-4789-bde0-40a43b270719",PlanTableType:4,StartDate:"2014年10月6日",EndDate:"2014年10月12日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"d4843ed0-317e-49b6-99a7-e7d5af3708a7",PlanTableType:4,StartDate:"2014年10月13日",EndDate:"2014年10月19日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"a40a3a22-bd66-448c-88bf-c5c1b7520cc0",PlanTableType:4,StartDate:"2014年10月20日",EndDate:"2014年10月26日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"67fe26b0-1e1d-4d54-b12b-9b59e06f6ade",PlanTableType:4,StartDate:"2014年10月27日",EndDate:"2014年11月2日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"f38301c9-7f39-4647-836b-9cb46cc5051d",PlanTableType:3,StartDate:"2014年11月1日",EndDate:"2014年11月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"dd7f765f-c5e7-45e6-bdc5-0b20614984da",PlanTableType:4,StartDate:"2014年11月3日",EndDate:"2014年11月9日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"b237c884-2538-4202-883d-58fdf981db90",PlanTableType:4,StartDate:"2014年11月10日",EndDate:"2014年11月16日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"ca2d0bd0-5b9b-4b16-bc66-84b09574a702",PlanTableType:4,StartDate:"2014年11月17日",EndDate:"2014年11月23日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"82691222-f2fa-482e-b025-3fc9238a7dc1",PlanTableType:4,StartDate:"2014年11月24日",EndDate:"2014年11月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,
Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"18daafef-674b-402a-ac68-e13f43b76d4b",PlanTableType:3,StartDate:"2014年12月1日",EndDate:"2014年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"8be2c505-d425-4ae5-86fd-ccbaf3ccd6bb",PlanTableType:4,StartDate:"2014年12月1日",EndDate:"2014年12月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"b57d878d-9973-4fb3-8043-d8937045d67f",PlanTableType:4,StartDate:"2014年12月8日",EndDate:"2014年12月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"51c3d5c5-9fc3-4ae6-a6c8-9369518d6c20",PlanTableType:4,StartDate:"2014年12月15日",EndDate:"2014年12月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"f85146e3-ed8f-4c3c-a1fc-41088fc0b913",PlanTableType:4,StartDate:"2014年12月22日",EndDate:"2014年12月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2017年1月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:3,GroupName:"2015",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"44ffca9b-f846-43b9-8633-3a2824eefc5a",PlanTableType:1,StartDate:"2015年1月1日",EndDate:"2015年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"3dd6f2df-1a2f-493b-be36-4410a3e89b57",PlanTableType:2,StartDate:"2015年1月1日",EndDate:"2015年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"80cba183-5820-4320-9e99-2e8482bd3134",PlanTableType:2,StartDate:"2015年4月1日",EndDate:"2015年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"a0cd09ca-dece-4e3c-bed5-d07765d90741",PlanTableType:2,StartDate:"2015年7月1日",EndDate:"2015年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"aa4523d5-06c9-4cad-b005-99da2b72df31",PlanTableType:2,StartDate:"2015年10月1日",EndDate:"2015年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"1102b8b5-829e-45c7-bffa-0031b5378a51",PlanTableType:3,StartDate:"2015年1月1日",EndDate:"2015年1月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"f14a96c2-ee91-4467-adc2-941934d73898",PlanTableType:4,StartDate:"2014年12月29日",EndDate:"2015年1月4日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"e3f3b2b4-d4de-45b2-9e7e-ee61557f8394",PlanTableType:4,StartDate:"2015年1月5日",EndDate:"2015年1月11日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"540d5ad1-dc23-41e9-b31a-7e56ca15fd7b",PlanTableType:4,StartDate:"2015年1月12日",EndDate:"2015年1月18日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"1a2ed848-7263-4ec1-901c-7973c2302840",PlanTableType:4,StartDate:"2015年1月19日",EndDate:"2015年1月25日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"24edae84-8529-49ea-913d-6cd270c3be38",PlanTableType:4,StartDate:"2015年1月26日",EndDate:"2015年2月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"f1c24abe-3bdf-4712-85fc-4c0d7e1471a2",PlanTableType:3,StartDate:"2015年2月1日",EndDate:"2015年2月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"81959f7e-8cc2-434e-b1fc-ee9abc26672d",PlanTableType:4,StartDate:"2015年2月2日",EndDate:"2015年2月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"081e46a0-0ad1-47df-b908-8607eb8ce6b4",PlanTableType:4,StartDate:"2015年2月9日",EndDate:"2015年2月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"b1038b37-3768-41a0-8720-70c9f36df872",PlanTableType:4,StartDate:"2015年2月16日",EndDate:"2015年2月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"be0f9b40-0bb5-4655-8777-1cc7223a99ac",PlanTableType:4,StartDate:"2015年2月23日",EndDate:"2015年3月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"ff93f2be-b743-4c61-b487-382d947e0920",PlanTableType:3,StartDate:"2015年3月1日",EndDate:"2015年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"01bed1ac-3f0f-4a61-8dec-f6dfab48a80f",PlanTableType:4,StartDate:"2015年3月2日",EndDate:"2015年3月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c26b4bfe-af8a-4acd-9e24-02c9e8f42a35",PlanTableType:4,StartDate:"2015年3月9日",EndDate:"2015年3月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"b48d6271-f505-48f6-8a37-da4bcde44fe6",PlanTableType:4,StartDate:"2015年3月16日",EndDate:"2015年3月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"238b4b36-4a84-4885-8074-05f2806918f9",PlanTableType:4,StartDate:"2015年3月23日",EndDate:"2015年3月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"48db2df9-1b05-42ce-8804-53d6a81d18f3",PlanTableType:4,StartDate:"2015年3月30日",EndDate:"2015年4月5日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"60dba6b0-fcc1-45c2-9bc5-24c2925598fc",PlanTableType:3,StartDate:"2015年4月1日",EndDate:"2015年4月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"483ada5c-f8a0-4aea-bcce-70951542a559",PlanTableType:4,StartDate:"2015年4月6日",EndDate:"2015年4月12日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"bfee51ab-a5fa-45de-aabc-88bde2bfc74e",PlanTableType:4,StartDate:"2015年4月13日",EndDate:"2015年4月19日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"9c3aacf9-decf-431b-88a4-92a101915dce",PlanTableType:4,StartDate:"2015年4月20日",EndDate:"2015年4月26日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"fdc5166e-a472-49a6-8a56-3f302ae7908b",PlanTableType:4,StartDate:"2015年4月27日",EndDate:"2015年5月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"1abbf894-fdf9-4bb3-9c96-928788ca3381",PlanTableType:3,StartDate:"2015年5月1日",EndDate:"2015年5月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"832b0649-7f55-44a3-a4c6-27d0ee316cad",PlanTableType:4,StartDate:"2015年5月4日",EndDate:"2015年5月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"6faf901e-60b7-49b9-9f89-c50a116b7b76",PlanTableType:4,StartDate:"2015年5月11日",EndDate:"2015年5月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"69ae81c9-4439-4a93-9915-e3e07dfb6235",PlanTableType:4,StartDate:"2015年5月18日",EndDate:"2015年5月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"36d5e72f-8ed4-48b3-86ef-7ed4206dceb8",PlanTableType:4,StartDate:"2015年5月25日",EndDate:"2015年5月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"c9738f5b-a8d2-4fcd-b441-b1aed7296606",PlanTableType:3,StartDate:"2015年6月1日",EndDate:"2015年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"4d511538-96e6-4038-b938-d2956d9a28bc",PlanTableType:4,StartDate:"2015年6月1日",EndDate:"2015年6月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"fb46008f-ab3a-4302-bc0b-b71850c2d83f",PlanTableType:4,StartDate:"2015年6月8日",EndDate:"2015年6月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d078650a-0110-432a-8f3c-156bf079864b",PlanTableType:4,StartDate:"2015年6月15日",EndDate:"2015年6月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"01ff60f3-5fce-4be6-8639-f2fa3dcbf0f3",PlanTableType:4,StartDate:"2015年6月22日",EndDate:"2015年6月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"8d9b7f1e-7873-4ea1-b374-c79061a4a021",PlanTableType:4,StartDate:"2015年6月29日",EndDate:"2015年7月5日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b387a2c6-c13d-40b4-860f-c544c36567bb",PlanTableType:3,StartDate:"2015年7月1日",EndDate:"2015年7月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"38bd3490-85b0-4b82-be37-021df8154ccd",PlanTableType:4,StartDate:"2015年7月6日",EndDate:"2015年7月12日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"840f43d8-ae8e-4930-8595-ca039ad4d04d",PlanTableType:4,StartDate:"2015年7月13日",EndDate:"2015年7月19日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"e92c767b-1866-4f90-87f2-207189dc6fa8",PlanTableType:4,StartDate:"2015年7月20日",EndDate:"2015年7月26日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"5e881c23-9f04-4039-a490-e4eb581d2a03",PlanTableType:4,StartDate:"2015年7月27日",EndDate:"2015年8月2日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"3225f8a6-e8f6-4307-b081-73d462e59061",PlanTableType:3,StartDate:"2015年8月1日",EndDate:"2015年8月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"73e0a9e5-b6eb-49bb-bc4b-225d553b1352",PlanTableType:4,StartDate:"2015年8月3日",EndDate:"2015年8月9日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"f9ac05a1-b27d-40c4-b680-b4777eb74346",PlanTableType:4,StartDate:"2015年8月10日",EndDate:"2015年8月16日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"4136a828-7cba-4325-b919-444698cd37a7",PlanTableType:4,StartDate:"2015年8月17日",EndDate:"2015年8月23日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"695e7e6d-ca39-4538-affb-fe1759a4aae9",PlanTableType:4,StartDate:"2015年8月24日",EndDate:"2015年8月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"97484800-f34f-4a74-8706-e71651d88519",PlanTableType:4,StartDate:"2015年8月31日",EndDate:"2015年9月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"d1c8bd23-1a53-4492-84bc-d758059d9093",PlanTableType:3,StartDate:"2015年9月1日",EndDate:"2015年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"76f9e904-736e-481d-ae43-19b5bd6b39a0",PlanTableType:4,StartDate:"2015年9月7日",EndDate:"2015年9月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"a205fc73-c135-4249-bd4f-d73cf412ee32",PlanTableType:4,StartDate:"2015年9月14日",EndDate:"2015年9月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d9e63f2e-798f-41a2-b691-1996ebb71020",PlanTableType:4,StartDate:"2015年9月21日",EndDate:"2015年9月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"6fe12d51-5d81-458b-90ec-c8958b4c5ce9",PlanTableType:4,StartDate:"2015年9月28日",EndDate:"2015年10月4日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"31138df8-d97a-4762-bb6a-8a7fc4717a09",PlanTableType:3,StartDate:"2015年10月1日",EndDate:"2015年10月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"49dc4a03-94f8-4864-abad-6d9dcf044c12",PlanTableType:4,StartDate:"2015年10月5日",EndDate:"2015年10月11日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c1db89ec-37f5-44c5-966a-3654ca3c1bf1",PlanTableType:4,StartDate:"2015年10月12日",EndDate:"2015年10月18日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"21e646ec-9735-489c-a9ff-ebb7594b2b82",PlanTableType:4,StartDate:"2015年10月19日",EndDate:"2015年10月25日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"3485a5f8-261b-462e-9563-1d71a9c42da2",PlanTableType:4,StartDate:"2015年10月26日",EndDate:"2015年11月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"0fb340b9-faea-47e5-a469-d9d52f2243b5",PlanTableType:3,StartDate:"2015年11月1日",EndDate:"2015年11月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"9f428eac-9aab-4379-a490-33d0c29944b2",PlanTableType:4,StartDate:"2015年11月2日",EndDate:"2015年11月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"3a02105f-37b2-4a06-9776-8ed3e5b87e5d",PlanTableType:4,StartDate:"2015年11月9日",EndDate:"2015年11月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"0b501a07-bfe3-4163-9edb-b03f35e1714d",PlanTableType:4,StartDate:"2015年11月16日",EndDate:"2015年11月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"be1f800d-1e81-4983-8211-925840e43aa2",PlanTableType:4,StartDate:"2015年11月23日",EndDate:"2015年11月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"01b11391-83d9-4e43-9dba-a57297cb03e8",PlanTableType:4,StartDate:"2015年11月30日",EndDate:"2015年12月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"1d812501-172e-4e69-b5f7-efb6b1cc3f31",PlanTableType:3,StartDate:"2015年12月1日",EndDate:"2015年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"40c13867-75ca-47c5-8a8b-9b9ef449afdf",PlanTableType:4,StartDate:"2015年12月7日",EndDate:"2015年12月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"138b440e-9788-4c69-9f17-f588c77213de",PlanTableType:4,StartDate:"2015年12月14日",EndDate:"2015年12月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"2484da3e-4355-4e68-88c8-aacb4e520c7d",PlanTableType:4,StartDate:"2015年12月21日",EndDate:"2015年12月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2017年1月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:4,GroupName:"2016",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"9b2ab6b8-093a-4a14-8e1a-4eff1043a2f8",PlanTableType:1,StartDate:"2016年1月1日",EndDate:"2016年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"4ced57d1-3bd6-41af-9bef-cdc9407e63a1",PlanTableType:2,StartDate:"2016年1月1日",EndDate:"2016年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"658bb38f-377f-4402-8565-bc3854e22211",PlanTableType:2,StartDate:"2016年4月1日",EndDate:"2016年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"87706236-11c4-4832-bec5-d4f6b2628e61",PlanTableType:2,StartDate:"2016年7月1日",EndDate:"2016年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"0c1be52e-b4b5-4404-9df3-4bdadcb5078c",PlanTableType:2,StartDate:"2016年10月1日",EndDate:"2016年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"3499e8e5-2b4d-45fc-8fdb-a8a3842eb86a",PlanTableType:3,StartDate:"2016年1月1日",EndDate:"2016年1月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"4e07a2e0-fd39-43df-a5a2-5948018c544a",PlanTableType:4,StartDate:"2015年12月28日",EndDate:"2016年1月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"93c6732e-088f-425f-b660-d07aed2e430b",PlanTableType:4,StartDate:"2016年1月4日",EndDate:"2016年1月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d68d031f-2426-4705-b1b7-1b2fc027e6e5",PlanTableType:4,StartDate:"2016年1月11日",EndDate:"2016年1月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"ef906331-aaf5-4cb6-8d0c-cf88d03c7713",PlanTableType:4,StartDate:"2016年1月18日",EndDate:"2016年1月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"43504b7d-0ef3-4dc3-84bd-aac6f7edf14f",PlanTableType:4,StartDate:"2016年1月25日",EndDate:"2016年1月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"35fb03cb-becb-4c1c-bb48-58a6446c2cc2",PlanTableType:3,StartDate:"2016年2月1日",EndDate:"2016年2月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"45c6fb00-ac0d-4864-9f3d-bd6de2b246fa",PlanTableType:4,StartDate:"2016年2月1日",EndDate:"2016年2月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c3e2c2fd-9e93-423c-8743-fc3a9d5e5b24",PlanTableType:4,StartDate:"2016年2月8日",EndDate:"2016年2月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"7353c5da-f5f4-4b0d-8129-6d8a7b7c30da",PlanTableType:4,StartDate:"2016年2月15日",EndDate:"2016年2月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"88f82d7c-e7bb-4862-8036-5ff75317891b",PlanTableType:4,StartDate:"2016年2月22日",EndDate:"2016年2月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"feba06de-7787-45e8-8cb4-e3d110f684f1",PlanTableType:4,StartDate:"2016年2月29日",EndDate:"2016年3月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"bb603379-2156-4107-88a9-33891165afb4",PlanTableType:3,StartDate:"2016年3月1日",EndDate:"2016年3月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"f4a9ab81-b71b-451f-a890-cf15b2824fea",PlanTableType:4,StartDate:"2016年3月7日",EndDate:"2016年3月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"6f077ce2-2bd0-4995-9873-f4d9774a4857",PlanTableType:4,StartDate:"2016年3月14日",EndDate:"2016年3月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"28477db7-b4b4-48a2-b1fc-5114893209f5",PlanTableType:4,StartDate:"2016年3月21日",EndDate:"2016年3月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"6ca58d26-47f7-45c3-bdef-ca82235aa28a",PlanTableType:4,StartDate:"2016年3月28日",EndDate:"2016年4月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"7550abec-8d69-449e-97aa-3d46dba01121",PlanTableType:3,StartDate:"2016年4月1日",EndDate:"2016年4月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"22911fee-666a-4034-baa9-a93a328b9e5e",PlanTableType:4,StartDate:"2016年4月4日",EndDate:"2016年4月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"573a9c9d-75e3-4a5d-87fe-c70bb6766fb8",PlanTableType:4,StartDate:"2016年4月11日",EndDate:"2016年4月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"db075684-abf5-4714-88fe-70a987d70f36",PlanTableType:4,StartDate:"2016年4月18日",EndDate:"2016年4月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"e602fd33-bca2-470a-987a-48b24441738a",PlanTableType:4,StartDate:"2016年4月25日",EndDate:"2016年5月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"190d94f2-68de-4e5b-86fa-c488425859f8",PlanTableType:3,StartDate:"2016年5月1日",EndDate:"2016年5月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"0978f2a7-5d3d-4000-a931-0b7cbf5a1c3f",PlanTableType:4,StartDate:"2016年5月2日",EndDate:"2016年5月8日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"46557331-22ff-4bdf-90b3-2bb1ae23581e",PlanTableType:4,StartDate:"2016年5月9日",EndDate:"2016年5月15日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"8e1f571d-ee96-4a66-af19-9c4ae6f83a0c",PlanTableType:4,StartDate:"2016年5月16日",EndDate:"2016年5月22日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"2e3ce08e-86db-4ed0-b353-1adbeb3a5d2e",PlanTableType:4,StartDate:"2016年5月23日",EndDate:"2016年5月29日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"20f4581d-91a3-4964-8d99-cc91fa523e8c",PlanTableType:4,StartDate:"2016年5月30日",EndDate:"2016年6月5日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"8c60f472-5cf3-4107-be03-61a9f5a7bc7a",PlanTableType:3,StartDate:"2016年6月1日",EndDate:"2016年6月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"cf3647d8-77e1-4ddd-b2f8-cdfa5fc8ee3d",PlanTableType:4,StartDate:"2016年6月6日",EndDate:"2016年6月12日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"7f770a92-04c8-4542-9576-369b6eae871e",PlanTableType:4,StartDate:"2016年6月13日",EndDate:"2016年6月19日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"36384d49-0eab-41e1-8b03-6222e97b124c",PlanTableType:4,StartDate:"2016年6月20日",EndDate:"2016年6月26日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"7ea66ee5-5b8b-434c-b654-e60b9070b95b",PlanTableType:4,StartDate:"2016年6月27日",EndDate:"2016年7月3日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"e5eebe9e-3c7e-43b1-a8db-85e49b14920d",PlanTableType:3,StartDate:"2016年7月1日",EndDate:"2016年7月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"0a109e0c-d80b-4a7d-8f8e-a2f5bac4efc6",PlanTableType:4,StartDate:"2016年7月4日",EndDate:"2016年7月10日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"a2445b94-e68d-4853-9fa0-f4fbeb1fe463",PlanTableType:4,StartDate:"2016年7月11日",EndDate:"2016年7月17日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"c745a472-3565-4aea-a0cd-1313452c7e5b",PlanTableType:4,StartDate:"2016年7月18日",EndDate:"2016年7月24日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"0b054468-fe91-4315-b504-efe00dd8d8c1",PlanTableType:4,StartDate:"2016年7月25日",EndDate:"2016年7月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"f708d437-c348-4308-8462-4a5af5c1180e",PlanTableType:3,StartDate:"2016年8月1日",EndDate:"2016年8月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"6882c295-fd7b-4442-aa36-00c526ea5155",PlanTableType:4,StartDate:"2016年8月1日",EndDate:"2016年8月7日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"25a4b0a6-9bc5-4a46-bd4d-e68d559eb66c",PlanTableType:4,StartDate:"2016年8月8日",EndDate:"2016年8月14日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"3c0bc3f1-e32d-4066-9107-a1f41b1c1be6",PlanTableType:4,StartDate:"2016年8月15日",EndDate:"2016年8月21日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"22f67300-b866-43a4-87c1-b7ecf8d5e9bf",PlanTableType:4,StartDate:"2016年8月22日",EndDate:"2016年8月28日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"a44435a6-a35f-475c-890d-ae5794809a65",PlanTableType:4,StartDate:"2016年8月29日",EndDate:"2016年9月4日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"8cf51b5e-172b-4b1a-b992-6772e026668f",PlanTableType:3,StartDate:"2016年9月1日",EndDate:"2016年9月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"d1abf005-c894-496f-afdd-a5b221b8d715",PlanTableType:4,StartDate:"2016年9月5日",EndDate:"2016年9月11日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"b544d1f0-dd80-4508-934c-cdb5a9d708c2",PlanTableType:4,StartDate:"2016年9月12日",EndDate:"2016年9月18日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"a3d82396-14e0-4d72-8d31-46afb12c84ea",PlanTableType:4,StartDate:"2016年9月19日",EndDate:"2016年9月25日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"3d7453e7-efdd-4d86-a5c9-e20b85bb4f49",PlanTableType:4,StartDate:"2016年9月26日",EndDate:"2016年10月2日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"06321390-8b34-4482-8358-50db327795f0",PlanTableType:3,StartDate:"2016年10月1日",EndDate:"2016年10月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"491896c7-82f8-4c1a-a2d1-251bb7b26784",PlanTableType:4,StartDate:"2016年10月3日",EndDate:"2016年10月9日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"baf70bf1-3537-4371-a72e-74f3f66c28d0",PlanTableType:4,StartDate:"2016年10月10日",EndDate:"2016年10月16日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"f2705b4d-370b-4ab5-87cb-78a6b2fd825d",PlanTableType:4,StartDate:"2016年10月17日",EndDate:"2016年10月23日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"f692bbc0-8b49-4561-ab8e-2309f076370b",PlanTableType:4,StartDate:"2016年10月24日",EndDate:"2016年10月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"0d9e9ac4-4ffc-41be-9dde-730fee29317c",PlanTableType:4,StartDate:"2016年10月31日",EndDate:"2016年11月6日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"7b3ec511-1636-4bf1-b3fa-8a4b6a538c50",PlanTableType:3,StartDate:"2016年11月1日",EndDate:"2016年11月30日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"8dad95ae-3574-43e7-b6be-4700a020b70a",PlanTableType:4,StartDate:"2016年11月7日",EndDate:"2016年11月13日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"b8fff8c1-3ae6-47be-82b0-2c33c53504d9",PlanTableType:4,StartDate:"2016年11月14日",EndDate:"2016年11月20日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"4edb4bd0-6c01-460f-8a97-a0f97d970384",PlanTableType:4,StartDate:"2016年11月21日",EndDate:"2016年11月27日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"9e43b31a-ca96-4dce-8e8f-9de918547944",PlanTableType:4,StartDate:"2016年11月28日",EndDate:"2016年12月4日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"fd277bfb-c5ce-4aa7-9ecb-c1db8a1d9930",PlanTableType:3,StartDate:"2016年12月1日",EndDate:"2016年12月31日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"a02e54b9-aa89-441b-b835-f44741488538",PlanTableType:4,StartDate:"2016年12月5日",EndDate:"2016年12月11日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"9ed10e35-b3d6-4cf9-9170-b188edb6e298",PlanTableType:4,StartDate:"2016年12月12日",EndDate:"2016年12月18日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"82ce4bd5-3c8e-4215-a431-97e9a3d077f0",PlanTableType:4,StartDate:"2016年12月19日",EndDate:"2016年12月25日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"6804c70f-f342-436b-b4cd-e93dcb03b851",PlanTableType:4,StartDate:"2016年12月26日",EndDate:"2017年1月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2017年1月1日",Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:5,GroupName:"2017",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"c919ef6f-fa7b-4902-b7cb-9bd2ff0ad456",PlanTableType:1,StartDate:"2017年1月1日",EndDate:"2017年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"7356d186-fc75-4c36-b9af-6c21c8334f0e",PlanTableType:2,StartDate:"2017年1月1日",EndDate:"2017年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"6d0f1fa9-4ba4-47b6-bb31-d5ae63befdd3",PlanTableType:2,StartDate:"2017年4月1日",EndDate:"2017年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"db586786-9dab-422e-8c99-0e2ce6ee1b42",PlanTableType:2,StartDate:"2017年7月1日",EndDate:"2017年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"0b683c99-cd05-4001-b239-f8ebd2d7795a",PlanTableType:2,StartDate:"2017年10月1日",EndDate:"2017年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"2da3dbb6-cdf3-4cdc-844a-5f9280d1fadb",PlanTableType:3,StartDate:"2017年1月1日",EndDate:"2017年1月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"cc9bd41b-b562-4aa8-b2fa-d4f68954d43b",PlanTableType:4,StartDate:"2017年1月2日",EndDate:"2017年1月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"1c9da6ee-1c4e-4d70-a447-9af0b80329f0",PlanTableType:4,StartDate:"2017年1月9日",EndDate:"2017年1月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"1dcd593e-b85a-44d7-b4b0-b2274a5cc855",PlanTableType:4,StartDate:"2017年1月16日",EndDate:"2017年1月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"34eafe66-cabf-4225-b532-1e58a31f5bd2",PlanTableType:4,StartDate:"2017年1月23日",EndDate:"2017年1月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"1e9e2ac7-1fde-4a5d-809a-5be2ddf6424d",PlanTableType:3,StartDate:"2017年2月1日",EndDate:"2017年2月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"cf7634d6-bdef-496a-9889-39228810a9c0",PlanTableType:4,StartDate:"2017年1月30日",EndDate:"2017年2月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"7ed484e6-4f0b-4a40-9175-d4bc9ce7a071",PlanTableType:4,StartDate:"2017年2月6日",EndDate:"2017年2月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"99b11eb2-3874-451f-bd2f-bd81c5e23291",PlanTableType:4,StartDate:"2017年2月13日",EndDate:"2017年2月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"13acceaa-6845-44d4-ab92-4cd9d4a79688",PlanTableType:4,StartDate:"2017年2月20日",EndDate:"2017年2月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"629dc485-8841-4fb2-957d-689de6afa232",
PlanTableType:3,StartDate:"2017年3月1日",EndDate:"2017年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"c8213e12-4d2e-44d1-a312-d73d362fc84e",PlanTableType:4,StartDate:"2017年2月27日",EndDate:"2017年3月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"f605790d-9783-4785-bd9e-02481e6cb41d",PlanTableType:4,StartDate:"2017年3月6日",EndDate:"2017年3月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"5d1d3f18-3cd5-404d-b395-8a624d8aad3b",PlanTableType:4,StartDate:"2017年3月13日",EndDate:"2017年3月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"23abb523-d823-47de-8f9d-925723ef6c65",PlanTableType:4,StartDate:"2017年3月20日",EndDate:"2017年3月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"c97ccbc1-4af8-45ee-bf6c-b6541fb736d8",PlanTableType:4,StartDate:"2017年3月27日",EndDate:"2017年4月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"6ae66818-07d0-40a2-a1be-9adbb23e4a64",PlanTableType:3,StartDate:"2017年4月1日",EndDate:"2017年4月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"0165218d-f70a-48b4-a0f2-200004e9c5d6",PlanTableType:4,StartDate:"2017年4月3日",EndDate:"2017年4月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"09a3f481-daea-487b-88f1-cf9091449cac",PlanTableType:4,StartDate:"2017年4月10日",EndDate:"2017年4月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"cb1d8a52-549b-4d62-82db-800d3ce4205a",PlanTableType:4,StartDate:"2017年4月17日",EndDate:"2017年4月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"b6daab90-1caa-4b2c-8d6f-4e4d3ae7b16d",PlanTableType:4,StartDate:"2017年4月24日",EndDate:"2017年4月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b7616414-3384-4a0a-81b4-77448878d314",PlanTableType:3,StartDate:"2017年5月1日",EndDate:"2017年5月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"8d578f06-f7c6-4cbd-a019-ecf380db026f",PlanTableType:4,StartDate:"2017年5月1日",EndDate:"2017年5月7日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"795bc646-d3d7-4f7d-b028-7aff8a614244",PlanTableType:4,StartDate:"2017年5月8日",EndDate:"2017年5月14日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"8b3c076b-3025-40db-aa4a-ed00e1572d4f",PlanTableType:4,StartDate:"2017年5月15日",EndDate:"2017年5月21日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"6d4f6d58-6512-430e-84b2-1869021e10aa",PlanTableType:4,StartDate:"2017年5月22日",EndDate:"2017年5月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"999ff076-a7dc-42cf-a26c-f0dfb66532c8",PlanTableType:4,StartDate:"2017年5月29日",EndDate:"2017年6月4日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"2098d037-2eb5-4eef-8ef0-752971e3353f",PlanTableType:3,StartDate:"2017年6月1日",EndDate:"2017年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"d0619ad8-4a8d-440c-8674-57e718a26357",PlanTableType:4,StartDate:"2017年6月5日",EndDate:"2017年6月11日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"de34a2a4-680a-4461-87b2-c0d2baf3a265",PlanTableType:4,StartDate:"2017年6月12日",EndDate:"2017年6月18日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"9250d5ce-bdf9-4304-8a65-c88d8a60ba54",PlanTableType:4,StartDate:"2017年6月19日",EndDate:"2017年6月25日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"31147102-e55a-4de5-a0f4-b0fad5451984",PlanTableType:4,StartDate:"2017年6月26日",EndDate:"2017年7月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"00b97b62-f53c-4182-a863-8a898e38e9de",PlanTableType:3,StartDate:"2017年7月1日",EndDate:"2017年7月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"7fac8467-be32-4f76-a537-ac3d54d91793",PlanTableType:4,StartDate:"2017年7月3日",EndDate:"2017年7月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"e352c319-096b-4394-b2c6-065db0b2ff95",PlanTableType:4,StartDate:"2017年7月10日",EndDate:"2017年7月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"e9e5845f-7a51-4862-89b4-5890ae283f64",PlanTableType:4,StartDate:"2017年7月17日",EndDate:"2017年7月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"ba953d4e-86e8-4eb5-908a-aed5d15d3b75",PlanTableType:4,StartDate:"2017年7月24日",EndDate:"2017年7月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"275679ac-f39b-4506-89f4-da39a56b9a86",PlanTableType:3,StartDate:"2017年8月1日",EndDate:"2017年8月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"b061e677-741f-4c4e-bd81-11b5f2c827c6",PlanTableType:4,StartDate:"2017年7月31日",EndDate:"2017年8月6日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"79c62be7-ef34-402b-aa88-2cd20eef74c7",PlanTableType:4,StartDate:"2017年8月7日",EndDate:"2017年8月13日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"71bbc8a5-4df8-47f5-9e45-5973811fe75b",PlanTableType:4,StartDate:"2017年8月14日",EndDate:"2017年8月20日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"fe0dde16-77ad-48d4-b6ed-54916016ce19",PlanTableType:4,StartDate:"2017年8月21日",EndDate:"2017年8月27日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"f534682b-74bf-4e30-9f3b-567ab0ca0315",PlanTableType:4,StartDate:"2017年8月28日",EndDate:"2017年9月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"8e32f3a5-1374-4327-84ee-4ed2e2ba7a67",PlanTableType:3,StartDate:"2017年9月1日",EndDate:"2017年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"d5ca162c-3e3d-4a24-a133-5e038679ff27",PlanTableType:4,StartDate:"2017年9月4日",EndDate:"2017年9月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"009410b6-f27b-490e-9e9d-0f6b28a1bbd7",PlanTableType:4,StartDate:"2017年9月11日",EndDate:"2017年9月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"0cc78d6a-db59-4839-80c1-01b9ef66627b",PlanTableType:4,StartDate:"2017年9月18日",EndDate:"2017年9月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"52c89591-d2d7-4e8b-b840-a3b9dcb56402",PlanTableType:4,StartDate:"2017年9月25日",EndDate:"2017年10月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"2c294c12-dba7-49b9-b26d-a36b0dc0c735",PlanTableType:3,StartDate:"2017年10月1日",EndDate:"2017年10月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"52b41f66-6e0a-4d4d-ac51-f0d2a19b9cfc",PlanTableType:4,StartDate:"2017年10月2日",EndDate:"2017年10月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"d34220df-4b67-4e70-af7d-bbbb27914c4d",PlanTableType:4,StartDate:"2017年10月9日",EndDate:"2017年10月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"4a54ddd3-676b-4d03-8766-b60016781b5a",PlanTableType:4,StartDate:"2017年10月16日",EndDate:"2017年10月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"fb06d8e2-f8c2-4a56-889d-066d6ba2444d",PlanTableType:4,StartDate:"2017年10月23日",EndDate:"2017年10月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"5c4ecdd5-a6b1-43dd-a5f1-6f483ba4ac67",PlanTableType:3,StartDate:"2017年11月1日",EndDate:"2017年11月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"712ef4cd-904f-488a-8c59-90e896288304",PlanTableType:4,StartDate:"2017年10月30日",EndDate:"2017年11月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c8506798-2bec-4478-800f-8fce9b50cdc4",PlanTableType:4,StartDate:"2017年11月6日",EndDate:"2017年11月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"abea2a95-897b-49c8-b1d3-cf1b1a831445",PlanTableType:4,StartDate:"2017年11月13日",EndDate:"2017年11月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"ee83b161-ea63-4923-bda3-a362b07806e8",PlanTableType:4,StartDate:"2017年11月20日",EndDate:"2017年11月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"850b71ba-c75a-4804-b5fe-9b2995986348",PlanTableType:4,StartDate:"2017年11月27日",EndDate:"2017年12月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"5ce217e1-a988-4d72-a3d7-bbf2ae65efe9",PlanTableType:3,StartDate:"2017年12月1日",EndDate:"2017年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"823f4555-2222-4972-9a62-d777df03586b",PlanTableType:4,StartDate:"2017年12月4日",EndDate:"2017年12月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"2c7049ba-984a-4c4d-a1c8-a6883f1c3cdb",PlanTableType:4,StartDate:"2017年12月11日",EndDate:"2017年12月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"a5c44fab-c1d1-4b1c-ad38-35c8e9f8cc14",PlanTableType:4,StartDate:"2017年12月18日",EndDate:"2017年12月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"86fd840e-9b71-49be-9c07-f99845ea7217",PlanTableType:4,StartDate:"2017年12月25日",EndDate:"2017年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2021年1月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:6,GroupName:"2018",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"1ec930c7-dca3-4faa-9bc4-9f9ffa72cf09",PlanTableType:1,StartDate:"2018年1月1日",EndDate:"2018年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"7f3fad58-a16c-45fa-a330-8548eb037baf",PlanTableType:2,StartDate:"2018年1月1日",EndDate:"2018年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"adc5a1ef-1a3c-48f2-9c31-78b8019e5514",PlanTableType:2,StartDate:"2018年4月1日",EndDate:"2018年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"8494d83a-9d01-4cc9-9281-275feb5d9d19",PlanTableType:2,StartDate:"2018年7月1日",EndDate:"2018年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"b14e57f4-766b-4575-8082-2b51cfe30239",PlanTableType:2,StartDate:"2018年10月1日",EndDate:"2018年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"46bba2ac-9bfb-4849-a201-c65b71243778",PlanTableType:3,StartDate:"2018年1月1日",EndDate:"2018年1月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"39d0ee62-9329-4771-9da2-4625bb4e5d68",PlanTableType:4,StartDate:"2018年1月1日",EndDate:"2018年1月7日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"53dce6b3-9a5a-47a2-a481-4c173b7434e7",PlanTableType:4,StartDate:"2018年1月8日",EndDate:"2018年1月14日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"7f7985ab-c0cd-4e80-875c-e0beae790afc",PlanTableType:4,StartDate:"2018年1月15日",EndDate:"2018年1月21日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"34797d3c-e69a-4ace-859e-99efb257bed4",PlanTableType:4,StartDate:"2018年1月22日",EndDate:"2018年1月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"acbd9d54-8f7b-4eab-b240-e27ee85ed37a",PlanTableType:4,StartDate:"2018年1月29日",EndDate:"2018年2月4日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"caec609f-705a-4d4b-ad39-00b653997d41",PlanTableType:3,StartDate:"2018年2月1日",EndDate:"2018年2月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"2fdc7902-2535-461e-b760-48a41d147fb5",PlanTableType:4,StartDate:"2018年2月5日",EndDate:"2018年2月11日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"7b30804a-8a40-4cad-8db9-90dce176213c",PlanTableType:4,StartDate:"2018年2月12日",EndDate:"2018年2月18日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"25a81a07-81b5-44aa-a645-f96cc7a84121",PlanTableType:4,StartDate:"2018年2月19日",EndDate:"2018年2月25日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"12db8115-e855-4eb5-941c-bef8eba8a7b1",PlanTableType:4,StartDate:"2018年2月26日",EndDate:"2018年3月4日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"e6551c00-d6a3-4a50-9fb8-68cf385602ac",PlanTableType:3,StartDate:"2018年3月1日",EndDate:"2018年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"0796e0d5-963a-4076-b363-dcc895851c18",PlanTableType:4,StartDate:"2018年3月5日",EndDate:"2018年3月11日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"cbe3a58c-9360-4b58-89da-183d2f8da71c",PlanTableType:4,StartDate:"2018年3月12日",EndDate:"2018年3月18日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"23b1ab69-b6cd-4ae8-b4e3-84c63a58bf71",PlanTableType:4,StartDate:"2018年3月19日",EndDate:"2018年3月25日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"df9c9d76-fbc5-4922-8dce-9a5c196e2e42",PlanTableType:4,StartDate:"2018年3月26日",EndDate:"2018年4月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"763683fb-ca30-4ec2-b4a8-d4bdeb029303",PlanTableType:3,StartDate:"2018年4月1日",EndDate:"2018年4月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"d135ff4d-e56d-4c56-9d69-81dd95392ccf",PlanTableType:4,StartDate:"2018年4月2日",EndDate:"2018年4月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"423d127d-bd05-443b-b1bd-5a8a88ecd931",PlanTableType:4,StartDate:"2018年4月9日",EndDate:"2018年4月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"738cc9c3-241d-46bc-8546-c38998ebb38f",PlanTableType:4,StartDate:"2018年4月16日",EndDate:"2018年4月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"72650ecd-dccd-46dc-8336-83911c6a9c1d",PlanTableType:4,StartDate:"2018年4月23日",EndDate:"2018年4月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"c92d83c4-67e7-4970-bc20-7c5c88c661c2",PlanTableType:3,StartDate:"2018年5月1日",EndDate:"2018年5月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"75ae22b2-522d-484d-aa5a-29cb606f4945",PlanTableType:4,StartDate:"2018年4月30日",EndDate:"2018年5月6日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"577d2e77-35ee-4292-92b2-7ffbec04eacf",PlanTableType:4,StartDate:"2018年5月7日",EndDate:"2018年5月13日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"bf010875-ef32-412c-b25b-6a5608ff3025",PlanTableType:4,StartDate:"2018年5月14日",EndDate:"2018年5月20日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"c7ee2968-a4f6-4adf-9259-e62a6146ac10",PlanTableType:4,StartDate:"2018年5月21日",EndDate:"2018年5月27日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"9538566e-7a02-4293-93bc-ca07ad992dfa",PlanTableType:4,StartDate:"2018年5月28日",EndDate:"2018年6月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"5a7cc222-34a9-4a72-9f1d-351889d085b8",PlanTableType:3,StartDate:"2018年6月1日",EndDate:"2018年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"3462aa80-16b5-455b-8130-67f0c196824b",PlanTableType:4,StartDate:"2018年6月4日",EndDate:"2018年6月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"7cb5bb13-4efc-403f-bd2a-7f310a0ced0f",PlanTableType:4,StartDate:"2018年6月11日",EndDate:"2018年6月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"912cae74-e357-481e-b202-55df5b724928",PlanTableType:4,StartDate:"2018年6月18日",EndDate:"2018年6月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"6517def0-e129-4713-9160-6522a077ead6",PlanTableType:4,StartDate:"2018年6月25日",EndDate:"2018年7月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"ec6c6a9b-fb1f-4b62-bb8f-e5b9d6e1658c",PlanTableType:3,StartDate:"2018年7月1日",EndDate:"2018年7月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"52253eaf-d702-4774-b0df-358de3195df9",PlanTableType:4,StartDate:"2018年7月2日",EndDate:"2018年7月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"d5f8a03f-575b-4999-9ea3-8f2006c370bd",PlanTableType:4,StartDate:"2018年7月9日",EndDate:"2018年7月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"29993fc6-d2e4-4827-b44a-bd1ce2c5de6f",PlanTableType:4,StartDate:"2018年7月16日",EndDate:"2018年7月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"5635c6d7-047c-4f16-8684-f17c35b6fa8f",PlanTableType:4,StartDate:"2018年7月23日",EndDate:"2018年7月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"ff110907-4a83-45bf-b1f4-d548c12d5792",PlanTableType:3,StartDate:"2018年8月1日",EndDate:"2018年8月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"6a82c87c-ce9d-44a7-87ed-cb560b40e0f0",PlanTableType:4,StartDate:"2018年7月30日",EndDate:"2018年8月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"6160c8f4-7f31-4117-8255-82d651df01b0",PlanTableType:4,StartDate:"2018年8月6日",EndDate:"2018年8月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"55711b7e-4831-4914-a60d-12cf50afc6e3",PlanTableType:4,StartDate:"2018年8月13日",EndDate:"2018年8月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"1b5bcfae-0a57-494e-9c1a-611562c75fbd",PlanTableType:4,StartDate:"2018年8月20日",EndDate:"2018年8月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"d6cfb7b9-e4b9-433c-83d5-6bc67cba0b48",PlanTableType:4,StartDate:"2018年8月27日",EndDate:"2018年9月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"fea42cc5-a941-4274-ab8a-44ae63c4cccf",PlanTableType:3,StartDate:"2018年9月1日",EndDate:"2018年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"7448c110-4280-427f-8b25-af456fe1fc44",PlanTableType:4,StartDate:"2018年9月3日",EndDate:"2018年9月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"ea372441-541b-4678-bd6c-56ba1feecb6a",PlanTableType:4,StartDate:"2018年9月10日",EndDate:"2018年9月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"a6e80e70-ea19-43e9-b2a5-d3e2b8f82730",PlanTableType:4,StartDate:"2018年9月17日",EndDate:"2018年9月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"8d81efcd-a578-426c-bc14-23993f2237c5",PlanTableType:4,StartDate:"2018年9月24日",EndDate:"2018年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"d38d2c40-e42b-45b3-87c7-750f783bb188",PlanTableType:3,StartDate:"2018年10月1日",EndDate:"2018年10月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"6004a6b2-48ee-47aa-8596-4b101055c103",PlanTableType:4,StartDate:"2018年10月1日",EndDate:"2018年10月7日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"dcb29821-4f5c-40a2-a5f3-85cd634d703e",PlanTableType:4,StartDate:"2018年10月8日",EndDate:"2018年10月14日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"884aa22c-c284-42a7-ab11-97512da3fca8",PlanTableType:4,StartDate:"2018年10月15日",EndDate:"2018年10月21日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"c9a0825e-cc05-46e9-9b63-117f621abb7d",PlanTableType:4,StartDate:"2018年10月22日",EndDate:"2018年10月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"2ed0e13b-5ae3-48b3-bd99-e9fb009dcf55",PlanTableType:4,StartDate:"2018年10月29日",EndDate:"2018年11月4日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"cee7f0f9-c69d-4955-a109-8067bd56fbb6",PlanTableType:3,StartDate:"2018年11月1日",EndDate:"2018年11月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"1a162c63-2437-474f-a0a2-677537c79f4c",PlanTableType:4,StartDate:"2018年11月5日",EndDate:"2018年11月11日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c9da6415-22d4-4663-b2cf-9c92520f525b",PlanTableType:4,StartDate:"2018年11月12日",EndDate:"2018年11月18日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"ec80d07c-fedf-493d-b4d8-33168bb20e74",PlanTableType:4,StartDate:"2018年11月19日",EndDate:"2018年11月25日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"b65689d3-5ecb-4817-a1f6-cc2801bd514b",PlanTableType:4,StartDate:"2018年11月26日",EndDate:"2018年12月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"38ac860b-04e5-439b-81f1-8eb01a67ef68",PlanTableType:3,StartDate:"2018年12月1日",EndDate:"2018年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"1d5e987d-cec4-49cc-bb24-2b8bc1d8dfd5",PlanTableType:4,StartDate:"2018年12月3日",EndDate:"2018年12月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"bb2e0693-b1e3-44ec-90c2-f1811a3ff260",PlanTableType:4,StartDate:"2018年12月10日",EndDate:"2018年12月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d04c7994-4964-427c-b355-7062c785b014",PlanTableType:4,StartDate:"2018年12月17日",EndDate:"2018年12月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"7f120040-7acc-41e0-be88-b25098047e88",PlanTableType:4,StartDate:"2018年12月24日",EndDate:"2018年12月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2021年1月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:7,GroupName:"2019",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"cac0dd07-ed64-4f92-91d1-8dd6d9db9db2",PlanTableType:1,StartDate:"2019年1月1日",EndDate:"2019年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"ddda4952-24c9-439c-91b0-e3c20c03296c",PlanTableType:2,StartDate:"2019年1月1日",EndDate:"2019年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"0fb0e2ab-86ba-43f0-9d8a-f67765f26ee7",PlanTableType:2,StartDate:"2019年4月1日",EndDate:"2019年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"4cde5937-7432-4e21-ad21-b2d14144f3dd",PlanTableType:2,StartDate:"2019年7月1日",EndDate:"2019年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"e06069d2-0e13-4012-b6cb-52d53db804e8",PlanTableType:2,StartDate:"2019年10月1日",EndDate:"2019年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"c2f1562a-bbd6-4e30-937b-2f77b8896d39",PlanTableType:3,StartDate:"2019年1月1日",EndDate:"2019年1月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"ce2e2530-3c9f-4259-af54-26347b03a257",PlanTableType:4,StartDate:"2018年12月31日",EndDate:"2019年1月6日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"09037db8-8d56-4a9e-978a-80ead24c161a",PlanTableType:4,StartDate:"2019年1月7日",EndDate:"2019年1月13日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"742b938b-f315-42f5-99b0-e6f5180d57e3",PlanTableType:4,StartDate:"2019年1月14日",EndDate:"2019年1月20日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"c3831f27-19c1-4484-86ad-d242da094bb7",PlanTableType:4,StartDate:"2019年1月21日",EndDate:"2019年1月27日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"5c1acd10-fbf4-45e3-bffb-84152bd04afd",PlanTableType:4,StartDate:"2019年1月28日",EndDate:"2019年2月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b1b60dc5-88a5-46dd-a7c0-c5f07c100edb",PlanTableType:3,StartDate:"2019年2月1日",EndDate:"2019年2月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"49ae1e9c-5a5b-4a44-b4db-210d5b648f3e",PlanTableType:4,StartDate:"2019年2月4日",EndDate:"2019年2月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"496b7e28-8d7e-4809-99d7-d8201ebda33d",PlanTableType:4,StartDate:"2019年2月11日",EndDate:"2019年2月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"9dc34d00-60f3-40bf-9e57-3f52050fda68",PlanTableType:4,StartDate:"2019年2月18日",EndDate:"2019年2月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"28f36bcb-fbe9-424f-999b-a31e0d6ee3f5",PlanTableType:4,StartDate:"2019年2月25日",EndDate:"2019年3月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"014d67d9-554c-4980-9e36-12ec3f6306cd",PlanTableType:3,StartDate:"2019年3月1日",EndDate:"2019年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"cf6a8f7c-4ba9-469e-9817-da3b7f79f045",PlanTableType:4,StartDate:"2019年3月4日",EndDate:"2019年3月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"b51ed903-631b-420f-8ec1-757dcb656787",PlanTableType:4,StartDate:"2019年3月11日",EndDate:"2019年3月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"90cff138-cc08-4ad4-a2af-d357549c9510",PlanTableType:4,StartDate:"2019年3月18日",EndDate:"2019年3月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"71f357ab-09ea-4a83-8699-d1e3feeca46d",PlanTableType:4,StartDate:"2019年3月25日",EndDate:"2019年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"48026d47-cb43-4f1e-ae88-7925d6fc15a9",PlanTableType:3,StartDate:"2019年4月1日",EndDate:"2019年4月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"5a239090-6485-4ca6-8b89-5fff2c850a6e",PlanTableType:4,StartDate:"2019年4月1日",EndDate:"2019年4月7日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"fc520aa6-cd0c-4822-b878-99cab5a7623c",PlanTableType:4,StartDate:"2019年4月8日",EndDate:"2019年4月14日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"711de9ff-ae2a-4884-8bed-3689193089c8",PlanTableType:4,StartDate:"2019年4月15日",EndDate:"2019年4月21日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"bf861de6-ac10-4ed5-a07c-657fc8e6462e",PlanTableType:4,StartDate:"2019年4月22日",EndDate:"2019年4月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"a6e4efe1-2a85-487a-b75d-3f2a3522154c",PlanTableType:3,StartDate:"2019年5月1日",EndDate:"2019年5月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"d88be75f-5811-45f3-bcbf-e4dbe4c6e966",PlanTableType:4,StartDate:"2019年4月29日",EndDate:"2019年5月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"21791782-020a-4580-83b2-845124fe8067",PlanTableType:4,StartDate:"2019年5月6日",EndDate:"2019年5月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"08292e1f-799e-4381-9dad-5adec43f9167",PlanTableType:4,StartDate:"2019年5月13日",EndDate:"2019年5月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0
},{Name:"第4周",PlanTableId:"807130ec-a167-47b7-97af-386b808ec716",PlanTableType:4,StartDate:"2019年5月20日",EndDate:"2019年5月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"691e5ddb-e824-48c3-8d93-567e73081004",PlanTableType:4,StartDate:"2019年5月27日",EndDate:"2019年6月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b878ecc4-eeb3-457b-9ce1-cfa4d853f4c9",PlanTableType:3,StartDate:"2019年6月1日",EndDate:"2019年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"e9a0658b-3fa1-482a-bbea-4aec6e29fd60",PlanTableType:4,StartDate:"2019年6月3日",EndDate:"2019年6月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"0533e26d-2583-4a62-bdd3-b478f21b0a98",PlanTableType:4,StartDate:"2019年6月10日",EndDate:"2019年6月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"febc8b40-32b1-497d-8678-51810bef174b",PlanTableType:4,StartDate:"2019年6月17日",EndDate:"2019年6月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"ffd86a10-9dab-4ffb-b7c1-4a7d011c05c2",PlanTableType:4,StartDate:"2019年6月24日",EndDate:"2019年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"0e422e89-ee1a-4971-a5ed-dfd7c8dfd76f",PlanTableType:3,StartDate:"2019年7月1日",EndDate:"2019年7月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"aa027e1b-3f8b-41f0-bc57-bc86b54de9eb",PlanTableType:4,StartDate:"2019年7月1日",EndDate:"2019年7月7日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"6b50b3ad-d56a-4a3c-b760-a5fa07d0e76a",PlanTableType:4,StartDate:"2019年7月8日",EndDate:"2019年7月14日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"eaaad872-beed-4c2a-90b3-e6f759dc01f9",PlanTableType:4,StartDate:"2019年7月15日",EndDate:"2019年7月21日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"94584380-3d46-4d54-b6e1-d96b4e006b4b",PlanTableType:4,StartDate:"2019年7月22日",EndDate:"2019年7月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"b21817c0-75c7-4a50-8d48-41ff23230e46",PlanTableType:4,StartDate:"2019年7月29日",EndDate:"2019年8月4日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"2444c5fd-8558-4f5e-8eee-1c5e2695569a",PlanTableType:3,StartDate:"2019年8月1日",EndDate:"2019年8月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"684e3b49-a687-4de5-86e2-94b168e7eca8",PlanTableType:4,StartDate:"2019年8月5日",EndDate:"2019年8月11日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"c5b0ff0e-a8c7-4b86-ac82-0f90580b2f84",PlanTableType:4,StartDate:"2019年8月12日",EndDate:"2019年8月18日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"bf71e539-d466-4ff5-9f51-0075bd9ebeb5",PlanTableType:4,StartDate:"2019年8月19日",EndDate:"2019年8月25日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"028f9f20-0361-49e7-90b6-5d109d5eadd7",PlanTableType:4,StartDate:"2019年8月26日",EndDate:"2019年9月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"9fafc1df-e510-46c5-af56-339af0c39ac5",PlanTableType:3,StartDate:"2019年9月1日",EndDate:"2019年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"066c4303-8fa1-4cd6-9450-f202e70388f3",PlanTableType:4,StartDate:"2019年9月2日",EndDate:"2019年9月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"cf2a1051-0bf9-4fc9-9b58-ed1ccddadf58",PlanTableType:4,StartDate:"2019年9月9日",EndDate:"2019年9月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"3fafc753-5109-4804-9fde-ca3d2d9cc94d",PlanTableType:4,StartDate:"2019年9月16日",EndDate:"2019年9月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"633ca7b0-fa1e-4878-b058-c33ff1d6203d",PlanTableType:4,StartDate:"2019年9月23日",EndDate:"2019年9月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"934bdfb8-4a71-4e45-b9cb-07bdb0937958",PlanTableType:3,StartDate:"2019年10月1日",EndDate:"2019年10月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"f6c9c119-d733-487a-a16b-40143e95af3f",PlanTableType:4,StartDate:"2019年9月30日",EndDate:"2019年10月6日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"4375ee74-5d1b-4aab-b7d1-4cc433353677",PlanTableType:4,StartDate:"2019年10月7日",EndDate:"2019年10月13日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"26bb8943-cb10-4734-8162-71e4a95f51eb",PlanTableType:4,StartDate:"2019年10月14日",EndDate:"2019年10月20日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"931c0d5e-5008-469f-ab35-e219f8e345ed",PlanTableType:4,StartDate:"2019年10月21日",EndDate:"2019年10月27日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"47c4d786-6daf-4938-aab8-bd2b65ecd044",PlanTableType:4,StartDate:"2019年10月28日",EndDate:"2019年11月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"62adb03f-2c9c-436c-b37b-b4242276303c",PlanTableType:3,StartDate:"2019年11月1日",EndDate:"2019年11月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"288ec5b0-c73d-4aa6-8385-557d693e2a0f",PlanTableType:4,StartDate:"2019年11月4日",EndDate:"2019年11月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"6f7480c7-5f1e-4153-9e18-39096e19e59d",PlanTableType:4,StartDate:"2019年11月11日",EndDate:"2019年11月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"fdaec73d-ac0b-4188-bcfc-340c53805c4c",PlanTableType:4,StartDate:"2019年11月18日",EndDate:"2019年11月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"a4a03f5b-5c94-4350-93e6-ac6a7c216944",PlanTableType:4,StartDate:"2019年11月25日",EndDate:"2019年12月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"61dcc570-dd87-45d1-9122-ba94fa74f53d",PlanTableType:3,StartDate:"2019年12月1日",EndDate:"2019年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"6d4bc2df-1e08-4020-8156-5ec01c5e2584",PlanTableType:4,StartDate:"2019年12月2日",EndDate:"2019年12月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"719ec756-2cb5-4627-9934-829d99dd8537",PlanTableType:4,StartDate:"2019年12月9日",EndDate:"2019年12月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"62cc7b6d-f413-408c-afcc-4d7beb72a9ce",PlanTableType:4,StartDate:"2019年12月16日",EndDate:"2019年12月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"ca291e39-881f-4840-8f01-bf9729c1407e",PlanTableType:4,StartDate:"2019年12月23日",EndDate:"2019年12月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2021年1月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]},{GroupId:8,GroupName:"2020",Active:false,PlanTableListModels:[{TagId:1,TagName:"年/季",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"年度",PlanTableId:"69928c98-426c-4563-ae25-bb25a2bd7bae",PlanTableType:1,StartDate:"2020年1月1日",EndDate:"2020年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第一季度",PlanTableId:"6cb12707-518c-4b3e-a09d-e81f01c340e3",PlanTableType:2,StartDate:"2020年1月1日",EndDate:"2020年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第二季度",PlanTableId:"88fb58f0-5398-4dbd-8de8-039158a00d60",PlanTableType:2,StartDate:"2020年4月1日",EndDate:"2020年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第三季度",PlanTableId:"4f4d787c-6397-436a-a6ea-86da349528e1",PlanTableType:2,StartDate:"2020年7月1日",EndDate:"2020年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第四季度",PlanTableId:"3ef16d71-2410-488a-8350-63a3aa436fde",PlanTableType:2,StartDate:"2020年10月1日",EndDate:"2020年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:2,TagName:"1月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"cdb88845-e8b4-4351-aa79-c125b1970b7c",PlanTableType:3,StartDate:"2020年1月1日",EndDate:"2020年1月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"a6e3d691-8b05-4b71-b204-751693394577",PlanTableType:4,StartDate:"2019年12月30日",EndDate:"2020年1月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"862172c8-c444-4e05-9ac6-ad342ecfa7a0",PlanTableType:4,StartDate:"2020年1月6日",EndDate:"2020年1月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"81a0fe78-469b-4cd9-9e62-1d25646e6e54",PlanTableType:4,StartDate:"2020年1月13日",EndDate:"2020年1月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"73e065d4-ac5d-4f68-8c0e-5f89492e7636",PlanTableType:4,StartDate:"2020年1月20日",EndDate:"2020年1月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"9606fc28-e300-45ab-b932-d054837b12e7",PlanTableType:4,StartDate:"2020年1月27日",EndDate:"2020年2月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:3,TagName:"2月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"89c4b834-3ed0-4d88-b2d0-a61d07876b59",PlanTableType:3,StartDate:"2020年2月1日",EndDate:"2020年2月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"d89caec1-a132-4c47-b7e9-a0ce676236a8",PlanTableType:4,StartDate:"2020年2月3日",EndDate:"2020年2月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"de3d227b-513f-4ebc-ac0d-b3b40217dd98",PlanTableType:4,StartDate:"2020年2月10日",EndDate:"2020年2月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"bc0d333c-e4be-4c0e-9743-79b9ebb204c4",PlanTableType:4,StartDate:"2020年2月17日",EndDate:"2020年2月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"658f4039-70c4-4728-a25f-8fa260801f7e",PlanTableType:4,StartDate:"2020年2月24日",EndDate:"2020年3月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:4,TagName:"3月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"9d7e9883-1912-4b37-aa59-c8b68ee37c2a",PlanTableType:3,StartDate:"2020年3月1日",EndDate:"2020年3月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"8c135cca-561a-48b5-95ec-183ed84b8dd9",PlanTableType:4,StartDate:"2020年3月2日",EndDate:"2020年3月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"baae2082-bb56-4028-af80-0408bbdd8e5a",PlanTableType:4,StartDate:"2020年3月9日",EndDate:"2020年3月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"1245ea2e-9222-4fcb-b559-17cae082d9d8",PlanTableType:4,StartDate:"2020年3月16日",EndDate:"2020年3月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"832935e6-9631-43c8-adc1-e8a40d20bb5f",PlanTableType:4,StartDate:"2020年3月23日",EndDate:"2020年3月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:5,TagName:"4月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"abaa34fa-ed73-474d-b383-47ba1f8dadeb",PlanTableType:3,StartDate:"2020年4月1日",EndDate:"2020年4月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"2cf61138-7a13-4635-ae76-9db48d09a77d",PlanTableType:4,StartDate:"2020年3月30日",EndDate:"2020年4月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"cd5b6bf3-2749-46bc-9580-7874917ec9d4",PlanTableType:4,StartDate:"2020年4月6日",EndDate:"2020年4月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"cef731ac-9d74-4d61-affd-bc08e1d2da17",PlanTableType:4,StartDate:"2020年4月13日",EndDate:"2020年4月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"0314e5a0-77cb-4d68-a9f6-e40bf4d28b93",PlanTableType:4,StartDate:"2020年4月20日",EndDate:"2020年4月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"d3b1a060-0af7-4412-9d92-065ed526fff1",PlanTableType:4,StartDate:"2020年4月27日",EndDate:"2020年5月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:6,TagName:"5月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b424bfa8-99d7-4c55-8297-4eb4606992f1",PlanTableType:3,StartDate:"2020年5月1日",EndDate:"2020年5月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"88763b44-f681-415b-8bbd-ce2940ee916f",PlanTableType:4,StartDate:"2020年5月4日",EndDate:"2020年5月10日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"630544e7-afbe-48b5-a8a5-7bc308f30f19",PlanTableType:4,StartDate:"2020年5月11日",EndDate:"2020年5月17日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"f14a82c9-ea0a-415a-9938-a0e2c5cd0ecd",PlanTableType:4,StartDate:"2020年5月18日",EndDate:"2020年5月24日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"3ed1c752-f51e-4566-9b54-e06a87f2e588",PlanTableType:4,StartDate:"2020年5月25日",EndDate:"2020年5月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:7,TagName:"6月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"8c560d11-2dda-4fb6-a0f5-38b31541aa36",PlanTableType:3,StartDate:"2020年6月1日",EndDate:"2020年6月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"ad542c49-4099-4f0c-af36-bcfecf7981cf",PlanTableType:4,StartDate:"2020年6月1日",EndDate:"2020年6月7日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"f32f056c-8fdd-4bfe-b886-b999af907f8c",PlanTableType:4,StartDate:"2020年6月8日",EndDate:"2020年6月14日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"8fe840e0-d0b0-452a-a60f-bee43884894e",PlanTableType:4,StartDate:"2020年6月15日",EndDate:"2020年6月21日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"e91600b8-feee-466d-b001-e205057ba347",PlanTableType:4,StartDate:"2020年6月22日",EndDate:"2020年6月28日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:8,TagName:"7月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"fe899fcd-5e96-4fe6-ba44-49096fa45c90",PlanTableType:3,StartDate:"2020年7月1日",EndDate:"2020年7月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"f1754234-a2a3-4f44-95b5-27d4a905b8e0",PlanTableType:4,StartDate:"2020年6月29日",EndDate:"2020年7月5日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"a9675127-9446-4315-9851-4461f7964a6c",PlanTableType:4,StartDate:"2020年7月6日",EndDate:"2020年7月12日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"81daa4c5-9729-401a-b9b5-58e36986998f",PlanTableType:4,StartDate:"2020年7月13日",EndDate:"2020年7月19日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"61aba0fe-5fc4-4a44-93f9-e02606f57edf",PlanTableType:4,StartDate:"2020年7月20日",EndDate:"2020年7月26日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"81a65dd3-2c82-4685-9d04-28d1712bf3b6",PlanTableType:4,StartDate:"2020年7月27日",EndDate:"2020年8月2日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:9,TagName:"8月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b3b7121e-5a17-4c65-b908-2e1a90de5e7b",PlanTableType:3,StartDate:"2020年8月1日",EndDate:"2020年8月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"61f5e365-4e86-4095-a822-49f6f490df0a",PlanTableType:4,StartDate:"2020年8月3日",EndDate:"2020年8月9日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"3a149396-a4bb-479e-954e-40a50911dd3e",PlanTableType:4,StartDate:"2020年8月10日",EndDate:"2020年8月16日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"d0a857f6-5757-4ce7-adb2-2d900891bb6e",PlanTableType:4,StartDate:"2020年8月17日",EndDate:"2020年8月23日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"a1fd5992-92a3-4af1-b517-53f625ad1c56",PlanTableType:4,StartDate:"2020年8月24日",EndDate:"2020年8月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:10,TagName:"9月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"289e0c68-f329-4104-b439-089892048d32",PlanTableType:3,StartDate:"2020年9月1日",EndDate:"2020年9月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"061ca6c4-30f3-4bec-bbc5-fd427380bf5d",PlanTableType:4,StartDate:"2020年8月31日",EndDate:"2020年9月6日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"2565d763-18cf-4eff-a562-a7bfdfc1b736",PlanTableType:4,StartDate:"2020年9月7日",EndDate:"2020年9月13日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"c2a187b5-c149-422b-a692-a0ecae06e6ed",PlanTableType:4,StartDate:"2020年9月14日",EndDate:"2020年9月20日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"999ff88d-5938-4302-bdd6-22e594f9f13f",PlanTableType:4,StartDate:"2020年9月21日",EndDate:"2020年9月27日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"020bd359-370b-42c7-b983-4040ba4fb58a",PlanTableType:4,StartDate:"2020年9月28日",EndDate:"2020年10月4日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:11,TagName:"10月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"91d1ad0d-825b-4b0f-be39-3f9dc15b9853",PlanTableType:3,StartDate:"2020年10月1日",EndDate:"2020年10月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"6f0d00fa-84e7-4c4c-8311-fb30d4dc765f",PlanTableType:4,StartDate:"2020年10月5日",EndDate:"2020年10月11日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"86c1cdc2-2a08-44a1-ba30-6b6be5728fb0",PlanTableType:4,StartDate:"2020年10月12日",EndDate:"2020年10月18日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"3cf57ccb-6188-44d4-843d-291c1675cbf1",PlanTableType:4,StartDate:"2020年10月19日",EndDate:"2020年10月25日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"73a97a86-a98c-4caf-9f9b-6887aaa40c9b",PlanTableType:4,StartDate:"2020年10月26日",EndDate:"2020年11月1日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:12,TagName:"11月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"b8b690e7-8b7e-4589-a0a3-5333ddaa5163",PlanTableType:3,StartDate:"2020年11月1日",EndDate:"2020年11月30日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"590e01aa-5956-4d12-aea3-3ea39239d981",PlanTableType:4,StartDate:"2020年11月2日",EndDate:"2020年11月8日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"710296d9-5dde-4822-9cac-829d3901cc11",PlanTableType:4,StartDate:"2020年11月9日",EndDate:"2020年11月15日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"45400da9-918c-48cf-8e04-fdbd3ab6ee0c",PlanTableType:4,StartDate:"2020年11月16日",EndDate:"2020年11月22日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"4f5cdb86-c9bb-43bd-9aaa-84b0435e024f",PlanTableType:4,StartDate:"2020年11月23日",EndDate:"2020年11月29日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:13,TagName:"12月",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"月度",PlanTableId:"1b45110b-8fc0-492a-959c-6a712c5f9f42",PlanTableType:3,StartDate:"2020年12月1日",EndDate:"2020年12月31日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第1周",PlanTableId:"8c57edef-6651-42e1-a85c-4df0944102a9",PlanTableType:4,StartDate:"2020年11月30日",EndDate:"2020年12月6日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第2周",PlanTableId:"48b1c368-a437-438c-ae82-c8febbf69bbd",PlanTableType:4,StartDate:"2020年12月7日",EndDate:"2020年12月13日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第3周",PlanTableId:"db6f6c1b-c76d-4304-a0d5-8cbf24ab7e39",PlanTableType:4,StartDate:"2020年12月14日",EndDate:"2020年12月20日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第4周",PlanTableId:"2559da1b-25b9-49f4-b696-7bed5973e514",PlanTableType:4,StartDate:"2020年12月21日",EndDate:"2020年12月27日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0},{Name:"第5周",PlanTableId:"6883c9f2-41c6-4bbd-bfb3-2bc4389b6fcf",PlanTableType:4,StartDate:"2020年12月28日",EndDate:"2021年1月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]},{TagId:14,TagName:"待定任务",TagType:1,Date:null,Active:false,PlanTableModels:[{Name:"待定任务",PlanTableId:"09DBFFCC-0F6C-4FB1-9B7A-D07E1046C656",PlanTableType:5,StartDate:"2013年1月1日",EndDate:"2021年1月3日",FeedId:null,Active:false,IsCurrentDate:false,ItemCount:0,IsNotify:0}]}]}]};var PlanCollection={postUpdateLable:function(options){var deferred=new Talent.$.Deferred;var defaults={planItem_id:"",lable_id:"",lable_type:""};var options=Talent._.extend({},defaults,options);var url="PlanV2/UpdateLable";BaseCollection.request({url:url,type:"Post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},postPlanSetMark:function(options){var deferred=new Talent.$.Deferred;var defaults={type:"",plan_id:""};var options=Talent._.extend({},defaults,options);var url="PlanV2/Mark";BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getTaskData:function(options){var self=this;var deferred=new Talent.$.Deferred;var defaults={type:"personal",to_user_id:"",StartDate:"",EndDate:"",startNum:1,count:100,planTableId:"",planTableType:"",fromLevel:1,toLevel:1};options=Talent._.extend({},defaults,options);var url="PlanTableTask/PersionTask?to_user_id="+options.to_user_id;BaseCollection.requestV2({url:url,type:"post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getSearchTaskData:function(options){var self=this;var deferred=new Talent.$.Deferred;var defaults={FilterKey:"",startNum:"",count:20,planTableId:"",to_user_id:""};options=Talent._.extend({},defaults,options);var url="PlanTableTask/Search?to_user_id="+options.to_user_id;BaseCollection.requestV2({url:url,type:"post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getSubPlans:function(options){var deferred=new Talent.$.Deferred,self=this;var defaults={type:1,to_user_id:"",userIds:"",status:"0,1,2,3,4,6",LableModels:[],SortType:"1",RelationType:"1,3,2",parentTaskId:"",StartDate:"",EndDate:"",fromLevel:1,toLevel:2,IsTeam:false};options=Talent._.extend({},defaults,options);var url="PlanTableTask/SubTask?to_user_id="+options.to_user_id+"&type="+options.type;BaseCollection.requestV2({url:url,data:options,type:"post"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},PutUpdateStatus:function(options){var deferred=new Talent.$.Deferred;var defaults={plan_item_id:"",Status:""};var options=Talent._.extend({},defaults,options);var url="PlanV2/UpdateStatus";var params="?plan_item_id="+options["plan_item_id"]+"&Status="+options["Status"];BaseCollection.request({url:url+params,type:"PUT",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},deleteData:function(options){var deferred=new Talent.$.Deferred;var defaults={plan_item_id:""};var options=Talent._.extend({},defaults,options);var url="PlanV2/Remove";var params="?plan_item_id="+options["plan_item_id"];BaseCollection.request({url:url+params,type:"DELETE",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getDataList:function(options){var deferred=new Talent.$.Deferred;var defaults={task_id:"",typ:"personal",to_user_id:"",StartDate:"",EndDate:"",startNum:1,count:0,planTableId:"",planTableType:1,fromLevel:1,toLevel:1};var options=Talent._.extend({},defaults,options),url="task/plantable/tasks",params="?task_id="+options["task_id"];BaseCollection.requestV2({url:url+params,type:"Post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getPlanData:function(){},getPlan:function(options){var deferred=new Talent.$.Deferred;var planDataJson=JSON.stringify(PlanDataJson);var mockData=JSON.parse(planDataJson);var defaults={group_id:"",date:""};var options=Talent._.extend({},defaults,options),data={Data:mockData},self=this;var data=this._findData(data,options);deferred.resolve(data.Data);return deferred.promise()},_findData:function(mockData,options){var data=mockData["Data"].taglist;var dateData=options["date"].split("/");if(options["group_id"]!=0&&moment().year()!=dateData[0]){var year_item=Talent._.findWhere(data,{GroupId:options["group_id"]});var activeYear=year_item,activeMoth=activeYear.PlanTableListModels[0],activeWeek=activeMoth.PlanTableModels[0];activeYear["Active"]=true;activeMoth["Active"]=true;activeWeek["Active"]=true;return mockData}if(dateData[1]=="00"){var year_item=Talent._.findWhere(data,{GroupName:dateData[0]});var activeYear=year_item,activeMoth=activeYear.PlanTableListModels[0],activeWeek=activeMoth.PlanTableModels[0];activeYear["Active"]=true;activeMoth["Active"]=true;activeWeek["Active"]=true;return mockData}if(dateData[2]=="00"){var year_item=Talent._.findWhere(data,{GroupName:dateData[0]});var monthId=Number(dateData[1])+1;var activeYear=year_item,activeMoth=Talent._.findWhere(year_item.PlanTableListModels,{TagId:monthId}),activeWeek=activeMoth.PlanTableModels[0];activeYear["Active"]=true;activeMoth["Active"]=true;activeWeek["Active"]=true;return mockData}for(var i=0;i<data.length;i++){var year_item=data[i];var month_list=year_item["PlanTableListModels"];for(var j=0;j<month_list.length;j++){var month_item=month_list[j],week_list=month_item["PlanTableModels"],tagId=month_item["TagId"];for(var x=0;x<week_list.length;x++){var week_item=week_list[x],startDate=this._formatDate(week_item["StartDate"]),endDate=this._formatDate(week_item["EndDate"]);if(startDate<=options["date"]&&endDate>=options["date"]&&tagId>1&&tagId<14&&x!=0){if(year_item["GroupId"]==options["group_id"]||options["group_id"]==0){week_item["Active"]=true;week_item["IsCurrentDate"]=true;month_item["Active"]=true;year_item["Active"]=true}else{var year_item=talent._.findWhere(data,{GroupId:options["group_id"]});var activeYear=year_item,activeMoth=activeYear.PlanTableListModels[0],activeWeek=activeMoth.PlanTableModels[0];activeYear["Active"]=true;activeMoth["Active"]=true;activeWeek["Active"]=true}}if(startDate>options["date"]){week_item["IsCurrentDate"]=false}}}}return mockData},_formatDate:function(date){var date=date.replace("年","/");date=date.replace("月","/");date=date.replace("日","");return moment(date,"YYYY/M/D").format("YYYY/MM/DD")}};var ProjectCollection={getProject:function(options){var defaults={app_id:"",app_type:"",to_user_id:"",type:1,keyWord:""};var options=Talent._.extend({},defaults,options);var url="Work/MyAssentWork";var params="?app_id="+options["app_id"]+"&app_type="+options["app_type"]+"&to_user_id="+options["to_user_id"]+"&type="+options.type+"&keyWord="+options.keyWord;var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var SetNoticeCollectoin={getData:function(options){var self=this;var defaults={obj_id:0,obj_type:0,content:"一个提醒",cyc_type:0,remind_user_ids:""};var deferred=new Talent.$.Deferred;var options=Talent._.extend({},defaults,options);var url="RemindV2/Get";BaseCollection.request({type:"Get",url:url,data:options}).done(function(resp){deferred.resolve(resp)});return deferred},postUpdateData:function(options){var self=this;var defaults={obj_id:0,obj_type:0,content:"一个提醒",cyc_type:0,remind_user_ids:[],time:""};var deferred=new Talent.$.Deferred;var options=Talent._.extend({},defaults,options);var url="RemindV2/UpdateReminds";BaseCollection.request({type:"post",url:url+"?time="+options["time"],data:options}).done(function(resp){deferred.resolve(resp)});return deferred},postAddRemindData:function(options){var self=this;var defaults={obj_id:0,obj_type:0,content:"一个提醒",cyc_type:0,remind_user_ids:"",time:""};var deferred=new Talent.$.Deferred;var options=Talent._.extend({},defaults,options);var url="RemindV2/Add";BaseCollection.request({type:"post",url:url+"?time="+options["time"],data:options}).done(function(resp){deferred.resolve(resp)});return deferred},getCleanRemindData:function(options){var self=this;var defaults={obj_id:0,obj_type:0};var deferred=new Talent.$.Deferred;var options=Talent._.extend({},defaults,options);var url="RemindV2/DeleteReminds";var params="?obj_id="+options["obj_id"]+"&obj_type="+options["obj_type"];BaseCollection.request({type:"get",url:url+params,data:options}).done(function(resp){deferred.resolve(resp)});return deferred}};var ShareCollection={addShare:function(options){}};var UserSelectorCollection=Talent.Collection.extend({excludeSelf:false,initialize:function(){this.userInfo=Talent.Context.getUserInfo()},getContact:function(){var self=this;this.viewType="Contact";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;$.ajax({url:Context.getApiUrl("Contact?v=")+(new Date).getTime(),type:"GET",success:function(resp){if(self.viewType=="Contact"){if(resp&&resp.Code==1){var collectionData=Talent._.values(resp.Data);if(collectionData.length>0){Talent._.map(collectionData,function(item){item.MidAvatar=item.UserAvatar.Medium;

return item.imgTemplate=Talent._.convertImage({shape:"radius",name:item.Name,src:item.MidAvatar,bgColor:item.UserAvatar.Color})});self.deferred.resolve(collectionData)}else{self.deferred.resolve([])}}else{self.deferred.resolve([])}}}});return self.deferred.promise()},getSubordinate:function(){var self=this;this.viewType="Subordinates";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;var collectionData=[];$.ajax({url:Context.getApiUrl("org/GetMySubordinates?lv=2&type=0"),type:"GET",success:function(resp){if(self.viewType=="Subordinates"){if(resp&&resp.Code==1){var collectionData=Talent._.values(resp.Data);if(collectionData.length>0){Talent._.map(collectionData,function(item){if(item.User){item.User.imgTemplate=Talent._.convertImage({shape:"radius",name:item.User.Name,src:item.User.MidAvatar,bgColor:item.User.UserAvatar.Color})}return item});collectionData=Talent._.filter(collectionData,function(item){return item.User.Id!=self.userInfo.Id});collectionData=Talent._.pluck(collectionData,"User");self.deferred.resolve(collectionData)}else{self.deferred.resolve([])}}else{self.deferred.resolve([])}}}});return self.deferred.promise()},getSearch:function(data){var self=this;this.viewType="Search";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;var condition=data&&data.searchCondition||{};this.filters=condition.name;var url=Context.getApiUrl("user?v="+(new Date).getTime()+"&filters="+encodeURIComponent(condition.name)||"");if(condition.name==""){self.deferred.resolve([])}else{$.ajax({url:url,type:"GET",success:function(resp){if(self.viewType=="Search"){if(resp&&resp.Code==1){var data=resp&&resp.Data||{};if(data.Filters==self.filters){var collectionData=data.SimpleUserModel||{};collectionData=Talent._.values(collectionData);Talent._.map(collectionData,function(item){item.MidAvatar=item.UserAvatar.Medium;return item.imgTemplate=Talent._.convertImage({shape:"radius",name:item.Name,src:item.MidAvatar,bgColor:item.UserAvatar.Color})});if(self.excludeSelf){collectionData=Talent._.filter(collectionData,function(item){return item.Id!=self.userInfo.Id})}self.deferred.resolve(collectionData)}}else{self.deferred.resolve([])}}}})}return self.deferred.promise()},getDepartmentData:function(){var self=this;var deferred=new $.Deferred;var collectionData=[];$.ajax({url:Context.getApiUrl("department/All"),type:"GET",success:function(resp){if(resp&&resp.Code==1){var collectionData=resp.Data||[];Talent._.map(collectionData,function(value,key){value.count=value.TotalUserCount;value.Data=[];value.type="department"});deferred.resolve(collectionData)}else{deferred.resolve([])}}});return deferred.promise()},getDepartment:function(){var self=this;this.viewType="Department";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;var collectionData=[];this.getDepartmentData().done(function(resp){if(self.viewType=="Department"){var collectionData=resp;collectionData=Talent._.filter(collectionData,function(value,key){return value.PId==0});self.deferred.resolve(collectionData)}});return self.deferred.promise()},getDepartmentDetail:function(data){var self=this;this.viewType="Department";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;var collectionData=[];var id=parseInt(data.id);this.getDepartmentData().done(function(resp){var dataList=resp;dataList=Talent._.filter(dataList,function(value,key){return value.PId==id});dataList=dataList||[];$.ajax({url:Context.getApiUrl("department/DepartmentOfUser?department_id=")+data.id,type:"GET",success:function(result){if(self.viewType=="Department"){var resultData=result.Data||[];Talent._.map(resultData,function(item){return item.imgTemplate=Talent._.convertImage({shape:"radius",name:item.Name,src:item.MidAvatar,bgColor:item.UserAvatar.Color})});if(self.excludeSelf){resultData=Talent._.filter(resultData,function(item){return item.Id!=self.userInfo.Id})}dataList=resultData.concat(dataList);self.deferred.resolve(dataList)}}})});return self.deferred.promise()},invite:function(data){var deferred=new $.Deferred;$.ajax({url:Context.getApiUrl("userinvite/inviteUser"),type:"POST",data:data}).done(function(resp){deferred.resolve(resp)});return deferred.promise()}});var SMSCollection={getSmsCheck:function(options){var deferred=new Talent.$.Deferred;var defaults={to_user_id:""};var options=Talent._.extend({},defaults,options);var url="SMS/Check?to_user_id="+options["to_user_id"];BaseCollection.request({url:url,type:"Get"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},postSmsNotifyAddNum:function(options){var deferred=new Talent.$.Deferred;var defaults={to_user_id:"",phoneNum:"",is_notify:""};options=Talent._.extend({},defaults,options);var url="SMS/NotifyAddNum";BaseCollection.request({url:url,type:"Post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred}};var TaskCollection={addTask:function(options){var defaults={TaskName:"",PrincipalUser:"",StartDate:"",EndDate:"",Importance:"",Visibility:"",Description:"",FileUrls:"",RemindTime:"",RemindType:"",hourDate:"",minuteDate:"",singleDate:"",extend_user:"",CycType:"",CycStartDate:"",CycStartTime:"",CycEndDate:"",CycEndTime:"",ApplyUserId:"",IsLongTerm:"",parentTaskId:"",LabId:"",LabType:"",PlanTableId:"",planTableType:"",TaskSource:"",AddPlan:"",objType:""};var options=Talent._.extend({},defaults,options);var url="task/Add";var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"post",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},updateLable:function(options){var defaults={task_id:"",lab_id:"",lab_type:""};var options=Talent._.extend({},defaults,options);var url="task/UpdateLable";var params="?task_id="+options["task_id"]+"&lab_id="+options["lab_id"]+"&lab_type="+options["lab_type"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"Post"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},UpdateCycleTask:function(options){var defaults={cycle_id:"",CycType:"",CycStartDate:"",CycStartTime:"",CycEndDate:"",CycEndTime:""};var options=Talent._.extend({},defaults,options);var url="task/UpdateCycleTask";var params="?cycle_id="+options["cycle_id"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"Post",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},updateTaskDate:function(options){var defaults={task_id:"",Deadline:"",StartDate:""};var options=Talent._.extend({},defaults,options);var url="task/UpdateTaskDate";var params="?task_id="+options["task_id"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"Post",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},cancelCycle:function(options){var defaults={task_id:"",cycle_id:""};var options=Talent._.extend({},defaults,options);var url="task/CloseCycleTask";var params="?task_id="+options["task_id"]+"&cycle_id="+options["cycle_id"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"Get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getCycleTask:function(options){var defaults={cycle_id:""};var options=Talent._.extend({},defaults,options);var url="task/GetCycleTask?cycle_id="+options.cycle_id;var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getTaskInfo:function(options){var url="task/TaskInfo";var defeered=new Talent.$.Deferred;var defaults={task_id:"",data:""};var options=Talent._.extend({},defaults,options);var params="?task_id="+options["task_id"]+"&data="+options["data"];BaseCollection.requestV2({url:url+params,type:"Get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getTaskInfoObj:function(options){var defaults={task_id:""},deferred=new Talent.$.Deferred,options=Talent._.extend({},defaults,options);var url="task/TaskInfoObj";var params="?task_id="+options["task_id"];BaseCollection.requestV2({url:url+params,type:"get"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},taskAccept:function(options){var url="task/Accept";var defaults={start_date:"",end_date:"",parent_task_id:"",lab_type:"",lab_id:"",isLongTerm:""};var options=Talent._.extend({},defaults,options);var params="?start_date="+options["start_date"]+"&end_date="+options["end_date"]+"&task_id="+options["task_id"]+"&lab_id="+options["lab_id"]+"&lab_type="+options["lab_type"]+"&isLongTerm="+options["isLongTerm"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},participatorAccept:function(options){var defaults={task_id:""},deferred=new Talent.$.Deferred,options=Talent._.extend({},defaults,options);var url="task/ParticipatorAccept";BaseCollection.request({url:url,type:"post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},taskDeleteParticipator:function(options){var defaults={task_id:"",to_user_id:""},deferred=new Talent.$.Deferred,options=Talent._.extend({},defaults,options);var url="task/DeleteParticipator";BaseCollection.requestV2({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},taskDelete:function(options){var defaults={task_id:"",to_user_id:""},deferred=new Talent.$.Deferred,options=Talent._.extend({},defaults,options);var url="task/Delete",params="?task_id="+options.task_id;BaseCollection.request({url:url+params,type:"POST"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},updateStatus:function(options){var defaults={task_id:"",status:""};var options=Talent._.extend({},defaults,options);var url="task/UpdateStatus",params="?task_id="+options.task_id+"&=status"+options["status"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,data:options,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},taskSetMark:function(options){var defeered=new Talent.$.Deferred;var defaults={task_id:"",type:""};var options=Talent._.extend({},defaults,options);var url="task/Mark",params="?task_id="+options.task_id+"&=type"+options["type"];BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},changeTask:function(options){var url="task/ChangeTask";var defaults={task_id:"",old_parent_task_id:"",parent_task_id:""};var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;var params="?task_id="+options["task_id"]+"&parent_task_id="+options["parent_task_id"]+"&old_parent_task_id="+options["old_parent_task_id"];BaseCollection.requestV2({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},updateTaskName:function(options){var url="task/UpdateName";var defaults={task_id:"",TaskName:""};var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+"?task_id="+options["task_id"],type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},UpdateDescription:function(options){var url="task/UpdateDescription";var defaults={task_id:"",Description:""};var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+"?task_id="+options["task_id"],type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},taskAddParticipator:function(options){var defaults={to_user_id:"",users:""};var defeered=new Talent.$.Deferred;var url="task/AddParticipator";var params="?task_id="+options["task_id"];BaseCollection.requestV2({url:url+params,type:"POST",contentType:"application/json",data:JSON.stringify(options["users"])}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},updateApplyUser:function(options){var defeered=new Talent.$.Deferred;var defaults={to_user_id:"",task_id:""};var options=Talent._.extend({},defaults,options);var url="task/UpdateApplyUser",params="";BaseCollection.request({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},updateTaskPrincipalUser:function(options){var url="task/UpdatePrincipal",params="";var defeered=new Talent.$.Deferred;var defaults={task_id:"",to_user_id:""};var options=Talent._.extend({},defaults,options);BaseCollection.request({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addAttachment:function(options){var url="task/AddAttachment";var defeered=new Talent.$.Deferred;var defaults={objId:"",dfsUrls:"",documents:[]};var options=Talent._.extend({},defaults,options);BaseCollection.requestV2({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteAttachment:function(options){var url="task/DeleteAttachment";var defeered=new Talent.$.Deferred;var defaults={task_id:"",document_id:""};var options=Talent._.extend({},defaults,options);var params="?task_id="+options["task_id"]+"&document_id="+options["document_id"];BaseCollection.requestV2({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addFollower:function(options){var defaults={task_id:"",followers:[]},deferred=new Talent.$.Deferred,settings=Talent._.extend({},defaults,options);var url="task/AddFollower?task_id="+settings.task_id;BaseCollection.requestV2({url:url,type:"post",contentType:"application/json",data:JSON.stringify(settings.followers)}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},deleteFollower:function(options){var defaults={taskId:"",toUserId:""},deferred=new Talent.$.Deferred,settings=Talent._.extend({},defaults,options);var url="task/Deletefollower?taskId="+settings.taskId+"&toUserId="+settings.toUserId;BaseCollection.requestV2({url:url,type:"post"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},evaluateTask:function(options){var url="task/EvaluateTask";var defeered=new Talent.$.Deferred;var defaults={objId:"",objType:7,evaluateInfo:[],remark:""};BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},membersTask:function(options){var defaults={task_id:""};var options=Talent._.extend({},defaults,options);var url="task/Members";var params="?task_id="+options["task_id"];var defeered=new Talent.$.Deferred;BaseCollection.requestV2({url:url+params,type:"GET"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},newexperience:function(options){var defaults={task_id:""};var options=Talent._.extend({},defaults,options);var url="task/newexperience";var params="?task_id="+options["task_id"];var defeered=new Talent.$.Deferred;BaseCollection.requestV2({url:url+params,type:"GET"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},applyWarn:function(options){var defaults={task_id:"",apply_type:""};var options=Talent._.extend({},defaults,options);var url="task/ApplyWarn";var params="?task_id="+options["task_id"]+"&apply_type="+options["apply_type"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"GET"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var UserFeedV2={commentCount:4,feedFount:20,getUserFeed:function(options){var mockData={Code:1,Data:{isEnd:false,lastId:"100001_58080_7_20_635755876015254638/635755880458382720",feeds:[{feedId:"100001_46123_4_6_635865775160649553",userId:100364166,publishUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},feedType:6,isEdit:true,url:null,editTopAble:false,postSource:0,isPrivate:true,createDate:"2015年12月24日 18:11",isRemind:false,isTop:false,isPush:true,customizeData:[{name:"需求部门",value:"Org_Staff",valueType:0},{name:"需求人数",value:"不限",valueType:0},{name:"招聘负责人",value:"许岩",valueType:0},{name:"部门负责人",value:"-",valueType:0}],app:{appId:"1",appType:1,appUrl:"http://www.tita-inc.com/100364166/SignRedirect?appId=203&redirectUrl=%2f%7buid%7d%2fRecruitHome%23work%3fapp_id%3d203%26app_type%3d203",appName:"项目",appLogo:"http://st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-zhao.png",appObjeId:null,appObjeName:null,appObjeType:null,appObj:null},counter:{taskTotal:0,finishTaskTotal:0,experienceTotal:0,commentTotal:1,operationTotal:1,meetTotal:0,businessTripTotal:0,applyTotal:0,workTimeTotal:0,attachmentTotal:0,dashangTotal:0},evaluation:null,feedComments:{total:1,comments:[{publishUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},parentUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},commentId:"100364166_1_636077213345211250_4390",commentType:1,parentCommentId:"",isEdit:true,content:"sdfasdfasd",createDate:"9分钟前",createTime:"2016/08/25 11:28",startDate:"2016/08/25",endDate:"2016/08/25",postSource:0,attachments:null}]},feedOperations:{total:1,comments:[{publishUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},parentUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},commentId:"100364166_3_635865775171569572",commentType:3,parentCommentId:"",isEdit:true,content:"创建了职位",createDate:"2015/12/24  18:11",createTime:"2015/12/24 18:11",startDate:"2015/12/24",endDate:"2015/12/24",postSource:0,attachments:null}]},attachments:null,favourUsers:null,obj:{objId:"46123",objType:4,objSubType:3,objName:"aaaaaa",objUrl:"/SiteUrlByRoute/100364166/SiteUrlByRoute/WorkRoute?appId=203&workId=46123",objColor:null,objLogo:"http://st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-work.png"},principalUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},principalId:100364166,workName:"aaaaaa",description:"",startDate:"2015/12/24 18:11",deadline:"2016/12/24 18:11",status:"1"},{feedId:"100001_46123_4_6_635865775160649553",userId:100364166,publishUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},feedType:6,isEdit:true,url:null,editTopAble:false,postSource:0,isPrivate:true,createDate:"2015年12月24日 18:11",isRemind:false,isTop:false,isPush:true,customizeData:[{name:"需求部门",value:"Org_Staff",valueType:0},{name:"需求人数",value:"不限",valueType:0},{name:"招聘负责人",value:"许岩",valueType:0},{name:"部门负责人",value:"-",valueType:0}],app:{appId:"203",appType:203,appUrl:"http://www.tita-inc.com/100364166/SignRedirect?appId=203&redirectUrl=%2f%7buid%7d%2fRecruitHome%23work%3fapp_id%3d203%26app_type%3d203",appName:"招聘",appLogo:"http://st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-zhao.png",appObjeId:null,appObjeName:null,appObjeType:null,appObj:null},counter:{taskTotal:0,finishTaskTotal:0,experienceTotal:0,commentTotal:1,operationTotal:1,meetTotal:0,businessTripTotal:0,applyTotal:0,workTimeTotal:0,attachmentTotal:0,dashangTotal:0},evaluation:null,feedComments:{total:1,comments:[{publishUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},parentUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},commentId:"100364166_1_636077213345211250_4390",commentType:1,parentCommentId:"",isEdit:true,content:"sdfasdfasd",createDate:"9分钟前",createTime:"2016/08/25 11:28",startDate:"2016/08/25",endDate:"2016/08/25",postSource:0,attachments:null}]},feedOperations:{total:1,comments:[{publishUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},parentUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},commentId:"100364166_3_635865775171569572",commentType:3,parentCommentId:"",isEdit:true,content:"创建了职位",createDate:"2015/12/24  18:11",createTime:"2015/12/24 18:11",startDate:"2015/12/24",endDate:"2015/12/24",postSource:0,attachments:null}]},attachments:null,favourUsers:null,obj:{objId:"46123",objType:4,objSubType:3,objName:"aaaaaa",objUrl:"/SiteUrlByRoute/100364166/SiteUrlByRoute/WorkRoute?appId=203&workId=46123",objColor:null,objLogo:"http://st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-work.png"},principalUser:{userId:100364166,name:"许岩",avatar:{original:null,small:null,medium:null,Big:null,Normal:null,Large:null,hasAvatar:false,color:"#96bf65"},userMark:null},principalId:100364166,workName:"aaaaaa",description:"",startDate:"2015/12/24 18:11",deadline:"2016/12/24 18:11",status:"1"}]}};var defaults={type:"",start:"",feed_count:this.feedFount,comment_count:this.commentCount};var options=Talent._.extend({},defaults,options);var url="user/feed/Get";var deferred=new Talent.$.Deferred;var params="?type="+options["type"]+"&start="+options["start"]+"&feed_count="+options["feed_count"]+"&comment_count="+options["comment_count"];BaseCollection.requestV2({url:url+params,type:"Get"}).done(function(resp){if(options["type"]==26){Talent._.each(resp["feeds"],function(item){item["isCollect"]=true})}deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getAllAndTopFeed:function(options){var defaults={type:"",start:"",feed_count:this.feedFount,comment_count:this.commentCount};var options=Talent._.extend({},defaults,options);var getTopFeedUrl="user/feed/Get?type=27"+"&feed_count="+options["feed_count"]+"&comment_count="+options["comment_count"]+"&start="+options["start"],getAllFeedUrl="user/feed/Get?type=7"+"&feed_count="+options["feed_count"]+"&comment_count="+options["comment_count"]+"&start="+options["start"];var deferred=new Talent.$.Deferred;BaseCollection.batchV2({url:[getTopFeedUrl,getAllFeedUrl]}).done(function(resp){var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"feedId"})}});var allData=resp[Context.getApiUrlV2(getAllFeedUrl)].Data.Data||{},topData=resp[Context.getApiUrlV2(getTopFeedUrl)].Data.Data||{},moduleCollection=new mCollection;var topDataId=Talent._.pluck(topData["feeds"],"feedId");moduleCollection.add(topData["feeds"]);moduleCollection.add(allData["feeds"]);for(var i=0;i<topDataId.length;i++){moduleCollection.get(topDataId[i]).set("isTop",true)}var resp={lastId:allData["allData"],isEnd:allData["isEnd"],feeds:moduleCollection.toJSON()};deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},deleteUserFeed:function(options){var defaults={feed_id:""};var options=Talent._.extend({},defaults,options);var url="user/feed/Delete";var deferred=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"];BaseCollection.requestV2({url:url+params,type:"Delete"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},userFeedCollecte:function(options){var defaults={feed_id:""};var options=Talent._.extend({},defaults,options);var url="user/feed/Collect";var deferred=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"];BaseCollection.requestV2({url:url+params,type:"PUT"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},userFeedCancelCollect:function(options){var defaults={feed_id:""};var options=Talent._.extend({},defaults,options);var url="user/feed/CancelCollect";var deferred=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"];BaseCollection.requestV2({url:url+params,type:"DELETE"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},userFeedTop:function(options){var defaults={feed_id:"",titaObj_type:2,titaObj_id:""};var options=Talent._.extend({},defaults,options);var url="user/feed/Top";var deferred=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"]+"&titaObj_type="+options["titaObj_type"]+"&titaObj_id="+options["titaObj_id"];BaseCollection.requestV2({url:url+params,type:"post"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},userFeedCancelTop:function(options){var defaults={feed_id:"",titaObj_type:2,titaObj_id:""};var options=Talent._.extend({},defaults,options);var url="user/feed/CancelTop";var deferred=new Talent.$.Deferred;var params="?feed_id="+options["feed_id"]+"&titaObj_type="+options["titaObj_type"]+"&titaObj_id="+options["titaObj_id"];BaseCollection.requestV2({url:url+params,type:"DELETE"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},userFeedSearch:function(options){var defaults={type:"",content:"",start:"",count:20,comment_count:"4"};var options=Talent._.extend({},defaults,options);var url="user/feed/Search";var deferred=new Talent.$.Deferred;var params="";BaseCollection.requestV2({url:url+params,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},userFeedSearchV2:function(options){var defaults={content:"",channelId:"",startId:"",pageSize:20,commentCount:"4"};var options=Talent._.extend({},defaults,options);var url="feedchannel/feeds/search";var deferred=new Talent.$.Deferred;var params="?content="+options["content"]+"&channelId="+options.channelId+"&startId="+options.startId+"&pageSize="+options.pageSize+"&commentCount="+options.commentCount;BaseCollection.request({url:url+params,type:"Get"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred},getFeedById:function(options){var defaults={feed_id:"",comment_count:4};var options=Talent._.extend({},defaults,options);var url="user/feed/GetById";var deferred=new Talent.$.Deferred;var params="";BaseCollection.requestV2({url:url+params,type:"Get",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred}};var WorkTimeCollection={addWorkHour:function(options){var defaults={ObjId:"",ObjType:7,Name:"",Description:"",Time:"",Hour:"",Minute:"",FileUrl:""};var options=Talent._.extend({},defaults,options);var url="worktime/AddV2";var params="";var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getDetail:function(options){var defaults={obj_id:"",obj_type:"",work_time_id:""};var options=Talent._.extend({},defaults,options);var url="worktime/Get";var params="?obj_id="+options["obj_id"]+"&obj_type="+options["obj_type"]+"&work_time_id="+options["work_time_id"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},updateWokHour:function(options){var defaults={work_time_id:"",ObjId:"",ObjType:7,Name:"",Description:"",Time:"",Hour:""};var url="worktime/Update";var params="?work_time_id="+options["work_time_id"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteWorkHour:function(options){var defeered=new Talent.$.Deferred;var defaults={id:""};var options=Talent._.extend({},defaults,options);var url="worktime/Delete";var params="";BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addAttachment:function(options){var url="WorkTime/AddAttachmentV2";var defeered=new Talent.$.Deferred;var defaults={objId:"",dfsUrls:"",documents:[]};var options=Talent._.extend({},defaults,options);BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},deleteAttachment:function(options){var url="WorkTime/DeleteAttachment";var defeered=new Talent.$.Deferred;var defaults={work_time_id:"",document_id:""};options=Talent._.extend({},defaults,options);var params="?work_time_id="+options["work_time_id"]+"&document_id="+options["document_id"];BaseCollection.request({url:url+params,type:"POST"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var YFYColleciton={getYifangyun:function(options){var deferred=new Talent.$.Deferred;var url="YiFangyun/SSO";BaseCollection.request({url:url,type:"Get"}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred}};var ApplyCollection={UpdateState:function(options){var url="Apply/Plan/UpdateState";var defaults={ApplyIds:"",State:"",ApplyContent:""};var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var UserCollection={getData:function(options){var defaults={ids:[]};var deferred=new Talent.$.Deferred;var url="user";var options=Talent._.extend({},defaults,options);BaseCollection.request({url:url,data:options,type:"Post"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},getByIds:function(options){var defaults={ids:[]};var deferred=new Talent.$.Deferred;var options=Talent._.extend({},defaults,options);var url="user/GetByIds",params="?ids="+options["ids"];BaseCollection.requestV2({url:url+params,type:"Get"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){
deferred.reject(msg)});return deferred}};var MessageCollection={taoShangMessage:function(options){var defaults={toUserid:"",objId:"",objType:"",content:""};var options=Talent._.extend({},defaults,options);var url="messages/TaoShangMessage";var deferred=new Talent.$.Deferred;var params="";BaseCollection.request({url:url+params,type:"post",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred}};var FeedChannelCollection={getByChannelIdData:function(options){var defaults={channelId:"",startId:"",pageSize:"",commentCount:4};var options=Talent._.extend({},defaults,options);var url="feedchannel/feeds";var params="?channelId="+options["channelId"]+"&startId="+options["startId"]+"&pageSize="+options["pageSize"]+"&commentCount="+options["commentCount"];var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"get"}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var WxpayCollection={UpdateState:function(options){var url="wx/pay/web/order";var defaults={toUserId:"",totalFee:"",objId:"",objType:"",description:""};var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){defeered.resolve(resp);Talent._.actionAnalysis("[feed-reward-click]",options.objId,3)}).fail(function(message){defeered.reject(message)});return defeered.promise()},getDaShangDetail:function(options){var url="wx/pay/order/record";var defaults={objId:"",objType:""};var options=Talent._.extend({},defaults,options);var params="?objid="+options.objId+"&objType="+options.objType;var defeered=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"get",data:options}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},postUPaaSCoreGateway:function(options){var url="proxy/PostUPaaSCoreGateway";var defaults={metaname:"Medal",funname:"UpgradeMedal",codes:"",triggerData:"",events:"",time:""};var options=Talent._.extend({},defaults,options);var defeered=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(options)}).done(function(resp){defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()}};var TagCollection={tagAddTo:function(options){var defaults={tagId:"",objId:"",objType:""};var options=Talent._.extend({},defaults,options);var url="tag/addto";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp);Talent._.actionAnalysis("[feed-tag-success]",options.objId)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},tagCreateTo:function(options){var defaults={tagName:"",color:"",objId:"",objType:""};options=Talent._.extend({},defaults,options);var url="tag/createto";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},getTagAll:function(options){var url="tag/all";var deferred=Talent.$.Deferred();BaseCollection.request({url:url,type:"GET"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},tagRemovefrom:function(options){var defaults={tagId:"",objId:"",objType:""};var options=Talent._.extend({},defaults,options);var url="tag/removefrom";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},getMyUsedTag:function(options){var url="tag/myused";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"GET"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},tagAdd:function(options){var defaults={tagName:"",color:"",shareTypes:""};var options=Talent._.extend({},defaults,options);var url="tag/add";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},tagShare:function(options){var defaults={tagIds:[],shareTypes:[]};var options=Talent._.extend({},defaults,options);var url="tag/share";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},tagDelete:function(options){var defaults={tagIds:[]};var options=Talent._.extend({},defaults,options);var url="tag/delete";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},tagDragSort:function(options){var defaults={beforeId:"",tagId:"",afterId:""};var options=Talent._.extend({},defaults,options);var url="tag/drag";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url,type:"POST",data:options}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},getWorkItemsByTag:function(options){var defaults={pageIndex:"",pageSize:"",tagId:"",objType:"4"};var options=Talent._.extend({},defaults,options);var params="?pageIndex="+options.pageIndex+"&pageSize="+options.pageSize+"&tagId="+options.tagId+"&objType="+options.objType;var url="tag/workitems";var deferred=new Talent.$.Deferred;BaseCollection.request({url:url+params,type:"GET"}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()}};var UserSelectorWorkExtenalCollection=Talent.Collection.extend({excludeSelf:false,querys:{workId:"",type:""},initialize:function(options){this.config=Talent._.extend({},this.querys,options);this.userInfo=Talent.Context.getUserInfo()},getContact:function(){var self=this;this.viewType="Contact";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;$.ajax({url:Context.getApiUrl("external/GetWorkContactStaffs?v=")+(new Date).getTime()+"&workId="+this.config.workId+"&type="+this.config.type,type:"GET",success:function(resp){if(self.viewType=="Contact"){if(resp&&resp.Code==1){var collectionData=Talent._.values(resp.Data);if(collectionData.length>0){Talent._.map(collectionData,function(item){item.MidAvatar=item.UserAvatar.Medium;return item.imgTemplate=Talent._.convertImage({shape:"radius",name:item.Name,src:item.MidAvatar,bgColor:item.UserAvatar.Color})});self.deferred.resolve(collectionData)}else{self.deferred.resolve([])}}else{self.deferred.resolve([])}}}});return self.deferred.promise()},getSearch:function(data){var self=this;this.viewType="Search";self.deferred&&self.deferred.reject();self.deferred=new $.Deferred;var condition=data&&data.searchCondition||{};this.filters=condition.name;var url=Context.getApiUrl("external/GetWorkStaffs?"+"workId="+this.config.workId+"&type="+this.config.type+"&filter="+encodeURIComponent(condition.name)||"");if(condition.name==""){self.deferred.resolve([])}else{$.ajax({url:url,type:"GET",success:function(resp){if(self.viewType=="Search"){if(resp&&resp.Code==1){var data=resp&&resp.Data||{};if(data.Filters==self.filters){var collectionData=data.SimpleUserModel||{};collectionData=Talent._.values(collectionData);Talent._.map(collectionData,function(item){item.MidAvatar=item.UserAvatar.Medium;return item.imgTemplate=Talent._.convertImage({shape:"radius",name:item.Name,src:item.MidAvatar,bgColor:item.UserAvatar.Color})});if(self.excludeSelf){collectionData=Talent._.filter(collectionData,function(item){return item.Id!=self.userInfo.Id})}self.deferred.resolve(collectionData)}}else{self.deferred.resolve([])}}}})}return self.deferred.promise()}});var defaults={className:"autosizejs",append:"",callback:false,resizeDelay:10},copy='<textarea tabindex="-1" style="position:absolute; top:-999px; left:0; right:auto; bottom:auto; border:0; -moz-box-sizing:content-box; -webkit-box-sizing:content-box; box-sizing:content-box; word-wrap:break-word; height:0 !important; min-height:0 !important; overflow:hidden; transition:none; -webkit-transition:none; -moz-transition:none;"/>',typographyStyles=["fontFamily","fontSize","fontWeight","fontStyle","letterSpacing","textTransform","wordSpacing","textIndent"],mirrored,mirror=$(copy).data("autosize",true)[0];mirror.style.lineHeight="99px";if($(mirror).css("lineHeight")==="99px"){typographyStyles.push("lineHeight")}mirror.style.lineHeight="";$.fn.autosize=function(options){options=$.extend({},defaults,options||{});if(mirror.parentNode!==document.body){$(document.body).append(mirror)}return this.each(function(){var ta=this,$ta=$(ta),maxHeight,minHeight,boxOffset=0,callback=$.isFunction(options.callback),originalStyles={height:ta.style.height,overflow:ta.style.overflow,overflowY:ta.style.overflowY,wordWrap:ta.style.wordWrap,resize:ta.style.resize},timeout,width=$ta.width();if($ta.data("autosize")){return}$ta.data("autosize",true);if($ta.css("box-sizing")==="border-box"||$ta.css("-moz-box-sizing")==="border-box"||$ta.css("-webkit-box-sizing")==="border-box"){boxOffset=$ta.outerHeight()-$ta.height()}minHeight=Math.max(parseInt($ta.css("minHeight"),10)-boxOffset||0,$ta.height());$ta.css({overflow:"hidden",overflowY:"hidden",wordWrap:"break-word",resize:$ta.css("resize")==="none"||$ta.css("resize")==="vertical"?"none":"horizontal"});function initMirror(){var styles={},ignore;mirrored=ta;mirror.className=options.className;maxHeight=parseInt($ta.css("maxHeight"),10);$.each(typographyStyles,function(i,val){styles[val]=$ta.css(val)});$(mirror).css(styles);if("oninput"in ta){var width=ta.style.width;ta.style.width="0px";ignore=ta.offsetWidth;ta.style.width=width}}function adjust(){var height,original,width,style;if(mirrored!==ta){initMirror()}mirror.value=ta.value+options.append;mirror.style.overflowY=ta.style.overflowY;original=parseInt(ta.style.height,10);if("getComputedStyle"in window){style=window.getComputedStyle(ta);width=ta.getBoundingClientRect().width;$.each(["paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],function(i,val){width-=parseInt(style[val],10)});mirror.style.width=width+"px"}else{mirror.style.width=Math.max($ta.width(),0)+"px"}mirror.scrollTop=0;mirror.scrollTop=9e4;height=mirror.scrollTop;if(maxHeight&&height>maxHeight){ta.style.overflowY="scroll";height=maxHeight}else{ta.style.overflowY="hidden";if(height<minHeight){height=minHeight}}height+=boxOffset;if(original!==height){ta.style.height=height+"px";if(callback){options.callback.call(ta,ta)}}}function resize(){clearTimeout(timeout);timeout=setTimeout(function(){if($ta.width()!==width){adjust()}},parseInt(options.resizeDelay,10))}if("onpropertychange"in ta){if("oninput"in ta){$ta.on("input.autosize keyup.autosize",adjust)}else{$ta.on("propertychange.autosize",function(){if(event.propertyName==="value"){adjust()}})}}else{$ta.on("input.autosize",adjust)}if(options.resizeDelay!==false){$(window).on("resize.autosize",resize)}$ta.on("autosize.resize",adjust);$ta.on("autosize.resizeIncludeStyle",function(){mirrored=null;adjust()});$ta.on("autosize.destroy",function(){mirrored=null;clearTimeout(timeout);$(window).off("resize",resize);$ta.off("autosize").off(".autosize").css(originalStyles).removeData("autosize")});adjust()})};var zh_cn=moment.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(hour,meridiem){if(hour===12){hour=0}if(meridiem==="凌晨"||meridiem==="早上"||meridiem==="上午"){return hour}else if(meridiem==="下午"||meridiem==="晚上"){return hour+12}else{return hour>=11?hour:hour+12}},meridiem:function(hour,minute,isLower){var hm=hour*100+minute;if(hm<600){return"凌晨"}else if(hm<900){return"早上"}else if(hm<1130){return"上午"}else if(hm<1230){return"中午"}else if(hm<1800){return"下午"}else{return"晚上"}},calendar:{sameDay:function(){return this.minutes()===0?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return this.minutes()===0?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return this.minutes()===0?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var startOfWeek,prefix;startOfWeek=moment().startOf("week");prefix=this.unix()-startOfWeek.unix()>=7*24*3600?"[下]":"[本]";return this.minutes()===0?prefix+"dddAh点整":prefix+"dddAh点mm"},lastWeek:function(){var startOfWeek,prefix;startOfWeek=moment().startOf("week");prefix=this.unix()<startOfWeek.unix()?"[上]":"[本]";return this.minutes()===0?prefix+"dddAh点整":prefix+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(number,period){switch(period){case"d":case"D":case"DDD":return number+"日";case"M":return number+"月";case"w":case"W":return number+"周";default:return number}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});var DateRangePicker=function(element,options,cb){this.parentEl="body";this.element=$(element);this.isShowing=false;var DRPTemplate='<div class="daterangepicker dropdown-menu">'+'<div class="calendar first left"></div>'+'<div class="calendar second right"></div>'+'<div class="ranges">'+'<div class="range_inputs">'+'<div class="daterangepicker_start_input">'+'<label for="daterangepicker_start"></label>'+'<input class="input-mini" type="text" name="daterangepicker_start" value=""  disabled="disabled" />'+"</div>"+'<div class="daterangepicker_end_input">'+'<label for="daterangepicker_end"></label>'+'<input class="input-mini" type="text" name="daterangepicker_end" value=""  disabled="disabled" />'+"</div>"+'<button class="applyBtn" disabled="disabled" type="button"></button>&nbsp;'+'<button class="cancelBtn" type="button"></button>'+"</div>"+"</div>"+"</div>";if(typeof options!=="object"||options===null)options={};this.parentEl=typeof options==="object"&&options.parentEl&&$(options.parentEl).length?$(options.parentEl):$(this.parentEl);this.container=$(DRPTemplate).appendTo(this.parentEl);options=$.extend(this.element.data(),options);this.setOptions(options,cb);this.container.find(".calendar").on("click.daterangepicker",".prev",$.proxy(this.clickPrev,this)).on("click.daterangepicker",".next",$.proxy(this.clickNext,this)).on("click.daterangepicker","td.available",$.proxy(this.clickDate,this)).on("mouseenter.daterangepicker","td.available",$.proxy(this.hoverDate,this)).on("mouseleave.daterangepicker","td.available",$.proxy(this.updateFormInputs,this)).on("change.daterangepicker","select.yearselect",$.proxy(this.updateMonthYear,this)).on("change.daterangepicker","select.monthselect",$.proxy(this.updateMonthYear,this)).on("change.daterangepicker","select.hourselect,select.minuteselect,select.secondselect,select.ampmselect",$.proxy(this.updateTime,this));this.container.find(".ranges").on("click.daterangepicker","button.applyBtn",$.proxy(this.clickApply,this)).on("click.daterangepicker","button.cancelBtn",$.proxy(this.clickCancel,this)).on("click.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.showCalendars,this)).on("change.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.inputsChanged,this)).on("keydown.daterangepicker",".daterangepicker_start_input,.daterangepicker_end_input",$.proxy(this.inputsKeydown,this)).on("click.daterangepicker","li",$.proxy(this.clickRange,this)).on("mouseenter.daterangepicker","li",$.proxy(this.enterRange,this)).on("mouseleave.daterangepicker","li",$.proxy(this.updateFormInputs,this));if(this.element.is("input")){this.element.on({"click.daterangepicker":$.proxy(this.show,this),"focus.daterangepicker":$.proxy(this.show,this),"keyup.daterangepicker":$.proxy(this.updateFromControl,this),"keydown.daterangepicker":$.proxy(this.keydown,this)})}else{this.element.on("click.daterangepicker",$.proxy(this.toggle,this))}};DateRangePicker.prototype={constructor:DateRangePicker,setOptions:function(options,callback){this.startDate=moment().startOf("day");this.endDate=moment().endOf("day");this.timeZone=moment().utcOffset();this.minDate=false;this.maxDate=false;this.dateLimit=false;this.showDropdowns=false;this.showWeekNumbers=false;this.timePicker=false;this.timePickerSeconds=false;this.timePickerIncrement=30;this.timePicker12Hour=true;this.autoApply=false;this.singleDatePicker=false;this.ranges={};this.autoHide=true;this.opens="right";if(this.element.hasClass("pull-right"))this.opens="left";this.drops="down";if(this.element.hasClass("dropup"))this.drops="up";this.buttonClasses=["btn","btn-small btn-sm"];this.applyClass="btn-success";this.cancelClass="btn-default";this.format="MM/DD/YYYY";this.separator=" - ";this.locale={applyLabel:"Apply",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",weekLabel:"W",customRangeLabel:"Custom Range",daysOfWeek:moment.weekdaysMin(),monthNames:moment.monthsShort(),firstDay:moment.localeData()._week.dow};this.cb=function(){};if(typeof options.format==="string")this.format=options.format;if(typeof options.separator==="string")this.separator=options.separator;if(typeof options.startDate==="string")this.startDate=moment(options.startDate,this.format);if(typeof options.endDate==="string")this.endDate=moment(options.endDate,this.format);if(typeof options.minDate==="string")this.minDate=moment(options.minDate,this.format);if(typeof options.maxDate==="string")this.maxDate=moment(options.maxDate,this.format);if(typeof options.startDate==="object")this.startDate=moment(options.startDate);if(typeof options.endDate==="object")this.endDate=moment(options.endDate);if(typeof options.minDate==="object")this.minDate=moment(options.minDate);if(typeof options.maxDate==="object")this.maxDate=moment(options.maxDate);if(typeof options.applyClass==="string")this.applyClass=options.applyClass;if(typeof options.cancelClass==="string")this.cancelClass=options.cancelClass;if(typeof options.dateLimit==="object")this.dateLimit=options.dateLimit;if(typeof options.locale==="object"){if(typeof options.locale.daysOfWeek==="object"){this.locale.daysOfWeek=options.locale.daysOfWeek.slice()}if(typeof options.locale.monthNames==="object"){this.locale.monthNames=options.locale.monthNames.slice()}if(typeof options.locale.firstDay==="number"){this.locale.firstDay=options.locale.firstDay}if(typeof options.locale.applyLabel==="string"){this.locale.applyLabel=options.locale.applyLabel}if(typeof options.locale.cancelLabel==="string"){this.locale.cancelLabel=options.locale.cancelLabel}if(typeof options.locale.fromLabel==="string"){this.locale.fromLabel=options.locale.fromLabel}if(typeof options.locale.toLabel==="string"){this.locale.toLabel=options.locale.toLabel}if(typeof options.locale.weekLabel==="string"){this.locale.weekLabel=options.locale.weekLabel}if(typeof options.locale.customRangeLabel==="string"){this.locale.customRangeLabel=options.locale.customRangeLabel}}if(typeof options.opens==="string")this.opens=options.opens;if(typeof options.drops==="string")this.drops=options.drops;if(typeof options.showWeekNumbers==="boolean"){this.showWeekNumbers=options.showWeekNumbers}if(typeof options.buttonClasses==="string"){this.buttonClasses=[options.buttonClasses]}if(typeof options.buttonClasses==="object"){this.buttonClasses=options.buttonClasses}if(typeof options.showDropdowns==="boolean"){this.showDropdowns=options.showDropdowns}if(typeof options.singleDatePicker==="boolean"){this.singleDatePicker=options.singleDatePicker;if(this.singleDatePicker){this.endDate=this.startDate.clone()}}if(typeof options.timePicker==="boolean"){this.timePicker=options.timePicker}if(typeof options.timePickerSeconds==="boolean"){this.timePickerSeconds=options.timePickerSeconds}if(typeof options.timePickerIncrement==="number"){this.timePickerIncrement=options.timePickerIncrement}if(typeof options.timePicker12Hour==="boolean"){this.timePicker12Hour=options.timePicker12Hour}if(typeof options.autoApply==="boolean"){this.autoApply=options.autoApply;if(this.autoApply)this.container.find(".applyBtn, .cancelBtn").addClass("hide")}if(typeof options.autoHide==="boolean"){this.autoHide=options.autoHide}if(this.locale.firstDay!=0){var iterator=this.locale.firstDay;while(iterator>0){this.locale.daysOfWeek.push(this.locale.daysOfWeek.shift());iterator--}}var start,end,range;if(typeof options.startDate==="undefined"&&typeof options.endDate==="undefined"){if($(this.element).is("input[type=text]")){var val=$(this.element).val(),split=val.split(this.separator);start=end=null;if(split.length==2){start=moment(split[0],this.format);end=moment(split[1],this.format)}else if(this.singleDatePicker&&val!==""){start=moment(val,this.format);end=moment(val,this.format)}if(start!==null&&end!==null){this.startDate=start;this.endDate=end}}}if(typeof options.timeZone==="string"||typeof options.timeZone==="number"){if(typeof options.timeZone==="string"&&typeof moment.tz!=="undefined"){this.timeZone=moment.tz.zone(options.timeZone).parse(new Date)*-1}else{this.timeZone=options.timeZone}this.startDate.utcOffset(this.timeZone);this.endDate.utcOffset(this.timeZone)}else{this.timeZone=moment(this.startDate).utcOffset()}if(typeof options.ranges==="object"){for(range in options.ranges){if(typeof options.ranges[range][0]==="string")start=moment(options.ranges[range][0],this.format);else start=moment(options.ranges[range][0]);if(typeof options.ranges[range][1]==="string")end=moment(options.ranges[range][1],this.format);else end=moment(options.ranges[range][1]);if(this.minDate&&start.isBefore(this.minDate))start=moment(this.minDate);if(this.maxDate&&end.isAfter(this.maxDate))end=moment(this.maxDate);if(this.minDate&&end.isBefore(this.minDate)||this.maxDate&&start.isAfter(this.maxDate)){continue}this.ranges[range]=[start,end]}var list="<ul>";for(range in this.ranges){list+="<li>"+range+"</li>"}list+="<li>"+this.locale.customRangeLabel+"</li>";list+="</ul>";this.container.find(".ranges ul").remove();this.container.find(".ranges").prepend(list)}if(typeof callback==="function"){this.cb=callback}if(!this.timePicker){this.startDate=this.startDate.startOf("day");this.endDate=this.endDate.endOf("day")}if(this.singleDatePicker){this.opens=this.opens||"right";this.container.addClass("single");this.container.find(".calendar.right").show();this.container.find(".calendar.left").hide();if(!this.timePicker){this.container.find(".ranges").hide()}else{this.container.find(".ranges .daterangepicker_start_input, .ranges .daterangepicker_end_input").hide()}if(!this.container.find(".calendar.right").hasClass("single"))this.container.find(".calendar.right").addClass("single")}else{this.container.removeClass("single");this.container.find(".calendar.right").removeClass("single");this.container.find(".calendar.left").show();this.container.find(".ranges").show()}this.oldStartDate=this.startDate.clone();this.oldEndDate=this.endDate.clone();this.oldChosenLabel=this.chosenLabel;this.leftCalendar={month:moment([this.startDate.year(),this.startDate.month(),1,this.startDate.hour(),this.startDate.minute(),this.startDate.second()]),calendar:[]};this.rightCalendar={month:moment([this.endDate.year(),this.endDate.month(),1,this.endDate.hour(),this.endDate.minute(),this.endDate.second()]),calendar:[]};if(this.opens=="right"||this.opens=="center"){var first=this.container.find(".calendar.first");var second=this.container.find(".calendar.second");if(second.hasClass("single")){second.removeClass("single");first.addClass("single")}first.removeClass("left").addClass("right");second.removeClass("right").addClass("left");if(this.singleDatePicker){first.show();second.hide()}}if(typeof options.ranges==="undefined"&&!this.singleDatePicker){this.container.addClass("show-calendar")}if(!this.autoHide){this.container.removeClass("opensleft opensright openscenter").addClass("open")}else{this.container.removeClass("opensleft opensright").addClass("opens"+this.opens)}this.updateView();this.updateCalendars();var c=this.container;$.each(this.buttonClasses,function(idx,val){c.find("button").addClass(val)});this.container.find(".daterangepicker_start_input label").html(this.locale.fromLabel);this.container.find(".daterangepicker_end_input label").html(this.locale.toLabel);if(this.applyClass.length)this.container.find(".applyBtn").addClass(this.applyClass);if(this.cancelClass.length)this.container.find(".cancelBtn").addClass(this.cancelClass);this.container.find(".applyBtn").html(this.locale.applyLabel);this.container.find(".cancelBtn").html(this.locale.cancelLabel)},setStartDate:function(startDate){if(typeof startDate==="string")this.startDate=moment(startDate,this.format).utcOffset(this.timeZone);if(typeof startDate==="object")this.startDate=moment(startDate);if(!this.timePicker)this.startDate=this.startDate.startOf("day");this.oldStartDate=this.startDate.clone();this.updateView();this.updateCalendars();this.updateInputText()},setEndDate:function(endDate){if(typeof endDate==="string")this.endDate=moment(endDate,this.format).utcOffset(this.timeZone);if(typeof endDate==="object")this.endDate=moment(endDate);if(!this.timePicker)this.endDate=this.endDate.endOf("day");this.oldEndDate=this.endDate.clone();this.updateView();this.updateCalendars();this.updateInputText()},updateView:function(){this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute());this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute());this.updateFormInputs()},updateFormInputs:function(){this.container.find("input[name=daterangepicker_start]").val(this.startDate.format(this.format));this.container.find("input[name=daterangepicker_end]").val(this.endDate.format(this.format));if(this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)){this.container.find("button.applyBtn").removeAttr("disabled")}else{this.container.find("button.applyBtn").attr("disabled","disabled")}},updateFromControl:function(){if(!this.element.is("input"))return;if(!this.element.val().length)return;var dateString=this.element.val().split(this.separator),start=null,end=null;if(dateString.length===2){start=moment(dateString[0],this.format).utcOffset(this.timeZone);end=moment(dateString[1],this.format).utcOffset(this.timeZone)}if(this.singleDatePicker||start===null||end===null){start=moment(this.element.val(),this.format).utcOffset(this.timeZone);end=start}if(end.isBefore(start))return;this.oldStartDate=this.startDate.clone();this.oldEndDate=this.endDate.clone();this.startDate=start;this.endDate=end;if(!this.startDate.isSame(this.oldStartDate)||!this.endDate.isSame(this.oldEndDate))this.notify();this.updateCalendars()},keydown:function(e){if(e.keyCode===9||e.keyCode===13){this.hide()}},notify:function(){this.updateView();this.updateInputText();this.cb(this.startDate,this.endDate,this.chosenLabel)},move:function(){var parentOffset={top:0,left:0},containerTop;var parentRightEdge=$(window).width();if(!this.parentEl.is("body")){parentOffset={top:this.parentEl.offset().top-this.parentEl.scrollTop(),left:this.parentEl.offset().left-this.parentEl.scrollLeft()};parentRightEdge=this.parentEl[0].clientWidth+this.parentEl.offset().left}if(this.drops=="up")containerTop=this.element.offset().top-this.container.outerHeight()-parentOffset.top;else containerTop=this.element.offset().top+this.element.outerHeight()-parentOffset.top;this.container[this.drops=="up"?"addClass":"removeClass"]("dropup");if(this.opens=="left"){this.container.css({top:containerTop,right:parentRightEdge-this.element.offset().left-this.element.outerWidth(),left:"auto"});if(this.container.offset().left<0){this.container.css({right:"auto",left:9})}}else if(this.opens=="center"){this.container.css({top:containerTop,left:this.element.offset().left-parentOffset.left+this.element.outerWidth()/2-this.container.outerWidth()/2,right:"auto"});if(this.container.offset().left<0){this.container.css({right:"auto",left:9})}}else{this.container.css({top:containerTop,left:this.element.offset().left-parentOffset.left,right:"auto"});if(this.container.offset().left+this.container.outerWidth()>$(window).width()){this.container.css({left:"auto",right:0})}}},toggle:function(e){if(!this.autoHide)return;if(this.element.hasClass("active")){this.hide()}else{this.show()}},show:function(e){if(this.isShowing)return;this.element.addClass("active");this.container.show();this.move();this._outsideClickProxy=$.proxy(function(e){this.outsideClick(e)},this);$(document).on("mousedown.daterangepicker",this._outsideClickProxy).on("touchend.daterangepicker",this._outsideClickProxy).on("click.daterangepicker","[data-toggle=dropdown]",this._outsideClickProxy).on("focusin.daterangepicker",this._outsideClickProxy);this.isShowing=true;this.element.trigger("show.daterangepicker",this)},outsideClick:function(e){var target=$(e.target);if(this.autoHide)return;if(e.type=="focusin"||target.closest(this.element).length||target.closest(this.container).length||target.closest(".calendar-date").length)return;this.hide()},hide:function(e){if(!this.isShowing)return;$(document).off(".daterangepicker");this.element.removeClass("active");this.container.hide();if(!this.startDate.isSame(this.oldStartDate)||!this.endDate.isSame(this.oldEndDate))this.notify();this.oldStartDate=this.startDate.clone();this.oldEndDate=this.endDate.clone();this.isShowing=false;this.element.trigger("hide.daterangepicker",this)},enterRange:function(e){var label=e.target.innerHTML;if(label==this.locale.customRangeLabel){this.updateView()}else{var dates=this.ranges[label];this.container.find("input[name=daterangepicker_start]").val(dates[0].format(this.format));this.container.find("input[name=daterangepicker_end]").val(dates[1].format(this.format))}},showCalendars:function(){this.container.addClass("show-calendar");this.move();this.element.trigger("showCalendar.daterangepicker",this)},hideCalendars:function(){this.container.removeClass("show-calendar");this.element.trigger("hideCalendar.daterangepicker",this)},inputsChanged:function(e){var el=$(e.target);var date=moment(el.val(),this.format);if(!date.isValid())return;var startDate,endDate;if(el.attr("name")==="daterangepicker_start"){startDate=false!==this.minDate&&date.isBefore(this.minDate)?this.minDate:date;endDate=this.endDate;if(typeof this.dateLimit==="object"){var maxDate=moment(startDate).add(this.dateLimit).endOf("day");if(endDate.isAfter(maxDate)){endDate=maxDate}}}else{startDate=this.startDate;endDate=false!==this.maxDate&&date.isAfter(this.maxDate)?this.maxDate:date.endOf("day");if(typeof this.dateLimit==="object"){var minDate=moment(endDate).subtract(this.dateLimit).startOf("day");if(startDate.isBefore(minDate)){startDate=minDate}}}this.setCustomDates(startDate,endDate)},inputsKeydown:function(e){if(e.keyCode===13){this.inputsChanged(e);this.notify()}},updateInputText:function(){if(this.element.is("input")&&!this.singleDatePicker){this.element.val(this.startDate.format(this.format)+this.separator+this.endDate.format(this.format));this.element.trigger("change")}else if(this.element.is("input")){this.element.val(this.endDate.format(this.format));this.element.trigger("change")}},clickRange:function(e){var label=e.target.innerHTML;this.chosenLabel=label;if(label==this.locale.customRangeLabel){this.showCalendars()}else{var dates=this.ranges[label];this.startDate=dates[0];this.endDate=dates[1];if(!this.timePicker){
this.startDate.startOf("day");this.endDate.endOf("day")}this.leftCalendar.month.month(this.startDate.month()).year(this.startDate.year()).hour(this.startDate.hour()).minute(this.startDate.minute());this.rightCalendar.month.month(this.endDate.month()).year(this.endDate.year()).hour(this.endDate.hour()).minute(this.endDate.minute());this.updateCalendars();this.updateInputText();this.hideCalendars();this.hide();this.element.trigger("apply.daterangepicker",this);if(this.autoApply){this.notify()}}},clickPrev:function(e){var cal=$(e.target).parents(".calendar");if(cal.hasClass("left")){this.leftCalendar.month.subtract(1,"month")}else{this.rightCalendar.month.subtract(1,"month")}this.updateCalendars()},clickNext:function(e){var cal=$(e.target).parents(".calendar");if(cal.hasClass("left")){this.leftCalendar.month.add(1,"month")}else{this.rightCalendar.month.add(1,"month")}this.updateCalendars()},hoverDate:function(e){var title=$(e.target).attr("data-title");var row=title.substr(1,1);var col=title.substr(3,1);var cal=$(e.target).parents(".calendar");if(cal.hasClass("left")){this.container.find("input[name=daterangepicker_start]").val(this.leftCalendar.calendar[row][col].format(this.format))}else{this.container.find("input[name=daterangepicker_end]").val(this.rightCalendar.calendar[row][col].format(this.format))}},setCustomDates:function(startDate,endDate){this.chosenLabel=this.locale.customRangeLabel;if(startDate.isAfter(endDate)){var difference=this.endDate.diff(this.startDate);endDate=moment(startDate).add(difference,"ms");if(this.maxDate&&endDate.isAfter(this.maxDate)){endDate=this.maxDate.clone()}}this.startDate=startDate;this.endDate=endDate;this.updateView();this.updateCalendars();if(this.autoApply){this.notify();this.element.trigger("apply.daterangepicker",this)}},clickDate:function(e){var title=$(e.target).attr("data-title");var row=title.substr(1,1);var col=title.substr(3,1);var cal=$(e.target).parents(".calendar");var startDate,endDate;if(cal.hasClass("left")){startDate=this.leftCalendar.calendar[row][col];endDate=this.endDate;if(typeof this.dateLimit==="object"){var maxDate=moment(startDate).add(this.dateLimit).endOf("day");if(endDate.isAfter(maxDate)){endDate=maxDate}}}else{startDate=this.startDate;endDate=this.rightCalendar.calendar[row][col];if(typeof this.dateLimit==="object"){var minDate=moment(endDate).subtract(this.dateLimit).startOf("day");if(startDate.isBefore(minDate)){startDate=minDate}}}if(this.singleDatePicker&&cal.hasClass("left")){endDate=startDate.clone()}else if(this.singleDatePicker&&cal.hasClass("right")){startDate=endDate.clone()}cal.find("td").removeClass("active");$(e.target).addClass("active");this.setCustomDates(startDate,endDate);if(!this.timePicker)endDate.endOf("day");if(this.singleDatePicker&&!this.timePicker)this.clickApply()},clickApply:function(e){this.updateInputText();this.hide();this.element.trigger("apply.daterangepicker",this)},clickCancel:function(e){this.startDate=this.oldStartDate;this.endDate=this.oldEndDate;this.chosenLabel=this.oldChosenLabel;this.updateView();this.updateCalendars();this.hide();this.element.trigger("cancel.daterangepicker",this)},updateMonthYear:function(e){var isLeft=$(e.target).closest(".calendar").hasClass("left"),leftOrRight=isLeft?"left":"right",cal=this.container.find(".calendar."+leftOrRight);var month=parseInt(cal.find(".monthselect").val(),10);var year=cal.find(".yearselect").val();if(!isLeft&&!this.singleDatePicker){if(year<this.startDate.year()||year==this.startDate.year()&&month<this.startDate.month()){month=this.startDate.month();year=this.startDate.year()}}if(this.minDate){if(year<this.minDate.year()||year==this.minDate.year()&&month<this.minDate.month()){month=this.minDate.month();year=this.minDate.year()}}if(this.maxDate){if(year>this.maxDate.year()||year==this.maxDate.year()&&month>this.maxDate.month()){month=this.maxDate.month();year=this.maxDate.year()}}this[leftOrRight+"Calendar"].month.month(month).year(year);this.updateCalendars()},updateTime:function(e){var cal=$(e.target).closest(".calendar"),isLeft=cal.hasClass("left");var hour=parseInt(cal.find(".hourselect").val(),10);var minute=parseInt(cal.find(".minuteselect").val(),10);var second=0;if(this.timePickerSeconds){second=parseInt(cal.find(".secondselect").val(),10)}if(this.timePicker12Hour){var ampm=cal.find(".ampmselect").val();if(ampm==="PM"&&hour<12)hour+=12;if(ampm==="AM"&&hour===12)hour=0}if(isLeft){var start=this.startDate.clone();start.hour(hour);start.minute(minute);start.second(second);this.startDate=start;this.leftCalendar.month.hour(hour).minute(minute).second(second);if(this.singleDatePicker)this.endDate=start.clone()}else{var end=this.endDate.clone();end.hour(hour);end.minute(minute);end.second(second);this.endDate=end;if(this.singleDatePicker)this.startDate=end.clone();this.rightCalendar.month.hour(hour).minute(minute).second(second)}this.updateView();this.updateCalendars();if(this.autoApply){this.notify();this.element.trigger("apply.daterangepicker",this)}},updateCalendars:function(){this.leftCalendar.calendar=this.buildCalendar(this.leftCalendar.month.month(),this.leftCalendar.month.year(),this.leftCalendar.month.hour(),this.leftCalendar.month.minute(),this.leftCalendar.month.second(),"left");this.rightCalendar.calendar=this.buildCalendar(this.rightCalendar.month.month(),this.rightCalendar.month.year(),this.rightCalendar.month.hour(),this.rightCalendar.month.minute(),this.rightCalendar.month.second(),"right");this.container.find(".calendar.left").empty().html(this.renderCalendar(this.leftCalendar.calendar,this.startDate,this.minDate,this.maxDate,"left"));this.container.find(".calendar.right").empty().html(this.renderCalendar(this.rightCalendar.calendar,this.endDate,this.singleDatePicker?this.minDate:this.startDate,this.maxDate,"right"));this.container.find(".ranges li").removeClass("active");var customRange=true;var i=0;for(var range in this.ranges){if(this.timePicker){if(this.startDate.isSame(this.ranges[range][0])&&this.endDate.isSame(this.ranges[range][1])){customRange=false;this.chosenLabel=this.container.find(".ranges li:eq("+i+")").addClass("active").html()}}else{if(this.startDate.format("YYYY-MM-DD")==this.ranges[range][0].format("YYYY-MM-DD")&&this.endDate.format("YYYY-MM-DD")==this.ranges[range][1].format("YYYY-MM-DD")){customRange=false;this.chosenLabel=this.container.find(".ranges li:eq("+i+")").addClass("active").html()}}i++}if(customRange){this.chosenLabel=this.container.find(".ranges li:last").addClass("active").html();this.showCalendars()}},buildCalendar:function(month,year,hour,minute,second,side){var daysInMonth=moment([year,month]).daysInMonth();var firstDay=moment([year,month,1]);var lastDay=moment([year,month,daysInMonth]);var lastMonth=moment(firstDay).subtract(1,"month").month();var lastYear=moment(firstDay).subtract(1,"month").year();var daysInLastMonth=moment([lastYear,lastMonth]).daysInMonth();var dayOfWeek=firstDay.day();var i;var calendar=[];calendar.firstDay=firstDay;calendar.lastDay=lastDay;for(i=0;i<6;i++){calendar[i]=[]}var startDay=daysInLastMonth-dayOfWeek+this.locale.firstDay+1;if(startDay>daysInLastMonth)startDay-=7;if(dayOfWeek==this.locale.firstDay)startDay=daysInLastMonth-6;var curDate=moment([lastYear,lastMonth,startDay,12,minute,second]);var col,row;for(i=0,col=0,row=0;i<42;i++,col++,curDate=moment(curDate).add(24,"hour")){if(i>0&&col%7===0){col=0;row++}calendar[row][col]=curDate.clone().hour(hour);curDate.hour(12);if(this.minDate&&calendar[row][col].format("YYYY-MM-DD")==this.minDate.format("YYYY-MM-DD")&&calendar[row][col].isBefore(this.minDate)&&side=="left"){calendar[row][col]=this.minDate.clone()}if(this.maxDate&&calendar[row][col].format("YYYY-MM-DD")==this.maxDate.format("YYYY-MM-DD")&&calendar[row][col].isAfter(this.maxDate)&&side=="right"){calendar[row][col]=this.maxDate.clone()}}return calendar},renderDropdowns:function(selected,minDate,maxDate){var currentMonth=selected.month();var currentYear=selected.year();var maxYear=maxDate&&maxDate.year()||currentYear+5;var minYear=minDate&&minDate.year()||currentYear-50;var monthHtml='<select class="monthselect">';var inMinYear=currentYear==minYear;var inMaxYear=currentYear==maxYear;for(var m=0;m<12;m++){if((!inMinYear||m>=minDate.month())&&(!inMaxYear||m<=maxDate.month())){monthHtml+="<option value='"+m+"'"+(m===currentMonth?" selected='selected'":"")+">"+this.locale.monthNames[m]+"</option>"}}monthHtml+="</select>";var yearHtml='<select class="yearselect">';for(var y=minYear;y<=maxYear;y++){yearHtml+='<option value="'+y+'"'+(y===currentYear?' selected="selected"':"")+">"+y+"</option>"}yearHtml+="</select>";return monthHtml+yearHtml},renderCalendar:function(calendar,selected,minDate,maxDate,side){var html='<div class="calendar-date">';html+='<table class="table-condensed">';html+="<thead>";html+="<tr>";if(this.showWeekNumbers)html+="<th></th>";if(!minDate||minDate.isBefore(calendar.firstDay)){html+='<th class="prev available"><i class="fa fa-arrow-left icon icon-arrow-left glyphicon glyphicon-arrow-left"></i></th>'}else{html+="<th></th>"}var dateHtml=this.locale.monthNames[calendar[1][1].month()]+calendar[1][1].format(" YYYY");if(this.showDropdowns){dateHtml=this.renderDropdowns(calendar[1][1],minDate,maxDate)}html+='<th colspan="5" class="month">'+dateHtml+"</th>";if(!maxDate||maxDate.isAfter(calendar.lastDay)){html+='<th class="next available"><i class="fa fa-arrow-right icon icon-arrow-right glyphicon glyphicon-arrow-right"></i></th>'}else{html+="<th></th>"}html+="</tr>";html+="<tr>";if(this.showWeekNumbers)html+='<th class="week">'+this.locale.weekLabel+"</th>";$.each(this.locale.daysOfWeek,function(index,dayOfWeek){html+="<th>"+dayOfWeek+"</th>"});html+="</tr>";html+="</thead>";html+="<tbody>";for(var row=0;row<6;row++){html+="<tr>";if(this.showWeekNumbers)html+='<td class="week">'+calendar[row][0].week()+"</td>";for(var col=0;col<7;col++){var cname="available ";cname+=calendar[row][col].month()==calendar[1][1].month()?"":"off";if(calendar[row][col].isSame(new Date,"day")){cname+=" today "}if(minDate&&calendar[row][col].isBefore(minDate,"day")||maxDate&&calendar[row][col].isAfter(maxDate,"day")){cname=" off disabled "}else if(calendar[row][col].format("YYYY-MM-DD")==selected.format("YYYY-MM-DD")){cname+=" active ";if(calendar[row][col].format("YYYY-MM-DD")==this.startDate.format("YYYY-MM-DD")){cname+=" start-date "}if(calendar[row][col].format("YYYY-MM-DD")==this.endDate.format("YYYY-MM-DD")){cname+=" end-date "}}else if(calendar[row][col]>=this.startDate&&calendar[row][col]<=this.endDate){cname+=" in-range ";if(calendar[row][col].isSame(this.startDate)){cname+=" start-date "}if(calendar[row][col].isSame(this.endDate)){cname+=" end-date "}}var title="r"+row+"c"+col;html+='<td class="'+cname.replace(/\s+/g," ").replace(/^\s?(.*?)\s?$/,"$1")+'" data-title="'+title+'">'+calendar[row][col].date()+"</td>"}html+="</tr>"}html+="</tbody>";html+="</table>";html+="</div>";var i;if(this.timePicker){html+='<div class="calendar-time">';html+='<select class="hourselect">';var min_hour=0;var max_hour=23;if(minDate&&(side=="left"||this.singleDatePicker)&&selected.format("YYYY-MM-DD")==minDate.format("YYYY-MM-DD")){min_hour=minDate.hour();if(selected.hour()<min_hour)selected.hour(min_hour);if(this.timePicker12Hour&&min_hour>=12&&selected.hour()>=12)min_hour-=12;if(this.timePicker12Hour&&min_hour==12)min_hour=1}if(maxDate&&(side=="right"||this.singleDatePicker)&&selected.format("YYYY-MM-DD")==maxDate.format("YYYY-MM-DD")){max_hour=maxDate.hour();if(selected.hour()>max_hour)selected.hour(max_hour);if(this.timePicker12Hour&&max_hour>=12&&selected.hour()>=12)max_hour-=12}var start=0;var end=23;var selected_hour=selected.hour();if(this.timePicker12Hour){start=1;end=12;if(selected_hour>=12)selected_hour-=12;if(selected_hour===0)selected_hour=12}for(i=start;i<=end;i++){if(i==selected_hour){html+='<option value="'+i+'" selected="selected">'+i+"</option>"}else if(i<min_hour||i>max_hour){html+='<option value="'+i+'" disabled="disabled" class="disabled">'+i+"</option>"}else{html+='<option value="'+i+'">'+i+"</option>"}}html+="</select> : ";html+='<select class="minuteselect">';var min_minute=0;var max_minute=59;if(minDate&&(side=="left"||this.singleDatePicker)&&selected.format("YYYY-MM-DD h A")==minDate.format("YYYY-MM-DD h A")){min_minute=minDate.minute();if(selected.minute()<min_minute)selected.minute(min_minute)}if(maxDate&&(side=="right"||this.singleDatePicker)&&selected.format("YYYY-MM-DD h A")==maxDate.format("YYYY-MM-DD h A")){max_minute=maxDate.minute();if(selected.minute()>max_minute)selected.minute(max_minute)}for(i=0;i<60;i+=this.timePickerIncrement){var num=i;if(num<10)num="0"+num;if(i==selected.minute()){html+='<option value="'+i+'" selected="selected">'+num+"</option>"}else if(i<min_minute||i>max_minute){html+='<option value="'+i+'" disabled="disabled" class="disabled">'+num+"</option>"}else{html+='<option value="'+i+'">'+num+"</option>"}}html+="</select> ";if(this.timePickerSeconds){html+=': <select class="secondselect">';for(i=0;i<60;i+=this.timePickerIncrement){var num=i;if(num<10)num="0"+num;if(i==selected.second()){html+='<option value="'+i+'" selected="selected">'+num+"</option>"}else{html+='<option value="'+i+'">'+num+"</option>"}}html+="</select>"}if(this.timePicker12Hour){html+='<select class="ampmselect">';var am_html="";var pm_html="";if(minDate&&(side=="left"||this.singleDatePicker)&&selected.format("YYYY-MM-DD")==minDate.format("YYYY-MM-DD")&&minDate.hour()>=12){am_html=' disabled="disabled" class="disabled"'}if(maxDate&&(side=="right"||this.singleDatePicker)&&selected.format("YYYY-MM-DD")==maxDate.format("YYYY-MM-DD")&&maxDate.hour()<12){pm_html=' disabled="disabled" class="disabled"'}if(selected.hour()>=12){html+='<option value="AM"'+am_html+'>AM</option><option value="PM" selected="selected"'+pm_html+">PM</option>"}else{html+='<option value="AM" selected="selected"'+am_html+'>AM</option><option value="PM"'+pm_html+">PM</option>"}html+="</select>"}html+="</div>"}return html},remove:function(){this.container.remove();this.element.off(".daterangepicker");this.element.removeData("daterangepicker")}};$.fn.daterangepicker=function(options,cb){this.each(function(){var el=$(this);if(el.data("daterangepicker"))el.data("daterangepicker").remove();el.data("daterangepicker",new DateRangePicker(el,options,cb))});return this};(function($){var scrollable=function(options){var imgUrl=options.imgUrl||"";var setStyle=options.setStyle;var isFirefox=navigator.userAgent.toLowerCase().match(/firefox\/([\d.]+)/),ie6=!window.XMLHttpRequest&&window.ActiveXObject,d=20;var self=this;var container=this[0];var _root,_slider,scrollAble,startPercent=0,currentPercent,scrollDis,sliderDis,startY,draging=!1,hideTimer;init();function init(){if(!self.find("#BS_scroll").length>0){container.style.position="relative";container.style.overflow="hidden";if(options.setStyle){self.append(['<div style="display:none;top:0;position: absolute;" id="BS_scroll"  >','<em style="min-height: 15px;display:inline-block;" id="BS_scroll_main"></em>',"</div>"].join(""))}else{self.append(['<div style="display:none;top:0;position: absolute;right: 1px;width: 11px;" id="BS_scroll"  >','<em style="height:0;background-image: url('+imgUrl+'/webim_scroll_bg.png);background-position: -9px 0;background-repeat: repeat-y;width: 11px;min-height: 5px;border-radius: 4px;display:inline-block;" id="BS_scroll_main"></em>',"</div>"].join(""))}}_root=self.find("#BS_scroll")[0];_root.style.zIndex=1e3;_slider=self.find("#BS_scroll_main")[0];unBindDomEvent(container);bindDomEvent(container);set()}function set(){containerClientHeight=container.clientHeight;ie6&&containerClientHeight==0&&(containerClientHeight=container.offsetHeight);containerScrollHeight=self.find("ul").height();scrollAble=containerClientHeight<containerScrollHeight;if(!!scrollAble){var b=containerClientHeight/containerScrollHeight,c=parseInt(containerClientHeight*b>d?containerClientHeight*b:d);_slider.style.height=c-7+"px";sliderDis=containerClientHeight-c;scrollDis=containerScrollHeight-containerClientHeight;var e=container.scrollTop/scrollDis;e>1&&(e=1);e<0&&(e=0);setPos(e);show()}}function hide(){_root.style.display="none"}function show(){_root.style.display=""}function start(b){if(!draging){draging=!0;b=b||widow.event;startY=b.clientY;preventDefault(b)}}function move(b){if(!!draging){b=b||window.event;var c=b.clientY;currentPercent=(c-startY)/sliderDis+startPercent;currentPercent>1&&(currentPercent=1);currentPercent<0&&(currentPercent=0);setPos(currentPercent);preventDefault(b)}}function end(a){if(!!draging){draging=!1;startPercent=currentPercent}}function over(a){var a=a||window.event,c=a.srcElement||a.target;hideTimer&&clearTimeout(hideTimer);!scrollAble||(hideTimer=setTimeout(function(){show();addEvent(document,"mousemove",move);$(document).on("selectstart.sortable",function(){return false})},300))}function out(a){hideTimer&&clearTimeout(hideTimer);hideTimer=setTimeout(function(){hide();removeEvent(document,"mousemove",move);$(document).off("selectstart.sortable")},500)}function scrollFun(b){if(!!scrollAble){var d=isFirefox?b.detail:-b.wheelDelta/40;startPercent=(container.scrollTop+d*16)/scrollDis;if(startPercent>1){startPercent=1;set()}startPercent<0&&(startPercent=0);setPos(startPercent);preventDefault(b)}}function setPos(a){container.scrollTop=a*scrollDis;_root.style.top=a*sliderDis+container.scrollTop+"px";currentPercent=a}function scrollPercent(a,b){scrollToByPercent(currentPercent+a,b)}function scrollToByPercent(a,b){setPos(a)}function bindDomEvent(){addEvent(container,isFirefox?"DOMMouseScroll":"mousewheel",scrollFun);addEvent(_slider,"mousedown",start);addEvent(document,"mouseup",end);addEvent(container,"mouseover",over);addEvent(container,"mouseout",out)}function unBindDomEvent(){removeEvent(container,isFirefox?"DOMMouseScroll":"mousewheel",scrollFun);removeEvent(_slider,"mousedown",start);removeEvent(document,"mouseup",end);removeEvent(container,"mouseover",over);removeEvent(container,"mouseout",out)}function addEvent(A,B,z){if(window.addEventListener){return A.addEventListener(B,z,false)}else{if(window.attachEvent){return A.attachEvent("on"+B,z)}else{return{}}}}function removeEvent(A,B,z){if(window.addEventListener){return A.removeEventListener(B,z,false)}else{if(window.detachEvent){return A.detachEvent("on"+B,z)}else{return{}}}}function preventDefault(z){if(z.preventDefault){z.preventDefault()}else{z.returnValue=false}}function stoppropogation(z){if(window.event){z.cancelBubble=true}else{z.stopPropogation()}}};$.fn.extend({scrollable:scrollable})})(jQuery);(function(window,doc){var m=Math,dummyStyle=doc.createElement("div").style,vendor=function(){var vendors="t,webkitT,MozT,msT,OT".split(","),t,i=0,l=vendors.length;for(;i<l;i++){t=vendors[i]+"ransform";if(t in dummyStyle){return vendors[i].substr(0,vendors[i].length-1)}}return false}(),cssVendor=vendor?"-"+vendor.toLowerCase()+"-":"",transform=prefixStyle("transform"),transitionProperty=prefixStyle("transitionProperty"),transitionDuration=prefixStyle("transitionDuration"),transformOrigin=prefixStyle("transformOrigin"),transitionTimingFunction=prefixStyle("transitionTimingFunction"),transitionDelay=prefixStyle("transitionDelay"),isAndroid=/android/gi.test(navigator.appVersion),isIDevice=/iphone|ipad/gi.test(navigator.appVersion),isTouchPad=/hp-tablet/gi.test(navigator.appVersion),has3d=prefixStyle("perspective")in dummyStyle,hasTouch="ontouchstart"in window&&!isTouchPad,hasTransform=vendor!==false,hasTransitionEnd=prefixStyle("transition")in dummyStyle,RESIZE_EV="onorientationchange"in window?"orientationchange":"resize",START_EV=hasTouch?"touchstart":"mousedown",MOVE_EV=hasTouch?"touchmove":"mousemove",END_EV=hasTouch?"touchend":"mouseup",CANCEL_EV=hasTouch?"touchcancel":"mouseup",TRNEND_EV=function(){if(vendor===false)return false;var transitionEnd={"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"};return transitionEnd[vendor]}(),nextFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return setTimeout(callback,1)}}(),cancelFrame=function(){return window.cancelRequestAnimationFrame||window.webkitCancelAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||clearTimeout}(),translateZ=has3d?" translateZ(0)":"",iScroll=function(el,options){var that=this,i;that.wrapper=typeof el=="object"?el:doc.getElementById(el);that.wrapper.style.overflow="hidden";that.scroller=that.wrapper.children[0];that.options={hScroll:true,vScroll:true,x:0,y:0,bounce:true,bounceLock:false,momentum:true,lockDirection:true,useTransform:true,useTransition:false,topOffset:0,checkDOMChanges:false,handleClick:true,hScrollbar:true,vScrollbar:true,fixedScrollbar:isAndroid,hideScrollbar:isIDevice,fadeScrollbar:isIDevice&&has3d,scrollbarClass:"",zoom:false,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:false,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(e){e.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(i in options)that.options[i]=options[i];that.x=that.options.x;that.y=that.options.y;that.options.useTransform=hasTransform&&that.options.useTransform;that.options.hScrollbar=that.options.hScroll&&that.options.hScrollbar;that.options.vScrollbar=that.options.vScroll&&that.options.vScrollbar;that.options.zoom=that.options.useTransform&&that.options.zoom;that.options.useTransition=hasTransitionEnd&&that.options.useTransition;if(that.options.zoom&&isAndroid){translateZ=""}that.scroller.style[transitionProperty]=that.options.useTransform?cssVendor+"transform":"top left";that.scroller.style[transitionDuration]="0";that.scroller.style[transformOrigin]="0 0";if(that.options.useTransition)that.scroller.style[transitionTimingFunction]="cubic-bezier(0.33,0.66,0.66,1)";if(that.options.useTransform)that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px)"+translateZ;else that.scroller.style.cssText+=";position:absolute;top:"+that.y+"px;left:"+that.x+"px";if(that.options.useTransition)that.options.fixedScrollbar=true;that.refresh();that._bind(RESIZE_EV,window);that._bind(START_EV);if(!hasTouch){if(that.options.wheelAction!="none"){that._bind("DOMMouseScroll");that._bind("mousewheel")}}if(that.options.checkDOMChanges)that.checkDOMTime=setInterval(function(){that._checkDOMChanges()},500)};iScroll.prototype={enabled:true,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(e){var that=this;switch(e.type){case START_EV:if(!hasTouch&&e.button!==0)return;that._start(e);break;case MOVE_EV:that._move(e);break;case END_EV:case CANCEL_EV:that._end(e);break;case RESIZE_EV:that._resize();break;case"DOMMouseScroll":case"mousewheel":that._wheel(e);break;case TRNEND_EV:that._transitionEnd(e);break}},_checkDOMChanges:function(){if(this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale)return;this.refresh()},_scrollbar:function(dir){var that=this,bar;if(!that[dir+"Scrollbar"]){if(that[dir+"ScrollbarWrapper"]){if(hasTransform)that[dir+"ScrollbarIndicator"].style[transform]="";that[dir+"ScrollbarWrapper"].parentNode.removeChild(that[dir+"ScrollbarWrapper"]);that[dir+"ScrollbarWrapper"]=null;that[dir+"ScrollbarIndicator"]=null}return}if(!that[dir+"ScrollbarWrapper"]){bar=doc.createElement("div");if(that.options.scrollbarClass)bar.className=that.options.scrollbarClass+dir.toUpperCase();else bar.style.cssText="position:absolute;z-index:100;"+(dir=="h"?"height:7px;bottom:1px;left:2px;right:"+(that.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(that.hScrollbar?"7":"2")+"px;top:2px;right:1px");bar.style.cssText+=";pointer-events:none;"+cssVendor+"transition-property:opacity;"+cssVendor+"transition-duration:"+(that.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(that.options.hideScrollbar?"0":"1");that.wrapper.appendChild(bar);that[dir+"ScrollbarWrapper"]=bar;bar=doc.createElement("div");if(!that.options.scrollbarClass){bar.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+cssVendor+"background-clip:padding-box;"+cssVendor+"box-sizing:border-box;"+(dir=="h"?"height:100%":"width:100%")+";"+cssVendor+"border-radius:3px;border-radius:3px"}bar.style.cssText+=";pointer-events:none;"+cssVendor+"transition-property:"+cssVendor+"transform;"+cssVendor+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+cssVendor+"transition-duration:0;"+cssVendor+"transform: translate(0,0)"+translateZ;if(that.options.useTransition)bar.style.cssText+=";"+cssVendor+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)";that[dir+"ScrollbarWrapper"].appendChild(bar);that[dir+"ScrollbarIndicator"]=bar}if(dir=="h"){that.hScrollbarSize=that.hScrollbarWrapper.clientWidth;that.hScrollbarIndicatorSize=m.max(m.round(that.hScrollbarSize*that.hScrollbarSize/that.scrollerW),8);that.hScrollbarIndicator.style.width=that.hScrollbarIndicatorSize+"px";that.hScrollbarMaxScroll=that.hScrollbarSize-that.hScrollbarIndicatorSize;that.hScrollbarProp=that.hScrollbarMaxScroll/that.maxScrollX}else{that.vScrollbarSize=that.vScrollbarWrapper.clientHeight;that.vScrollbarIndicatorSize=m.max(m.round(that.vScrollbarSize*that.vScrollbarSize/that.scrollerH),8);that.vScrollbarIndicator.style.height=that.vScrollbarIndicatorSize+"px";that.vScrollbarMaxScroll=that.vScrollbarSize-that.vScrollbarIndicatorSize;that.vScrollbarProp=that.vScrollbarMaxScroll/that.maxScrollY}that._scrollbarPos(dir,true)},_resize:function(){var that=this;setTimeout(function(){that.refresh()},isAndroid?200:0)},_pos:function(x,y){if(this.zoomed)return;x=this.hScroll?x:0;y=this.vScroll?y:0;if(this.options.useTransform){this.scroller.style[transform]="translate("+x+"px,"+y+"px) scale("+this.scale+")"+translateZ}else{x=m.round(x);y=m.round(y);this.scroller.style.left=x+"px";this.scroller.style.top=y+"px"}this.x=x;this.y=y;this._scrollbarPos("h");this._scrollbarPos("v")},_scrollbarPos:function(dir,hidden){var that=this,pos=dir=="h"?that.x:that.y,size;if(!that[dir+"Scrollbar"])return;pos=that[dir+"ScrollbarProp"]*pos;if(pos<0){if(!that.options.fixedScrollbar){size=that[dir+"ScrollbarIndicatorSize"]+m.round(pos*3);if(size<8)size=8;that[dir+"ScrollbarIndicator"].style[dir=="h"?"width":"height"]=size+"px"}pos=0}else if(pos>that[dir+"ScrollbarMaxScroll"]){if(!that.options.fixedScrollbar){size=that[dir+"ScrollbarIndicatorSize"]-m.round((pos-that[dir+"ScrollbarMaxScroll"])*3);if(size<8)size=8;that[dir+"ScrollbarIndicator"].style[dir=="h"?"width":"height"]=size+"px";pos=that[dir+"ScrollbarMaxScroll"]+(that[dir+"ScrollbarIndicatorSize"]-size)}else{pos=that[dir+"ScrollbarMaxScroll"]}}that[dir+"ScrollbarWrapper"].style[transitionDelay]="0";that[dir+"ScrollbarWrapper"].style.opacity=hidden&&that.options.hideScrollbar?"0":"1";that[dir+"ScrollbarIndicator"].style[transform]="translate("+(dir=="h"?pos+"px,0)":"0,"+pos+"px)")+translateZ},_start:function(e){var that=this,point=hasTouch?e.touches[0]:e,matrix,x,y,c1,c2;if(!that.enabled)return;if(that.options.onBeforeScrollStart)that.options.onBeforeScrollStart.call(that,e);if(that.options.useTransition||that.options.zoom)that._transitionTime(0);that.moved=false;that.animating=false;that.zoomed=false;that.distX=0;that.distY=0;that.absDistX=0;that.absDistY=0;that.dirX=0;that.dirY=0;if(that.options.zoom&&hasTouch&&e.touches.length>1){c1=m.abs(e.touches[0].pageX-e.touches[1].pageX);c2=m.abs(e.touches[0].pageY-e.touches[1].pageY);that.touchesDistStart=m.sqrt(c1*c1+c2*c2);that.originX=m.abs(e.touches[0].pageX+e.touches[1].pageX-that.wrapperOffsetLeft*2)/2-that.x;that.originY=m.abs(e.touches[0].pageY+e.touches[1].pageY-that.wrapperOffsetTop*2)/2-that.y;if(that.options.onZoomStart)that.options.onZoomStart.call(that,e)}if(that.options.momentum){if(that.options.useTransform){matrix=getComputedStyle(that.scroller,null)[transform].replace(/[^0-9\-.,]/g,"").split(",");x=+(matrix[12]||matrix[4]);y=+(matrix[13]||matrix[5])}else{x=+getComputedStyle(that.scroller,null).left.replace(/[^0-9-]/g,"");y=+getComputedStyle(that.scroller,null).top.replace(/[^0-9-]/g,"")}if(x!=that.x||y!=that.y){if(that.options.useTransition)that._unbind(TRNEND_EV);else cancelFrame(that.aniTime);that.steps=[];that._pos(x,y);if(that.options.onScrollEnd)that.options.onScrollEnd.call(that)}}that.absStartX=that.x;that.absStartY=that.y;that.startX=that.x;that.startY=that.y;that.pointX=point.pageX;that.pointY=point.pageY;that.startTime=e.timeStamp||Date.now();if(that.options.onScrollStart)that.options.onScrollStart.call(that,e);that._bind(MOVE_EV,window);that._bind(END_EV,window);that._bind(CANCEL_EV,window)},_move:function(e){var that=this,point=hasTouch?e.touches[0]:e,deltaX=point.pageX-that.pointX,deltaY=point.pageY-that.pointY,newX=that.x+deltaX,newY=that.y+deltaY,c1,c2,scale,timestamp=e.timeStamp||Date.now();if(that.options.onBeforeScrollMove)that.options.onBeforeScrollMove.call(that,e);if(that.options.zoom&&hasTouch&&e.touches.length>1){c1=m.abs(e.touches[0].pageX-e.touches[1].pageX);c2=m.abs(e.touches[0].pageY-e.touches[1].pageY);that.touchesDist=m.sqrt(c1*c1+c2*c2);that.zoomed=true;scale=1/that.touchesDistStart*that.touchesDist*this.scale;if(scale<that.options.zoomMin)scale=.5*that.options.zoomMin*Math.pow(2,scale/that.options.zoomMin);else if(scale>that.options.zoomMax)scale=2*that.options.zoomMax*Math.pow(.5,that.options.zoomMax/scale);that.lastScale=scale/this.scale;newX=this.originX-this.originX*that.lastScale+this.x;newY=this.originY-this.originY*that.lastScale+this.y;this.scroller.style[transform]="translate("+newX+"px,"+newY+"px) scale("+scale+")"+translateZ;if(that.options.onZoom)that.options.onZoom.call(that,e);return}that.pointX=point.pageX;that.pointY=point.pageY;if(newX>0||newX<that.maxScrollX){newX=that.options.bounce?that.x+deltaX/2:newX>=0||that.maxScrollX>=0?0:that.maxScrollX}if(newY>that.minScrollY||newY<that.maxScrollY){newY=that.options.bounce?that.y+deltaY/2:newY>=that.minScrollY||that.maxScrollY>=0?that.minScrollY:that.maxScrollY}that.distX+=deltaX;that.distY+=deltaY;that.absDistX=m.abs(that.distX);that.absDistY=m.abs(that.distY);if(that.absDistX<6&&that.absDistY<6){return}if(that.options.lockDirection){if(that.absDistX>that.absDistY+5){newY=that.y;deltaY=0}else if(that.absDistY>that.absDistX+5){newX=that.x;deltaX=0}}that.moved=true;that._pos(newX,newY);that.dirX=deltaX>0?-1:deltaX<0?1:0;that.dirY=deltaY>0?-1:deltaY<0?1:0;if(timestamp-that.startTime>300){that.startTime=timestamp;that.startX=that.x;that.startY=that.y}if(that.options.onScrollMove)that.options.onScrollMove.call(that,e)},_end:function(e){if(hasTouch&&e.touches.length!==0)return;var that=this,point=hasTouch?e.changedTouches[0]:e,target,ev,momentumX={dist:0,time:0},momentumY={dist:0,time:0},duration=(e.timeStamp||Date.now())-that.startTime,newPosX=that.x,newPosY=that.y,distX,distY,newDuration,snap,scale;that._unbind(MOVE_EV,window);that._unbind(END_EV,window);that._unbind(CANCEL_EV,window);if(that.options.onBeforeScrollEnd)that.options.onBeforeScrollEnd.call(that,e);if(that.zoomed){scale=that.scale*that.lastScale;scale=Math.max(that.options.zoomMin,scale);scale=Math.min(that.options.zoomMax,scale);that.lastScale=scale/that.scale;that.scale=scale;that.x=that.originX-that.originX*that.lastScale+that.x;that.y=that.originY-that.originY*that.lastScale+that.y;that.scroller.style[transitionDuration]="200ms";that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px) scale("+that.scale+")"+translateZ;that.zoomed=false;that.refresh();if(that.options.onZoomEnd)that.options.onZoomEnd.call(that,e);return}if(!that.moved){
if(hasTouch){if(that.doubleTapTimer&&that.options.zoom){clearTimeout(that.doubleTapTimer);that.doubleTapTimer=null;if(that.options.onZoomStart)that.options.onZoomStart.call(that,e);that.zoom(that.pointX,that.pointY,that.scale==1?that.options.doubleTapZoom:1);if(that.options.onZoomEnd){setTimeout(function(){that.options.onZoomEnd.call(that,e)},200)}}else if(this.options.handleClick){that.doubleTapTimer=setTimeout(function(){that.doubleTapTimer=null;target=point.target;while(target.nodeType!=1)target=target.parentNode;if(target.tagName!="SELECT"&&target.tagName!="INPUT"&&target.tagName!="TEXTAREA"){ev=doc.createEvent("MouseEvents");ev.initMouseEvent("click",true,true,e.view,1,point.screenX,point.screenY,point.clientX,point.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null);ev._fake=true;target.dispatchEvent(ev)}},that.options.zoom?250:0)}}that._resetPos(400);if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);return}if(duration<300&&that.options.momentum){momentumX=newPosX?that._momentum(newPosX-that.startX,duration,-that.x,that.scrollerW-that.wrapperW+that.x,that.options.bounce?that.wrapperW:0):momentumX;momentumY=newPosY?that._momentum(newPosY-that.startY,duration,-that.y,that.maxScrollY<0?that.scrollerH-that.wrapperH+that.y-that.minScrollY:0,that.options.bounce?that.wrapperH:0):momentumY;newPosX=that.x+momentumX.dist;newPosY=that.y+momentumY.dist;if(that.x>0&&newPosX>0||that.x<that.maxScrollX&&newPosX<that.maxScrollX)momentumX={dist:0,time:0};if(that.y>that.minScrollY&&newPosY>that.minScrollY||that.y<that.maxScrollY&&newPosY<that.maxScrollY)momentumY={dist:0,time:0}}if(momentumX.dist||momentumY.dist){newDuration=m.max(m.max(momentumX.time,momentumY.time),10);if(that.options.snap){distX=newPosX-that.absStartX;distY=newPosY-that.absStartY;if(m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold){that.scrollTo(that.absStartX,that.absStartY,200)}else{snap=that._snap(newPosX,newPosY);newPosX=snap.x;newPosY=snap.y;newDuration=m.max(snap.time,newDuration)}}that.scrollTo(m.round(newPosX),m.round(newPosY),newDuration);if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);return}if(that.options.snap){distX=newPosX-that.absStartX;distY=newPosY-that.absStartY;if(m.abs(distX)<that.options.snapThreshold&&m.abs(distY)<that.options.snapThreshold)that.scrollTo(that.absStartX,that.absStartY,200);else{snap=that._snap(that.x,that.y);if(snap.x!=that.x||snap.y!=that.y)that.scrollTo(snap.x,snap.y,snap.time)}if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e);return}that._resetPos(200);if(that.options.onTouchEnd)that.options.onTouchEnd.call(that,e)},_resetPos:function(time){var that=this,resetX=that.x>=0?0:that.x<that.maxScrollX?that.maxScrollX:that.x,resetY=that.y>=that.minScrollY||that.maxScrollY>0?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;if(resetX==that.x&&resetY==that.y){if(that.moved){that.moved=false;if(that.options.onScrollEnd)that.options.onScrollEnd.call(that)}if(that.hScrollbar&&that.options.hideScrollbar){if(vendor=="webkit")that.hScrollbarWrapper.style[transitionDelay]="300ms";that.hScrollbarWrapper.style.opacity="0"}if(that.vScrollbar&&that.options.hideScrollbar){if(vendor=="webkit")that.vScrollbarWrapper.style[transitionDelay]="300ms";that.vScrollbarWrapper.style.opacity="0"}return}that.scrollTo(resetX,resetY,time||0)},_wheel:function(e){var that=this,wheelDeltaX,wheelDeltaY,deltaX,deltaY,deltaScale;if("wheelDeltaX"in e){wheelDeltaX=e.wheelDeltaX/12;wheelDeltaY=e.wheelDeltaY/12}else if("wheelDelta"in e){wheelDeltaX=wheelDeltaY=e.wheelDelta/12}else if("detail"in e){wheelDeltaX=wheelDeltaY=-e.detail*3}else{return}if(that.options.wheelAction=="zoom"){deltaScale=that.scale*Math.pow(2,1/3*(wheelDeltaY?wheelDeltaY/Math.abs(wheelDeltaY):0));if(deltaScale<that.options.zoomMin)deltaScale=that.options.zoomMin;if(deltaScale>that.options.zoomMax)deltaScale=that.options.zoomMax;if(deltaScale!=that.scale){if(!that.wheelZoomCount&&that.options.onZoomStart)that.options.onZoomStart.call(that,e);that.wheelZoomCount++;that.zoom(e.pageX,e.pageY,deltaScale,400);setTimeout(function(){that.wheelZoomCount--;if(!that.wheelZoomCount&&that.options.onZoomEnd)that.options.onZoomEnd.call(that,e)},400)}return}deltaX=that.x+wheelDeltaX;deltaY=that.y+wheelDeltaY;if(deltaX>0)deltaX=0;else if(deltaX<that.maxScrollX)deltaX=that.maxScrollX;if(deltaY>that.minScrollY)deltaY=that.minScrollY;else if(deltaY<that.maxScrollY)deltaY=that.maxScrollY;if(that.maxScrollY<0){that.scrollTo(deltaX,deltaY,0)}},_transitionEnd:function(e){var that=this;if(e.target!=that.scroller)return;that._unbind(TRNEND_EV);that._startAni()},_startAni:function(){var that=this,startX=that.x,startY=that.y,startTime=Date.now(),step,easeOut,animate;if(that.animating)return;if(!that.steps.length){that._resetPos(400);return}step=that.steps.shift();if(step.x==startX&&step.y==startY)step.time=0;that.animating=true;that.moved=true;if(that.options.useTransition){that._transitionTime(step.time);that._pos(step.x,step.y);that.animating=false;if(step.time)that._bind(TRNEND_EV);else that._resetPos(0);return}animate=function(){var now=Date.now(),newX,newY;if(now>=startTime+step.time){that._pos(step.x,step.y);that.animating=false;if(that.options.onAnimationEnd)that.options.onAnimationEnd.call(that);that._startAni();return}now=(now-startTime)/step.time-1;easeOut=m.sqrt(1-now*now);newX=(step.x-startX)*easeOut+startX;newY=(step.y-startY)*easeOut+startY;that._pos(newX,newY);if(that.animating)that.aniTime=nextFrame(animate)};animate()},_transitionTime:function(time){time+="ms";this.scroller.style[transitionDuration]=time;if(this.hScrollbar)this.hScrollbarIndicator.style[transitionDuration]=time;if(this.vScrollbar)this.vScrollbarIndicator.style[transitionDuration]=time},_momentum:function(dist,time,maxDistUpper,maxDistLower,size){var deceleration=6e-4,speed=m.abs(dist)/time,newDist=speed*speed/(2*deceleration),newTime=0,outsideDist=0;if(dist>0&&newDist>maxDistUpper){outsideDist=size/(6/(newDist/speed*deceleration));maxDistUpper=maxDistUpper+outsideDist;speed=speed*maxDistUpper/newDist;newDist=maxDistUpper}else if(dist<0&&newDist>maxDistLower){outsideDist=size/(6/(newDist/speed*deceleration));maxDistLower=maxDistLower+outsideDist;speed=speed*maxDistLower/newDist;newDist=maxDistLower}newDist=newDist*(dist<0?-1:1);newTime=speed/deceleration;return{dist:newDist,time:m.round(newTime)}},_offset:function(el){var left=-el.offsetLeft,top=-el.offsetTop;while(el=el.offsetParent){left-=el.offsetLeft;top-=el.offsetTop}if(el!=this.wrapper){left*=this.scale;top*=this.scale}return{left:left,top:top}},_snap:function(x,y){var that=this,i,l,page,time,sizeX,sizeY;page=that.pagesX.length-1;for(i=0,l=that.pagesX.length;i<l;i++){if(x>=that.pagesX[i]){page=i;break}}if(page==that.currPageX&&page>0&&that.dirX<0)page--;x=that.pagesX[page];sizeX=m.abs(x-that.pagesX[that.currPageX]);sizeX=sizeX?m.abs(that.x-x)/sizeX*500:0;that.currPageX=page;page=that.pagesY.length-1;for(i=0;i<page;i++){if(y>=that.pagesY[i]){page=i;break}}if(page==that.currPageY&&page>0&&that.dirY<0)page--;y=that.pagesY[page];sizeY=m.abs(y-that.pagesY[that.currPageY]);sizeY=sizeY?m.abs(that.y-y)/sizeY*500:0;that.currPageY=page;time=m.round(m.max(sizeX,sizeY))||200;return{x:x,y:y,time:time}},_bind:function(type,el,bubble){(el||this.scroller).addEventListener(type,this,!!bubble)},_unbind:function(type,el,bubble){(el||this.scroller).removeEventListener(type,this,!!bubble)},destroy:function(){var that=this;that.scroller.style[transform]="";that.hScrollbar=false;that.vScrollbar=false;that._scrollbar("h");that._scrollbar("v");that._unbind(RESIZE_EV,window);that._unbind(START_EV);that._unbind(MOVE_EV,window);that._unbind(END_EV,window);that._unbind(CANCEL_EV,window);if(!that.options.hasTouch){that._unbind("DOMMouseScroll");that._unbind("mousewheel")}if(that.options.useTransition)that._unbind(TRNEND_EV);if(that.options.checkDOMChanges)clearInterval(that.checkDOMTime);if(that.options.onDestroy)that.options.onDestroy.call(that)},refresh:function(){var that=this,offset,i,l,els,pos=0,page=0;if(that.scale<that.options.zoomMin)that.scale=that.options.zoomMin;that.wrapperW=that.wrapper.clientWidth||1;that.wrapperH=that.wrapper.clientHeight||1;that.minScrollY=-that.options.topOffset||0;that.scrollerW=m.round(that.scroller.offsetWidth*that.scale);that.scrollerH=m.round((that.scroller.offsetHeight+that.minScrollY)*that.scale);that.maxScrollX=that.wrapperW-that.scrollerW;that.maxScrollY=that.wrapperH-that.scrollerH+that.minScrollY;that.dirX=0;that.dirY=0;if(that.options.onRefresh)that.options.onRefresh.call(that);that.hScroll=that.options.hScroll&&that.maxScrollX<0;that.vScroll=that.options.vScroll&&(!that.options.bounceLock&&!that.hScroll||that.scrollerH>that.wrapperH);that.hScrollbar=that.hScroll&&that.options.hScrollbar;that.vScrollbar=that.vScroll&&that.options.vScrollbar&&that.scrollerH>that.wrapperH;offset=that._offset(that.wrapper);that.wrapperOffsetLeft=-offset.left;that.wrapperOffsetTop=-offset.top;if(typeof that.options.snap=="string"){that.pagesX=[];that.pagesY=[];els=that.scroller.querySelectorAll(that.options.snap);for(i=0,l=els.length;i<l;i++){pos=that._offset(els[i]);pos.left+=that.wrapperOffsetLeft;pos.top+=that.wrapperOffsetTop;that.pagesX[i]=pos.left<that.maxScrollX?that.maxScrollX:pos.left*that.scale;that.pagesY[i]=pos.top<that.maxScrollY?that.maxScrollY:pos.top*that.scale}}else if(that.options.snap){that.pagesX=[];while(pos>=that.maxScrollX){that.pagesX[page]=pos;pos=pos-that.wrapperW;page++}if(that.maxScrollX%that.wrapperW)that.pagesX[that.pagesX.length]=that.maxScrollX-that.pagesX[that.pagesX.length-1]+that.pagesX[that.pagesX.length-1];pos=0;page=0;that.pagesY=[];while(pos>=that.maxScrollY){that.pagesY[page]=pos;pos=pos-that.wrapperH;page++}if(that.maxScrollY%that.wrapperH)that.pagesY[that.pagesY.length]=that.maxScrollY-that.pagesY[that.pagesY.length-1]+that.pagesY[that.pagesY.length-1]}that._scrollbar("h");that._scrollbar("v");if(!that.zoomed){that.scroller.style[transitionDuration]="0";that._resetPos(400)}},scrollTo:function(x,y,time,relative){var that=this,step=x,i,l;that.stop();if(!step.length)step=[{x:x,y:y,time:time,relative:relative}];for(i=0,l=step.length;i<l;i++){if(step[i].relative){step[i].x=that.x-step[i].x;step[i].y=that.y-step[i].y}that.steps.push({x:step[i].x,y:step[i].y,time:step[i].time||0})}that._startAni()},scrollToElement:function(el,time){var that=this,pos;el=el.nodeType?el:that.scroller.querySelector(el);if(!el)return;pos=that._offset(el);pos.left+=that.wrapperOffsetLeft;pos.top+=that.wrapperOffsetTop;pos.left=pos.left>0?0:pos.left<that.maxScrollX?that.maxScrollX:pos.left;pos.top=pos.top>that.minScrollY?that.minScrollY:pos.top<that.maxScrollY?that.maxScrollY:pos.top;time=time===undefined?m.max(m.abs(pos.left)*2,m.abs(pos.top)*2):time;that.scrollTo(pos.left,pos.top,time)},scrollToPage:function(pageX,pageY,time){var that=this,x,y;time=time===undefined?400:time;if(that.options.onScrollStart)that.options.onScrollStart.call(that);if(that.options.snap){pageX=pageX=="next"?that.currPageX+1:pageX=="prev"?that.currPageX-1:pageX;pageY=pageY=="next"?that.currPageY+1:pageY=="prev"?that.currPageY-1:pageY;pageX=pageX<0?0:pageX>that.pagesX.length-1?that.pagesX.length-1:pageX;pageY=pageY<0?0:pageY>that.pagesY.length-1?that.pagesY.length-1:pageY;that.currPageX=pageX;that.currPageY=pageY;x=that.pagesX[pageX];y=that.pagesY[pageY]}else{x=-that.wrapperW*pageX;y=-that.wrapperH*pageY;if(x<that.maxScrollX)x=that.maxScrollX;if(y<that.maxScrollY)y=that.maxScrollY}that.scrollTo(x,y,time)},disable:function(){this.stop();this._resetPos(0);this.enabled=false;this._unbind(MOVE_EV,window);this._unbind(END_EV,window);this._unbind(CANCEL_EV,window)},enable:function(){this.enabled=true},stop:function(){if(this.options.useTransition)this._unbind(TRNEND_EV);else cancelFrame(this.aniTime);this.steps=[];this.moved=false;this.animating=false},zoom:function(x,y,scale,time){var that=this,relScale=scale/that.scale;if(!that.options.useTransform)return;that.zoomed=true;time=time===undefined?200:time;x=x-that.wrapperOffsetLeft-that.x;y=y-that.wrapperOffsetTop-that.y;that.x=x-x*relScale+that.x;that.y=y-y*relScale+that.y;that.scale=scale;that.refresh();that.x=that.x>0?0:that.x<that.maxScrollX?that.maxScrollX:that.x;that.y=that.y>that.minScrollY?that.minScrollY:that.y<that.maxScrollY?that.maxScrollY:that.y;that.scroller.style[transitionDuration]=time+"ms";that.scroller.style[transform]="translate("+that.x+"px,"+that.y+"px) scale("+scale+")"+translateZ;that.zoomed=false},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}};function prefixStyle(style){if(vendor==="")return style;style=style.charAt(0).toUpperCase()+style.substr(1);return vendor+style}dummyStyle=null;if(typeof exports!=="undefined")exports.iScroll=iScroll;else window.iScroll=iScroll})(window,document);(function(factory){factory(window.jQuery)})(function($){if(!$||!$.fn||!$.fn.jquery){alert("在引用wangEditor.js之前，先引用jQuery，否则无法使用 wangEditor");return}var _e=function(fn){var E=window.wangEditor;if(E){fn(E,$)}};(function(window,$){if(window.wangEditor){alert("一个页面不能重复引用 wangEditor.js 或 wangEditor.min.js ！！！");return}var E=function(elem){if(typeof elem==="string"){elem="#"+elem}var $elem=$(elem);if($elem.length!==1){return}var nodeName=$elem[0].nodeName;if(nodeName!=="TEXTAREA"&&nodeName!=="DIV"){return}this.valueNodeName=nodeName.toLowerCase();this.$valueContainer=$elem;this.$prev=$elem.prev();this.$parent=$elem.parent();this.init()};E.fn=E.prototype;E.$body=$("body");E.$document=$(document);E.$window=$(window);E.userAgent=navigator.userAgent;E.getComputedStyle=window.getComputedStyle;E.w3cRange=typeof document.createRange==="function";E.hostname=location.hostname.toLowerCase();E.websiteHost="wangeditor.github.io|www.wangeditor.com|wangeditor.coding.me";E.isOnWebsite=E.websiteHost.indexOf(E.hostname)>=0;E.docsite="http://www.kancloud.cn/wangfupeng/wangeditor2/113961";window.wangEditor=E;E.plugin=function(fn){if(!E._plugins){E._plugins=[]}if(typeof fn==="function"){E._plugins.push(fn)}}})(window,$);_e(function(E,$){E.fn.init=function(){this.initDefaultConfig();this.addEditorContainer();this.addTxt();this.addMenuContainer();this.menus={};this.commandHooks()}});_e(function(E,$){E.fn.ready=function(fn){if(!this.readyFns){this.readyFns=[]}this.readyFns.push(fn)};E.fn.readyHeadler=function(){var fns=this.readyFns;while(fns.length){fns.shift().call(this)}};E.fn.updateValue=function(){var editor=this;var $valueContainer=editor.$valueContainer;var $txt=editor.txt.$txt;if($valueContainer===$txt){return}var value=$txt.html();$valueContainer.val(value)};E.fn.getInitValue=function(){var editor=this;var $valueContainer=editor.$valueContainer;var currentValue="";var nodeName=editor.valueNodeName;if(nodeName==="div"){currentValue=$valueContainer.html()}else if(nodeName==="textarea"){currentValue=$valueContainer.val()}return currentValue};E.fn.updateMenuStyle=function(){var menus=this.menus;$.each(menus,function(k,menu){menu.updateSelected()})};E.fn.enableMenusExcept=function(menuIds){if(this._disabled){return}menuIds=menuIds||[];if(typeof menuIds==="string"){menuIds=[menuIds]}$.each(this.menus,function(k,menu){if(menuIds.indexOf(k)>=0){return}menu.disabled(false)})};E.fn.disableMenusExcept=function(menuIds){if(this._disabled){return}menuIds=menuIds||[];if(typeof menuIds==="string"){menuIds=[menuIds]}$.each(this.menus,function(k,menu){if(menuIds.indexOf(k)>=0){return}menu.disabled(true)})};E.fn.hideDropPanelAndModal=function(){var menus=this.menus;$.each(menus,function(k,menu){var m=menu.dropPanel||menu.dropList||menu.modal;if(m&&m.hide){m.hide()}})}});_e(function(E,$){var ieRange=!E.w3cRange;function emptyFn(){}E.fn.currentRange=function(cr){if(cr){this._rangeData=cr}else{return this._rangeData}};E.fn.collapseRange=function(range,opt){opt=opt||"end";opt=opt==="start"?true:false;range=range||this.currentRange();if(range){range.collapse(opt);this.currentRange(range)}};E.fn.getRangeText=ieRange?emptyFn:function(range){range=range||this.currentRange();if(!range){return}return range.toString()};E.fn.getRangeElem=ieRange?emptyFn:function(range){range=range||this.currentRange();var dom=range.commonAncestorContainer;if(dom.nodeType===1){return dom}else{return dom.parentNode}};E.fn.isRangeEmpty=ieRange?emptyFn:function(range){range=range||this.currentRange();if(range&&range.startContainer){if(range.startContainer===range.endContainer){if(range.startOffset===range.endOffset){return true}}}return false};E.fn.saveSelection=ieRange?emptyFn:function(range){var self=this,_parentElem,selection,txt=self.txt.$txt.get(0);if(range){_parentElem=range.commonAncestorContainer}else{selection=document.getSelection();if(selection.getRangeAt&&selection.rangeCount){range=document.getSelection().getRangeAt(0);_parentElem=range.commonAncestorContainer}}if(_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)){self.currentRange(range)}};E.fn.restoreSelection=ieRange?emptyFn:function(range){var selection;range=range||this.currentRange();if(!range){return}try{selection=document.getSelection();selection.removeAllRanges();selection.addRange(range)}catch(ex){E.error("执行 editor.restoreSelection 时，IE可能会有异常，不影响使用")}};E.fn.restoreSelectionByElem=ieRange?emptyFn:function(elem,opt){if(!elem){return}opt=opt||"end";this.setRangeByElem(elem);if(opt==="start"){this.collapseRange(this.currentRange(),"start")}if(opt==="end"){this.collapseRange(this.currentRange(),"end")}this.restoreSelection()};E.fn.initSelection=ieRange?emptyFn:function(){var editor=this;if(editor.currentRange()){return}var range;var $txt=editor.txt.$txt;var $firstChild=$txt.children().first();if($firstChild.length){editor.restoreSelectionByElem($firstChild.get(0))}};E.fn.setRangeByElem=ieRange?emptyFn:function(elem){var editor=this;var txtElem=editor.txt.$txt.get(0);if(!elem||!$.contains(txtElem,elem)){return}var firstTextNode=elem.firstChild;while(firstTextNode){if(firstTextNode.nodeType===3){break}firstTextNode=firstTextNode.firstChild}var lastTextNode=elem.lastChild;while(lastTextNode){if(lastTextNode.nodeType===3){break}lastTextNode=lastTextNode.lastChild}var range=document.createRange();if(firstTextNode&&lastTextNode){range.setStart(firstTextNode,0);range.setEnd(lastTextNode,lastTextNode.textContent.length)}else{range.setStart(elem,0);range.setEnd(elem,0)}editor.saveSelection(range)}});_e(function(E,$){if(E.w3cRange){return}E.fn.getRangeText=function(range){range=range||this.currentRange();if(!range){return}return range.text};E.fn.getRangeElem=function(range){range=range||this.currentRange();if(!range){return}var dom=range.parentElement();if(dom.nodeType===1){return dom}else{return dom.parentNode}};E.fn.isRangeEmpty=function(range){range=range||this.currentRange();if(range&&range.text){return false}return true};E.fn.saveSelection=function(range){var self=this,_parentElem,selection,txt=self.txt.$txt.get(0);if(range){_parentElem=range.parentElement()}else{range=document.selection.createRange();if(typeof range.parentElement==="undefined"){_parentElem=null}else{_parentElem=range.parentElement()}}if(_parentElem&&($.contains(txt,_parentElem)||txt===_parentElem)){self.currentRange(range)}};E.fn.restoreSelection=function(currentRange){var editor=this,selection,range;currentRange=currentRange||editor.currentRange();if(!currentRange){return}range=document.selection.createRange();try{range.setEndPoint("EndToEnd",currentRange)}catch(ex){}if(currentRange.text.length===0){try{range.collapse(false)}catch(ex){}}else{range.setEndPoint("StartToStart",currentRange)}range.select()}});_e(function(E,$){E.fn.commandHooks=function(){var editor=this;var commandHooks={};commandHooks.insertHtml=function(html){var $elem=$(html);var rangeElem=editor.getRangeElem();var targetElem;targetElem=editor.getLegalTags(rangeElem);if(!targetElem){return}$(targetElem).after($elem)};editor.commandHooks=commandHooks}});_e(function(E,$){E.fn.command=function(e,commandName,commandValue,callback){var editor=this;var hooks;function commandFn(){if(!commandName){return}if(editor.queryCommandSupported(commandName)){document.execCommand(commandName,false,commandValue)}else{hooks=editor.commandHooks;if(commandName in hooks){hooks[commandName](commandValue)}}if(commandName=="insertHtml"){var txt=editor.$txt.text();editor._placeShow(txt);editor.txt.clearEmptyOrNestP();if(editor.onchange&&typeof editor.onchange==="function"){editor.onchange.call(editor)}}}this.customCommand(e,commandFn,callback)};E.fn.commandForElem=function(elemOpt,e,commandName,commandValue,callback){var selector;var check;if(typeof elemOpt==="string"){selector=elemOpt}else{selector=elemOpt.selector;check=elemOpt.check}var rangeElem=this.getRangeElem();rangeElem=this.getSelfOrParentByName(rangeElem,selector,check);if(rangeElem){this.setRangeByElem(rangeElem)}this.command(e,commandName,commandValue,callback)};E.fn.customCommand=function(e,commandFn,callback){var editor=this;var range=editor.currentRange();if(!range){e&&e.preventDefault();return}editor.undoRecord();this.restoreSelection(range);commandFn.call(editor);this.saveSelection();this.restoreSelection();if(callback&&typeof callback==="function"){callback.call(editor)}editor.txt.insertEmptyP();editor.txt.wrapImgAndText();editor.updateValue();editor.updateMenuStyle();function hidePanelAndModal(){editor.hideDropPanelAndModal()}setTimeout(hidePanelAndModal,200);if(e){e.preventDefault()}};E.fn.queryCommandValue=function(commandName){var result="";try{result=document.queryCommandValue(commandName)}catch(ex){}return result};E.fn.queryCommandState=function(commandName){var result=false;try{result=document.queryCommandState(commandName)}catch(ex){}return result};E.fn.queryCommandSupported=function(commandName){var result=false;try{result=document.queryCommandSupported(commandName)}catch(ex){}return result}});_e(function(E,$){var matchesSelector;function _matchesSelectorForIE(selector){var elem=this;var $elems=$(selector);var result=false;$elems.each(function(){if(this===elem){result=true;return false}});return result}E.fn.getLegalTags=function(elem){var legalTags=this.config.legalTags;if(!legalTags){E.error("配置项中缺少 legalTags 的配置");return}return this.getSelfOrParentByName(elem,legalTags)};E.fn.getSelfOrParentByName=function(elem,selector,check){if(!elem||!selector){return}if(!matchesSelector){matchesSelector=elem.webkitMatchesSelector||elem.mozMatchesSelector||elem.oMatchesSelector||elem.matchesSelector}if(!matchesSelector){matchesSelector=_matchesSelectorForIE}var txt=this.txt.$txt.get(0);while(elem&&txt!==elem&&$.contains(txt,elem)){if(matchesSelector.call(elem,selector)){if(!check){return elem}if(check(elem)){return elem}}elem=elem.parentNode}return}});_e(function(E,$){var length=20;function _getRedoList(editor){if(editor._redoList==null){editor._redoList=[]}return editor._redoList}function _getUndoList(editor){if(editor._undoList==null){editor._undoList=[]}return editor._undoList}function _handle(editor,data,type){var val=data.val;var html=editor.txt.$txt.html();if(val==null){return}if(val===html){if(type==="redo"){editor.redo();return}else if(type==="undo"){editor.undo();return}else{return}}editor.txt.$txt.html(val);editor.updateValue();if(editor.onchange&&typeof editor.onchange==="function"){editor.onchange.call(editor)}}E.fn.undoRecord=function(){var editor=this;var $txt=editor.txt.$txt;var val=$txt.html();var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);var currentVal=undoList.length?undoList[0]:"";if(val===currentVal.val){return}if(redoList.length){redoList=[]}undoList.unshift({range:editor.currentRange(),val:val});if(undoList.length>length){undoList.pop()}};E.fn.undo=function(){var editor=this;var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);if(!undoList.length){return}var data=undoList.shift();redoList.unshift(data);_handle(this,data,"undo")};E.fn.redo=function(){var editor=this;var undoList=_getUndoList(editor);var redoList=_getRedoList(editor);if(!redoList.length){return}var data=redoList.shift();undoList.unshift(data);_handle(this,data,"redo")}});_e(function(E,$){E.fn.create=function(){var editor=this;if(!E.$body||E.$body.length===0){E.$body=$("body");E.$document=$(document);E.$window=$(window)}editor.addMenus();editor.renderMenus();editor.renderMenuContainer();editor.renderTxt();editor.renderEditorContainer();editor.eventMenus();editor.eventMenuContainer();editor.eventTxt();editor.readyHeadler();editor.initSelection();editor.$txt=editor.txt.$txt;var _plugins=E._plugins;if(_plugins&&_plugins.length){$.each(_plugins,function(k,val){val.call(editor)})}};E.fn.disable=function(){this.txt.$txt.removeAttr("contenteditable");this.disableMenusExcept();this._disabled=true};E.fn.enable=function(){this._disabled=false;this.txt.$txt.attr("contenteditable","true");this.enableMenusExcept()};E.fn.destroy=function(){var self=this;var $valueContainer=self.$valueContainer;var $editorContainer=self.$editorContainer;var valueNodeName=self.valueNodeName;if(valueNodeName==="div"){$valueContainer.removeAttr("contenteditable");$editorContainer.after($valueContainer);$editorContainer.hide()}else{$valueContainer.show();$editorContainer.hide()}};E.fn.undestroy=function(){var self=this;var $valueContainer=self.$valueContainer;var $editorContainer=self.$editorContainer;var $menuContainer=self.menuContainer.$menuContainer;var valueNodeName=self.valueNodeName;if(valueNodeName==="div"){$valueContainer.attr("contenteditable","true");$menuContainer.after($valueContainer);$editorContainer.show()}else{$valueContainer.hide();$editorContainer.show()}};E.fn.clear=function(){var editor=this;var $txt=editor.txt.$txt;$txt.html("<p><br></p>");editor.restoreSelectionByElem($txt.find("p").get(0))}});_e(function(E,$){var MenuContainer=function(editor){this.editor=editor;this.init()};MenuContainer.fn=MenuContainer.prototype;E.MenuContainer=MenuContainer});_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.init=function(){var self=this;var $menuContainer=$('<div class="wangEditor-menu-container clearfix"></div>');self.$menuContainer=$menuContainer;self.changeShadow()};MenuContainer.fn.changeShadow=function(){var $menuContainer=this.$menuContainer;var editor=this.editor;var $txt=editor.txt.$txt;$txt.on("scroll",function(){if($txt.scrollTop()>10){$menuContainer.addClass("wangEditor-menu-shadow")}else{$menuContainer.removeClass("wangEditor-menu-shadow")}})}});_e(function(E,$){var MenuContainer=E.MenuContainer;MenuContainer.fn.render=function(){var $menuContainer=this.$menuContainer;var $editorContainer=this.editor.$editorContainer;$editorContainer.append($menuContainer)};MenuContainer.fn.height=function(){var $menuContainer=this.$menuContainer;return $menuContainer.height()};MenuContainer.fn.appendMenu=function(groupIdx,menu){this._addGroup(groupIdx);return this._addOneMenu(menu)};MenuContainer.fn._addGroup=function(groupIdx){var $menuContainer=this.$menuContainer;var $menuGroup;if(!this.$currentGroup||this.currentGroupIdx!==groupIdx){$menuGroup=$('<div class="menu-group clearfix"></div>');$menuContainer.append($menuGroup);this.$currentGroup=$menuGroup;this.currentGroupIdx=groupIdx}};MenuContainer.fn._addOneMenu=function(menu){var $menuNormal=menu.$domNormal;var $menuSelected=menu.$domSelected;var $menuGroup=this.$currentGroup;var $item=$('<div class="menu-item clearfix"></div>');$menuSelected.hide();$item.append($menuNormal).append($menuSelected);$menuGroup.append($item);return $item}});_e(function(E,$){var Menu=function(opt){this.editor=opt.editor;this.id=opt.id;this.title=opt.title;this.$domNormal=opt.$domNormal;this.$domSelected=opt.$domSelected||opt.$domNormal;this.commandName=opt.commandName;this.commandValue=opt.commandValue;this.commandNameSelected=opt.commandNameSelected||opt.commandName;this.commandValueSelected=opt.commandValueSelected||opt.commandValue};Menu.fn=Menu.prototype;E.Menu=Menu});_e(function(E,$){var Menu=E.Menu;Menu.fn.initUI=function(){var editor=this.editor;var uiConfig=editor.UI.menus;var menuId=this.id;var menuUI=uiConfig[menuId];if(this.$domNormal&&this.$domSelected){return}if(menuUI==null){E.warn('editor.UI配置中，没有菜单 "'+menuId+'" 的UI配置，只能取默认值');menuUI=uiConfig["default"]}this.$domNormal=$(menuUI.normal);if(/^\./.test(menuUI.selected)){this.$domSelected=this.$domNormal.clone().addClass(menuUI.selected.slice(1))}else{this.$domSelected=$(menuUI.selected)}}});_e(function(E,$){var Menu=E.Menu;Menu.fn.render=function(groupIdx){this.initUI();var editor=this.editor;var menuContainer=editor.menuContainer;var $menuItem=menuContainer.appendMenu(groupIdx,this);var onRender=this.onRender;this._renderTip($menuItem);if(onRender&&typeof onRender==="function"){onRender.call(this)}};Menu.fn._renderTip=function($menuItem){var self=this;var editor=self.editor;var title=self.title;var $tip=$('<div class="menu-tip"></div>');$tip.append(title);$menuItem.append($tip);function show(){$tip.show()}function hide(){$tip.hide()}var timeoutId;var menuWidth=35;$menuItem.find("a").on("mouseenter",function(e){if(!self.active()&&!self.disabled()){var node=$(this),closestTip=node.siblings(".menu-tip"),currentWidth=closestTip.width();if(currentWidth>menuWidth){closestTip.css("margin-left",-currentWidth/4)}timeoutId=setTimeout(show,200)}}).on("mouseleave",function(e){timeoutId&&clearTimeout(timeoutId);hide()}).on("click",hide)};Menu.fn.bindEvent=function(){var self=this;var $domNormal=self.$domNormal;var $domSelected=self.$domSelected;var clickEvent=self.clickEvent;if(!clickEvent){clickEvent=function(e){var dropObj=self.dropPanel||self.dropList||self.modal;if(dropObj&&dropObj.show){if(dropObj.isShowing){dropObj.hide()}else{dropObj.show()}return}var editor=self.editor;var commandName;var commandValue;var selected=self.selected;if(selected){commandName=self.commandNameSelected;commandValue=self.commandValueSelected}else{commandName=self.commandName;commandValue=self.commandValue}if(commandName){editor.command(e,commandName,commandValue)}else{E.warn('菜单 "'+self.id+'" 未定义click事件');e.preventDefault()}}}var clickEventSelected=self.clickEventSelected||clickEvent;$domNormal.click(function(e){if(!self.disabled()){clickEvent.call(self,e);self.updateSelected()}e.preventDefault()});$domSelected.click(function(e){if(!self.disabled()){clickEventSelected.call(self,e);self.updateSelected()}e.preventDefault()})};Menu.fn.updateSelected=function(){var self=this;var editor=self.editor;var updateSelectedEvent=self.updateSelectedEvent;if(!updateSelectedEvent){updateSelectedEvent=function(){var self=this;var editor=self.editor;var commandName=self.commandName;var commandValue=self.commandValue;if(commandValue){if(editor.queryCommandValue(commandName).toLowerCase()===commandValue.toLowerCase()){return true}}else if(editor.queryCommandState(commandName)){return true}return false}}var result=updateSelectedEvent.call(self);result=!!result;self.changeSelectedState(result)};Menu.fn.changeSelectedState=function(state){var self=this;var selected=self.selected;if(state!=null&&typeof state==="boolean"){if(selected===state){return}self.selected=state;if(state){self.$domNormal.hide();self.$domSelected.show()}else{self.$domNormal.show();self.$domSelected.hide()}}};Menu.fn.active=function(active){if(active==null){return this._activeState}this._activeState=active};Menu.fn.activeStyle=function(active){var selected=this.selected;var $dom=this.$domNormal;var $domSelected=this.$domSelected;if(active){$dom.addClass("active");$domSelected.addClass("active")}else{$dom.removeClass("active");$domSelected.removeClass("active")}this.active(active)};Menu.fn.disabled=function(opt){if(opt==null){return!!this._disabled}if(this._disabled===opt){return}var $dom=this.$domNormal;var $domSelected=this.$domSelected;if(opt){$dom.addClass("disable");$domSelected.addClass("disable")}else{$dom.removeClass("disable");$domSelected.removeClass("disable")}this._disabled=opt}});_e(function(E,$){var DropList=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.data=opt.data;this.tpl=opt.tpl;this.selectorForELemCommand=opt.selectorForELemCommand;this.beforeEvent=opt.beforeEvent;

this.afterEvent=opt.afterEvent;this.init()};DropList.fn=DropList.prototype;E.DropList=DropList});_e(function(E,$){var DropList=E.DropList;DropList.fn.init=function(){var self=this;self.initDOM();self.bindEvent();self.initHideEvent()};DropList.fn.initDOM=function(){var self=this;var data=self.data;var tpl=self.tpl||"<span>{#title}</span>";var $list=$('<div class="wangEditor-drop-list clearfix"></div>');var itemContent;var $item;$.each(data,function(commandValue,title){itemContent=tpl.replace(/{#commandValue}/gi,commandValue).replace(/{#title}/gi,title);$item=$('<a href="#" commandValue="'+commandValue+'"></a>');$item.append(itemContent);$list.append($item)});self.$list=$list};DropList.fn.bindEvent=function(){var self=this;var editor=self.editor;var menu=self.menu;var commandName=menu.commandName;var selectorForELemCommand=self.selectorForELemCommand;var $list=self.$list;var beforeEvent=self.beforeEvent;var afterEvent=self.afterEvent;$list.on("click","a[commandValue]",function(e){if(beforeEvent&&typeof beforeEvent==="function"){beforeEvent.call(e)}var commandValue=$(e.currentTarget).attr("commandValue");if(menu.selected&&editor.isRangeEmpty()&&selectorForELemCommand){editor.commandForElem(selectorForELemCommand,e,commandName,commandValue)}else{editor.command(e,commandName,commandValue)}if(afterEvent&&typeof afterEvent==="function"){afterEvent.call(e)}})};DropList.fn.initHideEvent=function(){var self=this;var thisList=self.$list.get(0);this.editor.$editorContainer.on("click",function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}if(thisList===trigger||$.contains(thisList,trigger)){return}self.hide()});E.$window.scroll(function(){self.hide()});E.$window.on("resize",function(){self.hide()})}});_e(function(E,$){var DropList=E.DropList;DropList.fn._render=function(){var self=this;var editor=self.editor;var $list=self.$list;editor.$editorContainer.append($list);editor.$editorContainer.find('a[href="#"]').attr("href","javascript:void(0)");self.rendered=true};DropList.fn._position=function(){var self=this;var $list=self.$list;var editor=self.editor;var menu=self.menu;var $menuContainer=editor.menuContainer.$menuContainer;var $menuDom=menu.selected?menu.$domSelected:menu.$domNormal;var menuPosition=$menuDom.offsetParent().position();var menuTop=menuPosition.top;var menuLeft=menuPosition.left;var menuHeight=$menuDom.offsetParent().height();var menuWidth=$menuDom.offsetParent().width();var listWidth=$list.outerWidth();var txtWidth=editor.txt.$txt.outerWidth();var top=menuTop+menuHeight;var left=menuLeft+menuWidth/2;var marginLeft=0-menuWidth/2;var valWithTxt=left+listWidth-txtWidth;if(valWithTxt>-10){marginLeft=marginLeft-valWithTxt-10}$list.css({top:top,left:left,"margin-left":marginLeft});if(editor._isMenufixed){top=top+($menuContainer.offset().top+$menuContainer.outerHeight()-$list.offset().top);$list.css({top:top})}};DropList.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}var $list=self.$list;$list.show();self._position();self.isShowing=true;menu.activeStyle(true)};DropList.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}var $list=self.$list;$list.hide();self.isShowing=false;menu.activeStyle(false)}});_e(function(E,$){var DropPanel=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.$content=opt.$content;this.width=opt.width||200;this.height=opt.height;this.onRender=opt.onRender;this.init()};DropPanel.fn=DropPanel.prototype;E.DropPanel=DropPanel});_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn.init=function(){var self=this;self.initDOM();self.initHideEvent()};DropPanel.fn.initDOM=function(){var self=this;var $content=self.$content;var width=self.width;var height=self.height;var $panel=$('<div class="wangEditor-drop-panel clearfix"></div>');var $triangle=$('<div class="tip-triangle"></div>');$panel.css({width:width,height:height?height:"auto"});$panel.append($triangle);$panel.append($content);self.$panel=$panel;self.$triangle=$triangle};DropPanel.fn.initHideEvent=function(){var self=this;var thisPanle=self.$panel.get(0);this.editor.$editorContainer.on("click",function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}if(thisPanle===trigger||$.contains(thisPanle,trigger)){return}self.hide()});E.$window.scroll(function(e){self.hide()});E.$window.on("resize",function(){self.hide()})}});_e(function(E,$){var DropPanel=E.DropPanel;DropPanel.fn._render=function(){var self=this;var onRender=self.onRender;var editor=self.editor;var $panel=self.$panel;editor.$editorContainer.append($panel);editor.$editorContainer.find('a[href="#"]').attr("href","javascript:void(0)");onRender&&onRender.call(self);self.rendered=true};DropPanel.fn._position=function(){var self=this;var $panel=self.$panel;var $triangle=self.$triangle;var editor=self.editor;var $menuContainer=editor.menuContainer.$menuContainer;var menu=self.menu;var $menuDom=menu.selected?menu.$domSelected:menu.$domNormal;var menuPosition={};if($menuDom.parents(".wangEditor-drop-panel").length){var $menuDomPanel=$menuDom.parents(".wangEditor-drop-panel").position();var marginLeft=$menuDom.parents(".wangEditor-drop-panel").css("marginLeft");menuPosition=$menuDom.offsetParent().position();menuPosition.top+=$menuDomPanel.top;menuPosition.left+=$menuDomPanel.left+parseFloat(marginLeft)}else{menuPosition=$menuDom.offsetParent().position()}var menuTop=menuPosition.top;var menuLeft=menuPosition.left;var menuHeight=$menuDom.offsetParent().height();var menuWidth=$menuDom.offsetParent().width();var panelWidth=$panel.outerWidth();var txtWidth=editor.txt.$txt.outerWidth();var top=menuTop+menuHeight;var left=menuLeft+menuWidth/2;var marginLeft=0-panelWidth/2;var marginLeft2=marginLeft;if(0-marginLeft>left-10){marginLeft=0-(left-10)}var valWithTxt=left+panelWidth+marginLeft-txtWidth;if(valWithTxt>-10){marginLeft=marginLeft-valWithTxt-10}$panel.css({top:top,left:left,"margin-left":marginLeft});if(editor._isMenufixed){top=top+($menuContainer.offset().top+$menuContainer.outerHeight()-$panel.offset().top);$panel.css({top:top})}$triangle.css({"margin-left":marginLeft2-marginLeft-5})};DropPanel.fn.focusFirstInput=function(){var self=this;var $panel=self.$panel;$panel.find("input[type=text],textarea").each(function(){var $input=$(this);if($input.attr("disabled")==null){$input.focus();return false}})};DropPanel.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}var $panel=self.$panel;$panel.show();self._position();self.isShowing=true;menu.activeStyle(true);if(E.w3cRange){self.focusFirstInput()}else{E.placeholderForIE8($panel)}};DropPanel.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}var $panel=self.$panel;$panel.hide();self.isShowing=false;menu.activeStyle(false)}});_e(function(E,$){var Modal=function(editor,menu,opt){this.editor=editor;this.menu=menu;this.$content=opt.$content;this.init()};Modal.fn=Modal.prototype;E.Modal=Modal});_e(function(E,$){var Modal=E.Modal;Modal.fn.init=function(){var self=this;self.initDom();self.initHideEvent()};Modal.fn.initDom=function(){var self=this;var $content=self.$content;var $modal=$('<div class="wangEditor-modal"></div>');var $close=$('<div class="wangEditor-modal-close"><i class="wangeditor-menu-img-cancel-circle"></i></div>');$modal.append($close);$modal.append($content);self.$modal=$modal;self.$close=$close};Modal.fn.initHideEvent=function(){var self=this;var $close=self.$close;var modal=self.$modal.get(0);$close.click(function(){self.hide()});E.$body.on("click",function(e){if(!self.isShowing){return}var trigger=e.target;var menu=self.menu;var menuDom;if(menu){if(menu.selected){menuDom=menu.$domSelected.get(0)}else{menuDom=menu.$domNormal.get(0)}if(menuDom===trigger||$.contains(menuDom,trigger)){return}}if(modal===trigger||$.contains(modal,trigger)){return}self.hide()})}});_e(function(E,$){var Modal=E.Modal;Modal.fn._render=function(){var self=this;var editor=self.editor;var $modal=self.$modal;$modal.css("z-index",editor.config.zindex+10+"");E.$body.append($modal);self.rendered=true};Modal.fn._position=function(){var self=this;var $modal=self.$modal;var top=$modal.offset().top;var width=$modal.outerWidth();var height=$modal.outerHeight();var marginLeft=0-width/2;var marginTop=0-height/2;var sTop=E.$window.scrollTop();if(height/2>top){marginTop=0-top}$modal.css({"margin-left":marginLeft+"px","margin-top":marginTop+sTop+"px"})};Modal.fn.show=function(){var self=this;var menu=self.menu;if(!self.rendered){self._render()}if(self.isShowing){return}self.isShowing=true;var $modal=self.$modal;$modal.show();self._position();menu&&menu.activeStyle(true)};Modal.fn.hide=function(){var self=this;var menu=self.menu;if(!self.isShowing){return}self.isShowing=false;var $modal=self.$modal;$modal.hide();menu&&menu.activeStyle(false)}});_e(function(E,$){var Txt=function(editor){this.editor=editor;this.init()};Txt.fn=Txt.prototype;E.Txt=Txt});_e(function(E,$){var Txt=E.Txt;Txt.fn.init=function(){var self=this;var editor=self.editor;var $valueContainer=editor.$valueContainer;var currentValue=editor.getInitValue();var $txt;if($valueContainer.get(0).nodeName==="DIV"){$txt=$valueContainer;$txt.addClass("wangEditor-txt");$txt.attr("contentEditable","true")}else{$txt=$('<div class="wangEditor-txt" contentEditable="true">'+currentValue+"</div>")}editor.ready(function(){self.insertEmptyP()});self.$txt=$txt;self.contentEmptyHandle();self.bindEnterForDiv();self.bindEnterForText();self.bindTabEvent();self.bindPasteFilter();self.bindFormatText();self.bindHtml()};Txt.fn.contentEmptyHandle=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var $p;$txt.on("keydown",function(e){if(e.keyCode!==8){return}var txtHtml=$.trim($txt.html().toLowerCase());if(txtHtml==="<p><br></p>"){e.preventDefault();return}});$txt.on("keyup",function(e){if(e.keyCode!==8){return}var txtHtml=$.trim($txt.html().toLowerCase());if(!txtHtml||txtHtml==="<br>"){$p=$("<p><br/></p>");$txt.html("");$txt.append($p);editor.restoreSelectionByElem($p.get(0))}})};Txt.fn.bindEnterForDiv=function(){var tags=E.config.legalTags;var self=this;var editor=self.editor;var $txt=self.$txt;var $keydownDivElem;function divHandler(){if(!$keydownDivElem){return}var $pElem=$("<p>"+$keydownDivElem.html()+"</p>");$keydownDivElem.after($pElem);$keydownDivElem.remove()}$txt.on("keydown keyup",function(e){if(e.keyCode!==13){return}var rangeElem=editor.getRangeElem();var targetElem=editor.getLegalTags(rangeElem);var $targetElem;var $pElem;if(!targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,"div");if(!targetElem){return}$targetElem=$(targetElem);if(e.type==="keydown"){$keydownDivElem=$targetElem;setTimeout(divHandler,0)}if(e.type==="keyup"){$pElem=$("<p>"+$targetElem.html()+"</p>");$targetElem.after($pElem);$targetElem.remove();editor.restoreSelectionByElem($pElem.get(0),"start")}}})};Txt.fn.bindEnterForText=function(){var self=this;var $txt=self.$txt;var handle;$txt.on("keyup",function(e){if(e.keyCode!==13){return}if(!handle){handle=function(){self.wrapImgAndText()}}setTimeout(handle)})};Txt.fn.bindTabEvent=function(){var self=this;var editor=self.editor;var $txt=self.$txt;$txt.on("keydown",function(e){if(e.keyCode!==9){return}if(editor.queryCommandSupported("insertHtml")){editor.command(e,"insertHtml","&nbsp;&nbsp;&nbsp;&nbsp;")}})};Txt.fn.bindPasteFilter=function(){var self=this;var editor=self.editor;var resultHtml="";var $txt=self.$txt;var legalTags=editor.config.legalTags;var legalTagArr=legalTags.split(",");$txt.on("paste",function(e){if(!editor.config.pasteFilter){return}editor.hasPasteImg=false;var currentNodeName=editor.getRangeElem().nodeName;if(currentNodeName==="TD"||currentNodeName==="TH"){return}resultHtml="";var pasteHtml,$paste;var data=e.clipboardData||e.originalEvent.clipboardData;var ieData=window.clipboardData;if(editor.config.pasteText){if(data&&data.getData){pasteHtml=data.getData("text/plain")}else if(ieData&&ieData.getData){pasteHtml=ieData.getData("text")}else{return}if(pasteHtml){resultHtml="<p>"+pasteHtml+"</p>"}}else{if(data&&data.getData){pasteHtml=data.getData("text/html");if(pasteHtml){var paste=$(pasteHtml).clone(true);$paste=$("<div></div>").append(paste);handle($paste.get(0))}else{pasteHtml=data.getData("text/plain");if(pasteHtml){pasteHtml=pasteHtml.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>");resultHtml="<p>"+pasteHtml+"</p>";resultHtml=resultHtml.replace(/<p>(https?:\/\/.*?)<\/p>/gi,function(match,link){return'<p><a href="'+link+'" target="_blank">'+link+"</p>"})}}}else if(ieData&&ieData.getData){resultHtml=ieData.getData("text");if(!resultHtml){return}resultHtml="<p>"+resultHtml+"</p>";resultHtml=resultHtml.replace(new RegExp("\n","g"),"</p><p>")}else{return}}if(resultHtml){editor.command(e,"insertHtml",resultHtml);self.clearEmptyOrNestP()}});function handle(elem){if(!elem||!elem.nodeType||!elem.nodeName){return}var $elem;var nodeName=elem.nodeName.toLowerCase();var nodeType=elem.nodeType;var childNodesClone;if(nodeType!==3&&nodeType!==1){return}$elem=$(elem);if(nodeName==="div"){childNodesClone=[];$.each(elem.childNodes,function(index,item){childNodesClone.push(item)});$.each(childNodesClone,function(){handle(this)});return}if(legalTagArr.indexOf(nodeName)>=0){resultHtml+=getResult(elem)}else if(nodeType===3){resultHtml+="<p>"+codeTransferred(elem.textContent)+"</p>"}else if(nodeName==="br"){resultHtml+="<br/>"}else{if(["meta","style","script","object","form","iframe","hr"].indexOf(nodeName)>=0){return}$elem=$(removeAttrs(elem));resultHtml+=$("<div>").append($elem.clone()).html()}}function codeTransferred(srt){srt=srt.replace(/[ ]/g,"&nbsp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"</p><p>");return srt}function getResult(elem){var nodeName=elem.nodeName.toLowerCase();var $elem;var htmlForP="";var htmlForLi="";if(["blockquote"].indexOf(nodeName)>=0){$elem=$(elem);return"<"+nodeName+">"+$elem.text()+"</"+nodeName+">"}else if(["p","h1","h2","h3","h4","h5"].indexOf(nodeName)>=0){elem=removeAttrs(elem);$elem=$(elem);htmlForP=$elem.html();htmlForP=htmlForP.replace(/<.*?>/gi,function(tag){if(tag==="</a>"||tag.indexOf("<a ")===0||tag.indexOf("<img ")===0){return tag}else{return""}});return"<"+nodeName+">"+htmlForP+"</"+nodeName+">"}else if(["ul","ol"].indexOf(nodeName)>=0){$elem=$(elem);$elem.children().each(function(){var $li=$(removeAttrs(this));var html=$li.html();var elemName=this.nodeName.toUpperCase();html=html.replace(/<.*?>/gi,function(tag){if(tag==="</a>"||tag.indexOf("<a ")===0||tag.indexOf("<img ")===0||tag.indexOf("<li")===0||tag==="</li>"){return tag}else{return""}});htmlForLi+=elemName=="OL"?html:"<li>"+html+"</li>"});return"<"+nodeName+">"+htmlForLi+"</"+nodeName+">"}else{$elem=$(removeAttrs(elem));return $("<div>").append($elem).html()}}function removeAttrs(elem){var attrs=elem.attributes||[];var attrNames=[];var exception=["href","target","src","alt","rowspan","colspan"];$.each(attrs,function(key,attr){if(attr&&attr.nodeType===2){attrNames.push(attr.nodeName)}});$.each(attrNames,function(key,attr){if(exception.indexOf(attr)<0){elem.removeAttribute(attr)}});if(elem.nodeName.toUpperCase()=="IMG"){$(elem).css("maxWidth","100%");editor.hasPasteImg=true}var children=elem.childNodes;if(children.length){$.each(children,function(key,value){removeAttrs(value)})}return elem}};Txt.fn.bindFormatText=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var legalTags=E.config.legalTags;var legalTagArr=legalTags.split(",");var length=legalTagArr.length;var regArr=[];$.each(legalTagArr,function(k,tag){var reg=">\\s*<("+tag+")>";regArr.push(new RegExp(reg,"ig"))});regArr.push(new RegExp(">\\s*<(li)>","ig"));regArr.push(new RegExp(">\\s*<(tr)>","ig"));regArr.push(new RegExp(">\\s*<(code)>","ig"));$txt.formatText=function(){var $temp=$("<div>");var html=$txt.html();html=html.replace(/\s*</gi,"<");$.each(regArr,function(k,reg){if(!reg.test(html)){return}html=html.replace(reg,function(matchStr,tag){return">\n<"+tag+">"})});$temp.html(html);return $temp.text()}};Txt.fn.bindHtml=function(){var self=this;var editor=self.editor;var $txt=self.$txt;var $valueContainer=editor.$valueContainer;var valueNodeName=editor.valueNodeName;$txt.html=function(html){var result;if(valueNodeName==="div"){result=$.fn.html.call($txt,html)}if(html===undefined){result=$.fn.html.call($txt);result=result.replace(/(href|src)\=\"(.*)\"/gim,function(a,b,c){return b+'="'+c.replace("&amp;","&")+'"'})}else{result=$.fn.html.call($txt,html);$valueContainer.val(html)}if(html===undefined){return result}else{$txt.change()}}}});_e(function(E,$){var Txt=E.Txt;var txtChangeEventNames="propertychange change click keyup input paste";Txt.fn.render=function(){var $txt=this.$txt;var $editorContainer=this.editor.$editorContainer;$editorContainer.append($txt)};Txt.fn.initHeight=function(){var editor=this.editor;var $txt=this.$txt;var valueContainerHeight=editor.$valueContainer.height();var menuHeight=30;var txtHeight=valueContainerHeight-menuHeight;var config=editor.config;txtHeight=txtHeight<50?50:txtHeight;txtHeight=config.height?config.height:txtHeight;$txt.css({height:txtHeight,"max-height":config.maxHeight?config.maxHeight+30:""});editor.valueContainerHeight=valueContainerHeight;this.initMaxHeight(txtHeight,menuHeight)};Txt.fn.initMaxHeight=function(txtHeight,menuHeight){var editor=this.editor;var $menuContainer=editor.menuContainer.$menuContainer;var $txt=this.$txt;var $wrap=$("<div>");if(window.getComputedStyle&&"max-height"in window.getComputedStyle($txt.get(0))){var maxHeight=parseInt(editor.$valueContainer.css("max-height"));if(isNaN(maxHeight)){return}editor.useMaxHeight=true;$wrap.css({"max-height":maxHeight-menuHeight+"px","overflow-y":"auto"});$txt.css({height:"auto","overflow-y":"visible","min-height":txtHeight+"px"});$wrap.on("scroll",function(){if($txt.parent().scrollTop()>10){$menuContainer.addClass("wangEditor-menu-shadow")}else{$menuContainer.removeClass("wangEditor-menu-shadow")}});$txt.wrap($wrap)}};Txt.fn.saveSelectionEvent=function(){var $txt=this.$txt;var editor=this.editor;var timeoutId;var dt=Date.now();function save(){editor.saveSelection()}function saveSync(){if(Date.now()-dt<100){return}dt=Date.now();save()}function saveAync(){if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(save,300)}$txt.on(txtChangeEventNames+" focus blur",function(e){saveSync();saveAync()});$txt.on("mousedown",function(){$txt.on("mouseleave.saveSelection",function(e){saveSync();saveAync();editor.updateMenuStyle()})}).on("mouseup",function(){$txt.off("mouseleave.saveSelection")})};Txt.fn.updateValueEvent=function(){var $txt=this.$txt;var editor=this.editor;var timeoutId,oldValue=$txt.html();function doOnchange(){var val=$txt.html();if(oldValue===val){return}if(editor.onchange&&typeof editor.onchange==="function"){editor.onchange.call(editor)}editor.updateValue();oldValue=val}$txt.on(txtChangeEventNames,function(e){if(oldValue==null){oldValue=$txt.html()}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(doOnchange,100)})};Txt.fn.updateMenuStyleEvent=function(){var $txt=this.$txt;var editor=this.editor;$txt.on(txtChangeEventNames,function(e){editor.updateMenuStyle()})};Txt.fn.insertEmptyP=function(){var $txt=this.$txt;var $children=$txt.children();if($children.length===0){$txt.append($("<p><br></p>"));return}if($.trim($children.last().html()).toLowerCase()!=="<br>"){$txt.append($("<p><br></p>"))}};Txt.fn.wrapImgAndText=function(){var $txt=this.$txt;var $imgs=$txt.children("img");var txt=$txt[0];var childNodes=txt.childNodes;var childrenLength=childNodes.length;var i,childNode,p;$imgs.length&&$imgs.each(function(){$(this).wrap("<p>")});for(i=0;i<childrenLength;i++){childNode=childNodes[i];if(childNode.nodeType===3&&childNode.textContent&&$.trim(childNode.textContent)){$(childNode).wrap("<p>")}}};Txt.fn.clearEmptyOrNestP=function(){var $txt=this.$txt;var $pList=$txt.find("p");$pList.each(function(index,item){var $p=$(this);var $children=$p.children();var childrenLength=$children.length;var $firstChild;var content=$.trim($p.html());if(!content){$p.remove();return}if(!index&&(content.toLowerCase()=="<br>"||content.toLowerCase()=="<br/>")){$p.remove();return}if(childrenLength===1){$firstChild=$children.first();if($firstChild.get(0)&&$firstChild.get(0).nodeName==="P"){$p.html($firstChild.html())}}})};Txt.fn.scrollTop=function(val){var self=this;var editor=self.editor;var $txt=self.$txt;if(editor.useMaxHeight){return $txt.parent().scrollTop(val)}else{return $txt.scrollTop(val)}};Txt.fn.showHeightOnHover=function(){var editor=this.editor;var $editorContainer=editor.$editorContainer;var menuContainer=editor.menuContainer;var $txt=this.$txt;var $tip=$('<i class="height-tip"><i>');var isTipInTxt=false;function addAndShowTip($target){if(!isTipInTxt){$editorContainer.append($tip);isTipInTxt=true}var txtTop=$txt.position().top;var txtHeight=$txt.outerHeight();var height=$target.height();var top=$target.position().top;var marginTop=parseInt($target.css("margin-top"),10);var paddingTop=parseInt($target.css("padding-top"),10);var marginBottom=parseInt($target.css("margin-bottom"),10);var paddingBottom=parseInt($target.css("padding-bottom"),10);var resultHeight=height+paddingTop+marginTop+paddingBottom+marginBottom;var resultTop=top+menuContainer.height();$tip.css({height:height+paddingTop+marginTop+paddingBottom+marginBottom,top:top+menuContainer.height()})}function removeTip(){if(!isTipInTxt){return}$tip.remove();isTipInTxt=false}$txt.on("mouseenter","ul,ol,blockquote,p,h1,h2,h3,h4,h5,table,pre",function(e){addAndShowTip($(e.currentTarget))}).on("mouseleave",function(){removeTip()})}});_e(function(E,$){if(!Array.prototype.indexOf){Array.prototype.indexOf=function(elem){var i=0,length=this.length;for(;i<length;i++){if(this[i]===elem){return i}}return-1};Array.prototype.lastIndexOf=function(elem){var length=this.length;for(length=length-1;length>=0;length--){if(this[length]===elem){return length}}return-1}}if(!Date.now){Date.now=function(){return(new Date).valueOf()}}var console=window.console;var emptyFn=function(){};$.each(["info","log","warn","error"],function(key,value){if(console==null){E[value]=emptyFn}else{E[value]=function(info){if(E.config&&E.config.printLog){console[value]("wangEditor提示: "+info)}}}});E.random=function(){return Math.random().toString().slice(2)};E.placeholder="placeholder"in document.createElement("input");E.placeholderForIE8=function($container){if(E.placeholder){return}$container.find("input[placeholder]").each(function(){var $input=$(this);var placeholder=$input.attr("placeholder");if($input.val()===""){$input.css("color","#666");$input.val(placeholder);$input.on("focus.placeholder click.placeholder",function(){$input.val("");$input.css("color","#333");$input.off("focus.placeholder click.placeholder")})}})}});_e(function(E,$){E.langs={};E.langs["zh-cn"]={bold:"粗体",underline:"下划线",italic:"斜体",forecolor:"文字颜色",bgcolor:"背景色",strikethrough:"删除线",eraser:"清空格式",source:"源码",quote:"引用",fontfamily:"字体",fontsize:"字号",head:"标题",orderlist:"有序列表",unorderlist:"无序列表",alignleft:"左对齐",aligncenter:"居中",alignright:"右对齐",link:"链接",text:"文本",submit:"提交",cancel:"取消",unlink:"取消链接",table:"表格",emotion:"表情",img:"图片",video:"视频",width:"宽",height:"高",location:"位置",loading:"加载中",searchlocation:"搜索位置",dynamicMap:"动态地图",clearLocation:"清除位置",langDynamicOneLocation:"动态地图只能显示一个位置",insertcode:"插入代码",undo:"撤销",redo:"重复",fullscreen:"全屏",openLink:"打开链接"};E.langs.en={bold:"Bold",underline:"Underline",italic:"Italic",forecolor:"Color",bgcolor:"Backcolor",strikethrough:"Strikethrough",eraser:"Eraser",source:"Codeview",quote:"Quote",fontfamily:"Font family",fontsize:"Font size",head:"Head",orderlist:"Ordered list",unorderlist:"Unordered list",alignleft:"Align left",aligncenter:"Align center",alignright:"Align right",link:"Insert link",text:"Text",submit:"Submit",cancel:"Cancel",unlink:"Unlink",table:"Table",emotion:"Emotions",img:"Image",video:"Video",width:"width",height:"height",location:"Location",loading:"Loading",searchlocation:"search",dynamicMap:"Dynamic",clearLocation:"Clear",langDynamicOneLocation:"Only one location in dynamic map",insertcode:"Insert Code",undo:"Undo",redo:"Redo",fullscreen:"Full screnn",openLink:"open link"}});_e(function(E,$){E.config={};E.config.zindex=1e4;E.config.printLog=false;E.config.menuFixed=0;E.config.jsFilter=true;E.config.legalTags="p,h1,h2,h3,h4,h5,h6,blockquote,table,ul,ol,pre";E.config.lang=E.langs["zh-cn"];E.config.menus=["source","|","bold","underline","italic","strikethrough","eraser","forecolor","bgcolor","|","quote","fontfamily","fontsize","head","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","table","emotion","|","img","video","location","insertcode","|","undo","redo","fullscreen"];E.config.colors={"#880000":"暗红色","#800080":"紫色","#ff0000":"红色","#ff00ff":"鲜粉色","#000080":"深蓝色","#0000ff":"蓝色","#00ffff":"湖蓝色","#008080":"蓝绿色","#008000":"绿色","#808000":"橄榄色","#00ff00":"浅绿色","#ffcc00":"橙黄色","#808080":"灰色","#c0c0c0":"银色","#000000":"黑色","#ffffff":"白色"};E.config.familys=["宋体","黑体","楷体","微软雅黑","Arial","Verdana","Georgia","Times New Roman","Microsoft JhengHei","Trebuchet MS","Courier New","Impact","Comic Sans MS","Consolas"];E.config.fontsizes={1:"12px",2:"14px",3:"16px",4:"18px",5:"24px",6:"32px",7:"48px"};E.config.emotionsShow="icon";E.config.emotions={weibo:{title:"微博表情",data:[{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/7a/shenshou_thumb.gif",value:"[草泥马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/60/horse2_thumb.gif",value:"[神马]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/fuyun_thumb.gif",value:"[浮云]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c9/geili_thumb.gif",value:"[给力]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/f2/wg_thumb.gif",value:"[围观]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/70/vw_thumb.gif",value:"[威武]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/6e/panda_thumb.gif",value:"[熊猫]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/81/rabbit_thumb.gif",value:"[兔子]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/bc/otm_thumb.gif",value:"[奥特曼]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/15/j_thumb.gif",value:"[囧]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/89/hufen_thumb.gif",value:"[互粉]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/c4/liwu_thumb.gif",value:"[礼物]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/ac/smilea_thumb.gif",value:"[呵呵]"},{icon:"http://img.t.sinajs.cn/t35/style/images/common/face/ext/normal/0b/tootha_thumb.gif",value:"[哈哈]"}]}};E.config.mapAk="TVhjYjq1ICT2qqL5LdS8mwas";E.config.uploadImgUrl="";E.config.uploadTimeout=20*1e3;E.config.uploadImgFns={};E.config.customUpload=false;E.config.uploadParams={};E.config.uploadHeaders={};E.config.hideLinkImg=false;E.config.pasteFilter=true;E.config.pasteText=false;E.config.codeDefaultLang="javascript"});_e(function(E,$){E.UI={};E.UI.menus={"default":{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-pencil"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-brush"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-strikethrough"></i></a>',selected:".selected"},eraser:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-eraser"></i></a>',selected:".selected"},quote:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-quotes-left"></i></a>',selected:".selected"},source:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-code"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-font2"></i></a>',selected:".selected"},fontsize:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-text-height"></i></a>',selected:".selected"},head:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-header"></i></a>',selected:".selected"},orderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-numbered"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-list-bullet"></i></a>',selected:".selected"},alignleft:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-align-right"></i></a>',selected:".selected"},link:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-unlink"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-table"></i></a>',selected:".selected"},emotion:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-happy"></i></a>',selected:".selected"},img:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-picture"></i></a>',selected:".selected"},video:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-play"></i></a>',selected:".selected"},location:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-location"></i></a>',selected:".selected"},insertcode:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-terminal"></i></a>',selected:".selected"},undo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-ccw"></i></a>',selected:".selected"},redo:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-cw"></i></a>',selected:".selected"},fullscreen:{normal:'<a href="#" tabindex="-1"><i class="wangeditor-menu-img-enlarge2"></i></a>',selected:'<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-shrink2"></i></a>'}}});_e(function(E,$){E.fn.initDefaultConfig=function(){var editor=this;editor.config=$.extend({},E.config);editor.UI=$.extend({},E.UI)}});_e(function(E,$){E.fn.addEditorContainer=function(){this.$editorContainer=$('<div class="wangEditor-container" data-name="editor-container"></div>')}});_e(function(E,$){E.fn.addTxt=function(){var editor=this;var txt=new E.Txt(editor);editor.txt=txt}});_e(function(E,$){E.fn.addMenuContainer=function(){var editor=this;editor.menuContainer=new E.MenuContainer(editor)}});_e(function(E,$){E.createMenuFns=[];E.createMenu=function(fn){E.createMenuFns.push(fn)};E.fn.addMenus=function(){var editor=this;var menuIds=editor.config.menus;function check(menuId){if(menuIds.indexOf(menuId)>=0){return true}return false}$.each(E.createMenuFns,function(k,createMenuFn){createMenuFn.call(editor,check)})}});_e(function(E,$){E.createMenu(function(check){var menuId="bold";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.bold,commandName:"Bold"});menu.clickEventSelected=function(e){
var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,"Bold")}else{editor.commandForElem("b,strong,h1,h2,h3,h4,h5",e,"Bold")}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="underline";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.underline,commandName:"Underline"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,"Underline")}else{editor.commandForElem("u,a",e,"Underline")}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="italic";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.italic,commandName:"Italic"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,"Italic")}else{editor.commandForElem("i",e,"Italic")}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="forecolor";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configColors=editor.config.colors;var menu=new E.Menu({editor:editor,id:menuId,title:lang.forecolor});var $content=$("<div></div>");$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ',">●</a>"].join(""))});$content.on("click","a[commandValue]",function(e){var $elem=$(this);var commandValue=$elem.attr("commandValue");if(menu.selected&&editor.isRangeEmpty()){editor.commandForElem("font[color]",e,"forecolor",commandValue)}else{editor.command(e,"forecolor",commandValue)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"font[color]");if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="bgcolor";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configColors=editor.config.colors;function checkElemFn(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&cssText.indexOf("background-color:")>=0){return true}}return false}var menu=new E.Menu({editor:editor,id:menuId,title:lang.bgcolor});var $content=$("<div></div>");$.each(configColors,function(k,v){$content.append(['<a href="#" class="color-item"','    title="'+v+'" commandValue="'+k+'" ','    style="color: '+k+'" ',">●</a>"].join(""))});$content.on("click","a[commandValue]",function(e){var $elem=$(this);var commandValue=$elem.attr("commandValue");if(menu.selected&&editor.isRangeEmpty()){editor.commandForElem({selector:"span,font",check:checkElemFn},e,"BackColor",commandValue)}else{editor.command(e,"BackColor",commandValue)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:125});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"span,font",checkElemFn);if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="strikethrough";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.strikethrough,commandName:"StrikeThrough"});menu.clickEventSelected=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,"StrikeThrough")}else{editor.commandForElem("strike",e,"StrikeThrough")}};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="eraser";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.eraser,commandName:"RemoveFormat"});menu.clickEvent=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,"RemoveFormat");return}var $clearElem;function commandFn(){var editor=this;var rangeElem;var pElem,$pElem;var quoteElem,$quoteElem;var listElem,$listElem;rangeElem=editor.getRangeElem();quoteElem=editor.getSelfOrParentByName(rangeElem,"blockquote");if(quoteElem){$quoteElem=$(quoteElem);$clearElem=$("<p>"+$quoteElem.text()+"</p>");$quoteElem.after($clearElem).remove()}pElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5");if(pElem){$pElem=$(pElem);$clearElem=$("<p>"+$pElem.text()+"</p>");$pElem.after($clearElem).remove()}listElem=editor.getSelfOrParentByName(rangeElem,"ul,ol");if(listElem){$listElem=$(listElem);$clearElem=$("<p>"+$listElem.text()+"</p>");$listElem.after($clearElem).remove()}}function callback(){var editor=this;if($clearElem){editor.restoreSelectionByElem($clearElem.get(0))}}editor.customCommand(e,commandFn,callback)};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="source";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var txtHtml;var menu=new E.Menu({editor:editor,id:menuId,title:lang.source});menu.isShowCode=false;function updateValue(){var $code=menu.$codeTextarea;var $txt=editor.txt.$txt;var value=$.trim($code.val());if(!value){value="<p><br></p>"}if(editor.config.jsFilter){value=value.replace(/<script[\s\S]*?<\/script>/gi,"")}try{$txt.html(value)}catch(ex){}}menu.clickEvent=function(e){var self=this;var editor=self.editor;var $txt=editor.txt.$txt;var txtOuterHeight=$txt.outerHeight();var txtHeight=$txt.height();if(!self.$codeTextarea){self.$codeTextarea=$('<textarea class="code-textarea"></textarea>')}var $code=self.$codeTextarea;$code.css({height:txtHeight,"margin-top":txtOuterHeight-txtHeight});$code.val($txt.html());$code.on("change",function(e){updateValue()});$txt.after($code).hide();$code.show();menu.isShowCode=true;this.updateSelected();editor.disableMenusExcept("source");txtHtml=$txt.html()};menu.clickEventSelected=function(e){var self=this;var editor=self.editor;var $txt=editor.txt.$txt;var $code=self.$codeTextarea;var value;if(!$code){return}updateValue();$code.after($txt).hide();$txt.show();menu.isShowCode=false;this.updateSelected();editor.enableMenusExcept("source");if($txt.html()!==txtHtml){if(editor.onchange&&typeof editor.onchange==="function"){editor.onchange.call(editor)}}};menu.updateSelectedEvent=function(){return this.isShowCode};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="quote";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.quote,commandName:"formatBlock",commandValue:"blockquote"});menu.clickEvent=function(e){var rangeElem=editor.getRangeElem();var $rangeElem;if(!rangeElem){e.preventDefault();return}var currentQuote=editor.getSelfOrParentByName(rangeElem,"blockquote");var $quote;if(currentQuote){e.preventDefault();return}rangeElem=editor.getLegalTags(rangeElem);$rangeElem=$(rangeElem);if(!$rangeElem.text()){return}if(!rangeElem){editor.command(e,"formatBlock","blockquote");return}function commandFn(){$quote=$("<p>"+$rangeElem.text()+"</p>");$rangeElem.after($quote).remove();$quote.wrap("<blockquote>")}function callback(){var editor=this;if($quote){editor.restoreSelectionByElem($quote.get(0))}}editor.customCommand(e,commandFn,callback)};menu.clickEventSelected=function(e){var rangeElem;var quoteElem;var $lastChild;rangeElem=editor.getRangeElem();quoteElem=editor.getSelfOrParentByName(rangeElem,"blockquote");if(!quoteElem){e.preventDefault();return}function commandFn(){var $quoteElem;var $children;$quoteElem=$(quoteElem);$children=$quoteElem.children();if($children.length){$children.each(function(k){var $item=$(this);if($item.get(0).nodeName==="P"){$quoteElem.after($item)}else{$quoteElem.after("<p>"+$item.text()+"</p>")}$lastChild=$item});$quoteElem.remove();return}}function callback(){var editor=this;if($lastChild){editor.restoreSelectionByElem($lastChild.get(0))}}editor.customCommand(e,commandFn,callback)};menu.updateSelectedEvent=function(){var self=this;var editor=self.editor;var rangeElem;rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote");if(rangeElem){return true}return false};editor.menus[menuId]=menu;editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var isPrevEnter=false;$txt.on("keydown",function(e){if(e.keyCode!==13){isPrevEnter=false;return}var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote");if(!rangeElem){isPrevEnter=false;return}if(!isPrevEnter){isPrevEnter=true;return}var currentRangeElem=editor.getRangeElem();var $currentRangeElem=$(currentRangeElem);if($currentRangeElem.length){$currentRangeElem.parent().after($currentRangeElem)}editor.restoreSelectionByElem(currentRangeElem,"start");isPrevEnter=false;e.preventDefault()})});editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var $rangeElem;function commandFn(){$rangeElem&&$rangeElem.remove()}function callback(){if(!$rangeElem){return}var $prev=$rangeElem.prev();if($prev.length){editor.restoreSelectionByElem($prev.get(0))}else{editor.initSelection()}}$txt.on("keydown",function(e){if(e.keyCode!==8){return}var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"blockquote");if(!rangeElem){return}$rangeElem=$(rangeElem);var text=$rangeElem.text();if(text){return}editor.customCommand(e,commandFn,callback)})})})});_e(function(E,$){E.createMenu(function(check){var menuId="fontfamily";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configFamilys=editor.config.familys;var menu=new E.Menu({editor:editor,id:menuId,title:lang.fontfamily,commandName:"fontName"});var data={};$.each(configFamilys,function(k,v){data[v]=v});var tpl='<span style="font-family:{#commandValue};">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,selectorForELemCommand:"font[face]"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"font[face]");if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="fontsize";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var configSize=editor.config.fontsizes;var menu=new E.Menu({editor:editor,id:menuId,title:lang.fontsize,commandName:"fontSize"});var data=configSize;var tpl='<span style="font-size:{#title};">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,selectorForELemCommand:"font[size]"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"font[size]");if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="head";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.head,commandName:"formatBlock"});var data={"<h1>":"标题1","<h2>":"标题2","<h3>":"标题3","<h4>":"标题4","<h5>":"标题5"};var isOrderedList;function beforeEvent(e){if(editor.queryCommandState("InsertOrderedList")){isOrderedList=true;editor.command(e,"InsertOrderedList")}else{isOrderedList=false}}function afterEvent(e){if(isOrderedList){editor.command(e,"InsertOrderedList")}}var tpl="{#commandValue}{#title}";menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl,beforeEvent:beforeEvent,afterEvent:afterEvent});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"h1,h2,h3,h4,h5");if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="unorderlist";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.unorderlist,commandName:"InsertUnorderedList"});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="orderlist";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.orderlist,commandName:"InsertOrderedList"});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="alignleft";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.alignleft,commandName:"JustifyLeft"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&/text-align:\s*left;/.test(cssText)){return true}}if($(elem).attr("align")==="left"){return true}return false});if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="aligncenter";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.aligncenter,commandName:"JustifyCenter"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&/text-align:\s*center;/.test(cssText)){return true}}if($(elem).attr("align")==="center"){return true}return false});if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="alignright";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.alignright,commandName:"JustifyRight"});menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,li",function(elem){var cssText;if(elem&&elem.style&&elem.style.cssText!=null){cssText=elem.style.cssText;if(cssText&&/text-align:\s*right;/.test(cssText)){return true}}if($(elem).attr("align")==="right"){return true}return false});if(rangeElem){return true}return false};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="link";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.link});var $content=$("<div></div>");var $div1=$('<div style="margin:20px 10px;" class="clearfix"></div>');var $div2=$div1.clone();var $div3=$div1.clone().css("margin","0 10px");var $textInput=$('<input type="text" class="block" placeholder="'+lang.text+'"/>');var $urlInput=$('<input type="text" class="block" placeholder="'+lang.link+'"/>');var $btnSubmit=$('<button class="right">'+lang.submit+"</button>");var $btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$div1.append($textInput);$div2.append($urlInput);$div3.append($btnSubmit).append($btnCancel);$content.append($div1).append($div2).append($div3);menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:300});menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}$textInput.val("");$urlInput.val("http://");var url="";var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"a");if(rangeElem){url=rangeElem.href||""}var text="";var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){text=editor.getRangeText()||""}else if(rangeElem){text=rangeElem.textContent||rangeElem.innerHTML}url&&$urlInput.val(url);text&&$textInput.val(text);if(!isRangeEmpty){$textInput.attr("disabled",true)}else{$textInput.removeAttr("disabled")}dropPanel.show()};menu.updateSelectedEvent=function(){var rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"a");if(rangeElem){return true}return false};$btnCancel.click(function(e){e.preventDefault();menu.dropPanel.hide()});$btnSubmit.click(function(e){e.preventDefault();var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,"a");var isRangeEmpty=editor.isRangeEmpty();var $linkElem,linkHtml;var commandFn,callback;var $txt=editor.txt.$txt;var $oldLinks,$newLinks;var uniqId="link"+E.random();var url=$.trim($urlInput.val());var text=$.trim($textInput.val());if(!url){menu.dropPanel.focusFirstInput();return}if(!text){text=url}if(!isRangeEmpty){$oldLinks=$txt.find("a");$oldLinks.attr(uniqId,"1");editor.command(e,"createLink",url);$newLinks=$txt.find("a").not("["+uniqId+"]");$newLinks.attr("target","_blank");$oldLinks.removeAttr(uniqId)}else if(targetElem){$linkElem=$(targetElem);commandFn=function(){$linkElem.attr("href",url);$linkElem.text(text)};callback=function(){var editor=this;editor.restoreSelectionByElem(targetElem)};editor.customCommand(e,commandFn,callback)}else{linkHtml='<a href="'+url+'" target="_blank">'+text+"</a>";if(E.userAgent.indexOf("Firefox")>0){linkHtml+="<span>&nbsp;</span>"}editor.command(e,"insertHtml",linkHtml)}});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="unlink";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.unlink,commandName:"unLink"});menu.clickEvent=function(e){var isRangeEmpty=editor.isRangeEmpty();if(!isRangeEmpty){editor.command(e,"unLink");return}var rangeElem=editor.getRangeElem();var aElem=editor.getSelfOrParentByName(rangeElem,"a");if(!aElem){e.preventDefault();return}var $a=$(aElem);var $span=$("<span>"+$a.text()+"</span>");function commandFn(){$a.after($span).remove()}function callback(){editor.restoreSelectionByElem($span.get(0))}editor.customCommand(e,commandFn,callback)};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="table";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.table});var $content=$('<div style="font-size: 14px; color: #666; text-align:right;"></div>');var $table=$('<table class="choose-table" style="margin-bottom:10px;margin-top:5px;">');var $row=$("<span>0</span>");var $rowspan=$("<span> 行 </span>");var $col=$("<span>0</span>");var $colspan=$("<span> 列</span>");var $tr;var i,j;var range=editor.currentRange();if(range&&$(range.startContainer).parents("table")[0])return;for(i=0;i<15;i++){$tr=$('<tr index="'+(i+1)+'">');for(j=0;j<20;j++){$tr.append($('<td index="'+(j+1)+'">'))}$table.append($tr)}$content.append($table);$content.append($row).append($rowspan).append($col).append($colspan);$table.on("mouseenter","td",function(e){var $currentTd=$(e.currentTarget);var currentTdIndex=$currentTd.attr("index");var $currentTr=$currentTd.parent();var currentTrIndex=$currentTr.attr("index");$row.text(currentTrIndex);$col.text(currentTdIndex);$table.find("tr").each(function(){var $tr=$(this);var trIndex=$tr.attr("index");if(parseInt(trIndex,10)<=parseInt(currentTrIndex,10)){$tr.find("td").each(function(){var $td=$(this);var tdIndex=$td.attr("index");if(parseInt(tdIndex,10)<=parseInt(currentTdIndex,10)){$td.addClass("active")}else{$td.removeClass("active")}})}else{$tr.find("td").removeClass("active")}})}).on("mouseleave",function(e){$table.find("td").removeClass("active");$row.text(0);$col.text(0)});$table.on("click","td",function(e){var $currentTd=$(e.currentTarget);var currentTdIndex=$currentTd.attr("index");var $currentTr=$currentTd.parent();var currentTrIndex=$currentTr.attr("index");var rownum=parseInt(currentTrIndex,10);var colnum=parseInt(currentTdIndex,10);var i,j;var tableHtml="<table>";for(i=0;i<rownum;i++){tableHtml+="<tr>";for(j=0;j<colnum;j++){tableHtml+="<td><span>&nbsp;</span></td>"}tableHtml+="</tr>"}tableHtml+="</table>";var tableContainer='<div calss="tu-scroll" style="overflow-x:auto;">'+tableHtml+"</div>";editor.command(e,"insertHtml",tableContainer)});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:262});editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="emotion";if(!check(menuId)){return}var editor=this;var config=editor.config;var lang=config.lang;var configEmotions=config.emotions;var emotionsShow=config.emotionsShow;editor.emotionUrls=[];var menu=new E.Menu({editor:editor,id:menuId,title:lang.emotion});function insertEmotionImgs(data,$tabContent){$.each(data,function(k,emotion){var src=emotion.icon||emotion.url;var value=emotion.value||emotion.title;var commandValue=emotionsShow==="icon"?src:value;var $command=$('<a href="#" commandValue="'+commandValue+'"></a>');var $img=$("<img>");$img.attr("_src",src);$command.append($img);$tabContent.append($command);editor.emotionUrls.push(src)})}var $panelContent=$('<div class="panel-tab"></div>');var $tabContainer=$('<div class="tab-container"></div>');var $contentContainer=$('<div class="content-container emotion-content-container"></div>');$.each(configEmotions,function(k,emotion){var title=emotion.title;var data=emotion.data;E.log("正在处理 "+title+" 表情的数据...");var $tab=$('<a href="#">'+title+" </a>");$tabContainer.append($tab);var $tabContent=$('<div class="content"></div>');$contentContainer.append($tabContent);$tab.click(function(e){$tabContainer.children().removeClass("selected");$contentContainer.children().removeClass("selected");$tabContent.addClass("selected");$tab.addClass("selected");e.preventDefault()});if(typeof data==="string"){E.log("将通过 "+data+" 地址ajax下载表情包");$.get(data,function(result){result=$.parseJSON(result);E.log("下载完毕，得到 "+result.length+" 个表情");insertEmotionImgs(result,$tabContent)})}else if(Object.prototype.toString.call(data).toLowerCase().indexOf("array")>0){insertEmotionImgs(data,$tabContent)}else{E.error("data 数据格式错误，请修改为正确格式，参考文档："+E.docsite);return}});$panelContent.append($tabContainer).append($contentContainer);$tabContainer.children().first().addClass("selected");$contentContainer.children().first().addClass("selected");$contentContainer.on("click","a[commandValue]",function(e){var $a=$(e.currentTarget);var commandValue=$a.attr("commandValue");var img;if(emotionsShow==="icon"){editor.command(e,"InsertImage",commandValue)}else{editor.command(e,"insertHtml","<span>"+commandValue+"</span>")}e.preventDefault()});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:350});menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}dropPanel.show();if(menu.imgLoaded){return}$contentContainer.find("img").each(function(){var $img=$(this);var _src=$img.attr("_src");$img.on("error",function(){E.error("加载不出表情图片 "+_src)});$img.attr("src",_src);$img.removeAttr("_src")});menu.imgLoaded=true};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="img";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.img});var $panelContent=$('<div class="panel-tab"></div>');var $tabContainer=$('<div class="tab-container"></div>');var $contentContainer=$('<div class="content-container"></div>');$panelContent.append($tabContainer).append($contentContainer);var $uploadTab=$('<a href="javascript:void(0)">上传图片</a>');var $linkTab=$('<a href="javascript:void(0)">网络图片</a>');$tabContainer.append($uploadTab).append($linkTab);var $uploadContent=$('<div class="content"></div>');$contentContainer.append($uploadContent);var $linkContent=$('<div class="content"></div>');$contentContainer.append($linkContent);linkContentHandler(editor,menu,$linkContent);menu.dropPanel=new E.DropPanel(editor,menu,{$content:$panelContent,width:400,onRender:function(){var init=editor.config.customUploadInit;init&&init.call(editor)}});editor.menus[menuId]=menu;function tabToggle(){$uploadTab.click(function(e){$tabContainer.children().removeClass("selected");$contentContainer.children().removeClass("selected");$uploadContent.addClass("selected");$uploadTab.addClass("selected");e.preventDefault()});$linkTab.click(function(e){$tabContainer.children().removeClass("selected");$contentContainer.children().removeClass("selected");$linkContent.addClass("selected");$linkTab.addClass("selected");e.preventDefault();if(E.placeholder){$linkContent.find("input[type=text]").focus()}});$uploadTab.click()}function hideUploadImg(){$tabContainer.remove();$uploadContent.remove();$linkContent.addClass("selected")}function hideLinkImg(){$tabContainer.remove();$linkContent.remove();$uploadContent.addClass("selected")}editor.ready(function(){var editor=this;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var customUpload=config.customUpload;var linkImg=config.hideLinkImg;var $uploadImgPanel;if(uploadImgUrl||customUpload){editor.$uploadContent=$uploadContent;tabToggle();if(linkImg){hideLinkImg()}}else{hideUploadImg()}function hidePanel(){menu.dropPanel.hide()}$uploadContent.click(function(){setTimeout(hidePanel)})})});function linkContentHandler(editor,menu,$linkContent){var lang=editor.config.lang;var $urlContainer=$('<div style="margin:20px 10px 10px 10px;"></div>');var $urlInput=$('<input type="text" class="block" placeholder="http://"/>');$urlContainer.append($urlInput);var $btnSubmit=$('<button class="right">'+lang.submit+"</button>");var $btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$linkContent.append($urlContainer).append($btnSubmit).append($btnCancel);$btnCancel.click(function(e){e.preventDefault();menu.dropPanel.hide()});function callback(){$urlInput.val("")}$btnSubmit.click(function(e){e.preventDefault();var url=$.trim($urlInput.val());if(!url){$urlInput.focus();return}var imgHtml='<img style="max-width:100%;" src="'+url+'"/>';editor.command(e,"insertHtml",imgHtml,callback)})}});_e(function(E,$){E.createMenu(function(check){var menuId="video";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var reg=/^<(iframe)|(embed)/i;var menu=new E.Menu({editor:editor,id:menuId,title:lang.video});var $content=$("<div></div>");var $linkInputContainer=$('<div style="margin:20px 10px;"></div>');var $linkInput=$('<input type="text" class="block" placeholder=\'格式如：<iframe src="..." frameborder=0 allowfullscreen></iframe>\'/>');$linkInputContainer.append($linkInput);var $sizeContainer=$('<div style="margin:20px 10px;"></div>');var $widthInput=$('<input type="text" value="640" style="width:50px;text-align:center;"/>');var $heightInput=$('<input type="text" value="498" style="width:50px;text-align:center;"/>');$sizeContainer.append("<span> "+lang.width+" </span>").append($widthInput).append("<span> px &nbsp;&nbsp;&nbsp;</span>").append("<span> "+lang.height+" </span>").append($heightInput).append("<span> px </span>");var $btnContainer=$("<div></div>");var $howToCopy=$('<a href="http://www.kancloud.cn/wangfupeng/wangeditor2/134973" target="_blank" style="display:inline-block;margin-top:10px;margin-left:10px;color:#999;">如何复制视频链接？</a>');var $btnSubmit=$('<button class="right">'+lang.submit+"</button>");var $btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$btnContainer.append($howToCopy).append($btnSubmit).append($btnCancel);$content.append($linkInputContainer).append($sizeContainer).append($btnContainer);$btnCancel.click(function(e){e.preventDefault();$linkInput.val("");menu.dropPanel.hide()});$btnSubmit.click(function(e){e.preventDefault();var link=$.trim($linkInput.val());var $link;var width=parseInt($widthInput.val());var height=parseInt($heightInput.val());var $div=$("<div>");var html="<p>{content}</p>";if(!link){menu.dropPanel.focusFirstInput();return}if(!reg.test(link)){alert("视频链接格式错误！");menu.dropPanel.focusFirstInput();return}if(isNaN(width)||isNaN(height)){alert("宽度或高度不是数字！");return}$link=$(link);$link.attr("width",width).attr("height",height);html=html.replace("{content}",$div.append($link).html());editor.command(e,"insertHtml",html);$linkInput.val("")});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:400});editor.menus[menuId]=menu})});_e(function(E,$){var inputKeyup=function(input){return"onkeyup"in input}(document.createElement("input"));E.baiduMapAk="TVhjYjq1ICT2qqL5LdS8mwas";E.numberOfLocation=0;E.createMenu(function(check){var menuId="location";if(!check(menuId)){return}if(++E.numberOfLocation>1){E.error("目前不支持在一个页面多个编辑器上同时使用地图，可通过自定义菜单配置去掉地图菜单");return}var editor=this;var config=editor.config;var lang=config.lang;var ak=config.mapAk;editor.mapData={};var mapData=editor.mapData;mapData.markers=[];mapData.mapContainerId="map"+E.random();mapData.clearLocations=function(){var map=mapData.map;if(!map){return}map.clearOverlays();mapData.markers=[]};mapData.searchMap=function(){var map=mapData.map;if(!map){return}var BMap=window.BMap;var cityName=$cityInput.val();var locationName=$searchInput.val();var myGeo,marker;if(cityName!==""){if(!locationName||locationName===""){map.centerAndZoom(cityName,11)}if(locationName&&locationName!==""){myGeo=new BMap.Geocoder;myGeo.getPoint(locationName,function(point){if(point){map.centerAndZoom(point,13);marker=new BMap.Marker(point);map.addOverlay(marker);marker.enableDragging();mapData.markers.push(marker)}else{map.centerAndZoom(cityName,11)}},cityName)}}};var hasCallback=false;window.baiduMapCallBack=function(){if(hasCallback){return}else{hasCallback=true}var BMap=window.BMap;if(!mapData.map){mapData.map=new BMap.Map(mapData.mapContainerId)}var map=mapData.map;map.centerAndZoom(new BMap.Point(116.404,39.915),11);map.addControl(new BMap.MapTypeControl);map.setCurrentCity("北京");map.enableScrollWheelZoom(true);function locationFun(result){var cityName=result.name;map.setCenter(cityName);$cityInput.val(cityName);if(E.placeholder){$searchInput.focus()}var timeoutId,searchFn;if(inputKeyup){searchFn=function(e){if(e.type==="keyup"&&e.keyCode===13){e.preventDefault()}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(mapData.searchMap,500)};$cityInput.on("keyup change paste",searchFn);$searchInput.on("keyup change paste",searchFn)}else{searchFn=function(){if(!$content.is(":visible")){clearTimeout(timeoutId);return}var currentCity="";var currentSearch="";var city=$cityInput.val();var search=$searchInput.val();if(city!==currentCity||search!==currentSearch){mapData.searchMap();currentCity=city;currentSearch=search}if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(searchFn,1e3)};timeoutId=setTimeout(searchFn,1e3)}}var myCity=new BMap.LocalCity;myCity.get(locationFun);map.addEventListener("click",function(e){var marker=new BMap.Marker(new BMap.Point(e.point.lng,e.point.lat));map.addOverlay(marker);marker.enableDragging();mapData.markers.push(marker)},false)};mapData.loadMapScript=function(){var script=document.createElement("script");script.type="text/javascript";script.src="https://api.map.baidu.com/api?v=2.0&ak="+ak+"&s=1&callback=baiduMapCallBack";try{document.body.appendChild(script)}catch(ex){E.error("加载地图过程中发生错误")}};mapData.initMap=function(){if(window.BMap){window.baiduMapCallBack()}else{mapData.loadMapScript()}};var menu=new E.Menu({editor:editor,id:menuId,title:lang.location});editor.menus[menuId]=menu;var $content=$("<div></div>");var $inputContainer=$('<div style="margin:10px 0;"></div>');var $cityInput=$('<input type="text"/>');$cityInput.css({width:"80px","text-align":"center"});var $searchInput=$('<input type="text"/>');$searchInput.css({width:"300px","margin-left":"10px"}).attr("placeholder",lang.searchlocation);var $clearBtn=$('<button class="right link">'+lang.clearLocation+"</button>");$inputContainer.append($clearBtn).append($cityInput).append($searchInput);$content.append($inputContainer);$clearBtn.click(function(e){$searchInput.val("");$searchInput.focus();mapData.clearLocations();e.preventDefault()});var $map=$('<div id="'+mapData.mapContainerId+'"></div>');$map.css({height:"260px",width:"100%",position:"relative","margin-top":"10px",border:"1px solid #f1f1f1"});var $mapLoading=$("<span>"+lang.loading+"</span>");$mapLoading.css({position:"absolute",
width:"100px","text-align":"center",top:"45%",left:"50%","margin-left":"-50px"});$map.append($mapLoading);$content.append($map);var $btnContainer=$('<div style="margin:10px 0;"></div>');var $btnSubmit=$('<button class="right">'+lang.submit+"</button>");var $btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");var $checkLabel=$('<label style="display:inline-block;margin-top:10px;color:#666;"></label>');var $check=$('<input type="checkbox">');$checkLabel.append($check).append('<span style="display:inline-block;margin-left:5px;">  '+lang.dynamicMap+"</span>");$btnContainer.append($checkLabel).append($btnSubmit).append($btnCancel);$content.append($btnContainer);function callback(){$searchInput.val("")}$btnCancel.click(function(e){e.preventDefault();callback();menu.dropPanel.hide()});$btnSubmit.click(function(e){e.preventDefault();var map=mapData.map,isDynamic=$check.is(":checked"),markers=mapData.markers,center=map.getCenter(),centerLng=center.lng,centerLat=center.lat,zoom=map.getZoom(),size=map.getSize(),sizeWidth=size.width,sizeHeight=size.height,position,src,iframe;if(isDynamic){src="http://ueditor.baidu.com/ueditor/dialogs/map/show.html#"}else{src="http://api.map.baidu.com/staticimage?"}src=src+"center="+centerLng+","+centerLat+"&zoom="+zoom+"&width="+sizeWidth+"&height="+sizeHeight;if(markers.length>0){src=src+"&markers=";$.each(markers,function(key,value){position=value.getPosition();if(key>0){src=src+"|"}src=src+position.lng+","+position.lat})}if(isDynamic){if(markers.length>1){alert(lang.langDynamicOneLocation);return}src+="&markerStyles=l,A";iframe='<iframe class="ueditor_baidumap" src="{src}" frameborder="0" width="'+sizeWidth+'" height="'+sizeHeight+'"></iframe>';iframe=iframe.replace("{src}",src);editor.command(e,"insertHtml",iframe,callback)}else{editor.command(e,"insertHtml",'<img style="max-width:100%;" src="'+src+'"/>',callback)}});menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500});menu.onRender=function(){if(ak===E.baiduMapAk){E.warn("建议在配置中自定义百度地图的mapAk，否则可能影响地图功能，文档："+E.docsite)}};menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;var firstTime=false;if(dropPanel.isShowing){dropPanel.hide();return}if(!mapData.map){firstTime=true}dropPanel.show();mapData.initMap();if(!firstTime){$searchInput.focus()}}})});_e(function(E,$){function loadHljs(){if(E.userAgent.indexOf("MSIE 8")>0){return}if(window.hljs){return}var script=document.createElement("script");script.type="text/javascript";script.src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js";document.body.appendChild(script)}E.createMenu(function(check){var menuId="insertcode";if(!check(menuId)){return}setTimeout(loadHljs,0);var editor=this;var config=editor.config;var lang=config.lang;var $txt=editor.txt.$txt;var menu=new E.Menu({editor:editor,id:menuId,title:lang.insertcode});menu.clickEvent=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}$textarea.val("");dropPanel.show();var hljs=window.hljs;if(hljs&&hljs.listLanguages){if($langSelect.children().length!==0){return}$langSelect.css({"margin-top":"9px","margin-left":"5px"});$.each(hljs.listLanguages(),function(key,lang){if(lang==="xml"){lang="html"}if(lang===config.codeDefaultLang){$langSelect.append('<option value="'+lang+'" selected="selected">'+lang+"</option>")}else{$langSelect.append('<option value="'+lang+'">'+lang+"</option>")}})}else{$langSelect.hide()}};menu.clickEventSelected=function(e){var menu=this;var dropPanel=menu.dropPanel;if(dropPanel.isShowing){dropPanel.hide();return}dropPanel.show();var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,"pre");var $targetElem;var className;if(targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,"code")}if(!targetElem){return}$targetElem=$(targetElem);$textarea.val($targetElem.text());if($langSelect){className=$targetElem.attr("class");if(className){$langSelect.val(className.split(" ")[0])}}};menu.updateSelectedEvent=function(){var self=this;var editor=self.editor;var rangeElem;rangeElem=editor.getRangeElem();rangeElem=editor.getSelfOrParentByName(rangeElem,"pre");if(rangeElem){return true}return false};var $content=$("<div></div>");var $textarea=$("<textarea></textarea>");var $langSelect=$("<select></select>");contentHandle($content);menu.dropPanel=new E.DropPanel(editor,menu,{$content:$content,width:500});editor.menus[menuId]=menu;function contentHandle($content){var $textareaContainer=$("<div></div>");$textareaContainer.css({margin:"15px 5px 5px 5px",height:"160px","text-align":"center"});$textarea.css({width:"100%",height:"100%",padding:"10px"});$textarea.on("keydown",function(e){if(e.keyCode===9){e.preventDefault()}});$textareaContainer.append($textarea);$content.append($textareaContainer);var $btnContainer=$("<div></div>");var $btnSubmit=$('<button class="right">'+lang.submit+"</button>");var $btnCancel=$('<button class="right gray">'+lang.cancel+"</button>");$btnContainer.append($btnSubmit).append($btnCancel).append($langSelect);$content.append($btnContainer);$btnCancel.click(function(e){e.preventDefault();menu.dropPanel.hide()});var codeTpl='<pre style="max-width:100%;overflow-x:auto;"><code{#langClass}>{#content}</code></pre>';$btnSubmit.click(function(e){e.preventDefault();var val=$textarea.val();if(!val){$textarea.focus();return}var rangeElem=editor.getRangeElem();if($.trim($(rangeElem).text())&&codeTpl.indexOf("<p><br></p>")!==0){codeTpl="<p><br></p>"+codeTpl}var lang=$langSelect?$langSelect.val():"";var langClass="";var doHightlight=function(){$txt.find("pre code").each(function(i,block){var $block=$(block);if($block.attr("codemark")){return}else if(window.hljs){window.hljs.highlightBlock(block);$block.attr("codemark","1")}})};if(lang){langClass=' class="'+lang+' hljs"'}val=val.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;");if(!menu.selected){var html=codeTpl.replace("{#langClass}",langClass).replace("{#content}",val);editor.command(e,"insertHtml",html,doHightlight);return}var targetElem=editor.getSelfOrParentByName(rangeElem,"pre");var $targetElem;if(targetElem){targetElem=editor.getSelfOrParentByName(rangeElem,"code")}if(!targetElem){return}$targetElem=$(targetElem);function commandFn(){var className;if(lang){className=$targetElem.attr("class");if(className!==lang+" hljs"){$targetElem.attr("class",lang+" hljs")}}$targetElem.html(val)}function callback(){editor.restoreSelectionByElem(targetElem);doHightlight()}editor.customCommand(e,commandFn,callback)})}$txt.on("keydown",function(e){if(e.keyCode!==13){return}var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,"code");if(!targetElem){return}editor.command(e,"insertHtml","\n")});function updateMenu(){var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,"code");if(targetElem){editor.disableMenusExcept("insertcode")}else{editor.enableMenusExcept("insertcode")}}$txt.on("keydown click",function(e){setTimeout(updateMenu)})})});_e(function(E,$){E.createMenu(function(check){var menuId="undo";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.undo});menu.clickEvent=function(e){editor.undo()};editor.menus[menuId]=menu;editor.ready(function(){var editor=this;var $txt=editor.txt.$txt;var timeoutId;function undo(){editor.undoRecord()}$txt.on("keydown",function(e){var keyCode=e.keyCode;if(e.ctrlKey&&keyCode===90){editor.undo();return}if(keyCode===13){undo()}else{if(timeoutId){clearTimeout(timeoutId)}timeoutId=setTimeout(undo,1e3)}});editor.undoRecord()})})});_e(function(E,$){E.createMenu(function(check){var menuId="redo";if(!check(menuId)){return}var editor=this;var lang=editor.config.lang;var menu=new E.Menu({editor:editor,id:menuId,title:lang.redo});menu.clickEvent=function(e){editor.redo()};editor.menus[menuId]=menu})});_e(function(E,$){var scrollTopWhenFullScreen;E.createMenu(function(check){var menuId="fullscreen";if(!check(menuId)){return}var editor=this;var $txt=editor.txt.$txt;var config=editor.config;var zIndexConfig=config.zindex||1e4;var lang=config.lang;var isSelected=false;var zIndex;var maxHeight;var menu=new E.Menu({editor:editor,id:menuId,title:lang.fullscreen});menu.clickEvent=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.addClass("wangEditor-fullscreen");zIndex=$editorContainer.css("z-index");$editorContainer.css("z-index",zIndexConfig);var $wrapper;var txtHeight=$txt.height();var txtOuterHeight=$txt.outerHeight();if(editor.useMaxHeight){maxHeight=$txt.css("max-height");$txt.css("max-height","none");$wrapper=$txt.parent();$wrapper.after($txt);$wrapper.remove();$txt.css("overflow-y","auto")}var menuContainer=editor.menuContainer;$txt.height(E.$window.height()-menuContainer.height()-(txtOuterHeight-txtHeight));editor.menuContainer.$menuContainer.attr("style","");isSelected=true;editor.isFullScreen=true;scrollTopWhenFullScreen=E.$window.scrollTop()};menu.clickEventSelected=function(e){var $editorContainer=editor.$editorContainer;$editorContainer.removeClass("wangEditor-fullscreen");$editorContainer.css("z-index",zIndex);if(editor.useMaxHeight){$txt.css("max-height",maxHeight)}else{editor.$valueContainer.css("height",editor.valueContainerHeight)}editor.txt.initHeight();isSelected=false;editor.isFullScreen=false;if(scrollTopWhenFullScreen!=null){E.$window.scrollTop(scrollTopWhenFullScreen)}};menu.updateSelectedEvent=function(e){return isSelected};editor.menus[menuId]=menu})});_e(function(E,$){E.fn.renderMenus=function(){var editor=this;var menus=editor.menus;var menuIds=editor.config.menus;var menuContainer=editor.menuContainer;var menu;var groupIdx=0;$.each(menuIds,function(k,v){if(v==="|"){groupIdx++;return}menu=menus[v];if(menu){menu.render(groupIdx)}})}});_e(function(E,$){E.fn.renderMenuContainer=function(){var editor=this;var menuContainer=editor.menuContainer;var $editorContainer=editor.$editorContainer;menuContainer.render()}});_e(function(E,$){E.fn.renderTxt=function(){var editor=this;var txt=editor.txt;txt.render();editor.ready(function(){txt.initHeight()})}});_e(function(E,$){E.fn.renderEditorContainer=function(){var editor=this;var $valueContainer=editor.$valueContainer;var $editorContainer=editor.$editorContainer;var $txt=editor.txt.$txt;var $prev,$parent;if($valueContainer===$txt){$prev=editor.$prev;$parent=editor.$parent;if($prev&&$prev.length){$prev.after($editorContainer)}else{$parent.prepend($editorContainer)}}else{$valueContainer.after($editorContainer);$valueContainer.hide()}}});_e(function(E,$){E.fn.eventMenus=function(){var menus=this.menus;$.each(menus,function(k,v){v.bindEvent()})}});_e(function(E,$){E.fn.eventMenuContainer=function(){}});_e(function(E,$){E.fn.eventTxt=function(){var txt=this.txt;txt.saveSelectionEvent();txt.updateValueEvent();txt.updateMenuStyleEvent()}});_e(function(E,$){E.plugin(function(){var editor=this;var fns=editor.config.uploadImgFns;fns.onload||(fns.onload=function(resultText,xhr){E.log("上传结束，返回结果为 "+resultText);var editor=this;var originalName=editor.uploadImgOriginalName||"";var img;if(resultText.indexOf("error|")===0){E.warn("上传失败："+resultText.split("|")[1]);alert(resultText.split("|")[1])}else{E.log("上传成功，即将插入编辑区域，结果为："+resultText);img=document.createElement("img");img.onload=function(){var html='<img src="'+resultText+'" alt="'+originalName+'" style="max-width:100%;"/>';editor.command(null,"insertHtml",html);E.log("已插入图片，地址 "+resultText);img=null};img.onerror=function(){E.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+resultText);img=null};img.src=resultText}});fns.ontimeout||(fns.ontimeout=function(xhr){E.error("上传图片超时");alert("上传图片超时")});fns.onerror||(fns.onerror=function(xhr){E.error("上传上图片发生错误");alert("上传上图片发生错误")})})});_e(function(E,$){if(!window.FileReader||!window.FormData){return}E.plugin(function(){var editor=this;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadTimeout=config.uploadTimeout;var uploadImgFns=config.uploadImgFns;var onload=uploadImgFns.onload;var ontimeout=uploadImgFns.ontimeout;var onerror=uploadImgFns.onerror;if(!uploadImgUrl){return}function convertBase64UrlToBlob(urlData,filetype){var bytes=window.atob(urlData.split(",")[1]);var ab=new ArrayBuffer(bytes.length);var ia=new Uint8Array(ab);var i;for(i=0;i<bytes.length;i++){ia[i]=bytes.charCodeAt(i)}return new Blob([ab],{type:filetype})}function insertImg(src,event){var img=document.createElement("img");img.onload=function(){var html='<img src="'+src+'" style="max-width:100%;"/>';editor.command(event,"insertHtml",html);E.log("已插入图片，地址 "+src);img=null};img.onerror=function(){E.error("使用返回的结果获取图片，发生错误。请确认以下结果是否正确："+src);img=null};img.src=src}function updateProgress(e){if(e.lengthComputable){var percentComplete=e.loaded/e.total;editor.showUploadProgress(percentComplete*100)}}editor.xhrUploadImg=function(opt){var event=opt.event;var fileName=opt.filename||"";var base64=opt.base64;var fileType=opt.fileType||"image/png";var name=opt.name||"wangEditor_upload_file";var loadfn=opt.loadfn||onload;var errorfn=opt.errorfn||onerror;var timeoutfn=opt.timeoutfn||ontimeout;var params=editor.config.uploadParams||{};var headers=editor.config.uploadHeaders||{};var fileExt="png";if(fileName.indexOf(".")>0){fileExt=fileName.slice(fileName.lastIndexOf(".")-fileName.length+1)}else if(fileType.indexOf("/")>0&&fileType.split("/")[1]){fileExt=fileType.split("/")[1]}if(E.isOnWebsite){E.log("预览模拟上传");insertImg(base64,event);return}var xhr=new XMLHttpRequest;var timeoutId;var src;var formData=new FormData;function timeoutCallback(){if(timeoutId){clearTimeout(timeoutId)}if(xhr&&xhr.abort){xhr.abort()}event.preventDefault();timeoutfn&&timeoutfn.call(editor,xhr);editor.hideUploadProgress()}xhr.onload=function(){if(timeoutId){clearTimeout(timeoutId)}editor.uploadImgOriginalName=fileName;if(fileName.indexOf(".")>0){editor.uploadImgOriginalName=fileName.split(".")[0]}loadfn&&loadfn.call(editor,xhr.responseText,xhr);editor.hideUploadProgress()};xhr.onerror=function(){if(timeoutId){clearTimeout(timeoutId)}event.preventDefault();errorfn&&errorfn.call(editor,xhr);editor.hideUploadProgress()};xhr.upload.onprogress=updateProgress;formData.append(name,convertBase64UrlToBlob(base64,fileType),E.random()+"."+fileExt);$.each(params,function(key,value){formData.append(key,value)});xhr.open("POST",uploadImgUrl,true);$.each(headers,function(key,value){xhr.setRequestHeader(key,value)});xhr.withCredentials=true;xhr.send(formData);timeoutId=setTimeout(timeoutCallback,uploadTimeout);E.log("开始上传...并开始超时计算")}})});_e(function(E,$){E.plugin(function(){var editor=this;var menuContainer=editor.menuContainer;var menuHeight=menuContainer.height();var $editorContainer=editor.$editorContainer;var width=$editorContainer.width();var $progress=$('<div class="wangEditor-upload-progress"></div>');var isRender=false;function render(){if(isRender){return}isRender=true;$progress.css({top:menuHeight+"px"});$editorContainer.append($progress)}editor.showUploadProgress=function(progress){if(timeoutId){clearTimeout(timeoutId)}render();$progress.show();$progress.width(progress*width/100)};var timeoutId;function hideProgress(){$progress.hide();timeoutId=null}editor.hideUploadProgress=function(time){if(timeoutId){clearTimeout(timeoutId)}time=time||750;timeoutId=setTimeout(hideProgress,time)}})});_e(function(E,$){E.plugin(function(){var editor=this;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadTimeout=config.uploadTimeout;var event;if(!uploadImgUrl){return}var $uploadContent=editor.$uploadContent;if(!$uploadContent){return}var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var upfile=new E.UploadFile({editor:editor,uploadUrl:uploadImgUrl,timeout:uploadTimeout,fileAccept:"image/jpg,image/jpeg,image/png,image/gif,image/bmp"});$uploadIcon.click(function(e){event=e;upfile.selectFiles()})})});_e(function(E,$){if(!window.FileReader||!window.FormData){return}var UploadFile=function(opt){this.editor=opt.editor;this.uploadUrl=opt.uploadUrl;this.timeout=opt.timeout;this.fileAccept=opt.fileAccept;this.multiple=true};UploadFile.fn=UploadFile.prototype;UploadFile.fn.clear=function(){this.$input.val("");E.log("input value 已清空")};UploadFile.fn.render=function(){var self=this;if(self._hasRender){return}E.log("渲染dom");var fileAccept=self.fileAccept;var acceptTpl=fileAccept?'accept="'+fileAccept+'"':"";var multiple=self.multiple;var multipleTpl=multiple?'multiple="multiple"':"";var $input=$('<input type="file" '+acceptTpl+" "+multipleTpl+"/>");var $container=$('<div style="visibility:hidden;"></div>');$container.append($input);E.$body.append($container);$input.on("change",function(e){self.selected(e,$input.get(0))});self.$input=$input;self._hasRender=true};UploadFile.fn.selectFiles=function(){var self=this;E.log("使用 html5 方式上传");self.render();E.log("选择文件");self.$input.click()};UploadFile.fn.selected=function(e,input){var self=this;var files=input.files||[];if(files.length===0){return}E.log("选中 "+files.length+" 个文件");$.each(files,function(key,value){self.upload(value)})};UploadFile.fn.upload=function(file){var self=this;var editor=self.editor;var filename=file.name||"";var fileType=file.type||"";var uploadImgFns=editor.config.uploadImgFns;var uploadFileName=editor.config.uploadImgFileName||"wangEditorH5File";var onload=uploadImgFns.onload;var ontimeout=uploadImgFns.ontimeout;var onerror=uploadImgFns.onerror;var reader=new FileReader;if(!onload||!ontimeout||!onerror){E.error("请为编辑器配置上传图片的 onload ontimeout onerror 回调事件");return}E.log("开始执行 "+filename+" 文件的上传");function clearInput(){self.clear()}reader.onload=function(e){E.log("已读取"+filename+"文件");var base64=e.target.result||this.result;editor.xhrUploadImg({event:e,filename:filename,base64:base64,fileType:fileType,name:uploadFileName,loadfn:function(resultText,xhr){clearInput();var editor=this;onload.call(editor,resultText,xhr)},errorfn:function(xhr){clearInput();if(E.isOnWebsite){alert("wangEditor官网暂时没有服务端，因此报错。实际项目中不会发生")}var editor=this;onerror.call(editor,xhr)},timeoutfn:function(xhr){clearInput();if(E.isOnWebsite){alert("wangEditor官网暂时没有服务端，因此超时。实际项目中不会发生")}var editor=this;ontimeout(editor,xhr)}})};reader.readAsDataURL(file)};E.UploadFile=UploadFile});_e(function(E,$){if(window.FileReader&&window.FormData){return}var UploadFile=function(opt){this.editor=opt.editor;this.uploadUrl=opt.uploadUrl;this.timeout=opt.timeout;this.fileAccept=opt.fileAccept;this.multiple=false};UploadFile.fn=UploadFile.prototype;UploadFile.fn.clear=function(){this.$input.val("");E.log("input value 已清空")};UploadFile.fn.hideModal=function(){this.modal.hide()};UploadFile.fn.render=function(){var self=this;var editor=self.editor;var uploadFileName=editor.config.uploadImgFileName||"wangEditorFormFile";if(self._hasRender){return}var uploadUrl=self.uploadUrl;E.log("渲染dom");var iframeId="iframe"+E.random();var $iframe=$('<iframe name="'+iframeId+'" id="'+iframeId+'" frameborder="0" width="0" height="0"></iframe>');var multiple=self.multiple;var multipleTpl=multiple?'multiple="multiple"':"";var $p=$("<p>选择图片并上传</p>");var $input=$('<input type="file" '+multipleTpl+' name="'+uploadFileName+'"/>');var $btn=$('<input type="submit" value="上传"/>');var $form=$('<form enctype="multipart/form-data" method="post" action="'+uploadUrl+'" target="'+iframeId+'"></form>');var $container=$('<div style="margin:10px 20px;"></div>');$form.append($p).append($input).append($btn);$.each(editor.config.uploadParams,function(key,value){$form.append($('<input type="hidden" name="'+key+'" value="'+value+'"/>'))});$container.append($form);$container.append($iframe);self.$input=$input;self.$iframe=$iframe;var modal=new E.Modal(editor,undefined,{$content:$container});self.modal=modal;self._hasRender=true};UploadFile.fn.bindLoadEvent=function(){var self=this;if(self._hasBindLoad){return}var editor=self.editor;var $iframe=self.$iframe;var iframe=$iframe.get(0);var iframeWindow=iframe.contentWindow;var onload=editor.config.uploadImgFns.onload;function onloadFn(){var resultText=$.trim(iframeWindow.document.body.innerHTML);if(!resultText){return}var fileFullName=self.$input.val();var fileOriginalName=fileFullName;if(fileFullName.lastIndexOf("\\")>=0){fileOriginalName=fileFullName.slice(fileFullName.lastIndexOf("\\")+1);if(fileOriginalName.indexOf(".")>0){fileOriginalName=fileOriginalName.split(".")[0]}}editor.uploadImgOriginalName=fileOriginalName;onload.call(editor,resultText);self.clear();self.hideModal()}if(iframe.attachEvent){iframe.attachEvent("onload",onloadFn)}else{iframe.onload=onloadFn}self._hasBindLoad=true};UploadFile.fn.show=function(){var self=this;var modal=self.modal;function show(){modal.show();self.bindLoadEvent()}setTimeout(show)};UploadFile.fn.selectFiles=function(){var self=this;E.log("使用 form 方式上传");self.render();self.clear();self.show()};E.UploadFile=UploadFile});_e(function(E,$){E.plugin(function(){var editor=this;var txt=editor.txt;var $txt=txt.$txt;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadFileName=config.uploadImgFileName||"wangEditorPasteFile";var pasteEvent;var $imgsBeforePaste;if(!uploadImgUrl){return}function findPasteImgAndUpload(){var reg=/^data:(image\/\w+);base64/;var $imgs=$txt.find("img");E.log("粘贴后，检查到编辑器有"+$imgs.length+"个图片。开始遍历图片，试图找到刚刚粘贴过来的图片");$.each($imgs,function(){var img=this;var $img=$(img);var flag;var base64=$img.attr("src");var type;$imgsBeforePaste.each(function(){if(img===this){flag=true;return false}});if(flag){return}E.log("找到一个粘贴过来的图片");if(reg.test(base64)){E.log("src 是 base64 格式，可以上传");type=base64.match(reg)[1];editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:type,name:uploadFileName})}else{E.log("src 为 "+base64+" ，不是 base64 格式，暂时不支持上传")}$img.remove()});E.log("遍历结束")}$txt.on("paste",function(e){consol.log(111);pasteEvent=e;var data=pasteEvent.clipboardData||pasteEvent.originalEvent.clipboardData;var text;var items;if(data==null){text=window.clipboardData&&window.clipboardData.getData("text")}else{text=data.getData("text/plain")||data.getData("text/html")}if(text){return}items=data&&data.items;if(items){E.log("通过 data.items 得到了数据");$.each(items,function(key,value){var fileType=value.type||"";if(fileType.indexOf("image")<0){return}var file=value.getAsFile();var reader=new FileReader;E.log("得到一个粘贴图片");reader.onload=function(e){E.log("读取到粘贴的图片");var base64=e.target.result||this.result;editor.xhrUploadImg({event:pasteEvent,base64:base64,fileType:fileType,name:uploadFileName})};reader.readAsDataURL(file)})}else{E.log("未从 data.items 得到数据，使用检测粘贴图片的方式");$imgsBeforePaste=$txt.find("img");E.log("粘贴前，检查到编辑器有"+$imgsBeforePaste.length+"个图片");setTimeout(findPasteImgAndUpload,0)}})})});_e(function(E,$){E.plugin(function(){var editor=this;var txt=editor.txt;var $txt=txt.$txt;var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadFileName=config.uploadImgFileName||"wangEditorDragFile";if(!uploadImgUrl){return}E.$document.on("dragleave drop dragenter dragover",function(e){e.preventDefault()});$txt.on("drop",function(dragEvent){dragEvent.preventDefault();var originalEvent=dragEvent.originalEvent;var files=originalEvent.dataTransfer&&originalEvent.dataTransfer.files;if(!files||!files.length){return}$.each(files,function(k,file){var type=file.type;var name=file.name;if(type.indexOf("image/")<0){return}E.log("得到图片 "+name);var reader=new FileReader;reader.onload=function(e){E.log("读取到图片 "+name);var base64=e.target.result||this.result;editor.xhrUploadImg({event:dragEvent,base64:base64,fileType:type,name:uploadFileName})};reader.readAsDataURL(file)})})})});_e(function(E,$){if(E.userAgent.indexOf("MSIE 8")>0){return}E.plugin(function(){var editor=this;var lang=editor.config.lang;var txt=editor.txt;var $txt=txt.$txt;var html="";var $currentTxt=editor.useMaxHeight?$txt.parent():$txt;var $editorContainer=editor.$editorContainer;var $currentImg;var currentLink="";var isRendered=false;var $dragPoint=$('<div class="img-drag-point"></div>');var $toolbar=$('<div class="txt-toolbar"></div>');var $triangle=$('<div class="tip-triangle"></div>');var $menuContainer=$("<div></div>");var $delete=$('<a href="javascript:void(0)"><i class="tu-icon-delete"></i></a>');var $zoomSmall=$('<a href="javascript:void(0)"><i class="tu-icon-f-narrow"></i></a>');var $zoomBig=$('<a href="javascript:void(0)"><i class="tu-icon-f-enlarge"></i></a>');var $alignLeft=$('<a href="javascript:void(0)"><i class="tu-icon-flush-left"></i></a>');var $alignCenter=$('<a href="javascript:void(0)"><i class="tu-icon-flush-center"></i></a>');var $alignRight=$('<a href="javascript:void(0)"><i class="tu-icon-flush-right"></i></a>');var $linkInputContainer=$('<div style="display:none;"></div>');var isOnDrag=false;function imgLink(e,url){if(!$currentImg){return}var commandFn;var callback=function(){if(url!=null){currentLink=url}if(html!==$txt.html()){$txt.change()}};var $link;var inLink=false;var $parent=$currentImg.parent();if($parent.get(0).nodeName.toLowerCase()==="a"){$link=$parent;inLink=true}else{$link=$('<a target="_blank"></a>')}if(url==null){return $link.attr("href")||""}else if(url===""){if(inLink){commandFn=function(){$currentImg.unwrap()}}}else{if(url===currentLink){return}commandFn=function(){$link.attr("href",url);if(!inLink){$currentImg.wrap($link)}}}if(commandFn){html=$txt.html();editor.customCommand(e,commandFn,callback)}}function render(){if(isRendered){return}bindToolbarEvent();bindDragEvent();$menuContainer.append($delete).append($zoomSmall).append($zoomBig).append($alignLeft).append($alignCenter).append($alignRight);$toolbar.append($triangle).append($menuContainer).append($linkInputContainer);editor.$editorContainer.append($toolbar).append($dragPoint);isRendered=true}function bindToolbarEvent(){var commandFn;function customCommand(e,callback){var cb;html=$txt.html();cb=function(){if(callback){callback()}if(html!==$txt.html()){$txt.change()}};if(commandFn){editor.customCommand(e,commandFn,cb)}}$delete.click(function(e){commandFn=function(){$currentImg.remove()};customCommand(e,function(){setTimeout(hide,100)})});$zoomBig.click(function(e){commandFn=function(){var img=$currentImg.get(0);var width=img.width;var height=img.height;width=width*1.1;height=height*1.1;$currentImg.css({width:width+"px",height:height+"px"})};customCommand(e,function(){setTimeout(show)})});$zoomSmall.click(function(e){commandFn=function(){var img=$currentImg.get(0);var width=img.width;var height=img.height;width=width*.9;height=height*.9;$currentImg.css({width:width+"px",height:height+"px"})};customCommand(e,function(){setTimeout(show)})});$alignLeft.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"left"}).attr("align","left")};customCommand(e,function(){setTimeout(hide,100)})});$alignRight.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"right"}).attr("align","right")};customCommand(e,function(){setTimeout(hide,100)})});$alignCenter.click(function(e){commandFn=function(){$currentImg.parents("p").css({"text-align":"center"}).attr("align","center")};customCommand(e,function(){setTimeout(hide,100)})})}function bindDragEvent(){var _x,_y;var dragMarginLeft,dragMarginTop;var imgWidth,imgHeight;function mousemove(e){var diffX,diffY;diffX=e.pageX-_x;diffY=e.pageY-_y;var currentDragMarginLeft=dragMarginLeft+diffX;var currentDragMarginTop=dragMarginTop+diffY;$dragPoint.css({"margin-left":currentDragMarginLeft,"margin-top":currentDragMarginTop});var currentImgWidth=imgWidth+diffX;var currentImggHeight=imgHeight+diffY;$currentImg&&$currentImg.css({width:currentImgWidth,height:currentImggHeight});$txt.change()}$dragPoint.on("mousedown",function(e){if(!$currentImg){return}_x=e.pageX;_y=e.pageY;dragMarginLeft=parseFloat($dragPoint.css("margin-left"),10);dragMarginTop=parseFloat($dragPoint.css("margin-top"),10);imgWidth=$currentImg.width();imgHeight=$currentImg.height();$toolbar.hide();E.$document.on("mousemove._dragResizeImg",mousemove);E.$document.on("mouseup._dragResizeImg",function(e){E.$document.off("mousemove._dragResizeImg");E.$document.off("mouseup._dragResizeImg");hide();$dragPoint.css({"margin-left":dragMarginLeft,"margin-top":dragMarginTop});isOnDrag=false;$txt.change()});isOnDrag=true})}function show(){if(editor._disabled){return}if($currentImg==null){return}$currentImg.addClass("clicked");var imgPosition=$currentImg.position();var imgTop=imgPosition.top;var imgLeft=imgPosition.left;var imgHeight=$currentImg.outerHeight();var imgWidth=$currentImg.outerWidth();$dragPoint.css({top:imgTop+imgHeight,left:imgLeft+imgWidth});var top=imgTop+imgHeight;var left=imgLeft;var marginLeft=0;var txtTop=$currentTxt.position().top;var txtHeight=$currentTxt.outerHeight();if(top>txtTop+txtHeight){top=txtTop+txtHeight}else{$dragPoint.show()}$toolbar.show();var width=$toolbar.outerWidth();marginLeft=imgWidth/2-width/2;$toolbar.css({top:top+5,left:left,"margin-left":marginLeft});if(marginLeft<0){$toolbar.css("margin-left","0");$triangle.hide()}else{$triangle.show()}editor.disableMenusExcept()}function hide(){if($currentImg==null){return}$currentImg.removeClass("clicked");$currentImg=null;$toolbar.hide();$dragPoint.hide();editor.enableMenusExcept()}function isEmotion(imgSrc){var result=false;if(!editor.emotionUrls){return result}$.each(editor.emotionUrls,function(index,url){var flag=false;if(imgSrc===url){result=true;flag=true}if(flag){return false}});return result}if(E.userAgent.indexOf("MSIE 11")>0)return;$currentTxt.on("mousedown","img",function(e){e.preventDefault()}).on("click","img",function(e){var $img=$(e.currentTarget);var src=$img.attr("src");if(!src||isEmotion(src)){return}render();if($currentImg&&$currentImg.get(0)===$img.get(0)){setTimeout(hide,100);return}$currentImg=$img;show();$menuContainer.show();$linkInputContainer.hide();e.preventDefault();e.stopPropagation()}).on("click keydown scroll",function(e){if(!isOnDrag){setTimeout(hide,100)}})})});_e(function(E,$){E.plugin(function(){var editor=this;var lang=editor.config.lang;var $txt=editor.txt.$txt;var $currentLink;var $toolbar=$('<div class="txt-toolbar"></div>');var $triangle=$('<div class="tip-triangle"></div>');var $triggerLink=$('<a href="javascript:void(0)" target="_blank"><i class="tu-icon-link"></i> '+lang.openLink+"</a>");var isRendered;var isShow=false;var showTimeoutId,hideTimeoutId;var showTimeoutIdByToolbar,hideTimeoutIdByToolbar;function render(){if(isRendered){return}$toolbar.append($triangle).append($triggerLink);editor.$editorContainer.append($toolbar);isRendered=true}function setPosition(){if(!$currentLink){return}var position=$currentLink.position();var left=position.left;var top=position.top;var height=$currentLink.height();var topResult=top+height+5;var menuHeight=editor.menuContainer.height();var txtHeight=editor.txt.$txt.outerHeight();if(topResult>menuHeight+txtHeight){topResult=menuHeight+txtHeight+5}$toolbar.css({top:topResult,left:left})}function show(){if(isShow){return}if(!$currentLink){return}render();$toolbar.show();var href=$currentLink.attr("href");$triggerLink.attr("href",href);setPosition();isShow=true}function hide(){if(!isShow){return}if(!$currentLink){return}$toolbar.hide();isShow=false}$txt.on("mouseenter","a",function(e){if(showTimeoutId){clearTimeout(showTimeoutId)}showTimeoutId=setTimeout(function(){var a=e.currentTarget;var $a=$(a);$currentLink=$a;var $img=$a.children("img");if($img.length){$img.click(function(e){hide()});if($img.hasClass("clicked")){return}}show()},500)}).on("mouseleave","a",function(e){if(hideTimeoutId){clearTimeout(hideTimeoutId)}hideTimeoutId=setTimeout(hide,500)}).on("click keydown scroll",function(e){setTimeout(hide,100)});$toolbar.on("mouseenter",function(e){if(hideTimeoutId){clearTimeout(hideTimeoutId)}}).on("mouseleave",function(e){if(showTimeoutIdByToolbar){clearTimeout(showTimeoutIdByToolbar)}showTimeoutIdByToolbar=setTimeout(hide,500)})})});_e(function(E,$){E.plugin(function(){var editor=this;var menuFixed=editor.config.menuFixed;if(menuFixed===false||typeof menuFixed!=="number"){
return}var bodyMarginTop=parseFloat(E.$body.css("margin-top"),10);if(isNaN(bodyMarginTop)){bodyMarginTop=0}var $editorContainer=editor.$editorContainer;var editorTop=$editorContainer.offset().top;var editorHeight=$editorContainer.outerHeight();var $menuContainer=editor.menuContainer.$menuContainer;var menuCssPosition=$menuContainer.css("position");var menuCssTop=$menuContainer.css("top");var menuTop=$menuContainer.offset().top;var menuHeight=$menuContainer.outerHeight();var $txt=editor.txt.$txt;E.$window.scroll(function(){if(editor.isFullScreen){return}var sTop=E.$window.scrollTop();var menuWidth=$menuContainer.width();if(menuTop===0){menuTop=$menuContainer.offset().top;editorTop=$editorContainer.offset().top;editorHeight=$editorContainer.outerHeight();menuHeight=$menuContainer.outerHeight()}if(sTop>=menuTop&&sTop+menuFixed+menuHeight+30<editorTop+editorHeight){$menuContainer.css({position:"fixed",top:menuFixed});$menuContainer.width(menuWidth);E.$body.css({"margin-top":bodyMarginTop+menuHeight});if(!editor._isMenufixed){editor._isMenufixed=true}}else{$menuContainer.css({position:menuCssPosition,top:menuCssTop});$menuContainer.css("width","100%");E.$body.css({"margin-top":bodyMarginTop});if(editor._isMenufixed){editor._isMenufixed=false}}})})});_e(function(E,$){E.createMenu(function(check){var menuId="indent";if(!check(menuId)){return}var editor=this;var menu=new E.Menu({editor:editor,id:menuId,title:"缩进",$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-indent-left"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-indent-left"></i></a>')});menu.clickEvent=function(e){var elem=editor.getRangeElem();var p=editor.getSelfOrParentByName(elem,"p");var $p;if(!p){return e.preventDefault()}$p=$(p);function commandFn(){$p.css("text-indent","2em")}editor.customCommand(e,commandFn)};menu.clickEventSelected=function(e){var elem=editor.getRangeElem();var p=editor.getSelfOrParentByName(elem,"p");var $p;if(!p){return e.preventDefault()}$p=$(p);function commandFn(){$p.css("text-indent","0")}editor.customCommand(e,commandFn)};menu.updateSelectedEvent=function(){var elem=editor.getRangeElem();var p=editor.getSelfOrParentByName(elem,"p");var $p;var indent;if(!p){return false}$p=$(p);indent=$p.css("text-indent");if(!indent||indent==="0px"){return false}return true};editor.menus[menuId]=menu})});_e(function(E,$){E.createMenu(function(check){var menuId="lineheight";if(!check(menuId)){return}var editor=this;editor.commandHooks.lineHeight=function(value){var rangeElem=editor.getRangeElem();var targetElem=editor.getSelfOrParentByName(rangeElem,"p,h1,h2,h3,h4,h5,pre");if(!targetElem){return}$(targetElem).css("line-height",value+"")};var menu=new E.Menu({editor:editor,id:menuId,title:"行高",commandName:"lineHeight",$domNormal:$('<a href="#" tabindex="-1"><i class="wangeditor-menu-img-arrows-v"></i></a>'),$domSelected:$('<a href="#" tabindex="-1" class="selected"><i class="wangeditor-menu-img-arrows-v"></i></a>')});var data={"1.0":"1.0倍",1.5:"1.5倍",1.8:"1.8倍","2.0":"2.0倍",2.5:"2.5倍","3.0":"3.0倍"};var tpl='<span style="line-height:{#commandValue}">{#title}</span>';menu.dropList=new E.DropList(editor,menu,{data:data,tpl:tpl});editor.menus[menuId]=menu})});_e(function(E,$){E.plugin(function(){var editor=this;var customUpload=editor.config.customUpload;if(!customUpload){return}else if(editor.config.uploadImgUrl){alert("自定义上传无效，详看浏览器日志console.log");E.error("已经配置了 uploadImgUrl ，就不能再配置 customUpload ，两者冲突。将导致自定义上传无效。");return}var $uploadContent=editor.$uploadContent;if(!$uploadContent){E.error("自定义上传，无法获取 editor.$uploadContent")}var $uploadIcon=$('<div class="upload-icon-container"><i class="wangeditor-menu-img-upload"></i></div>');$uploadContent.append($uploadIcon);var btnId="upload"+E.random();var containerId="upload"+E.random();$uploadIcon.attr("id",btnId);$uploadContent.attr("id",containerId);editor.customUploadBtnId=btnId;editor.customUploadContainerId=containerId})});_e(function(E,$){E.info("本页面富文本编辑器由 wangEditor 提供 http://wangeditor.github.io/ ")});_e(function(E,$){window.wangEditor.plugin(function(){var editor=this;var $txt=editor.$txt;var listStyle={OL:["decimal","lower-alpha","upper-alpha","lower-roman","upper-roman"],UL:["disc","circle","square","disc","circle"]};$txt.on("keyup",function(ev){if(ev.keyCode==9){_tabEvent()}});function findParent(node,filterFn,includeSelf){if(node){node=includeSelf?node:node.parentNode;while(node){if(!filterFn||filterFn(node)){return filterFn&&!filterFn(node)?null:node}node=node.parentNode}}return null}function insertLi(node){var nextSibling=node.nextSibling||"";var previousSibling=node.previousSibling||"";var hasNextSbiling=nextSibling&&/[ou]l/i.test(nextSibling.tagName);var hasPreviousSbiling=previousSibling&&/[ou]l/i.test(previousSibling.tagName);var level=checkLevelFromLi(node);if(hasPreviousSbiling&&hasNextSbiling){var nextSbChilds=nextSibling.childNodes;var pre=previousSibling;var length=nextSbChilds.length;previousSibling.appendChild(node);for(var i=0;i<nextSibling.childNodes.length;){pre.appendChild(nextSbChilds[i])}if(!$(nextSibling).html()){$(nextSibling).remove()}}else if(hasNextSbiling){nextSibling.insertBefore(node,nextSibling.childNodes[0])}else if(hasPreviousSbiling){previousSibling.appendChild(node)}else{var parentLi=node.parentNode,list=document.createElement(parentLi.tagName);if(level<5){list=listStyleHandler(level,list)}parentLi.insertBefore(list,node);list.appendChild(node)}}function listStyleHandler(level,list){var style=listStyle[list.tagName.toUpperCase()][level];list.style["listStyleType"]=style;return list}function checkLevelFromLi(li){var level=li.parentNode,levelNum=0;while(/[ou]l/i.test(level.tagName)){levelNum++;level=level.parentNode}return levelNum}function checkLevelFromUl(parentNode){var level=parentNode,levelNum=0;while(/[ou]l/i.test(level.tagName)){levelNum++;level=level.firstChild}return levelNum}function _tabEvent(e){var maxListLevel=5;var range=editor.currentRange();var li=findParent(range.startContainer,function(node){if(node.nodeType==3){return false}else if(node.tagName&&node.tagName.toUpperCase()=="LI"){return true}else{return false}});if(!li)return;if(range.endOffset==4){li.innerHTML=li.innerHTML.replace(/^(&nbsp;)*/,"");insertLi(li);editor.restoreSelectionByElem(li,"start")}}});window.wangEditor.plugin(function(){var editor=this;var txt=editor.txt;var $txt=txt.$txt;var html="";var $currentTxt=editor.useMaxHeight?$txt.parent():$txt;var $currentTable;var $currentTd;var $currentTr;var isRendered=false;var $toolbar=$('<div class="table-toolbar"></div>');var $triangle=$('<div class="tip-triangle"></div>');var $delete=$('<div class="table-item">删除表格</div>');var $delTd=$('<div class="table-item">删除当前列</div>');var $insertTdRight=$('<div class="table-item">插入整列</div>');var $delTr=$('<div class="table-item">删除当前行</div>');var $insertTrBottom=$('<div class="table-item">插入整行</div>');if(editor.queryCommandSupported("enableObjectResizing")){document.execCommand("enableObjectResizing",false,"false")}function render(){if(isRendered){return}bindEvent();$toolbar.append($triangle).append($delete).append($delTd).append($insertTdRight).append($delTr).append($insertTrBottom);editor.$editorContainer.append($toolbar);isRendered=true}function getCurrentTd(){var range=editor.currentRange();if(E.w3cRange){currentTd=range.startContainer}else{currentTd=range.parentElement()}if(currentTd.nodeType==3){currentTd=currentTd.parentNode}if(currentTd.tagName.toUpperCase()=="TD"){return $(currentTd)}else{return""}}function bindEvent(){var commandFn;function command(e,callback){html=$txt.html();var cb=function(){if(callback){callback()}if(html!==$txt.html()){$txt.change()}};if(commandFn){editor.customCommand(e,commandFn,cb)}}$delete.click(function(e){commandFn=function(){$currentTable.remove()};command(e,function(){setTimeout(hide,100)})});$delTr.click(function(e){commandFn=function(){$currentTr.remove();if(!$currentTable.find("tr").length){$currentTable.remove()}};command(e,function(){setTimeout(hide,100)})});$insertTrBottom.click(function(e){commandFn=function(){var tdLength=$currentTr.find("td").length,$newTr=$("<tr></tr>");for(var i=0;i<tdLength;i++){var $newTd=$("<td>&nbsp;</td>");$newTr.append($newTd)}$currentTr.after($newTr)};command(e,function(){setTimeout(show)})});$delTd.click(function(e){commandFn=function(){var tdIndex=$currentTd.get(0).cellIndex;var trArray=$currentTable.find("tr");var td;if(tdIndex==-1)return;for(var i=0;i<trArray.length;i++){td=$(trArray[i]).find("td:eq("+tdIndex+")");$(td).remove()}if(!$currentTable.find("td").length){$currentTable.remove()}};command(e,function(){setTimeout(hide,100)})});$insertTdRight.click(function(e){commandFn=function(){var tdIndex=$currentTd.get(0).cellIndex;var trArray=$currentTable.find("tr");var td;if(tdIndex==-1)return;for(var i=0;i<trArray.length;i++){td=$("<td>&nbsp;</td>");trArray.eq(i).find("td:eq("+tdIndex+")").after(td)}};command(e,function(){setTimeout(hide)})})}function show(){if(editor._disabled){return}if($currentTable==null){return}var tablePosition=$currentTable.position();var tableTop=tablePosition.top;var tableLeft=tablePosition.left;var tableHeight=$currentTable.outerHeight();var tableWidth=$currentTable.outerWidth();if(!$currentTd)return;var currentTdPosition=$currentTd.position();var currentTdWidth=$currentTd.width();$currentTd.addClass("tableTdSelect");var top=currentTdPosition.top+$currentTd.outerHeight()/2;var left=currentTdPosition.left+currentTdWidth/2;var marginLeft=0;var txtTop=$currentTxt.position().top;var txtHeight=$currentTxt.outerHeight();if(top>txtTop+txtHeight){top=txtTop+txtHeight}$toolbar.show();var width=$toolbar.outerWidth();$toolbar.css({top:top+5,left:left});if(marginLeft<0){$toolbar.css("margin-left","0");$triangle.hide()}else{$triangle.show()}}function hide(){if($currentTable==null){return}$currentTable.find(".tableTdSelect").removeClass("tableTdSelect");$currentTable=null;$toolbar.hide()}editor.$valueContainer.on("contextmenu","table",function(){return false});$currentTxt.on("mousedown","table",function(e){if(e.button==2){$currentTd=$(e.target);if($currentTd.get(0).tagName.toUpperCase!="TD"){$currentTd=$currentTd.closest("td")}$currentTr=$(e.target).closest("tr");var $table=$(e.currentTarget);render();if($currentTable&&$currentTable.get(0)===$table.get(0)){setTimeout(hide,100);return}$currentTable=$table;show();e.preventDefault();e.stopPropagation()}});$("body").on("click keydown scroll mousedown",function(e){setTimeout(hide)});$toolbar.on("click keydown scroll mousedown",function(e){e.stopPropagation()})});window.wangEditor.createMenu(function(check){var menuId="more";if(!check(menuId)){return}var editor=this;var menus=editor.menus;var menu=new E.Menu({editor:editor,id:menuId,title:"更多",$domNormal:$('<a href="javascript:void(0)" tabindex="-1">更多<i class="tip-triangle"></i></a>'),$domSelected:$('<a href="javascript:void(0)" tabindex="-1" class="selected">更多<i class="tip-triangle"></i></a>')});var $container=$('<div class="more"></div>');var currentGroupIdx=0;var $currentGroup="";var panelW=0;var initMenuUI=function(menuId,menu){var uiConfig=editor.UI.menus;var menuUI=uiConfig[menuId];if(menu.$domNormal&&menu.$domSelected){return}if(menuUI==null){E.warn('editor.UI配置中，没有菜单 "'+menuId+'" 的UI配置，只能取默认值');menuUI=uiConfig["default"]}menu.$domNormal=$(menuUI.normal);if(/^\./.test(menuUI.selected)){menu.$domSelected=menu.$domNormal.clone().addClass(menuUI.selected.slice(1))}else{menu.$domSelected=$(menuUI.selected)}};var appendMenu=function(groupIdx,menu){addGroup(groupIdx);return addOneMenu(menu)};var addGroup=function(groupIdx){var $menuContainer=$container;var $menuGroup;if(!$currentGroup||currentGroupIdx!==groupIdx){$menuGroup=$('<div class="menu-group clearfix"></div>');panelW+=17;$menuContainer.append($menuGroup);currentGroupIdx=groupIdx;$currentGroup=$menuGroup}};var addOneMenu=function(menu){var $menuNormal=menu.$domNormal;var $menuSelected=menu.$domSelected;var $menuGroup=$currentGroup;var $item=$('<div class="menu-item clearfix"></div>');panelW+=35;$menuSelected.hide();$item.append($menuNormal).append($menuSelected);$menuGroup.append($item);return $item};var menuRnder=function(groupIdx,menuId,menu){initMenuUI(menuId,menu);var $menuItem=appendMenu(groupIdx,menu);menu._renderTip($menuItem);if(menu.onRender&&typeof menu.onRender==="function"){menu.onRender.call(this)}};var renderMenus=function(){if(!editor.moreMenu)return;var menus=editor.menus;var menuIds=editor.moreMenu;var menu;var groupIdx=0;$.each(menuIds,function(k,v){if(v==="|"){groupIdx++;return}menu=menus[v];if(menu){menuRnder(groupIdx,v,menu)}})};renderMenus();menu.dropPanel=new E.DropPanel(editor,menu,{$content:$container,width:panelW+40});editor.menus[menuId]=menu});window.wangEditor.plugin(function(){var editor=this;var n=0;editor.moreMenu=[];var menuSet=function(){var maxMenuWidth=editor.$editorContainer.width()-40;var menuWidth=0;var menus=editor.menus;var menuIds=editor.config.menus;var normalMenus=[];var moreMenus=[];var extraMenu=[];maxMenuWidth=maxMenuWidth>331?maxMenuWidth:401;$.each(menuIds,function(k,v){if(v=="more"){menuIds.pop()}});var allMenusId=menuIds.concat(editor.moreMenu);var length=allMenusId.length;editor.moreMenu=[];for(var i=0;i<length;i++){if(allMenusId[i]=="|"){menuWidth+=16}else{menuWidth+=35}if(menuWidth>maxMenuWidth){moreMenus.push(allMenusId[i])}else{normalMenus.push(allMenusId[i])}}if(moreMenus.length){editor.moreMenu=[];var n=normalMenus.length-2;extraMenu=normalMenus.splice(n,2);normalMenus.push("more");editor.moreMenu=extraMenu.concat(moreMenus)}editor.config.menus=normalMenus;editor.$editorContainer.find(".wangEditor-menu-container").empty();editor.addMenus();editor.renderMenus();editor.eventMenus();editor.readyHeadler();editor.eventMenuContainer();var imageUI=function(){var config=editor.config;var uploadImgUrl=config.uploadImgUrl;var uploadTimeout=config.uploadTimeout;var event;var $uploadContent=editor.$uploadContent;if(!$uploadContent){return}var $uploadIcon=$('<div class="upload-icon-container upload_new_file img"><i class="tu-icon-angleup-circle"></i></div>');$uploadContent.append($uploadIcon)};imageUI()};menuSet();var throttle=function(fn,delay,atleast){var timer=null;var previous=null;return function(){var now=+new Date;if(!previous)previous=now;if(now-previous>atleast){fn();previous=now}else{clearTimeout(timer);timer=setTimeout(function(){fn()},delay)}}()};$(window).off("resize.wangEditor-menu");$(window).on("resize.wangEditor-menu",function(){menuSet()})});window.wangEditor.plugin(function(){var editor=this;var text=editor.$txt.text();var html=editor.$txt.html();var config=editor.config;var editorContainer=editor.$valueContainer.parent();var $placeholder="";if(!config.placeholder)return;$placeholder='<label class="placeholder" data-name="placeholder" for="'+config.containerId+'">'+config.placeholder+"</label>";editorContainer.append($placeholder);editor.$placeholder=editorContainer.find("[data-name=placeholder]");editor._placeShow=function(txt){var imgs=editor.$txt.find("img");var tables=editor.$txt.find("table");var lis=editor.$txt.find("li");if($.trim(txt)||imgs.length||tables.length||lis.length){editor.$placeholder.hide();editor.hasContent=true}else{editor.$placeholder.show();editor.hasContent=false}};editor._placeShow(text);editor.$txt.on("propertychange change click keyup input paste",function(e){var txt=editor.$txt.text();editor._placeShow(txt)})});window.wangEditor.plugin(function(){var editor=this,options=Talent.Context.getUploadOptions();options["onAfterUpload"]=function(resp){return resp.Result[0].ClientUrl};var upload=new Uploader.UploaderView({container:editor.$uploadContent,validate:{format:["jpeg","JPEG","jpg","JPG","gif","GIF","png","PNG"],onceLimt:5,allLimt:-1,nameLimt:-1,fileSize:50*1024*1024},callbackName:options.callbackName,callbackValue:options.callbackValue,url:options.url,ajaxUrl:options.ajaxUrl,fileInputName:options.fileInputName,extendData:options.extendData,pasteNode:editor.$valueContainer,isPaste:true,isDrag:true});upload.render();upload.on("uploadEnd",function(resp){if(editor.hasPasteImg){editor.hasPasteImg=false;return}var url=options.onAfterUpload(resp);var html='<img src="'+url+'" style="max-width:100%;"/>';editor.command(null,"insertHtml",html)})});window.wangEditor.plugin(function(){var editor=this;var editorContainer=editor.$editorContainer;editor.$extraArea=$('<div class="editor-extra-area"></div>');if(!editor.config.hasBtns&&!editor.config.maxWords)return;editorContainer.append(editor.$extraArea);if(editor.config.hasBtns){var buttonArea='<div class="editor-button-area">'+'<button class="tu-btn tu-btn-small" data-editor="concel">取消</button>'+'<button class="tu-btn tu-btn-small tu-btn-sure" data-editor="ok">确定</button>'+"</div>";editor.$extraArea.append(buttonArea)}editor.$okBtn=editor.$extraArea.find('[data-editor="ok"]');editor.$concelBtn=editor.$extraArea.find('[data-editor="concel"]');if(editor.config.maxWords){var errorWords='您已输入 <span data-name="extraWords"></span> 个字，最多可输入'+editor.config.maxWords+"字";var errorTip='<div class="error-tip tu-font-a2" data-editor="error-tip">'+errorWords+"</div>";editor.$extraArea.prepend(errorTip);editor.$errorTip=editor.$extraArea.find('[data-editor="error-tip"]');var txt=$.trim(editor.$txt.text());var wordsTest=function(txt){if(txt&&txt.length>editor.config.maxWords){editor.$errorTip.show();editor.$errorTip.find("[data-name=extraWords]").text(txt.length);editor.$extraArea.toggleClass("editor-extra-area",true);editor.hasError=true;editor.$okBtn.addClass("disabled")}else{editor.$errorTip.hide();editor.$extraArea.toggleClass("editor-extra-area",false);editor.hasError=false;editor.$okBtn.removeClass("disabled")}if(editor.config.hasBtns){editor.$extraArea.toggleClass("editor-extra-area",true)}};wordsTest(txt);editor.$txt.on("propertychange change click keyup input paste",function(e){wordsTest($.trim(editor.$txt.text()))})}});window.wangEditor.plugin(function(){var editor=this;editor.fillContent=function(content){content=content?content:"<p><br></p>";editor.$txt.html(content)};editor.close=function(){editor.$txt.empty();editor.$txt.removeClass("wangEditor-txt").removeAttr("contenteditable style");editor.$editorContainer.after(editor.$txt);editor.$editorContainer.remove();editor.$extraArea.remove()};editor.$valueContainer.toggleClass("editor-style",true);editor.$valueContainer.on("focus",function(){editor.$editorContainer.css("borderColor","#1687D9")});editor.$valueContainer.on("blur",function(){editor.$editorContainer.css("borderColor","#a9b8bf")})})});return window.wangEditor});var apiServer=BSGlobal.apiPath;var Context={getGlobal:function(key){return BSGlobal[key]},changeHash:function(obj,status,refresh){var hash=decodeURIComponent(location.hash),hashArr=hash.split("?"),paras=Context.parseUrl(hash),parasUrl=[];url=null;refresh=refresh==true?true:false;if(paras["iTalentFrame"]){paras["iTalentFrame"]=encodeURIComponent(paras.iTalentFrame)}if(status=="deleted"){for(var i=0,len=obj.length;i<len;i++){delete paras[obj[i]]}}if(status=="add"){paras=Talent._.extend({},paras,obj)}if(status=="eidt"){paras=Talent._.extend({},paras,obj)}for(var key in paras){parasUrl.push(key+"="+paras[key])}if(parasUrl.length){url=hashArr[0]+"?"+parasUrl.join("&")}else{url=hashArr[0]}Talent.app.execute("history:navigate",url,refresh)},getLocalStorage:function(){if(typeof localStorage=="object"){return localStorage}else if(typeof globalStorage=="object"){return globalStorage[location.host]}else{throw new Error("local storage not available")}},deleteGlobalProp:function(key){delete BSGlobal[key]},localStorage:function(){var storage=window.localStorage,store={};store.serialize=function(value){return JSON.stringify(value)};store.deserialize=function(value){if(typeof value!="string"){return undefined}try{return JSON.parse(value)}catch(e){return value||undefined}};store.set=function(key,val){if(val===undefined){return store.remove(key)}storage.setItem(key,store.serialize(val));return val};store.get=function(key,expireTime){var val=store.deserialize(storage.getItem(key));if(_.isNumber(expireTime)&&_.isObject(val)&&!_.isEmpty(val)){var nowTime=(new Date).getTime(),__setTime=val.__setTime;if(_.isNumber(__setTime)){if(nowTime-__setTime>expireTime){store.remove(key);val=undefined}}}return val};store.remove=function(key){storage.removeItem(key)};store.clear=function(){storage.clear()};store.forEach=function(callback){for(var i=0;i<storage.length;i++){var key=storage.key(i);callback(key,store.get(key))}};store.getAll=function(){var ret={};store.forEach(function(key,val){ret[key]=val});return ret};store.hasProperty=function(key){return storage.hasOwnProperty(key)};return{set:store.set,get:store.get,remove:store.remove,clear:store.clear,getAll:store.getAll,hasProperty:store.hasProperty}},setGlobal:function(key,value){BSGlobal[key]=value},getTenantInfo:function(){return BSGlobal.tenantInfo},getUserInfo:function(){return BSGlobal.loginUserInfo},getUserUrl:function(userId){var userInfo=this.getUserInfo();var urlHost=this.getGlobal("titaHost");var homeUrl=urlHost+"/"+userInfo.Id+"/PageBuilderForEdit#/view?to_user_id="+userId,homeCenter=urlHost+"/u/"+userInfo.Id+"/Home#"+encodeURIComponent("widget/italent?iTalentFrameType=iframe&iTalentFrame="+encodeURIComponent(homeUrl));return homeCenter},getStaticUrl:function(url){var staticServer="../../images/components/tita-widget"||"//st-web.tita.com/app/images";return staticServer+"/"+url},getApiUrl:function(url){var uid=this.getUserInfo().Id;var tid=this.getTenantInfo().Id;return apiServer+"/api/v1/"+tid+"/"+uid+"/"+url},getApiUrlV2:function(url){var uid=this.getUserInfo().Id;var tid=this.getTenantInfo().Id;return apiServer+"/api/v2/"+tid+"/"+uid+"/"+url},parseUrl:function(fragmentStr){var queryObject={};if(!fragmentStr)return queryObject;var markIndex=fragmentStr.indexOf("?");if(markIndex>-1){var queryString=fragmentStr.slice(markIndex+1);var queryArray=queryString.split("&");for(var i=0;i<queryArray.length;i++){var queryPair=queryArray[i].split("=");queryObject[queryPair[0]]=decodeURIComponent(queryPair[1])}}return queryObject},getI18n:function(){var i18n={home_1:"动态",plan_1:"计划",work_1:"项目",document_1:"文件",workmate_1:"同事",app_1:"应用",task_1:"任务",task_2:"循环任务",schedule_1:"日程",share_1:"分享",sharing_1:"分享",follow_1:"立即关注",following_1:"正在关注",cancelfollow_1:"取消关注",myfollowmate_1:"我关注的",myfans_1:"我的粉丝",publishshare_1:"发分享",publishtask_1:"派任务",myfollowfeed_1:"与我相关",mypublishfeed_1:"我发表的",myleavefeed_1:"@我的",myreplayfeed_1:"回复我的",mycollectfeed_1:"我收藏的",myallfeed_1:"所有动态",message_1:"消息",remind_1:"提醒",myschedule_1:"我的日程",href_1:"常用链接",invitemate_1:"邀请同事",helpcenter_1:"帮助中心",onlineuser_1:"在线同事"};var localI18n={guide_1:"打开导览"};if(BSGlobal&&BSGlobal.BSi18n){return Talent._.extend({},BSGlobal.BSi18n,localI18n)}return Talent._.extend({},i18n,localI18n)},getAttachmentType:function(argument){return{image:["jpg","png","gif","jpeg","JPG","PNG","GIF","JPEG"],file:["rar","zip","exe","pdf","txt","doc","docx","ppt","pptx","XLS","XLSX","RAR","ZIP","EXE","PDF","TXT","DOC","DOCX","PPT","PPTX","XLS","XLSX"],music:["mp3","wma","wav","flac","ape","ogg","aac","m4a","MP3","WMA","WAV","FLAC","APE","OGG","AAC","M4A"],video:["mp4","mkv","rm","rmvb","avi","3gp","flv","wmv","asf","mpeg","mpg","mov","ts","m4v"]}},getUploadOptions:function(options){var evn=this.getGlobal("evn");var host=evn&&evn=="develop"?"tita-inc.com":"tita.com";var alloptions={validate:{format:[],onceLimt:20,allLimt:-1,nameLimt:-1,fileSize:50*1024*1024},callbackName:"jsCallback",url:this.getApiUrl("Upload/PostFiles"),ajaxUrl:this.getApiUrl("Upload/PostFiles?format=json"),fileInputName:"file_upload",extendData:{domain:"document.domain="+host},error:{error_allLimt:"文件超出最大限度",error_format:"文件格式不合法",error_nameLimt:"名字长度不合格"},isPaste:true,isDrag:true,callbackValue:"parent._callback_"};if(options){alloptions=Talent._.extend({},alloptions,options)}return alloptions},isAbsolutePath:function(){var titaHost=this.getGlobal("titaHost")||"";var host="//"+location.host;var webHost="";if(titaHost==host&&window.top===window.self){webHost=""}else{webHost=titaHost+"/"+this.getUserInfo().Id+"/ITalentHome"}return{host:titaHost,webHost:webHost}},encodeScript:function(Content){if(Content.length==0)return"";s=Content.replace(/</g,"&lt;");s=s.replace(/>/g,"&gt;");return s},dencodeScript:function(Content){if(Content.length==0)return"";s=Content.replace(/&lt;/g,"<");s=s.replace(/&gt;/g,">");return s},formatDate:function(date,mothAll){if(!date)return date;var year=moment().year();var s_date=date.split(" ");if(moment(new Date(date)).year()==year){if(s_date[1]){if(mothAll){date=moment(new Date(date)).format("MM/DD HH:mm")}else{date=moment(new Date(date)).format("M/D HH:mm")}}else{if(mothAll){date=moment(new Date(date)).format("MM/DD")}else{date=moment(new Date(date)).format("M/D")}}}return date},setPosition:function(node,dialogView,options){var defaults={container:Talent.$("body"),pos:"bottom",leftBias:0,topBias:0,autoFrames:"body"};var options=Talent._.extend({},defaults,options);var container=options.container||Talent.$("body"),containerOff=container.offset();var domOff=node.offset();var domH=node.outerHeight();var domW=node.outerWidth();var dialogW=dialogView.outerWidth();var dialogH=dialogView.outerHeight();var elPos={};var arrowPosition={};var arrowClass="";var domOffTop=domOff.top;var domOffLeft=domOff.left;var top=domOffTop-containerOff.top,left=domOffLeft-containerOff.left;switch(options.pos){case"top":{elPos={top:top-dialogH,left:left};arrowClass="bottom"}break;case"topCenter":{elPos={top:top-dialogH,left:left+domW/2-dialogW/2};arrowClass="bottom"}break;case"topRight":{elPos={top:top-dialogH,left:left+domW-dialogW};if(elPos.left<0){elPos.left=0}arrowClass="bottom"}break;case"bottom":{elPos={top:top+domH,left:left};arrowClass="top"}break;case"bottomCenter":{elPos={top:top+domH,left:left+domW/2-dialogW/2};arrowClass="top"}break;case"bottomRight":{elPos={top:top+domH,left:left+domW-dialogW};if(elPos.left<0){elPos.left=0}arrowClass="top"}break;case"left":{elPos={top:top,left:left-dialogW};arrowClass="right"}break;case"leftCenter":{elPos={top:top+domH/2-dialogH/2,left:left-dialogW};arrowClass="right"}break;case"leftBottom":{elPos={top:top+domH-dialogH,left:left-dialogW};arrowClass="right"}break;case"right":{elPos={top:top,left:left+domW};arrowClass="left"}break;case"rightCenter":{elPos={top:top+domH/2-dialogH/2,left:left+domW};arrowClass="left"}break;case"rightBottom":{elPos={top:top+domH-dialogH,left:left+domW};arrowClass="left"}break}if(options.leftBias){elPos.left=elPos.left+options.leftBias}if(options.topBias){elPos.top=elPos.top+options.topBias}var windowH=Talent.$(window).height(),windowW=Talent.$(window).width(),scrollTop=Talent.$(document).scrollTop(),scrollLeft=Talent.$(document).scrollLeft();if(containerOff.top+elPos["top"]+dialogH>windowH+scrollTop){var chaz=windowH+scrollTop-(containerOff.top+elPos["top"]+dialogH);elPos["top"]=elPos["top"]+chaz}if(containerOff.top+elPos["top"]<scrollTop){var chaz=scrollTop-(containerOff.top+elPos["top"]);elPos["top"]=elPos["top"]+chaz}if(containerOff.left+elPos["left"]+dialogW>windowW+scrollLeft){var chaLeft=windowW+scrollLeft-(containerOff.left+elPos["left"]+dialogW);elPos["left"]=elPos["left"]+chaLeft}if(containerOff.left+elPos["left"]<scrollLeft){var chaLeft=scrollLeft-(containerOff.left+elPos["left"]);elPos["left"]=elPos["left"]+chaLeft}dialogView.css(elPos)},IsOpenYifangyun:function(){var webHead=Talent.Context.getGlobal("WebHead")||{},appHead=webHead["AppHead"]||[];if(!appHead.length)return false;var appItem=_.findWhere(appHead,{AppId:"801"});if(appItem){return true}else{return false}},getUploadTipText:function(){return'<div style="text-align:left"><b style="display:block;font-size:14px;">支持拖拽上传<br>最多一次能上传20个</b>大小不超过20M</div>'},getAppHead:function(options){var appHead=this.getGlobal("WebHead"),apps=this.getGlobal("apps");if(!appHead&&apps)return;var app=appHead&&appHead.AppHead||apps&&apps||[];var appItem=Talent._.findWhere(app,options);if(appItem){return appItem}else{return null}},skipToTmHome:function(code){var tmHost=this.getGlobal("tm"),env=this.getGlobal("env"),menuId,menuUrl,tmUrl;switch(code){case"employee":menuId=10361;menuUrl="//admin.tita.com/menuroute?menuId=10361&roleId=";break}if(env=="Production"){return tmHost+"#widget"+encodeURIComponent("/italent?iTalentNavId="+menuId+"&iTalentFrameType=iframe&iTalentFrame="+encodeURIComponent(menuUrl))}else{return tmHost}}};_.TitaWidget_substring=function(str,len,hasDot){if(!str)return"";var newLength=0;var newStr="";var chineseRegex=/[^\x00-\xff]/g;var singleChar="";var strLength=str.replace(chineseRegex,"**").length;for(var i=0;i<strLength;i++){singleChar=str.charAt(i).toString();if(singleChar.match(chineseRegex)!=null){newLength+=2}else{newLength+=1}if(hasDot&&strLength>len){if(newLength+2>len){break}}if(newLength>len)break;newStr+=singleChar}if(hasDot&&strLength>len){newStr+="…"}return newStr};_.substring=function(str,len,hasDot){if(!str)return"";var newLength=0;var newStr="";var chineseRegex=/[^\x00-\xff]/g;var singleChar="";var strLength=str.replace(chineseRegex,"**").length;for(var i=0;i<strLength;i++){singleChar=str.charAt(i).toString();if(singleChar.match(chineseRegex)!=null){newLength+=2}else{newLength+=1}if(hasDot&&strLength>len){if(newLength+2>len){break}}if(newLength>len)break;newStr+=singleChar}if(hasDot&&strLength>len){newStr+="…"}return newStr};_.substringWithM=function(str,len,hasDot){var newLength=0;var newStr="";var chineseRegex=/[^\x00-\xff]/g;var singleChar="";var strLength=str.replace(chineseRegex,"**").length;for(var i=0;i<strLength;i++){singleChar=str.charAt(i).toString();if(singleChar.match(chineseRegex)!=null){newLength+=2}else if(singleChar=="m"||singleChar=="w"){newLength+=2}else{newLength++}if(newLength>len){break}newStr+=singleChar}if(hasDot&&strLength>len){newStr+="…"}return newStr};_.isStringBeyondLength=function(str,len){var chineseRegex=/[^\x00-\xff]/g;var strLength=str.replace(chineseRegex,"**").length;if(strLength>len){return true}else{return false}};_.convertImage=function(obj){var html="";var obj=obj||{};var defults={className:"",size:30,shape:"radius",name:"",src:"",href:false,userId:"",target:"_blank",isExternal:false};var userInfo=Context.getUserInfo();obj=_.extend({},defults,obj);if(obj.bgColor){if(obj.size==50){obj.subName=_.substring(obj.name,6,false)}else if(obj.size==30){obj.subName=_.substring(obj.name,3,false)}else if(obj.size==64){obj.subName=_.substring(obj.name,6,false)}else if(obj.size==80){obj.subName=_.substring(obj.name,6,false)}else if(obj.size==100){obj.subName=_.substring(obj.name,8,false)}else if(obj.size==150){obj.subName=_.substring(obj.name,10,false)}html=['<span class="',obj.shape,"_img",obj.size," ",obj.className,'" style="background-color:',obj.bgColor,';"  original-title="',obj.name,'" data-body="',obj.name,'">',obj.subName,"</span>"].join("")}else{html=['<img class="',obj.shape,"_img",obj.size," ",obj.className,'" width="',obj.size,'" height="',obj.size,'" src="',obj.src,'" original-title="',obj.name,'" data-body="',obj.name,'" />'].join("")}if(obj.tag!=undefined){html+='<div class="avatar_tag"'+'original-title="'+obj.tag+'"'+(obj.bgColor?"":' style="background-color: '+obj.tagColor+'"')+">"+obj.tag.substring(0,4)+"</div>"}var isAddLink=false;var href;if(obj.href&&typeof obj.href==="string"&&obj.href!==""&&!obj.isExternal){isAddLink=true;href=obj.href}if(obj.userId&&obj.userId!==""&&!obj.isExternal){isAddLink=true;href=Context.getUserUrl(obj.userId)}if(isAddLink){html='<a href="'+href+'" target="'+obj.target+'">'+html+"</a>"}if(obj.isExternal){var target=userInfo.UserType!==2?'<span class="external-tag tu-ft_m8 tu-font-a2 tu-bg_f2 tu-tac">外</span>':"";html='<span class="avatar-img tu-dib">'+html+target+"</span>"}return html};_.convertUserName=function(options){var defults={userId:"",name:"",isExternal:false,isExternalClass:"",className:"",target:"_blank"};var configs=_.extend({},defults,options);if(!configs.userId||configs.userId==""){return""}var isExternalClass=configs.isExternalClass!=""?' class="'+configs.isExternalClass+'"':"";

if(configs.isExternal){return["<span",isExternalClass,">",configs.name,"</span>"].join("")}var className=configs.className!==""?' class="'+configs.className+'"':"";var url=Context.getUserUrl(configs.userId);var href=configs.userId!==""?" href="+url:" href="+"javascript:void(0);";var target=" target="+configs.target;return["<a",className,href,target,">",configs.name,"</a>"].join("")};_.TitaWidget_evaluation=function(obj,options){var medalValue={1:"太棒了！",2:"干的不错！",3:"再接再厉！"};var txtColor={1:"yellow",2:"blue",3:"red"};var medalIcon={1:"tu-icon-medal-solid",2:"tu-icon-like--solid",3:"tu-icon-heart-solid"};var obj=obj||{};var defults={type:1,value:"",lvl:5,goal:2};obj=_.extend({},defults,obj);obj["value"]=parseInt(obj["value"]);obj["type"]=parseInt(obj["type"]);var type=obj["type"];if(!obj["lvl"]){obj["lvl"]=5}if(!obj["goal"]){obj["goal"]=2}var html;if(type==1){html=['<span class="txt-green font20 obvious">',obj.value,"&nbsp;</span>","分"].join("")}if(type==2){html=['<span class="grade">','<span class="txt-'+txtColor[obj.value]+'">','<span class="font18 '+medalIcon[obj.value]+' ">',"</span>&nbsp;",medalValue[obj.value],"&nbsp;</span>","</span>"].join("")}return'<span class="tt_evaluation">'+html+"</span>"};var supportT=function(){var thisBody=document.body||document.documentElement,thisStyle=thisBody.style,support=thisStyle.WebkitAnimation!==undefined||thisStyle.webkitAnimation!==undefined||thisStyle.MozAnimation!==undefined||thisStyle.OAnimation!==undefined||thisStyle.msAnimation!==undefined||thisStyle.animation!==undefined;return support}();_.animate=function(node,animateName,speed,rules,callback){var animateName=animateName||"shake",speed=speed||"noraml",callback=callback||function(){};if(!supportT){callback();return}if(typeof speed=="number"){speed=speed*100}else if(speed==""){speed=3*100}else{speed={fast:200,normal:500,slow:1e3}[speed]||500}var klass=["UI_animated","UI_speed_"+speed,"UI_ani_"+animateName];node.addClass(klass.join(" "));var t=setTimeout(function(){node.removeClass(klass.join(" "));callback()},speed)};_.privateTipText=function(feedType,Private,objType,appType){var i18n=Context.getI18n();var isPrivate=Private;var HTML="仅相关人可见";if(!isPrivate){return"所有人可见"}else{if(appType){switch(appType){case 400:{HTML="仅你和你上级可见"}break;case 500:{HTML="仅你和你上级可见"}break;case 600:{HTML="仅相关成员可见"}break}}else if(objType){switch(objType){case 3:{HTML="仅团队成员可见"}break;case 4:{HTML="仅相关成员可见"}break;case 8:{if(feedType==4){HTML="仅共享者可见"}if(feedType==5){HTML="仅共享者可见"}}break;case 15:{HTML="仅发起者的部门可见"}break}}else if(feedType){switch(feedType){case 1:{HTML="仅@的人可见"}break;case 20:{HTML="仅相关成员可见"}break}}else{return"仅自己可见"}return HTML}};_.actionAnalysis=function(sign,feedId,step){var step=step?step:0;window.iTalentPMS?window.iTalentPMS._upAction(sign,feedId,null,step):""};_.performanceAnalysis=function(sign,time){window.iTalentPMS?window.iTalentPMS._up(sign,time):""};var util={rewardOpen:util_rewardOpen,rewardGetFile:util_rewardGetFile,italentSDK:util_italentSDK,userSelectorConfig:util_userSelectorConfig,sendMessageBySDK:util_sendMessageBySDK,getMessageBySDK:util_getMessageBySDK,upaasMedal:util_upaasMedal,upaasEnterpriseMedal:util_upaasEnterpriseMedal};function util_rewardOpen(){var isOpenReward=Context.getGlobal("rewardOpen");if(typeof isOpenReward=="undefined"){var header=Context.getGlobal("Header")||[];if(header.length){isOpenReward=Talent._.findWhere(header,{Code:"950"})?true:false;Context.setGlobal("rewardOpen",isOpenReward);return isOpenReward}header=Context.getGlobal("apps")||[];isOpenReward=Talent._.findWhere(header,{appId:950})?true:false;Context.setGlobal("rewardOpen",isOpenReward)}return isOpenReward}function util_upaasEnterpriseMedal(){function dealReqOpt(data){var count=0;return function(){if(count<data.length){var opt=data[count];count++;return opt}else{count=null;data=null;return false}}}function showModal(getItemOpt){var opt=getItemOpt();var version=window.__italent_common_cmps__&&window.__italent_common_cmps__.medal_version||"1.0.62";require(["//stnew03.beisen.com/ux/upaas/@talentui/dll-react/release/dist/dll-react-15.6.10.min.js"," //stnew03.beisen.com/ux/upaas/@talentui/dll-vue/release/dist/dll-vue-2.5.1.min.js"],function(react,vue){require(["css!//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.css","//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.js"],function(UxReward,MedalController){Medal&&Medal.closeModal();var Medal=__MedalController__&&new __MedalController__({zIndex:9999999999,onClose:function(){showModal(getItemOpt)},root:document.body});opt&&Medal.showNewMedal(opt)})})}function getMedalMsg(){var deferred=new Talent.$.Deferred;Talent.$.ajax({url:Context.getApiUrl("messages/Get?page_size=1000&page_num=1&status=1&app_type=-1&app_id=-1"),type:"GET",contentType:"application/json;charset=utf-8"}).done(function(resp){deferred.resolve(resp)});return deferred.promise()}function getMedalData(ids){var options={code:ids},deferred=new Talent.$.Deferred;Talent.$.ajax({url:Context.getApiUrl("proxy/PostUPaaSCoreGateway/CompanyMedal/CompanyMedalInfo"),type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(options)}).done(function(resp){deferred.resolve(JSON.parse(resp))});return deferred.promise()}getMedalMsg().done(function(res){Talent.app.vent.trigger("GlobalIndicatorDelete",{indicatorType:"1969002",messageType:"1"});function getMedalIds(msg){var ids=[];_.each(msg,function(item){var content=item.content;var messageType=item.messageType;var reg=/\$\d+\$/;if(messageType==32&&reg.test(content)){var id=reg.exec(content)[0].replace(/\$/g,"");ids.push(id)}});return ids}if(res&&res.Code==1){var data=res.Data||{};var messags=data.messags||[];var medalIds=getMedalIds(messags);if(medalIds.length){getMedalData(medalIds).done(function(res){var getItemOpt=dealReqOpt(res&&res.OperationObject||[]);showModal(getItemOpt)})}}})}function util_upaasMedal(){function dealReqOpt(data){var count=0;return function(){if(count<data.length){var opt=data[count];count++;return opt}else{count=null;data=null;return false}}}function getModalData(medalArgs){if(!medalArgs||medalArgs.length==0)return;modalAjax({medalArgs:medalArgs}).done(function(req){var getItemOpt=dealReqOpt(req&&req.OperationObject||[]);showModal(getItemOpt)})}function modalAjax(opts){var defaults={metaname:"Medal",funname:"UpgradeMedal",medalArgs:[]},options=Talent._.extend({},defaults,opts),deferred=new Talent.$.Deferred;Talent.$.ajax({url:Context.getApiUrl("proxy/PostUPaaSCoreGateway"),type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(options)}).done(function(resp){deferred.resolve(JSON.parse(resp))});return deferred.promise()}function showModal(getItemOpt){var opt=getItemOpt();var version=window.__italent_common_cmps__&&window.__italent_common_cmps__.medal_version||"1.0.62";require(["//stnew03.beisen.com/ux/upaas/@talentui/dll-react/release/dist/dll-react-15.6.10.min.js"," //stnew03.beisen.com/ux/upaas/@talentui/dll-vue/release/dist/dll-vue-2.5.1.min.js"],function(react,vue){require(["css!//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.css","//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.js"],function(UxReward,MedalController){Medal&&Medal.closeModal();var Medal=__MedalController__&&new __MedalController__({zIndex:9999999999,onClose:function(){showModal(getItemOpt)},root:document.body});opt&&Medal.showNewMedal(opt)})})}return getModalData}function util_rewardGetFile(call){var isOpenReward=util_rewardOpen();if(!isOpenReward)return;if(window.UxReward){call&&call(window.UxReward);return}var userInfo=Context.getUserInfo();var tTime=null;var version=window.__italent_common_cmps__&&window.__italent_common_cmps__.reward_version||"1.3.61";require(["//stnew03.beisen.com/ux/upaas/@talentui/dll-react/release/dist/dll-react-15.6.10.min.js"," //stnew03.beisen.com/ux/upaas/@talentui/dll-vue/release/dist/dll-vue-2.5.1.min.js"],function(react,vue){require(["//stnew03.beisen.com/ux/upaas/reward/release/dist/main-"+version+".min.js","css!//stnew03.beisen.com/ux/upaas/reward/release/dist/main-"+version+".min.css"],function(UxReward){var rewardBox=document.getElementById("rewardBox");var myReward=window.UxReward=new UxReward.default({domNode:rewardBox,zIndex:2e3,loginUser:{name:userInfo.Name,avatar:{hasAvatar:userInfo.UserAvatar.HasAvatar,img:userInfo.UserAvatar.Medium,color:userInfo.UserAvatar.Color},id:userInfo.Id},onSuccess:function(res){var medalDetail=res.Data.medalDetail||[];medalDetail.length&&util_upaasMedal()(medalDetail)},onClose:function(){if(util.italentSDK()){window.iTalentSDK.hidePopup()}}});Talent.app.vent.on("Global-Reward-Open",function(options){myReward.renderReceiveReward(options)});call&&call(myReward)})})}function util_italentSDK(){return window.top!==window.self&&window.name!=="grcw"}function util_userSelectorConfig(options){var options=options||{};var tenantBehavior=Context.getGlobal("tenantBehavior");var OpenDepartmenVisibility=tenantBehavior&&tenantBehavior.OpenDepartmenVisibility;if(!OpenDepartmenVisibility){if(!options.tab){options["tab"]=["Search","Contact","Subordinate"]}else{options["tab"].splice(options["tab"].indexOf("Department"),1)}}return options}function util_sendMessageBySDK(id,data){window.iTalentSDK.sendMessage({publishEvent:"tita__widget_"+id,data:data})}function util_getMessageBySDK(id,callBack){window.iTalentSDK.register({listenEvent:"tita__widget_"+id,context:this,cb:function(data){if(typeof callBack=="function"){callBack(data)}}})}var util={rewardOpen:util_rewardOpen,rewardGetFile:util_rewardGetFile,italentSDK:util_italentSDK,userSelectorConfig:util_userSelectorConfig,sendMessageBySDK:util_sendMessageBySDK,getMessageBySDK:util_getMessageBySDK,upaasMedal:util_upaasMedal,upaasEnterpriseMedal:util_upaasEnterpriseMedal};function util_rewardOpen(){var isOpenReward=Context.getGlobal("rewardOpen");if(typeof isOpenReward=="undefined"){var header=Context.getGlobal("Header")||[];if(header.length){isOpenReward=Talent._.findWhere(header,{Code:"950"})?true:false;Context.setGlobal("rewardOpen",isOpenReward);return isOpenReward}header=Context.getGlobal("apps")||[];isOpenReward=Talent._.findWhere(header,{appId:950})?true:false;Context.setGlobal("rewardOpen",isOpenReward)}return isOpenReward}function util_upaasEnterpriseMedal(){function dealReqOpt(data){var count=0;return function(){if(count<data.length){var opt=data[count];count++;return opt}else{count=null;data=null;return false}}}function showModal(getItemOpt){var opt=getItemOpt();var version=window.__italent_common_cmps__&&window.__italent_common_cmps__.medal_version||"1.0.62";require(["//stnew03.beisen.com/ux/upaas/@talentui/dll-react/release/dist/dll-react-15.6.10.min.js"," //stnew03.beisen.com/ux/upaas/@talentui/dll-vue/release/dist/dll-vue-2.5.1.min.js"],function(react,vue){require(["css!//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.css","//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.js"],function(UxReward,MedalController){Medal&&Medal.closeModal();var Medal=__MedalController__&&new __MedalController__({zIndex:9999999999,onClose:function(){showModal(getItemOpt)},root:document.body});opt&&Medal.showNewMedal(opt)})})}function getMedalMsg(){var deferred=new Talent.$.Deferred;Talent.$.ajax({url:Context.getApiUrl("messages/Get?page_size=1000&page_num=1&status=1&app_type=-1&app_id=-1"),type:"GET",contentType:"application/json;charset=utf-8"}).done(function(resp){deferred.resolve(resp)});return deferred.promise()}function getMedalData(ids){var options={code:ids},deferred=new Talent.$.Deferred;Talent.$.ajax({url:Context.getApiUrl("proxy/PostUPaaSCoreGateway/CompanyMedal/CompanyMedalInfo"),type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(options)}).done(function(resp){deferred.resolve(JSON.parse(resp))});return deferred.promise()}getMedalMsg().done(function(res){Talent.app.vent.trigger("GlobalIndicatorDelete",{indicatorType:"1969002",messageType:"1"});function getMedalIds(msg){var ids=[];_.each(msg,function(item){var content=item.content;var messageType=item.messageType;var reg=/\$\d+\$/;if(messageType==32&&reg.test(content)){var id=reg.exec(content)[0].replace(/\$/g,"");ids.push(id)}});return ids}if(res&&res.Code==1){var data=res.Data||{};var messags=data.messags||[];var medalIds=getMedalIds(messags);if(medalIds.length){getMedalData(medalIds).done(function(res){var getItemOpt=dealReqOpt(res&&res.OperationObject||[]);showModal(getItemOpt)})}}})}function util_upaasMedal(){function dealReqOpt(data){var count=0;return function(){if(count<data.length){var opt=data[count];count++;return opt}else{count=null;data=null;return false}}}function getModalData(medalArgs){if(!medalArgs||medalArgs.length==0)return;modalAjax({medalArgs:medalArgs}).done(function(req){var getItemOpt=dealReqOpt(req&&req.OperationObject||[]);showModal(getItemOpt)})}function modalAjax(opts){var defaults={metaname:"Medal",funname:"UpgradeMedal",medalArgs:[]},options=Talent._.extend({},defaults,opts),deferred=new Talent.$.Deferred;Talent.$.ajax({url:Context.getApiUrl("proxy/PostUPaaSCoreGateway"),type:"POST",contentType:"application/json;charset=utf-8",data:JSON.stringify(options)}).done(function(resp){deferred.resolve(JSON.parse(resp))});return deferred.promise()}function showModal(getItemOpt){var opt=getItemOpt();var version=window.__italent_common_cmps__&&window.__italent_common_cmps__.medal_version||"1.0.62";require(["//stnew03.beisen.com/ux/upaas/@talentui/dll-react/release/dist/dll-react-15.6.10.min.js"," //stnew03.beisen.com/ux/upaas/@talentui/dll-vue/release/dist/dll-vue-2.5.1.min.js"],function(react,vue){require(["css!//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.css","//stnew03.beisen.com/ux/upaas/upaas-medal/release/dist/main-"+version+".min.js"],function(UxReward,MedalController){Medal&&Medal.closeModal();var Medal=__MedalController__&&new __MedalController__({zIndex:9999999999,onClose:function(){showModal(getItemOpt)},root:document.body});opt&&Medal.showNewMedal(opt)})})}return getModalData}function util_rewardGetFile(call){var isOpenReward=util_rewardOpen();if(!isOpenReward)return;if(window.UxReward){call&&call(window.UxReward);return}var userInfo=Context.getUserInfo();var tTime=null;var version=window.__italent_common_cmps__&&window.__italent_common_cmps__.reward_version||"1.3.61";require(["//stnew03.beisen.com/ux/upaas/@talentui/dll-react/release/dist/dll-react-15.6.10.min.js"," //stnew03.beisen.com/ux/upaas/@talentui/dll-vue/release/dist/dll-vue-2.5.1.min.js"],function(react,vue){require(["//stnew03.beisen.com/ux/upaas/reward/release/dist/main-"+version+".min.js","css!//stnew03.beisen.com/ux/upaas/reward/release/dist/main-"+version+".min.css"],function(UxReward){var rewardBox=document.getElementById("rewardBox");var myReward=window.UxReward=new UxReward.default({domNode:rewardBox,zIndex:2e3,loginUser:{name:userInfo.Name,avatar:{hasAvatar:userInfo.UserAvatar.HasAvatar,img:userInfo.UserAvatar.Medium,color:userInfo.UserAvatar.Color},id:userInfo.Id},onSuccess:function(res){var medalDetail=res.Data.medalDetail||[];medalDetail.length&&util_upaasMedal()(medalDetail)},onClose:function(){if(util.italentSDK()){window.iTalentSDK.hidePopup()}}});Talent.app.vent.on("Global-Reward-Open",function(options){myReward.renderReceiveReward(options)});call&&call(myReward)})})}function util_italentSDK(){return window.top!==window.self&&window.name!=="grcw"}function util_userSelectorConfig(options){var options=options||{};var tenantBehavior=Context.getGlobal("tenantBehavior");var OpenDepartmenVisibility=tenantBehavior&&tenantBehavior.OpenDepartmenVisibility;if(!OpenDepartmenVisibility){if(!options.tab){options["tab"]=["Search","Contact","Subordinate"]}else{options["tab"].splice(options["tab"].indexOf("Department"),1)}}return options}function util_sendMessageBySDK(id,data){window.iTalentSDK.sendMessage({publishEvent:"tita__widget_"+id,data:data})}function util_getMessageBySDK(id,callBack){window.iTalentSDK.register({listenEvent:"tita__widget_"+id,context:this,cb:function(data){if(typeof callBack=="function"){callBack(data)}}})}function window_taskMedal(data){util.upaasMedal()(data)}util_getMessageBySDK("medal__task",window_taskMedal);var AddUserItemView=Talent.ItemView.extend({template:jst["add-user/add-user-item"],tagName:"li",ui:{uxUserArea:".ux_user_area",del:"[data-name=del-item]"},initialize:function(){},onRender:function(){var self=this;this.$el.find("a").tipsy({gravity:"s"})},events:function(){var events={};events["mouseover "+this.ui.uxUserArea]="changeHideNode";events["mouseout "+this.ui.uxUserArea]="changeShowNode";events["click "+this.ui.uxUserArea]="deleteUser";events["click "+this.ui.del]="deleteUser";return events},templateHelpers:function(){return{showType:this.options.showType}},deleteUser:function(){this.trigger("deleteUser",this.model)},changeHideNode:function(events){var node=Talent.$(events.currentTarget);var Avatar=this.model.get("avatar")||this.model.get("Avatar")||this.model.get("UserAvatar");if(Avatar.HasAvatar){node.find("img").hide()}else{node.find("span").hide()}},changeShowNode:function(events){var node=Talent.$(events.currentTarget);var Avatar=this.model.get("avatar")||this.model.get("Avatar")||this.model.get("UserAvatar");if(Avatar.HasAvatar){node.find("img").show()}else{node.find("span").show()}}});var AddUserCompositeView=Talent.CompositeView.extend({defaults:{addUserSelectonOptions:{}},itemView:AddUserItemView,itemViewContainer:"ul",className:"person-list",template:jst["add-user/add-user-composite"],ui:{addUserBtn:"[data-name=add-item]"},defaults:{title:"提醒对象"},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);this.addUserSelectonOptions=options.addUserSelectonOptions},templateHelpers:function(){return{title:this.settings["title"],showType:this.options.showType}},itemViewOptions:function(){return{showType:this.settings.showType||""}},modelEvents:{},onRender:function(){var self=this;this.on("itemview:deleteUser",function(view){self.collection.remove(view.model);self.trigger("deleteUser",view.model.toJSON());$("body .tipsy").remove()});self._bindUserSelect()},_bindUserSelect:function(){var self=this;this.userSelectorView=new UserSelector({collection:new UserSelectorCollection,container:this.$el});var options=util.userSelectorConfig(this.addUserSelectonOptions);this.userSelectorView.addNode(this.ui.addUserBtn,options);this.ui.addUserBtn.on("submit",function(ev,user){ev.stopPropagation();self.smemberSelect(user)})},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.children.add(view);view.render();if(!this.$el.find(this.itemViewContainer).find("li:first-child").length){this.$el.find(this.itemViewContainer).append(view.el)}else{this.$el.find(this.itemViewContainer).find("li:first-child").before(view.el)}if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)},smemberSelect:function(user){if(user.data){this.trigger("addUser",user)}else{var user=user||{};user["UserId"]=user.Id;user["Avatar"]=user.UserAvatar;var models=this.collection.where({UserId:user.UserId});if(models.length>0){TipInfoView(this.ui.addUserBtn.parent(),{placement:"bottom",type:"remind",body:"该联系人已存在",align:"center",container:this.$el,ico:"warn"})}else{this.trigger("addUser",user)}}}});var AttachmentListItemView=Talent.ItemView.extend({defaults:{isShowDeleted:false},tagName:"li",template:jst["attachment-list/attachment-list-item"],className:"item_afb",modelEvents:{change:"render"},ui:{iconImg:"div[data-name=tita-upload-preview-icon]",itemLi:"div[data-name=tita-upload-preview-item]",statusTip:"[data-name=status-tip]",deleteFile:"[data-name=tita-upload-deleted]",reUpload:"[data-name=tita-upload-reUpload]"},events:function(){var events={};events["click "+this.ui.deleteFile]="_deleteFileClickHandler";events["click "+this.ui.reUpload]="_reUploadFileClickHandler";return events},templateHelpers:function(){var fileFullName=this.model.get("name")||this.model.get("fileName")||"",lastIdx=fileFullName.lastIndexOf("."),fileType=lastIdx>0&&fileFullName.substring(lastIdx+1)||"",subLen=24-1-fileType.length,fileName=fileFullName,documentId=this.model.get("documentId")||0,isImage=/^jpg|png|gif|jpeg|image|JPG|PNG|GIF|JPEG$/.test(fileType);if(/^(jpg|png|gif|jpeg)$/.test(fileType)){iconColor="#44CF85"}else{if(/^(exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(fileType)){iconColor="#49B9DD"}else if(/^(rar|zip)$/.test(fileType)){iconColor="#FFBA46"}else if(/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(fileType)){iconColor="#8479D6"}else if(/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(fileType)){iconColor="#3EBBA8"}else{fileType="none";iconColor="#FF730C"}}return{fileName:fileName,fileFullName:fileFullName,fileType:this.model.get("fileType")||fileType,documentId:documentId,deleteable:this.model.get("deleteable")===undefined?this.settings["isShowDeleted"]:this.model.get("deleteable"),verifyStatus:this.model.get("verifyStatus")===undefined?true:this.model.get("verifyStatus"),uploadStatus:this.model.get("uploadStatus")===undefined?3:this.model.get("uploadStatus"),isFromYFY:this.model.get("isFromYFY")===undefined?true:this.model.get("isFromYFY"),isImage:isImage,iconColor:iconColor,fileType:fileType,ClientUrl:this.model.get("ClientUrl")||this.model.get("smallUrl")}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.supportFormData=window.FormData?true:false},onRender:function(){var isImage=this.model.get("isImage"),isFromYFY=this.model.get("isFromYFY"),uploadStatus=this.model.get("uploadStatus"),fromStore=this.model.get("fromStore");if(isImage){this._renderImg()}this.$el.attr({id:this.model.cid});if(uploadStatus==3&&!fromStore){this.ui.statusTip.html('<span class="status-success">上传成功!</span>');this.ui.statusTip.delay(2e3).animate({opacity:0},200)}if(uploadStatus==2&&!this.supportFormData){var percentComplete=this.model.get("percentComplete");clearInterval(this.timer);this.timer=setInterval(function(){percentComplete+=10;if(percentComplete>100)percentComplete=30;this.model.set("percentComplete",percentComplete)},100)}1},_renderImg:function(){var self=this;var image=new Image;image.onload=function(){if(self.isClose)return;image.className="img_up tu-cp";self.ui.iconImg.html&&self.ui.iconImg.html(image)};image.onerror=function(){self.ui.itemLi.html('<div class="warnattachmenttip">读取文件 '+self.model.get("FileName")+" 失败</div>")};image.src=this.model.get("ClientUrl")||this.model.get("smallUrl");image.setAttribute("data-name","img")}});var AttachmentListView=Talent.CompositeView.extend({defaults:{isShowDeleted:true},className:"attachment_fb tu-clearfix",template:Talent._.template("<ul/>"),itemView:AttachmentListItemView,itemViewContainer:"ul",ui:{deleted:"a[data-name=attachment-deleted]",iconImg:"div[data-name=tita-upload-preview-icon]",preview:"[data-name=tita-upload-img-preview]",imgPreview:"[data-name=img-preview]",previewButton:"span[data-name=feed-attachment-preview-button]",dialog:"span[data-name=feed-attachment-preview-dialog]",fileName:"[data-name=name_up]",infotip:"[data-toggle=infotip]",img:"[data-name=img]"},itemViewOptions:function(){return{isShowDeleted:this.settings["isShowDeleted"]}},events:function(){var events={};events["click "+this.ui.deleted]="_deletedHandler";events["click "+this.ui.preview]="_renderImgPreviewView";events["click "+this.ui.previewButton]="_renderImgPreviewView";events["click "+this.ui.dialog]="_renderImgPreviewView";events["click "+this.ui.fileName]="_renderImgPreviewView";events["click "+this.ui.imgPreview]="_renderImgPreviewView";events["click "+this.ui.img]="_renderImgPreviewView";events["mouseenter "+this.ui.infotip]="_mouseenterInfotip";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this._dealData()},_dealData:function(){var self=this;this.collection.each(function(model){var imgTypes=Context.getAttachmentType().image;var type=model.get("fileType").toLowerCase();var previewUrl=model.get("previewUrl");var yfyPreviewUrl=model.get("imageUrl");var documentSource=model.get("documentSource");var name=model.get("name")||model.get("fileName")||"";model.set("name",name);model.set("isImage",false);for(var i=0;i<imgTypes.length;i++){if(type==imgTypes[i]){model.set("isImage",true);var index=previewUrl.lastIndexOf(".");if(index>0){var bigUrl=previewUrl.substr(0,index)+"_b."+previewUrl.substr(index+1),smallUrl=previewUrl.substr(0,index)+"_s."+previewUrl.substr(index+1);if(type=="gif"){smallUrl=previewUrl}model.set("bigUrl",bigUrl);model.set("smallUrl",smallUrl)}if(yfyPreviewUrl){model.set("smallUrl",yfyPreviewUrl)}break}}if(previewUrl!=null&&previewUrl!=""){model.set("isPreview",true)}else{model.set("isPreview",false)}})},_mouseenterInfotip:function(ev){var node=$(ev.currentTarget);this.tipView&&this.tipView.destroy();this.tipView=new Infotip;this.tipView.bindNode(node,{container:this.$el,type:"default",body:node.data("infotip-txt")});this.tipView.show()},_deletedHandler:function(ev){ev.stopPropagation();var self=this,node=Talent.$(ev.currentTarget),id=node.data("document-id"),model=this.collection.findWhere({documentId:+id});this.deleteConfView&&this.deleteConfView.destroy();this.deleteConfView=new Infotip;this.deleteConfView.bindNode(node,{type:"confirm",trigger:"manual",body:"此操作不可恢复，您确定删除吗？",placement:"bottom",container:this.$el,okHide:function(){self.collection.remove(model);self.trigger("deleted",id);self.deleteConfView.hide()}});this.deleteConfView.show()},_renderImgPreviewView:function(event){var node=Talent.$(event.currentTarget),dataName=node.attr("data-name");var allNode=this.$("[data-name="+dataName+"]");var index=allNode.index(node);var data=Talent._.where(this.collection.toJSON(),{isImage:true})||[];if(!data.length)return;if(index<0)return;_.each(data,function(item){var previewUrl=item.previewUrl;item.fileName=item.FileName;item.smallUrl=previewUrl.substring(0,previewUrl.lastIndexOf("."))+"_s"+previewUrl.substring(previewUrl.lastIndexOf("."))});this.imgPreviewView&&this.imgPreviewView.close();this.imgPreviewView=new ImgPreviewView({collection:new Talent.Collection(data),index:index});this.$el.append(this.imgPreviewView.render().el)}});var TagItemView=Talent.ItemView.extend({defaults:{id:"",tagName:"",color:"",createTime:"",userId:"",getWay:"",shareType:"",objCount:"",showOrter:false,beCheck:false,checked:false,del:false,gray:false},template:jst["tag/tag-item"],className:"tt-tag-container",ui:{tagWrap:"[data-name=tag-wrap]",tagMain:"[data-name=tag-main]",tagDel:"[data-name=tag-del]",tagOther:"[data-name=tag-other]",shareIn:"[data-name=share-in]",shareOut:"[data-name=share-out]",count:"[data-name=count]",tagBox:"[data-name=tag-box]"},events:function(){var events={};events["click "+this.ui.tagWrap]="_clickCheckedHandler";events["click "+this.ui.tagDel]="_clickDelHandler";events["mouseenter "+this.ui.tagWrap]="_mouseenterDelHandler";events["mouseleave "+this.ui.tagWrap]="_mouseleaveDelHandler";return events},modelEvents:{"change:checked":"render","change:shareType":"render","change:flash":"_flash"},templateHelpers:function(){return Talent._.extend({},this.defaults,this.model.toJSON())},initialize:function(){},onRender:function(){Talent.$(".tipsy").remove();this.ui.shareIn.tipsy({gravity:"s"});this.ui.shareOut.tipsy({gravity:"s"});this.ui.count.tipsy({gravity:"s"});this._dealChecked()},_dealChecked:function(){if(this.model.get("beCheck")&&this.model.get("checked")){this.$el.addClass("active")}else{this.$el.removeClass("active")}},_clickCheckedHandler:function(ev){ev.stopPropagation();ev.preventDefault();if(this.model.get("beCheck")&&!this.model.get("gray")){if(this.$el.hasClass("active")){this.$el.removeClass("active");this.model.set("checked",false);this.trigger("checked")}else{this.$el.addClass("active");this.model.set("checked",true);this.trigger("checked")}}else if(!this.model.get("gray")){this.trigger("beClick")}return false},_mouseenterDelHandler:function(ev){ev.stopPropagation();if(this.model.get("del")&&!this.model.get("gray")){this.$el.addClass("del-hover");this.ui.tagBox.removeClass("beDel")}},_mouseleaveDelHandler:function(ev){ev.stopPropagation();if(this.model.get("del")&&!this.model.get("gray")){this.$el.removeClass("del-hover");this.ui.tagBox.addClass("beDel")}},_clickDelHandler:function(ev){ev.stopPropagation();this.trigger("del")},_flash:function(){var self=this;if(this.model.get("flash")){this.$el.css("opacity","0.1");this.$el.animate({opacity:1},500,function(){self.model.set("flash",false)})}}});var TagAddDialogLoadingView=Talent.ItemView.extend({template:Talent._.template(""),className:"tt-tag-add-loading"});var TagAddDialogView=Talent.ItemView.extend({defaults:{objId:"",objType:"",node:"",container:$("body"),pos:""},template:jst["tag/tag-add-dialog/tag-add-dialog"],className:"tag-add-dialog-container",regions:{},ui:{addBtn:"button[data-name=add]",loading:"[data-name=loading]",input:"[data-name=input]",tagCont:"[data-name=tag-cont]"},events:function(){var events={};events["click "+this.ui.addBtn]="_clickAddBtnHandler";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);var self=this;this.$el.off("mouseup.project-deatil-top-tag-add-layout");this.$el.on("mouseup.project-deatil-top-tag-add-layout",function(event){event.stopPropagation()});Talent.$(document).off("mouseup.project-deatil-top-tag-add-layout");Talent.$(document).on("mouseup.project-deatil-top-tag-add-layout",function(){self.close()});this.tagAllCollection=new Talent.Collection;this.tagSelectCollection=new Talent.Collection;this.addBtnBeClick=false},onRender:function(){this.$el.hide();this._getData();this.loadingView=new TagAddDialogLoadingView;this.settings.node.append(this.loadingView.render().$el);this._setLoading()},_setLoading:function(){var loadView=this.loadingView,loadViewW=loadView.$el.width(),loadViewH=loadView.$el.innerHeight(),node=this.settings.node,nodeOff=node.offset(),nodeH=node.innerHeight(),nodeW=node.innerWidth(),nodeOffL=node.offset().left,nodeOffT=node.offset().top,container=this.settings.container,containerOff=container.offset(),containerOffL=containerOff.left,containerOffT=containerOff.top,containerH=container.innerHeight(),containerW=container.innerWidth(),pos;node.css("position","relative");if(containerOffT+containerH-nodeOffT>loadViewH){loadView.$el.css("top",nodeH)}else{loadView.$el.css("top",-loadViewH)}if(containerOffL+containerW-nodeOffL-nodeW<loadViewW){loadView.$el.css("right","0px")}else{loadView.$el.css("left",0)}},_getData:function(){var self=this;TagCollection.getTagAll().done(function(resp){self._dealTagAllData(resp);self._renderView()}).fail(function(msg){})},_dealTagAllData:function(resp){var self=this,tagList=resp.tagList;if(tagList.length){Talent._.each(tagList,function(item){item.beCheck=true});this.tagAllCollection.reset(tagList);Talent._.each(this.collection.toJSON(),function(i){if(self.tagAllCollection.findWhere({tagName:i.tagName,id:i.id})){self.tagAllCollection.findWhere({tagName:i.tagName,id:i.id}).set("checked",true)}});var checkedLen=this.tagAllCollection.where({checked:true}).length;Talent._.each(this.tagAllCollection.toJSON(),function(i){if(checkedLen==5){if(!i.checked)self.tagAllCollection.findWhere({tagName:i.tagName,id:i.id}).set({checked:false,beCheck:false,gray:true})}else{if(!i.checked)self.tagAllCollection.findWhere({tagName:i.tagName,id:i.id}).set("checked",false)}})}},_renderView:function(){this._renderInputView();this._renderTagCompositeView()},_renderInputView:function(){this.projectTagAddDialogInputView&&this.projectTagAddDialogInputView.close();this.projectTagAddDialogInputView=new TagAddDialogInputView;

this.listenTo(this.projectTagAddDialogInputView,"hasInput",function(val){this._dealInput(val)});this.listenTo(this.projectTagAddDialogInputView,"formSubmif",function(model){if(this.addBtnBeClick){this._checkFromMyTagCollection(model)}});this.ui.input.append(this.projectTagAddDialogInputView.render().$el)},_dealInput:function(val){if(val){var lowerStr=val.toLowerCase();var checkedLen=this.tagAllCollection.where({checked:true}).length;var myTagLen=this.tagAllCollection.where({getWay:1}).length;this.addBtnBeClick=true;this.projectTagAddDialogInputView.model.set("changeColorBeClick",true);this.tagSelectCollection.reset(Talent._.filter(this.tagAllCollection.toJSON(),function(item){if(item.tagName.toLowerCase().indexOf(lowerStr)!=-1)return item}));var selectLen=this.tagSelectCollection.where({getWay:1,tagName:val});if(checkedLen==5&&myTagLen==50){this.addBtnBeClick=false}if(selectLen==0&&myTagLen==50){this.addBtnBeClick=false}}else{this.addBtnBeClick=false;this.projectTagAddDialogTagBoxView.collection.reset(this.tagAllCollection.toJSON())}this.projectTagAddDialogInputView.model.set("addBtnBeClick",this.addBtnBeClick)},_clickAddBtnHandler:function(ev){ev.stopPropagation();if(this.addBtnBeClick){this._checkFromMyTagCollection(this.projectTagAddDialogInputView.model)}},_checkFromMyTagCollection:function(model){var modelToJson=model.toJSON(),findModel=this.tagSelectCollection.findWhere({tagName:modelToJson.tagName,getWay:1}),self=this;if(findModel){if(findModel.get("checked")){findModel.set("flash",true);this.projectTagAddDialogInputView.model.set("changeColorBeClick",false)}else{if(findModel.get("gray"))return;findModel.set("checked",true);this.trigger("checked",findModel);this.tagAllCollection.findWhere({tagName:findModel.get("tagName"),id:findModel.get("id")}).set("checked",true);if(this.tagAllCollection.where({checked:true}).length==5){Talent._.each(this.tagAllCollection.where({checked:false}),function(item){item.set({gray:true,beCheck:false})})}else{}var arr=[];Talent._.each(this.tagSelectCollection.toJSON(),function(item){arr.push(self.tagAllCollection.findWhere({tagName:item.tagName,id:item.id}).toJSON())});TagCollection.tagAddTo({tagId:findModel.toJSON().id,objId:self.settings.objId,objType:self.settings.objType}).done(function(){self.tagSelectCollection.reset(arr)})}}else{this.addBtnBeClick=false;this.projectTagAddDialogInputView.model.set("addBtnBeClick",false);if(this.tagAllCollection.where({checked:true}).length<5){TagCollection.tagCreateTo({tagName:modelToJson.tagName,color:modelToJson.color,objId:self.settings.objId,objType:self.settings.objType}).done(function(resp){model.set(resp);model.set("checked",true);model.set("beCheck",true);if(self.tagAllCollection.where({checked:true}).length<5){self.trigger("checked",model)}self.tagAllCollection.unshift(model.toJSON());self._checkTagAllByChecked()})}else{if(this.tagAllCollection.where({getWay:1}).length==50)return;TagCollection.tagAdd({tagName:modelToJson.tagName,color:modelToJson.color,shareTypes:""}).done(function(resp){resp.beCheck=true;resp.checked=false;if(self.tagAllCollection.where({checked:true}).length<5){self.trigger("checked",resp)}self.tagAllCollection.unshift(resp);self._checkTagAllByChecked()})}}},_checkTagAllByChecked:function(){this.projectTagAddDialogInputView.render();if(this.tagAllCollection.where({checked:true}).length==5){Talent._.each(this.tagAllCollection.where({checked:false}),function(item){item.set({gray:true,beCheck:false})})}else{}this._renderTagCompositeView()},_renderTagCompositeView:function(){var self=this;this.tagSelectCollection.reset(this.tagAllCollection.toJSON());this.projectTagAddDialogTagBoxView&&this.projectTagAddDialogTagBoxView.close();this.projectTagAddDialogTagBoxView=new TagAddDialogTagBoxView({collection:this.tagSelectCollection,tagAllCollection:this.tagAllCollection});this.listenTo(this.projectTagAddDialogTagBoxView,"checked",function(view){this.projectTagAddDialogInputView.model.set("changeColorBeClick",true);var modelJson=view.model.toJSON();if(modelJson.checked){Talent.app.request("WorkTag:tagAddTo",{tagId:modelJson.id,objId:self.settings.objId,objType:self.settings.objType})}else{Talent.app.request("WorkTag:tagRemovefrom",{tagId:modelJson.id,objId:self.settings.objId,objType:self.settings.objType})}this.tagAllCollection.findWhere({tagName:modelJson.tagName,id:modelJson.id}).set("checked",modelJson.checked);if(this.tagAllCollection.where({checked:true}).length==5){Talent._.each(this.tagAllCollection.where({checked:false}),function(item){item.set({gray:true,beCheck:false})})}else{Talent._.each(this.tagAllCollection.where({gray:true}),function(item){item.set({gray:false,beCheck:true})})}this.trigger("checked",view.model);var arr=[];Talent._.each(this.tagSelectCollection.toJSON(),function(item){arr.push(self.tagAllCollection.findWhere({tagName:item.tagName,id:item.id}).toJSON())});this.tagSelectCollection.reset(arr)});this.ui.tagCont.append(this.projectTagAddDialogTagBoxView.render().$el);this.loadingView&&this.loadingView.close();this._setThisPosition();this.$el.show()},_setThisPosition:function(){var thisEl=this.$el,thisElH=thisEl.innerHeight(),thisElW=thisEl.innerWidth(),node=this.settings.node,nodeOff=node.offset(),nodeH=node.height(),nodeOffL=node.offset().left,nodeOffT=node.offset().top,windowW=Talent.$(window).width(),container=this.settings.container,containerOff=container.offset(),containerOffL=containerOff.left,containerOffT=containerOff.top,containerH=container.height(),containerW=container.width(),pos;if(containerH-(nodeOffT-containerOffT)>thisElH){if(windowW-nodeOffL>thisElW){pos="bottom"}else{pos="bottomRight"}}else{if(windowW-nodeOffL>thisElW){pos="top"}else{pos="topRight"}}Context.setPosition(node,thisEl,{container:container,pos:this.settings.pos||pos})},onClose:function(){this.$el.off("mouseup.project-deatil-top-tag-add-layout");Talent.$(document).off("mouseup.project-deatil-top-tag-add-layout");this.projectTagAddDialogInputView&&this.projectTagAddDialogInputView.close();this.projectTagAddDialogTagBoxView&&this.projectTagAddDialogTagBoxView.close()}});var TagAddDialogTagBoxView=Talent.ItemView.extend({template:jst["tag/tag-add-dialog/tag-add-dialog-tag-box"],className:"tag-add-box",ui:{myTagWrap:"[data-name=my-tag]",shareTagWrap:"[data-name=share-tag]"},collectionEvents:{reset:"render",set:"render"},initialize:function(options){this.options=options},_dealCcllection:function(){this.myTagCollection=new Talent.Collection;this.shareTagCollection=new Talent.Collection;this.myTagCollection.set(this.collection.where({getWay:1}));this.shareTagCollection.set(this.collection.where({getWay:2}))},onRender:function(){if(this.options.tagAllCollection.length){this._dealCcllection();this._renderMyTagCollectionView();this._renderShareTagCollectionView()}else{var emptyView=new EmptyView({emptyContext:"暂无标签，赶快添加让工作更井井有条吧"});this.ui.myTagWrap.empty();this.ui.myTagWrap.append(emptyView.render().$el)}},_renderMyTagCollectionView:function(){this.myTagCollectionView&&this.myTagCollectionView.close();this.myTagCollectionView=new TagBoxCollectionView({collection:this.myTagCollection});this.listenTo(this.myTagCollectionView,"checked",function(view){view.model.set("getWay",1);this.trigger("checked",view)});this.ui.myTagWrap.empty();this.ui.myTagWrap.append(this.myTagCollectionView.render().$el)},_renderShareTagCollectionView:function(){if(this.shareTagCollection.length){this.shareTagCollectionView&&this.shareTagCollectionView.close();this.shareTagCollectionView=new TagBoxCollectionView({collection:this.shareTagCollection});this.listenTo(this.shareTagCollectionView,"checked",function(view){view.model.set("getWay",2);this.trigger("checked",view)});this.ui.shareTagWrap.append(this.shareTagCollectionView.render().$el)}}});var TagBoxCollectionView=Talent.CollectionView.extend({itemView:TagItemView,initialize:function(){var self=this;this.on("itemview:checked",function(view){self.trigger("checked",view)})},onRender:function(){if(Talent._.filter(this.collection.toJSON(),function(item){return item.getWay==2}).length){this.$el.prepend('<div class="share-title">共享给我的</div>')}}});var TagAddDialogInputView=Talent.ItemView.extend({template:jst["tag/tag-add-dialog/tag-add-dialog-input"],className:"input-container",templateHelpers:function(){function getRandom(min,max){return Math.floor(Math.random()*(max-min+1))+min}this.model.set("color",getRandom(1,6));return{color:this.model.get("color")}},ui:{addBtn:"[data-name=add]",placeholder:"label.placeholder",input:"[data-name=input]",inputWrap:".tu-input-default",checkColorBtn:"span.check-color-btn",checkColorCont:"span.check-color-btn span",inputTip:"p.input-tip",form:"[data-name=form]",inputBox:"[data-name=input-box]"},events:function(){var events={};events["input "+this.ui.input]="_inputHandler";events["keyup "+this.ui.input]="_keyupHandler";events["focus "+this.ui.input]="_inputFocusHandler";events["blur "+this.ui.input]="_inputBlurHandler";events["click "+this.ui.checkColorBtn]="_clickCheckColorBtnHandler";events["submit "+this.ui.form]="_submitForm";return events},modelEvents:{"change:color":"_changeColor","change:addBtnBeClick":"_addBtnStatus","change:changeColorBeClick":"_checkColorBtnStatus"},initialize:function(){var self=this;this.propertychange_val="";this.model.set("addBtnBeClick",false);this.model.set("changeColorBeClick",true);this.checkStatus=true},onRender:function(){var self=this;this.ui.input.bind("propertychange",function(event){self._inputHandler(event,self)});this.ui.checkColorBtn.tipsy({gravity:"s"});if(this.checkColorBoxView){this.checkColorBoxView.close();this.checkColorBoxView=null}},_inputFocusHandler:function(ev){if(this.checkStatus){this.ui.inputTip.html("仅支持中英文、数字与“_”，可输入14个字，最多添加5个标签</p>")}this.ui.input.parents(".tu-input-default").addClass("focusIn");this.ui.placeholder.hide()},_inputBlurHandler:function(){if(this.checkStatus){this.ui.inputTip.empty()}else{}this.ui.input.parents(".tu-input-default").removeClass("focusIn");if(!this.ui.input.val()){this.ui.placeholder.show()}},_keyupHandler:function(ev){if(ev.keyCode==8){this._inputHandler(ev)}},_inputHandler:function(ev,that){ev.stopPropagation();var self=ev.type=="propertychange"?that:this;var node=Talent.$(ev.currentTarget),val=node.val();self.checkStatus=true;self._checkVal(val)},_checkVal:function(val){var self=this,chineseRegex=/^[\u4E00-\u9FA5]$/,newLength=0,reg=/^\w|[\u4E00-\u9FA5]$/;if(val){for(var i=0;i<val.length;i++){if(!reg.test(val[i]))this.checkStatus=false}if(this.checkStatus){for(var j=0;j<val.length;j++){if(chineseRegex.test(val.charAt(j).toString())){newLength+=2}else{newLength+=1}}if(newLength>28)this.checkStatus=false}}else{this.checkStatus=false}if(this.checkStatus){this.model.set("changeColorBeClick",true);this.model.set("tagName",val);this.trigger("hasInput",val);this.ui.inputTip.removeClass("error");this.ui.inputBox.removeClass("error")}else{this.trigger("hasInput");this.ui.inputTip.addClass("error");this.ui.inputBox.addClass("error")}},_submitForm:function(){if(!this.checkStatus)return false;this.trigger("formSubmif",this.model);return false},_clickCheckColorBtnHandler:function(ev){ev.stopPropagation();if(this.model.get("changeColorBeClick")){if(this.checkColorBoxView){this.checkColorBoxView.close();this.checkColorBoxView=null}else{this.checkColorBoxView&&this.checkColorBoxView.close();this.checkColorBoxView=new TagAddDialogInputCheckcolorView({model:this.model});this.listenTo(this.checkColorBoxView,"changeColor",function(color){this.checkColorBoxView.close();this.checkColorBoxView=null;this.model.set("color",color)});this.$el.append(this.checkColorBoxView.render().$el)}}else{}},_changeColor:function(){$(this.ui.checkColorCont).removeClass().addClass("color"+this.model.get("color"))},_addBtnStatus:function(boolean){if(this.model.get("addBtnBeClick")&&this.model.get("tagName")){if(this.ui.inputWrap.hasClass("tu-input-disabled"))this.ui.inputWrap.removeClass("tu-input-disabled");if(this.ui.addBtn.hasClass("tu-button-disabled"))this.ui.addBtn.removeClass("tu-button-disabled")}else{if(!this.ui.inputWrap.hasClass("tu-input-disabled"))this.ui.inputWrap.addClass("tu-input-disabled");if(!this.ui.addBtn.hasClass("tu-button-disabled"))this.ui.addBtn.addClass("tu-button-disabled")}},_checkColorBtnStatus:function(){if(this.model.get("changeColorBeClick")){this.ui.checkColorCont.removeClass("color0").addClass("color"+this.model.get("color"));this.ui.checkColorBtn.attr("original-title","更换颜色")}else{this.ui.checkColorBtn.attr("original-title","标签已存在，暂不可更换颜色");this.ui.checkColorCont.removeClass("color"+this.model.get("color")).addClass("color0")}},onClose:function(){if(this.checkColorBoxView){this.checkColorBoxView.close();this.checkColorBoxView=null}}});var TagAddDialogInputCheckcolorView=Talent.ItemView.extend({template:jst["tag/tag-add-dialog/tag-add-dialog-input-checkcolor"],className:"check-color-box",ui:{itemColor:"span"},events:function(){var events={};events["click "+this.ui.itemColor]="_clickItemColorHanler";return events},initialize:function(){var self=this;this.$el.off("mouseup.check-color-box-view");this.$el.on("mouseup.check-color-box-view",function(event){event.stopPropagation()})},_clickItemColorHanler:function(ev){ev.stopPropagation();var node=Talent.$(ev.currentTarget),colorName=node.data("color");this.trigger("changeColor",colorName)},onClose:function(){this.$el.off("mouseup.check-color-box-view")}});var TagAddEmptyView=Talent.ItemView.extend({template:Talent._.template('<span class="click-to-add">点击添加标签</span>'),className:"tag-container-empty-text"});var TagAddView=Talent.CompositeView.extend({template:jst["tag/tag-add"],itemView:TagItemView,itemViewContainer:"[data-name=tag-container]",className:"tt-tag-add",defaults:{objId:"",objType:"",container:$("body")},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);this.on("itemview:del",function(view){self._deleteTag(view.model.toJSON());self.collection.remove(view.model)});this.on("itemview:beClick",function(view){self.trigger("tagBeClick",view.model.get("id"))})},emptyView:TagAddEmptyView,modelEvents:{change:"render"},ui:{addTagBtn:"[data-name=add-tag]"},events:function(){var events={};events["click "+this.ui.addTagBtn]="_renderAddTagView";return events},_deleteTag:function(data){Talent.app.request("WorkTag:tagRemovefrom",{tagId:data.id,objId:this.settings.objId,objType:this.settings.objType})},_renderAddTagView:function(event){var self=this;var node=Talent.$(event.currentTarget);this.tagAddView&&this.tagAddView.close();this.tagAddView=new TagAddDialogView(_.extend({collection:this.collection,node:node},this.settings));this.listenTo(this.tagAddView,"checked",function(view){self.addTagView(view.toJSON())});this.settings.container.append(this.tagAddView.render().$el)},addTagView:function(view){view.beCheck=false;view.del=true;var tagCollection=JSON.parse(JSON.stringify(this.collection.toJSON()));var currentTag=_.findWhere(tagCollection,{id:view.id,tagName:view.tagName});if(currentTag){tagCollection=_.without(tagCollection,currentTag)}else{tagCollection.unshift(new Talent.Model(view))}this.collection.reset(tagCollection)},onClose:function(){this.tagAddView&&this.tagAddView.close()}});var DateTimeCycleView=Talent.ItemView.extend({template:jst["date-time-picker/date-time-cycle"],className:"_cycle_tt_dialog",defaults:{isShowTip:true},ui:{dateTimeSetBtn:'[data-name="date-time-set-btn"]',dateTimeDropDown:'[data-name="date-time-dropdown"]',dateTimeDropDownItem:'[data-name="date-time-dropdown"] a',cycleType:"div[data-name=date-time-picker-tab] li",sureBtn:'a[data-name="data-time-picker-sure-cycle"]',closeBtn:'a[data-name="data-time-picker-close-cycle"]',resetBtn:'a[data-name="data-time-picker-reset-cycle"]'},events:function(){var events={};events["click "+this.ui.dateTimeSetBtn]="_showDataList";events["click "+this.ui.dateTimeDropDownItem]="_selectData";events["click "+this.ui.cycleType]="_changeCycleType";events["click "+this.ui.sureBtn]="_sureCycle";events["click "+this.ui.closeBtn]="_closeCycle";events["click "+this.ui.resetBtn]="_resetCycle";return events},modelEvents:{change:"render"},templateHelpers:function(){var hours=this._get24HourList();var minites=this._getMiniteList();var cycType=this.model.get("cycType");var dateData=[];var curStartDate=curEndDate="";if(cycType==3){dateData=this.weekList}else{dateData=this.monthList}return{hours:hours,minites:minites,dateData:dateData}},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);this.selectData=this.model.toJSON();this._initData();this.$el.on("click",function(ev){ev.stopPropagation();var node=Talent.$(ev.target);if(typeof node.attr("data-name")=="undefined"){self.ui.dateTimeDropDown.hide()}})},onRender:function(){var self=this},_initData:function(){var defaultData={cycType:2,cycStartDay:"",cycEndDay:"",cycStartHour:"08",cycStartMinute:"00",cycEndHour:"18",cycEndMinute:"00",cycStartDayTxt:"",cycEndDayTxt:""},data=this.selectData;this.initData=Talent._.extend({},defaultData,data);this.weekList=["周一","周二","周三","周四","周五","周六","周日"];this.monthList=this._getDateList();var type=data.cycType;if(type==3){this.model.set({cycStartDayTxt:this.weekList[data.cycStartDay-1],cycEndDayTxt:this.weekList[data.cycEndDay-1]})}if(type==4){this.model.set({cycStartDayTxt:this.monthList[data.cycStartDay-1],cycEndDayTxt:this.monthList[data.cycEndDay-1]});if(!this.model.get("cycStartDay")){this.model.set("cycStartDay",moment().date())}if(!this.model.get("cycEndDay")){this.model.set("cycEndDay",moment().date())}}},_changeCycleType:function(events){var node=Talent.$(events.currentTarget),cyctype=node.attr("cyctype"),day="",dayTxt="",dayIndex="",initData=this.initData,index=Talent._.indexOf;if(cyctype==3){dayIndex=moment().format("d")==0?6:moment().format("d")-1;dayTxt=this.weekList[dayIndex];day=index(this.weekList,dayTxt)+1}else if(cyctype==4){dayTxt=moment().format("DD");day=_.indexOf(this.monthList,dayTxt)+1}if(cyctype!=this.selectData.cycType){this.model.set({cycType:cyctype,cycStartHour:"08",cycStartMinute:"00",cycEndHour:"18",cycEndMinute:"00",cycStartDay:day,cycEndDay:day,cycStartDayTxt:dayTxt,cycEndDayTxt:dayTxt},{silent:true});this.render()}else{this.model.set({cycType:cyctype,cycStartHour:this.selectData.cycStartHour,cycStartMinute:this.selectData.cycStartMinute,cycEndHour:this.selectData.cycEndHour,cycEndMinute:this.selectData.cycEndMinute,cycStartDay:day,cycEndDay:day,cycStartDayTxt:dayTxt,cycEndDayTxt:dayTxt},{silent:true});this.render()}},_resetCycle:function(event){var node=Talent.$(event.currentTarget);if(this.settings["isShowTip"]==false){this.trigger("resetCycle",node);this.close()}else{this._showTip(node)}},_showTip:function(node){var self=this;ConfirmDialogView(this.ui.resetBtn,"您确定取消此循环吗？此操作将不可恢复",{pos:"top",container:this.$el,sure:function(){self.model.set("isCycle",false);self.trigger("resetCycle",node);self.close()},cancel:function(){self.trigger("cancel",node);self.close()}})},_sureCycle:function(event){var node=Talent.$(event.currentTarget);var check=this._checkCycleDate();if(check){this.trigger("sureCycleDate",node);this.close()}else{return}},_checkCycleDate:function(){var cycType=this.model.get("cycType"),cycStartDay=this.model.get("cycStartDay"),cycEndDay=this.model.get("cycEndDay"),cycStartHour=this.model.get("cycStartHour"),cycEndHour=this.model.get("cycEndHour"),cycStartMinute=this.model.get("cycStartMinute"),cycEndMinute=this.model.get("cycEndMinute"),startStr=cycStartHour+":"+cycStartMinute,endStr=cycEndHour+":"+cycEndMinute;if(cycType==1||cycType==2){if(endStr<startStr||endStr==startStr){TipDialogView(this.ui.sureBtn,"结束时间不能小于开始时间",{container:this.$el,pos:"topCenter"});return false}return true}else if(cycType==3||cycType==4){if(cycStartDay==cycEndDay){if(endStr<startStr||endStr==startStr){TipDialogView(this.ui.sureBtn,"结束时间不能小于开始时间",{container:this.$el,pos:"topCenter"});return false}}if(cycStartDay>cycEndDay){TipDialogView(this.ui.sureBtn,"结束时间不能小于开始时间",{container:this.$el,pos:"topCenter"});return false}return true}},_closeCycle:function(event){var node=Talent.$(event.currentTarget);this.trigger("cancel",node);this.close()},_selectData:function(ev){var dataType=this.$(ev.currentTarget).attr("data-type"),methodMap=["_changeStartDate","_changeEndDate","_changeStartHour","_changeEndHour","_changeStartMinute","_changeEndMinute"],methodName=methodMap[dataType-1];this[methodName](ev)},_changeStartDate:function(events){var node=Talent.$(events.currentTarget);var index=Number(node.attr("index"));var cycType=this.model.get("cycType");if(cycType==3){var list=this.weekList}else if(cycType==4){var list=this.monthList}this.model.set({cycStartDay:Number(index)+1,cycStartDayTxt:list[index]})},_changeEndDate:function(events){var node=Talent.$(events.currentTarget);var index=Number(node.attr("index"));var cycType=this.model.get("cycType");if(cycType==3){var list=this.weekList}else if(cycType==4){var list=this.monthList}this.model.set({cycEndDay:Number(index)+1,cycEndDayTxt:list[index]})},_changeStartHour:function(events){var node=Talent.$(events.currentTarget);var hour=node.attr("hour");if(hour!=this.model.get("cycStartHour")){this.model.set("cycStartHour",hour)}},_changeEndHour:function(events){var node=Talent.$(events.currentTarget);var hour=node.attr("hour");if(hour!=this.model.get("cycEndHour")){this.model.set("cycEndHour",hour)}},_changeStartMinute:function(events){var node=Talent.$(events.currentTarget);var minite=node.attr("minite");if(minite!=this.model.get("cycStartMinute")){this.model.set("cycStartMinute",minite)}},_changeEndMinute:function(events){var node=Talent.$(events.currentTarget);var minite=node.attr("minite");if(minite!=this.model.get("cycEndMinute")){this.model.set("cycEndMinute",minite)}},_showDataList:function(events){var node=Talent.$(events.currentTarget);this.ui.dateTimeDropDown.hide();node.parent().find(".dayvalues_nst").show()},_getDateList:function(){var date=[];for(var i=1;i<=31;i++){if(i<10){i="0"+i}date.push(i.toString())}return date},_get24HourList:function(){var hours=[];for(var i=0;i<=23;i++){if(i<10){i="0"+i}hours.push(i)}return hours},_getMiniteList:function(){return miniteList=["00","05","10","15","20","25","30","35","40","45","50","55"]},onClose:function(){if(!this._checkCycleDate()){this.model.set({cycStartDay:this.initData.cycStartDay,cycEndDay:this.initData.cycEndDay,cycStartHour:this.initData.cycStartHour,cycEndHour:this.initData.cycEndHour,cycStartMinute:this.initData.cycStartMinute,cycEndMinute:this.initData.cycEndMinute},{silent:true})}}});var DateTimePickerTabView=Talent.ItemView.extend({defaults:{isShowDateView:true,isShowCycleView:true,isShowLongView:true},tagName:"ul",className:"tab-bar",template:jst["date-time-picker/date-time-picker-tab"],ui:{tabItem:"li"},templateHelpers:function(){return this.settings},modelEvents:{"change:viewType":"_changeTypeEvent"},events:function(){var events={};events["click "+this.ui.tabItem]="_itemClickHandler";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options)},_changeTypeEvent:function(){var viewType=this.model.get("viewType");this.ui.tabItem.removeClass("active");this.$el.find("li[data-type="+viewType+"]").addClass("active")},_itemClickHandler:function(event){var node=Talent.$(event.currentTarget),viewType=node.attr("data-type");this.model.set({viewType:viewType});this.model.set({isLongTerm:false,isCycle:false},{silent:true});if(viewType=="cycle"){this.model.set({cycType:2})}}});var DateView=Talent.Layout.extend({defaults:{rangepickerOptions:{timePicker:true,format:"YYYY/MM/DD HH:mm",timePicker12Hour:false,timePickerIncrement:5,startDate:moment().format("YYYY/MM/DD HH:mm")+"08:00",endDate:moment().format("YYYY/MM/DD HH:mm")+"18:00",minDate:"2013/01/01",showDropdowns:true,autoHide:false,opens:"left",locale:{applyLabel:"确定",cancelLabel:"取消",fromLabel:"开始时间",toLabel:"结束时间"}}},className:"date-container",template:Talent._.template('<div data-name="date-time-picker-date"/>'),ui:{content:"div[data-name=date-time-picker-content]"},regions:{content:"div[data-name=date-time-picker-content]"},modelEvents:{"change:startDate":"_changeStartDateHander","change:endDate":"_changeEndDateHander"},templateHelpers:function(){return{}},events:function(){var events={};events["click "+this.ui.tabDate]="showDatePicker";events["click "+this.ui.tabCycle]="showCyclePicker";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);if(typeof this.options.rangepickerOptions=="object"){this.settings.rangepickerOptions=Talent._.extend({},this.defaults.rangepickerOptions,this.options.rangepickerOptions)}},onRender:function(){var self=this},onShow:function(){this._renderDateView()},_renderDateView:function(){var node=this.ui.content;var self=this;var options=this.settings["rangepickerOptions"];if(options.timePicker){if(!moment(this.model.get("startDate"),"YYYY/MM/DD").hour()){options["startDate"]=this.model.get("startDate")+"08:00"}else{options["startDate"]=this.model.get("startDate")}if(!moment(this.model.get("endDate"),"YYYY/MM/DD").hour()){options["endDate"]=this.model.get("endDate")+"18:00"}else{options["endDate"]=this.model.get("endDate")}}else{options["startDate"]=this.model.get("startDate");options["endDate"]=this.model.get("endDate")}DateRangePicker.prototype.updateFormInputs=function(){var startDate=this.startDate.format(this.format),endDate=this.endDate.format(this.format);this.container.find("input[name=daterangepicker_start]").val(startDate);this.container.find("input[name=daterangepicker_end]").val(endDate);var button=this.container.find("button.applyBtn");if(this.singleDatePicker&&this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)){button.removeAttr("disabled")}else{}};DateRangePicker.prototype.clickApply=function(){var startDate=this.startDate.format(this.format),endDate=this.endDate.format(this.format);if(this.singleDatePicker&&this.startDate.isSame(this.endDate)||this.startDate.isBefore(this.endDate)){this.updateInputText();this.hide();this.element.trigger("apply.daterangepicker",this)}else{var button=this.container.find("button.applyBtn");TipDialogView(button,"结束时间不能早于或等于开始时间",{pos:"topCenter"})}};options["parentEl"]=this.$el.find("div[data-name=date-time-picker-date]");options["applyClass"]="btn btn-sure";options["cancelClass"]="btn btn-cancel";this.$el.daterangepicker(options);var dataR=this.$el.data("daterangepicker");this.$el.on("apply.daterangepicker",function(ev,picker){var pat=self.settings["rangepickerOptions"]["format"];var startDate=moment(picker["startDate"]).format(pat),endDate=moment(picker["endDate"]).format(pat);self.model.set({startDate:startDate,endDate:endDate,isLongTerm:false,cycType:0,isCycle:false});self.trigger("sure",node)});this.$el.on("cancel.daterangepicker",function(){self.trigger("cancel",node)})},_changeStartDateHander:function(){this.$el.data("daterangepicker").setStartDate(this.model.get("startDate"))},_changeEndDateHander:function(){this.$el.data("daterangepicker").setEndDate(this.model.get("endDate"))},onClose:function(){}});var DateTimeLongView=Talent.Layout.extend({defaults:{rangepickerOptions:{parentEl:"div[data-name=date-time-long-date]",timePicker:false,format:"YYYY/MM/DD",showDropdowns:true,autoHide:false,opens:"left",minDate:"2013/01/01",singleDatePicker:true,locale:{applyLabel:"确定",cancelLabel:"取消",fromLabel:"开始时间",toLabel:"结束时间"}}},className:"date-long",template:jst["date-time-picker/date-time-long"],ui:{dateContent:"div[data-name=date-time-long-date]",checkout:"div[data-name=date-time-long-check]",buttonCandel:"[data-name=date-time-long-candel]",buttonSure:"[data-name=date-time-long-sure]",buttonCandelLong:"[data-name=date-time-long-candellong]",inputCheck:"[data-name=date-time-long-input]"},regions:{content:"div[data-name=date-time-picker-content]"},templateHelpers:function(){return{}},events:function(){var events={};events["click "+this.ui.checkout]="_openLongHandler";events["click "+this.ui.buttonCandelLong]="_cancelLongHandler";events["click "+this.ui.buttonCandel]="_cancelHandler";events["click "+this.ui.buttonSure]="_sureHandler";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);if(typeof this.options.rangepickerOptions=="object"){this.settings.rangepickerOptions=Talent._.extend({},this.defaults.rangepickerOptions,this.options.rangepickerOptions)}this.settings.rangepickerOptions["timePicker"]=false;this.startDate=this.model.get("startDate");this.endDate=this.model.get("endDate")},onRender:function(){var self=this},onShow:function(){this._renderDateView()},_cancelHandler:function(event){var node=Talent.$(event.currentTarget);this.trigger("cancel",node)},_sureHandler:function(event){var node=Talent.$(event.currentTarget);this.model.set({startDate:this.startDate,endDate:this.endDate,isLongTerm:true,cycType:0});this.trigger("sure",node)},_cancelLongHandler:function(event){var node=Talent.$(event.currentTarget);this.model.set("isLongTerm",false);this.trigger("cancelLong")},_openLongHandler:function(event){var node=Talent.$(event.currentTarget);var inputCheck=this.ui.inputCheck;if(inputCheck.hasClass("checkbox-checked")){inputCheck.removeClass("checkbox-checked");this.model.set("isLongTerm",false);this.trigger("cancelLong")}else{inputCheck.addClass("checkbox-checked");this.model.set("isLongTerm",true)}},_renderDateView:function(){var self=this;var options=Talent._.extend(this.settings["rangepickerOptions"],{startDate:this.model.get("startDate"),endDate:this.model.get("endDate")});this.ui.dateContent.daterangepicker(options);this.ui.dateContent.on("apply.daterangepicker",function(ev,picker){var startDate=moment(picker["startDate"]).format("YYYY/MM/DD"),endDate=moment(picker["endDate"]).format("YYYY/MM/DD");self.startDate=startDate;self.endDate=endDate})},onClose:function(){}});var DateTimePickerView=Talent.Layout.extend({defaults:{id:"date-time-picker",count:2,viewType:"date",isShowDateView:true,isShowCycleView:true,isShowLongView:true,rangepickerOptions:{timePickerOpens:"left",showLong:true,format:"YYYY/MM/DD HH:mm",timePicker:true},isShowTab:true},contentViewMap:{date:"_renderDateView","long":"_renderLongView",cycle:"_renderCycleView"},className:"tt-time-date-picker",template:jst["date-time-picker/date-time-picker"],ui:{content:"div[data-name=date-time-picker-content]"},regions:{content:"div[data-name=date-time-picker-content]"},templateHelpers:function(){return{}},events:function(){var events={};return events},modelEvents:{"change:viewType":"_changeTypeEvent"},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);if(this.settings["rangepickerOptions"]){this.settings["rangepickerOptions"]=Talent._.extend({},this.settings["rangepickerOptions"],options["rangepickerOptions"])}if(this.settings["count"]==1){this.settings["isShowTab"]=false;this.isShowDateView=false;this.isShowLongView=false;this.isShowCycleView=false;this.settings["rangepickerOptions"]["singleDatePicker"]=true;if(this.settings["rangepickerOptions"]["timePicker"]==true){this.settings["rangepickerOptions"]["timePicker"]==true;this.settings["rangepickerOptions"]["autoHide"]=false}else{this.settings["rangepickerOptions"]["autoHide"]=false;this.settings["rangepickerOptions"]["timePicker"]=false}this.$el.addClass("tt-time-date-picker-on")}this.model.set({viewType:this.settings.viewType});if(this.isShowDateView==false&&this.isShowCycleView==false&&this.isShowLongView==false){this.settings["isShowTab"]=false}this.$el.attr("id",this.settings["id"]);this.$el.on("mousedown",function(ev){ev.stopPropagation()});this.$el.on("click",function(ev){ev.stopPropagation()});Talent.$(document).on("mousedown.tt-DateTimePickerView",function(){self.trigger("cancel");self.close()});if(!this.settings["model"]){var startDate=this.settings["rangepickerOptions"]["startDate"]||moment().format("YYYY/MM/DD"),endDate=this.settings["rangepickerOptions"]["endDate"]||moment().add(1,"day").format("YYYY/MM/DD");this.model.set({
startDate:startDate,endDate:endDate,isLongTerm:true,isCycle:this.settings["viewType"]=="cycle"?true:false,cycType:0,cycStartDay:"",cycEndDay:"",cycStartHour:"08",cycStartMinute:"00",cycEndHour:"18",cycEndMinute:"00"},{silent:true})}},onRender:function(){var self=this},onShow:function(){this._renderTabView();this._changeTypeEvent()},show:function(node,options){this.$el.show();Context.setPosition(node,this.$el,options)},hide:function(){this.$el.hide()},_changeTypeEvent:function(){var methodName=this.contentViewMap[this.model.get("viewType")],view=this[methodName]();this.content.show(view)},_renderTabView:function(){if(!this.settings.isShowTab)return;this.tabView=new DateTimePickerTabView({model:this.model,isShowDateView:this.settings["isShowDateView"],isShowCycleView:this.settings["isShowCycleView"],isShowLongView:this.settings["isShowLongView"]});this.$el.prepend(this.tabView.render().$el)},_renderDateView:function(){if(this.dateView)return this.dateView;this.dateView=new DateView({model:this.model,rangepickerOptions:this.settings["rangepickerOptions"]});this.listenTo(this.dateView,"sure",function(node,options){this.trigger("sure",node,this.model.toJSON());this.hide()});this.listenTo(this.dateView,"cancel",function(node,options){this.trigger("cancel",node,this.model.toJSON());this.hide()});return this.dateView},_renderLongView:function(){if(this.dateTimeLongView)return this.dateTimeLongView;this.dateTimeLongView=new DateTimeLongView({model:this.model,rangepickerOptions:this.settings["rangepickerOptions"]});this.listenTo(this.dateTimeLongView,"cancel",function(node){this.trigger("cancel",node,this.model.toJSON());this.hide()});this.listenTo(this.dateTimeLongView,"sure",function(node){this.trigger("sure",node,this.model.toJSON());this.hide()});this.listenTo(this.dateTimeLongView,"cancelLong",function(){this.model.set("viewType","date");this.trigger("cancelLong")});return this.dateTimeLongView},_renderCycleView:function(){if(this.cycleTaskView)return this.cycleTaskView;var self=this;this.cycleTaskView=new DateTimeCycleView({model:this.model});this.listenTo(this.cycleTaskView,"cancel",function(node){this.close();this.trigger("cancel",node,this.model.toJSON())});this.listenTo(this.cycleTaskView,"resetCycle",function(node){this.model.set({isCycle:false});this.trigger("resetCycle",node,this.model.toJSON());this.close()});this.listenTo(this.cycleTaskView,"sureCycleDate",function(node){this.model.set({isCycle:true});this.close();this.trigger("sure",node,this.model.toJSON())});return this.cycleTaskView},onClose:function(){this.dateView&&this.dateView.close();Talent.$(document).off("mousedown.tt-dateTimePicker")}});var EmotionTabView=Talent.ItemView.extend({template:jst["emotion/emotion-tab"],className:"emotion-tab",ui:{item:".emotion-tab-item"},events:function(){var events={};events["click "+this.ui.item]="_clickItem";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options)},_clickItem:function(ev){ev.stopPropagation();var node=this.$(ev.currentTarget),id=node.attr("data-id");this.ui.item.removeClass("tab-active");node.addClass("tab-active");this.model.set("currentTab",id)}});var EmotionBodyView=Talent.ItemView.extend({template:jst["emotion/emotion-body"],initialize:function(options){this.settings=Talent._.extend({},this.defaults,options)},className:"emotion-body-scroll",ui:{emotionImg:'[data-name="emotion-img"]'},modelEvents:{"change:currentData":"render"},events:function(){var events={};events["click "+this.ui.emotionImg]="_clickEmotion";return events},_clickEmotion:function(ev){var node=this.$(ev.currentTarget),code=node.attr("title");this.trigger("clickEmotion",code);ev.stopPropagation()}});var EmotionView=Talent.Layout.extend({template:jst["emotion/emotion"],className:"tt-emotion-layout",defaults:{currentTab:"",triggerNode:Talent.$("body"),inputNode:null,dialogShowOption:{container:Talent.$("body"),boundingEl:Talent.$("body"),pos:"bottom",leftBias:0,topBias:10,adjust:0}},regions:{tabArea:'[data-name="emotion-tab-container"]',bodyArea:'[data-name="emotion-body-container"]'},modelEvents:{"change:currentTab":"_onTabChange"},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);if(typeof this.options.dialogShowOption=="object"){this.settings.dialogShowOption=Talent._.extend({},this.defaults.dialogShowOption,this.options.dialogShowOption)}this.model.set(this.settings);this._renderDialog();this.dee={};var inputNode=this.settings.inputNode;var caretPosAttr=this.caretPosAttr="emotion-caret-pos";var msie=/msie/.test(navigator.userAgent.toLowerCase());if(inputNode&&!inputNode.attr(caretPosAttr)&&msie){inputNode.attr(caretPosAttr,inputNode.val().length);inputNode.on("click keyup",function(){var pos=inputNode.caret("pos");inputNode.attr(caretPosAttr,pos)})}this.$el.on("mousedown",function(e){e.stopPropagation()})},onRender:function(){var self=this;EmotionCollection.getEmotionData().done(function(emotionData){Context.setGlobal("emotionData",emotionData);self.model.set({data:emotionData,currentTab:self.options.currentTab?self.options.currentTab:emotionData[0].name});self._renderAll()})},show:function(){this.Dialog.$el.show()},hide:function(){this.Dialog.$el.hide()},_renderAll:function(){this._renderTabView();this._renderBody();this.Dialog.show(this.settings.triggerNode,this.el,this.settings.dialogShowOption)},_renderTabView:function(){this.tabView=new EmotionTabView({model:this.model});this.tabArea.show(this.tabView)},_renderBody:function(){var self=this;this.bodyView=new EmotionBodyView({model:this.model});var msie=/msie/.test(navigator.userAgent.toLowerCase());this.listenTo(this.bodyView,"clickEmotion",function(code){var input=this.settings.inputNode;if(input){var val=input.val(),pos=input.caret("pos");if(msie){pos=parseInt(input.attr(this.caretPosAttr));input.attr(this.caretPosAttr,pos+code.length)}var before=val.substring(0,pos),after=val.substring(pos),str=before+code+after,newPos=pos+code.length;self.hide();input.val(str);input.caret("pos",newPos);input.focus().keyup()}});this.bodyArea.show(this.bodyView)},_onTabChange:function(){var currentTab=this.model.get("currentTab"),data=this.model.get("data"),currentData=Talent._.findWhere(data,{name:currentTab});this.model.set("currentData",currentData)},_renderDialog:function(){var self=this;this.Dialog=new TDialogView({type:"default",sure:false,cancel:false,showClosed:true,minWidth:465,className:"ns-emotion-dialog _tt_dialog"});this.listenTo(this.Dialog,"hide",function(){this.trigger("dialogHide")});this.settings.dialogShowOption.container.append(this.Dialog.render().$el);Talent.$(document).off("mousedown.tt-Emotion");Talent.$(document).on("mousedown.tt-emotion",function(){self.hide()})},onClose:function(){Talent.$(document).off("mousedown.tt-emotion");this.Dialog&&this.Dialog.close()}});var EmptyView=Talent.ItemView.extend({defaults:{emptyContext:"333333333"},template:jst["empty-view/empty"],className:"tt_common_emptyinit",initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options)},templateHelpers:function(){var emptyContext=this.settings.emptyContext?this.settings.emptyContext:this.model.get("emptyContext");var leng=0;if(emptyContext){leng=emptyContext.replace(/<[^>].*?>/g,"").replace(/[&nbsp;]/g,"").length}return{emptyContext:emptyContext,className:leng>24?"small_content_emptyinit":"content_emptyinit"}}});var EvaluationStarView=Talent.ItemView.extend({defaults:{lvl:5},template:jst["evaluation/evaluation-star"],ui:{iconStar:"li[data-name='star']"},events:function(){var events={};events["click "+this.ui.iconStar]="_selectStar";events["mouseenter "+this.ui.iconStar]="_mouseOverStar";events["mouseleave "+this.ui.iconStar]="_mouseOutStar";return events},modelEvents:{"change:value":"render"},initialize:function(options){if(!this.model.get("value")){this.model.set({value:0},{silent:true})}},onRender:function(){Talent.$(".tipsy").remove();this.ui.iconStar.tipsy({gravity:"s"})},onClose:function(){},onRender:function(){Talent.$(".tipsy").remove();this.ui.iconStar.tipsy({gravity:"s"})},onClose:function(){},_mouseOverStar:function(e){var node=Talent.$(e.currentTarget);this.ui.iconStar.each(function(index,item){if($(item).data("index")<=node.data("index")){$(item).attr("class","star-ico tu-icon-star-solid")}else{$(item).attr("class","star-ico tu-icon-star")}})},_mouseOutStar:function(e){var that=$(e.currentTarget);this.render()},_selectStar:function(e){var node=Talent.$(e.currentTarget);var value=node.attr("data-value");this.model.set("value",value);this.trigger("selectStar",this.model.toJSON())}});var DimensionItem=Talent.ItemView.extend({template:jst["evaluation/evaluation-dimension-item"],tagName:"li",className:"dimension-item",ui:{starRegion:"[data-name='star-container']"},initialize:function(options){var self=this;this.checkedModel=this.options["checkedModel"];this.checkedModel.on("change:type",function(){var type=self.checkedModel.get("type");if(type!=1){self.model.set("value",0)}})},onRender:function(){var self=this;this.model.set("type",4);this.evaluationStarView=new EvaluationStarView({model:this.model});this.listenTo(this.evaluationStarView,"selectStar",function(options){this.model.set("value",options["value"]);if(this.checkedModel.get("type")!=1){this.checkedModel.set("value",0)}this.checkedModel.set("type",1);this.trigger("score")},this);this.evaluationStarView.setElement(this.ui.starRegion);this.evaluationStarView.render()}});var MutiDimensionView=Talent.CompositeView.extend({defaults:{checkedModel:"",weiduCollection:""},template:jst["evaluation/evaluation-dimension"],itemView:DimensionItem,itemViewContainer:"ul",initialize:function(options){var self=this;this.settings=Talent.$.extend({},this.defaults,options);this.checkedModel=this.settings["checkedModel"];this.on("itemview:score",function(itemView){this.trigger("score")})},itemViewOptions:function(){return{checkedModel:this.checkedModel}},collectionEvents:{change:"_valueChange"},_valueChange:function(){},_radioChange:function(){if(this.model.get("radioChecked")==false){this.$el.addClass("nochecked")}else{this.$el.removeClass("nochecked")}}});var MedalItem=Talent.ItemView.extend({defaults:{isShowRadio:true},template:jst["evaluation/evaluation-medal"],ui:{medal:"div[data-name='evaluation-edit-medal'] .medal",radio:"[data-name='radio']"},events:function(){var events={};events["click "+this.ui.radio]="_selectRadio";events["click "+this.ui.medal]="_selectMedal";return events},templateHelpers:function(){var self=this;var data=this.model.get("data");Talent._.each(data,function(item,index){item["className"]=self.medalClass[index]});return{isShowRadio:this.settings["isShowRadio"],cType:this.checkedModel.get("cType"),data:data,type:this.checkedModel.get("type")}},initialize:function(options){var self=this;this.settings=Talent.$.extend({},this.defaults,options);this.checkedModel=this.settings["checkedModel"];this.medalClass={0:"medal-ico tu-icon-medal-solid",1:"medal-ico tu-icon-like--solid",2:"medal-ico tu-icon-heart-solid"};this.checkedModel.on("change:type",function(){var type=self.checkedModel.get("type");if(type!=2){self.render()}})},onRender:function(){this._radioChange()},_selectMedal:function(e){var node=$(e.currentTarget),index=Number(node.attr("data-index"));var data=this.model.get("data")[index];var klass=node.find("span");this.checkedModel.set(data);this.checkedModel.set("type",2);this.render()},_selectRadio:function(){if(this.checkedModel.get("type")!=2){this.ui.radio.attr("class","evaluation-title radio-checked");this.checkedModel.set({value:0,type:2})}},_radioChange:function(){if(this.checkedModel.get("type")==2){this.ui.radio.attr("class","evaluation-title radio-checked");this.checkedModel.set("type",2)}else{this.ui.radio.attr("class","evaluation-title radio");this.model.set("value",0);this.ui.medal.removeClass("medal-active")}}});var EvaluationScore=Talent.ItemView.extend({defaults:{isShowRadio:true},template:jst["evaluation/evaluation-score"],ui:{starArea:"[data-name='evaluation-edit-score']",radio:"[data-name='radio']"},templateHelpers:function(){return{isShowRadio:this.settings.isShowRadio}},events:function(){var events={};events["click "+this.ui.radio]="_selectRadio";return events},initialize:function(options){var self=this;this.settings=Talent.$.extend({},this.defaults,options);this.checkedModel=this.settings["checkedModel"];if(this.checkedModel.get("type")==1){if(this.checkedModel.get("cType")!=this.model.get("cType")){this.model.set("value",0)}else{this.model.set("value",this.checkedModel.get("value"))}}else{this.model.set("value",0)}this.checkedModel.on("change:type",function(){self._radioChange()})},onRender:function(){var self=this;this.evaluationStarView=new EvaluationStarView({model:this.model});this.listenTo(this.evaluationStarView,"selectStar",function(options){this._selectRadio();this.model.set("value",options["value"]);this.model.set("type",1);this.checkedModel.set(this.model.toJSON())},this);this.evaluationStarView.setElement(this.ui.starArea);this.evaluationStarView.render();this._radioChange();this.model.set("type",1)},_radioChange:function(){if(this.checkedModel.get("type")==1){this.ui.radio.attr("class","evaluation-title radio-checked");this.checkedModel.set({cType:this.model.get("cType"),name:""})}else{this.ui.radio.attr("class","evaluation-title radio");this.model.set("value",0)}},_selectRadio:function(){if(this.checkedModel.get("type")!=1){this.$el.removeClass("nochecked");this.ui.radio.attr("class","evaluation-title radio-checked");this.model.set("value",0);this.checkedModel.set(this.model.toJSON())}}});var EvaluationEditView=Talent.Layout.extend({defaults:{types:[2,1,4],customOptions:{1:[{name:"综合评分",lvl:5,goal:2,cType:0}],2:[{name:"太棒了！",lvl:0,goal:0,cType:1},{name:"干的不错！",lvl:0,goal:0,cType:2},{name:"再接再厉!",lvl:0,goal:0,cType:3}],4:[{name:"3",lvl:5,goal:2,cType:3},{name:"2",lvl:5,goal:2,cType:2},{name:"4",lvl:5,goal:2,cType:4},{name:"5",lvl:5,goal:2,cType:5}],remark:""},data:"",remark:""},template:jst["evaluation/evaluation-edit"],regions:{scoreContainer:"[data-name='evaluation-edit-score']",dimensionContainer:"[data-name='evaluation-edit-dimension']",medalContainer:"[data-name='evaluation-edit-medal']"},ui:{commentText:"[data-name='comment']",btnSure:"[data-name='evaluation-save']",btnCancel:"[data-name='evaluation-cancel']"},events:function(){var events={};events["keyup "+this.ui.commentText]="_keyupHandler";events["click "+this.ui.btnSure]="_saveEvaluation";events["click "+this.ui.btnCancel]="_cancelEdit";return events},initialize:function(options){var self=this;this.settings=Talent.$.extend({},this.defaults,options);this.customOptions=this.settings["customOptions"];this.model.set({remark:this.settings["remark"],data:this.settings["data"]});this.data=this.settings["data"]||[];var wdData=[];var checkoutData={};for(var i=0;i<this.data.length;i++){if(this.data[i].type==4){wdData.push(this.data[i])}else{checkoutData=this.data[i]}}this.weiduCollection=new Talent.Collection(wdData);this.checkedModel=new Talent.Model(checkoutData);this.checkedModel.on("change",function(){self._changeBtn()});this._formatData()},onRender:function(){if(this.model.get("isShowScores")){this._showScoreItemView();if(this.model.get("isShowDimensions")){this._showDimensionView()}}if(this.model.get("isShowMedal")){this._showMedalItemView()}this.ui.commentText.focus(function(e){var that=$(e.currentTarget);if(that.val()==that.attr("placeholder")){that.val("").removeClass("placeholder")}}).blur(function(e){var that=$(e.currentTarget);if(that.val()==""){that.val(that.attr("placeholder")).addClass("placeholder")}})},_formatData:function(){var settings=this.settings,types=settings["types"];var isShowScores=Talent._.indexOf(types,1)>-1?true:false,isShowDimensions=Talent._.indexOf(types,4)>-1&&isShowScores?true:false,isShowMedal=Talent._.indexOf(types,2)>-1?true:false,isShowRadio=isShowScores&&isShowMedal;var evaluateInfos=this.model.get("medalInfos");this.model.set({isShowScores:isShowScores,isShowDimensions:isShowDimensions,isShowMedal:isShowMedal,isShowRadio:isShowRadio});if(isShowRadio){this.$el.addClass("has-radio")}else{this.$el.removeClass("has-radio")}},_changeBtn:function(){var value=Number(this.checkedModel.get("value"));if(value==0){this.ui.btnSure.addClass("btn-disabled")}else{this.ui.btnSure.removeClass("btn-disabled")}},_keyupHandler:function(e){var node=$(e.currentTarget);var val=Talent.$.trim(node.val());if(val.length>1e3){return false;node.addClass("input-error").removeClass("input-focus");this._changeBtn()}else{node.removeClass("input-error").addClass("input-focus");this.model.set("remark",val);this._changeBtn()}},_cancelEdit:function(e){this.trigger("cancel");e.stopPropagation()},_saveEvaluation:function(e){var checkedModel=this.checkedModel.toJSON();if(checkedModel.value==0){return}var node=Talent.$(e.currentTarget);var data=[];data.push(checkedModel);if(this.checkedModel.get("type")==1&&this.model.get("isShowDimensions")){var weiduData=this.dimensionView.collection.toJSON();for(var i=0;i<weiduData.length;i++){if(weiduData[i].value!==0){data=data.concat(weiduData[i])}}}this.trigger("submit",node,{evaluateInfos:data,remark:this.model.get("remark")})},_showScoreItemView:function(){this.scoreView=new EvaluationScore({data:this.settings["data"],model:new Talent.Model(this.customOptions[1][0]),isShowRadio:this.model.get("isShowRadio"),checkedModel:this.checkedModel});this.listenTo(this.scoreView,"selectValue",this._itemCheck);this.scoreContainer.show(this.scoreView)},_showMedalItemView:function(){var data=this.customOptions[2];for(var i=0;i<data.length;i++){data[i]["value"]=i+1}this.medalView=new MedalItem({data:this.settings["data"],model:new Talent.Model({data:data}),isShowRadio:this.model.get("isShowRadio"),checkedModel:this.checkedModel});this.listenTo(this.medalView,"selectValue",this._itemCheck);this.medalContainer.show(this.medalView)},_showDimensionView:function(){var data=this.customOptions[4];for(var i=0;i<data.length;i++){var ctype=data[i]["cType"];var resp=this.weiduCollection.findWhere({cType:ctype});if(resp){data[i]["value"]=resp.get("value")}else{data[i]["value"]=0}}this.dimensionView=new MutiDimensionView({collection:new Talent.Collection(data),checkedModel:this.checkedModel,weiduCollection:this.weiduCollection});this.listenTo(this.dimensionView,"score",function(){this._changeBtn()});this.dimensionContainer.show(this.dimensionView)}});var EvaluationListItemView=Talent.ItemView.extend({defaults:{evaluationObject:"",customOptions:""},className:"evaluation-item-box",template:jst["evaluation/evaluation-list-item"],ui:{doEvaluation:"[data-name=do-evaluation]",editEvaluation:"[data-name=evaluation-edit]",showDetailTop:"[data-name=showDetail-top]",showDetail:"[data-name='showDetail']",showAllComment:"[data-name='show-comment']",weiduList:"[data-name=evaluation-weidu-list]"},modelEvents:{"change:commentShowAll":"render","change:viewMode":"render"},templateHelpers:function(){var remark=this.model.get("remark");var substringRemark=_.substring(remark,300,true);var evaluateInfos=this.model.get("evaluateInfos");var dimensionInfos=[];for(var i=0;i<evaluateInfos.length;i++){if(evaluateInfos[i]["type"]==4){dimensionInfos.push(evaluateInfos[i])}}return{evaluationObject:this.settings["evaluationObject"],substringRemark:substringRemark,dimensionInfos:dimensionInfos,isAdd:this.settings.isAdd}},events:function(){var events={};events["click "+this.ui.doEvaluation]="_renderEvaluationEditView";events["click "+this.ui.editEvaluation]="_renderEvaluationEditView";events["click "+this.ui.showDetailTop]="_viewDimension";events["click "+this.ui.showDetail]="_viewDimension";events["click "+this.ui.showAllComment]="_showDetail";return events},initialize:function(options){this.settings=Talent.$.extend({},this.defaults,options);this.medalClass={1:"tu-icon-medal-solid",2:"tu-icon-like--solid",3:"tu-icon-heart-solid"};this._settingData();this.listOpen=false},onRender:function(){},_showDetail:function(e){e.stopPropagation();if(this.model.get("commentShowAll")==true){this.model.set("commentShowAll",false)}else{this.model.set("commentShowAll",true)}},_viewDimension:function(e){e.stopPropagation();if(!this.listOpen){this.model.set("viewMode","detailed");this.listOpen=true}else{this.model.set("viewMode","simple");this.listOpen=false}},_settingData:function(){var medalInfos=[],scoreInfos=[],dimensionInfos=[],evaluationInfos=this.model.get("evaluateInfos"),settings=this.settings["CompositeOptions"],remark=this.model.get("remark")||"完成的不错，继续努力！",simpleRemark;if(evaluationInfos.length>0){for(var i=evaluationInfos.length-1;i>=0;i--){var item=evaluationInfos[i],type=item.type;if(type==1){scoreInfos.push(item)}if(type==2){type=type.toString();item["className"]=this.medalClass[item.value];medalInfos.push(item)}if(type==4){dimensionInfos.push(item)}}}this.model.set({viewMode:"simple",dimensionInfos:dimensionInfos,medalInfos:medalInfos,scoreInfos:scoreInfos,remark:remark,commentShowAll:false})},_renderEvaluationEditView:function(event){this.evaluationEditView=new EvaluationEditView({data:this.model.get("evaluateInfos"),customOptions:this.settings["customOptions"],types:this.settings["customOptions"]["types"],remark:this.model.get("remark")});this.listenTo(this.evaluationEditView,"submit",function(node,data){this.model.set({evaluateInfos:data["evaluateInfos"],remark:data["remark"]});this.trigger("saveEvaluation",node,data);this.render()},this);this.listenTo(this.evaluationEditView,"cancel",function(data){this.render();this.$el.removeClass("active")},this);this.$el.html(this.evaluationEditView.render().$el).addClass("active")}});var EvaluationView=Talent.CompositeView.extend({defaults:{evaluationObject:"还没有对任务进行评价",isAdd:false,customOptions:{types:[2,1,4],1:[{name:"综合评分",lvl:5,goal:2,cType:0}],2:[{name:"太棒了！",lvl:0,goal:0,cType:1},{name:"干的不错！",lvl:0,goal:0,cType:2},{name:"再接再厉!",lvl:0,goal:0,cType:3}],4:[{name:"3",lvl:5,goal:2,cType:3},{name:"2",lvl:5,goal:2,cType:2},{name:"4",lvl:5,goal:2,cType:4},{name:"5",lvl:5,goal:2,cType:5}]}},itemView:EvaluationListItemView,itemViewContainer:this.el,template:_.template(""),className:"tu-mt-15",initialize:function(options){var self=this;this.settings=Talent.$.extend({},this.defaults,options);this.settings["options"]=Talent.$.extend({},this.defaults,options);this.on("itemview:saveEvaluation",function(itemview,node,data){self.trigger("saveEvaluation",node,data)})},itemViewOptions:function(){return{customOptions:this.settings["customOptions"],evaluationObject:this.settings["evaluationObject"],isAdd:this.settings["isAdd"]}},events:function(){var events={};return events},onRender:function(){}});var ImgPreviewInfoView=Talent.ItemView.extend({defaults:{originW:"",originH:""},className:"info_ip",template:jst["img-preview/img-preview-info"],modelEvents:{"change:previewUrl":"render"},ui:{iconCircle:"[data-name=icon-circle]",iconFnName:"[data-name=icon-fn-name]",zoom:"li[data-name=img-zoom]",close:"li[data-name=img-close]"},events:function(){var events={};events["click "+this.ui.zoom]="_clickZoomHandler";events["click "+this.ui.close]="_clickCloseHandler";return events},initialize:function(options){this.settings=_.extend({},this.defaults,options)},onRender:function(){this._getImgOriginWH()},_getImgOriginWH:function(){var originImgSrc=this.model.get("previewUrl"),originW=this.settings.originW,originH=this.settings.originH,img=new Image,self=this;img.onload=function(){if(self.isClosed)return;var imgW=img.width;var imgH=img.height;if(imgW>originW||imgH>originH){self.ui.zoom.show()}};img.src=originImgSrc},_clickZoomHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),zoomType=node.data("zoom-type");if(zoomType=="In"){node.data("zoom-type","Out");this.ui.iconCircle.removeClass("tu-icon-f-enlarge").addClass("tu-icon-f-narrow");this.ui.iconFnName.html("适应屏幕")}else{node.data("zoom-type","In");this.ui.iconCircle.addClass("tu-icon-f-enlarge").removeClass("tu-icon-f-narrow");this.ui.iconFnName.html("查看原图")}this.trigger("zoom",zoomType)},_clickCloseHandler:function(event){event.stopPropagation();this.trigger("close")}});var ImgPreviewContentItemView=Talent.ItemView.extend({template:jst["img-preview/img-preview-content-item"],tagName:"li",templateHelpers:function(){return{previewUrl:this.model.get("previewUrl").replace(/\_b/,"_s")}},modelEvents:{"change:active":"render"},onRender:function(){var height=this.$el.height();if(this.model.get("active")){this.$el.addClass("active")}else{this.$el.removeClass("active")}}});var ImgPreviewVisibleAreaView=Talent.ItemView.extend({defaults:{originImg:""},template:jst["img-preview/img-preview-visible-area"],className:"img-preview-visible-area",templateHelpers:function(){return{}},ui:{visibleImgWrap:"[data-name=visible-img-wrap]",visibleLayerLeft:"[data-name=visible-layer-left]",visibleLayerTop:"[data-name=visible-layer-top]",visibleLayerRight:"[data-name=visible-layer-right]",visibleLayerBottom:"[data-name=visible-layer-bottom]",visibleScope:"[data-name=visible-scope]"},modelEvents:{},initialize:function(){this.settings=_.extend({},this.defaults,this.options)},onRender:function(){},onShow:function(){this._setImgStyle()},_setImgStyle:function(){var modelData=this.model.toJSON(),originW=modelData.originW,originH=modelData.originH,originImg=this.settings.originImg,originImgW=originImg.width(),originImgH=originImg.height(),imgUrl=originImg[0].src,self=this;if(imgUrl=="")return;var oImg=new Image;oImg.onload=function(){if(self.isClosed)return;self.ui.visibleImgWrap.html("");var imgW=oImg.width;var imgH=oImg.height;self.imgCss=self._setImg(imgW,imgH);self.ui.visibleImgWrap.html('<img src="'+imgUrl+'" style="'+self.imgCss["css"]+'" />');self.setLayerStyle()};oImg.src=imgUrl},setLayerStyle:function(){var self=this,imgCss=self.imgCss,imgW=imgCss["width"],imgH=imgCss["height"],imgL=imgCss["left"],imgT=imgCss["top"],originW=this.model.get("originW"),originH=this.model.get("originH"),originImg=this.settings.originImg,originImgW=originImg.width(),originImgH=originImg.height(),originImgL=originImg.position().left,originImgT=originImg.position().top,layerLeft=this.ui.visibleLayerLeft,layerTop=this.ui.visibleLayerTop,layerRight=this.ui.visibleLayerRight,layerBottom=this.ui.visibleLayerBottom,visibleScope=this.ui.visibleScope,thisViewW=this.$el.width(),thisViewH=this.$el.height(),scale=this.imgScale,visibleScopeTrueW=originW/scale,visibleScopeTrueH=originH/scale,visibleScopeTrueL=imgL+-originImgL/scale,visibleScopeTrueT=imgT+-originImgT/scale,visibleScopeW="",visibleScopeH="",visibleScopeL="",visibleScopeT="";if(visibleScopeTrueL<imgL){visibleScopeW=visibleScopeTrueW-4+visibleScopeTrueL-imgL;visibleScopeL=imgL}else{visibleScopeW=visibleScopeTrueW-4;visibleScopeL=visibleScopeTrueL}if(visibleScopeTrueT<imgT){visibleScopeH=visibleScopeTrueH-4+visibleScopeTrueT-imgT;visibleScopeT=imgT}else{visibleScopeH=visibleScopeTrueH-4;visibleScopeT=visibleScopeTrueT}if(visibleScopeW+4+visibleScopeL-imgL>imgW){visibleScopeW=imgW-(4+visibleScopeL-imgL)}if(visibleScopeH+4+visibleScopeT-imgT>imgH){visibleScopeH=imgH-(4+visibleScopeT-imgT)}visibleScope.css({width:visibleScopeW,height:visibleScopeH,top:visibleScopeT,left:visibleScopeL});layerLeft.css({width:visibleScopeL,height:thisViewH});layerTop.css({width:visibleScopeW+4,height:visibleScopeT,left:visibleScopeL});layerRight.css({width:thisViewW-(visibleScopeL+visibleScopeW+4),height:thisViewH});layerBottom.css({width:visibleScopeW+4,height:thisViewH-(visibleScopeT+visibleScopeH+4),left:visibleScopeL})},_setImg:function(width,height){var thisViewW=this.$el.width(),thisViewH=this.$el.height(),originImg=this.settings.originImg,originImgW=originImg.width(),originImgH=originImg.height(),WH=this._fixImgSize(width,height,thisViewW,thisViewH),top=(thisViewH-WH["h"])/2,left=(thisViewW-WH["w"])/2;this.imgScale=originImgW/WH["w"];return{width:WH["w"],height:WH["h"],top:top,left:left,css:"width:"+WH["w"]+"px;height:"+WH["h"]+"px;top:"+top+"px;left:"+left+"px;"}},_fixImgSize:function(initWidth,initHeight,aiDefWid,aiDefHei){var WH={w:0,h:0};var initWid=initWidth;var initHei=initHeight;var defWid=aiDefWid;var defHei=aiDefHei;if(initWid>0&&initHei>0){var defFix=defWid/defHei;var initFix=initWid/initHei;if(initWid>defWid||initHei>defHei){if(initFix>defFix){WH.w=defWid;WH.h=initHei*(defWid/initWid)}else{WH.w=initWid*(defHei/initHei);WH.h=defHei}}else{WH.w=initWid;WH.h=initHei}}else{WH.w=initWid;WH.h=initHei}return WH}});var ImgPreviewContentView=Talent.CompositeView.extend({className:"img-preview-dialog",template:jst["img-preview/img-preview-content"],itemView:ImgPreviewContentItemView,itemViewContainer:"ul[data-name=thumb-list]",modelEvents:{"change:praiseTotal":"render"},ui:{originLeft:'span[data-name="origin-left"]',originRight:"span[data-name=origin-right]",originBox:"div[data-name=origin-box]",originImg:"img[data-name=origin-img]",thumbPre:"div[data-name=thumb-pre]",thumbNext:"div[data-name=thumb-next]",button_thumbPre:"div[data-name=thumb-pre] span",button_thumbNext:"div[data-name=thumb-next] span",thumbListBox:"div[data-name=thumb-list-box]",thumbList:"ul[data-name=thumb-list]",thumbList_item:"ul[data-name=thumb-list] li",infoBox:"div[data-name=img-preview-info]",overlay:"div[data-name=img-preview-overlay]",visibleArea:"div[data-name=visible-area]"},events:function(){var events={};events["click "+this.ui.thumbPre]="_thumbPreHandler";events["click "+this.ui.thumbNext]="_thumbNextHandler";events["click "+this.ui.thumbList_item]="_thumbItemHandler";events["click "+this.ui.originLeft]="_originLeftHandler";events["click "+this.ui.originRight]="_originRightHandler";return events},templateHelpers:function(){var thumbList=this.model.get("thumbList")||[],thumbListLen=thumbList.length;return{thumbListLen:thumbListLen,thumbIndex:this.thumb_index}},initialize:function(options){var self=this;this.model.set("thumbList",this.collection.toJSON());this.loadingView=new LoadingView;this._dealAllPositon();this.thumb_page_index=0;this.thumb_index=0;this.animateIng=false;if(this.options["index"]){this.thumb_index=this.options["index"]}this.imgFirstModel=this.collection.slice(this.thumb_index,this.thumb_index+1)[0];this.imgFirstModel.set("active",true);this.$el.on("click",function(event){event.stopPropagation()});Talent.$(document).off("keyup.img-preview-content-view");Talent.$(document).on("keyup.img-preview-content-view",function(ev){self._keyupSwitchOriginHandler(ev)});Talent.$(document).off("contextmenu.img-preview-content-view");Talent.$(document).on("contextmenu.img-preview-content-view",function(e){return false});this.scale=1;this.isMoveing=false},_keyupSwitchOriginHandler:function(ev){ev.stopPropagation();var thumbList=this.model.get("thumbList")||[],thumbListLen=thumbList.length,thumbIndex=this.thumb_index,keyCode=ev.keyCode||ev.which;if(keyCode==37||keyCode==38){if(thumbIndex!=0)this._originLeft()}if(keyCode==39||keyCode==40){if(thumbIndex!=thumbListLen-1)this._originRight()}},appendHtml:function(cv,iv,index){var $container=this.getItemViewContainer(cv);if(iv.model.get("isImage")){$container.append(iv.el)}},onShow:function(){this.ui.originBox.html(this.loadingView.render().el);this._setAllWH();this._renderOriginImg();this.ui.button_thumbPre.hide();this._renderInfoView(this.imgFirstModel);this.ui.thumbList_item.removeClass("active");this.ui.thumbList_item.eq(this.thumb_index).addClass("active")},hide:function(){this.close()},_renderInfoView:function(model){var originW=this.model.get("originW"),originH=this.model.get("originH");this.imgPreviewInfoView=new ImgPreviewInfoView({model:model,originW:originW,originH:originH});this.listenTo(this.imgPreviewInfoView,"zoom",function(zoomType){var oImg=this.ui.originBox.find("img");if(zoomType=="In"){this._imgZoomIn(oImg)}else{this._imgZoomOut(oImg)}});this.listenTo(this.imgPreviewInfoView,"close",function(){this.trigger("closed")});this.ui.infoBox.html(this.imgPreviewInfoView.render().el)},_dealAllPositon:function(){var dialogW=this.model.get("dialogW"),dialogH=this.model.get("dialogH");var thumbWidth=80+120,infoHeight=50;

var originW=dialogW-thumbWidth,originH=dialogH-infoHeight;this.model.set({originW:originW,originH:originH,originPageTop:originH/2-20})},_setAllWH:function(){var originW=this.model.get("originW"),originH=this.model.get("originH");var imgLenght=Talent._.where(this.collection.toJSON(),{isImage:true}).length;var thumbWH=60+20;this.ui.originBox.width(originW).height(originH);var h_thumbListBox=Math.floor((originH-60-80-40)/thumbWH)*thumbWH;this.ui.thumbListBox.height(h_thumbListBox);this.model.set("thumbListBoxHeight",h_thumbListBox);var h_thumbList=imgLenght*thumbWH;this.ui.thumbList.height(h_thumbList);this.thumb_pagesize=Math.ceil(h_thumbList/h_thumbListBox);if(h_thumbList<h_thumbListBox){this.ui.thumbPre.hide();this.ui.thumbNext.hide();this.ui.thumbList.css("margin-top",(h_thumbListBox-h_thumbList)/2)}else{this.ui.thumbPre.show();this.ui.thumbNext.show();this.ui.thumbList.css("margin-top","")}},_renderOriginImg:function(){var idx=this.thumb_index;var data=this.collection.slice(idx,idx+1)[0];if(!data){return}var self=this,url=data.get("previewUrl");var img=new Image;img.onload=function(){if(self.isClosed)return;self.ui.originBox.html("");var imgW=img.width;var imgH=img.height;var imgCss=self._setImg(imgW,imgH);self.ui.originBox.html('<img data-name="origin-img" src="'+url+'" style="'+imgCss["css"]+'" data-img-origin-w="'+imgW+'" data-img-origin-h="'+imgH+'">');var oImg=self.ui.originBox.find("img");self._renderImgVisibleAreaView(oImg)};img.src=url},_imgMove:function(oImg){var self=this,originW=this.model.get("originW"),originH=this.model.get("originH"),imgW=oImg.width(),imgH=oImg.height();if(imgW<=originW&&imgH<=originH)return;oImg.off("mousedown.img-preview-content");oImg.on("mousedown.img-preview-content",function(ev){var ev=ev||event,$this=$(this),imgL=$(this).position().left,imgT=$(this).position().top,disX=ev.clientX-imgL,disY=ev.clientY-imgT;function move(ev){var left="0px",top="0px",moveDisX=ev.clientX-disX,moveDisY=ev.clientY-disY;self.ui.originBox.addClass("cursor-grabbing");$this.css({left:moveDisX+"px",top:moveDisY+"px"});self.imgPreviewVisibleAreaView.setLayerStyle();$this.setCapture&&$this.setCapture();return false}function up(ev){self.ui.originBox.removeClass("cursor-grabbing");$(document).off("mousemove.img-preview-content");$(document).off("mouseup.img-preview-content");$this[0].releaseCapture&&$this[0].releaseCapture()}if(self.isMoveing){$(document).on("mousemove.img-preview-content",move);$(document).on("mouseup.img-preview-content",up)}else{$(document).off("mousemove.img-preview-content");$(document).off("mouseup.img-preview-content")}ev.preventDefault()});oImg.off("click.img-preview-content ");oImg.on("click.img-preview-content ",function(ev){ev.stopPropagation()})},_setImg:function(width,height){var originW=this.model.get("originW"),originH=this.model.get("originH"),WH=this._fixImgSize(width,height,originW,originH),top=(originH-WH["h"])/2,left=(originW-WH["w"])/2;return{width:WH["w"],height:WH["h"],top:top,left:left,css:"width:"+WH["w"]+"px;height:"+WH["h"]+"px;top:"+top+"px;left:"+left+"px;"}},_fixImgSize:function(initWidth,initHeight,aiDefWid,aiDefHei){var WH={w:0,h:0};var initWid=initWidth;var initHei=initHeight;var defWid=aiDefWid;var defHei=aiDefHei;if(initWid>0&&initHei>0){var defFix=defWid/defHei;var initFix=initWid/initHei;if(initWid>defWid||initHei>defHei){if(initFix>defFix){WH.w=defWid;WH.h=initHei*(defWid/initWid)}else{WH.w=initWid*(defHei/initHei);WH.h=defHei}}else{WH.w=initWid;WH.h=initHei}}else{WH.w=initWid;WH.h=initHei}return WH},_originLeftHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this._originLeft()},_originLeft:function(){--this.thumb_index;if(this.thumb_index<0){this.thumb_index=0;return}this._collectionChangeActive();this._renderOriginImg();this._controlOriginArrowDisplay()},_originRightHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this._originRight()},_originRight:function(){++this.thumb_index;if(this.thumb_index>this.collection.length){this.thumb_index=this.collection.length;return}this._collectionChangeActive();this._renderOriginImg();this._controlOriginArrowDisplay()},_originBoxClickHandler:function(event){event.stopPropagation();var oImg=this.ui.originBox.find("img");if(!oImg.length)return;if(this.ui.originBox.hasClass("cursor-zoom-out")){this._imgZoomOut(oImg)}if(this.ui.originBox.hasClass("cursor-zoom-in")){this._imgZoomIn(oImg)}},_controlOriginArrowDisplay:function(){var thumbList=this.model.get("thumbList")||[],thumbListLen=thumbList.length,thumbIndex=this.thumb_index;if(thumbIndex==0){this.ui.originLeft.hide();this.ui.originRight.show()}else if(0<thumbIndex&&thumbIndex<thumbListLen-1){this.ui.originLeft.show();this.ui.originRight.show()}else if(thumbIndex==thumbListLen-1){this.ui.originRight.hide();this.ui.originLeft.show()}},_imgZoomOut:function(oImg){var imgParams={imgW:oImg.width(),imgH:oImg.height(),imgL:oImg.position().left,imgT:oImg.position().top,imgOriginW:oImg.data("img-origin-w"),imgOriginH:oImg.data("img-origin-h"),originW:this.model.get("originW"),originH:this.model.get("originH"),newW:"",newH:""},originScale=imgParams.originW/imgParams.originH,imgScale=imgParams.imgOriginW/imgParams.imgOriginH,self=this;if(imgScale>originScale){imgParams.newW=imgParams.originW;imgParams.newH=imgParams.newW/imgScale}else{imgParams.newH=imgParams.originH;imgParams.newW=imgParams.newH*imgScale}this.ui.originBox.removeClass("cursor-grab");this._resetImgStyle(imgParams,oImg,function(){self.isMoveing=false;self._renderImgVisibleAreaView(oImg)})},_imgZoomIn:function(oImg){var imgParams={imgW:oImg.width(),imgH:oImg.height(),imgL:oImg.position().left,imgT:oImg.position().top,imgOriginW:oImg.data("img-origin-w"),imgOriginH:oImg.data("img-origin-h"),originW:this.model.get("originW"),originH:this.model.get("originH"),newW:"",newH:""},originScale=imgParams.originW/imgParams.originH,imgScale=imgParams.imgOriginW/imgParams.imgOriginH,self=this;imgParams.newW=imgParams.imgOriginW;imgParams.newH=imgParams.imgOriginH;this.ui.originBox.addClass("cursor-grab");this._resetImgStyle(imgParams,oImg,function(){self.isMoveing=true;self._imgMove(oImg);self._renderImgVisibleAreaView(oImg)})},_resetImgStyle:function(imgParams,oImg,animateCallback){var self=this;if(imgParams.newW<=imgParams.originW&&imgParams.newH<=imgParams.originH){oImg.animate({width:imgParams.newW,height:imgParams.newH,left:(imgParams.originW-imgParams.newW)/2,top:(imgParams.originH-imgParams.newH)/2},animateCallback)}else{oImg.animate({width:imgParams.newW,height:imgParams.newH,left:imgParams.imgL+parseInt((imgParams.imgW-imgParams.newW)/2),top:imgParams.imgT+parseInt((imgParams.imgH-imgParams.newH)/2)},animateCallback)}},_renderImgVisibleAreaView:function(oImg){var imgW=oImg.width(),imgH=oImg.height(),modelData=this.model.toJSON(),originH=modelData.originH,originW=modelData.originW;this.imgPreviewVisibleAreaView&&this.imgPreviewVisibleAreaView.close();if(imgW<originW&&imgH<originH){this.ui.visibleArea.hide();return}else{this.ui.visibleArea.show()}this.imgPreviewVisibleAreaView=new ImgPreviewVisibleAreaView({model:this.model,originImg:oImg});this.ui.visibleArea.append(this.imgPreviewVisibleAreaView.render().$el);this.imgPreviewVisibleAreaView.onShow()},_originBoxMousemoveHandler:function(event){var oImg=this.ui.originBox.find("img");if(!oImg.length)return;var originW=this.model.get("originW"),originOffsetL=this.ui.originBox.offset().left,originOffsetT=this.ui.originBox.offset().top;if(event.clientX-originOffsetL>originW/2){this.ui.originBox.removeClass("cursor-zoom-out").addClass("cursor-zoom-in")}else{this.ui.originBox.removeClass("cursor-zoom-in").addClass("cursor-zoom-out")}},_thumbPreHandler:function(event){event.stopPropagation();if(this.animateIng)return;this.animateIng=true;var self=this;--this.thumb_page_index;if(this.thumb_page_index<0){this.thumb_page_index=0}if(this.thumb_page_index===0){this.ui.button_thumbPre.hide()}var itemLong=this.model.get("thumbListBoxHeight");movelong=this.thumb_page_index*itemLong;this.animateIng=true;this.ui.thumbList.stop().animate({"margin-top":-movelong},function(){self.animateIng=false});this.ui.button_thumbNext.show()},_thumbNextHandler:function(event){if(this.animateIng)return;this.animateIng=true;var self=this;++this.thumb_page_index;if(this.thumb_page_index>this.thumb_pagesize||this.thumb_page_index==this.thumb_pagesize){this.thumb_page_index=this.thumb_pagesize;return}if(this.thumb_pagesize-1==this.thumb_page_index){this.ui.button_thumbNext.hide()}var movelong=this.thumb_page_index*this.model.get("thumbListBoxHeight");this.ui.thumbList.stop().animate({"margin-top":-+movelong},function(){self.animateIng=false});this.ui.button_thumbPre.show()},_thumbItemHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var idx=node.index();this.thumb_index=idx;this.ui.originBox.html(this.loadingView.render().$el);this._collectionChangeActive();this._renderOriginImg();this._controlOriginArrowDisplay()},_collectionChangeActive:function(){var self=this;this.collection.each(function(item,index){item.set("active",false);if(index==self.thumb_index){item.set("active",true);self._renderInfoView(item)}})},onClose:function(){Talent.$(document).off("keyup.img-preview-content-view");Talent.$(document).off("contextmenu.img-preview-content-view")}});var ImgPreviewView=Talent.ItemView.extend({defaults:{index:0,overlay:true},className:"img-preview-dialog-wrap",template:jst["img-preview/img-preview"],modelEvents:{},ui:{},events:function(){var events={};return events},initialize:function(options){this.settings=Talent._.extend({},options,this.defaults)},onRender:function(){this._createBackground()},_setWidthHeight:function(){var windowW=Talent.$(window).width(),windowH=Talent.$(window).height();return{windowW:windowW,windowH:windowH,dialogW:windowW>1200?1200:windowW,dialogH:windowH-40}},_createBackground:function(){var setWH=this._setWidthHeight();var model=Talent.Model.extend({idAttribute:"documentId"});var collection=Talent.Collection.extend({model:model});var isEscClose=true;this.imgPreviw=new ImgPreviewContentView({collection:new collection(this.collection.toJSON()),index:this.options.index||0,model:new Talent.Model({dialogW:setWH["windowW"],dialogH:setWH["windowH"]})});this.listenTo(this.imgPreviw,"closed",function(){isEscClose=false;this.close();this.dailogView.close();this.trigger("closed")});this.dailogView=new Simplemodal({opacity:0,autoResize:true,minHeight:setWH["windowH"],minWidth:setWH["windowW"],escClose:true,fixed:true,zIndex:1300,overlayClose:false,containerCss:{background:"transparent",border:"none"},closeHTML:"",onClose:function(){if(isEscClose){this.close();this.trigger("closed")}}});if(this.settings.overlay){this.dailogView.render(this.imgPreviw.render().el).appendTo("body");this.imgPreviw.onShow();Talent.$("body").on("click",".simplemodal-overlay",function(event){event.stopPropagation()});Talent.$("body").on("click",".simplemodal-close",function(event){event.stopPropagation()})}else{this.$el.html(this.imgPreviw.render().el);this.imgPreviw.onShow()}},onClose:function(){this.dailogView&&this.dailogView.close();this.imgPreviw&&this.imgPreviw.close()}});var LoadingView=Talent.ItemView.extend({defaults:{y:20},template:Talent._.template('<span class="img-load"></span><span>努力加载中...</span>'),className:"tt_common_loading",initialize:function(options){this.settings=Talent._.extend({},this.defaults,options)},onRender:function(){this.$el.css({"padding-top":this.settings["y"]-32/2})},hide:function(){this.$el.hide()},show:function(){this.$el.show()}});var SearchView=Talent.ItemView.extend({template:JST["search-view/search"],className:"search-form",defaults:{placeholder:""},templateHelpers:function(){return{searchName:(new Date).getTime(),placeholder:this.settings.placeholder}},ui:{searchBody:"[data-name=search-body]",input:"[data-name=input]",searchBtn:"[data-name=search-btn]",cancelBtn:"[data-name=cancel-btn]",placeholder:"[data-name=placeholder]"},events:function(){var events={};events["focus "+this.ui.input]="_inputFocusHandler";events["blur "+this.ui.input]="_inputBlurHandler";events["input "+this.ui.input]="_inputInputHandler";events["keyup "+this.ui.input]="_inputKeyupHandler";events["click "+this.ui.searchBtn]="_searchBtnClickHandler";events["click "+this.ui.cancelBtn]="_cancelBtnClickHandler";events["submit form"]="_searchBtnClickHandler";return events},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);this.isSearch=false},onRender:function(){var self=this;this.ui.input.bind("propertychange",function(event){self._inputInputHandler(event,self)})},_inputFocusHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),val=node.val();this.ui.searchBody.addClass("tu-input-focus");this.ui.cancelBtn.show();this.trigger("focus",val)},_inputBlurHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),val=node.val();if(val==""){this.ui.searchBody.removeClass("tu-input-focus");this.ui.cancelBtn.hide();this.ui.placeholder.show();if(this.isSearch){this.isSearch=false;this.trigger("cancel",val)}}this.trigger("blur")},_inputInputHandler:function(ev,that){ev.stopPropagation();var node=$(ev.currentTarget),val=node.val(),self=ev.type=="propertychange"?that:this;if(val==""){self.ui.placeholder.show()}else{self.ui.placeholder.hide()}this.trigger("input",val)},_inputKeyupHandler:function(ev){ev.stopPropagation();var keyCode=ev.keyCode||ev.which;if(keyCode==8){this._inputInputHandler(ev)}},_searchBtnClickHandler:function(ev){ev.stopPropagation();var val=$.trim(this.ui.input.val());if(val){this.isSearch=true;this.trigger("search",val)}else{this.isSearch=false}return false},_cancelBtnClickHandler:function(ev){ev.stopPropagation();var val=$.trim(this.ui.input.val());if(this.isSearch){this.isSearch=false;this.trigger("cancel",val)}this.render()}});var ClassNewFolderView=Talent.ItemView.extend({defaults:{type:"new",nameLen:100},template:jst["class/class-new"],tagName:function(){if(this.options["type"]=="rename"){return"div"}else{return"li"}},ui:{inputwrap:"div[data-name=file-move-new-input-warp]",input:"div[data-name=file-move-new-input-warp] input",sure:"button[data-name=file-move-new-submit]",cancel:"button[data-name=file-move-new-cancel]",form:"form[data-name=file-move-new-form]",tip:"[data-name=file-move-new-input-tip]",placeholder:"[data-name=file-move-new-placeholder]"},events:function(){var events={};events["focus "+this.ui.input]="_focusHandler";events["blur "+this.ui.input]="_blurHandler";events["input "+this.ui.input]="_keyupHandler";events["click "+this.ui.sure]="_sureHandler";events["click "+this.ui.cancel]="_cancelHandler";events["submit "+this.ui.form]="_sureHandler";if(this.isIE9){events["keyup "+this.ui.input]="_keyupHandler"}return events},templateHelpers:function(){return{type:this.settings["type"]}},initialize:function(){var self=this;this.isIE8=window.navigator.userAgent.toUpperCase().indexOf("MSIE 8.0")!=-1?true:false;this.isIE9=window.navigator.userAgent.toUpperCase().indexOf("MSIE 9.0")!=-1?true:false;this.isFF=window.navigator.userAgent.toUpperCase().indexOf("FIREFOX")!=-1?true:false;this.settings=Talent._.extend({},this.defaults,this.options);this.$el.attr("data-type","new-folder-form");this.$el.off("click");this.$el.on("click",function(event){event.stopPropagation()});this.model.set("isPass",false)},onRender:function(){var self=this;var name=this.model.get("name");if(name&&name!=""){this.ui.input.focus();this.ui.placeholder.hide()}this.ui.input.bind("propertychange",function(event){self._keyupHandler(event,self)});this.ui.input.bind("mousedown.ui-disableSelection selectstart.ui-disableSelection",function(event){event.stopImmediatePropagation()})},focusIn:function(){var val=Talent.$.trim(this.ui.input.val());if(this.isIE8&&val!=""){this.ui.input.trigger("propertychange")}if(val){this.ui.input.val(val)}this.ui.input.trigger("focus")},_focusHandler:function(event){var node=Talent.$(event.currentTarget);if(!this.ui.inputwrap.hasClass("tu-input-error")){this.ui.inputwrap.addClass("tu-input-focus")}},_keyupHandler:function(ev,that){var self=ev.type=="propertychange"?that:this;if(ev.type=="keyup"){if(self.isIE9&&ev.keyCode!=8)return}var node=Talent.$(ev.currentTarget);var val=Talent.$.trim(node.val());var len=this.settings["nameLen"];ev.stopPropagation();var node=$(ev.currentTarget),val=Talent.$.trim(node.val());if(val==""){self.ui.placeholder.show();self.ui.sure.addClass("disabled");self.ui.inputwrap.removeClass("tu-input-focus").addClass("tu-input-error");self.model.set({isPass:false,name:val})}else{self.ui.placeholder.hide();if(val.length>self.settings.nameLen/2){var len=self._totalValLength(val);var cont="已输入 "+len+" 字，最多可输入 "+self.settings.nameLen/2+" 字";if(len>self.settings.nameLen/2){self.ui.tip.html(cont).show();self.model.set({name:val,isPass:false});self.ui.inputwrap.removeClass("tu-input-focus").addClass("tu-input-error");self.ui.sure.addClass("disabled")}else{self.ui.tip.html("").hide();self.ui.inputwrap.removeClass("tu-input-error").addClass("tu-input-focus");self.ui.sure.removeClass("disabled");self.model.set({name:val,isPass:true})}}else{self.model.set({name:val,isPass:true});self.ui.tip.html("").hide();self.ui.inputwrap.removeClass("tu-input-error").addClass("tu-input-focus");self.ui.sure.removeClass("disabled")}}},_totalValLength:function(str){var newLength=0;var newStr="";var chineseRegex=/[^\x00-\xff]/g;var singleChar="";var strLength=str.replace(chineseRegex,"**").length;for(var i=0;i<str.length;i++){singleChar=str.charAt(i).toString();if(singleChar.match(chineseRegex)!=null){newLength+=2}else if(singleChar=="m"||singleChar=="w"){newLength+=2}else{newLength++}}return Math.ceil(newLength/2)},_blurHandler:function(event){var node=Talent.$(event.currentTarget);if(this.model.get("name")==""&&!this.model.get("isPass")){this.ui.inputwrap.addClass("tu-input-error");this.ui.sure.addClass("disabled")}},_sureHandler:function(event){event.stopPropagation();event.preventDefault();var node=Talent.$(event.currentTarget);var name=this.model.get("name"),isPass=this.model.get("isPass");if(isPass){this.trigger("submit",name,node);this.close()}},_cancelHandler:function(event){event.stopPropagation();event.preventDefault();var node=Talent.$(event.currentTarget);this.ui.inputwrap.removeClass("tu-input-focus");this.trigger("cancel");this.close()},onClose:function(){this.$el.off("click")}});var ClassLimitView=Talent.ItemView.extend({defaults:{isShowRange:false},template:jst["class/class-tree-limit"],className:"tu-dropdown class-limit",ui:{scope:"[data-name=limit-scope]",addDropdown:"[data-name=limit-add-dropdown]",allow:"[data-name=allow]",unAllow:"[data-name=unAllow]"},events:{"click li":"_liHandler","mouseup li":"_stopHandler"},templateHelpers:function(){return{isShowRange:this.settings.isShowRange}},initialize:function(){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);this.$el.on("mousedown",function(e){e.stopPropagation()});Talent.$(document).off("mousedown.Class-Limit-View");Talent.$(document).on("mousedown.Class-Limit-View",function(e){self.close();Talent.$(document).off("mousedown.Class-Limit-View")})},onRender:function(){},show:function(node,options){var defaults={topBias:0,leftBias:0};this.render();var options=Talent._.extend({},defaults,options);Context.setPosition(node,this.$el,options)},_stopHandler:function(event){event.stopPropagation()},_liHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),name=node.attr("data-name");if(name=="limit-add"){this.ui.addDropdown.show()}if(name=="limit-scope"){this._getUserData()}if(name=="allow"){this.ui.unAllow.removeClass("active");node.addClass("active");this._requestAdd(name);this.trigger("allowAdd",true)}if(name=="unAllow"){this.ui.allow.removeClass("active");node.addClass("active");this._requestAdd(name);this.trigger("allowAdd",false)}},_getUserData:function(){var self=this;LableCollection.getSeeUserList({lable_id:this.model.get("id")}).done(function(resp){if(self.isClosed)return;var userArray=[];for(var i=0;i<resp.length;i++){var dataItem=resp[i];var UserAvatar=dataItem["Avatar"];dataItem["imgTemplate"]=Talent._.convertImage({className:"",src:UserAvatar.Medium,size:30,shape:"radius",name:dataItem["Name"],bgColor:UserAvatar.Color});dataItem["Id"]=dataItem["UserId"];dataItem["Name"];dataItem["subName"]=dataItem["Name"];dataItem["subEmail"]=dataItem["Email"];dataItem["MidAvatar"]=dataItem["Avatar"]["Medium"];userArray.push(dataItem)}self._bindUserSelect(userArray)})},_bindUserSelect:function(userArray){var self=this;var node=this.ui.scope;this.userSelectorView=new UserSelector({collection:new UserSelectorCollection,addedData:userArray});this.listenTo(this.userSelectorView,"cancel close",function(){this.close()});var options=util.userSelectorConfig({viewType:"muti",listType:"Contact",input:true,muti:true,showTab:true,bias:{left:-600,top:0}});this.userSelectorView.showDialog(options,node);this.userSelectorView.$el.on("mousedown",function(event){event.stopPropagation()});node.on("submit",function(ev,user){ev.stopPropagation();self.close();self._requestScopeUser(user)})},_requestAdd:function(name){this.close();LableCollection.ifAddClassLableData({lable_id:this.model.get("id"),is_allow:name=="allow"?true:false})},_requestScopeUser:function(user){var users=user&&user.data||[];var AddObjectModels=[];for(var i=0;i<users.length;i++){if(users[i].type=="department"){AddObjectModels.push({Email:users[i].name+":"+users[i].id+":dep_members",Name:users[i].name,Id:users[i].id})}else{AddObjectModels.push({Email:users[i].Email,Name:users[i].Name,Id:users[i].Id})}}LableCollection.classPerEnterLableData({LableId:this.model.get("id"),AddObjectModels:AddObjectModels})},onClose:function(){Talent.$(document).off("mousedown.Class-Limit-View")}});var ClassTreeDelteView=Talent.ItemView.extend({template:jst["class/class-tree-delete"],defaults:{deleteChild:false},templateHelpers:function(){return{deleteChild:this.settings.deleteChild}},className:"class-del",initialize:function(options){this.model.set("isDelChildren",false);this.settings=_.extend({},this.defaults,options)},ui:{label:"label"},events:{"click input":"_checkoutHandler"},_checkoutHandler:function(e){if(this.model.get("isDelChildren")){this.ui.label.removeClass("tu-checked");this.model.set("isDelChildren",false)}else{this.ui.label.addClass("tu-checked");this.model.set("isDelChildren",true)}this.trigger("isDelChildren",this.model.get("isDelChildren"))}});var ClassTreeItemView=Talent.CompositeView.extend({template:jst["class/class-tree-item"],tagName:"li",className:"item-tv",initialize:function(options){var self=this;this.userInfo=Context.getUserInfo();this.isDelChildren=false;var children=this.model.get("children")||[];var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"id"})}});this.collection=new mCollection(children);this.options.childModels[this.model.get("id")]=this.model;this.$el.attr("id",this.model.get("id"));this.on("itemview:show",function(view){view.sortable()});this.on("itemview:rebindSort",function(view){self.sortable()});if(this.model.get("IsAllowSetPersonalLable")){this.$el.addClass("disabled")}},ui:{move:"[data-name=move]",moveTop:"[data-name=move-top]"},events:function(){var events={};events["click "+this.ui.moveTop]="_moveTopHandler";return events},appendHtml:function(compositeView,itemView,index){compositeView.$el.find("ul:first").append(itemView.el)},templateHelpers:function(){var opIsEdit=this.options.isEdit;var isEdit=true;var TaskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;return{isEdit:opIsEdit,isMove:this.options.isMove,viewType:this.options.viewType,dataSourceObjType:this.options.dataSourceObjType,TaskLabel:TaskLabel}},modelEvents:{"change:changeTime":"_resetCollection","change:IsAllowSetPersonalLable":"_allowHandler"},onRender:function(){this.$el.attr({id:this.model.get("id"),"data-end":this.model.get("isEnd")});if(this.model.get("isOpen")){this.$el.addClass("unfold")}else{this.$el.removeClass("unfold")}this._activeHander();this.model.set("view",this);if(this.model.get("IsAllowSetPersonalLable")){this.$el.addClass("disabled")}else{this.$el.removeClass("disabled")}},itemViewOptions:function(){return{isEdit:this.options["isEdit"],childModels:this.options.childModels,isMove:this.options.isMove,id:this.options.id,viewType:this.options.viewType,dataSourceObjType:this.options.dataSourceObjType}},_allowHandler:function(){this.render();this.trigger("rebindSort")},_resetCollection:function(){var children=this.model.get("children")||[];this.collection.reset(children);this.render();this.trigger("rebindSort");this.sortable()},_activeHander:function(){if(this.model.get("isActive")){this.$el.addClass("active")}else{this.$el.removeClass("active")}},sortable:function(){if(!this.options.isMove)return;var self=this;ulBox=this.$el.find("ul:first");ulBox.sortable({axis:"y",handle:ulBox.children().find("[data-name=move]"),cursor:"move",revert:false,scroll:true,start:function(event,ui){event.stopPropagation()},stop:function(event,ui){var id=ui.item.attr("id"),model=self.options.childModels[id],pathId=model.get("pathId").split("/"),parentId=pathId[_.indexOf(pathId,id)-1],parentModel=self.options.childModels[parentId],parentChildren=parentModel.get("children")||[];if(parentChildren.length<2)return;for(var i=0;i<parentChildren.length;i++){if(parentChildren[i].id==id){parentChildren.splice(i,1);break}}var sortData=$(this).sortable("toArray");var idx=_.indexOf(sortData,id);var len=sortData.length;parentChildren.splice(idx,0,model.toJSON());parentModel.set({children:parentChildren});Talent.app.vent.trigger("Class-Tree-Collection-View:"+self.id+":sort",{referenceId:idx==len-1?sortData[len-2]:sortData[idx+1],positionType:idx==len-1?1:2,id:id,isMoveTop:false},self)}}).disableSelection()},_moveTopHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),id=node.attr("id");node.infotip("hide");var parentId=this.model.get("parent_id"),parentModel=this.options.childModels[parentId],parentChildren=parentModel.get("children")||[],idx=0;if(parentChildren.length>1){for(var i=0;i<parentChildren.length;i++){if(parentChildren[i].id==id){parentChildren.splice(i,1);break}}parentChildren.unshift(this.model.toJSON());parentModel.set({children:parentChildren,changeTime:(new Date).getTime()});Talent.app.vent.trigger("Class-Tree-Collection-View:"+this.id+":sort",{referenceId:parentChildren[1].id,positionType:2,id:id,isMoveTop:true},this)}},onClose:function(){}});var ClassTreeCollectionView=Talent.CollectionView.extend({defaults:{isEdit:false,isActive:1,isMove:true,container:null,dataSourceObjType:1},itemView:ClassTreeItemView,tagName:"ul",className:"class-tree",ui:{infotipNode:"[data-name=infotip]"},events:function(){var events={};events["click li div[data-name=title]"]="_checkHandler";events["click li span[data-name=toggle]"]="_toggleHandler";events["click li a[data-name=add-category]"]="_addCategoryHandle";events["click li a[data-name=deleted]"]="_deleteHandler";events["click li a[data-name=edit]"]="_editHandler";events["click li a[data-name=limit]"]="_limitHandler";events["mouseenter "+this.ui.infotipNode]="_showTispy";events["mouseleave "+this.ui.infotipNode]="_hideTispy";return events},initialize:function(options){var self=this;this.options=options;this.settings=Talent._.extend({},this.defaults,this.options);this.activeFolder=this.$el.find("li:first");this.container=this.settings.container||this.$el;this.isEdit=this.settings.isEdit;this.$el.css({position:"relative"});if(this.isEdit){this.$el.addClass("class-edit")}this.id=(new Date).getTime();this.index=0;this.childModels={};this.userInfo=Context.getUserInfo();this.on("itemview:show",function(view){view.sortable()});this.on("itemview:rebindSort",function(view){view.sortable()});Talent.app.vent.on("Class-Tree-Collection-View:"+this.id+":sort",function(options,view){self.trigger("sort",options);var viewId=view.model.get("id");if(self.childModels[viewId]){self.activeModel=self.childModels[viewId]}})},onRender:function(){},onShow:function(){var isEdit=this.settings["isEdit"];var li=this.$el.find("li:first");if(this.settings.isMove){this.$el.addClass("class-move")}if(!this.collection.length)return;if(this.settings.isActive==1){li.children("div[data-name=title]").trigger("click")}else{}},itemViewOptions:function(){return{isEdit:this.settings["isEdit"],childrenModel:this.childrenModel,childModels:this.childModels,isMove:this.settings.isMove,id:this.id,viewType:this.settings.viewType,dataSourceObjType:this.settings.dataSourceObjType}},_addCategoryHandle:function(event){this._checkHandler(event);this.trigger("addCategory",event)},_limitHandler:function(event){var node=Talent.$(event.currentTarget),model=this._getChildModelByNode(node);this.classLimitView&&this.classLimitView.close();this.classLimitView=new ClassLimitView({model:new Talent.Model({id:model.get("id"),IsAllowSetPersonalLable:model.get("IsAllowSetPersonalLable")}),isShowRange:model.get("parent_id")==="0"?true:false});this.listenTo(this.classLimitView,"allowAdd",function(options){model.set("IsAllowSetPersonalLable",options)});this.$el.append(this.classLimitView.render().$el);this.classLimitView.show(node,{container:this.$el})},_showTispy:function(event){var self=this;var node=Talent.$(event.currentTarget);var tipText=node.attr("data-tip");var tipView=new Infotip;tipView.bindNode(node,{container:self.$el,body:tipText});tipView.show()},_hideTispy:function(event){var node=Talent.$(event.currentTarget)},_toggleHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var li=node.closest("li"),model=this._getChildModelByNode(node),id=model.get("id");if(node.hasClass("tu-icon-open")){model.set("isOpen",true)}else{model.set("isOpen",false)}this._changeFormatData(model,"edit")},_checkHandler:function(event){var self=this;event.stopPropagation();var node=Talent.$(event.currentTarget);var li=node.closest("li");var model=this._getChildModelByNode(node),id=model.get("id");if(id==0&&!this.isEdit)return;model.set("isActive",true);if(this.activeModel){this.activeModel.set("isActive",false);this.activeModel.get("view").$el.removeClass("active");this._changeFormatData(this.activeModel,"edit",false)}var path=model.get("pathId"),aPath=this.activeModel&&this.activeModel.get("pathId")||null;li.addClass("active");this._changeFormatData(model,"edit",false);self.activeModel=model;this.trigger("checked",model.toJSON())},_getChildModelByNode:function(node){var self=this;var id=node.attr("id");var model=this.childModels[id];return model},_changeFormatData:function(model,type,isUpate){var id=model.get("id"),isUpate=isUpate==false?false:true;var pathId=model.get("pathId").split("/"),parentId=pathId[pathId.length==1?0:pathId.length-2],parentModel=this.childModels[parentId]||model;parentChildren=parentModel.get("children")||[];if(type=="add"){parentModel.set("isEnd",false);parentChildren.push(model.toJSON())}for(var i=0;i<parentChildren.length;i++){if(id==parentChildren[i].id){if(type=="deleted"){parentChildren.splice(i,1);if(!this.isDelChildren){var children=model.get("children")||[];if(children.length){parentChildren=parentChildren.concat(children)}}break}else if(type=="edit"){parentChildren.splice(i,1,model.toJSON());break}}}if(isUpate){parentModel.set({children:parentChildren,changeTime:(new Date).getTime()})}else{parentModel.set({children:parentChildren})}if(this.activeModel){activeModelId=this.activeModel.get("id");this.activeModel=this.childModels[activeModelId]}},_deleteHandler:function(event){var self=this;event.stopPropagation();var node=Talent.$(event.currentTarget);var li=Talent.$(event.currentTarget).closest("li"),model=this._getChildModelByNode(node);id=model.get("id");childData=this.childModels[id].get("children"),classTreeDelteOpt={deleteChild:false},pathId=model.get("pathId").split("/"),parentId=pathId[pathId.length==1?0:pathId.length-2],
parentModel=this.childModels[parentId],parentModelView=parentModel.get("view");this.infoTip&&this.infoTip.close();if(childData&&childData.length>0){classTreeDelteOpt.deleteChild=true}var classTreeDelteView=new ClassTreeDelteView(classTreeDelteOpt);this.listenTo(classTreeDelteView,"isDelChildren",function(data){this.isDelChildren=data});this.infoTip=new Infotip;this.infoTip.bindNode(node,{placement:"top",align:"right",container:this.container,type:"confirm",trigger:"manual",body:function(){return classTreeDelteView.render().$el},okHide:function(){if(model.get("isActive")){model.set("isActive",false);model.get("view").$el.removeClass("active");self.activeModel=parentModel;parentModel.set("isActive",true);parentModelView.$el.addClass("active")}li.remove();self.infoTip&&self.infoTip.close();delete self.childModels[model.get("id")];self._changeFormatData(model,"deleted");self.trigger("deleted",Talent._.extend(model.toJSON(),{isDelChildren:self.isDelChildren}))}});this.infoTip.show()},_editHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this._rendRenameView(node)},_rendRenameView:function(node){var model=this._getChildModelByNode(node),li=node.closest("li"),nameArea=li.find("[data-name=title-name]:first"),topNode=li.find("[data-name=move-top]"),delNode=li.find("[data-name=deleted]"),limit=li.find("[data-name=limit]");nameArea.css("overflow","visible");topNode.hide();delNode.hide();limit.hide();node.hide();this.renameView&&this.renameView.close();this.renameView=new ClassNewFolderView({type:"rename",model:new Talent.Model({name:model.get("name")})});this.listenTo(this.renameView,"submit",function(name){nameArea.css("overflow","hidden");model.set("name",name);this._changeFormatData(model,"edit");topNode.show();delNode.show();limit.show();node.show();this.trigger("rename",{name:name,id:model.get("id")})},this);this.listenTo(this.renameView,"close",function(name){nameArea.css("overflow","hidden");nameArea.html(model.get("name"));topNode.show();delNode.show();node.show()},this);nameArea.html(this.renameView.render().$el);this.renameView.focusIn()},rendNewNameView:function(){var id=this.activeModel.get("id");if(!this.activeModel.get("IsAllowSetPersonalLable")){}var self=this;var activeLi=this.$el.find("li#"+this.activeModel.get("id"));var activeLi_ul=activeLi.find("ul:first");activeLi.addClass("unfold");if(!this.activeModel.get("isOpen")&&!this.activeModel.get("isEnd")){this.activeModel.set("isOpen",true);activeLi.find("[data-name=toggle]:first").removeClass("tu-icon-open").addClass("tu-icon-pack-up")}this.newView&&this.newView.close();this.newView=new ClassNewFolderView({type:"new",model:new Talent.Model({name:""})});this.listenTo(this.newView,"submit",function(name){this.trigger("add",{name:name,pId:this.activeModel.get("id")});this.activeModel.set("isOpen",true)},this);activeLi_ul.append(this.newView.render().$el);this.newView.focusIn()},addNewItemClasss:function(model){var options=this.itemViewOptions();model.set({children:[],isEnd:true,isOpen:false});this.childModels[model.get("id")]=model;this._changeFormatData(model,"add");var activeLi=this.$el.find("#"+this.activeModel.get("id"));var infoTipView=new Infotip;infoTipView.bindNode(activeLi.find("[data-name=title-name]"),{container:this.settings.container,body:"创建成功",type:"remind",trigger:"manual"});infoTipView.show()},onClose:function(){}});var ClassSearchResultItemView=Talent.ItemView.extend({template:Talent._.template("<%=name%>"),tagName:"li",className:"tu-menuitem",initialize:function(){this.$el.attr("id",this.model.get("id"))}});var ClassSearchResultEmptyView=Talent.ItemView.extend({template:Talent._.template("搜索不到结果"),tagName:"li",className:"tu-menuitem .empty",initialize:function(){}});var ClassSearchResultView=Talent.CompositeView.extend({itemView:ClassSearchResultItemView,itemViewContainer:"ul",template:Talent._.template('<ul class="tu-dropdown-menu"/>'),className:"klass-search-result",className:"tu-dropdown",emptyView:ClassSearchResultEmptyView,events:function(){var events={};events["click li"]="_liHandler";return events},initialize:function(){this.collection.model=Talent.Model.extend({idAttribute:"id"})},_liHandler:function(event){var node=Talent.$(event.currentTarget);var id=node.attr("id");if(!id)return;this.trigger("checked",this.collection.get(id).toJSON());this.close()}});var ClassView=Talent.Layout.extend({defaults:{isEdit:true,viewType:"single",dataSourceType:1,container:null,isMove:false},template:jst["class/class"],className:"tt_class_tree",ui:{},regions:{tree:"div[data-name=tree]"},events:function(){var events={};events["click "+this.ui.newFolder]="_newFolderHandler";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);this.addAjax=false;delete this.settings.collection},onRender:function(){var self=this;this._renderTreeView()},creatNewClass:function(event){this.emptyView&&this.emptyView.close();this.treeView.rendNewNameView()},setItemActive:function(options){var self=this;var id=options.id;var activeModel=this.treeView.activeModel;var childModels=this.treeView.childModels,model=childModels[id];if(!model){return}var off=model.get("view").$el.position();var pathId=model.get("pathId").split("/");model.set({isActive:true});var a=childModels[pathId[0]].toJSON();var i=0;a.isOpen=true;dId(a);function dId(a){var children=a.children;++i;var iPathId=pathId[i];if(children){for(var j=0;j<children.length;j++){var item=children[j];if(activeModel&&item.id==activeModel.get("id")){item.isActive=false}if(item.id==id){item.isActive=true}if(item.id==iPathId&&i!==pathId.length-1){item.isOpen=true;dId(item)}}}}this.treeView.collection.reset([a]);_.each(this.treeView.childModels,function(item){if(item.get("isActive")){self.treeView.activeModel=item}});this.trigger("checked",options)},_renderTreeView:function(){var self=this;var data=this.settings.data;var TreeModel=Backbone.Model.extend({model:Talent.Model.extend({idAttribute:"id"})});var TreeNodeCollection=Talent.Collection.extend({model:TreeModel});var collec=new TreeNodeCollection(data);this.treeView=new ClassTreeCollectionView({collection:new TreeNodeCollection(data),container:this.settings.container,isEdit:this.settings["isEdit"],isActive:this.settings.viewType=="special"||this.settings.viewType=="shangxin"?1:2,isMove:this.settings.isMove,viewType:this.settings.viewType,dataSourceObjType:this.settings.dataSourceObjType});this.activeFolder=this.treeView.$el;this.listenTo(this.treeView,"addCategory",function(event){this.trigger("addCategory",event)});this.listenTo(this.treeView,"deleted",function(options){this._requestDelete(options,this.treeView)});this.listenTo(this.treeView,"rename",function(options){this._requestReName(options)});this.listenTo(this.treeView,"add",function(options){this._requestAdd(options)});this.listenTo(this.treeView,"sort",function(options){this._requestSort(options)});this.listenTo(this.treeView,"checked",function(data){if(data.id=="0")return;this.trigger("checked",{id:data["id"],name:data["name"],pId:data["parent_id"],path:data["path"],pathId:data["pathId"],type:17,isAllowSetPersonalLable:data["IsAllowSetPersonalLable"]})},this);this.tree&&this.tree.show(this.treeView)},_renderEmpytView:function(){this.emptyView=new EmptyView({emptyContext:"点击 添加类别 添加分类"});this.$el.append(this.emptyView.render().$el)},_requestSort:function(options){var dataSourceObjType=this.settings.dataSourceObjType,ownerObjId=Context.getUserInfo().Id,self=this,pModel=this.treeView.childModels[options.pId];if(dataSourceObjType==2){ownerObjId=Context.getGlobal("tenantInfo").Id}var self=this;LableCollection.sortLableData({ownerObjType:dataSourceObjType,ownerObjId:ownerObjId,referenceObjId:options.referenceId,movingObjId:options.id,positionType:options.positionType}).done(function(resp){if(self.isClosed)return;self.trigger("delete",options.id)}).fail(function(msg){})},_requestDelete:function(options,view){var self=this;LableCollection.deleteLableData({lable_id:options.id,type:options.isDelChildren?1:0}).done(function(resp){if(self.isClosed)return;self.trigger("delete",options.id,view)}).fail(function(msg){})},_requestReName:function(options){LableCollection.putRenameLableData({lable_id:options.id,name:options.name}).done(function(){})},_requestAdd:function(options){var self=this;var dataSourceObjType=this.settings.dataSourceObjType,objId=Context.getUserInfo().Id,self=this,pModel=this.treeView.childModels[options.pId];if(dataSourceObjType==2){objId=Context.getGlobal("tenantInfo").Id}LableCollection.postAddLableData({obj_id:objId,obj_type:dataSourceObjType,name:_.escape(options.name),parent_id:options.pId}).done(function(resp){if(self.isClosed)return;if(!resp)return;resp["isEnd"]=true;resp["isOpen"]=false;resp["pathId"]=pModel.get("pathId")+"/"+resp.id;resp["parent_id"]=pModel.get("id");self.treeView.addNewItemClasss(new Talent.Model(resp));self.trigger("edit")})},onClose:function(){}});var WorkListItemView=Talent.ItemView.extend({template:Talent._.template('<div class="title_tv tu-clearfix"><div class="left_tv"><%if(tabType==4){%><span class="icon_tv sys-icon-xiangmu<%}else{%>sys-icon-mubiao<%}%>"></span></div><div class="text_tv"><%=WorkName%></span></div>'),tagName:"li",className:"item-tv",onRender:function(){this.$el.attr("id",this.model.get("WorkId"))}});var WorkListView=Talent.CompositeView.extend({defaults:{tabType:4,isDefaultChecked:true},itemView:WorkListItemView,itemViewContainer:"ul",template:jst["class/work-list"],className:"tt_klass_work",events:{"click li":"_chekcoutItemHandler","click div[data-name=work-title]":"_toggleHandler"},ui:{workList:"ul[data-name=work-list]"},templateHelpers:function(){return{isSearch:this.settings.isSearch}},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);this.$el.on("click",function(event){event.stopPropagation()})},onRender:function(){if(this.settings["isDefaultChecked"]){this.$el.find("li:first").addClass("active")}},onBeforeItemAdded:function(view){view.model.set("tabType",this.settings.tabType)},_toggleHandler:function(event){var node=Talent.$(event.currentTarget);var ul=node.next("ul");var isHide=ul.is(":hidden");this.ui.workList.hide();if(isHide){node.find("span[data-name=toggle]").removeClass("tu-icon-open").addClass("tu-icon-pack-up");ul.show()}else{node.find("span[data-name=toggle]").removeClass("tu-icon-pack-up").addClass("tu-icon-open ");ul.hide()}},_chekcoutItemHandler:function(event){var node=Talent.$(event.currentTarget);var id=node.attr("id");var model=this.collection.get(Number(id));this.$el.find("li").removeClass("active");node.addClass("active");this.trigger("checked",{id:id,name:model.get("WorkName")})}});var WorkView=Talent.Layout.extend({defaults:{tabType:4,joinCollection:null,isSearch:false},template:Talent._.template('<div data-name="my-create"></div><div data-name="my-join"></div>'),className:"tt_class_tree",regions:{myCreateArea:"[data-name=my-create]",myJoinArea:"[data-name=my-join]"},events:function(){var events={};return events},initialize:function(options){this.i18n=Context.getI18n();this.settings=Talent._.extend({},this.defaults,this.options);this.tabType=this.settings.tabType;this.joinCollection=options.joinCollection},onShow:function(){this._rendWorkListView(this.myCreateArea,this.collection,"create");this._rendWorkListView(this.myJoinArea,this.joinCollection,"join");if(this.tabType==402){this.myJoinArea.$el.hide()}if(this.settings.isSearch){this.$el.addClass("search")}},_rendWorkListView:function(box,collection,type){var self=this;var title="我负责的";var checked=true;if(type=="join"){title="我参与的"}if(!this.collection.length&&type=="create"){checked=false}if(this.collection.length&&type=="join"){checked=false}var workListView=new WorkListView({collection:collection,model:new Talent.Model({title:title,tabType:this.tabType}),isDefaultChecked:checked,isSearch:this.settings.isSearch});this.listenTo(workListView,"checked",function(options){this.trigger("checked",options)},this);box.show(workListView)}});var ClassComponentEmptyView=Talent.ItemView.extend({defaults:{type:17,content:""},className:"result-empty",template:Talent._.template("<%if(type==17){%>公司尚未创建企业分类，请联系管理员设置"+"<%}else if(type==4){%>请在项目功能下创建项目"+"<%}else if(type == 402){%>请在目标功能下创建目标"+"<%}else if(type == 0){%><%=content%><%}%>"),templateHelpers:function(){var TaskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;return{type:this.options.type,content:this.options.content,TaskLabel:TaskLabel}}});var ClassComponentView=Talent.Layout.extend({template:jst["class/class-component"],className:"class-dialog",regions:{classArea:"div[data-name=klass-content]",resultArea:"[data-name=result-area]",searchArea:"[data-name=klass-search]"},defaults:{tab:["class","work"],viewType:"single",isEdit:true,resultData:null,zIndex:1,isShowSearch:true,dataSourceObjType:1,dataSourceType:0,isMove:false,tabData:[{name:"分类",tabType:"17",type:"class"},{name:"项目",tabType:"4",type:"work"}],isShowSetting:true},modelEvents:{"change:tabType":"_typeChange"},_typeChange:function(){var tabType=this.model.get("tabType");this.tajax_klass=false;this.tajax_work=false;this.tajax_target=false;this._renderLoadView();if(this.viewType=="shangxin"){this._requestClassData();return}this._showButtonNew();this._renderSearchView();this.ui.gotoEdit.hide();this.isSearch=false;if(tabType==17){this.ui.gotoEdit.show();this._requestClassData()}else if(tabType==4){this._requestWorkData(tabType)}else if(tabType==402){this._requestWorkData(tabType)}else if(tabType==1025){this._requestWorkData(tabType)}},templateHelpers:function(){var url="//"+location.host+location.pathname+"#set?page_id=class";var TaskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;return{i18n:this.i18n,tabData:this.settings.tabData,viewType:this.viewType,isShowSearch:this.settings.isShowSearch,setUrl:url,isShowSetting:this.settings.isShowSetting,TaskLabel:TaskLabel}},ui:{klassTabLi:"ul[data-name=klass-tab] li",klassTab:"ul[data-name=klass-tab]",gotoEdit:"a[data-name=goto-edit]",buttonNew:"button[data-name=button-add]",buttonSubmit:"button[data-name=button-sure]",buttonCancel:"button[data-name=button-cancel]",buttonReset:"[data-name=button-reset]",searchArea:"[data-name=klass-search]",classArea:"[data-name=klass-content]"},events:function(){var events={};events["click "+this.ui.buttonReset]="_resetHandler";events["click "+this.ui.buttonCancel]="_canceltHandler";events["click "+this.ui.buttonSubmit]="_submitHandler";events["click "+this.ui.buttonNew]="_newHandler";events["click "+this.ui.klassTabLi]="_clickTabHandler";return events},initialize:function(options){var self=this;var TaskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;var tabData;if(TaskLabel){tabData={tabData:[{name:"分类",tabType:"17",type:"class"},{name:"项目",tabType:"4",type:"work"}]}}else{tabData={tabData:[{name:"项目",tabType:"4",type:"work"}]}}this.settings=Talent._.extend({},this.defaults,tabData,options);this.viewType=this.settings.viewType;if(this.viewType=="shangxin"){this.settings.isShowSearch=false;this.settings.isEdit=false}this.i18n=Context.getI18n();this.tajax_klass=false;this.tajax_work=false;this.tajax_target=false;this.init=true;this.userInfo=Context.getUserInfo();this.isSearch=false;this.model.set({id:0,name:"",tabType:this.settings.tabData[0].tabType});var mCol=Talent.Collection.extend({model:Talent.Model.extend({idAttribute:"WorkId"})});this.workCreatCollection=new mCol;this.workJoinCollection=new mCol;this.targetCreatCollection=new mCol;this.mettingCreatCollection=new mCol;this.resultCollection=new Talent.Collection;if(this.settings.resultData&&this.settings.resultData.length){this.resultCollection.reset(this.settings.resultData)}if(this.viewType!=="special"){this.$el.on("mousedown",function(event){event.stopPropagation()});Talent.$(document).on("mousedown.kclass"+this.cid,function(){self.trigger("cancel");if(self.viewType!=="special"){self.close()}});this.$el.on("click.kclass"+this.cid,function(){event.stopPropagation()})}this.targetJoinCollection=new Talent.Collection;this.mettingJoinCollection=new Talent.Collection;this._isOpenApp()},_isOpenApp:function(){if(Context.getAppHead({AppId:"402"})){this.settings.tab=this.settings.tab.concat("target");this.settings.tabData=this.settings.tabData.concat({name:"目标",tabType:"402",type:"target"})}if(Context.getAppHead({AppId:"1025"})){this.settings.tab=this.settings.tab.concat("meetting");this.settings.tabData=this.settings.tabData.concat({name:"会议",tabType:"1025",type:"meetting"})}},onRender:function(){this._initCustom();var tabType=this.model.get("tabType")||this.settings.tabData[0].tabType;this._renderLoadView();this._showButtonNew();this._renderSearchView();if(this.viewType=="shangxin"){this._requestClassData();return}if(tabType==17){this._requestClassData()}else{this._requestWorkData(tabType)}},onClose:function(){this.model.set({tabType:this.settings.tabData[0].tabType},{silent:true});Talent.$(document).off("mousedown.kclass"+this.cid);this.$el.off("click.kclass"+this.cid)},show:function(node,options){if(this.viewType!=="special"){Context.setPosition(node,this.$el,options)}this.$el.show()},_showButtonNew:function(){if(this.model.get("tabType")==17&&this.viewType!=="multi"){this.ui.buttonNew.show()}else{this.ui.buttonNew.hide()}},_canceltHandler:function(){this.resultCollection.reset([]);this.close();this.trigger("cancel")},_resetHandler:function(){this.trigger("reset");this.close()},_submitHandler:function(options){var tabType=this.model.get("tabType");var data=this.resultCollection.toJSON();if(this.viewType=="multi"){data=this.resultCollection.toJSON();this.ui.buttonNew.hide()}else{data=data[0]}this.trigger("submit",data);this.close()},_renderResultView:function(){var classResultCompositeView=new ClassResultCompositeView({collection:this.resultCollection});this.resultArea.show(classResultCompositeView)},_renderLoadView:function(){this.loadingView=new LoadingView;this.classArea.show(this.loadingView)},_renderEmptyView:function(content){if(this.viewType=="special"){var dataSourceObjType=this.settings.dataSourceObjType;var cont="赶快添加，管理企业工作吧";if(dataSourceObjType==1){cont="赶快添加，管理个人工作吧"}this.emptyView&&this.emptyView.close();this.emptyView=new EmptyView({emptyContext:cont});this.ui.classArea.append(this.emptyView.render().$el);return}this.classComponentEmptyView&&this.classComponentEmptyView.close();this.classComponentEmptyView=new ClassComponentEmptyView({type:content?0:this.model.get("tabType"),content:content});this.ui.classArea.append(this.classComponentEmptyView.render().$el)},_renderSearchView:function(){var tabType=this.model.get("tabType");if(tabType==402){this.searchArea&&this.searchArea.close();return}this.searchView=new SearchView({placeholder:"输入关键字"});this.listenTo(this.searchView,"search",function(val){this.isSearch=true;if(tabType==17){this._requestSearchClassData(val)}else{this.workJoinCollection.reset([]);this._requestWorkData(tabType,0,{keyWord:val},true)}},this);this.listenTo(this.searchView,"cancel",function(){this.isSearch=false;if(tabType==17){this.classSearchResultView&&this.classSearchResultView.close();this.classSearchResultView=null}else{this._requestWorkData(tabType)}},this);this.searchArea.show(this.searchView)},_requestSearchClassData:function(val){var self=this;LableCollection.searchClassData({user_id:this.userInfo["Id"],filter:val}).done(function(resp){if(self.isClosed)return;if(self.model.get("tabType")==17){self._renderClassSearchResultView(resp)}}).fail(function(msg){})},_renderClassSearchResultView:function(data){var data=data.lables||[];this.classSearchResultView&&this.classSearchResultView.close();this.classSearchResultView=new ClassSearchResultView({collection:new Talent.Collection(data)});this.listenTo(this.classSearchResultView,"checked",function(options){this.resultCollection.push(options);this.classView&&this.classView.setItemActive(options)});this.ui.searchArea.append(this.classSearchResultView.render().$el)},_initCustom:function(){var tabType=this.model.get("tabType")||this.settings.tabData[0].tabType;this.ui.klassTabLi.removeClass("active");this.ui.klassTab.find("li[data-type="+tabType+"]").addClass("active");if(this.viewType=="multi"){this.$el.addClass("multi");this.settings.isEdit=false;this.settings.isMove=false;this._renderResultView();this.init=false}if(this.viewType=="single"){this.settings.isMove=false}this.$el.addClass(this.viewType);if(this.settings["zIndex"]){this.$el.css({"z-index":100100,left:0})}},_clickTabHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var tabType=node.attr("data-type");this.ui.klassTabLi.removeClass("active");node.addClass("active");this.model.set("tabType",Number(tabType))},_requestClassData:function(){var self=this;if(this.tajax_klass)return;this.tajax_klass=true;var dataSourceObjType=this.settings.dataSourceObjType,objId=this.userInfo["Id"];if(dataSourceObjType==2){objId=Context.getGlobal("tenantInfo").Id}LableCollection.getLableData({obj_id:objId,obj_type:dataSourceObjType,type:this.settings.dataSourceType}).done(function(resp){if(self.isClosed)return;var data=resp&&resp["lables"]||[];self.tajax_klass=false;var emptyContent;if(self.viewType=="shangxin"){if(data.length){var children=data[0].children,type=self.model.get("tabType"),emptyContent="暂无数据";var newChildren=Talent._.where(children,{id:type.toString()})||[];if(newChildren.length){newChildren[0].isOpen=true}data=newChildren.length&&newChildren[0].children||[];resp.total=data.length}self._renderClassView(data)}else{self._renderClassView(data)}if(resp&&resp.total>1){self.emptyView&&self.emptyView.close()}else{self._renderEmptyView(emptyContent)}}).fail(function(){self.tajax_klass=false})},_renderClassView:function(data){var self=this;this.classView&&this.classView.close();var showButtonAddFlag=this.settings["multi"]==true?false:true;this.classView=new ClassView({data:data,isEdit:this.settings.isEdit,viewType:this.viewType,dataSourceObjType:this.settings.dataSourceObjType,isMove:this.settings.isMove,container:this.$el});this.listenTo(this.classView,"addCategory",function(event){this._newHandler(event)});this.listenTo(this.classView,"checked",function(options){this.activeData=options;if(this.viewType=="special")return;if(this.viewType=="multi"){this.resultCollection.push({id:options["id"],name:options["name"],pId:options["pId"],path:options["path"],pathId:options["pathId"],tabType:17,isAllowSetPersonalLable:options["isAllowSetPersonalLable"]})}else{this.resultCollection.reset({id:options["id"],name:options["name"],pId:options["pId"],path:options["path"],pathId:options["pathId"],tabType:17,isAllowSetPersonalLable:options["isAllowSetPersonalLable"]})}},this);this.listenTo(this.classView,"edit",function(){this.emptyView&&this.emptyView.close()});this.listenTo(this.classView,"delete",function(id,view){if(view&&view.childModels){var len=0;_.each(view.childModels,function(value,key){len++});if(len==1)self._renderEmptyView()}});this.classArea.show(this.classView)},_newHandler:function(event){var node=Talent.$(event.currentTarget);var isAllowSetPersonalLable=this.activeData&&!this.activeData.isAllowSetPersonalLable?this.activeData.isAllowSetPersonalLable:true;if(!isAllowSetPersonalLable&&this.settings.dataSourceObjType==1){var infoTipView=new Infotip;infoTipView.bindNode(node,{container:this.$el,body:"该分类不允许添加分类",type:"remind",trigger:"manual",ico:"warn"});infoTipView.show()}else{this.classView.creatNewClass()}},_requestWorkData:function(type,relation,options){var self=this,app_id=1,app_type=1,options=options||{};var defaults={app_id:"",app_type:"",to_user_id:this.userInfo.Id,type:1,keyWord:""};options=Talent._.extend({},defaults,options);if(type==4){options.app_id=1;options.app_type=1;this.tajax_work=true}if(type==402){options.app_id=402;options.app_type=402;if(this.tajax_target)return;this.tajax_target=true}if(type==1025){options.app_id=1025;options.app_type=1025;if(this.tajax_target)return;this.tajax_target=true}ProjectCollection.getProject(options).done(function(resp){if(self.isClosed)return;var data=resp;self.loadingView&&self.loadingView.close();if(type==4){self.tajax_work=false;self.workCreatCollection.reset(data.CreateWorks||[]);if(self.isSearch){self.workCreatCollection.reset(data.SearchWorks||[]);if(self.workCreatCollection.length){self._renderWorkView()}else{self._renderEmptyView("暂无搜索结果")}}else{self.workCreatCollection.reset(data.CreateWorks||[]);self.workJoinCollection.reset(data.JoinWorks||[]);if(self.workCreatCollection.length||self.workJoinCollection.length){self._renderWorkView()}else{self._renderEmptyView()}}}else{self.tajax_target=false;self.targetCreatCollection.reset(data.CreateWorks||[]);if(self.targetCreatCollection.length){self._renderTargetView()}else{self._renderEmptyView()}}}).fail(function(){if(type==4){self.tajax_work=false}else{self.tajax_target=false}})},_clickCancelHandler:function(){this.trigger("cancel");this.close()},_renderWorkView:function(){var self=this;if(this.viewType=="single"){if(this.workCreatCollection.length){}}var workView=new WorkView({collection:this.workCreatCollection,joinCollection:this.workJoinCollection,tabType:4,isSearch:this.isSearch});this.listenTo(workView,"checked",function(options){this.activeData=options;if(this.viewType=="multi"){this.resultCollection.push({id:options["id"],name:options["name"],pId:"0",path:options["name"],tabType:4,pathId:"0"})}else{this.resultCollection.reset({id:options["id"],name:options["name"],pId:"0",path:options["name"],tabType:4,pathId:"0"})}});this.classArea.show(workView)},_renderTargetView:function(){var self=this;var targetView=new WorkView({collection:this.targetCreatCollection,joinCollection:this.targetJoinCollection,tabType:402});this.listenTo(targetView,"checked",function(options){this.activeData=options;if(this.viewType=="multi"){this.resultCollection.push({id:options["id"],name:options["name"],pId:"0",path:options["name"],tabType:4,pathId:"0"})}else{this.resultCollection.reset({id:options["id"],name:options["name"],pId:"0",path:options["name"],tabType:4,pathId:"0"})}},this);this.classArea.show(targetView)}});var ClassResultEmptyView=Talent.ItemView.extend({template:Talent._.template("请从左侧点击选择"),className:"result-empty"});var ClassResultItemView=Talent.ItemView.extend({tagName:"li",template:jst["class/result-item"]});var ClassResultCompositeView=Talent.CompositeView.extend({className:"result-area",template:jst["class/result"],templateHelpers:function(){return{showResetBtn:this.collection.length>0?true:false}},itemView:ClassResultItemView,itemViewContainer:"[data-name=result-list]",emptyView:ClassResultEmptyView,ui:{delItem:"[data-name=deleted]",total:"[data-name=result-number]",buttonReset:"[data-name=button-reset]"},collectionEvents:{add:"_collectionEvent",reset:"_collectionEvent",remove:"_collectionEvent"},events:function(){var events={};events["click "+this.ui.delItem]="_deleteItem";return events},initialize:function(){this.collection.model=Talent.Model.extend({idAttribute:"id"});this.model.set("total",this.collection.length)},onRender:function(){var self=this;if(this.collection.length>0){this.ui.buttonReset.show()}},_collectionEvent:function(){var total=this.collection.length;this.model.set("total",total);this.ui.total.html(total);if(this.collection.length>0){this.ui.buttonReset.show()}else{this.ui.buttonReset.hide()}},_deleteItem:function(e){var node=Talent.$(e.currentTarget);this.collection.remove(this.collection.remove(node.attr("id")))}});var OperationStatusView=Talent.ItemView.extend({template:jst["operation-status/operation-status"],className:"tu-dropdown",events:function(){var events={};events["click li"]="changeStatusFun";return events},templateHelpers:function(){var isChildTask=false,para=this.model.get("isChildTask");if(typeof para!=undefined)isChildTask=para;return{isChildTask:isChildTask}},initialize:function(){var self=this;Talent.$(document).off("mouseup.Task-Item-Status-View");Talent.$(document).on("mouseup.Task-Item-Status-View",function(){self.hide()});this.$el.off("mouseup");this.$el.on("mouseup",function(ev){ev.stopPropagation()})},changeStatusFun:function(events){events.stopPropagation();var node=Talent.$(events.currentTarget);var status=node.attr("status");this.hide();this.model.set("status",parseInt(status));this.trigger("click:status",this.model.toJSON())},show:function(node,options){this.$el.show();this.$el.css({width:"150px",zIndex:1e3});Context.setPosition(node,this.$el,{pos:"bottom",container:this.$el.parent()})},hide:function(){this.$el.hide();this.trigger("hide")},onClose:function(){this.$el.off("mouseup");Talent.$(document).off("mouseup.Task-Item-Status-View")}});var PrivateRangView=Talent.ItemView.extend({defaults:{privateValue:1,sort:[1,3,2],publicOptions:{name:"公开",des:"所有人可见"},privateOptions:{name:"私密",des:"仅@的人可见"},departmentOptions:{name:"部门可见",des:"仅我的部门可见"}},className:"qunartipwrapmvc",template:jst["private-range/private-range"],events:{"click ul":"_ulClickHandler","click li":"_liClickHandler"},modelEvents:{"change:privateValue":"render"},templateHelpers:function(){return{depId:this.depId,publicOptions:this.settings["publicOptions"],privateOptions:this.settings["privateOptions"],departmentOptions:this.settings["departmentOptions"]}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);var self=this;this.userInfo=Context.getUserInfo();this.depId=this.userInfo["DepartmentId"]||0;this.status=0;this.mappingData={1:this.settings["publicOptions"],2:this.settings["privateOptions"],3:this.settings["departmentOptions"]};Talent.$(document).off("mousedown.private-range");Talent.$(document).on("mousedown.private-range",function(event){self.status=0;self.hide();self.trigger("close")});this.$el.off("mousedown.private-range");this.$el.on("mousedown.private-range",function(event){event.stopPropagation()});this.model.set({visibility:this.settings.privateValue==1?1:2,privateObjType:this.settings.privateValue==3?15:0,privateObjId:this.settings.privateValue==3?this.depId:0,privateValue:this.settings.privateValue||1},{slient:true});this._formatData()},hide:function(){this.$el.hide();this.trigger("hide")},onRender:function(){var privateValue=this.model.get("privateValue");this.$el.find("li").removeClass("active");this.$el.find("li[id ="+privateValue+"]").addClass("active")},onClose:function(){this.$el.off("mousedown.private-range");Talent.$(document).off("mousedown.PubList-Range");this.status=0},show:function(node,options){var defaults={leftBias:"",topBias:""};var settings=Talent._.extend({},defaults,options);if(this.status==1){this.status=0;this.$el.hide();return}this.status=1;this.$el.css({position:"absolute","z-index":999});var optionsData={pos:"bottom"};optionsData=Talent._.extend({},optionsData,settings);Context.setPosition(node,this.$el,options);this.$el.css({display:"block"})},getDefaultPrivateText:function(privateValue){var privateValue=privateValue||this.settings["privateValue"];return this.mappingData[privateValue]},_formatData:function(){var sortData=this.settings["sort"];var mappingData=this.mappingData;var dataType={1:{type:"public"},2:{type:"private"},3:{type:"department"}};var data=[];if(!sortData.length){alert("sort不能为空")}for(var i=0;i<sortData.length;i++){var item=sortData[i],fixData=mappingData[item];if(fixData){fixData=Talent._.extend(fixData,dataType[item]);data.push(fixData)}}this.model.set("data",data)},_ulClickHandler:function(event){event.stopPropagation()},_liClickHandler:function(event){var node=Talent.$(event.currentTarget);if(node.hasClass("disabled")){return false}var privateValue=parseInt(node.attr("data-visibility"));this.model.set({visibility:privateValue,text:node.html(),privateObjType:node.attr("objType")||0,privateObjId:node.attr("objId")||0,privateValue:node.attr("id")});this.trigger("selected",this.model.toJSON());this.status=0;this.$el.hide()}});var RedRemindView={updateIndicatorNum:function(node,num){
var self=this;var num=this.numberCustomize(num);if(num){node.html(num).show().addClass("UI_animated UI_speed_400 UI_ani_bounce");setTimeout(function(){node.removeClass("UI_animated UI_speed_400 UI_ani_bounce")},400)}else{node.hide().html(0)}},updateIndicator:function(node,num){var self=this;var num=this.numberCustomize(num);if(num){node.show().addClass("UI_animated UI_speed_400 UI_ani_bounce");setTimeout(function(){node.removeClass("UI_animated UI_speed_400 UI_ani_bounce")},400)}else{node.hide()}},numberCustomize:function(num){var num=Number(num);if(!num)return 0;if(num>99){return"99+"}return num}};var SetNoticeView=Talent.Layout.extend({template:jst["set-notice/set-notice"],className:"tt-noticesetting",defaults:{id:"tita"},regions:{userList:"div[data-name=person-list]"},ui:{dayInput:"[data-name=day-input]",dayInputValue:"[data-name=day-input-value]",dayDropdown:"[data-name=day-dropdown]",dayDropdown_li:"li[data-type=dropdown-item]",dayDropdownDatepicker:"div[data-name=day-dropdown-datepicker]",dayDropdownWeek:"[data-name=day-dropdown-week]",dayDropdownMonth:"[data-name=day-dropdown-month]",everyWeekWrap:"li[data-name=day-every-week]",everyWeekWrap_dd:"[data-name=day-dropdown-week] li",everyMonthWrap:"li[data-name=day-every-month]",everyMonthWrap_dd:"[data-name=day-dropdown-month] li",hourWrap:"div[data-name=hour-wrap]",hourInputValue:"[data-name=hour-input-value]",hourDropdown:"[data-name=hour-dropdown]",hourDropdown_li:"[data-name=hour-dropdown] li",minWrap:'div[data-name="minite-wrap"]',minInputValue:"[data-name=minite-input-value]",minuteDropdown:"[data-name=minute-dropdown]",minuteDropdown_li:"[data-name=minute-dropdown] li",userWrap:"div[data-name=set-user-wrap]",decsWrap:"div[data-name=remind-desc-wrap]",decsInput:"textarea[data-name=remind-desc-input]",otherWrap:"li[data-name=day-other]",buttonCancelRemind:"a[data-name=remind-button-cancel-remind]",buttonCancel:"a[data-name=remind-button-cancel]",buttonSure:"a[data-name=remind-button-sure]",timeErrorTip:"div[data-name=time-error-tip]",userErrorTip:"div[data-name=user-error-tip]",contentErrorTip:"div[data-name=content-error-tip]"},events:function(){var events={};events["click "+this.ui.dayInput]="_clickDayInputHandler";events["click "+this.ui.dayDropdown_li]="_checkoutDay";events["mouseover "+this.ui.dayDropdown_li]="_dayBoxRest";events["mouseover "+this.ui.otherWrap]="_overOtherWrapHandler";events["click "+this.ui.dayDropdownDatepicker]="_dayDropDownHandler";events["mouseover "+this.ui.everyWeekWrap]="_overEveryWeekWrapHandler";events["mouseover "+this.ui.everyMonthWrap]="_overEveryMonthWrapHandler";events["click "+this.ui.everyWeekWrap_dd]="_checkEveryWeekDDHandler";events["click "+this.ui.everyMonthWrap_dd]="_checkEveryMonthDDHandler";events["click "+this.ui.hourWrap]="_clickHourHandler";events["click "+this.ui.minWrap]="_clickMinHandler";events["click "+this.ui.hourDropdown_li]="_clickHourDropdown_liHandler";events["click "+this.ui.minuteDropdown_li]="_clickMinuteDropdown_liHandler";events["focus "+this.ui.decsInput]="_foucsDecsInputHandler";events["blur "+this.ui.decsInput]="_blurDecsInputHandler";events["keyup "+this.ui.decsInput]="_keyupInputHandler";events["input "+this.ui.decsInput]="_inputDecsInputHandler";events["click "+this.ui.buttonSure]="_sureHandler";events["click "+this.ui.buttonCancel]="_cancelHandler";events["click "+this.ui.buttonCancelRemind]="_cancelRemindHandler";return events},initialize:function(){var self=this;this._dealDate();this.userCollection=new Talent.Collection;this.userCollection.on("add remove",function(){self._checkUser()});this.validateTime=true;this.validateUser=true;this.validateContent=true;this.$el.on("click",function(event){event.stopPropagation();self._hideDropdown();self.ui.minWrap.removeClass("tu-input-focus");self.ui.hourWrap.removeClass("tu-input-focus");self.ui.dayInput.removeClass("tu-input-focus")})},onRender:function(){var self=this;this._bindDatePicker();this.propertychange_val="";this.ui.decsInput.bind("propertychange",function(event){self._inputDecsInputHandler(event,self)})},setPosition:function(node){this.node=node;var data=node.attr("data"),self=this;data=$.parseJSON(data);this.objId=data["objid"]||0;this.objType=data["objType"]||0;this._requsetFetch().done(function(resp){if(self.isClosed)return;var data=resp[0],users=data["Users"];Talent._.map(users,function(user){user.Id=user.userId;user.UserAvatar=user.Avatar});self._resetData(data);self.userCollection.reset(users);self._showModal()})},_showModal:function(){var self=this;this.modals=$.confirm({backdrop:"static",hasfoot:true,hashead:true,closeBtn:true,keyboard:false,excessBtn:"取消提醒",width:"800",height:"260",body:self.$el,title:"设置提醒",okHide:function(event){self._sureHandler();return false},excessHide:function(){self._cancelRemindHandler().done(function(){self.modals.modal("hide")})},shown:function(){$(this).find(".body-modal").css("overflow-y","initial")}});this._setNoticeUser()},hide:function(){this.$el.hide()},_setPostion:function(options){var defaults={topBias:0,leftBias:0};var node=this.node;var options=Talent._.extend({},defaults,options);Context.setPosition(this.node,this.$el,options);this.$el.show();Talent._.animate(this.$el,"fadeInDown",3)},_setNoticeUser:function(){var self=this;this.noticeUserView=new AddUserCompositeView({addUserSelectonOptions:{muti:false,container:Talent.$("body").find(".modal-content"),bias:{top:5,left:0}},collection:this.userCollection,title:""});this.listenTo(this.noticeUserView,"addUser",function(data){this.userCollection.add(data)});this.userList.show(this.noticeUserView)},_dayDropDownHandler:function(event){event.stopPropagation()},_bindDatePicker:function(){var self=this;var options={format:"YYYY/MM/DD",singleDatePicker:true,parentEl:this.ui.dayDropdownDatepicker,autoHide:false,opens:"center"};this.ui.dayDropdownDatepicker.daterangepicker(options);this.ui.dayDropdownDatepicker.on("apply.daterangepicker",function(ev,picker){var date=picker.startDate.format("YYYY/MM/DD");self.ui.dayInputValue.html(date).attr("uservalue",date);self.model.set({cyctype:0,day:date});self.ui.dayDropdown_li.removeClass("active");self.ui.everyWeekWrap_dd.removeClass("active");self.ui.everyMonthWrap_dd.removeClass("active");self.ui.dayDropdown.find("li[uservalue^='"+date+" 00:00']").addClass("active");self._hideDropdown();self._checkTime()});this.$el.find(".daterangepicker").bind("click mouseover",function(event){event.stopPropagation()})},_checkTime:function(){var model=this.model,dayValue=model.get("day"),hourValue=model.get("hour"),minuteValue=model.get("minute"),nowDate=new Date,nowDay=nowDate.getDate(),nowHour=nowDate.getHours(),nowMin=nowDate.getMinutes(),setDate=new Date(dayValue+" "+hourValue+":"+minuteValue+":00"),setDayValue=moment(dayValue,"YYYYMMDD").date(),cyctype=model.get("cyctype");this.validateTime=true;if(nowDate>setDate&&cyctype==0){this.ui.timeErrorTip.html('<span class="error">不能设置过去的时间</span>');if(nowDay>setDayValue){this.ui.dayInput.removeClass("tu-input-focus").addClass("tu-input-error")}if(nowHour>hourValue){this.ui.hourWrap.removeClass("tu-input-focus").addClass("tu-input-error")}if(nowMin>minuteValue){this.ui.minWrap.removeClass("tu-input-focus").addClass("tu-input-error")}this.validateTime=false}else{this.ui.timeErrorTip.html("");this.ui.dayInput.removeClass("tu-input-error tu-input-focus");this.ui.hourWrap.removeClass("tu-input-error tu-input-focus");this.ui.minWrap.removeClass("tu-input-error tu-input-focus")}this._changeModalsOkbtnStatus()},_checkUser:function(){var userIds=Talent._.pluck(this.userCollection.toJSON(),"UserId");this.ui.userWrap.removeClass("tu-input-error tu-input-focus");this.ui.userErrorTip.html("");this.validateUser=true;if(!userIds.length){this.ui.userWrap.addClass("tu-input-error");this.ui.userErrorTip.html("被提醒人不能为空");this.validateUser=false}this._changeModalsOkbtnStatus()},_checkVal:function(val){var content=this.model.get("content")||"一个提醒";this.ui.contentErrorTip.html("");this.validateContent=true;if(content.replace(/[^\x00-\xff]/g,"**").length>40){this.ui.decsWrap.removeClass("tu-input-focus").addClass("tu-input-error");this.ui.contentErrorTip.html("提醒内容不能超过20个汉字或40个字符");this.validateContent=false}else{this.ui.decsWrap.removeClass("tu-input-error").addClass("tu-input-focus")}this._changeModalsOkbtnStatus()},_changeModalsOkbtnStatus:function(){if(this.validateTime&&this.validateUser&&this.validateContent){this.modals&&this.modals.modal("okToggle")}else{this.modals&&this.modals.modal("okToggle","disabled")}},_sureHandler:function(){var ret=this._validateData(),opsType=this.model.get("opsType"),self=this;this._getUserIds();if(ret.isValidate){if(opsType=="update"){this._requsetUpdate(ret.data).done(function(){self.modals.modal("hide")})}else{this._requsetAdd(ret.data).done(function(){self.modals.modal("hide")})}}},_getUserIds:function(){var users=this.userCollection.toJSON();var userId=Talent._.pluck(users,"UserId");this.model.set("userIds",userId)},_requsetFetch:function(){var deferred=new Talent.$.Deferred;var self=this;SetNoticeCollectoin.getData({obj_id:this.objId,obj_type:this.objType}).done(function(resp){deferred.resolve(resp)});return deferred},_requsetAdd:function(ret){var day=this.model.get("day"),hour=this.model.get("hour"),minute=this.model.get("minute"),self=this,deferred=new $.Deferred;var time=day+" "+hour+":"+minute;this._cancelHandler();SetNoticeCollectoin.postAddRemindData({obj_id:this.objId,obj_type:this.objType,content:ret["content"],cyc_type:ret["cyc_type"],remind_user_ids:this.model.get("userIds").join(","),time:ret["time"]}).done(function(resp){var data=self.model.toJSON();data["time"]=time;self.trigger("sure",self.ui.buttonSure,data);deferred.resolve()});return deferred},_requsetUpdate:function(ret){var self=this,deferred=new $.Deferred;this._cancelHandler();SetNoticeCollectoin.postUpdateData({obj_id:this.objId,obj_type:this.objType,content:ret["content"],cyc_type:ret["cyc_type"],remind_user_ids:this.model.get("userIds").join(","),time:ret["time"]}).done(function(resp){var data=self.model.toJSON();data["time"]=ret["time"];self.trigger("sure",self.ui.buttonSure,data);deferred.resolve()});return deferred},_cancelHandler:function(event){this.$el.hide()},_cancelRemindHandler:function(){var self=this,deferred=new $.Deferred;this.model.set({opsType:"add",day:"",content:""});this._dealDate();SetNoticeCollectoin.getCleanRemindData({obj_id:this.objId,obj_type:this.objType}).done(function(){self.trigger("cancelRemind");deferred.resolve()});return deferred},_resetData:function(data){var id=data["Id"]||0;if(id==0){this.opsType="add";this.model.set({noticeid:0,opsType:"add",objType:0,objId:0,content:"",uservalue:0,cyctype:0})}else{this.ui.buttonCancel.show();var content=data.Content.split("<b>");if(content.length==1){content=data.Content.split("(")}this.model.set({noticeid:this.options["id"],opsType:"update",objType:this.options["objType"],objId:this.options["objId"],content:$.trim(content[0])});this.ui.buttonCancelRemind.show();var cycType=data.CycType;if(!cycType){cycType="0"}cycType=""+cycType;var cycTypeArr=cycType.split("_");cycType=cycTypeArr[0];var date=data.Date,ymd,h,uservalue,label,min;if(date){dateArr=date.split(" ");ymd=dateArr[0].replace(/-/g,"/");h=dateArr[1].substr(0,2);min=dateArr[1].substr(3,5)}if(cycType==1){this.ui.dayInput.find("div[data-name=day-every-day]").trigger("click");uservalue=ymd}else if(cycType==2){this.ui.dayInput.find("div[data-name=day-every-weekday]").trigger("click")}else if(cycType==3){this.ui.dayDropdownWeek.find("li[uservalue='"+cycTypeArr[1]+"']").trigger("click")}else if(cycType==4){this.ui.dayDropdownMonth.find("li[uservalue='"+cycTypeArr[1]+"']").trigger("click")}else{var nDate=ymd;this.ui.dayInputValue.html(nDate);this.model.set({uservalue:nDate,cyctype:0});var daysel=this.ui.dayDropdown.find("li[uservalue='"+ymd+" 00:00"+"']");if(daysel.length){daysel.trigger("click")}else{this.ui.dayDropdownDatepicker.data("daterangepicker").setEndDate(ymd);this.model.set({day:ymd})}}if(data["Content"]){this.propertychange_val=data["Content"];this.ui.decsInput.val(data["Content"]).removeClass("default_nst")}this.ui.hourDropdown.find("li[label='"+h+"']").trigger("click");this.ui.minuteDropdown.find("li[label='"+min+"']").trigger("click")}},_foucsDecsInputHandler:function(event){var node=Talent.$(event.currentTarget),val=Talent.$.trim(node.val()),defVal=node.attr("defaultvalue");if(val==defVal){node.val("")}node.removeClass("default_nst");this.ui.decsWrap.addClass("tu-input-focus")},_blurDecsInputHandler:function(event){var node=Talent.$(event.currentTarget),val=Talent.$.trim(node.val());if(val==""){node.val(node.attr("defaultvalue"));node.addClass("default_nst");this.model.set("content","")}this.ui.decsWrap.removeClass("tu-input-focus")},_keyupInputHandler:function(ev){if(ev.keyCode==8){this._inputDecsInputHandler(ev)}},_inputDecsInputHandler:function(ev,that){ev.stopPropagation();var self=ev.type=="propertychange"?that:this;var node=Talent.$(ev.currentTarget),val=$.trim(node.val());if(self.propertychange_val==val)return;self.propertychange_val=val;self.model.set("content",val);self._checkVal(val)},_clickHourDropdown_liHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.model.set({label:node.attr("label"),hour:node.attr("uservalue")});this.ui.hourInputValue.html(node.attr("label"));this.ui.hourDropdown.hide();this.ui.hourDropdown_li.removeClass("active");node.addClass("active");this._checkTime()},_clickMinuteDropdown_liHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.model.set({label:node.attr("label"),minute:node.attr("uservalue")});this.ui.minInputValue.html(node.attr("label"));this.ui.minuteDropdown.hide();this.ui.minuteDropdown_li.removeClass("active");node.addClass("active");this._checkTime()},_clickHourHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.ui.hourWrap.addClass("tu-input-focus");this.ui.dayInput.removeClass("tu-input-focus");this.ui.minWrap.removeClass("tu-input-focus");this._hideDropdown();this.ui.hourDropdown.show()},_clickMinHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.ui.minWrap.addClass("tu-input-focus");this.ui.dayInput.removeClass("tu-input-focus");this.ui.hourWrap.removeClass("tu-input-focus");this._hideDropdown();this.ui.minuteDropdown.show()},_checkoutDay:function(event){var node=Talent.$(event.currentTarget);event.stopPropagation();var val=node.attr("uservalue");var arr=val.split(" ");var dataName=node.attr("data-name");if(dataName=="day-other"||dataName=="day-every-week"||dataName=="day-every-month"){return}if(dataName=="day-every-day"){this.ui.dayInputValue.html(node.attr("label"));this.model.set({cyctype:1,day:this._formatDate(new Date,"yyyy/MM/dd")})}else if(dataName=="day-every-weekday"){this.ui.dayInputValue.html(node.attr("label"));this.model.set({cyctype:2,day:this._formatDate(new Date,"yyyy/MM/dd")})}else{this.ui.dayInputValue.html(arr[0]);this.model.set({cyctype:0,day:arr[0]})}this.ui.dayDropdown.hide();this.ui.dayDropdown_li.removeClass("active");node.addClass("active");this._checkTime()},_clickDayInputHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.ui.dayInput.addClass("tu-input-focus");this.ui.hourWrap.removeClass("tu-input-focus");this.ui.minWrap.removeClass("tu-input-focus");this._hideDropdown();this.ui.dayDropdown.show()},_overOtherWrapHandler:function(event){event.stopPropagation();var node=$(event.currentTarget);this._dayBoxRest(event);var cyctype=this.model.get("cyctype");var date=moment().format("YYYY/MM/DD");if(cyctype==0){date=this.model.get("day")}this.ui.dayDropdownDatepicker.data("daterangepicker").setEndDate(date);this.ui.dayDropdownDatepicker.show()},_overEveryWeekWrapHandler:function(event){this._dayBoxRest(event);this.ui.dayDropdownWeek.show()},_overEveryMonthWrapHandler:function(event){this._dayBoxRest(event);this.ui.dayDropdownMonth.show()},_checkEveryWeekDDHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.ui.dayInputValue.html(node.attr("label"));this.model.set({cyctype:3,day:node.attr("uservalue")});this.ui.dayDropdown.hide();this.ui.dayDropdown_li.removeClass("active");this.ui.everyWeekWrap_dd.removeClass("active");this.ui.everyMonthWrap_dd.removeClass("active");node.addClass("active");this._checkTime()},_checkEveryMonthDDHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.ui.dayInputValue.html(node.attr("label"));this.model.set({cyctype:4,day:node.attr("uservalue")});this.ui.dayDropdown.hide();this.ui.dayDropdown_li.removeClass("active");this.ui.everyWeekWrap_dd.removeClass("active");this.ui.everyMonthWrap_dd.removeClass("active");node.addClass("active");this._checkTime()},_dayBoxRest:function(event){event&&event.stopPropagation();this.ui.dayDropdownWeek.hide();this.ui.dayDropdownMonth.hide();this.ui.dayDropdownDatepicker.hide()},_hideDropdown:function(){this.ui.dayDropdown.hide();this.ui.dayDropdownWeek.hide();this.ui.dayDropdownMonth.hide();this.ui.dayDropdownDatepicker.hide();this.ui.hourDropdown.hide();this.ui.minuteDropdown.hide();this.ui.dayDropdownDatepicker.hide()},_validateData:function(){var self=this;var ret={isValidate:true,data:{}};var content=this.model.get("content")||"一个提醒";var that=this;var defContent=this.ui.decsInput.attr("defaultvalue");if(content==defContent){content=""}ret.data.content=content;var cycType=this.model.get("cyctype");var hourValue=this.model.get("hour");var dayValue=this.model.get("day");var minuteValue=this.model.get("minute");var time=hourValue+":"+minuteValue;if(cycType==1||cycType==2){ret.data.cyc_type=cycType;ret.data.time=dayValue+" "+time}else if(cycType==3||cycType==4){var date=new Date;var year=date.getFullYear();var month=date.getMonth()+1;var day=date.getDate();if(month<10){month="0"+month}if(day<10){day="0"+day}var sDate=year+"/"+month+"/"+day+" ";ret.data.cyc_type=cycType+"_"+dayValue;ret.data.time=sDate+time}else if(cycType==-1){ret.data.cyc_type=cycType;ret.data.time=""}else{ret.data.cyc_type=cycType;ret.data.time=dayValue+" "+time+":00"}return ret},_dealDate:function(){var dateFormat="yyyy/MM/dd hh:mm";var curDate=new Date;var y=curDate.getFullYear();var m=curDate.getMonth();var d=curDate.getDate();var h=curDate.getHours();var s=curDate.getSeconds();var day=curDate.getDay();var od=h;if(h==23){curDate=new Date(y,m,d,h+1,0,0);y=curDate.getFullYear();m=curDate.getMonth();d=curDate.getDate();h=curDate.getHours();day=curDate.getDay()}var day7=[];var day7Map={6:"六",0:"日",1:"一",2:"二",3:"三",4:"四",5:"五"};var day7Label="",day7Class="";for(var i=0;i<7;i++){var nday=new Date(y,m,d+i).getDay();day7Class="";if(od==23){if(nday<day){day7Label="下周"+day7Map[nday]}else if(nday==day){day7Class="active";day7Label="明天"}else{day7Label="本周"+day7Map[nday]}}else{if(nday<day){day7Label="下周"+day7Map[nday]}else if(nday==day){day7Class="active";day7Label="今天"}else if(nday==day+1){day7Label="明天"}else{day7Label="本周"+day7Map[nday]}}day7.push('<li data-type="dropdown-item" class="'+day7Class+'" label="'+day7Label+'" uservalue="'+this._formatDate(new Date(y,m,d+i),dateFormat)+'"><div class="inner '+(nday==day+1||nday==0?"underline":"")+'">'+day7Label+"</div></li>")}this.model.set("day7",day7.join(""));var month31=[];for(var i=0;i<31;i++){month31.push('<li uservalue="'+(i+1)+'" label="每月'+(i+1)+'号">'+(i+1)+"</li>")}this.model.set("month31",month31.join(""));var hour24=[],label="";for(var i=0;i<24;i++){if(i<10){label="0"+i}else{label=i}hour24.push('<li label="'+label+'" uservalue="'+label+'">'+label+"</li>")}this.model.set("hour24",hour24.join(""));var miniteArr=["00","05","10","15","20","25","30","35","40","45","50","55"];var minite12=[];for(var i=0;i<miniteArr.length;i++){minite12.push('<li label="'+miniteArr[i]+'" uservalue="'+miniteArr[i]+'">'+miniteArr[i]+"</li>")}this.model.set("minite12",minite12.join(""));var today=this._formatDate(new Date(y,m,d,h,i),"yyyy/MM/dd");var nowHour=od==23?h:h+1;var nowHourLabel=nowHour<10?"0"+nowHour:nowHour;this.model.set({nowHour:nowHour,nowHourLabel:nowHourLabel,today:today,day:today,hour:nowHour,minute:"00"})},_formatDate:function(date,fmt){var o={"M+":date.getMonth()+1,"d+":date.getDate(),"h+":date.getHours(),"m+":date.getMinutes(),"s+":date.getSeconds(),"q+":Math.floor((date.getMonth()+3)/3),S:date.getMilliseconds()};if(/(y+)/.test(fmt)){fmt=fmt.replace(RegExp.$1,(date.getFullYear()+"").substr(4-RegExp.$1.length))}for(var k in o){if(new RegExp("("+k+")").test(fmt)){fmt=fmt.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length))}}return fmt},onClose:function(){}});var TDialogView=Talent.CompositeView.extend({template:jst["tdialog/dialog"],defaults:{id:"tdialog",type:"tipsy",arrowPos:"top",sure:false,sureText:"确定",sureLink:"",cancel:false,cancelText:"取消",arrow:1,minHeight:"37",minWidth:"50",maxWidth:"",fixed:false,zindex:1031,quirkTheme:false,showClosed:false,skin:""},tagName:"div",className:"_tt_dialog",ui:{sure:".sure_dialog",sureText:".sure_dialog>span",cancel:".cancel_dialog",closed:".closed_dialog",dd:".ask_dialog"},events:function(){var events={};events["click "+this.ui.sure]="onSureEvent";events["click "+this.ui.cancel]="onCancel";events["click "+this.ui.closed]="onCancel";return events},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);this.$el.attr("id",this.options.id);this.model.set({settings:this.settings});this._init();this.$el.off("mousedown");this.$el.on("mousedown",function(event){event.stopPropagation()});if(this.settings.skin=="skin2"){this.$el.addClass("tt-dialog-skin2")}},_init:function(){var options={minWidth:this.settings.minWidth+"px",minHeight:this.settings.minHeight+"px","z-index":this.settings.zindex,position:this.settings.fixed?"fixed":"absolute"};if(this.settings.maxWidth&&this.settings.maxWidth!=""){options["maxWidth"]=this.settings.maxWidth+"px"}this.$el.css(options)},onSureEvent:function(events){var node=$(events.currentTarget);$("#tdialog_mask").remove();if(typeof this.settings.sure=="function"){if(this.activeNode!=undefined&&this.activeNode!=null){var sure=this.settings.sure(node);if(sure==false){return}}else{this.settings.sure()}this.close()}},onCancel:function(events){var node=$(events.currentTarget);this.trigger("hide",node);$("#tdialog_mask").remove();if(typeof this.settings.cancel=="function"){this.settings.cancel(node)}this.close()},show:function(tri,content,options){var _this=this;var defaults={className:"none",autoHide:false,pos:"bottom",x:0,y:0,topBias:0,leftBias:0,arrowBias:0,zindex:1031,autoFrames:"window",container:"",arrow:false};var conf=Talent._.extend({},defaults,options);if(this.settings.type=="tipsy"){var template=Talent.$('<div class="tipsy_dialog '+conf.className+'_dialog"><b class="ico"></b><span class="content"></span></div>');template.append(content);this.$el.find(".content_dialog").empty().append(template)}else{this.$el.find(".content_dialog").empty().append(content)}if(this.settings["skin"]&&this.settings["skin"]=="skin2"){var chineseRegex=/[^\x00-\xff]/g;var strLength=content.replace(chineseRegex,"**").length;if(strLength<47&&this.settings["skin"]&&this.settings["skin"]=="skin2"){this.$el.css("text-align","center")}}if(this.settings.quirkTheme){this.$el.find(".sure_dialog").removeClass("btn-sure").addClass("btn-cancel");this.$el.find(".cancel_dialog").removeClass("btn-cancel").addClass("btn-sure")}if(!tri){$("body").append('<div class="mask" id="tdialog_mask"></div');this.$el.css({top:"300px",left:"50%","margin-left":"-"+this.$el.width()/2})}else{this._showHere(tri,conf)}this._autoHide(conf);this.$el.show();Talent._.animate(this.$el,"fadeInDown",3);this.$el.find(".content_dialog").off("click")},hide:function(){this.close()},setOptions:function(options){this.settings=Talent._.extend({},this.settings,options);this.model.set({settings:this.settings});this.render()},onRender:function(){var self=this;this.$el.on("click",function(evt){self.trigger("click");evt.stopPropagation()})},_stopMouseUpHandler:function(event){event.stopPropagation()},_autoHide:function(conf){var _this=this;if(conf.autoHide==true){setTimeout(function(){$("#tdialog_mask").remove();_this.trigger("hide");_this.close()},1500)}if(typeof conf.autoHide=="number"){setTimeout(function(){_this.trigger("hide");_this.close()},conf.autoHide)}},_showHere:function(dom,options){this.activeNode=dom||null;var container=options.container||Talent.$("body"),containerOff=container.offset();var scrollTop=Talent.$("body").scrollTop(),scrollLeft=Talent.$("body").scrollLeft();var domOff=dom.offset();var domH=dom.outerHeight();var domW=dom.outerWidth();var dialogW=options.width?options.width:this.$el.outerWidth();var dialogH=options.height?options.height:this.$el.outerHeight();var elPos={};var arrowPosition={};var arrowClass="";var domOffTop=options.domOffTop?options.domOffTop:domOff.top;var domOffLeft=domOff.left;var top=domOffTop-containerOff.top,left=domOffLeft-containerOff.left;switch(options.pos){case"top":{elPos={top:top-dialogH-8,left:left};arrowPosition={left:0};arrowClass="bottom"}break;case"topCenter":{elPos={top:top-dialogH-8,left:left+domW/2-dialogW/2};arrowPosition={left:dialogW/2-8};arrowClass="bottom"}break;case"topRight":{elPos={top:top-dialogH-8,left:left+domW-dialogW};if(elPos.left<0){elPos.left=0}arrowPosition={left:dialogW-16};arrowClass="bottom"}break;case"bottom":{elPos={top:top+domH+8,left:left};arrowPosition={left:0};arrowClass="top"}break;case"bottomCenter":{elPos={top:top+domH+8,left:left+domW/2-dialogW/2};arrowPosition={left:dialogW/2-8};arrowClass="top"}break;case"bottomRight":{elPos={top:top+domH+8,left:left+domW-dialogW};if(elPos.left<0){elPos.left=0}arrowPosition={left:dialogW-16};arrowClass="top"}break;case"left":{elPos={top:top,left:left-dialogW};arrowPosition={top:0};arrowClass="right"}break;case"leftCenter":{elPos={top:top+domH/2-dialogH/2,left:left-dialogW};arrowPosition={top:dialogH/2-8};arrowClass="right"}break;case"leftBottom":{elPos={top:top+domH-dialogH,left:left-dialogW};arrowPosition={top:dialogH-16};arrowClass="right"}break;case"right":{elPos={top:top,left:left+domW};arrowPosition={top:0};arrowClass="left"}break;case"rightCenter":{elPos={top:top+domH/2-dialogH/2,left:left+domW};arrowPosition={top:dialogH/2-8};arrowClass="left"}break;case"rightBottom":{elPos={top:top+domH-dialogH,left:left+domW};arrowPosition={top:dialogH-16};arrowClass="left"}break}if(options.leftBias){elPos.left=elPos.left+options.leftBias}if(options.topBias){elPos.top=elPos.top+options.topBias}var windowH=Talent.$(window).height(),windowW=Talent.$(window).width(),scrollTop=Talent.$(document).scrollTop(),scrollLeft=Talent.$(document).scrollLeft();if(containerOff.top+elPos["top"]+dialogH>windowH+scrollTop){var chaz=windowH+scrollTop-(containerOff.top+elPos["top"]+dialogH);elPos["top"]=elPos["top"]+chaz}if(containerOff.top+elPos["top"]<scrollTop){var chaz=scrollTop-(containerOff.top+elPos["top"]);elPos["top"]=elPos["top"]+chaz}if(containerOff.left+elPos["left"]+dialogW>windowW+scrollLeft){var chaLeft=windowW+scrollLeft-(containerOff.left+elPos["left"]+dialogW);elPos["left"]=elPos["left"]+chaLeft}if(containerOff.left+elPos["left"]<scrollLeft){var chaLeft=scrollLeft-(containerOff.left+elPos["left"]);elPos["left"]=elPos["left"]+chaLeft}this.$el.css(elPos);var _arrow=this.$el.find(".arrow");if(options.arrow===false){_arrow.hide()}_arrow.addClass(arrowClass);if(options.arrow===2){if(arrowClass==="top"||arrowClass==="bottom"){_arrow.addClass("arrow2")}else{_arrow.addClass("horizontal_arrow2")}}_arrow.css(arrowPosition)},onClose:function(){this.$el.off("mousedown");this.$el.find(".content_dialog").off("click")},changeSubmitBtn:function(status){if(status==1){this.ui.sureText.text("确定");this.ui.sure.removeClass("success_submint").removeClass("loading_submint")}else if(status==2){this.ui.sureText.text("");this.ui.sure.removeClass("success_submint");this.ui.sure.addClass("loading_submint")}else{this.ui.sureText.text("");this.ui.sure.removeClass("loading_submint");this.ui.sure.addClass("success_submint")}}});function TipDialogView(node,content,options){var options=options||{};var settings=Talent._.extend({},options,{autoHide:true,className:options["className"]||"warn"});if(settings["skin"]&&settings["skin"]=="skin2"){settings.showClosed=true;settings.minWidth="400";settings.maxWidth="400"}var container=options["container"]||Talent.$("body");window.tipView&&window.tipView.close();window.tipView=new TDialogView({type:"tipsy",skin:settings.skin||"",showClosed:settings.showClosed,maxWidth:settings.maxWidth||"",minWidth:settings.minWidth||50,zindex:settings.zindex||1031});if(settings["skin"]&&settings["skin"]=="skin2"){var chineseRegex=/[^\x00-\xff]/g;var strLength=content.replace(chineseRegex,"**").length;if(strLength<47&&settings["skin"]&&settings["skin"]=="skin2"){window.tipView.$el.css("text-align","center")}}container.append(window.tipView.render().el);tipView.show(node,content,settings);return tipView}function ConfirmDialogView(node,content,options){var options=options||{};var container=options["container"]||Talent.$("body");var dialogView=TDialogView.instanceConfirm;var settings=Talent._.extend({},{autoHide:false,cancel:true,sure:true,quirkTheme:false,className:"ask",type:"tipsy",sureText:"确定",cancelText:"取消"},options);if(settings["skin"]&&settings["skin"]=="skin2"){settings.minWidth="400";settings.maxWidth="400"}window.dialogView&&window.dialogView.close();window.dialogView=new TDialogView({type:settings.type,skin:settings.skin||"",cancel:settings.cancel,sure:settings.sure,sureText:settings.sureText,cancelText:settings.cancelText,maxWidth:settings.maxWidth||"",minWidth:settings.minWidth||50,zindex:settings.zindex||1031});if(settings["skin"]&&settings["skin"]=="skin2"){var chineseRegex=/[^\x00-\xff]/g;var strLength=content.replace(chineseRegex,"**").length;if(strLength<47&&settings["skin"]&&settings["skin"]=="skin2"){window.dialogView.$el.css("text-align","center")}}container.append(window.dialogView.render().el);Talent.$(document).off("mousedown.TT-Dialog-View-Confirm");Talent.$(document).on("mousedown.TT-Dialog-View-Confirm",function(){Talent.$(document).off("mousedown.TT-Dialog-View-Confirm");window.dialogView.close()});window.dialogView.show(node,content,settings);return window.dialogView}var ExistFilesItemView=Talent.ItemView.extend({tagName:"li",template:jst["uploader/existFile-component"],className:"item_afb",templateHelpers:function(){var fileName=this.model.get("FileName");var fileType=this.model.get("FileType").toLowerCase();var documentSource=this.model.get("FocumentSource");var imageUrl=this.model.get("ImageUrl");var isImage=this.model.get("IsImage");var iconColor="";if(!imageUrl){if(documentSource&&documentSource==3)isImage=false}if(/^(jpg|png|gif|jpeg)$/.test(fileType)){fileType=fileType;iconColor="#44CF85"}else{if(/^(exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(fileType)){fileType=fileType;iconColor="#49B9DD"}else if(/^(rar|zip)$/.test(fileType)){fileType=fileType;iconColor="#FFBA46"}else if(/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(fileType)){fileType=fileType;iconColor="#8479D6"}else if(/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(fileType)){fileType=fileType;iconColor="#3EBBA8"}else{fileType="none";iconColor="#FF730C"}}return{fileName:Talent._.substringWithM(fileName,14,true),fileFullName:fileName,fileType:fileType,webHost:Context.isAbsolutePath(),deleteable:this.model.get("Deleteable"),documentSource:documentSource,isImage:isImage,iconColor:iconColor}}});var ExistFilesView=Talent.CollectionView.extend({defaults:{quirkLink:false},className:"attachment_fb tita-existFile-box tu-clearfix",itemView:ExistFilesItemView,tagName:"ul",ui:{deleted:"a[data-name=attachment-deleted]",previewImg:"a[data-name=feed-attachment-preview-img]",preview:"a[data-name=feed-attachment-preview]",previewButton:"span[data-name=feed-attachment-preview-button]",dialog:"span[data-name=feed-attachment-preview-dialog]",fileName:"[data-name=name_afb]",
imgPrevw:"[data-name=imgPrevw]",tipInfo:"[data-toggle=infotip]"},collectionEvents:{reset:"_dealData"},_dealData:function(){var self=this;this.collection.each(function(model){var imgTypes=Context.getAttachmentType().image;var type=model.get("FileType").toLowerCase();var previewUrl=model.get("PreviewUrl");var documentSource=model.get("DocumentSource");model.set("IsImage",false);model.set("DocumentSource",documentSource);for(var i=0;i<imgTypes.length;i++){if(type==imgTypes[i]){model.set("IsImage",true);var index=previewUrl.lastIndexOf(".");if(index>0){var bigUrl=previewUrl.substr(0,index)+"_b."+previewUrl.substr(index+1),smallUrl=previewUrl.substr(0,index)+"_s."+previewUrl.substr(index+1);if(type=="gif"){smallUrl=previewUrl}model.set("bigUrl",bigUrl);model.set("smallUrl",smallUrl)}if(documentSource==3){model.set("IsImage",false)}break}}if(previewUrl!=null&&previewUrl!=""){model.set("IsPreview",true)}else{model.set("IsPreview",false)}})},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);this._dealData()},events:function(){var events={};events["click "+this.ui.deleted]="_deletedHandler";events["click "+this.ui.preview]="_renderImgPreviewView";events["click "+this.ui.previewImg]="_renderImgPreviewView";events["click "+this.ui.previewButton]="_renderImgPreviewView";events["click "+this.ui.dialog]="_renderImgPreviewView";events["click "+this.ui.imgPrevw]="_renderImgPreviewView";events["click "+this.ui.fileName]="_renderImgPreviewView";events["mouseenter "+this.ui.tipInfo]="_mouseenterFileName";return events},_mouseenterFileName:function(ev){var node=$(ev.currentTarget);var title=node.data("body");this.tipView&&this.tipView.destroy();this.tipView=new Infotip;this.tipView.bindNode(node,{container:this.$el,type:"default",body:title});this.tipView.show()},_deletedHandler:function(event){var node=Talent.$(event.currentTarget);var id=node.attr("id");var collection=this.collection.toJSON();var new_data=[];var delItem={};Talent._.each(collection,function(item){if(item["DocumentId"]!=id){new_data.push(item)}else{delItem=item}});this.collection.reset(new_data);this.trigger("deleted",new_data,delItem)},_renderImgPreviewView:function(event){if(this.settings.quirkLink)return;event.stopPropagation();event.preventDefault();var node=Talent.$(event.currentTarget),dataName=node.attr("data-name");var allNode=this.$("[data-name="+dataName+"]");var index=allNode.index(node);var data=Talent._.where(this.collection.toJSON(),{isImage:true,documentSource:1})||[];if(!data.length)return;if(index<0)return;if(window.top!==window.self){var data={collection:data,index:index};var host="//"+location.host+"/widget#sdk/img-preview";window.iTalentSDK&&window.iTalentSDK.showPopup(host,920,520,data);return}this.imgPreviewView&&this.imgPreviewView.close();this.imgPreviewView=new ImgPreviewView({collection:new Talent.Collection(data),index:index});this.$el.append(this.imgPreviewView.render().el)},_renderImgPreEl:function(){}});var YFYLoginView=Talent.ItemView.extend({template:jst["uploader/yfy-login-item"],className:"YFY-login-containter",ui:{form:"form"},show:function(){this.ui.form.submit();this.trigger("formSubmit")}});var UploaderComponentPreviewItemView=Talent.ItemView.extend({template:jst["uploader/uploader-component-preview-item"],tagName:"li",className:"item_up",ui:{iconImg:"div[data-name=tita-upload-preview-icon]",itemLi:"div[data-name=tita-upload-preview-item]",statusTip:"[data-name=status-tip]",deleteFile:"[data-name=tita-upload-deleted]",reUpload:"[data-name=tita-upload-reUpload]"},events:function(){var events={};events["click "+this.ui.deleteFile]="_deleteFileClickHandler";events["click "+this.ui.reUpload]="_reUploadFileClickHandler";return events},modelEvents:{change:"render"},templateHelpers:function(){var verifyStatus=this.model.get("verifyStatus"),uploadStatus=this.model.get("uploadStatus"),modelTojson=this.model.toJSON();return{fileName:this.itemFile.fileName,fileFullName:this.itemFile.fileFullName,fileType:this.model.get("fileType")||this.itemFile.type,iconColor:this.itemFile.color,verifyStatus:verifyStatus==undefined?true:verifyStatus,uploadStatus:uploadStatus==undefined?3:uploadStatus,downloadUrl:modelTojson.downloadUrl||modelTojson.DownloadUrl,isFromYFY:"isFromYFY"in modelTojson?modelTojson.isFromYFY:false,isImage:"isImage"in modelTojson?modelTojson.isImage:/^jpg|png|gif|jpeg|image|JPG|PNG|GIF|JPEG$/.test(modelTojson.FileType)}},_dealFileModel:function(){var fileFullName=this.model.get("name")||this.model.get("FileName"),lastIdx=fileFullName.lastIndexOf("."),fileType=fileFullName.substring(lastIdx+1),subLen=24-1-fileType.length,fileName=_.substring(fileFullName.substring(0,lastIdx),subLen,true)+"."+fileType;var itemFile={type:"",color:"",fileName:fileName,fileFullName:fileFullName};if(/^(jpg|png|gif|jpeg)$/.test(fileType)){itemFile["color"]="#44CF85";itemFile["type"]=fileType}else{if(/^(rar|zip|exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(fileType)){itemFile["color"]="#49B9DD";itemFile["type"]=fileType}else if(/^(rar|zip)$/.test(fileType)){itemFile["color"]="#FFBA46";itemFile["type"]=fileType}else if(/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(fileType)){itemFile["color"]="#8479D6";itemFile["type"]=fileType}else if(/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(fileType)){itemFile["color"]="#3EBBA8";itemFile["type"]=fileType}else{itemFile["color"]="#FF730C";itemFile["type"]="none"}}return itemFile},initialize:function(){this.isClose=false;this.supportFormData=window.FormData?true:false;this.itemFile=this._dealFileModel()},onRender:function(){var isImage=this.model.get("isImage"),isFromYFY=this.model.get("isFromYFY"),uploadStatus=this.model.get("uploadStatus"),self=this;if(isImage){this._renderImg()}this.$el.attr({id:this.model.cid});if(uploadStatus==3){this.ui.statusTip.html('<span class="status-success">上传成功!</span>');this.ui.statusTip.delay(2e3).animate({opacity:0},200)}if(uploadStatus==2&&!this.supportFormData){var percentComplete=this.model.get("percentComplete");clearInterval(this.timer);this.timer=setInterval(function(){percentComplete+=10;if(percentComplete>100)percentComplete=30;self.model.set("percentComplete",percentComplete)},100)}},_renderImg:function(){var self=this,isFromYFY=this.model.get("isFromYFY");var image=new Image;image.onload=function(){if(self.isClose)return;var aiInitWid=image.width;var aiInitHei=image.height;var aiDefWid=30,aiDefHei=30;var wh=self.fixImgSize(aiInitWid,aiInitHei,aiDefWid,aiDefHei);self.imgSize={width:wh.w,height:wh.h};image.width=wh.w;image.height=wh.h;image.className="img_up";typeof self.ui.iconImg=="object"&&self.ui.iconImg.html(image)};image.onerror=function(){self.ui.itemLi.html('<div class="warnattachmenttip">读取文件 '+self.model.get("name"||this.model.get("FileName"))+" 失败</div>");self.$el.delay(3e3).slideUp(200)};image.src=this.model.get("previewUrl")},fixImgSize:function(aiInitWid,aiInitHei,aiDefWid,aiDefHei){var WH={w:0,h:0};var initWid=aiInitWid;var initHei=aiInitHei;var defWid=aiDefWid;var defHei=aiDefHei;if(initWid>0&&initHei>0){var defFix=defWid/defHei;var initFix=initWid/initHei;if(initWid>defWid||initHei>defHei){if(initFix>defFix){WH.w=defWid;WH.h=initHei*(defWid/initWid)}else{WH.w=initWid*(defHei/initHei);WH.h=defHei}}else{WH.w=initWid;WH.h=initHei}}else{WH.w=initWid;WH.h=initHei}return WH},_deleteFileClickHandler:function(ev){ev.stopPropagation();var uploadStatus=this.model.get("uploadStatus");if(uploadStatus==2){var xhr=this.model.get("xhr");if(xhr)xhr.abort();this.trigger("deleteItem")}else{this.trigger("deleteItem")}},_reUploadFileClickHandler:function(ev){ev.stopPropagation();this.trigger("reUploadFile")},onClose:function(){this.isClose=true}});var UploaderComponentPreviewView=Talent.CollectionView.extend({itemView:UploaderComponentPreviewItemView,tagName:"ul",className:"tita-upload-preview-new",defaults:{previewInNewTab:false},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);var self=this;this.on("itemview:deleteItem",function(view){self.delItem(view)});this.on("itemview:reUploadFile",function(view){var fileObject=view.model.get("FILE");var fromPaste=view.model.get("fromPaste");var fromDrag=view.model.get("fromDrag");if(fromPaste||fromDrag){self.trigger("reUploadFileFromDragPaste",fileObject)}else{self.trigger("reUploadFile",fileObject)}})},ui:{infotip:"[data-toggle=infotip]",previewPic:"[data-name=tita-upload-img-preview]"},events:function(){var events={};events["mouseenter "+this.ui.infotip]="_mouseenterInfotip";events["click "+this.ui.previewPic]="_previewPicClickHandler";return events},_previewPicClickHandler:function(event){var node=Talent.$(event.currentTarget),dataName=node.attr("data-name");var allNode=this.$("[data-name="+dataName+"]");var index=allNode.index(node);var data=Talent._.where(this.collection.toJSON(),{isImage:true,isFromYFY:false})||[];if(!data.length)return;if(index<0)return;_.each(data,function(item){var previewUrl=item.previewUrl;item.fileName=item.FileName;item.smallUrl=previewUrl.substring(0,previewUrl.lastIndexOf("."))+"_s"+previewUrl.substring(previewUrl.lastIndexOf("."))});if(this.settings.previewInNewTab){window.open(data[index].previewUrl);return}this.imgPreviewView&&this.imgPreviewView.close();this.imgPreviewView=new ImgPreviewView({collection:new Talent.Collection(data),index:index});this.$el.append(this.imgPreviewView.render().el)},_mouseenterInfotip:function(ev){var node=$(ev.currentTarget);this.tipView&&this.tipView.destroy();this.tipView=new Infotip;this.tipView.bindNode(node,{container:this.$el,type:"default"});this.tipView.show()},onRender:function(){},delItem:function(view){this.collection.remove(view.model);this.trigger("deleteItem",this.collection.toJSON())}});var LoadingBoxView=Talent.ItemView.extend({defaults:{y:20},template:Talent._.template('<span class="img-load"></span><span>正在加载亿方云...</span>'),className:"loadingBoxView",initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.$el.on("mouseup",function(event){event.stopPropagation()})},onRender:function(){this.$el.css({position:"absolute",width:580,"z-index":2e3,border:"1px solid #DDD",height:306,"box-shadow":"#DDD 0px 0px 4px","background-color":"#fff",top:"50%",left:"50%","margin-left":-290,"margin-top":-290,"padding-top":247})},hide:function(){this.$el.hide()},show:function(){this.$el.show()}});var UploaderComponentView=Uploader.UploaderComponentView.extend({template:jst["uploader/uploader-component"],loadingTemplate:Talent._.template('<div id="<%= timestamp %>" class="loading_up"></div>'),errorTemplate:Talent._.template('<div class="warnattachmenttip"><%= msg %></div>'),PreviewView:UploaderComponentPreviewView,ExistFilesView:ExistFilesView,dealOptions:function(options){var UploaderComponentViewOptions=Context.getUploadOptions();this.defaults["fileNumLimit"]=20;this.options=Talent._.extend({},this.defaults,UploaderComponentViewOptions,options)},ui:{uploadNewFile:"[data-name=file]",YFYbtn:"#fc_upload",uploadType:"[data-name=upload-type]",dfsBtn:"[data-name=dfs-upload]",inputFile:"input.upload_file_input"},events:function(){var events={};events["mouseover "+this.ui.uploadNewFile]="showPop";events["mouseout "+this.ui.uploadNewFile]="hidePop";events["click "+this.ui.uploadNewFile]="hidePop";events["click "+this.ui.inputFile]="hidePop";events["click "+this.ui.uploadNewFile]="_showUploadTypeMenu";events["click "+this.ui.YFYbtn]="_uptoFangCloud";events["mouseup.uploader-component "+this.ui.uploadType]="_clickUploadTypeHandler";return events},initialize:function(options){var self=this;this.dealOptions(options);this.options.errorTime=3e3;this.model=new Talent.Model(this.options);var data=this.options.data||[],existFiles=this.options.existFiles||[];this.fileCollection=new this.FileCollection(data);this.checkedFileCollection=new this.CheckedFileCollection;this.recentFileCollection=new this.RecentFileCollection;this.existFilesCollection=new Talent.Collection(existFiles);this.templateHelpers=this.model.get("text");this.isSafari=window.safari&&window.navigator.userAgent.indexOf("Safari")>-1?true:false;Talent.$("body").off("click.upload");Talent.$("body").on("click.upload",function(){self.hideUploadDropdown()});if(this.options.PreviewView){this.PreviewView=this.options.PreviewView}if(this.options.RecentUploadView){this.RecentUploadView=this.options.RecentUploadView}if(this.options.loadingTemplate){this.loadingTemplate=this.options.loadingTemplate}if(this.options.errorTemplate){this.errorTemplate=this.options.errorTemplate}if(this.options.template){this.template=this.options.template}this.supportFormData=window.FormData?true:false;this.container=this.options.container||this.$el;this.isOpenYFY=this.options["openYFY"]},onRender:function(){if(!this.isOpenYFY){this.ui.uploadNewFile.parent().css({position:"relative",display:"inline-block","vertical-align":"middle"})}if(Talent.$(this.container).find(".upload_node").length==0){this.$el.appendTo(Talent.$(this.container).find(".uploader_container"))}this.renderUploaderFormView();if(this.options.showPreview){this.renderPreviewListView()}if(this.options.showExistFile){this._renderExistFile()}},_renderExistFile:function(){var self=this;this.existFilesView=new ExistFilesView({collection:this.existFilesCollection,model:this.model});Talent.$(this.container).find(".preview_container").append(this.existFilesView.render().$el);this.listenTo(this.existFilesView,"deleted",function(new_data,delItem){this.trigger("deleted",new_data,delItem)})},renderPreviewListView:function(){var self=this;this.previewCompositeView=new this.PreviewView({collection:this.fileCollection,model:this.model,previewInNewTab:this.options.previewInNewTab});this.previewCompositeView.on("deleteItem",function(item){self.trigger("deleteItem",self._uploadDataClassification(self.fileCollection.toJSON()))});this.previewCompositeView.on("reUploadFile",function(fileObj){self.uploaderView&&self.uploaderView.submitInputUpload(fileObj)});this.previewCompositeView.on("reUploadFileFromDragPaste",function(fileObj){self.uploaderView&&self.uploaderView.submitPasteOrDrag(fileObj)});Talent.$(this.container).find(".preview_container").append(this.previewCompositeView.render().$el)},showPop:function(events){var node=Talent.$(events.currentTarget);this.uploadTipView&&this.uploadTipView.destroy();this.uploadTipView=new Infotip;var text="最多支持上传 20 个<br/>每个不超过 50MB";if(window.DragEvent){text="支持拖拽上传<br/>最多支持上传 20 个<br/>每个不超过 50MB"}var options={container:$("body"),width:"135px",type:"default",body:'<div style="text-align: left; color: #fff; line-height: 24px;">'+text+"</div>"};this.uploadTipView.bindNode(node,options);this.uploadTipView.show()},hidePop:function(ev){this.uploadTipView&&this.uploadTipView.destroy()},_clickUploadTypeHandler:function(ev){ev.stopPropagation()},_showUploadTypeMenu:function(ev){ev.stopPropagation();var self=this;if(this.isOpenYFY){var node=this.options["referenceNode"]?this.options["referenceNode"]:Talent.$(ev.currentTarget),nodeW=node.outerWidth(),nodeH=node.outerHeight();this.ui.uploadType.show();Context.setPosition(node,this.ui.uploadType,{container:this.$el});Talent.$(document).off("mouseup.uploader-component");Talent.$(document).on("mouseup.uploader-component",function(){self.ui.uploadType.hide();Talent.$(document).off("mouseup.uploader-component")})}},renderUploaderFormView:function(){var self=this;this.options.fileCollection=this.fileCollection;Uploader.UploaderView.prototype.initialize=function(options){var options=options||{};this.options=Talent._.extend({},this.defaults,options);var random="_"+parseInt(Math.random()*1e3);if(this.options["callbackValue"]&&this.options["callbackValue"].indexOf(".")!=-1){var list=this.options["callbackValue"].split(".");if(list[0]=="parent"){list=Talent._.rest(list)}this.options.windowCallbackValue=list.join(".")+random}else{this.options.windowCallbackValue=this.options.callbackValue+random}this.options.callbackValue=this.options.callbackValue+random;this.model=new Talent.Model(Talent._.extend({},this.options));this.changeTimestamp();this.hasEnter=false;this.random=random;this.supportFormData=window.FormData?true:false;this.pendingFiles=[]};Uploader.UploaderView.prototype.onClose=function(){this.iframe&&this.iframe.remove()};Uploader.UploaderView.prototype.onRender=function(){var random=this.random;this.ui.form.attr("target","upload_target_iframe"+random);this.ui.form.attr("name","upload_target_iframe"+random);if(Talent.$("#upload_target_iframe"+random).length==0){this.iframe=$('<iframe style="display:none;" id="upload_target_iframe'+random+'" name="upload_target_iframe'+random+'"></iframe>');$("body").append(this.iframe)}this.$el.css({position:"absolute",top:"0px"});var container=this.options.container;Talent.$(container).find(".upload_new_file").find(".upload_form_container").remove();Talent.$(container).find(".upload_new_file").append(this.$el);this.addEventListener();this.trigger("formViewRender",this)};this.uploaderView=new Uploader.UploaderView(this.options);this.uploaderView.on("formViewRender",function(view){self.onAfterFormViewRender(view);self.trigger("FormViewRender")});this.uploaderView.render();this._dealUploaderStatus(this.uploaderView)},_dealUploaderStatus:function(uploaderView){var self=this;uploaderView.on("uploadLoad",function(file){file.isFromYFY=false;if(self.isOpenYFY)self.ui.uploadType.hide();if(self.supportFormData){self._updateFilePreviewModel(file);self.trigger("uploadLoad",file)}else{self.fileCollection.add(file);self.trigger("uploadLoad",file)}});uploaderView.on("uploadIng",function(file){self._updateFilePreviewModel(file);self.trigger("uploadIng",file)});uploaderView.on("uploadEnd",function(resp,file){var successFile;var newSuccessFile;if(self.isOpenYFY)self.ui.uploadType.hide();if(self.supportFormData){var res=resp.Result[0];if(res.IsSuccess){file.uploadStatus=3}else{file.uploadStatus=4}file=_.extend({},file,res);var dealData=self._dealUploadEndData([file]);self._updateFilePreviewModel(dealData[0]);var data=Talent._.where(self.fileCollection.toJSON(),{IsSuccess:true});successFile=self._uploadDataClassification(data);newSuccessFile=self._uploadDataClassification(dealData);self.trigger("uploadEnd",successFile,newSuccessFile)}else{successFile=self.fileCollection.filter(function(model){return model.get("IsSuccess")});if(resp.Result.length){_.each(resp.Result,function(item,index){if(item.IsSuccess){var data=self._dealUploadEndData([item])[0];data.isFromYFY=false;data.uploadStatus=3;data.name=data.FileName;data.verifyStatus=true;successFile.push(data);self.trigger("uploadEnd",self._uploadDataClassification(successFile),data)}})}self.fileCollection.reset(successFile)}});uploaderView.on("uploaError",function(file){self._updateFilePreviewModel(file)});uploaderView.on("error",function(resp){if(resp["message"]=="")return;self.hideLoadingView(resp);self.showErrorView(resp);self.trigger("error",resp)})},_updateFilePreviewModel:function(file){var oldFile;if(this.isSafari){file.uid=file.uid||(new Date).getTime();oldFile=this.fileCollection.findWhere({uid:file.uid,size:file.size,name:file.name})}else{oldFile=this.fileCollection.findWhere({lastModified:file.lastModified,size:file.size,name:file.name})}if(oldFile){oldFile.set(_.extend({},oldFile.toJSON(),file))}else{var obj={};for(var key in file){obj[key]=file[key]}obj.FILE=file;if(this.fileCollection.length+this.existFilesCollection.length<this.options.fileNumLimit){this.fileCollection.add(obj)}}},_uploadDataClassification:function(resp){var obj={};obj.dfs=[];obj.YFYresp=[];if(resp&&resp.length){for(var i=0;i<resp.length;i++){if(resp[i].isFromYFY){var object={};object.relatedFileId=resp[i].id;object.fileType=resp[i].MediaType;object.size=resp[i].size;object.name=resp[i].FileName;if(resp[i].thumbnail){object.thumbnailGenerated=true}else{object.thumbnailGenerated=false}object.documentSource=3;object.shareCode=resp[i].share_code;obj.YFYresp.push(object)}else if(resp[i].DfsPath){if(self.supportFormData){if(resp[i].uploadStatus==3){obj.dfs.push(resp[i].DfsPath)}}else{obj.dfs.push(resp[i].DfsPath)}}}}return obj},_dealUploadEndData:function(res){var self=this;Talent._.map(res,function(item){var fileType=item.MediaType?item.MediaType.toLowerCase():item.type_icon.toLowerCase();item["fileType"]=fileType;if(/^jpg|png|gif|jpeg|image|JPG|PNG|GIF|JPEG$/.test(fileType)){item["imageUrl"]=item["ClientUrl"]?item["ClientUrl"]:item["thumbnail"];item["isImage"]=true;item["fileType"]="image"}else{if(/^(rar|zip|exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(fileType)){item["fileType"]=fileType}else if(/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(fileType)){item["fileType"]=fileType}else if(/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(fileType)){item["fileType"]=fileType}else{item["fileType"]="none"}item["isImage"]=false}if(!item.FileName)item.FileName=item.name;if(!item.Msg)item.Msg="上传成功";item.MediaType=self._getFileType(item.FileName);if(item.isFromYFY){item.uploadStatus=3;item.verifyStatus=true;var shareCode=item["share_code"],relatedId=item["id"],size=item["size"];item.downloadUrl="//"+BSGlobal.titaHost+"/YiFangYun/Index?shareCode="+shareCode+"&name="+item.name+"&size="+size+"&relatedId="+relatedId+"&fileType="+fileType;item.previewUrl=item.imageUrl}else{item.downloadUrl=item.ClientUrl;item.previewUrl=item.downloadUrl;item.dfsFileName=item.ClientUrl.substring(item.ClientUrl.lastIndexOf("/")+1)}return item});return res},_getFileType:function(str){var arr=str.split(".");return newStr=arr[arr.length-1]},_uptoFangCloud:function(event){event.stopPropagation();var self=this;this.loadingBoxView=new LoadingBoxView;Talent.$("body").append(this.loadingBoxView.render().$el);this.loadingBoxView.show();YFYColleciton.getYifangyun().done(function(resp){if(resp&&resp.host){var fangcloudURL=Context.getGlobal("yifangyunjs");require([fangcloudURL],function(){self.YFYLoginView=new YFYLoginView({model:new Talent.Model(resp)});self.YFYLoginView.on("formSubmit",function(){setTimeout(function(){self.loadingBoxView.hide();self.renderYFYView()},2e3)});self.$el.append(self.YFYLoginView.render().$el);self.YFYLoginView.show()})}})},renderYFYView:function(){var self=this;FangCloud.choose({success:function(files){Talent._.map(files,function(item){item.isFromYFY=true});self._dealYFYUploaderData(files)}});this._setYFYViewPositoon();Talent.$(document).off("mouseup.close-yfy-iframe");Talent.$(document).on("mouseup.close-yfy-iframe",function(){FangCloud&&FangCloud.closeChooser();self.ui.uploadType.hide()});Talent.app.vent.on("route",function(fragments,params,getQueryObject){FangCloud.closeChooser()});Talent.$("#fangcloud_choose").css("z-index","2000")},_dealYFYUploaderData:function(resp){this.ui.uploadType.hide();var data=this._dealUploadEndData(resp);if(data.length){this.fileCollection.add(data);this.trigger("uploadEnd",this._uploadDataClassification(this.fileCollection.toJSON()),this._uploadDataClassification(data))}},_setYFYViewPositoon:function(){var scrTop=parseInt($(document).scrollTop()),yfyTop=parseInt($("#fangcloud_choose").css("top"));$("#fangcloud_choose").css("top",scrTop+yfyTop)},_addFileItem:function(data){var self=this;var newData=[];Talent._.each(data,function(file){if(file.DfsPath){newData.push(file.DfsPath)}});if(newData.length){this.trigger("addAttachment",newData.join(","))}},showLoadingView:function(resp){var container=this.options.container;Talent.$(container).find(".loading_container").append(this.loadingTemplate({timestamp:resp.timestamp}))},hideLoadingView:function(resp){var container=this.options.container;var timestamp=resp.timestamp;Talent.$(container).find(".loading_container").find("#"+timestamp).hide()},onClose:function(){this.uploaderView&&this.uploaderView.close();Talent.$(document).off("mouseup.uploader-component");Talent.$(document).off("mouseup.close-yfy-iframe")}});var WorkHourView=Talent.ItemView.extend({template:jst["work-hour/work-hour"],className:"work-hour",ui:{hourPick:".hour_list a",minutePick:".minite_list a"},modelEvents:{hourDate:"render",minuteDate:"render"},events:function(){var events={};events["click "+this.ui.hourPick]="_clickHourHandler";events["click "+this.ui.minutePick]="_clickMinuteHandler";return events},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);if(!this.model.get("hourDate")){this.model.set("hourDate",0)}if(!this.model.get("minuteDate")){this.model.set("minuteDate",0)}Talent.$(document).on("mousedown.Work-Hour-View",function(){self.dialogView&&self.dialogView.hide()})},show:function(node,options){this._renderDialogView(node,options)},_renderDialogView:function(node,options){var self=this;var defaults={pos:"bottom",arrow:false};var options=Talent._.extend({},defaults,options);if(!this.dialogView){this.render();this.dialogView=new TDialogView({showClosed:false,minWidth:350,sure:function(node){var hourDate=self.model.get("hourDate")||0,minuteDate=self.model.get("minuteDate")||0;if(hourDate==0&&minuteDate==0){TipDialogView(node,"工时不能为0",{pos:"topCenter"});return false}self.trigger("sure",self.model.toJSON())},cancel:function(){self.trigger("cancel",self.model.toJSON())}});options["container"].append(this.dialogView.render().$el);this.dialogView.$el.on("mousedown",function(event){event.stopPropagation()})}this.dialogView.show(node,this.$el,options)},_clickHourHandler:function(ev){var node=this.$(ev.currentTarget),hour=node.attr("data-time");this.ui.hourPick.removeClass("current");node.addClass("current");this.model.set("hourDate",hour)},_clickMinuteHandler:function(ev){ev.stopPropagation();var node=this.$(ev.currentTarget),minute=node.attr("data-time");this.ui.minutePick.removeClass("current");node.addClass("current");this.model.set("minuteDate",minute)},onClose:function(){this.dialogView&&this.dialogView.close()}});var PublistMblogToreplyView=Talent.ItemView.extend({className:"who_pm",template:jst["publish-dynamic/publist-mblog-toreply"],ui:{lock:"span[data-name=feed-comment-lock]"},events:function(){var events={};return events},ui:{closeToUser:"span[data-name=to-reply-closed]"},events:function(){var events={};events["click "+this.ui.closeToUser]="_closeToUserClickHandler";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options)},_closeToUserClickHandler:function(event){var self=this;var node=Talent.$(event.currentTarget);this.model.set({commentId:0,toUserName:""});this.$el.slideUp();this.trigger("closed",this.model.toJSON())}});var PublistMblogView=Talent.CompositeView.extend({defaults:{id:"pubMblog",type:"feed",maxlength:"2000",isLimit:true,defaultValue:"你在忙什么",value:"",submitText:"发布",shape:"default",defaultHide:false,inFocus:true,toUserName:"",autoResize:true,defalutFiles:[],isShowAtAll:false,atAllText:"所有同事",atAllValue:"@[所有同事:all_members] ",atAllTipText:"所有同事将收到本条消息",isShowAt:true,atText:"同事",atMuti:true,atTipText:"想确保谁看到就@这个成员",isShowAtExtend:false,atExtendText:"外部",atExtendMuti:false,atExtendTipText:"",atExtendUserCollectionQuerys:{},atExtendHighlight:false,isShowAttachment:true,isShowEmotion:true,emotionText:"表情",isShowShang:false,dashangText:"打赏",isShowRange:true,privateText:"所有人可见",privateValue:1,isShowRangeDropDown:true,privateDropDownOptions:{},isExternal:false,externalText:"此项目允许外部联系人参与，外部联系人可以看到您回复的内容、上传的文件，请注意企业信息保密！",isShowSendSms:true,params:{},submitRequest:function(options){var deferred=new Talent.$.Deferre;return deferred}},template:jst["publish-dynamic/publish-mblog"],className:"tt_publishmblog",ui:{toName:"span[data-name=to-data-name]",count:"[data-name=count]",countNum:"span[data-name=count_num]",inputWrap:"div[data-name=new-content-wrap]",label:"label[data-name=new-defaultvalue]",input:"textarea[data-name=new-content]",at:"[data-name=at]",atAll:"[data-name=atall]",atExtend:"[data-name=atExtend]",submit:"button[data-name=submit]",range:"span[data-name=range]",rangeCaret:"i[data-name=range-caret]",rangeCont:"span[data-name=range-cont]",toReply:"div[data-name=to-reply]",cancel:"button[data-name=cancel]",attachment:"a[data-name=file]",sms:"span[data-name=mblog-sms]",smsInput:"span[data-name=mblog-sms-input]",smsText:"span[data-name=mblog-sms-text]",box:"div[data-name=mblog-box]",emotionBtn:'[data-name="emotion"]',dashangBtn:'[data-name="dashang"]',taoshangBtn:'[data-name="taoshang"]',referenceNode:'[data-name="reference-node"]'},events:function(){var events={};events["click "+this.ui.label]="_labelClcikHandler";events["focus.publish-mblog "+this.ui.input]="_focusHandler";events["keyup.publish-mblog "+this.ui.input]="_keyupHandler";events["cut "+this.ui.input]="_keyupHandler";events["input "+this.ui.input]="_keyupHandler";events["change "+this.ui.input]="_keyupHandler";events["blur "+this.ui.input]="_blurHandler";events["click "+this.ui.atAll]="_atAllClickHandler";events["click "+this.ui.cancel]="_cancelClcikHandler";events["click "+this.ui.range]="_rangeClcikHandler";events["mousedown "+this.ui.range]="_stopMouseupEvent";events["click "+this.ui.submit]="_submitData";events["click "+this.ui.emotionBtn]="_showEmotion";events["click "+this.ui.sms]="_requestCheckSms";events["click "+this.ui.dashangBtn]="_dashangHandler";return events},templateHelpers:function(){var apps=Context.getGlobal("apps");var WorkAdvancedSetting=Context.getGlobal("WorkAdvancedSetting");var WorkExternal=WorkAdvancedSetting.WorkFunctionSetting.WorkExternal;var ISVType=Context.getGlobal("ISVType");var isShowSendSms=true;var taskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");if(taskAdvancedSetting&&taskAdvancedSetting.TaskFunctionSetting){if(typeof taskAdvancedSetting.TaskFunctionSetting.TaskSMS!=="undefined"){isShowSendSms=taskAdvancedSetting.TaskFunctionSetting.TaskSMS}}if(ISVType!=1e4){isShowSendSms=false}return{value:this.settings.value,maxlength:this.settings.maxlength,isLimit:this.settings.isLimit,submitText:this.settings.submitText,atText:this.settings.atText,atAllText:this.settings.atAllText,atExtendText:this.settings.atExtendText,attachmentText:this.settings.attachmentText,privateText:this.settings.privateText,defaultValue:this.settings.value?"":this.settings.defaultValue,isShowRange:this.settings.isShowRange,isShowAttachment:this.settings.isShowAttachment,isShowAt:this.settings.isShowAt,isShowAtAll:this.settings.isShowAtAll,isShowAtExtend:this.settings.isShowAtExtend,isShowSendSms:isShowSendSms,isShowEmotion:this.settings.isShowEmotion,dashangText:this.settings.dashangText,taoshangText:this.settings.taoshangText,emotionText:this.settings.emotionText,isShowShang:this.settings.isShowShang,WorkExternal:WorkExternal}},modelEvents:{"change:privateText":"_changePrivateValue","change:toUserName":"_renderToreplyView"},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);if(!util_rewardOpen()){this.settings.isShowShang=false}var privateValue=this.options["privateValue"]||this.settings["privateValue"];this.settings["privateDropDownOptions"]=Talent._.extend({},this.defaults["privateDropDownOptions"],this.options["privateDropDownOptions"],{privateValue:privateValue});this.userInfo=Context.getUserInfo();this.depId=this.userInfo["DepartmentId"]||0;this.tajax=false;this._resetModel();this.storage=Context.getLocalStorage();this.localStroageKey="mblogLocalStroage_"+this.userInfo["Id"]+"_"+this.settings["id"]+"_"+this.settings["type"];this.bindInputAutoResize=!this.settings.autoResize;this.inIframe=window.top===window.self?false:true;if(this.settings.isShowRange)this.model.set("rangeViewSelected",false)},onRender:function(){var self=this;if(this.inIframe&&this.settings.isShowEmotion){window.iTalentSDK.register({listenEvent:"tita_widget_emotion_pub_"+this.settings.id,context:this,cb:function(data){this._afterChoseEmotion(data)}})}if(this.settings.value){this.ui.inputWrap.addClass("input_blur");this.ui.input.trigger("keyup.publish-mblog")}if(this.settings.shape=="line"){this.$el.addClass("tt_line_publishmblog")}if(this.settings.defaultHide){this.$el.hide()}else{this.ui.cancel.remove()}this.$el.find("[data-body]").infotip({container:this.$el});this._customFeedComment();this._customAt();this._customAtAll();

this._customRange();this._bindExternal();this.$el.on("mousedown",function(event){event.stopPropagation();self.emotionView&&self.emotionView.hide();self.rangeView&&self.rangeView.close()});this._bindWindow();this._bindAt();if(this.settings.isExternal){this._showCaution()}this._renderToreplyView();this._bindSMS();if(this.settings.shape!="line"){this._showLocalInput()}this._customAttachment()},_showCaution:function(){var WorkAdvancedSetting=Context.getGlobal("WorkAdvancedSetting");var WorkExternal=WorkAdvancedSetting.WorkFunctionSetting.WorkExternal;var html='<div class="tu-caution tu-mb-5">'+this.settings.externalText+"</div>";WorkExternal&&this.ui.box.prepend(html)},_dashangHandler:function(event){var node=$(event.currentTarget);this.trigger("rewardGive",this.model.toJSON());node.infotip("hide")},_afterChoseEmotion:function(data){var $t=this.ui.input[0],input=this.ui.input,val=data.emotionVal;if(document.selection){input.focus();sel=document.selection.createRange();sel.text=val;input.focus()}else if($t.selectionStart||$t.selectionStart=="0"){var startPos=$t.selectionStart;var endPos=$t.selectionEnd;var scrollTop=$t.scrollTop;$t.value=$t.value.substring(0,startPos)+val+$t.value.substring(endPos,$t.value.length);input.focus();$t.selectionStart=startPos+val.length;$t.selectionEnd=startPos+val.length;$t.scrollTop=scrollTop}else{input.value+=val;input.focus()}input.keyup()},_stopMouseupEvent:function(event){event.stopPropagation()},_showEmotion:function(ev){ev.stopPropagation();var self=this;var node=this.$(ev.currentTarget);var containerNode=this.$(".list_pm");if(this.inIframe){var host="//"+location.host+"/widget#sdk/emotion?id="+this.settings.id;window.iTalentSDK&&window.iTalentSDK.showPopup(host,473,270);return}if(this.emotionView){this.emotionView.close();this.emotionView.hide()}this.emotionView=new EmotionView({triggerNode:node,inputNode:this.ui.input,dialogShowOption:{container:self.$el,boundingEl:containerNode,adjust:100,topBias:-10,leftBias:0}});this.emotionView.render()},onClose:function(){if(this.TSubmitData)clearTimeout(this.TSubmitData);if(this.tBindWindow)clearTimeout(this.tBindWindow);Talent.$(document).off("click.Publish-Mblog"+this.settings.id);this.titaUploadBtn&&this.titaUploadBtn.close()},show:function(){var self=this;this.$el.slideDown()},hide:function(){this.$el.slideUp()},_bindSMS:function(){if(!this.settings["isShowSendSms"])return;this.ui.smsText.infotip({body:"被@的同事将会收到短信通知",container:this.$el})},_showLocalInput:function(){var text=this.storage.getItem(this.localStroageKey);var input=this.ui.input;var self=this;if(text){this.ui.label.hide();input.val(text);setTimeout(function(){if(!self.bindInputAutoResize){self.bindInputAutoResize=true;self.ui.input.autosize()}if(self.bindInputAutoResize){input.trigger("input.autosize")}},0);this.model.set("context",text);this.ui.inputWrap.addClass("input_blur");this._changeTotal()}},_resetModel:function(){this.model.set({context:"",total:0,toUserName:this.options["toUserName"]||"",visibility:this.settings.privateValue==1?1:2,privateObjId:this.settings.privateValue==3?this.depId:0,privateObjType:this.settings.privateValue==3?15:0,privateValue:this.settings["privateValue"]||1,files:_.isArray(this.settings.defalutFiles)&&_.pluck(this.settings.defalutFiles,"DfsPath")||[],isSendSMS:false,feedId:0,commentId:0,YFYDocuments:[],privateText:this.settings.privateText})},_renderToreplyView:function(){var toUserName=this.model.get("toUserName"),type=this.settings["type"];if(type!="comment")return;if(toUserName==""){this.publistMblogToreplyView&&this.publistMblogToreplyView.close();return}this.publistMblogToreplyView&&this.publistMblogToreplyView.close();this.publistMblogToreplyView=new PublistMblogToreplyView({model:this.model});var node=this.publistMblogToreplyView.render().$el;this.ui.box.prepend(node);Talent._.animate(node,"badgeDown")},_bindWindow:function(){var self=this;Talent.$(document).off("click.Publist-Mblog-View-"+this.settings.id);Talent.$(document).on("click.Publist-Mblog-View-"+this.settings.id,function(){if(self.tBindWindow)clearTimeout(self.tBindWindow);self.tBindWindow=setTimeout(function(){clearTimeout(self.tBindWindow);var val=$.trim(self.model.get("context"));if((val==self.settings.value||val=="")&&!self.model.get("files").length){self._resetModel();self._reset();if(self.settings.shape=="line"){self.$el.addClass("tt_line_publishmblog");self.ui.input.css("height","")}if(self.settings.defaultHide){self.$el.hide()}}},50);self.bindInputAutoResize=false});this.$el.off("click.Publist-Mblog-View-"+this.settings.id);this.$el.on("click.Publist-Mblog-View-"+this.settings.id,function(event){event.stopPropagation()})},_bindAt:function(){var self=this;if(!this.settings.isShowAt)return;this.memberSmemberView=new UserSelector({collection:new UserSelectorCollection});var options=util.userSelectorConfig({viewType:"single",triggerChar:"@",input:true,muti:this.settings.atMuti,stringLen:{Name:34,Email:30,DepartmentName:30}});this.memberSmemberView.addAtNode(this.ui.input,this.ui.at,options);var that=this;this.ui.input.on("submit",function(){if(self.bindInputAutoResize){$(this).trigger("input.autosize").trigger("keyup")}else{$(this).trigger("keyup.publish-mblog")}})},_bindExternal:function(){var self=this;if(!this.settings.isShowAtExtend)return;if(this.settings.atExtendHighlight){this.ui.atExtend.addClass("hight_light")}this.atExternalView=new UserSelector({collection:new UserSelectorWorkExtenalCollection(this.settings.atExtendUserCollectionQuerys)});var options=util.userSelectorConfig({viewType:"single",triggerChar:"@",input:true,muti:this.settings.atExtendMuti,stringLen:{Name:34,Email:30,DepartmentName:30}});this.atExternalView.addNode(this.ui.atExtend,options);var that=this;this.ui.atExtend.on("submit",function(ev,data){self._atInsertBySdk(data)})},_reset:function(){var options=this.settings["privateDropDownOptions"];this.rangeView&&this.rangeView.model.set(options);this.render()},_customFeedComment:function(){if(this.settings.type=="feed"){this.ui.cancel.remove()}if(this.settings.type=="comment"){this.ui.range.remove()}},_customAt:function(){if(!this.settings.isShowAt){return}var self=this;this.ui.at.infotip({body:this.settings.atTipText,container:this.$el})},_customAtAll:function(){if(!this.settings.isShowAtAll){return}var self=this;this.ui.atAll.infotip({body:this.settings.atAllTipText,container:this.$el})},_customAtExtend:function(){if(!this.settings.isShowAtExtend||this.settings.atExtendText==""){return}var self=this;this.ui.atExtend.infotip({body:this.settings.atExtendText,container:this.$el})},_customAttachment:function(){if(!this.settings.isShowAttachment){return}var self=this;var openYFY=Context.IsOpenYifangyun();this.titaUploadBtn=new UploaderComponentView({container:this.$el,openYFY:openYFY,referenceNode:this.ui.referenceNode,data:this.settings.defalutFiles.length&&this.settings.defalutFiles||[]});this.listenTo(this.titaUploadBtn,"uploadEnd",function(allObj){this.model.set("files",allObj.dfs);this.model.set("YFYDocuments",allObj.YFYresp);this._upLoadEndInputContext()},this);this.listenTo(this.titaUploadBtn,"deleteItem",function(allObj,newObj){this.model.set("files",allObj.dfs);this.model.set("YFYDocuments",allObj.YFYresp);this._upLoadEndInputContext()},this);this.ui.attachment.html(this.titaUploadBtn.render().$el)},_upLoadEndInputContext:function(){var context=this.model.get("context"),dfs=this.model.get("files"),YFYfs=this.model.get("YFYDocuments");var fileNum=dfs.length;if(YFYfs&&YFYfs.length){fileNum+=YFYfs.length}if(context==""){file_cont="分享了"+fileNum+"个文件"}else{file_cont=context+"分享了"+fileNum+"个文件"}if(fileNum>0&&context.search(/分享了.{1,2}个文件/)>=0){file_cont=context.replace(/分享了.{1,2}个文件/,"分享了"+fileNum+"个文件")}if(fileNum==0){file_cont=context.replace(/分享了.{1,2}个文件/,"")}this.model.set("context",file_cont);this.ui.input.val(file_cont).trigger("keyup.publish-mblog");this.ui.inputWrap.addClass("input_blur")},_smsClickData:function(){var isSendSMS=this.model.get("isSendSMS");if(!isSendSMS){this.ui.smsInput.removeClass("tu-icon-checkbox-have").addClass("tu-icon-check-active");this.model.set("isSendSMS",true)}else{this.ui.smsInput.removeClass("tu-icon-check-active").addClass("tu-icon-checkbox-have");this.model.set("isSendSMS",false)}},_requestCheckSms:function(event){var self=this;var node=Talent.$(event.currentTarget);SMSCollection.getSmsCheck({to_user_id:this.userInfo["Id"]}).done(function(resp){if(resp==2||resp==4){ConfirmDialogView(node,"目前您企业的短信已超出许可量，请联系超管进行短信充值",{cancel:false,sure:function(){},pos:"left",leftBias:100})}else{self._smsClickData()}})},_customRange:function(){if(!this.settings.isShowRangeDropDown){this.ui.rangeCaret.remove();this.ui.range.css("cursor","default")}},_labelClcikHandler:function(event){var node=Talent.$(event.currentTarget);this.ui.input.focus()},_focusHandler:function(event){var node=Talent.$(event.currentTarget);var val=$.trim(node.val());this.ui.inputWrap.removeClass("input_blur input_error");this.ui.inputWrap.addClass("input_focus");this.ui.label.css("opacity",.5);if(this.settings.shape=="line"){var self=this;this.$el.removeClass("tt_line_publishmblog")}if(!this.bindInputAutoResize){this.bindInputAutoResize=true;this.ui.input.autosize();this._showLocalInput()}},_keyupHandler:function(event){if(event.ctrlKey&&event.keyCode==13){this._submitData();return}if(this.tajax)return;var node=Talent.$(event.currentTarget);var val=$.trim(node.val());if(val==this.settings.value){this.model.set("context","")}else{this.model.set("context",val)}this.storage.setItem(this.localStroageKey,val);this._changeContext()},_keyupAtHandler:function(e){e.stopPropagation();var keyCode=e.keyCode,node=$(e.currentTarget),val=$.trim(node.val()),caret_pos=$(node).caret("pos");if((keyCode==50||keyCode==8)&&val.charAt(caret_pos-1)=="@"){this._showUserselectorSdk()}},_clickAtHandler:function(e){e.stopPropagation();this._showUserselectorSdk()},_showUserselectorSdk:function(){var data=util.userSelectorConfig({viewType:"single",input:true,muti:this.settings.atMuti,stringLen:{Name:34,Email:30,DepartmentName:30}}),host="//"+location.host+"/widget#sdk/user-selector";window.iTalentSDK&&window.iTalentSDK.showPopup(host,302,407,data);window.iTalentSDK.register({listenEvent:"tita_more_user-selector-submit",context:this,cb:function(resp){this._atInsertBySdk(resp.user)}});return},_atInsertBySdk:function(resp){var content="",oIpnut=this.ui.input;if(!resp){return false}if(resp.data){Talent._.each(resp.data,function(item){if(item.type=="department"){content+="@["+item.name+":"+item.id+":dep_members] "}else{content+="@["+item.Name+":"+item.Email+"] "}})}else{content="@["+resp.Name+":"+resp.Email+"] "}var val=this.ui.input.val();if($.trim(val)==""){val=""}var cursorPos=this._getCurPos(oIpnut.get(0)),startPos=val.substring(0,cursorPos.start);if(cursorPos.end<0){oIpnut.val(content)}else{oIpnut.val(startPos+content+val.substring(cursorPos.end))}this._setCurPos(oIpnut.get(0),startPos.length+content.length);if(this.bindInputAutoResize){oIpnut.trigger("input.autosize").trigger("keyup")}else{oIpnut.trigger("keyup.publish-mblog")}},_blurHandler:function(event){var node=Talent.$(event.currentTarget);var val=$.trim(node.val());this.ui.inputWrap.removeClass("input_focus").removeClass("input_error");if(val==""){if(this.settings.value){node.val(this.settings.value);this.ui.inputWrap.addClass("input_blur")}else{this.ui.label.css("opacity",1).show()}}else{this.ui.inputWrap.addClass("input_blur")}},_cancelClcikHandler:function(){this.storage.removeItem(this.localStroageKey);this._resetModel();this._reset()},_rangeClcikHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var self=this;if(!this.settings.isShowRangeDropDown)return;if(node.hasClass("quna_pm-disabled"))return;node.addClass("active");var rangeDropDownIsShow=1;this.rangeView&&this.rangeView.close();var options=this.settings["privateDropDownOptions"];options["privateValue"]=this.settings.privateValue;this.rangeView=new PrivateRangView(options);this.listenTo(this.rangeView,"selected",function(data){rangeDropDownIsShow=0;node.removeClass("active");this.model.set("rangeViewSelected",true);if(data["privateValue"]==2){this._checkAtText()}this.model.set({visibility:data["visibility"],privateObjType:data["privateObjType"],privateObjId:data["privateObjId"],privateValue:data["privateValue"],privateText:data["text"]})},this);this.listenTo(this.rangeView,"close",function(){if(rangeDropDownIsShow){node.removeClass("active");rangeDropDownIsShow=0}});this.ui.box.append(this.rangeView.render().$el);this.rangeView.show(node,{container:this.ui.box,pos:"bottom"});this.rangeView.model.set({privateValue:this.model.get("privateValue")})},_checkAtText:function(){var pat=/@\[(.*?):([\w\.-])+@([\w-]+\.)+[\w-]{2,4}\]\s?/g;var val=this.model.get("context");if(pat.test(val)==false){this.ui.at.trigger("click");if(this.bindInputAutoResize){this.ui.input.trigger("input.autosize")}}},_changeContext:function(){var cont=this.model.get("context");var pat=/@\[(.+?):(.+?)_members\]/g;var peoReg=/@\[(.+?):(\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+)/g;var allPat=/@\[(.+?):all_members\]/g;if(cont!=""){this.ui.label.hide()}else{this.ui.label.show()}if(allPat.test(cont)){this.model.set("visibility",1);this.ui.range.addClass("quna_pm-disabled")}else if(peoReg.test(cont)||pat.test(cont)){if(!this.model.get("rangeViewSelected")&&this.settings.isShowRangeDropDown){this.model.set("visibility",2);this.model.set({privateText:"私密",privateValue:2});this.ui.rangeCont.html("私密")}}else{if(!this.model.get("rangeViewSelected")){this.model.set({visibility:this.settings.privateValue,privateValue:this.settings.privateValue,privateText:this.settings.privateText});if(this.settings.privateValue==1){this.ui.rangeCont.html("公开")}else{this.ui.rangeCont.html(this.settings.privateText)}}this.ui.range.removeClass("quna_pm-disabled")}this._changeTotal()},_changeTotal:function(){var total=this.model.get("context").length;this.ui.submit.removeClass("disabled");if(total>this.settings.maxlength&&this.settings.isLimit){this.ui.countNum.text(total);this.ui.count.show();this.ui.submit.addClass("disabled")}else{this.ui.count.hide()}this.model.set("total",total)},_changePrivateValue:function(){var num=this.model.get("privateValue");if(num==1){this.ui.input.removeClass("writelock")}else{this.ui.input.addClass("writelock")}this.ui.rangeCont.html(this.model.get("privateText"))},_atAllClickHandler:function(event){var node=Talent.$(event.currentTarget);var val=this.ui.input.val();if($.trim(val)==""){val=""}var cursorPos=this._getCurPos(this.ui.input.get(0));var startPos=val.substring(0,cursorPos.start);if(cursorPos.end<0){this.ui.input.val(this.settings.atAllValue)}else{this.ui.input.val(startPos+this.settings.atAllValue+val.substring(cursorPos.end))}this._setCurPos(this.ui.input.get(0),startPos.length+this.settings.atAllValue.length);this.ui.input.trigger("keyup.publish-mblog")},_getCurPos:function(textBox){var start=0,end=0;if(typeof textBox.selectionStart=="number"){start=textBox.selectionStart;end=textBox.selectionEnd}else if(document.selection){var range=document.selection.createRange();if(range.parentElement().id==textBox.id){var range_all=document.body.createTextRange();range_all.moveToElementText(textBox);for(start=0;range_all.compareEndPoints("StartToStart",range)<0;start++)range_all.moveStart("character",1);for(var i=0;i<=start;i++){if(textBox.value.charAt(i)=="\n")start++}var range_all=document.body.createTextRange();range_all.moveToElementText(textBox);for(end=0;range_all.compareEndPoints("StartToEnd",range)<0;end++){range_all.moveStart("character",1)}for(var i=0;i<=end;i++){if(textBox.value.charAt(i)=="\n")end++}}}return{start:start,end:end}},_setCurPos:function(ctrl,start,end){end=end||start;if(ctrl.setSelectionRange){ctrl.focus();ctrl.setSelectionRange(start,end)}else if(ctrl.createTextRange){var range=ctrl.createTextRange();range.collapse(true);range.moveEnd("character",end);range.moveStart("character",start);range.select()}},_submitData:function(events){var cont=this.model.get("context");if(cont==""){return}if(cont.length>this.settings["maxlength"]){return}cont=Context.encodeScript(cont);cont=cont.replace(/[\n\r]/g,"<br/>");this.model.set("context",cont);var self=this;if(this.tajax)return;this.tajax=true;this.ui.submit.html("正在"+this.settings.submitText+"……").addClass("disabled");var options=Talent._.extend(this.model.toJSON(),this.settings["params"]);this.settings.submitRequest(this.ui.submit,this.model.toJSON(),this.settings.params).done(function(){self.storage.removeItem(self.localStroageKey);self.ui.submit.html(self.settings.submitText).removeClass("disabled");self.ui.inputWrap.removeClass("input_focus");self._resetModel();self.rangeView&&self.rangeView.model.set(self.model.toJSON());if(self.settings.type=="feed"){Talent._.actionAnalysis("[feed-publish]",self.model.get("feedId"));self.successTip=new Infotip;self.successTip.bindNode(self.ui.submit,{type:"remind",container:self.$el,body:"发布成功",trigger:"manual",align:"right",bias:{left:0,top:0}});self.listenTo(self.successTip,"hide",function(){self._reset();self.tajax=false});self.successTip.show()}else{self._reset();self.tajax=false}}).fail(function(){self.tajax=false;self.ui.submit.html(self.settings.submitText).removeClass("disabled")})}});var ExperienceView=Talent.Layout.extend({defaults:{id:"ExperienceView",requestSubmit:function(){var deferred=new Talent.$.Deferred;return deferred}},template:jst["experience/experience"],className:"experience-view-twidget",initialize:function(options){this.settings=Talent._.extend({},this.defaults,options)},regions:{content:"[data-name=experience-contant]"},onRender:function(){},show:function(node,options){this._renderDialogView(node,options)},_renderDialogView:function(node,options){var self=this;var defaults={placement:"bottom",animation:false,trigger:"manual",hasfoot:false,align:"center",html:true,widthlimit:false,type:"attention",body:this.render().$el};options=Talent._.extend({},defaults,options);this.infoTipView&&this.infoTipView.destroy();this.infoTipView=new Infotip;this.infoTipView.bindNode(node,options);this.listenTo(this.infoTipView,"hide",function(){this.trigger("hide")});this.infoTipView.show();this._renderTaskCreateView()},_renderTaskCreateView:function(){var options={privateRangeOptions:false,extendPersonOptions:false,applyUserOptions:false,participatorOptions:false,replaceOptions:false,hourDateOptions:false,principalOptions:false,classOptions:false,nameOptions:false,dateOptions:false,richEditorOptions:{editorContainerId:"experience"+this.settings["id"],defaultText:"请输入进展"},bottomOptions:{isShowFileUpload:true,isShowPrivateBtn:false,isShowMessage:false,isShowPackUpBtn:false,pubBtnText:"发布"},id:this.settings["id"]};options["requestSubmit"]=this.settings["requestSubmit"];this.taskCreateView=new TaskCreateView(options);this.content.show(this.taskCreateView)},onClose:function(){this.dialogView&&this.dialogView.close()}});var FeedTmpl=function(){return{showTimeTmplFun:showTimeTmplFun,postSourceTmplFun:postSourceTmplFun,getShortString:getShortString,encodeScript:encodeScript,decodeScript:decodeScript,fileNameTmplFun:fileNameTmplFun,setSourceContFun:setSourceContFun,dealContent:dealContent,typeUrl:typeUrl,typeName:typeName,setSourceTypeContFun:setSourceTypeContFun,typeIco:typeIco};function typeName(feedType,taskType){var typeName="",type=taskType||"",i18n=Context.getI18n();if(feedType==20){typeName=i18n["task_1"];switch(type){case 5:{typeName="客户支持"}break;case 6:{typeName="任务"}break;case 7:{typeName="任务"}break;case 8:{typeName="任务"}break;case 16:{typeName="任务"}break;case 17:{typeName="任务"}break;case 19:{typeName="审批"}break;case 21:{typeName="任务"}break;case 22:{typeName="任务"}break}}return typeName}function typeUrl(type,data){var url=data["url"];var webHost=Context.isAbsolutePath();switch(type){case 1:{url=webHost.webHost+"#more/shareinfo?id="+data["feedId"]}break}return url}function dealContent(content){if(!content)return content;var pat=/[^\x00-\xff]/g;var content=content||"";if(content&&content!=""){content=content.replace(/(&apos;)/g,"'").replace(/(!%nr%!)/g,"<br/>").replace(/[\r\n]/g,"<br/>")}var arr=content.split("<br/>")||[];var len=0;var max=500;var subString_content="",contentMax=false;return{contentMax:contentMax,content:content,subStringContent:content}}function showTimeTmplFun(ShowType,StartDate,Deadline,RemainDay,DeadLineDay){var type=ShowType;var year=moment().year();var startDate=Context.formatDate(StartDate),deadline=Context.formatDate(Deadline);switch(type){case 0:{return""}break;case 2:{return startDate+" - "+deadline}break;case 3:{return"剩余 "+RemainDay+" 天"}break;case 4:{if(RemainDay==1){var deadLine=Deadline.split(" ")[1]||Deadline;return"今天 "+deadLine+" 截止"}else{return Deadline}}break;case 5:{if(DeadLineDay==0){return'<span class="date-error_ftb">已过期</span>'}else{return'<span class="date-error_ftb">已过期 '+DeadLineDay+" 天</span>"}}break}}function getShortString(name,total){var newStr=[];var len=0;var name=decodeScript(name);for(var i=0;i<name.length;i++){var c=name.charAt(i);newStr.push(c);var code=escape(c);if(code.length>=4&&(code<"%uFF60"||code>"%uFF9F")){len+=2}else{len++}if(len>=total){break}}newStr=encodeScript(newStr.join(""));if(newStr!=name){return newStr+"..."}return newStr}function postSourceTmplFun(PostSource){var from=PostSource;var value="";switch(from){case 0:{value=""}break;case 1:{value="来自 Android App"}break;case 2:{value="来自 iOS App"}break;case 3:{value="来自 Windows Phone App"}break;case 4:{value="来自 移动Web"}break;case 5:{value="来自 移动App"}break;case 6:{value="来自 Android Web"}break;case 7:{value="来自 iOS Web"}break;case 8:{value="Windows Phone Web"}break;default:{value="来自 "+PostSource}}if(value.length>15){value=value.substring(0,15)+"..."}return value}function encodeScript(Content){if(Content.length==0)return"";s=Content.replace(/</g,"&lt;");s=s.replace(/>/g,"&gt;");s=s.replace(/ /g,"&nbsp;");return s}function decodeScript(Content){if(Content.length==0)return"";s=Content.replace(/&apos;/g,"'");s=s.replace(/&quot;/g,'"');s=s.replace(/&amp;/g,"&");s=s.replace(/!%nr%!/g,"<br/>");return s}function fileNameTmplFun(FileName){fileName=FileName.replace(/\.none$/,"");return fileName}function isImage(type){var img=false;var imgTypes=Context.getAttachmentType().image;for(var i=0;i<imgTypes.length;i++){if(type==imgTypes[i]){img=true;break}}return img}function setSourceContFun(feedType,type,obj,app){var text="";var i18n=Context.getI18n();switch(obj["objType"]){case 3:{text="团队中"}break;case 4:{text=(obj.objSubType==6?"目标":i18n["work_1"])+"中";if(app){if(app["appId"]==203){text="职位中"}else{text="中"}}}break;case 15:{text="部门中"}break}if(feedType==20){if(type==6||type==7||type==8||type==16||type==21||type==22){text="职位中"}}if(feedType==6){if(app){if(app["appId"]==203&&obj&&obj["objSubType"]==3){text="在"}else{text="中"}}}return text}function setSourceTypeContFun(feedType,type,appId,isPlan){var text="";var i18n=Context.getI18n();switch(feedType){case 1:{text="说："}break;case 20:{if(type==19){text="发起的申请"}else{text="发起的"+i18n["task_1"]}}break;case 4:{text="的"+i18n["plan_1"]}break;case 5:{text="的日报";if(type==26){text="的周报"}if(type==27){text="的月报"}}break;case 6:{if(appId==203){text="创建的职位"}if(appId==1){text=""}}break;case 10:{text=""}break;case 7:{text="的考核"}break;case 9:{text="的审批"}break;case 12:{text="推荐了侯选人"}break;case 80:{text="的签到"}break}return text}function typeIco(feedType,appId,workType){var obj={};if(feedType==6){switch(appId){case 203:{obj["text"]="职位"}break;case 1:{obj["text"]=workType==6?"目标":"项目"}break}}if(feedType==10){obj["text"]=workType==6?"目标":"项目"}return obj}}();var feedActionMore=Talent.ItemView.extend({defaults:{id:"",detail:true,deleted:true,setTop:true,detailUrl:"javascript:void(0);"},className:"more-feedbox",template:jst["feed/feed-action-more"],ui:{detail:"li[data-name=feed-action-detail]",deleted:"li[data-name=feed-action-del]",top:"li[data-name=feed-action-top]"},events:function(){var events={};events["click "+this.ui.detail]="_detailHandler";events["click "+this.ui.deleted]="_deleteHandler";events["click "+this.ui.top]="_topHandler";return events},modelEvents:{"change:isTop":"render","change:setTop":"render","change:detailUrl":"render"},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);this.id=this.settings["id"];this.model.set(this.settings);Talent.$(document).off("click.Feed-Action-More-View");Talent.$(document).on("click.Feed-Action-More-View",function(){Talent._.animate(self.$el,"fadeOutUp",1,"",function(){self.$el.hide()})});this.$el.on("click",function(event){event.stopPropagation()});if(typeof this.model.get("isTop")=="undefined"){this.model.set("isTop",false);this.settings["setTop"]=false}var userInfo=Context.getUserInfo();this.hasAppend=false;this.webHost=Context.isAbsolutePath()},show:function(node){if(!this.hasAppend){this.hasAppend=true;this.$el.html(this.template(this.model.toJSON())).appendTo("body")}var off=node.offset(),w=this.$el.outerWidth(),nodeH=node.outerHeight(),nodeW=node.outerWidth();this.$el.css({left:off.left-w+nodeW,top:off.top+nodeH+5,position:"absolute"}).show();var self=this;Talent._.animate(this.$el,"fadeInDown",1)},hide:function(){this.$el.hide()},setOptions:function(setOptions){this.settings=Talent._.extend({},this.settings,setOptions);this.id=this.settings["id"];this.model.set(setOptions,{silent:true});this.render()},_selfHandler:function(event){event.stopPropagation()},_detailHandler:function(event){var node=Talent.$(event.currentTarget);this.trigger("detail_"+this.id,node);this.hide();Talent._.actionAnalysis("[feed-detail-click]",this.model.get("feedId"))},_deleteHandler:function(event){var node=Talent.$(event.currentTarget);this.trigger("delete_"+this.id,node,this.model.toJSON())},_topHandler:function(event){var self=this;var node=Talent.$(event.currentTarget);var isTop=this.model.get("isTop");this.trigger("top_"+this.id,node,{isTop:!isTop});this.hide()},onClose:function(){Talent.$(document).off("click.Feed-Action-More-View")}});function FeedActionMoreView(options){if(!feedActionMore.instance){feedActionMore.instance=new feedActionMore(options)}else{feedActionMore.instance.setOptions(options)}return feedActionMore.instance}var FeedAttachmentItemView=Talent.ItemView.extend({tagName:"li",template:jst["feed/feed-attachment-item"],className:"item_afb",templateHelpers:function(){var fileName=this.model.get("fileName");var fileType=this.model.get("fileType").toLowerCase();var documentSource=this.model.get("documentSource");var imageUrl=this.model.get("imageUrl");var isImage=this.model.get("isImage");var iconColor="";if(!imageUrl){if(documentSource&&documentSource==3)isImage=false}if(/^(jpg|png|gif|jpeg)$/.test(fileType)){fileType=fileType;iconColor="#44CF85"}else{if(/^(exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(fileType)){fileType=fileType;iconColor="#49B9DD"}else if(/^(rar|zip)$/.test(fileType)){fileType=fileType;iconColor="#FFBA46"}else if(/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(fileType)){fileType=fileType;iconColor="#8479D6"}else if(/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(fileType)){fileType=fileType;iconColor="#3EBBA8"}else{fileType="none";iconColor="#FF730C"}}return{fileName:Talent._.substringWithM(fileName,14,true),fileFullName:fileName,fileType:fileType,webHost:Context.isAbsolutePath(),deleteable:false,documentSource:documentSource,isImage:isImage,iconColor:iconColor}}});var FeedAttachmentListView=Talent.CompositeView.extend({defaults:{quirkLink:false},className:"attachment_fb_big tu-clearfix",template:Talent._.template("<ul/>"),itemView:FeedAttachmentItemView,itemViewContainer:"ul",ui:{deleted:"a[data-name=attachment-deleted]",preview:"a[data-name=feed-attachment-preview]",fileName:"[data-name=name_up]",imgPrev:"[data-name=feed-attachment-img]",download:"a[data-name = attachment-download]",tipInfo:"[data-toggle=infotip]",previewOther:"[data-name=feed-attachment-preview-other]"},collectionEvents:{reset:"_dealData"},_dealData:function(){var self=this;this.collection.each(function(model){var imgTypes=Context.getAttachmentType().image;var type=model.get("fileType").toLowerCase();var previewUrl=model.get("previewUrl");var documentSource=model.get("documentSource");model.set("isImage",false);model.set("documentSource",documentSource);for(var i=0;i<imgTypes.length;i++){if(type==imgTypes[i]){model.set("isImage",true);var index=previewUrl.lastIndexOf(".");if(index>0){var bigUrl=previewUrl.substr(0,index)+"_b."+previewUrl.substr(index+1),smallUrl=previewUrl.substr(0,index)+"_s."+previewUrl.substr(index+1);if(type=="gif"){smallUrl=previewUrl}model.set("bigUrl",bigUrl);model.set("smallUrl",smallUrl)}if(documentSource==3){model.set("isImage",false)}break}}if(previewUrl!=null&&previewUrl!=""){model.set("isPreview",true)}else{model.set("isPreview",false)}})},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);this._dealData()},events:function(){var events={};events["click "+this.ui.deleted]="_deletedHandler";events["click "+this.ui.preview]="_renderImgPreviewView";events["click "+this.ui.fileName]="_renderImgPreviewView";events["click "+this.ui.imgPrev]="_renderImgPreviewView";events["mouseenter "+this.ui.tipInfo]="_mouseenterFileName";return events},_mouseenterFileName:function(ev){var node=$(ev.currentTarget);var title=node.data("body");this.tipView&&this.tipView.destroy();this.tipView=new Infotip;this.tipView.bindNode(node,{container:this.$el,type:"default",body:title});this.tipView.show()},_deletedHandler:function(event){var node=Talent.$(event.currentTarget);var id=node.attr("id");var collection=this.collection.toJSON();var new_data=[];Talent._.each(collection,function(item){if(item["documentId"]!==id){new_data.push(item)}});this.collection.reset(new_data);this.trigger("deleted")},_renderImgPreviewView:function(event){if(this.settings.quirkLink)return;event.stopPropagation();event.preventDefault();var node=Talent.$(event.currentTarget),dataName=node.attr("data-name");var allNode=this.$("[data-name="+dataName+"]");var index=allNode.index(node);var data=Talent._.where(this.collection.toJSON(),{isImage:true,documentSource:1})||[];if(!data.length)return;if(index<0)return;if(window.top!==window.self){var data={collection:data,index:index};var host="//"+location.host+"/widget#sdk/img-preview";window.iTalentSDK&&window.iTalentSDK.showPopup(host,920,520,data);return}this.imgPreviewView&&this.imgPreviewView.close();this.imgPreviewView=new ImgPreviewView({collection:new Talent.Collection(data),index:index});this.$el.append(this.imgPreviewView.render().el)},_renderImgPreEl:function(){}});var FeedCommentItemView=Talent.ItemView.extend({defaults:{feedType:"",quirkLink:false},className:"comment_item_box",template:jst["feed/feed-comment-item"],ui:{lock:"span[data-name=feed-comment-lock]",slide:'a[data-name="comment-content-slide"]',attachment:"div[data-name=feed-comment-attachment]",rewardGive:"[data-name=feed-reward-give]"},templateHelpers:function(){var content=this.model.get("content"),commentType=this.model.get("commentType");if(commentType==9){content='<span class="dashang_ico"></span>'+content}return{webHost:Context.isAbsolutePath(),content:FeedTmpl.decodeScript(content),inFrame:window.top==window.self?false:true,userUrl:Context.getUserUrl()}},modelEvents:{"change:toggleContent":"render"},events:function(){var events={};events["click "+this.ui.slide]="_slideMoreContentHandler";events["click "+this.ui.rewardGive]="_clickRewardGiveHandler";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options)},onRender:function(){this._lockTipsy();this._renderAttachmentListView();this.ui.slide.remove()},_clickRewardGiveHandler:function(event){var node=Talent.$(event.currentTarget);if(window.top==window.self&&this.settings.feedType&&this.settings.feedType!=""){this.trigger("rewardGive",node,this.model.toJSON())}},_renderAttachmentListView:function(){this.attachmentCollection=new Talent.Collection(this.model.get("attachments")||[]);

if(!this.attachmentCollection.length)return;if(!this.feedAttachmentListView){this.feedAttachmentListView=new FeedAttachmentListView({collection:this.attachmentCollection,quirkLink:this.settings.quirkLink});this.ui.attachment.html(this.feedAttachmentListView.render().$el)}},_slideMoreContentHandler:function(){if(!this.model.get("contentShowAll")){this.model.set("contentShowAll",true);this.model.set("toggleContent",this.originContent)}else{this.model.set("contentShowAll",false);this.model.set("toggleContent",this.subStringContent)}},_lockTipsy:function(){if(!this.ui.lock)return;if(this.hasBindTipsy)return;this.hasBindTipsy=true;var self=this;var tipText=this.model.get("privateTipText");this.ui.lock.tipsy({title:function(){return tipText},gravity:"s"})}});var FeedCommentListView=Talent.CompositeView.extend({defaults:{isPrivate:false,privateTipText:"所有可见",actionMore:{detail:true,deleted:true,setTop:false},defaultCount:4,feedId:"",sort:"append",feedType:"",quirkLink:false},className:"comment_list_fb",template:jst["feed/feed-comment-list"],itemViewContainer:"div[data-name=comment-list]",itemView:FeedCommentItemView,ui:{reply:"a[data-name=feed-comment-reply]",total:"div[data-name=feed-comment-total]",totalNum:"span[data-name=feed-comment-total-num]",deleted:"a[data-name=feed-comment-deleted]",deHua:"span[data-name=feed-dehua]",commentList:"div[data-name=comment-list]",totalIco:"b[data-name=feed-comment-total-ico]"},modelEvents:{"change:total":"_changeTotalHandler"},events:function(){var events={};events["click "+this.ui.reply]="_replyHandler";events["click "+this.ui.total]="_toggleMoreHandler";events["click "+this.ui.deleted]="_deletedHandler";events["mouseenter "+this.ui.deHua]="_overDehuaHandler";events["mouseleave "+this.ui.deHua]="_leaveDeHuaHandler";return events},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);if(this.options["actionMore"]){this.settings["actionMore"]=Talent._.extend({},this.defaults["actionMore"],this.options["actionMore"])}this.slideStatus=false;this.overDeHua=false;this.childViews={};this.on("itemview:rewardGive",function(itemView,node){self.trigger("rewardGive",node,itemView.model.toJSON())})},onRender:function(){if(this.model.get("total")==this.collection.length){this.ui.total.remove()}if(this.model.get("total")<this.settings["defaultCount"]+1){this.ui.total.remove()}if(this.settings.quirkLink){this.$el.find(".atsrc_fed").each(function(idx,node){Talent.$(node).attr("target","_blank")})}},onBeforeItemAdded:function(itemView){var id=itemView.model.get("commentId");this.childViews[id]=itemView;var _private=typeof this.model.get("isPrivate")!="undefined"?this.model.get("isPrivate"):this.settings["isPrivate"];var privateTipText=this.model.get("privateTipText")?this.model.get("privateTipText"):this.settings["privateTipText"];itemView.model.set({isPrivate:_private,privateTipText:privateTipText})},addNewItemComment:function(Model){var options=this.itemViewOptions()||{};var feedItemView=this.buildItemView(Model,this.itemView,options);this.collection.add([Model],{silent:true});feedItemView.render();if(this.settings.quirkLink){feedItemView.$el.find(".atsrc_fed").each(function(idx,node){Talent.$(node).attr("target","_blank")})}return feedItemView.$el},itemViewOptions:function(){return{feedType:this.settings.feedType,quirkLink:this.settings.quirkLink}},_overDehuaHandler:function(event){var node=Talent.$(event.currentTarget),self=this;var parentId=node.attr("data-parent-id");this.overDeHua=true;this._requestDehua(node,parentId)},_requestDehua:function(node,parentId){var node=node,self=this;var parentId=parentId;if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual",html:true})}if(node.attr("original-title")){if(this.overDeHua)node.tipsy("show")}else{CommentV2.getCommentGetByIds({comment_id:parentId}).done(function(resp){if(self.isClosed)return;if(!resp||!resp["content"]){node.attr("original-title","内容已删除");if(self.overDeHua)node.tipsy("show");return}var content='<div style="text-align:left">'+Context.dencodeScript(resp["content"])+"</div>";node.attr("original-title",content);if(self.overDeHua)node.tipsy("show")})}},_leaveDeHuaHandler:function(event){this.overDeHua=false;var node=Talent.$(event.currentTarget);node.tipsy("hide")},_replyHandler:function(event){event.stopPropagation();this.feedActionMoreView&&this.feedActionMoreView.hide();var node=Talent.$(event.currentTarget),id=node.attr("id");var model=this.collection.get(id).toJSON();this.trigger("reply",model);Talent._.actionAnalysis("[feed-reply-reply]",model.commentId)},_toggleMoreHandler:function(event){var node=Talent.$(event.currentTarget);var slide=this.ui.totalIco;if(!this.slideStatus){this.slideStatus=true;slide.addClass("tu-icon-angles-up").removeClass("tu-icon-angles-down")}else{var collection=this.collection.toJSON();var len=collection.length;this.collection.reset(collection.slice(len-this.settings.defaultCount,len));this.slideStatus=false;slide.removeClass("tu-icon-angles-up").addClass("tu-icon-angles-down")}if(this.slideStatus){this.trigger("more",node)}},_deletedHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var id=node.attr("id");var itemModel=this.childViews[id],viewNode=itemModel.$el;var self=this;TipInfoView(node,{type:"confirm",body:"此操作不可恢复，您确定删除吗？",align:"right",container:viewNode,okHide:function(){Talent._.animate(node,"bounceOut",3,"",function(){viewNode.slideUp()});self._deleteCalll();self.trigger("deleted",node,{commentId:id,total:self.model.get("total"),data:itemModel.model.toJSON()})}})},_deleteCalll:function(){var commentTotal=this.model.get("total")-1;this.model.set("total",commentTotal)},_changeTotalHandler:function(){var commentTotal=this.model.get("total");this.ui.totalNum.html(commentTotal)},appendHtml:function(collectionView,itemView,index){if(this.settings["sort"]=="prepend"){this.ui.commentList.prepend(itemView.el)}else{this.ui.commentList.append(itemView.el)}}});var FeedTrackView=Talent.CompositeView.extend({defaults:{defaultCount:4},template:jst["feed/feed-track"],ui:{slide:"div[data-name=task-track-slide]"},modelEvents:{"change:comments":"render"},events:function(){var events={};events["click "+this.ui.slide]="_slideMoreHandler";return events},templateHelpers:function(){var isLatest=this.model.get("isLatest");return{defaultCount:this.settings["defaultCount"],content:this.model.get("content"),isLatest:typeof isLatest!="undefined"?isLatest:false,comments:this._dealData()}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);this.model.set("taskTrackShowAll",false)},_dealData:function(data){var comments=this.model.get("comments")||[],tag=0,day="",thisYeare=moment().year();var new_data=[];var new_year=null;var new_year_data=[];var tag_month=null;for(var i=0;i<comments.length;i++){var item=comments[i];var mCreatDate=moment(item["createDate"],"YYYY/MM/DD HH:mm"),f_year=mCreatDate.format("YYYY"),f_month=mCreatDate.format("MM/DD"),f_time=mCreatDate.format("HH:mm");item["f_year"]=i==0&&f_year==thisYeare?f_year:mCreatDate.format("YYYY/MM/DD");item["f_time"]=f_time;if(f_year!==new_year){tag_month=f_month;item["f_month"]=f_month;new_year=f_year;new_year_data=[];new_year_data.push(item);new_data.push({year:new_year,data:new_year_data,thisYeare:f_year==thisYeare?true:false})}else{if(tag_month==f_month){item["f_month"]=null}else{tag_month=f_month;item["f_month"]=f_month}new_year_data.push(item)}}return new_data},_slideMoreHandler:function(event){event.stopPropagation();var taskTrackShowAll=this.model.get("taskTrackShowAll");if(taskTrackShowAll){var data=this.model.get("comments"),defaultCount=this.settings["defaultCount"],len=data.length;this.model.set("taskTrackShowAll",false);this.model.set("comments",data.slice(len-defaultCount,len))}else{this.model.set("taskTrackShowAll",true);this.trigger("showAll")}}});var FeedDailyOverviewView=Talent.Layout.extend({defaults:{quirkLink:false},template:jst["feed/feed-daily-overview"],events:function(){var events={};events["click "+this.ui.viewMore]="_viewMoreClickHandler";return events},ui:{viewMore:"[data-name=show-detial]"},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options)},onClose:function(){},templateHelpers:function(){var reportNameMapping={8:"日",26:"周",27:"月"};return{reportName:reportNameMapping[this.model.get("reportType")],webHost:Context.isAbsolutePath()}},_viewMoreClickHandler:function(event){if(this.settings.quirkLink)return;event.stopPropagation();event.preventDefault();Talent.app.vent.trigger("global-daily-detail-pull-screen",this.model.get("dailyId"))}});var FeedDailyView=Talent.Layout.extend({defaults:{quirkLink:false},className:"daily_feed_fb",template:jst["feed/feed-daily"],regions:{content:"dd[data-name=feed-daily-content]"},events:function(){var events={};events["click "+this.ui.dailyName]="_dailyNameClickHandler";return events},ui:{dailyName:"[data-name=daily-name]"},templateHelpers:function(){var evaluation=this.model.get("evaluation"),evaluationHtml="";if(evaluation){evaluationHtml='<div class="grade evaluation_remark">'+Talent._.TitaWidget_evaluation(evaluation)+"&nbsp;&nbsp;"+evaluation.remark+"</div>"}var type={8:"日报",26:"周报",27:"月报"},reportType=this.model.get("reportType"),submitType={1:"按时提交",2:"逾期提交"},submitState=this.model.get("submitState"),reportTypeIcon={8:"calendar-daily",26:"calendar-weekly",27:"calendar-monthly"};return{evaluation:evaluationHtml,dailyType:type[reportType],dailySubmit:{content:submitType[submitState],type:submitState},reportTypeIcon:reportTypeIcon[reportType],webHost:Context.isAbsolutePath()}},modelEvents:{},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)},onShow:function(){this._feedDailyOverviewView()},_dailyNameClickHandler:function(event){if(this.settings.quirkLink)return;event.stopPropagation();event.preventDefault();Talent.app.vent.trigger("global-daily-detail-pull-screen",this.model.get("dailyId"))},_feedDailyOverviewView:function(){if(!this.feedDailyOverviewView){this.feedDailyOverviewView=new FeedDailyOverviewView({model:this.model,quirkLink:this.settings.quirkLink});this.$el.append(this.feedDailyOverviewView.render().el)}},onClose:function(){}});var FeedActionView=Talent.ItemView.extend({defaults:{isShowPraise:false,isShowReply:true,isShowCollect:true,isShowReward:true,isShowAddTag:true},className:"action_wrap_fb clearfix",template:jst["feed/feed-action"],ui:{reply:'li[data-name="feed-action-reply"]',collect:'li[data-name="feed-action-collect"]',praise:'li[data-name="feed-action-praise"]',beg:'li[data-name="feed-action-beg"]',reward:'li[data-name="feed-action-reward"]',tag:'li[data-name="feed-action-tag"]'},events:function(){var events={};events["click "+this.ui.reply]="_replyHandler";events["click "+this.ui.collect]="_collectHandler";events["click "+this.ui.praise]="_praiseHandler";events["click "+this.ui.beg]="_rewardBegHandler";events["click "+this.ui.reward]="_rewardGiveHandler";events["click "+this.ui.tag]="_tagClickHandler";return events},templateHelpers:function(){var isOpenReward=util_rewardOpen();var userType=this.userInfo.UserType;if(!this.settings.isShowReward){isOpenReward=false}return{isShowPraise:userType==2?false:this.settings["isShowPraise"],isShowReply:this.settings["isShowReply"],isShowCollect:userType==2?false:this.settings["isShowCollect"],isShowTaoShang:false,isShowDaShang:isOpenReward,isShowAddTag:userType==2?false:this.settings["isShowAddTag"],postSource:FeedTmpl.postSourceTmplFun(this.model.get("postSource"))}},modelEvents:{"change:isPraise":"render","change:isCollect":"render"},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.userInfo=Context.getUserInfo();if(typeof this.model.get("isPraise")=="undefined"){this.model.set("isPraise",false)}if(typeof this.model.get("isCollect")=="undefined"){this.model.set("isCollect",false)}},_replyHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.trigger("reply",node,{feedId:this.model.get("feedId")});Talent._.actionAnalysis("[feed-reply-click]",this.model.get("feedId"))},_collectHandler:function(event){var node=Talent.$(event.currentTarget);var isCollect=this.model.get("isCollect");this.trigger("collect",node,{feedId:this.model.get("feedId"),isCollect:!isCollect});var collectLabel=isCollect?"cancle-collect":"collect";Talent._.actionAnalysis("[feed-"+collectLabel+"-click]",this.model.get("feedId"))},_praiseHandler:function(event){var node=Talent.$(event.currentTarget);var isPraise=this.model.get("isPraise");this.model.set("isPraise",!isPraise);this.trigger("praise",node,{feedId:this.model.get("feedId")})},_rewardBegHandler:function(event){this.trigger("rewardBeg",this.model.toJSON());Talent._.actionAnalysis("[feed-beg-click]",this.model.get("feedId"),1)},_rewardGiveHandler:function(event){event.preventDefault();this.trigger("rewardGive",this.model.toJSON());Talent._.actionAnalysis("[feed-reward-click]",this.model.get("feedId"),1)},_tagClickHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget);this.trigger("addTag",node);Talent._.actionAnalysis("[feed-tag-click]",this.model.get("feedId"))}});var FeedItemSourceView=Talent.ItemView.extend({defaults:{isInAppPage:false},template:jst["feed/feed-item-source"],ui:{dashangIco:"[data-name=dashang-ico]"},modelEvents:{"change:isTop":"render"},templateHelpers:function(){var obj=this.model.get("obj")||{},feedType=this.model.get("feedType");app=this.model.get("app"),appId=app&&app["appId"]?app["appId"]:1,isPlan=this.model.get("isPlan")||false,type=0;var sourceCont="";if(feedType==20){type=this.model.get("taskType")}if(feedType==5){type=this.model.get("reportType")}if(feedType==6){type=obj["objSubType"]||0}sourceCont=FeedTmpl.setSourceContFun(feedType,type,obj,app);if(obj&&obj.objType==4&&app&&app.appObj&&app.appObj.appObjUrl!=""){obj["objUrl"]=app.appObj.appObjUrl}return{isInAppPage:this.settings["isInAppPage"],sourceCont:sourceCont,userUrl:Context.getUserUrl(),sourceTypeCont:FeedTmpl.setSourceTypeContFun(feedType,type,appId,isPlan),obj:obj,workType:this.model.get("workType")||this.model.get("obj")&&this.model.get("obj").objSubType}},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)},onRender:function(){this.ui.dashangIco.tipsy({gravity:"s"})}});var FeedLeftView=Talent.ItemView.extend({defaults:{isInAppPage:false},className:"avatar_wrapper",template:jst["feed/feed-left"],templateHelpers:function(){var isInAppPage=this.settings["isInAppPage"],feedType=this.model.get("feedType"),app=this.model.get("app");var src="//st-web.tita.com/ux/tita-web-v4/release/app/images/app/logo-906.png";if(app&&app.appLogo&&app.appLogo==""){app.appLogo=src}return{isInAppPage:isInAppPage,app:app,workType:this.model.get("workType")||this.model.get("obj")&&this.model.get("obj").objSubType}},ui:{tag:".avatar_tag"},events:function(){var events={};events["mouseenter "+this.ui.tag]="_tipShowHandler";events["mouseleave "+this.ui.tag]="_tipHideHandler";return events},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)},_tipShowHandler:function(event){this.overTipTrue=true;var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual",offset:"40"})}if(this.overTipTrue){node.tipsy("show")}},_tipHideHandler:function(event){this.overTipTrue=false;var node=Talent.$(event.currentTarget);node.tipsy("hide")}});var FeedMainView=Talent.Layout.extend({defaults:{actionMore:{detail:true,deleted:true,setTop:true},isInAppPage:false},className:"main_fb",template:jst["feed/feed-main"],regions:{infoSource:"div[data-name=feed-source]"},templateHelpers:function(){var feedType=this.model.get("feedType");var setRemindType=0;if(feedType==1){setRemindType=10}if(feedType==20){setRemindType=7}if(feedType==5){setRemindType=8}var isShowSlideMore=true,app=this.model.get("app");if(feedType==80){feedType=true}if(feedType==20&&app&&app.appId=="203"){isShowSlideMore=false}if(feedType==6){isShowSlideMore=false}if(feedType==5){isShowSlideMore=false}return{setRemindType:setRemindType,isShowSlideMore:isShowSlideMore}},ui:{lock:"span[data-name=feed-lock]",remind:"span[data-name=feed-remind]",slideMore:"span[data-name=feed-action-slide]",topAction:"div[data-name=feed-top-action]",action:"div[data-name=feed-actoin]",userMark:"img[data-name=feed-user-mark]"},events:function(){var events={};events["click "+this.ui.slideMore]="_slideMoreHandler";events["mouseenter "+this.ui.remind]="_tipShowHandler";events["mouseleave "+this.ui.remind]="_tipHideHandler";events["mouseenter "+this.ui.userMark]="_tipShowHandler";events["mouseleave "+this.ui.userMark]="_tipHideHandler";events["mouseenter "+this.ui.lock]="_tipShowHandler";events["mouseleave "+this.ui.lock]="_tipHideHandler";return events},initialize:function(options){var userInfo=Context.getUserInfo();this.settings=Talent._.extend({},this.defaults,this.options);this.webHost=Context.isAbsolutePath();this.manageAuthority=userInfo.IsTitaFeedSystemManager||userInfo.IsUpaasManager;var actionMoreOpt=this.settings.actionMore;actionMoreOpt["detailUrl"]=FeedTmpl.typeUrl(this.model.get("feedType"),this.model.toJSON());if(!actionMoreOpt["detailUrl"]){actionMoreOpt["detail"]=false}if(typeof this.model.get("isTop")=="undefined"){this.model.set("isTop",false)}},onRender:function(){this._renderFeedItemSourceView();this._customizeActionMore();var actionMore=this.settings["actionMore"];if(!actionMore["detail"]&&!actionMore["deleted"]&&!actionMore["setTop"]){this.ui.slideMore.remove()}if(actionMore["detail"]==false&&this.model.get("editTopAble")==false&&this.model.get("isEdit")==false){this.ui.slideMore.remove()}},_customizeActionMore:function(){var feedType=this.model.get("feedType");var actionMore=this.settings["actionMore"];actionMore["setTop"]=this.model.get("editTopAble")||feedType==1&&this.manageAuthority;actionMore["deleted"]=this.model.get("isEdit")||feedType==1&&this.manageAuthority;actionMore["isTop"]=this.model.get("isTop");return actionMore},_renderFeedItemSourceView:function(){var feedItemSourceView=new FeedItemSourceView({model:this.model,isInAppPage:this.settings["isInAppPage"]});this.infoSource.show(feedItemSourceView)},_slideMoreHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var self=this,feedType=this.model.get("feedType");this.feedId=this.model.get("feedId");var options=Talent._.extend({},{model:this.model},this.settings.actionMore);options["id"]=this.feedId;options["setTop"]=this.model.get("editTopAble");options["deleted"]=this.model.get("isEdit");if(this.settings.actionMore["setTop"]==false){options["setTop"]=false}if(this.settings.actionMore["detail"]==false){options["detail"]=false}if(this.settings.actionMore["deleted"]==false){options["deleted"]=false}if(feedType==9){actionMoreOpt["detail"]=false}options=Talent._.extend({},options,this._customizeActionMore());this.feedActionMoreView=new FeedActionMoreView(options);this.stopListening(this.feedActionMoreView,"detail_"+this.feedId);this.listenTo(this.feedActionMoreView,"detail_"+this.feedId,function(){});this.stopListening(this.feedActionMoreView,"delete_"+this.feedId);this.listenTo(this.feedActionMoreView,"delete_"+this.feedId,function(){self.feedActionMoreView.hide();var id=self.feedId;ConfirmDialogView(node,"此操作不可恢复，您确定删除吗？",{pos:"left",container:this.$el,leftBias:21,sure:function(){self.trigger("deleted")}})},this);this.stopListening(this.feedActionMoreView,"top_"+this.feedId);this.listenTo(this.feedActionMoreView,"top_"+this.feedId,function(topNode,options){this.trigger("top",node,options)},this);this.feedActionMoreView.show(node)},_tipShowHandler:function(event){var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual"})}node.tipsy("show")},_tipHideHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);node.tipsy("hide")}});var FeedStepView=Talent.ItemView.extend({defatuls:{step:[]},className:"feedstep_fb clearfix",template:jst["feed/feed-step"],templateHelpers:function(){var step=eval("("+this.settings.step+")");var activeIndex=0,data=[],status=step[step.length-1].status==1?2:1;for(var i=0;i<step.length;i++){if(step.length>4&&activeIndex>2&&i>activeIndex+2){break}var item=step[i];if(typeof item["tag"]==="undefined"){item["tag"]=0}if(item.status==1){item.className="complete";var prev=step[i-1];if(prev&&prev.status==3){step[i-1].className="skip-a"}}if(item.status==2){var prev=step[i-1];item.className="active";if(prev&&prev.status==1){step[i-1].className="unfinished"}activeIndex=i}if(item.status==3){var prev=step[i-1];if(prev&&prev.status==1){item.className="skip-b";prev.className="skip-b-prev"}}if(item.tag==1){status=3;activeIndex=i}}if(step.length<=4){data=step}else{if(activeIndex<3&&status!=2){data=step.slice(0,4)}else{var end=activeIndex+2;var start=activeIndex-2;if(start<0)start=0;if(end>step.length){end=step.length;start=end-4}if(status==2){end=step.length;start=end-4}data=step.slice(start,end)}}if(status==3){Talent._.each(data,function(item){item.className="cancel"})}return{step:data,total:step.length,status:status,activeIndex:activeIndex}},initialize:function(options){this.settings=Talent._.extend({},this.defatuls,this.options)}});var FeedPlanView=Talent.ItemView.extend({className:"simpletask_fb",template:jst["feed/feed-plan"],initialize:function(options){}});var FeedPraiseView=Talent.ItemView.extend({className:"praise_fb",template:jst["feed/feed-praise"],modelEvents:{"change:total":"render"},ui:{praise:'span[data-name="feed-praise-praise"]',allUser:"span[data-name=feed-praise-all]"},events:function(){var events={};events["click "+this.ui.praise]="_praiseHandler";events["mouseenter "+this.ui.allUser]="_requestAllUser";events["mouseleave "+this.ui.allUser]="_tipHideHandler";return events},initialize:function(options){},_praiseHandler:function(event){var node=Talent.$(event.currentTarget);var isPraise=this.model.get("isPraise");this.model.set("isPraise",!isPraise);this.trigger("praise",node,{feedId:this.model.get("FeedId")})},_requestAllUser:function(event){var self=this;var total=this.model.get("total"),text=null;this.collection=this.model.get("praisesList");if(this.collection.length!=total){Talent.app.request("FeedV2:getPraiseAlluser",{}).done(function(resp){if(self.isClosed)return;self.collection=self.collection.concat(resp||[]);text=Talent._.pluck(self.collection,"name").join("，");self._tipShowHandler(event,text)})}else{text=Talent._.pluck(this.collection,"name").join("，");this._tipShowHandler(event,text)}},_tipShowHandler:function(event,text){var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual",title:function(){return text}})}node.tipsy("show")},_tipHideHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);node.tipsy("hide")}});var FeedShareView=Talent.ItemView.extend({defauts:{isShowIco:true},className:"dynamic_fed",template:jst["feed/feed-share"],ui:{slide:'a[data-name="content-slide"]',goTm:"a[data-tm]"},events:function(){var events={};events["click "+this.ui.slide]="_slideMoreContentHandler";events["click "+this.ui.goTm]="_goTmHandler";return events},templateHelpers:function(){return{isShowIco:this.settings["isShowIco"]}},modelEvents:{"change:content":"render"},onRender:function(){this.ui.slide.remove()},onShow:function(){var IsUserManager=Context.getGlobal("loginUserInfo").IsUserManager,tmUrl=Context.getGlobal("tm");if(!IsUserManager||!tmUrl){this.$el.find("a[data-tm]").css({color:"#333333",cursor:"text"})}},initialize:function(){this.settings=Talent._.extend({},this.defauts,this.options["options"]);var content=this.model.get("content");this.dealContent=FeedTmpl.dealContent(content);this.originContent=this.dealContent["content"];this.subStringContent=this.dealContent["subStringContent"];this.model.set("contentShowAll",false);this.model.set({content:this.dealContent["subStringContent"],contentMax:this.dealContent["contentMax"]})},_slideMoreContentHandler:function(){if(!this.model.get("contentShowAll")){this.model.set("contentShowAll",true);this.model.set("content",this.originContent)}else{this.model.set("contentShowAll",false);this.model.set("content",this.subStringContent)}},_goTmHandler:function(ev){if(window.top!==window.self){return}var node=Talent.$(ev.currentTarget),data=node.data(),userInfo=Context.getGlobal("loginUserInfo"),IsUserManager=userInfo.IsUserManager,tmUrl=Context.skipToTmHome("employee")||"";if(IsUserManager&&data["tm"]&&tmUrl){window.open(tmUrl)}}});var FeedSigninTrackView=Talent.ItemView.extend({defaults:{defaultCount:4},className:"signintrack_sfb",tagName:"ul",template:jst["feed/feed-signin-track"],ui:{buttonSlide:"a[data-name=feed-signin-slide]"},modelEvents:{"change:signinTimeSites":"render"},events:function(){var events={};events["click "+this.ui.buttonSlide]="_slideMoreHandler";return events},templateHelpers:function(){return{defaultCount:this.settings["defaultCount"]}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);this.model.set("singinTrackShowAll",false)},onRender:function(){},_slideMoreHandler:function(){var singinTrackShowAll=this.model.get("singinTrackShowAll");if(singinTrackShowAll){var data=this.model.get("signinTimeSites");this.model.set("signinTimeSites",data.slice(0,4));this.model.set("singinTrackShowAll",false)}else{this.getMoreSigninTrack()}this.trigger("showAll")}});var FeedSigninView=Talent.ItemView.extend({className:"signin_fb",template:jst["feed/feed-signin"],initialize:function(options){},onShow:function(){this._renderFeedTaskTrackView()},_renderFeedTaskTrackView:function(){if(!this.feedSigninTrackView){this.feedSigninTrackView=new FeedSigninTrackView({model:this.model});this.$el.after(this.feedSigninTrackView.render().el)}}});var FeedTaskView=Talent.ItemView.extend({defaults:{quirkLink:false},className:"task_fb",template:jst["feed/feed-task"],templateHelpers:function(){var showType=this.model.get("showType"),startDate=this.model.get("startDate"),deadline=this.model.get("deadline"),remainDay=this.model.get("remainDay"),deadLineDay=this.model.get("deadLineDay"),feedType=this.model.get("feedType"),taskType=this.model.get("taskType"),labelType=this.model.get("labelType")||0;var date=FeedTmpl.showTimeTmplFun(showType,this.model.get("startDate"),this.model.get("deadline"),remainDay,deadLineDay);var app=this.model.get("app"),labelName=this.model.get("labelName");if(app&&app["appName"]!=""){labelName=labelType==0?app["appName"]:labelName;labelType=app["appType"]}var evaluation=this.model.get("evaluation"),evaluationHtml="";if(evaluation){evaluationHtml=Talent._.TitaWidget_evaluation(evaluation)}return{date:date,labelName:_.substring(labelName,8),labelType:labelType,webHost:Context.isAbsolutePath(),typeName:FeedTmpl.typeName(feedType,taskType),evaluation:evaluationHtml}},ui:{labelName:"div[data-name=feed-lable]",name:"a[data-name=feed-task-name]",tipNode:"[original-title]"},events:function(){var events={};events["mouseenter "+this.ui.tipNode]="_tipShowHandler";events["mouseleave "+this.ui.tipNode]="_tipHideHandler";events["mouseenter "+this.ui.labelName]="_labelTipShowHandler";events["mouseleave "+this.ui.labelName]="_tipHideHandler";events["click "+this.ui.name]="_openPullSreen";return events},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);if(this.model.get("app")){this.$el.addClass("task_app_fb");this.template=jst["feed/feed-task-app"]}this.overTipTrue=false},onShow:function(){this._renderFeedTrackView();this._renderFeedTaskExtraInfoListView()},_openPullSreen:function(event){event.stopPropagation();event.preventDefault();var self=this,node=self.$(event.currentTarget),id=this.model.get("feedId");if(util_italentSDK()){var host=Context.getGlobal("titaHost");window.iTalentSDK.sendMessage({publishEvent:"TitaQuickScreen_open",data:{id:id,iframeSrc:host+"/widget#more/taskinfo?id="+id+"&topActionFix=true",iframeScroll:"no",type:"task"}})}else{Context.changeHash({plan_item_id:id},"add");Talent.app.vent.trigger("global-pull-screen",id,"task",this.model)}},_labelTipShowHandler:function(event){var node=Talent.$(event.currentTarget),self=this;node.tipsy({gravity:"sw",trigger:"manual",title:function(){return self.model.get("labelName")}})},_tipShowHandler:function(event){this.overTipTrue=true;var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual"})}if(this.overTipTrue){node.tipsy("show")}},_tipHideHandler:function(event){this.overTipTrue=false;var node=Talent.$(event.currentTarget);node.tipsy("hide")},_renderFeedTrackView:function(){var feedOperations=this.model.get("feedOperations");if(!feedOperations||!feedOperations["comments"])return;if(!this.feedTrackView){this.feedTrackView=new FeedTrackView({model:new Talent.Model({id:this.model.get("feedId")})});this.listenTo(this.feedTrackView,"showAll",function(){this._requestMoreTrack()},this);this.feedTrackView.model.set(feedOperations);this.$el.after(this.feedTrackView.render().el)}},_renderFeedTaskExtraInfoListView:function(){var data=this.model.get("customizeData")||[];if(!data||!data.length)return;if(!this.feedExtraInfoListView){this.feedExtraInfoListView=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.$el.after(this.feedExtraInfoListView.render().el)}},_requestMoreTrack:function(){var self=this;var feedId=this.model.get("feedId");CommentV2.getCommentGet({feed_id:feedId,comment_type:1}).done(function(resp){if(self.isClosed)return;self.feedTrackView.model.set("comments",resp["comments"])})}});var FeedWorkView=Talent.ItemView.extend({className:"work_fb",template:jst["feed/feed-work"],templateHelpers:function(){var showType=this.model.get("showType"),startDate=this.model.get("startDate"),deadline=this.model.get("deadline"),remainDay=this.model.get("remainDay"),deadLineDay=this.model.get("deadLineDay"),feedType=this.model.get("feedType"),taskType=this.model.get("taskType"),obj=this.model.get("obj")||{},app=this.model.get("app"),appId=app&&appId||1,workType=this.model.get("workType");var date=FeedTmpl.showTimeTmplFun(showType,this.model.get("startDate"),this.model.get("deadline"),remainDay,deadLineDay);var evaluation=this.model.get("evaluation"),evaluationHtml="";if(evaluation){evaluationHtml=Talent._.TitaWidget_evaluation(evaluation)}var labIcoType=FeedTmpl.typeIco(feedType,appId,workType);return{date:date,webHost:Context.isAbsolutePath(),typeName:FeedTmpl.typeName(feedType,taskType),evaluation:evaluationHtml,labIcoType:labIcoType}},ui:{name:"a[data-name=feed-task-name]",tipNode:"[original-title]"},events:function(){var events={};events["mouseenter "+this.ui.tipNode]="_tipShowHandler";events["mouseleave "+this.ui.tipNode]="_tipHideHandler";return events},initialize:function(options){},onShow:function(){this._renderFeedTrackView();this._renderFeedTaskExtraInfoListView()},_tipShowHandler:function(event){var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual"})}node.tipsy("show")},_tipHideHandler:function(event){var node=Talent.$(event.currentTarget);node.tipsy("hide")},_renderFeedTrackView:function(){var feedOperations=this.model.get("feedOperations");if(!feedOperations||!feedOperations["comments"])return;if(!this.feedTrackView){this.feedTrackView=new FeedTrackView({model:new Talent.Model({id:this.model.get("feedId")})});this.listenTo(this.feedTrackView,"showAll",function(){this._requestMoreTrack()},this);this.feedTrackView.model.set(feedOperations);this.$el.after(this.feedTrackView.render().el)}},_renderFeedTaskExtraInfoListView:function(){var data=this.model.get("customizeData")||[];if(!data||!data.length)return;if(!this.feedExtraInfoListView){this.feedExtraInfoListView=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.$el.after(this.feedExtraInfoListView.render().el)}},_requestMoreTrack:function(){var self=this;var feedId=this.model.get("feedId");CommentV2.getCommentGet({
feed_id:feedId,comment_type:1}).done(function(resp){if(self.isClosed)return;self.feedTrackView.model.set("comments",resp["comments"])})}});var FeedOkrView=Talent.ItemView.extend({className:"okr_fb",template:jst["feed/feed-okr"],templateHelpers:function(){var showType=this.model.get("showType"),startDate=this.model.get("startDate"),deadline=this.model.get("deadline"),remainDay=this.model.get("remainDay"),deadLineDay=this.model.get("deadLineDay"),feedType=this.model.get("feedType"),taskType=this.model.get("taskType"),obj=this.model.get("obj")||{},objType=obj["objType"]||0;objSubType=obj["objSubType"]||0;var date=FeedTmpl.showTimeTmplFun(showType,this.model.get("startDate"),this.model.get("deadline"),remainDay,deadLineDay);var evaluation=this.model.get("evaluation"),evaluationHtml="";if(evaluation){evaluationHtml=Talent._.TitaWidget_evaluation(evaluation)}var labIcoType=FeedTmpl.typeIco(feedType,objType,objSubType);return{date:date,webHost:Context.isAbsolutePath(),typeName:FeedTmpl.typeName(feedType,taskType),evaluation:evaluationHtml,labIcoType:labIcoType}},ui:{name:"a[data-name=feed-task-name]",tipNode:"[original-title]",workflow:"[data-name=feed-work-flow]"},events:function(){var events={};events["mouseenter "+this.ui.tipNode]="_tipShowHandler";events["mouseleave "+this.ui.tipNode]="_tipHideHandler";return events},initialize:function(options){},onShow:function(){this._renderFeedStepView();this._renderFeedTrackView();this._renderFeedTaskExtraInfoListView()},_tipShowHandler:function(event){var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual"})}node.tipsy("show")},_tipHideHandler:function(event){var node=Talent.$(event.currentTarget);node.tipsy("hide")},_renderFeedTrackView:function(){var feedOperations=this.model.get("feedOperations");if(!feedOperations||!feedOperations["comments"])return;if(!this.feedTrackView){this.feedTrackView=new FeedTrackView({model:new Talent.Model({id:this.model.get("feedId")})});this.listenTo(this.feedTrackView,"showAll",function(){this._requestMoreTrack()},this);this.feedTrackView.model.set(feedOperations);this.$el.after(this.feedTrackView.render().el)}},_renderFeedTaskExtraInfoListView:function(){var data=this.model.get("customizeData")||[];if(!data||!data.length)return;if(!this.feedExtraInfoListView){this.feedExtraInfoListView=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.$el.after(this.feedExtraInfoListView.render().el)}},_renderFeedStepView:function(){var data=this.model.get("step")||"";if(data==""||data=="[]")return;if(!this.feedStepView){this.feedStepView=new FeedStepView({status:this.model.get("status"),step:this.model.get("step")});this.ui.workflow.html(this.feedStepView.render().el)}},_requestMoreTrack:function(){var self=this;var feedId=this.model.get("feedId");CommentV2.getCommentGet({feed_id:feedId,comment_type:1}).done(function(resp){if(self.isClosed)return;self.feedTrackView.model.set("comments",resp["comments"])})}});var FeedItemView=Talent.Layout.extend({defaults:{isInAppPage:false,onlyComment:false,mBlogOptions:{defaultHide:true,defaultValue:""},custom:{more:true,remind:true,collect:true,reply:true,reward:true},actionMore:{detail:true,deleted:true,setTop:true,setTopPramas:{}},isPrivate:false,privateTipText:"",feedId:"",feedType:"",defaultCount:4,sort:"append",isShowAddTag:true,quirkLink:false},isFromCommitListView:false,template:jst["feed/feed-item"],className:"feed_item_box_v2",regions:{content:"div[data-name=feed-content]",action:"div[data-name=feed-actoin]",comment:"div[data-name=feed-comment]",mblog:"div[data-name=feed-pubblog]",main:"div[data-name=feed-main]",left:"div[data-name=feed-left]",feedTag:"div[data-name=feed-tag]"},ui:{content:"div[data-name=feed-content]",action:"div[data-name=feed-actoin]",comment:"div[data-name=feed-comment]",submain:"div[data-name=feed-sub-main]",rewardGive:"[data-name=feed-reward-give]",feedTag:"div[data-name=feed-tag]"},events:function(){var events={};return events},templateHelpers:function(){var tagData=this.model.get("tags")||[];return{tagData:tagData}},initialize:function(){window.feedStartTime=(new Date).getTime();this.setOptions();if(this.isFromCommitListView){this.settings["onlyComment"]=true;this.settings["mBlogOptions"]["defaultHide"]=false}else{var comments=this.model.get("feedComments")&&this.model.get("feedComments").comments||[],operations=this.model.get("feedOperations")&&this.model.get("feedOperations").comments||[];if(comments.length&&operations.length||!comments.length&&operations.length){var comment=comments[comments.length-1],operation=operations[operations.length-1];if(!comments.length){this.model.get("feedOperations")["isLatest"]=true}else if(operation.createTime>comment.createTime){this.model.get("feedOperations")["isLatest"]=true}}}if(typeof this.model.get("isTop")=="undefined"){this.model.set("isTop",false)}this.feedId=this.model.get("feedId");if(this.settings["onlyComment"]){this.feedId=this.settings["feedId"]}this.commentId=0;this.userInfo=Context.getUserInfo();this._privateTipText();var tagData=this.model.get("tags")||[];_.each(tagData,function(i){i.del=true});this.tagCollection=new Talent.Collection(tagData)},onRender:function(){if(!this.settings["onlyComment"]){this._renderMainView();this._renderLeftView();this._renderShareView();this._renderAttachmentListView();this._renderFeedAction();this._renderDailyView();this._renderFeedTaskView();this._renderPlanView();this._renderSigninView();this._renderWorkView();this._renderFeedType10View();this._renderOkrView();this._renderFeedType8View();this._renderFeedType9View();this._renderFeedType12View()}else{this.$el.addClass("only_comment_fb")}this._rendCommentListView();if(!this.settings["mBlogOptions"]["defaultHide"]){this._renderMblogView()}},onShow:function(){if(this.settings.isShowAddTag){this._renderFeedTagAddView()}var feedId=this.model.get("feedId")||"";Talent._.performanceAnalysis("[feed-item]"+feedId,(new Date).getTime()-window.feedStartTime)},onClose:function(){this.rewardAppView&&this.rewardAppView.close()},addNewItemComment:function(model){model.set({isPrivate:this.model.set("isPrivate"),privateTipText:this.model.set("privateTipText")});var view=this.feedCommentListView.addNewItemComment(model);return view},_renderFeedTagAddView:function(){this.feedTagAddView&&this.feedTagAddView.close();var feedListEl=this.$el.parents(".feed_list_v2");this.feedTagAddView=new TagAddView({collection:this.tagCollection,objId:this.model.get("feedId"),objType:10,container:feedListEl.length?feedListEl:this.$el});this.listenTo(this.feedTagAddView,"tagBeClick",function(id){this.trigger("tagBeClick",id)});this.feedTag.show(this.feedTagAddView)},_renderLeftView:function(){var feedLeftView=new FeedLeftView({model:this.model,isInAppPage:this.settings["isInAppPage"]});this.left.show(feedLeftView)},setOptions:function(){this.settings=Talent._.extend({},this.defaults,this.options);this.settings["mBlogOptions"]=Talent._.extend({},this.defaults["mBlogOptions"],this.options["mBlogOptions"]);this.settings["custom"]=Talent._.extend({},this.defaults["custom"],this.options["custom"]);this.settings["actionMore"]=Talent._.extend({},this.defaults["actionMore"],this.options["actionMore"])},_privateTipText:function(){var _private=typeof this.model.get("isPrivate")!="undefined"?this.model.get("isPrivate"):this.settings["isPrivate"];this.model.get("isPrivate",_private);var privateTipText=this.settings["privateTipText"];if(privateTipText!=""){this.model.set("privateTipText",privateTipText);return}var feedType=this.model.get("feedType"),isPrivate=this.model.get("isPrivate"),obj=this.model.get("obj")||{},objType=obj["objType"]||"",app=this.model.get("app"),appType=app&&app["appType"]||"";var tipText=_.privateTipText(feedType,isPrivate,objType,appType);this.model.set("privateTipText",tipText)},_renderMainView:function(){var feedType=this.model.get("feedType"),actionMore=this.settings["actionMore"],feedId=this.model.get("feedId"),self=this;if(feedType==2||feedType==3||feedType==4){actionMore["deleted"]=false}var feedMainView=new FeedMainView({model:this.model,actionMore:this.settings["actionMore"],isInAppPage:this.settings["isInAppPage"]});this.listenTo(feedMainView,"deleted",function(noded,options){this._requestDeleteFeed()},this);this.listenTo(feedMainView,"top",function(node,options){this._requestTopFeed(node,options,feedMainView)},this);this.main.show(feedMainView)},_requestDeleteFeed:function(){var self=this;UserFeedV2.deleteUserFeed({feed_id:this.feedId}).done(function(resp){if(self.isClosed)return;self.$el.slideUp(function(){self.$el.remove()})})},_requestTopFeed:function(node,options,view){var self=this;var isTop=this.model.get("isTop");var url="userFeedTop";var model=view.model||{};if(isTop){url="userFeedCancelTop"}var actionMore=this.settings["actionMore"]["setTopPramas"];var ajaxOptions=Talent._.extend({},actionMore,{feed_id:this.feedId});UserFeedV2[url](ajaxOptions).done(function(resp){model.set("isTop",options["isTop"])}).fail(function(message){TipDialogView(node,message,{pos:"bottomRight"})})},_renderAttachmentListView:function(){this.attachmentCollection=new Talent.Collection(this.model.get("attachments")||[]);if(!this.attachmentCollection.length)return;if(!this.feedAttachmentListView){this.feedAttachmentListView=new FeedAttachmentListView({collection:this.attachmentCollection,quirkLink:this.settings.quirkLink});this.ui.content.after(this.feedAttachmentListView.render().$el)}},_renderPlanView:function(){var feedType=this.model.get("feedType");if(feedType==4||feedType==2||feedType==3){if(!this.feedPlanView){this.feedPlanView=new FeedPlanView({model:this.model});this.content.show(this.feedPlanView)}}},_renderWorkView:function(){if(this.model.get("feedType")!=6)return;if(!this.feedWorkView){this.feedWorkView=new FeedWorkView({model:this.model});this.content.show(this.feedWorkView)}},_renderFeedType10View:function(){if(this.model.get("feedType")!=10)return;if(!this.feedWorkView){this.feedWorkView=new FeedWorkView({model:this.model});this.content.show(this.feedWorkView)}},_renderFeedType8View:function(){if(this.model.get("feedType")!=8)return;if(!this.feedType8View){this.feedType8View=new FeedType8View({model:this.model});this.content.show(this.feedType8View)}},_renderFeedType9View:function(){if(this.model.get("feedType")!=9)return;if(!this.feedType9View){this.feedType9View=new FeedType9View({model:this.model});this.content.show(this.feedType9View)}},_renderFeedType12View:function(){if(this.model.get("feedType")!=12)return;if(!this.feedType12View){this.feedType12View=new FeedType12View({model:this.model});this.content.show(this.feedType12View)}},_renderSigninView:function(){if(this.model.get("feedType")!=80)return;if(!this.feedSigninView){this.feedSigninView=new FeedSigninView({model:this.model});this.content.show(this.feedSigninView)}},_renderFeedTaskView:function(){if(this.model.get("feedType")!=20)return;if(!this.FeedTaskView){this.feedTaskView=new FeedTaskView({model:this.model,quirkLink:this.settings.quirkLink});this.content.show(this.feedTaskView)}},_renderDailyView:function(){if(this.model.get("feedType")!=5)return;if(!this.feedDailyView){this.feedDailyView=new FeedDailyView({model:this.model,quirkLink:this.settings.quirkLink});this.content.show(this.feedDailyView)}},_renderOkrView:function(){if(this.model.get("feedType")!=7)return;if(!this.FeedOkrView){this.feedOkrView=new FeedOkrView({model:this.model});this.content.show(this.feedOkrView)}},_renderFeedPraiseView:function(){if(this.model.get("feedType")!=1)return;if(this.model.get("praisesList")&&this.model.get("praisesList").length){this.ui.submain.show()}if(!this.feedPraiseView){this.feedPraiseView=new FeedPraiseView({model:this.model});this.listenTo(this.feedPraiseView,"praise",function(){this._setPraise()},this);this.ui.comment.before(this.feedPraiseView.render().el)}},_renderFeedAction:function(){if(!this.feedActionView){this.feedActionView=new FeedActionView({model:this.model,isShowAddTag:this.model.get("workType")!=6&&this.settings.isShowAddTag});this.listenTo(this.feedActionView,"reply",function(node,data){this._renderMblogView(data)},this);this.listenTo(this.feedActionView,"collect",function(node,data){this._requestFeedCollecte(node,data)},this);this.listenTo(this.feedActionView,"praise",function(){this._setPraise()},this);this.listenTo(this.feedActionView,"rewardBeg",function(data){this._renderRewardAppView("beg")});this.listenTo(this.feedActionView,"rewardGive",function(data){this._renderRewardAppView("give")});this.listenTo(this.feedActionView,"addTag",function(node){this._renderAddTagDialogView(node)});this.action.show(this.feedActionView)}},_renderAddTagDialogView:function(node){var feedListEl=this.$el.parents(".feed_list_v2");this.tagAddView&&this.tagAddView.close();this.tagAddView=new TagAddDialogView({collection:this.tagCollection,objId:this.model.get("feedId"),objType:10,node:node,container:feedListEl.length?feedListEl:this.$el});this.listenTo(this.tagAddView,"checked",function(view){this.ui.feedTag.show("slow/400/fast",function(){});this.feedTagAddView.addTagView(view.toJSON())});this.ui.action.parents(".feed_list_v2").append(this.tagAddView.render().$el)},_renderRewardAppView:function(){var self=this;var objTypeMapping={10:4,20:7,80:26,7:32,5:8};var principalUser=self.model.get("principalUser");if(!principalUser){principalUser=self.model.get("publishUser")}var avatar=principalUser.avatar;var objType=objTypeMapping[this.model.get("feedType")]||10;var data={toUserInfo:{name:principalUser.name,avatar:{hasAvatar:avatar.hasAvatar||avatar.HasAvatar,img:avatar.medium||avatar.Medium,color:avatar.color||avatar.Color},id:principalUser.userId},objId:self.feedId,objType:objType,needMask:true};if(util_italentSDK()){var host="//"+location.host+"/widget#sdk/reward?objId="+self.feedId+"&objType="+objType;window.iTalentSDK&&window.iTalentSDK.showPopup(host,"100%","100%",data);return}util_rewardGetFile(function(myReward){myReward.renderPayReward(data)})},_hidePop:function(){window.iTalentSDK.register([{listenEvent:"Tita_class_component_cancel",context:this,cb:function(data){window.iTalentSDK.hidePopup()}}])},_requestFeedCollecte:function(node,data){var self=this;var isCollect=this.model.get("isCollect");var url="userFeedCancelCollect";if(!isCollect){url="userFeedCollecte"}UserFeedV2[url]({feed_id:this.feedId}).done(function(resp){if(self.isClosed)return;var text=!isCollect?"收藏成功":"已取消收藏";TipDialogView(node,text,{className:"success",pos:"topCenter",topBias:10});self.model.set("isCollect",!isCollect)})},_setPraise:function(){var praiseTotal=this.model.get("praiseTotal"),userInfo=Context.getUserInfo(),isPraise=this.feedPraiseView.model.get("isPraise");var praisesList=this.model.get("praisesList");if(isPraise){praisesList.unshift({name:userInfo["Name"]});praiseTotal+=1}else{praisesList.shift();praiseTotal-=1}if(this.model.get("isPraise")){this._afterClickPraise()}this.model.set({praisesList:praisesList,praiseTotal:praiseTotal})},_afterClickPraise:function(){var self=this;if(this.t_praise)return;var src=Context.getStaticUrl("images/praise-animate.gif");var img=$('<img src="'+src+'">');var windowW=Talent.$(window).width(),windowH=Talent.$(window).height(),scrollTop=Talent.$("body").scrollTop();img.css({position:"absolute",top:windowH/2-255.5+scrollTop,left:windowW/2-216});Talent.$("body").append(img);this.t_praise=setTimeout(function(){clearTimeout(self.t_praise);self.t_praise=null;img.remove()},1850)},_renderShareView:function(){if(this.model.get("feedType")!=1)return;this.feedShareView=new FeedShareView({model:this.model});this.content.show(this.feedShareView)},_rendCommentListView:function(){if(this.settings["onlyComment"]){var commentsModel=this.model.toJSON()}else{var commentsModel=this.model.get("feedComments")||{}}if(!commentsModel["comments"]||commentsModel["comments"].length==0){return}if(!this.feedCommentListView){var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"commentId"})}});if(this.options.collection){var collectionData=this.options.collection.toJSON()||[]}else{var collectionData=commentsModel["comments"]}var feedType=this.model.get("feedType");if(collectionData&&collectionData.length){this.ui.submain.show()}this.feedCommentListView=new FeedCommentListView({model:new Talent.Model(commentsModel),isPrivate:this.model.get("isPrivate"),privateTipText:this.model.get("privateTipText"),collection:new mCollection(collectionData),mBlogOptions:this.settings.mBlogOptions,defaultCount:this.settings.defaultCount,sort:this.settings.sort,feedType:feedType||this.settings.feedType,actionMore:{detailUrl:FeedTmpl.typeUrl(feedType,this.model.toJSON())},quirkLink:this.settings.quirkLink});this.listenTo(this.feedCommentListView,"reply",function(data){var publishUser=data["publishUser"];this._renderMblogView({toUserName:publishUser["name"],commentId:data["commentId"]})},this);this.listenTo(this.feedCommentListView,"more",function(node,options){if(this.settings["onlyComment"]&&!this.settings["feedId"]){this.trigger("more",node,options)}else{this._requestCommentData(node,options)}});this.listenTo(this.feedCommentListView,"deleted",function(node,options){if(options.total==0){this.ui.submain.hide()}this._requestDeleteCommentData(node,options)},this);this.listenTo(this.feedCommentListView,"rewardGive",function(node,options){this._renderRewardAppView("give",options.publishUser,false)});this.comment.show(this.feedCommentListView)}},_requestCommentData:function(){var self=this;CommentV2.getCommentGet({feed_id:this.feedId}).done(function(resp){if(self.isClosed)return;self.feedCommentListView.collection.reset(resp["comments"])})},_requestDeleteCommentData:function(node,options){var self=this;CommentV2.deleteCommentGetByIds({feed_id:this.feedId,comment_id:options["commentId"]}).done(function(resp){self.trigger("deleted",self.feedCommentListView.model.get("total"),options.data)})},_renderMblogView:function(options){var options=options||{};var mBlogOptions=this.settings["mBlogOptions"],self=this;var userInfo=Context.getUserInfo();var isExternal=this.model.get("isExternal");var mblogOptions=Talent._.extend({},{submitText:"回复",id:this.feedId,type:"comment",inFocus:true,toUserName:"",commentId:"",isExternal:userInfo.UserType!==2&&isExternal,externalText:"此项目允许外部联系人参与，外部联系人可以看到您回复的内容、上传的文件，请注意企业信息保密！",isShowAtAll:userInfo.Role==2||userInfo.Role==1||userInfo.Role==4||userInfo.Role==7||userInfo.IsBoss||userInfo.IsUpaasManager?true:false,submitRequest:function(node,options,params){options["files"]=options["files"].join(",");var deferred=new Talent.$.Deferred;self._requestFeed(node,options,params);deferred.resolve("");return deferred}},mBlogOptions);if(!this.publistMblogView){this.publistMblogView=new PublistMblogView(mblogOptions);this.listenTo(this.publistMblogView,"rewardGive",function(data){this._renderRewardAppView("give",this.model.toJSON())});this.mblog.show(this.publistMblogView)}this.publistMblogView.show();this.publistMblogView.ui.input.focus();if(options["toUserName"]){this.publistMblogView.model.set({toUserName:options["toUserName"],commentId:options["commentId"]})}else{this.publistMblogView.model.set({toUserName:"",commentId:0})}},_requestFeed:function(node,options,params){if(this.settings["onlyComment"]&&!this.feedId){this.trigger("reply",node,options);return}var self=this;var options={FeedId:this.feedId,CommentId:options["commentId"]||0,Content:options["context"],FileUrl:options["files"],ObjId:options["privateObjId"],ObjType:options["privateObjType"],IsSendSMS:options["isSendSMS"],OtherDocuments:options["YFYDocuments"]};options=Talent._.extend({},options,params);CommentV2.postCommentAdd(options).done(function(resp){if(self.isClosed)return;if(self.ui.submain.is(":hidden")){self.ui.submain.show()}self._addFeedCommentList(resp)})},_addFeedCommentList:function(resp){if(!this.feedCommentListView){if(this.settings["onlyComment"]){this.model.set("total",1);this.model.set("comments",[resp])}else{this.model.set("feedComments",{total:1,comments:[resp]})}this._rendCommentListView()}else{var total=this.feedCommentListView.model.get("total");this.feedCommentListView.model.set("total",total+1);this.feedCommentListView.collection.add(resp);this.model.set("feedComments",{total:total+1,comments:this.feedCommentListView.collection.toJSON()})}this.trigger("reply",this.feedCommentListView.model.get("total"),resp)}});var CommitListView=FeedItemView.extend({isFromCommitListView:true});var FeedListView=Talent.CompositeView.extend({defaults:{isInAppPage:false,mBlogOptions:{defaultHide:true},custom:{more:true,remind:true,collect:true,reply:true,reward:true},actionMore:{detail:true,deleted:true,setTop:true,setTopPramas:{}},requestMoreFeed:function(){var deferred=new Talent.$.Deferre;return deferred},isShowAddTag:true,quirkLink:false},itemView:FeedItemView,template:jst["feed/feed-list"],itemViewContainer:"div[data-name=feed-list-box]",className:"feed_list_v2",ui:{btnMore:"div[data-name=feed-more]",btnMoreText:"span[data-name=feed-more-text]"},modelEvents:{"change:isEnd":"_isShowMoreEvent"},events:function(){var events={};events["click "+this.ui.btnMore]="_getMoreFeed";return events},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);var isEnd=true,lastId="";if(typeof this.options.model.get("isEnd")=="boolean"){isEnd=this.options.model.get("isEnd")}if(this.options.model.get("lastId")){lastId=this.options.model.get("lastId")}this.model.set({lastId:lastId,isEnd:isEnd});this.collection.model=Talent.Model.extend({idAttribute:"feedId"});this.collection.reset(this.model.get("feeds"));this.on("itemview:tagBeClick",function(view,id){self.trigger("tagBeClick",id)})},templateHelpers:function(){return{i18n:Context.getI18n()}},addNewItemFeed:function(feedModel){var options=this.itemViewOptions();var feedItemView=this.buildItemView(feedModel,this.itemView,options);this.collection.add([feedModel],{silent:true});feedItemView.render();feedItemView.onShow();if(this.settings.quirkLink){feedItemView.$el.find(".atsrc_fed").each(function(idx,node){Talent.$(node).attr("target","_blank")})}return feedItemView.$el},itemViewOptions:function(model,index){var settings=this.settings;return{mBlogOptions:settings["mBlogOptions"],custom:settings["custom"],actionMore:settings["actionMore"],isInAppPage:settings["isInAppPage"],isShowAddTag:settings["isShowAddTag"],quirkLink:settings["quirkLink"]}},onRender:function(){this.trigger("onRender")},onShow:function(){this.trigger("onShow");if(this.settings.quirkLink){this.$el.find(".atsrc_fed").each(function(idx,node){Talent.$(node).attr("target","_blank")})}},_getMoreFeed:function(event){var self=this;var node=Talent.$(event.currentTarget);var html=node.html();this.ui.btnMoreText.html("加载中…");this.settings.requestMoreFeed({lastId:this.model.get("lastId")}).done(function(data){if(data&&data["feeds"]){self.collection.add(data["feeds"])}self.model.set({isEnd:data["isEnd"],lastId:data["lastId"]});self.ui.btnMoreText.html("查看更多");self.trigger("onMore")})},_isShowMoreEvent:function(){var isEnd=this.model.get("isEnd");if(isEnd){this.ui.btnMore.hide()}else{this.ui.btnMore.show()}}});var FeedExtraInfoListItemView=Talent.ItemView.extend({template:jst["feed/feed-extra-info-list-item"],tagName:"li",templateHelpers:function(){var value=this.model.get("value");if(value&&value!=""){value=value.replace(/(<br\/>)/g,"")}return{value:value}}});var FeedExtraInfoListView=Talent.CollectionView.extend({itemView:FeedExtraInfoListItemView,itemViewContainer:"ul",className:"extra_info_fb",tagName:"ul",initialize:function(){this.collectionLen=this.collection.length||0;this._sliceCollection()},onRender:function(){var data=this.collection.toJSON();if(this.collectionLen>8){this.$el.append("<li>……</li>")}},_sliceCollection:function(){var data=this.collection.toJSON();if(this.collectionLen>0){this.collection.reset(data.slice(0,8))}}});var SearchFormView=Talent.ItemView.extend({defaults:{defaultvalue:"搜索同事"},className:"search-form-list",template:jst["feed/search-form"],ui:{input:"input[data-type=new-content]",inputWarp:".input-default",submitBtn:"a[data-type=submit-content]",form:"form"},events:function(){var events={};events["focus "+this.ui.input]="_focusHandler";events["blur "+this.ui.input]="_blurHandler";events["submit "+this.ui.form]="_submitHandler";events["click "+this.ui.submitBtn]="_submitHandler";return events},initialize:function(){this.isInitVal=true;this.settings=Talent._.extend({},this.defaults,this.options)},onRender:function(){this.ui.input.val(this.settings.defaultvalue)},updateDefaultvalue:function(val){this.ui.input.val(val)},_focusHandler:function(event){var node=Talent.$(event.currentTarget);this.ui.inputWarp.addClass("input-focus");var val=Talent.$.trim(node.val());this.isInitVal=false;if(val==this.settings.defaultvalue){node.val("")}},_blurHandler:function(event){var node=Talent.$(event.currentTarget);var val=Talent.$.trim(node.val());if(val==""){this.isInitVal=true;node.val(this.settings.defaultvalue);this.ui.inputWarp.removeClass("input-focus")}},_submitHandler:function(){var val=this.ui.input.val();val=Talent.$.trim(val);if(!this.isInitVal){this.model.set("filter",val);this.trigger("submit",val)}return false}});var FeedType8View=Talent.ItemView.extend({className:"feedtype8_fb",template:jst["feed/feed-type8"],events:function(){var events={};return events},initialize:function(options){},onShow:function(){this._renderFeedTrackView();this._renderFeedTaskExtraInfoListView()},_renderFeedTrackView:function(){var feedOperations=this.model.get("feedOperations");if(!feedOperations||!feedOperations["comments"])return;if(!this.feedTrackView){this.feedTrackView=new FeedTrackView({model:new Talent.Model({id:this.model.get("feedId")})});this.listenTo(this.feedTrackView,"showAll",function(){this._requestMoreTrack()},this);this.feedTrackView.model.set(feedOperations);this.$el.after(this.feedTrackView.render().el)}},_renderFeedTaskExtraInfoListView:function(){var data=this.model.get("customizeData")||[];if(!data||!data.length)return;if(!this.feedExtraInfoListView){this.feedExtraInfoListView=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.$el.after(this.feedExtraInfoListView.render().el)}},_requestMoreTrack:function(){var self=this;var feedId=this.model.get("feedId");CommentV2.getCommentGet({feed_id:feedId,comment_type:1}).done(function(resp){if(self.isClosed)return;self.feedTrackView.model.set("comments",resp["comments"])})}});var FeedType9View=Talent.ItemView.extend({className:"feedtype9_fb",template:jst["feed/feed-type9"],templateHelpers:function(){var showType=this.model.get("showType"),startDate=this.model.get("startDate"),deadline=this.model.get("deadline"),remainDay=this.model.get("remainDay"),deadLineDay=this.model.get("deadLineDay"),feedType=this.model.get("feedType"),taskType=this.model.get("taskType"),obj=this.model.get("obj")||{},objType=obj["objType"]||0;objSubType=obj["objSubType"]||0;var date=FeedTmpl.showTimeTmplFun(showType,this.model.get("startDate"),this.model.get("deadline"),remainDay,deadLineDay);var evaluation=this.model.get("evaluation"),evaluationHtml="";if(evaluation){evaluationHtml=Talent._.TitaWidget_evaluation(evaluation)}var labIcoType=FeedTmpl.typeIco(feedType,objType,objSubType);return{date:date,webHost:Context.isAbsolutePath(),typeName:FeedTmpl.typeName(feedType,taskType),evaluation:evaluationHtml,labIcoType:labIcoType}},ui:{name:"a[data-name=feed-task-name]",tipNode:"[original-title]",workflow:"[data-name=feed-work-flow]"},events:function(){var events={};events["mouseenter "+this.ui.tipNode]="_tipShowHandler";events["mouseleave "+this.ui.tipNode]="_tipHideHandler";return events},initialize:function(options){},onShow:function(){this._renderFeedStepView();this._renderFeedTrackView();this._renderFeedTaskExtraInfoListView()},_tipShowHandler:function(event){var node=Talent.$(event.currentTarget);if(!node.data("tipsy")){node.tipsy({gravity:"s",trigger:"manual"})}node.tipsy("show")},_tipHideHandler:function(event){var node=Talent.$(event.currentTarget);node.tipsy("hide")},_renderFeedTrackView:function(){var feedOperations=this.model.get("feedOperations");if(!feedOperations||!feedOperations["comments"])return;if(!this.feedTrackView){this.feedTrackView=new FeedTrackView({model:new Talent.Model({id:this.model.get("feedId")})});this.listenTo(this.feedTrackView,"showAll",function(){this._requestMoreTrack()},this);this.feedTrackView.model.set(feedOperations);this.$el.after(this.feedTrackView.render().el)}},_renderFeedTaskExtraInfoListView:function(){var data=this.model.get("customizeData")||[];if(!data||!data.length)return;if(!this.feedExtraInfoListView){this.feedExtraInfoListView=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.$el.after(this.feedExtraInfoListView.render().el)}},_renderFeedStepView:function(){var data=this.model.get("step")||"";if(data=="")return;if(!this.feedStepView){this.feedStepView=new FeedStepView({status:this.model.get("status"),step:this.model.get("step")});this.ui.workflow.html(this.feedStepView.render().el)}},_requestMoreTrack:function(){var self=this;var feedId=this.model.get("feedId");CommentV2.getCommentGet({feed_id:feedId,comment_type:1}).done(function(resp){self.feedTrackView.model.set("comments",resp["comments"])})}});var FeedType12View=Talent.ItemView.extend({className:"feedtype12_fb",template:jst["feed/feed-type12"],events:function(){var events={};return events},initialize:function(options){},onShow:function(){this._renderFeedTrackView();this._renderFeedTaskExtraInfoListView()},_renderFeedTrackView:function(){var feedOperations=this.model.get("feedOperations");if(!feedOperations||!feedOperations["comments"])return;if(!this.feedTrackView){this.feedTrackView=new FeedTrackView({model:new Talent.Model({id:this.model.get("feedId")})});this.listenTo(this.feedTrackView,"showAll",function(){this._requestMoreTrack()},this);this.feedTrackView.model.set(feedOperations);this.$el.after(this.feedTrackView.render().el)}},_renderFeedTaskExtraInfoListView:function(){var data=this.model.get("customizeData")||[];if(!data||!data.length)return;if(!this.feedExtraInfoListView){this.feedExtraInfoListView=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.$el.after(this.feedExtraInfoListView.render().el)}},_requestMoreTrack:function(){var self=this;var feedId=this.model.get("feedId");CommentV2.getCommentGet({feed_id:feedId,comment_type:1}).done(function(resp){if(self.isClosed)return;self.feedTrackView.model.set("comments",resp["comments"])})}});var TaskCreateDropDownItemView=Talent.ItemView.extend({template:Talent._.template("<%=name%>"),tagName:"li",className:"tu-menuitem tu-cp",initialize:function(){var name=this.model.get("name");this.model.set("name",name.replace(/<br\/>/g,""))}});var TaskCreateDropDownCollectionView=Talent.CollectionView.extend({itemView:TaskCreateDropDownItemView,className:"tu-dropdown-menu",tagName:"ul",ui:{liName:"li"},events:function(){var events={};events["click "+this.ui.liName]="_clickName";return events},initialize:function(options){var self=this},onRender:function(){},_clickName:function(ev){ev.stopPropagation();var node=Talent.$(ev.currentTarget);var html=Talent._.unescape(node.html());if(!html||html==""){return}this.trigger("choose",html)},onClose:function(){}});var TaskCreateClassView=Talent.ItemView.extend({defaults:{disable:false,parentEl:"",classDialogOptions:{isEdit:false}},className:"task-create-class-wraper clearfix",template:jst["task-create/task-create-class"],ui:{kClass:".klass_ttpl",formKlass:'[data-name="task-create-class"]',formKlassName:'[data-name="task-create-class-name"]',classContainer:'[data-name="class-area"]'},events:function(){var events={};events["click "+this.ui.formKlass]="_clickClassHandler";events["mouseenter "+this.ui.kClass]="_mouseenterkKlass";return events},modelEvents:{"change:labelName":"_changeLabName"},templateHelpers:function(){return this.settings.classOptions},initialize:function(options){var TaskAdvancedSetting=Talent.Context.getGlobal("TaskAdvancedSetting");

var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;this.settings=Talent._.extend({},options,options.classOptions);this.settings["classOptions"]=Talent._.extend({},this.defaults,options["classOptions"],{TaskLabel:TaskLabel})},_clickClassHandler:function(ev){ev.stopPropagation();var node=Talent.$(ev.currentTarget);if(this.settings.classOptions.disable)return;this.ui.formKlassName.addClass("active");this._renderKlassView(node)},_mouseenterkKlass:function(ev){var self=this,node=Talent.$(ev.currentTarget),tipBody=node.attr("data-body"),label_id=this.model.get("labelId"),tipView=new Infotip;if(!label_id||label_id=="0")return;if(this.model.get("labelType")!=17){var labelName=self.model.get("labelName");tipView.bindNode(node,{container:self.$el,type:"default",body:'<div class="class_tip_content">'+labelName+"</div>"});tipView.show()}else{LableCollection.getLabelFullName({lableId:label_id}).done(function(resp){if(!resp)return;tipView.bindNode(node,{container:self.$el,type:"default",body:'<div class="class_tip_content">'+resp+"</div>"});tipView.show()})}},_renderKlassView:function(node){var options=this.settings.classDialogOptions;options["zIndex"]=99;this.classComponentView&&this.classComponentView.close();this.classComponentView=new ClassComponentView(options);this.listenTo(this.classComponentView,"submit",function(data){if(!data||!data["id"]&&!this.model.get("labelId")){return this.ui.formKlassName.removeClass("active")}this.settings.classDialogOptions.resultData=[data];this.model.set({labelType:data["tabType"],labelId:data["id"],labelName:data["name"]});this.ui.formKlassName.addClass("active")});this.listenTo(this.classComponentView,"reset",function(){this.settings.classDialogOptions.resultData=[];this.model.set({labelType:0,labelId:null,labelName:""});this.classComponentView.close();this.ui.formKlassName.removeClass("active")});this.listenTo(this.classComponentView,"reset",function(){this.model.set({labelType:0,labelId:null,labelName:""});this.classComponentView.close();this.ui.formKlassName.removeClass("active")});this.settings.parentEl.append(this.classComponentView.render().el);this.classComponentView.show(node,{container:this.settings.parentEl,pos:"bottom"});this.render()},_changeLabName:function(){var labelName=this.model.get("labelName"),labelId=this.model.get("labelId"),labelName=Talent._.substringWithM(labelName,6,true);if(!labelId||labelName==""){labelName="分类/项目";this.ui.formKlassName.removeClass("active")}this.ui.formKlassName.html(labelName)},onClose:function(){this.classComponentView&&this.classComponentView.close()}});var TaskCreateNameView=Talent.ItemView.extend({defaults:{parentEl:"",defaultText:"输入任务名称",iconShow:true,iconClassName:"icon-task-txt",dropdownData:[],showBorderLeft:true},template:jst["task-create/task-create-name"],ui:{taskName:'input[data-name="task-create-name"]',taskNameContainer:'div[data-name="task-create-name"]',dropDown:'[data-name="task-create-name-dropdown"]',form:'[data-name="task-create-name-form"]'},className:"ns-task-create-name",events:function(){var events={};events["submit "+this.ui.form]="_formSubmitHandler";events["focus "+this.ui.taskName]="_onFocus";events["keyup "+this.ui.taskName]="_onKeyHandler";events["keydown paste cut"+this.ui.taskName]="_onKeyHandler";events["input "+this.ui.taskName]="_onKeyHandler";events["blur "+this.ui.taskName]="_unFocus";events["change "+this.ui.taskName]="_onInputChange";return events},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options.nameOptions);this.uxAddTaskContainer=this.options.parentEl;this.localStroage=Context.localStorage();this.userInfo=Context.getUserInfo();this.isSafari=window.safari&&window.navigator.userAgent.indexOf("Safari")>-1?true:false;if(!this.settings.iconShow){this.$el.addClass("no-icon")}},templateHelpers:function(){return this.settings},onRender:function(){var self=this,storage=this.localStroage,txt=storage.get("TaskCreateName_"+this.userInfo["Id"]+this.model.get("id"))&&storage.get("TaskCreateName_"+this.userInfo["Id"]+this.model.get("id")).taskTitle,taskTitle=this.model.get("taskTitle");if(!taskTitle&&txt){this.ui.taskName.val(txt);this.model.set({taskTitle:txt});this.trigger("keyup",this.ui.taskName)}},onClose:function(){clearTimeout(this.tFocus)},_onInputChange:function(ev){var node=this.$(ev.currentTarget);var dropdownData=this.settings.dropdownData,val=Talent.$.trim(node.val());if(val==""&&dropdownData&&dropdownData.length){this._renderDropDown()}this.trigger("change",node)},_toggle:function(ev){ev.stopPropagation();var isPackUp=this.model.get("packUp"),node=this.$(ev.currentTarget),txtNode=node.find(".l"),icon=node.find(".r");this.model.set("packUp",!isPackUp);icon.removeClass("tu-icon-arrow-down tu-icon-arrow-up");this.ui.publishWraper.removeClass("packup");if(isPackUp){icon.addClass("tu-icon-arrow-up");txtNode.text("收起")}else{icon.addClass("tu-icon-arrow-down");this.ui.publishWraper.addClass("packup");txtNode.text("更多信息")}this.trigger("openAdvancedMode",node,{open:!isPackUp})},_unFocus:function(ev){var node=this.$(ev.currentTarget),self=this;this.uxAddTaskContainer.removeClass("input-focus");this.blurTag=true;this.tFocus=setTimeout(function(){clearTimeout(self.tFocus);if(self.blurTag&&self.settings["dropdownData"].length){self.ui.dropDown.hide()}},300);this.trigger("unfocus",node)},_onFocus:function(ev){var node=this.$(ev.currentTarget);var dropdownData=this.options.nameOptions.dropdownData;this.uxAddTaskContainer.addClass("input-focus");if(dropdownData&&dropdownData.length&&node.val()==""){this._renderDropDown()}this.trigger("focus",node)},_renderDropDown:function(){var self=this,dropdownData=this.options.nameOptions.dropdownData,dropDown=this.ui.dropDown,timeMap=(new Date).getTime();this.dropDownView&&this.dropDownView.close();this.dropDownView=new TaskCreateDropDownCollectionView({collection:new Talent.Collection(dropdownData)});this.listenTo(this.dropDownView,"choose",function(data){this.blurTag=false;this.model.set("taskTitle",data);this.ui.taskName.val(data,this.ui.taskName);this.trigger("keyup",this.ui.taskName);dropDown.hide();self.localStroage.set("TaskCreateName_"+this.userInfo["Id"]+this.model.get("id"),{__setTime:timeMap,taskTitle:data})});dropDown.html(this.dropDownView.render().el).show();this.dropDownView.$el.width(this.$el.width())},_onKeyHandler:function(ev){var self=this,node=this.$(ev.currentTarget),val=$.trim(node.val()),container=this.ui.uxAddTaskContainer;timeMap=(new Date).getTime();if(val!=""){this.ui.dropDown.hide()}if(val.length>500){val=val.substring(0,500);node.val(val)}this.localStroage.set("TaskCreateName_"+this.userInfo["Id"]+this.model.get("id"),{__setTime:timeMap,taskTitle:val});this.model.set("taskTitle",val);this.trigger("keyup",node)},_formSubmitHandler:function(ev){var node=this.ui.taskName,val=$.trim(node.val()),container=this.ui.uxAddTaskContainer;if(val==""){container.removeClass("input-focus").addClass("border-warn");setTimeout(function(){container.removeClass("border-warn")},1500)}else{this.trigger("submit",node)}return false}});var TaskCreatePrincipleView=Talent.ItemView.extend({template:jst["task-create/task-create-principle"],ui:{principle:'[data-name="task-create-principle-inner"]'},className:"ns-task-principle",events:function(){var events={};return events},modelEvents:{"change:principalUser":"render"},templateHelpers:function(){this.settings.userinfoId=Context.getUserInfo().Id;return this.settings},initialize:function(){this.settings=Talent._.extend({},this.options,this.options.principalOptions)},onRender:function(){this._bindUserSelect()},_bindUserSelect:function(){var self=this;this.userSelectorView=new UserSelector({collection:new UserSelectorCollection});var userSelectorOpt=util.userSelectorConfig({muti:false});this.settings.container&&(userSelectorOpt["container"]=self.settings.container);this.userSelectorView.addNode(this.$el,userSelectorOpt);this.$el.on("submit",function(ev,user){ev.stopPropagation();self.trigger("changePrincipal",{user:user,node:self.$(ev.currentTarget)})});Talent.$(document).off("mousedown.task-create-principle-view");Talent.$(document).on("mousedown.task-create-principle-view",function(){self.userSelectorView&&self.userSelectorView.deleteView()})},onClose:function(){Talent.$(document).off("mousedown.task-create-principle-view");this.userSelectorView&&this.userSelectorView.close()}});var TaskCreateDateView=Talent.ItemView.extend({defaults:{dateOptions:{showBorderLeft:true,pos:"bottomRight"},dataTimeRangeOptions:{isShowDateView:true,isShowCycleView:true,isShowLongView:true,count:2,rangepickerOptions:{timePicker:true}},parentEl:""},template:jst["task-create/task-create-date"],ui:{dateBox:"[data-name=task-create-date-box]",dateIcon:"[data-name=task-create-date-ico]",dateArea:'[data-name="task-create-date-area"]'},className:"ns-task-create-date",events:function(){var events={};events["click "+this.ui.dateBox]="_showPop";return events},modelEvents:{"change:startDate change:endDate change:isLongTerm":"_renderDate","change:cycStartDate change:cycEndDate":"_renderDate","change:cycStartHour change:cycStartMinute change:cycEndHour change:cycEndMinute":"_renderDate"},templateHelpers:function(){var modelObj=this.model.toJSON();return Talent._.extend({},this.settings,{dateTip:this.getDateTip(),cycleTip:this._getCycleTaskHtml(),showBorderLeft:this.settings.dateOptions.showBorderLeft})},initialize:function(options){this.settings=Talent._.extend({},this.defaults,this.options);this.settings["dateOptions"]=Talent._.extend({},this.defaults.dateOptions,this.options.dateOptions);this.settings["dataTimeRangeOptions"]=Talent._.extend({},this.defaults.dataTimeRangeOptions,this.options.dataTimeRangeOptions);this.settings["dataTimeRangeOptions"].rangepickerOptions=Talent._.extend({},this.defaults.dataTimeRangeOptions.rangepickerOptions,this.options.dataTimeRangeOptions.rangepickerOptions)},onRender:function(){this.$("[data-body]").infotip({type:"default",placement:"top",align:this.settings.templateName=="dateRichEditor"?"left":"right",container:this.settings["parentEl"]});if(this.settings["dataTimeRangeOptions"].count==1){this.model.set("endDate",this.model.get("startDate"),{silent:true})}},_showPopSDK:function(options){var host="//"+location.host+"/widget#sdk/date-view";window.iTalentSDK&&window.iTalentSDK.showPopup(host,600,352,options);window.iTalentSDK.register({listenEvent:"tita__date-view__sure",context:this,cb:function(data){this.model.set(data.data);this._renderDate();this.trigger("selectDate",this.$el,this.model.toJSON())}})},_showPop:function(ev){if(ev)ev.stopPropagation();var self=this,node=this.$(ev.currentTarget);this.dateTimePickerView&&this.dateTimePickerView.close();var options=Talent._.extend({},this.settings["dataTimeRangeOptions"],{viewType:this.model.get("isCycle")?"cycle":this.model.get("isLongTerm")?"long":"date"});if(this.settings.sdkSchema){this._showPopSDK(options);return}options["model"]=this.model;this.dateTimePickerView=new DateTimePickerView(options);this.listenTo(this.dateTimePickerView,"sure",function(node,data){this._renderDate();this.trigger("selectDate",this.$el,this.model.toJSON())});this.settings["parentEl"].append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.settings["parentEl"],pos:this.settings.dateOptions.pos})},getDateTip:function(){var startDate=this.model.get("startDate"),endDate=this.model.get("endDate"),mStart=moment(startDate,"YYYY/MM/DD HH:mm"),mEnd=moment(endDate,"YYYY/MM/DD HH:mm"),isLongTerm=this.model.get("isLongTerm"),dateHtml="起止时间：",sameDay=null,format="YYYY/MM/DD HH:mm";var rangepickerOptions=this.settings["dataTimeRangeOptions"].rangepickerOptions;if(rangepickerOptions&&!rangepickerOptions.timePicker){format="YYYY/MM/DD"}if(isLongTerm){dateHtml+=mStart.format("YYYY/MM/DD")+"-长期"}else{dateHtml+=mStart.format(format)+"-"+mEnd.format(format)}if(this.settings["dataTimeRangeOptions"].count==1){dateHtml=mStart.format("YYYY/MM/DD")}return dateHtml},_getCycleTaskHtml:function(){var html="循环周期：",modelObj=this.model.toJSON(),cycType=modelObj.cycType,isCycle=modelObj.isCycle,cycStartTime=modelObj.cycStartHour+":"+modelObj.cycStartMinute,cycEndTime=modelObj.cycEndHour+":"+modelObj.cycEndMinute,cycStartDay=modelObj.cycStartDayTxt,cycEndDay=modelObj.cycEndDayTxt;if(this.isFirstRender||!isCycle)return"设置循环时间";if(cycType==1){html+="每天";html+=" "+cycStartTime;html+=" - "+cycEndTime}else if(cycType==2){html+="每个工作日";html+=" "+cycStartTime;html+=" - "+cycEndTime}else if(cycType==3){html+="每周";html+=" "+cycStartDay+" "+cycStartTime+" - "+cycEndDay+" "+cycEndTime}else if(cycType==4){html+="每月";html+=" "+cycStartDay+"日 "+cycStartTime+" - "+cycEndDay+"日 "+cycEndTime}return html},_renderDate:function(){var html=this.getDateTip(),modelObj=this.model.toJSON(),isCycle=this.model.get("isCycle");if(isCycle){this._renderCycle();return}this.ui.dateBox.attr("data-body",html);this.ui.dateIcon.addClass("active").removeClass("tu-icon-refresh").addClass("tu-icon-calendar")},_renderCycle:function(){var html=this._getCycleTaskHtml();this.ui.dateBox.attr("data-body",html);this.ui.dateIcon.addClass("active").removeClass("tu-icon-calendar").addClass("tu-icon-refresh")},onClose:function(){this.dateTimePickerView&&this.dateTimePickerView.close()}});var TaskCreateWorkHourView=Talent.ItemView.extend({defaults:{showBorderLeft:true,parentEl:"body",hourDropdownOpitons:{pos:"bottomRight"}},className:"task-create-work-hour-box",template:jst["task-create/task-create-workhour"],ui:{workhour:'[data-name="task-create-workhour"]'},events:function(){var events={};events["click "+this.ui.workhour]="_renderWorkHourView";return events},modelEvents:{"change:hourDate":"render","change:minuteDate":"render"},templateHelpers:function(){return{workHour:this._formateDate(),showBorderLeft:this.settings["showBorderLeft"]}},initialize:function(){this.settings=Talent._.extend({},this.options,this.options.hourDateOptions)},_renderWorkHourView:function(ev){var self=this,node=this.$(ev.currentTarget);ev.stopPropagation();this.workHourView&&this.workHourView.close();this.workHourView=new WorkHourView({model:new Talent.Model({hourDate:this.model.get("hourDate"),minuteDate:this.model.get("minuteDate")})});this.listenTo(this.workHourView,"sure",function(data){this.model.set({hourDate:data.hourDate,minuteDate:data.minuteDate})});var options=Talent._.extend({},this.settings["hourDropdownOpitons"]);options["container"]=this.settings.parentEl;this.workHourView.show(node,options)},_formateDate:function(){var hourDate=this.model.get("hourDate");var minuteDate=this.model.get("minuteDate");var formatDate="";var mapData=[{minute:"0",hour:"00"},{minute:"15",hour:"25"},{minute:"30",hour:"50"},{minute:"45",hour:"75"}];if(hourDate&&minuteDate){var arr=_.findWhere(mapData,{minute:minuteDate});formatDate=hourDate+"."+arr["hour"]}if(!hourDate&&minuteDate){var arr=_.findWhere(mapData,{minute:minuteDate});formatDate="0."+arr["hour"]}if(hourDate&&!minuteDate){formatDate=hourDate+".00"}if(!hourDate&&!minuteDate){formatDate=""}return formatDate},onClose:function(){this.workHourView&&this.workHourView.close()}});var TaskCreateParticipatorView=Talent.ItemView.extend({template:jst["task-create/task-create-participator"],ui:{participator:'[data-name="task-create-participator"]'},events:function(){var events={};events["click "+this.ui.participator]="_showAddUser";return events},modelEvents:{"change:participatorsCount":"render"},_showAddUser:function(ev){var node=this.$(ev.currentTarget);this.trigger("toggleAddUser",node)},templateHelpers:function(){return this.settings},initialize:function(){this.settings=Talent._.extend({},this.options,this.options.participatorOptions)},onClose:function(){}});var TaskCreateApplyUserView=Talent.ItemView.extend({template:jst["task-create/task-create-apply-user"],className:"ns-task-create-applyuser",ui:{deleteApplyUser:'[data-name="task-create-delete-applyuser"]',applyUser:'[data-name="task-create-applyuser"]'},events:function(){var events={};events["click "+this.ui.deleteApplyUser]="_deleteApprover";return events},modelEvents:{"change:applyUser":"render"},templateHelpers:function(){return this.settings},initialize:function(){this.settings=Talent._.extend({},this.options,this.options.applyUserOptions)},onRender:function(){var self=this;this.userSelectorView=new UserSelector({collection:new UserSelectorCollection});var options=util.userSelectorConfig({muti:false});var userSelectorOpt=util.userSelectorConfig(options);this.settings.container&&(userSelectorOpt["container"]=this.settings.container);this.userSelectorView.addNode(this.ui.applyUser,userSelectorOpt);this.ui.applyUser.on("submit",function(ev,user){ev.stopPropagation();self._checkApplyUser(user)});Talent.$(document).off("mousedown.task-create-apply-user-view");Talent.$(document).on("mousedown.task-create-apply-user-view",function(){self.userSelectorView&&self.userSelectorView.deleteView()})},_checkApplyUser:function(user){user["userId"]=user["Id"];var userId=this.model.get("principalUser").Id;if(userId==user["Id"]){this._showTipDialog(this.ui.applyUser,{placement:"bottom",type:"remind",body:"负责人和审批人不能是同一人",align:"left",container:this.settings["parentEl"],ico:"warn"});return}this.model.set("applyUser",user)},_deleteApprover:function(ev){var self=this;var node=Talent.$(ev.currentTarget);ev.stopPropagation();this._showTipDialog(node,{placement:"bottom",type:"confirm",body:"此操作不可恢复，您确定删除吗？",trigger:"manual",align:"center",container:this.settings["parentEl"],okHide:function(){self.model.set({applyUser:null});self.infoTipView.hide()}})},_showTipDialog:function(node,data){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",animation:false,type:"default",body:"",trigger:"manual",hasfoot:true,align:"left",html:true,container:this.$el};var options=Talent._.extend({},defaults,data);this.infoTipView=new Infotip;this.infoTipView.bindNode(node,options);this.infoTipView.show()},onClose:function(){Talent.$(document).off("mousedown.task-create-apply-user-view")}});var TaskCreateExternalPersonView=Talent.ItemView.extend({template:jst["task-create/task-create-external-person"],ui:{externalPerson:'[data-name="task-create-extend-person"]'},className:"create-external-person",events:function(){var events={};events["click "+this.ui.externalPerson]="_showExternalPerson";return events},modelEvents:{"change:extend_user":"render"},templateHelpers:function(){return this.settings},initialize:function(){this.settings=Talent._.extend({},this.options,this.options.extendPersonOptions)},_showExternalPerson:function(ev){var node=this.$(ev.currentTarget);this.trigger("showExtendPerson",node)},onClose:function(){}});var TaskCreateReplaceView=Talent.ItemView.extend({defaults:{parentEl:""},template:jst["task-create/task-create-replace"],className:"create-replace-box",ui:{checkWraper:'[data-name="task-create-replace-check-wraper"]',replace:'[data-name="task-create-replace-check"]',replaceLabel:'[data-name="task-create-replace-label"]'},events:function(){var events={};events["click "+this.ui.checkWraper]="_checkReplace";return events},modelEvents:{"change:isCanReplace":"render","change:replaceRadioChecked":"_radioCheckedEvent"},templateHelpers:function(){return this.settings},initialize:function(){var self=this;this.settings=Talent._.extend({},this.options,this.options.replaceOptions);this.userInfo=Context.getUserInfo();this.model.set({replaceRadioChecked:false,isCanReplace:false},{silent:true});this.userSelectorView=new UserSelector({collection:new UserSelectorCollection});Talent.$(document).off("mousedown.task-create-replace");Talent.$(document).on("mousedown.task-create-replace",function(){self.userSelectorView&&self.userSelectorView.deleteView()})},onRender:function(){this.$("[data-body]").infotip({type:"default",placement:"top",align:"center",container:this.settings["parentEl"]})},_checkReplace:function(){var node=this.ui.replace,modelObj=this.model.toJSON(),principalUser=modelObj.principalUser,self=this,replaceRadioChecked=modelObj.replaceRadioChecked,isCanReplace=modelObj.isCanReplace;if(!isCanReplace)return;if(replaceRadioChecked){this.model.set("replaceRadioChecked",false);this._radioCheckedEvent();this.trigger("cancelReplace")}else{this.model.set("replaceRadioChecked",true);this._radioCheckedEvent();this._bindUserSelector()}},_radioCheckedEvent:function(){var isChecked=this.model.get("replaceRadioChecked");if(!isChecked){this.model.set({publisher:null},{silent:true});this.userSelectorView.unBindNodeEvents(this.ui.replaceLabel);this.ui.replace.removeClass("tu-icon-check-active").addClass("tu-icon-checkbox-have");this.ui.replaceLabel.text("代领导发起")}else{var principalUser=this.model.get("principalUser");this.model.set({publisher:principalUser});this.ui.replace.removeClass("tu-icon-checkbox-have").addClass("tu-icon-check-active");this.ui.replaceLabel.text("代领导发起："+principalUser.Name)}},_bindUserSelector:function(){var self=this;var userSelectorOpt=util.userSelectorConfig({muti:false,bias:{left:-35,top:0}});this.settings.container&&(userSelectorOpt["container"]=this.settings.container);this.userSelectorView.addNode(this.ui.replaceLabel,userSelectorOpt);this.ui.replaceLabel.on("submit",function(ev,user){if(user.Id==self.userInfo.Id){self._showTipDialog(self.ui.replaceLabel.parent(),"不能选择自己作为代发人");return}self.ui.replaceLabel.text("代领导发起："+user.Name);self.model.set({publisher:user});self.trigger("publisherChanged")})},_showTipDialog:function(node,body){this.infoTipView&&this.infoTipView.destroy();var options={placement:"bottom",animation:false,type:"remind",body:body,trigger:"manual",hasfoot:true,align:"left",html:true,container:this.settings.container,ico:"warn"};this.infoTipView=new Infotip;this.infoTipView.bindNode(node,options);this.infoTipView.show()},onClose:function(){this.userSelectorView&&this.userSelectorView.close();Talent.$(document).off("mousedown.task-create-replace")}});var TaskCreateFollowView=Talent.ItemView.extend({template:jst["task-create/task-create-follow"],className:"task-create-follow",ui:{follow:'[data-name="task-create-follow"]'},events:function(){var events={};events["click "+this.ui.follow]="_showAddUser";return events},modelEvents:{"change:followCount":"render"},_showAddUser:function(ev){var node=this.$(ev.currentTarget);this.trigger("toggleFollowUser",node)},templateHelpers:function(){return this.settings},initialize:function(){this.settings=Talent._.extend({},this.options,this.options.followOptions)},onClose:function(){}});var TaskCreateBottomView=Talent.Layout.extend({template:jst["task-create/task-create-bottom"],defaults:{privateRangeOptions:{privateValue:2,sort:[2,3,1],privateOptions:{name:"仅相关成员可见",des:"仅任务成员可见"},publicOptions:{name:"公开",des:"所有人可见"},departmentOptions:{name:"部门可见",des:"仅我的部门可见"}},nameOptions:false,shape:"line",parentEl:"",bottomOptions:{isShowFileUpload:true,isShowPrivateBtn:true,isShowPrivateDropDown:true,isShowMessage:true,isShowPackUpBtn:true,pubBtnText:"发布"}},className:"task-create-bottom-box",ui:{uploadNewFile:".upload_new_file",pubBtn:'[data-name="set-pub-btn"]',toggle:'[data-name="toggle"]',msgTip:'[data-name="data-message"]',publishWraper:'[data-name="publish-wraper"]',privated:"div[data-name=task-create-private]",privatedCaret:'[data-name="range-caret"]',attachment:"a[data-name=file]"},events:function(){var events={};events["click "+this.ui.pubBtn]="_submitTask";events["click "+this.ui.toggle]="_toggle";events["click "+this.ui.msgTip]="_msgTip";events["click "+this.ui.privated]="_renderPrivateView";return events},modelEvents:{"change:sendUserStatus":"_changeUserMessage"},templateHelpers:function(){var privateValue=this.settings.privateRangeOptions["privateValue"];var privateText=this.privateView&&this.privateView.getDefaultPrivateText(privateValue)||"";this.settings.bottomOptions["privateText"]=privateText;return this.settings.bottomOptions},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);this.settings.bottomOptions=Talent._.extend({},this.defaults.bottomOptions,this.options.bottomOptions);this.settings.privateRangeOptions=Talent._.extend({},this.defaults.privateRangeOptions,this.options.privateRangeOptions);this.model.set({packUp:this.settings["shape"]=="line"?true:false,visibility:this.settings.privateRangeOptions.privateValue});this.privateView=new PrivateRangView(this.settings["privateRangeOptions"]);this.listenTo(this.privateView,"selected",function(data){this.model.set({privateText:data["text"],visibility:data["visibility"],privateObjType:data["privateObjType"],privateObjId:data["privateObjId"],privateValue:data["privateValue"]});var html=data["text"];this.ui.privated.html(html);if(this.settings.bottomOptions.isShowPrivateDropDown){this.ui.privated.append(this.ui.privatedCaret)}this.$el.find(".private-show").removeClass("private-show")});this.listenTo(this.privateView,"hide",function(){this.$el.find(".private-show").removeClass("private-show")});var self=this;this.on("toggletask",function(){self._toggle(this.ui.toggle)})},onRender:function(){var self=this;this.uploaderView&&this.uploaderView.close();this.$("[data-body]").infotip({type:"default",placement:"top",align:"center",container:this.$el});this._renderUploadView();this._customizeRange()},closeView:function(){this.privateView&&this.privateView.hide()},_customizeRange:function(){if(!this.settings.bottomOptions.isShowPrivateDropDown){this.ui.privatedCaret.remove();this.ui.privated.addClass("set-private-area-disable")}else{this.ui.privated.addClass("pointer")}},_renderUploadView:function(){var self=this;this.uploaderView=new UploaderComponentView({container:this.$el,openYFY:Context.IsOpenYifangyun()});this.uploaderView.on("uploadEnd",function(){self.trigger("uploadClose",self._getUploadFile())});this.uploaderView.on("deleteItem",function(){self.trigger("uploadClose",self._getUploadFile())});this.uploaderView.on("error",function(data){self.$el.find('div[id="'+data["timestamp"]+'"]').remove()});this.ui.attachment.html(this.uploaderView.render().$el)},_renderPrivateView:function(event){if(!this.settings.bottomOptions.isShowPrivateDropDown){return}event.stopPropagation();var node=Talent.$(event.currentTarget);node.addClass("private-show");this.$el.append(this.privateView.render().$el);this.privateView.show(node,{container:this.$el.parent(),pos:"topRight"})},changePubBtnDisable:function(disable){var pubBtn=this.ui.pubBtn;if(disable){this.model.set("pubBtnIsActive",true);pubBtn.removeClass("disabled")}else{this.model.set("pubBtnIsActive",false);pubBtn.addClass("disabled")}},_msgTip:function(ev){var node=this.$(ev.currentTarget),status=node.hasClass("tu-icon-check-active")?false:true;if(status){this._checkNum()}else{this.model.set("sendUserStatus",status)}},_checkNum:function(checkTag){var self=this;var check=checkTag?checkTag:false;SMSCollection.getSmsCheck({to_user_id:self.model.get("principalUser").Id}).done(function(res){if(res==1){if(!check){self.model.set("sendUserStatus",true)}self.model.set("telephone","");self.model.set("is_notify",0);self.model.set("setCheck",false)}else if(res==2||res==4){if(check){if(self.model.get("sendUserStatus")){self.model.set("sendUserStatus",false);self._moreMessagePop()}}else{self._moreMessagePop()}}else if(res==3){if(check){if(self.model.get("sendUserStatus")){self.model.set("sendUserStatus",false);self._hasNoNumberPop()}}else{self._hasNoNumberPop()}}}).fail(function(msg){self.model.set("sendUserStatus",false)})},_moreMessagePop:function(){var self=this;this.saveDialog&&this.saveDialog.close();this.saveDialog=new TDialogView({sure:true,cancel:false,type:"tipsy",showClosed:false,minWidth:300,arrow:true,autoHide:false,sure:function(){self.saveDialog.$el.hide()}});$("body").append(this.saveDialog.render().$el);this.saveDialog.show(this.ui.msgTip,"目前您企业的短信已超出许可量，请联系超管进行短信充值",{className:"warn",leftBias:8})},_hasNoNumberPop:function(){var self=this;this.saveDialog&&this.saveDialog.close();this.saveDialog=new TDialogView({type:"",showClosed:true,arrow:true,sure:true,cancel:true,autoHide:false,minWidth:350,sure:function(){var telephone=self.saveDialog.$el.find('input[name="telephone"]').val();if(!self._validatePhoneNum(telephone)){self.saveDialog.$el.find('input[name="telephone"]').parent().addClass("input-error");self.saveDialog.$el.find(".errortext_mcsmt").html("请填写正确的11位手机号码");return false}else{var is_notify=self.model.get("setCheck")?1:0;self.model.set("is_notify",is_notify);self.model.set("telephone",telephone);self.model.set("sendUserStatus",true)}}});this.$el.parent().append(this.saveDialog.render().$el);this.saveDialog.show(this.ui.msgTip.parent(),'<div class="ux_create_task_pop"><h2>请填写负责人的手机号码</h2><div class="input-default"><input type="text" name="telephone" class=""></div><div class="errortext_mcsmt"></div><div class="checkbox_wrap"><a href="javascript:void(0);" title="" class="checkbox"><span class="ico"></span></a><span>通知对方添加手机号，避免您重复填写</span></div></div>',{leftBias:0,pos:"bottom",container:this.$el.parent()});this.saveDialog.$el.find('input[name="telephone"]').on("focus",function(){self.saveDialog.$el.find('input[name="telephone"]').parent().addClass("input-focus")});this.saveDialog.$el.find('input[name="telephone"]').on("blur",function(){self.saveDialog.$el.find('input[name="telephone"]').parent().removeClass("input-focus")});this.saveDialog.$el.find('input[name="telephone"]').on("keyup",function(){self.saveDialog.$el.find(".errortext_mcsmt").html("");self.saveDialog.$el.find('input[name="telephone"]').parent().removeClass("input-error")});this.saveDialog.$el.find(".checkbox").on("click",function(events){var node=Talent.$(events.currentTarget);var status=node.hasClass("checkbox-checked")?false:true;self.model.set("setCheck",status);if(node.hasClass("checkbox-checked")){node.removeClass("checkbox-checked")}else{node.addClass("checkbox-checked")}});this.saveDialog.$el.find(".closed_dialog").on("click",function(){return true})},_changeUserMessage:function(){var sendUserStatus=this.model.get("sendUserStatus"),dom=this.ui.msgTip;dom.removeClass("tu-icon-check-active tu-icon-checkbox-have");if(sendUserStatus){dom.addClass("tu-icon-check-active").attr({"data-body":"取消短信通知负责人"})}else{dom.addClass("tu-icon-checkbox-have").attr({"data-body":"短信通知负责人"})}},_validatePhoneNum:function(val){var patten=/^\d{11}$/;var pat=RegExp(patten);if(!pat.test(val)){return false}return true},_toggle:function(ev){var isPackUp=this.model.get("packUp");if(ev.bubbles==undefined&&!isPackUp){return}var node=ev.bubbles!=undefined?this.$(ev.currentTarget):ev,txtNode=node.find(".l"),icon=node.find(".r");this.model.set("packUp",!isPackUp);icon.removeClass("tu-icon-arrow-down tu-icon-arrow-up");this.ui.publishWraper.removeClass("packup");if(isPackUp){icon.addClass("tu-icon-arrow-up");txtNode.text("收起")}else{icon.addClass("tu-icon-arrow-down");this.ui.publishWraper.addClass("packup");txtNode.text("更多信息")}this.trigger("openAdvancedMode",node,{open:!isPackUp})},_submitTask:function(ev){ev.stopPropagation();var node=this.$(ev.currentTarget);if(!this.model.get("pubBtnIsActive"))return;if(this.settings.nameOptions){if(!this.model.get("taskTitle")){this.trigger("onSubmitError");return}}this.trigger("onSubmit",node)},_getUploadFile:function(){var models=this.uploaderView.fileCollection.where({Msg:"上传成功"});var collection=new Talent.Collection(models);return collection.toJSON()},onClose:function(){this.saveDialog&&this.saveDialog.close();this.privateView&&this.privateView.close();this.uploaderView&&this.uploaderView.close()}});var TaskCreateAddUserItemView=Talent.ItemView.extend({template:jst["task-create/task-create-add-user-item"],tagName:"li",ui:{uxUserArea:".ux_user_area"},initialize:function(){if(this.model.has("name")){this.model.set("departmentTag",true);var imgTemplate='<span class="square" >'+this.model.get("name").substr(0,1)+"</span>";this.model.set("Name",this.model.get("name"));this.model.set("imgTemplate",imgTemplate);this.model.set("HasAvatar","")}else{this.model.set("departmentTag",false)}},onRender:function(){
var self=this;if(this.model.has("UserAvatar")){this.userAvatar=this.model.get("UserAvatar");if(this.userAvatar["HasAvatar"]){this.$el.find("img").addClass("radius_img30")}}else{this.userAvatar=""}this.$el.find("[title]").tipsy({gravity:"s"})},events:function(){var events={};events["mouseover "+this.ui.uxUserArea]="_changeHideNode";events["mouseout "+this.ui.uxUserArea]="_changeShowNode";events["click "+this.ui.uxUserArea]="_deleteUser";return events},_deleteUser:function(evt){this.trigger("deleteUser",this.model);evt.stopPropagation()},_changeHideNode:function(events){var node=Talent.$(events.currentTarget);if(this.userAvatar["HasAvatar"]){node.find("img").hide()}else{node.find("span").hide()}},_changeShowNode:function(events){var node=Talent.$(events.currentTarget);if(this.userAvatar["HasAvatar"]){node.find("img").show()}else{node.find("span").show()}}});var TaskCreateAddUserCompositeView=Talent.CompositeView.extend({defaults:{label:null,addUserType:"participator",limit:1},itemView:TaskCreateAddUserItemView,className:"task-create-member-list",itemViewContainer:"ul",template:jst["task-create/task-create-add-user-composite"],ui:{addUserBtn:'em[data-name="add-user-btn"]'},initialize:function(options){var self=this;this.userInfo=Context.getUserInfo();this.settings=options;this.totalCount=this.collection.length},modelEvents:{},templateHelpers:function(){return{label:this.settings.label}},onRender:function(){var self=this;this.on("itemview:deleteUser",function(view){self.collection.remove(view.model);if(view.model.get("type")=="department"){self.totalCount-=view.model.get("totalUserCount")}else{self.totalCount-=1;if(self.userInfo["Id"]==view.model.get("Id")&&self.model.get("publisher")){self.trigger("deleteSelf",view.model)}}$("body .tipsy").remove();self.trigger("selectUser",self.totalCount,self.collection.toJSON())});this.userSelectorView=new UserSelector({collection:new UserSelectorCollection});var userSelectorOpt=util.userSelectorConfig({muti:true});this.settings.container&&(userSelectorOpt["container"]=this.settings.container);this.userSelectorView.addNode(this.ui.addUserBtn,userSelectorOpt);this.ui.addUserBtn.on("submit",function(ev,user){ev.stopPropagation();if(user.data){self._smemberListSelect(user.data)}else{self._smemberListSelect([user])}});Talent.$(document).off("mousedown.task-create-add-user-composite");Talent.$(document).on("mousedown.task-create-add-user-composite",function(){self.userSelectorView&&self.userSelectorView.deleteView()})},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.children.add(view);view.render();if(!this.$el.find(this.itemViewContainer).find("li:first-child").length){this.$el.find(this.itemViewContainer).append(view.el)}else{this.$el.find(this.itemViewContainer).find("li:first-child").before(view.el)}if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)},_smemberListSelect:function(data){if(!data.length)return;var self=this;var length=0;var limit=this.settings.limit;var msg="添加的人都已存在";if(data.length===1&&data[0]["UserAvatar"]){var backStauts=this._smemberSelect(data[0]);if(!backStauts)return}Talent._.each(data,function(item){if(item.type=="department"){self.totalCount+=item.totalUserCount;var model=self.collection.findWhere({id:item.id});if(model&&data.length==1){msg="该联部门已存在"}}else{self.totalCount++;var model=self.collection.findWhere({Id:item.Id});if(model&&data.length==1){msg="该联系人已存在"}}if(model){length++}});if(self.totalCount>limit){this._showTipDialog(this.ui.addUserBtn,{placement:"bottom",type:"remind",body:this.settings.label+"不能超过"+limit+"人",align:"left",container:this.$el,ico:"warn"});return}if(length>0){this._showTipDialog(this.ui.addUserBtn,{placement:"bottom",type:"remind",body:msg,align:"left",container:this.$el,ico:"warn"});return}this.trigger("selectUser",self.totalCount,this.collection.toJSON(),data)},_smemberSelect:function(user){user=user||{};var userId=this.model.get("principalUser").Id;if(user.Id==userId){this._showTipDialog(this.ui.addUserBtn,{placement:"bottom",type:"remind",body:"ta已是任务负责人，不能成为"+this.settings.label,align:"left",container:this.$el,ico:"warn"});return false}var publisher=this.model.get("publisher");if(publisher&&publisher.Id==user.Id){this._showTipDialog(this.ui.addUserBtn,{placement:"bottom",type:"remind",body:"ta已是任务发起人，不能成为"+this.settings.label,align:"left",container:this.$el,ico:"warn"});return false}if(this.userInfo["Id"]==user.Id&&!publisher){this._showTipDialog(this.ui.addUserBtn,{placement:"bottom",type:"remind",body:"只有在代别人发布任务的时候才能成为"+this.settings.label,align:"left",container:this.$el,ico:"warn"});this.trigger("addSelf");return true}return true},_showTipDialog:function(node,data){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",animation:false,type:"default",body:"",trigger:"manual",hasfoot:true,align:"left",html:true,container:this.$el};var options=Talent._.extend({},defaults,data);this.infoTipView=new Infotip;this.infoTipView.bindNode(node,options);this.infoTipView.show()},onClose:function(){Talent.$(document).off("mousedown.task-create-add-user-composite");this.tDialogViewError&&this.tDialogViewError.close();this.userSelectorView&&this.userSelectorView.close();Talent.$(".tipsy").remove()}});var TaskCreateAddExtendUserView=Talent.ItemView.extend({template:Talent._.template('<input data-name="task-create-extend-user" value="<%=extendUser%>" placeHolder="填写外部联系人"/>'),className:"task-create-extend-user",ui:{uxInput:'input[data-name="task-create-extend-user"]'},events:function(){var events={};events["focus "+this.ui.uxInput]="_onFocus";events["blur "+this.ui.uxInput]="_onBlur";return events},initialize:function(options){this.parentEl=options.parentEl},onRender:function(){},_onFocus:function(events){var node=Talent.$(events.currentTarget);this.parentEl.addClass("input-focus")},_onBlur:function(events){var node=Talent.$(events.currentTarget);this.parentEl.removeClass("input-focus");this.model.set("extendUser",node.val())}});var i18n=Context.getI18n();var TaskCreateView=Talent.Layout.extend({defatuls:{id:"",shape:"default",templateName:"default",extraClass:"",sdkSchema:util_italentSDK(),richEditorOptions:{defaultText:"输入详情",maxWords:5e3},extendPersonOptions:false,applyUserOptions:{showBorderLeft:true},participatorOptions:{limit:100,showBorderLeft:false},followOptions:{limit:1e3,showBorderLeft:true},replaceOptions:{showBorderLeft:true},hourDateOptions:false,hourDropdownOpitons:{pos:"bottomRight"},principalOptions:{showBorderLeft:true},classOptions:{disable:false,showBorderLeft:false},classDialogOptions:{viewType:"single"},nameOptions:{defaultText:i18n["task_1"]=="任务"?"请输入您要安排的工作任务名称":"输入"+i18n["task_1"]+"名称",iconShow:true,iconClassName:"tu-icon-task",dropdownData:[],showBorderLeft:true},dateOptions:{showBorderLeft:true,pos:"bottomRight"},dataTimeRangeOptions:{},bottomOptions:{isShowFileUpload:true,isShowPrivateBtn:true,isShowPrivateDropDown:true,isShowMessage:true,isShowPackUpBtn:true,pubBtnText:"发布"},privateRangeOptions:{},requestSubmit:function(){var deferred=new Talent.$.Deferred;return deferred},toUserId:""},template:jst["task-create/task-create"],className:"tt-task-create tu-font-h5",ui:{uxAddTaskContainer:'[data-name="task-create-add-input"]',uxMemberList:'[data-name="task-create-member-list"]',uxExtend:'[data-name="task-create-extend"]',uxAddInput:'[data-name="task-create-add-input"]',uxRicheditor:'[data-name="task-create-richeditor"]',richeditorContainer:"[data-name=editor-container]",uxTools:'[data-name="task-create-tools"]',bottomArea:'[data-name="task-create-bottom"]',uxTaskContent:'input[data-name="task-create-name"]',principle:'[data-name="task-create-principle-inner"]',richEditorContent:".redactor_editor",richEditorDefaultLabel:".redactor_box label",richEditorBox:".redactor_box",uxExtendUser:'input[name="extend_user"]',uxExtendArea:'[data-name="task-create-layout-extend"]',pubBtn:'[data-name="set-pub-btn"]'},regions:{uxAddInput:'[data-name="task-create-add-input"]',uxTools:'[data-name="task-create-tools"]',bottomArea:'[data-name="task-create-bottom"]',uxMemberList:'[data-name="task-create-member-list"]',uxRicheditor:'[data-name="task-create-richeditor"]',uxExtend:'[data-name="task-create-extend"]',classArea:'[data-name="task-create-class"]',inputArea:'[data-name="task-create-name"]',principleArea:'[data-name="task-create-principle-area"]',taskDateArea:'[data-name="task-create-date"]',workHourArea:'[data-name="task-create-hour-date"]',participatorArea:'[data-name="task-create-participator"]',applyUserArea:'[data-name="task-create-apply-user"]',externalPersonArea:'[data-name="task-create-external-person"]',replaceArea:'[data-name="task-create-replace"]',uxExtendArea:'[data-name="task-create-layout-extend"]',followArea:'[data-name="task-create-follow"]'},events:function(){var events={};return events},modelEvents:{"change:taskTitle":"_onValueChange","change:code":"_onValueChange"},initialize:function(options){var self=this,defaults=this.defaults;this.timestamp=(new Date).getTime();this.userInfo=Context.getUserInfo();this.tenantId=Context.getGlobal("tenantInfo").Id;this.settings=Talent._.extend({},this.defatuls,options);this.model.set("id",this.settings["id"]);this._customTemplate();for(var key in options){if(typeof options[key]=="object"){this.settings[key]=Talent._.extend({},this.defatuls[key],options[key])}}this.formatSettingA();if(this.settings["extraClass"]){this.$el.addClass(this.settings["extraClass"])}this.participatorCollection=new Talent.Collection;this.listenTo(this.participatorCollection,"add remove reset",function(){this._synNum();this.trigger("painting")});this.followCollection=new Talent.Collection;this.listenTo(this.followCollection,"add remove reset",function(){this.trigger("painting")});this.localStorage=Context.localStorage();this.initModelData=this.model.toJSON();this._initData();this.addUserType="participator"},formatSettingA:function(){var taskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");if(!taskAdvancedSetting)return;var taskFunctionSetting=taskAdvancedSetting["TaskFunctionSetting"];if(!taskFunctionSetting)return;if(taskFunctionSetting.TaskSMS==false){this.settings["bottomOptions"].isShowMessage=taskFunctionSetting.TaskSMS}if(taskFunctionSetting.TaskParticipants==false){this.settings["participatorOptions"]=taskFunctionSetting.TaskParticipants}if(taskFunctionSetting.TaskFollower==false){this.settings["followOptions"]=taskFunctionSetting.TaskFollower}if(taskFunctionSetting.TaskEntrustPublisher==false){this.settings["replaceOptions"]=taskFunctionSetting.TaskEntrustPublisher}var taskRecommendSetting=taskAdvancedSetting["TaskRecommendSetting"];if(!taskRecommendSetting)return;if(taskRecommendSetting.TaskApply==false){this.settings["applyUserOptions"]=taskRecommendSetting.TaskApply}},onRender:function(){this._renderBottomView();this._renderAll()},onShow:function(){this._renderRichEditor();this._customModuleShow()},templateHelpers:function(){return{timestamp:this.timestamp,showclassview:this.settings.classOptions.disable}},_customModuleShow:function(){var opt=this.settings;var ISVType=Context.getGlobal("ISVType");if(ISVType&&ISVType!=1e4){opt["bottomOptions"].isShowMessage=false}if(opt["shape"]!="line"){this._showAdvancedMode()}if(!opt["classOptions"]){this.$el.addClass("task-create-none-class")}if(opt["applyUserOptions"]){this._getCurrentUserApproval()}if(opt["followOptions"]){this._renderFollowView()}if(!opt.richEditorOptions){this.$el.find("[data-name=editor-container]")&&this.$el.find("[data-name=editor-container]").hide()}if(!(opt.nameOptions||opt.principalOptions||opt.dateOptions)){this.ui.uxAddTaskContainer.remove()}if(opt.hourDateOptions==false&&opt.participatorOptions==false&&opt.extendPersonOptions==false&&opt.applyUserOptions==false&&opt.replaceOptions==false&&opt.classOptions==false){this.ui.uxTools.remove()}},_customTemplate:function(){if(this.settings.template){this.template=this.settings.template}if(this.settings["templateName"]=="dateRichEditor"){this.settings=Talent._.extend({},this.settings,{privateRangeOptions:false,extendPersonOptions:false,applyUserOptions:false,participatorOptions:false,replaceOptions:false,hourDateOptions:false,principalOptions:false,classOptions:false,nameOptions:false,dateOptions:{showBorderLeft:false,pos:"bottom"},dataTimeRangeOptions:{isShowDateView:false,isShowCycleView:false,isShowLongView:true,count:2,isShowTab:false,rangepickerOptions:{timePicker:false,format:"YYYY/MM/DD"}}});this.settings["bottomOptions"]=Talent._.extend({},this.settings["bottomOptions"],{isShowPrivateBtn:false,isShowMessage:false,isShowPackUpBtn:false});this.template=jst["task-create/task-create-customize-date-richeditor"];this.$el.addClass("tt-task-create-date-richeditor")}if(this.settings["templateName"]=="workhour"){this.settings=Talent._.extend({},this.settings,{privateRangeOptions:false,extendPersonOptions:false,applyUserOptions:false,participatorOptions:false,replaceOptions:false,principalOptions:false,classOptions:false,nameOptions:{iconShow:false,defaultText:"工作内容",showBorderLeft:false},hourDateOptions:{showBorderLeft:true},hourDropdownOpitons:{pos:"bottomRight"},dateOptions:{showBorderLeft:true,pos:"bottomRight",isShowTab:false},dataTimeRangeOptions:{isShowTab:false,count:1,rangepickerOptions:{maxDate:moment(),isShowCycleView:false,isShowLongView:false}}});this.settings["bottomOptions"]=Talent._.extend({},this.settings["bottomOptions"],{isShowPrivateBtn:false,isShowMessage:false});this.template=jst["task-create/task-create-customize-work-hour"]}},_renderAll:function(){var opt=this.settings,renders=[{condition:opt.classOptions,method:"_renderClassView"},{condition:opt.principalOptions,method:"_renderPrincipleView"},{condition:opt.hourDateOptions,method:"_renderWorkHourView"},{condition:opt.participatorOptions,method:"_renderParticipatorsView"},{condition:opt.applyUserOptions,method:"_renderApplyUserView"},{condition:opt.extendPersonOptions,method:"_renderExternalPersonView"},{condition:opt.replaceOptions,method:"_renderReplacerView"},{condition:opt.nameOptions,method:"_renderTaskCreateNameView"},{condition:opt.dateOptions,method:"_renderDateView"},{condition:opt.followOptions,method:"_renderFollowView"}];for(var i=0,len=renders.length;i<len;i++){if(renders[i].condition){this[renders[i]["method"]]()}}},_getUserInfo:function(){var self=this;var userId=this.settings.toUserId;UserCollection.getData({ids:[userId].join(",")}).done(function(resp){var user=resp[userId];if(!user)return;self.model.set({principalUser:{Id:user.Id,Name:user.Name,Email:user.Email}})}).fail(function(msg){})},_submitSuccess:function(){var self=this,storage=this.localStorage,id=this.model.get("id"),publisher=this.model.get("publisher");storage.remove("TaskCreateName_"+this.userInfo["Id"]+id);storage.remove("TaskCreateDes_"+this.userInfo["Id"]+id);this._initData();this.render();this.onShow();var button=this.bottomView.ui.pubBtn;if(publisher){this._showTipDialog(button,{placement:"bottom",animation:false,type:"confirm",body:"查看代他人发起的任务到任务中心-代发任务",trigger:"manual",okbtn:"马上查看",cancelbtn:"我知道了",hasfoot:true,align:"right",html:true,width:310,container:this.$el,okHide:function(){location.href="#more/tasks?relation=4"}})}else{this._showTipDialog(button,{placement:"bottom",type:"remind",body:"发布成功",align:"right",width:200,container:this.$el,ico:"success",hide:function(){self.trigger("afterSubmitSuccess")}})}this.TAjaxIng=false},_submitError:function(msg){this.TAjaxIng=false;if(msg){var button=this.bottomView.ui.pubBtn;this._showTipDialog(button,{placement:"bottom",type:"remind",body:msg,align:"right",container:this.$el,ico:"warn"})}},_invalidError:function(){this.ui.uxAddTaskContainer.css("border-color","red");this.ui.uxAddTaskContainer.animate({"border-color":"#aaa"},2e3)},_onValueChange:function(){var val=this.model.get("code");if(this.settings.nameOptions){val=this.model.get("taskTitle")}this.bottomView&&this.bottomView.model.set("pubBtnIsActive",val?true:false)},_initData:function(){var self=this;this.participatorCollection.reset([]);this.followCollection.reset([]);this.addUserType=null;var modelDefaultData={participatorsCount:0,participators:"",followCount:0,follows:"",principalUser:{Id:this.userInfo.Id,Name:this.userInfo.Name},applyUser:"",publisher:null,labelId:"",labelType:"",labelName:"",taskTitle:"",startDate:moment().format("YYYY/MM/DD 08:00"),endDate:moment().format("YYYY/MM/DD 18:00"),isCycle:false,isLongTerm:false,hourDate:"",minuteDate:"",extendUser:"",cycType:2,cycStartDay:"",cycEndDay:"",cycStartHour:"08",cycStartMinute:"00",cycEndHour:"18",cycEndMinute:"00",visibility:1,privateObjType:0,privateObjId:0,code:"",sendUserStatus:false,file:[]};var dataTimeRangeOptions=this.settings["dataTimeRangeOptions"];if(dataTimeRangeOptions&&dataTimeRangeOptions["rangepickerOptions"]){modelDefaultData["startDate"]=dataTimeRangeOptions["rangepickerOptions"]["startDate"]||moment().format("YYYY/MM/DD 08:00");modelDefaultData["endDate"]=dataTimeRangeOptions["rangepickerOptions"]["endDate"]||moment().format("YYYY/MM/DD 18:00")}var initData=Talent._.extend({},modelDefaultData,this.initModelData);this.model.set(initData,{silent:true});if(this.settings.toUserId!=""){this._getUserInfo()}},_synNum:function(){this.model.set("participatorsCount",this.participatorCollection.length)},_onSubmitForm:function(){var self=this,modelObj=this.model.toJSON(),formatData=this.formatPostData(),participatorsLimit=this.settings["participatorOptions"]["limit"],button=this.bottomView.ui.pubBtn;if(this.TAjaxIng)return;this.TAjaxIng=true;if(this.model.get("participatorsCount")>participatorsLimit){this._showTipDialog(this.$('[data-name="set-pub-btn"]').parent(),{placement:"bottom",type:"remind",body:"参与人不能超过"+participatorsLimit+"人",align:"center",container:this.$el,ico:"warn"});this.TAjaxIng=false;return}if(this.model.has("telephone")&&this.model.has("is_notify")){this._addBothPhoneNum()}button.html("正在"+this.settings.bottomOptions.pubBtnText+"……");this.settings["requestSubmit"](formatData,this.model.toJSON()).done(function(request){self._submitSuccess();request&&request.medalDetail&&util.upaasMedal()(request.medalDetail)}).fail(function(msg){button.html(self.settings.bottomOptions.pubBtnText);self._submitError(msg)})},formatPostData:function(){var modelObj=this.model.toJSON();var code=modelObj.code;var postData={Participators:modelObj.participatorsCount?this._getParticipators(this.participatorCollection.models):[],MessageUsers:[],TaskName:Talent._.escape(modelObj.taskTitle),PrincipalUser:modelObj.principalUser.Id,StartDate:modelObj.startDate,EndDate:modelObj.endDate,Importance:false,Visibility:modelObj.visibility==3?2:modelObj.visibility,DepartmentId:modelObj.privateObjId,Description:code,FileUrls:this._getFileUrls(),RemindTime:"",RemindContent:"",RemindType:0,hourDate:modelObj.hourDate,minuteDate:modelObj.minuteDate,extend_user:modelObj.extendUser,CycType:"",CycStartDate:"",CycStartTime:"",CycEndDate:"",CycEndTime:"",ApplyUserId:modelObj.applyUser&&modelObj.applyUser["Id"]?modelObj.applyUser["Id"]:0,IsLongTerm:modelObj.isLongTerm,LabId:modelObj.labelId,LabType:modelObj.labelType,PublisherId:modelObj["publisher"]&&modelObj["publisher"].Id!=this.userInfo.Id?modelObj["publisher"].Id:0,documents:this._getYFYFile(),Followers:modelObj.followCount?this._getParticipators(this.followCollection.models):[]};if(modelObj.sendUserStatus){var principalUser=this.model.get("principalUser");var messageUser={Email:principalUser.Email,Name:principalUser.Name,Id:principalUser.Id};postData["MessageUsers"]=[messageUser]}var startTime=modelObj.cycStartHour+":"+modelObj.cycStartMinute,endTime=modelObj.cycEndHour+":"+modelObj.cycEndMinute;if(modelObj.isCycle){postData["CycType"]=modelObj.cycType;postData["CycStartDate"]=modelObj.cycStartDay;postData["CycStartTime"]=moment().format("YYYY/MM/DD")+" "+startTime;postData["CycEndTime"]=moment().format("YYYY/MM/DD")+" "+endTime;postData["CycEndDate"]=modelObj.cycEndDay;postData["IsLongTerm"]=false}return postData},_addBothPhoneNum:function(){var self=this;var telephone=this.model.get("telephone");var userId=this.model.get("principalUser").Id;var is_notify=this.model.get("is_notify");var postSmsNotifyAddNum=SMSCollection.postSmsNotifyAddNum;postSmsNotifyAddNum({phoneNum:telephone,to_user_id:userId,is_notify:is_notify})},_getFileUrls:function(){var fileArr=[];var fileUrls="";_.each(this.model.get("file"),function(object){if(object.DfsPath){fileArr.push(object.DfsPath)}});fileUrls=fileArr.join(",");return fileUrls},_getYFYFile:function(){var yfy_data=[];_.each(this.model.get("file"),function(object){if(object.isFromYFY){var item_data={};item_data.relatedFileId=object.id;item_data.name=object.FileName;item_data.size=object.size;item_data.fileType=object.MediaType;item_data.shareCode=object.share_code;if(object.imageUrl){item_data.thumbnailGenerated=true}else{item_data.thumbnailGenerated=false}item_data.documentSource=3;yfy_data.push(item_data)}});return yfy_data},_getParticipators:function(models){var collection=new Talent.Collection([]);_.each(models,function(model){if(model.get("departmentTag")){var model=new Talent.Model({Email:model.get("Name")+":"+model.get("id")+":dep_members",Name:model.get("Name"),Id:model.get("id")});collection.add(model)}else{var model=new Talent.Model({Email:model.get("Email"),Name:model.get("Name"),Id:model.get("Id")});collection.add(model)}});return collection.toJSON()},_renderRichEditor:function(){if(!this.settings.richEditorOptions)return;var self=this,richEditorOptions=this.settings.richEditorOptions,defaultText=this.settings.richEditorOptions.defaultText,maxWords=this.settings.richEditorOptions.maxWords,localStorage=Context.localStorage(),timeMap=(new Date).getTime();var dailyStorage=localStorage.get("TaskCreateDes_"+this.userInfo["Id"]+this.model.get("id"));if(dailyStorage){this.model.set("code",dailyStorage.code);this.model.set("codeOnlyText",dailyStorage.textOnly);this.ui.uxRicheditor.append(dailyStorage.code)}var option={containerId:"task-create-newEditor-"+this.timestamp,placeholder:defaultText,maxWords:maxWords};this.richEditor=new NewRichEditor(option);this.listenTo(this.richEditor,"editorChange",function(data){this.model.set("code",data.html);this.model.set("codeOnlyText",data.textOnly);localStorage.set("TaskCreateDes_"+this.userInfo["Id"]+this.model.get("id"),{__setTime:timeMap,code:data.html,codeOnlyText:data.textOnly});this._changePubBtn()});this.richEditor.show();this._changePubBtn();this.$el.find("[data-name=editor-container]")&&this.$el.find("[data-name=editor-container]").hide()},_formatCode:function(){if(!this.richEditor){return false}var txt=this.richEditor.callMethods("getCode");var testDes=txt.toLowerCase();if(!/(<(img|table)[^>]*>)/g.test(testDes)){testDes=testDes.replace(/(<[^>]*>(<[^>]*>|&nbsp;)?(<\/[^>]*>)?)|&nbsp;/g,"");testDes=Talent.$.trim(testDes);if(testDes==""){txt=""}}return txt},_renderBottomView:function(){var self=this;this.bottomView=new TaskCreateBottomView({model:this.model,shape:this.settings["shape"],bottomOptions:this.settings.bottomOptions,nameOptions:this.settings.nameOptions,privateRangeOptions:this.settings.privateRangeOptions,parentEl:this.$el});this.listenTo(this.bottomView,"openAdvancedMode",function(node,options){if(!options["open"]){this._showAdvancedMode()}else{this._hideAdvancedMode()}this.trigger("painting")});this.listenTo(this.bottomView,"onSubmitError",function(){this._invalidError()});this.listenTo(this.bottomView,"onSubmit",function(node){this._onSubmitForm(node)});this.listenTo(this.bottomView,"uploadClose",function(fileList){self.model.set("file",fileList)});this.listenTo(this.bottomView,"resetData",function(){self.model.set(self.initData)});this.bottomArea.show(this.bottomView)},_renderClassView:function(){this.classView=new TaskCreateClassView({model:this.model,parentEl:this.$el,classOptions:this.settings["classOptions"],classDialogOptions:this.settings["classDialogOptions"]});this.classArea.show(this.classView)},_renderTaskCreateNameView:function(){var self=this;this.inputView=new TaskCreateNameView({model:this.model,parentEl:this.ui.uxAddTaskContainer,nameOptions:this.settings.nameOptions});this.inputView.on("focus",this._trigerfocus,this);this.listenTo(this.inputView,"keyup",function(){this._changePubBtn()});this.listenTo(this.inputView,"submit",function(){this._onSubmitForm()});this.inputArea.show(this.inputView)},_trigerfocus:function(){this.bottomView.trigger("toggletask")},_changePubBtn:function(){if(!this.settings["nameOptions"]){if(this.richEditor&&this.richEditor.editor&&this.richEditor.editor.hasContent&&!this.richEditor.editor.hasError){this.bottomView.changePubBtnDisable(true)}else{this.bottomView.changePubBtnDisable(false)}return}var taskTitle=Talent.$.trim(this.model.get("taskTitle"));var richState=this.settings.richEditorOptions?this.richEditor&&this.richEditor.editor&&!this.richEditor.editor.hasError:true;if(taskTitle&&taskTitle!==""&&richState){this.bottomView.changePubBtnDisable(true)}else{this.bottomView.changePubBtnDisable(false)}},_renderPrincipleView:function(){this.principleView=new TaskCreatePrincipleView({model:this.model,principalOptions:this.settings.principalOptions,container:this.$el,sdkSchema:this.settings.sdkSchema});this.listenTo(this.principleView,"changePrincipal",function(options){this._changePrincipalAfter(options.user);this.trigger("changePrincipal",this.model.toJSON())});this.principleArea.show(this.principleView)},_changePrincipalAfter:function(user){var isLoginUser=user.Id==this.userInfo.Id&&true;isLoginUser&&this.model.set({publisher:null,replaceRadioChecked:false});this.model.set({principalUser:user,isCanReplace:!isLoginUser});if(user.Id==this.userInfo.Id){this.model.set("")}if(!this.settings["applyUserOptions"]){this.model.set({principalUser:user});return}var applyUser=this.model.get("applyUser");if(applyUser&&applyUser["Id"]==user["Id"]){this.model.set({applyUser:null,isCanReplace:true,principalUser:user});return}else{this._getApprovalUserData(user.Id)}if(this.participatorCollection.length){var userList=Talent._.filter(this.participatorCollection.toJSON(),function(item){return item["Id"]!=user["Id"]});this.participatorCollection.reset(userList);this.model.set("participatorsCount",userList.length)}if(this.followCollection.length){var followItem=this.followCollection.findWhere({Id:user["Id"]});if(followItem){this.followCollection.remove(followItem);this.model.set("followCount",this.followCollection.length)}}},_renderDateView:function(){this.taskDateView=new TaskCreateDateView({model:this.model,parentEl:this.$el,dateOptions:this.settings["dateOptions"],dataTimeRangeOptions:this.settings["dataTimeRangeOptions"],templateName:this.settings["templateName"],sdkSchema:this.settings.sdkSchema});this.listenTo(this.taskDateView,"selectDate",function(node,data){this.trigger("selectDate",node,this.model.toJSON())});this.taskDateArea.show(this.taskDateView)},_getCurrentUserApproval:function(){var applyUser=this.model.get("applyUser"),userId=this.model.get("principalUser").Id;if(this.settings.applyUserOptions&&!applyUser){this._getApprovalUserData(userId)}},_getApprovalUserData:function(userId){var self=this,getToUserIdSuperior=OrgCollection["getToUserIdSuperior"];getToUserIdSuperior({to_user_id:userId}).done(function(resp){self.model.set("applyUser",resp)})},_renderWorkHourView:function(){this.workHourView=new TaskCreateWorkHourView({model:this.model,parentEl:this.$el,hourDateOptions:this.settings["hourDateOptions"],hourDropdownOpitons:this.settings["hourDropdownOpitons"]});this.workHourArea.show(this.workHourView)},_renderParticipatorsView:function(){this.participatorView=new TaskCreateParticipatorView({model:this.model,participatorOptions:this.settings.participatorOptions});this.listenTo(this.participatorView,"toggleAddUser",function(){this._showAddUserArea("participator")});this.participatorArea.show(this.participatorView)},_renderFollowView:function(){this.followView=new TaskCreateFollowView({model:this.model,followOptions:this.settings.followOptions});this.listenTo(this.followView,"toggleFollowUser",function(){this._showAddUserArea("follow")});this.followArea.show(this.followView)},_showAddUserArea:function(type){this.trigger("painting");if(type==this.addUserType&&this.ui.uxExtendArea.is(":visible")){this._hideExtendArea()}else{this.addUserType=type;this._renderAddUserCompositeView();this._showExtendArea()}},_renderAddUserCompositeView:function(){var self=this;var label=null;if(this.addUserType=="follow"){label="关注者"}if(this.addUserType=="participator"){label="参与人"}var collection=this.participatorCollection;if(this.addUserType=="follow"){collection=this.followCollection}this.addUserCompositeView=new TaskCreateAddUserCompositeView({collection:collection,model:this.model,container:this.$el,addUserType:this.addUserType,label:label,limit:this.settings[this.addUserType+"Options"].limit});this.listenTo(this.addUserCompositeView,"selectUser",function(totalCount,allUser,newUser){var hadAddLen=0;var reduceCollection=this.addUserType=="follow"?this.participatorCollection:this.followCollection;if(newUser&&newUser.length){for(var i=0;i<newUser.length;i++){var item=newUser[i];if(item.type=="department"){var model=reduceCollection.findWhere({id:item.id});if(!model){this[this.addUserType+"Collection"].add(item)}else{hadAddLen++}}else{var model=reduceCollection.findWhere({Id:item.Id});if(!model){this[this.addUserType+"Collection"].add(item)}else{hadAddLen++}}}}if(hadAddLen&&newUser.length==1){this._showTipDialog(this.addUserCompositeView.ui.addUserBtn,{placement:"bottom",type:"remind",body:"您添加的已是相关成员",align:"left",container:this.$el,ico:"warn"})}var principalUserId=this.model.get("principalUser").Id;if(self.addUserType=="participator"){self.model.set("participatorsCount",this.participatorCollection.length)}if(self.addUserType=="follow"){self.model.set("followCount",this.followCollection.length)}});this.listenTo(this.addUserCompositeView,"addSelf",function(){this.model.set({replaceRadioChecked:true,publisher:this.model.get("principalUser")})});this.listenTo(this.addUserCompositeView,"deleteSelf",function(){this.model.set({replaceRadioChecked:false,publisher:null})});this.uxExtendArea.show(this.addUserCompositeView)},_renderAddExtendUserItemView:function(){var self=this;if(this.addExtendUserItemView)return;this.addExtendUserItemView=new TaskCreateAddExtendUserView({model:this.model,parentEl:this.ui.uxExtendArea})},_showExtendPersonArea:function(type){this.uxExtendArea.show(this.addExtendUserItemView);if(type==this.addUserType&&this.ui.uxExtendArea.is(":visible")){this._hideExtendArea()}else{this.addUserType=type;this._showExtendArea();this.addExtendUserItemView.ui.uxInput.focus()}},_hideExtendArea:function(){this.ui.uxExtendArea.hide()},_showExtendArea:function(){this.ui.uxExtendArea.show()},_renderApplyUserView:function(){this.applyUserView=new TaskCreateApplyUserView({model:this.model,applyUserOptions:this.settings.applyUserOptions,parentEl:this.$el,container:this.$el});this.applyUserArea.show(this.applyUserView)},_renderExternalPersonView:function(){this.externalPersonView=new TaskCreateExternalPersonView({model:this.model,extendPersonOptions:this.settings.extendPersonOptions});this.listenTo(this.externalPersonView,"showExtendPerson",function(){this._showExtendPersonArea("extend")});this.externalPersonArea.show(this.externalPersonView);this._renderAddExtendUserItemView()},_renderReplacerView:function(){this.replaceView=new TaskCreateReplaceView({model:this.model,replaceOptions:this.settings.replaceOptions,parentEl:this.$el,container:this.$el});this.listenTo(this.replaceView,"cancelReplace",function(){if(this.participatorCollection.length){var loginUser=this.participatorCollection.findWhere({
Id:this.userInfo.Id});if(loginUser){this.participatorCollection.remove(loginUser)}}if(!this.followCollection.length)return;var followUser=this.followCollection.findWhere({Id:this.userInfo.Id});if(followUser){this.followCollection.remove(followUser);this.model.set("followCount",this.followCollection.length)}});this.listenTo(this.replaceView,"publisherChanged",function(){var publisher=this.model.get("publisher");this.participatorCollection.remove(this.participatorCollection.findWhere({Id:publisher.Id}))});this.replaceArea.show(this.replaceView)},_showAdvancedMode:function(){this.ui.uxTools&&this.ui.uxTools.show();this.$el.find("[data-name=editor-container]")&&this.$el.find("[data-name=editor-container]").show()},_hideAdvancedMode:function(){this.ui.uxTools&&this.ui.uxTools.hide();this.$el.find("[data-name=editor-container]")&&this.$el.find("[data-name=editor-container]").hide();this.ui.uxExtendArea.hide()},_showTipDialog:function(node,data){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",animation:false,type:"default",body:"",trigger:"manual",hasfoot:true,align:"left",html:true,container:this.$el};var options=Talent._.extend({},defaults,data);this.infoTipView=new Infotip;this.infoTipView.bindNode(node,options);this.infoTipView.show()},onClose:function(){Talent.$("body .redactor_dropdown").remove();this.Dialog&&this.Dialog.close();this.bottomView&&this.bottomView.close();this.richEditor&&this.richEditor.close()}});var TaskListQuickCommontView=Talent.ItemView.extend({defaults:{type:"comment"},className:"quick-cat",template:jst["task-list/task-list-quick-comment"],ui:{btnAll:"[data-name=quick-comment-all]",btnAdd:"[data-name=quick-comment-add]",btnClosed:"[data-name=closed]"},templateHelpers:function(){return{typeName:this.settings.type=="comment"?"沟通":"进展"}},events:function(){var events={};events["click "+this.ui.btnAll]="_openAllHandler";events["click "+this.ui.btnAdd]="_addAllHandler";events["click "+this.ui.btnClosed]="_closedHandler";return events},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)},_openAllHandler:function(){this.trigger("openTaskDetail")},_addAllHandler:function(){this.trigger("add")},_closedHandler:function(){this.trigger("closed")}});var TaskListItemView=Talent.CompositeView.extend({tagName:"li",className:"planitem",itemViewContainer:".child-list",template:jst["task-list/task-list-item"],modelEvents:{change:"renderAfterCollectData","change:tasks":"_resetCollection","change:status":"_changeStatue","change:active":"_changeActive","change:editable":"render"},ui:{kClass:".klass_ttpl",childList:".child-list",moveTop:"[data-name=move-top]",packup:'[data-name="packup"]',notice:'span[data-name="notice_plan"]',setMark:'span[data-name="set-mark"]',deletePlan:'span[data-name="plan-delete"]',updateKlass:'[data-name="update-klass"]',principle:"[data-name=principle]",itemNode:"[data-name=list-item]"},events:function(){var events={};events["click "+this.ui.setMark]="_setMark";events["mouseenter "+this.ui.kClass]="_mouseenterkKlass";events["mouseleave "+this.ui.kClass]="_mouseleavekKlass";events["click "+this.ui.moveTop]="_moveTopClickHandler";events["click "+this.ui.packup]="_togglePackHandler";events["click "+this.ui.notice]="_bindNotice";events["click "+this.ui.deletePlan]="_checkDelete";events["mouseup "+this.ui.deletePlan]="_stopMouseUpEvent";events["click "+this.ui.updateKlass]="_clickUpdateKlass";events["mouseup "+this.ui.updateKlass]="_stopMouseUpEvent";return events},_changeActive:function(){if(this.model.get("active")){this.ui.itemNode.addClass("list-li_active")}else{this.ui.itemNode.removeClass("list-li_active")}},_changeLabName:function(){var labelName=this.model.get("labelName"),labelId=this.model.get("labelId"),labelName=Talent._.substringWithM(labelName,8,true);if(!labelId||labelName==""){labelName="分类/项目";this.ui.kClass.removeClass("active")}this.ui.kClass.html(labelName)},_resetCollectionOnMoveTop:function(view){var id=view.model.get("id"),collectionData=this.collection.toJSON(),currentData=[],newData=[],self=this,queryParams;queryParams={workId:this.settings.move.workId,mileStoneId:this.settings.move.mileStoneId,baseOn:this.settings.move.baseOn,referenceObjId:"",movingObjId:id,positionType:3};this._commitNewOrder(queryParams).done(function(resp){currentData=_.findWhere(collectionData,{id:id});newData.push(currentData);_.each(collectionData,function(item){if(item.id!=currentData.id)newData.push(item)});self.settings.move.baseOn=1;_.each(newData,function(el,index){el.dataIndex=index});self.collection.reset(newData);self.render();self.trigger("move")}).fail(function(msg){})},_resetCollectionOnDrag:function(params){var collection=this.model.get("collection").toJSON(),referenceModel=_.findWhere(collection,{id:+params.referenceObjId}),movingModel=_.findWhere(collection,{id:+params.movingObjId}),positionType=params.positionType;collection.splice(_.indexOf(collection,movingModel),1);if(positionType==1){collection.push(movingModel)}else{var referenceModelIndex=_.indexOf(collection,referenceModel);if(referenceModelIndex){collection.splice(referenceModelIndex,0,movingModel)}else{collection.unshift(movingModel)}}_.each(collection,function(el,index){el.dataIndex=index});this.collection.reset(collection)},initialize:function(options){var self=this;this.on("itemview:moveTopAtChild",function(view){self._resetCollectionOnMoveTop(view)});this.on("itemview:move",function(view,queryParams){self.trigger("move")});this.i18n=Context.getI18n();this.settings=Talent._.extend({},options);this.cacheClickNode=null;this.on("itemview:show",function(view){if(self.settings.move.drag){self._drag()}});this.on("itemview:deleted",function(view,node,model){self.trigger("deleted",node,model)});this.on("itemview:openSub",function(view,node,model){self.trigger("openSub",node,model)});this.on("itemview:painting",function(view,node,model){self.trigger("painting")});this.on("itemview:changeStatue",function(){var counter=self.model.get("counter");if(!counter)return;counter.finishTaskTotal=Talent._.where(self.collection.toJSON(),{status:2}).length;self.model.unset("counter",{silent:true});self.model.set({counter:counter})});this.userInfo=Context.getUserInfo();this.counter=this.model.get("counter");delete this.settings.model;delete this.settings.collection;this.settings.childrenModel[this.model.get("taskId")]=this.model;var tasks=this.model.get("collection")||[];var modelDeploy=this.model.get("currentDeploy"),defaultDeploy=tasks.length?this.settings["deployAll"]:false;this.model.set({isChildTask:this.settings["isChildTask"],currentDeploy:modelDeploy==undefined?defaultDeploy:modelDeploy,active:false},{silent:true});if(this.model.get("collection")){this.collection=this.model.get("collection")}this._sdkEvent()},_sdkEvent:function(){if(!util_italentSDK())return;var self=this;window.iTalentSDK.register([])},templateHelpers:function(){var itemData=this.model.toJSON();var isAccept=this.model.get("isAccept");var Mapping={0:{iconName:"tu-icon-checkbox-have",tipTxt:"未开始"},1:{iconName:"tu-icon-ing",tipTxt:"进行中"},2:{iconName:"tu-icon-check-active",tipTxt:"已完成"},3:{iconName:"tu-icon-delay",tipTxt:"已延迟"},4:{iconName:"tu-icon-cross2",tipTxt:"已取消"},5:{iconName:"tu-icon-weijieshou",tipTxt:"未接受"},6:{iconName:"tu-icon-pause",tipTxt:"暂停中"}};var Status=this.model.get("status"),startDate=this.model.get("startDate"),endDate=this.model.get("deadLine"),time=this.model.get("time")?this.model.get("time"):"",url="";url="push-screen-id="+this.model.get("Id");var settings=this.settings,showMoveTopBtn=false;if(settings.move){var pageIndex=settings.move.pageIndex;if(itemData.parentTaskId==null){if(pageIndex==1&&itemData.dataIndex==0){}else{showMoveTopBtn=true}}else{if(itemData.dataIndex!=0){showMoveTopBtn=true}}}var cycleId=this.model.get("cycleId"),cycleable=this.model.get("cycleable");var helpers=Talent._.extend({},this.options,{isShowWorkTime:Context.getGlobal("TaskAdvancedSetting").TaskFunctionSetting.TaskWorkHour,loginUserId:Context.getUserInfo().Id,StatusTip:Mapping[Status]["tipTxt"],StatusIcon:Mapping[Status]["iconName"],startDate:this.isThisYear(startDate),deadLine:this.isThisYear(endDate),fromNow:this._fromNow(endDate),createDate:this.isThisYear(this.model.get("createDate")),i18n:this.i18n,time:time,url:url,context:Context,taskName:this.model.get("taskName"),drag:this.settings.move.drag,moveTop:this.settings.move.moveTop,showMoveTopBtn:showMoveTopBtn,ables:{principal:this.model.get("editable")&&!this.model.get("isApply"),date:this.model.get("editable")&&this.model.get("cycleId")==0&&!this.model.get("isApply"),comment:true,addTask:this.model.get("isAddMenu"),experience:this.model.get("isAddMenu"),workTime:this.model.get("isAddMenu")}});delete helpers.isChildTask;delete helpers.deployAll;return helpers},onRender:function(){var self=this;this.$el.attr("id",this.model.get("id"));if(util_italentSDK()){this._changePrincipalSDK()}else{this._changePrincipal()}this._changeLabName()},_changePrincipalSDK:function(){var self=this;var node=this.ui.principle;node.on("click",function(){var data={viewType:"single",taskId:self.model.get("taskId")},host="//"+location.host+"/widget#sdk/user-selector";window.iTalentSDK&&window.iTalentSDK.showPopup(host,602,407,data);window.iTalentSDK.register({listenEvent:"tita_more_user-selector-submit",context:this,cb:function(resp){self._requestChangePrincipal(resp.data.taskId,resp.user.Id)}})})},_changePrincipal:function(){if(this.model.get("editable")){}else{return}var self=this;var node=this.ui.principle;this.userSelectorView&&this.userSelectorView.close();this.userSelectorView=new UserSelector({collection:new UserSelectorCollection,container:this.$el});var options=util.userSelectorConfig({viewType:"single"});this.userSelectorView.addNode(node,options);node.on("submit",function(ev,user){self._requestChangePrincipal(self.model.get("taskId"),user.Id)})},_requestChangePrincipal:function(taskId,userId){var self=this;TaskCollection.updateTaskPrincipalUser({task_id:taskId,to_user_id:userId}).done(function(resp){self.model.set({principalUser:resp.principalUser})})},_changeStatue:function(){this.trigger("changeStatue")},_togglePackHandler:function(ev){ev.stopPropagation();var node=Talent.$(ev.currentTarget),model=this.model,modelData=model.toJSON();if(modelData.collection&&modelData.collection.length){model.set({currentDeploy:!modelData.currentDeploy})}else{this.trigger("openSub",node,model)}},_drag:function(){var self=this;this.ui.childList.sortable({axis:"y",handle:".handle",cursor:"move",revert:false,scroll:true,start:function(event,ui){event.stopPropagation()},stop:function(event,ui){var sortedIDs=$(this).sortable("toArray"),node=ui.item,nodeId=node.attr("id"),ele=$(this);if(sortedIDs.length>1)self._getSortendPosition(node,nodeId,sortedIDs)}}).disableSelection()},_getSortendPosition:function(node,nodeId,sortedIDs){var nodeIndex=0,queryParams,length=sortedIDs.length,self=this;_.each(sortedIDs,function(item,index){if(item==nodeId)nodeIndex=index});if(nodeIndex==length-1){queryParams={workId:this.settings.move.workId,mileStoneId:this.settings.move.mileStoneId,baseOn:this.settings.move.baseOn,referenceObjId:sortedIDs[nodeIndex-1],movingObjId:nodeId,positionType:1}}else{queryParams={workId:this.settings.move.workId,mileStoneId:this.settings.move.mileStoneId,baseOn:this.settings.move.baseOn,referenceObjId:sortedIDs[nodeIndex+1],movingObjId:nodeId,positionType:2}}this._commitNewOrder(queryParams).done(function(resp){if(nodeIndex==length-1){node.prev().find(".border-left.last").eq(0).removeClass("last");node.find(".border-left").eq(0).addClass("last")}else{node.parent().find(".border-left.last").eq(0).removeClass("last");node.siblings().eq(node.siblings().length-1).find(".border-left").eq(0).addClass("last")}self.settings.move.baseOn=1;self._resetCollectionOnDrag(queryParams);self.trigger("move")}).fail(function(msg){self.ui.childList.sortable("cancel")})},_bindNotice:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),clock=node.find(".notice");this.setNoticeView&&this.setNoticeView.close();this.setNoticeView=new SetNoticeView;this.listenTo(this.setNoticeView,"cancelRemind",function(){this.model.set("isRemind",false)});this.listenTo(this.setNoticeView,"sure",function(dom,options){this.model.set({isRemind:true,time:Context.formatDate(options["time"])})});this.$el.append(this.setNoticeView.render().el);this.setNoticeView.setPosition(node,{leftBias:5,topBias:8,container:this.$el,pos:"bottomRight",caretBias:229})},_renderSummaryView:function(node,childModel,model){var self=this;this.summaryView=new ExperienceView({id:childModel.get("taskId"),requestSubmit:function(formatData,data){var deferred=new Talent.$.Deferred;ExperienceCollection.addShare({ObjId:childModel.get("taskId"),ObjType:7,Content:data["code"],FileUrls:formatData["FileUrls"],StartDate:data["startDate"],EndDate:data["endDate"],DocumentModels:formatData["documents"]}).done(function(resp){self.summaryView&&self.summaryView.infoTipView&&self.summaryView.infoTipView.hide();self.summaryView&&self.summaryView.close();var counter=Talent._.clone(childModel.get("counter"));counter.experienceTotal+=1;childModel.set({counter:counter,status:model.status,editable:false});deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred}});this.listenTo(this.summaryView,"hide",function(){childModel.set({status:model.status,editable:false})});this.summaryView.show(node,{container:this.$el.parents(".tt_planlist"),align:"left"})},_setMark:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);var self=this;var model=this.model;if(!model)return;var IsMark=!model.get("isMark");var plan_item_id=model.get("taskId");if(IsMark){var type=1}else{var type=2}PlanCollection.postPlanSetMark({plan_id:plan_item_id,type:type}).done(function(resp){model.set("isMark",IsMark)}).fail(function(msg){TipDialogView(node,msg,{container:self.$el,topBias:15,pos:"bottomRight",className:"warn"})})},_checkDelete:function(event){event.stopPropagation();var self=this;var node=Talent.$(event.currentTarget);var tipInfo=TipInfoView(node.parent(),{placement:"bottom",type:"confirm",body:"此操作不可恢复，您确定删除吗？",align:"right",container:this.$el,okHide:function(){self._sureDelFun(node);tipInfo.hide()}})},_sureDelFun:function(node){var self=this;var model=this.model;PlanCollection.deleteData({plan_item_id:this.model.get("taskId")}).done(function(){self.trigger("deleted",node,model);model.collection.remove(model)}).fail(function(msg){TipInfoView(node.closest("li"),{placement:"bottom",type:"remind",body:msg,align:"right",container:self.$el,ico:"warn"})})},_stopMouseUpEvent:function(event){event.stopPropagation()},_clickUpdateKlass:function(evt){evt.stopPropagation();var node=Talent.$(evt.currentTarget);var model=this.model;var id=node.attr("data-id"),label_type=node.attr("data-type"),label_id=node.attr("data-lab");this._renderKlassView(node,"update",{id:id,label_type:label_type||0,label_id:label_id||null,isShowWorkLable:model.get("IsShowWorkLable"),model:model})},_renderKlassView:function(node,type,options){var _type=options&&options["label_type"]&&options["label_type"]!=0?options["label_type"]:17;var classComponentViewOptions=this.settings["classComponentViewOptions"];classComponentViewOptions["model"]=new Talent.Model({type:_type});classComponentViewOptions.zIndex=100;var nodeData=this.model.toJSON();if(nodeData.labelId){classComponentViewOptions.resultData=[{id:nodeData.labelId,name:nodeData.labelName,tabType:nodeData.labelType}]}this.classComponentView&&this.classComponentView.close();this.classComponentView=new ClassComponentView(classComponentViewOptions);this.listenTo(this.classComponentView,"submit",function(data){if(data["id"]==0){return}if(type=="update"){this._requestUpdateKlass({planItem_id:options["id"],label_type:data["tabType"],label_id:data["id"],label_name:data["name"]},node)}else{options.model.set({label_type:data["tabType"],label_id:data["id"],label_name:data["name"]})}});this.listenTo(this.classComponentView,"reset",function(){if(options["label_type"]){this._requestUpdateKlass({planItem_id:options["id"],label_type:0,label_id:null,label_name:""},node)}classComponentViewOptions.resultData=[]});this.$el.append(this.classComponentView.render().el);this.classComponentView.show(node,{container:this.$el,pos:"bottom",leftBias:-1})},_requestUpdateKlass:function(options,node){var self=this;var planItem_id=options["planItem_id"],label_id=options["label_id"],label_type=options["label_type"],label_name=options["label_name"];PlanCollection.postUpdateLable({planItem_id:planItem_id,lable_id:label_id,lable_type:label_type}).done(function(resp){var model=self.model;model.set({labelId:label_id,labelType:label_type,labelName:label_name})}).fail(function(resp){TipDialogView(node,resp,{container:self.$el,topBias:-30})})},_commitNewOrder:function(queryParams){var deferred=new Talent.$.Deferred;this.settings.move.request(queryParams).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},_mouseenterkKlass:function(ev){var self=this,node=Talent.$(ev.currentTarget),tipBody=node.attr("data-body"),label_id=this.model.get("labelId");if(!label_id||label_id=="0")return;if(this.model.get("labelType")!=17){var tipView=new Infotip;var labelName=self.model.get("labelName");tipView.bindNode(node,{container:self.$el,type:"default",body:'<div class="class_tip_content">'+labelName+"</div>"});tipView.show()}else{LableCollection.getLabelFullName({lableId:label_id}).done(function(resp){if(!resp)return;var tipView=new Infotip;tipView.bindNode(node,{container:self.$el,type:"default",body:'<div class="class_tip_content">'+resp+"</div>"});tipView.show()})}},isThisYear:function(date){if(!date)return"";var year=moment().year();var date=new Date(date);var dateYear=moment(date).format("YYYY");if(year==dateYear){return moment(date).format("MM/DD")}else{return moment(date).format("YYYY/MM/DD")}},_fromNow:function(date){var year=moment().year(),month=moment().month()+1,day=moment().date();var date=new Date(date);var dateYear=moment(date).format("YYYY"),dateMonth=moment(date).format("MM"),dateDay=moment(date).format("DD");if(year==dateYear&&month==dateMonth){return dateDay-day+1}return 999},itemViewOptions:function(item,index){return Talent._.extend({},this.settings,{isShowKclass:false,isChildTask:true})},_resetCollection:function(){var tasks=this.model.get("tasks")||[];var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"taskId"})}});var level=this.model.get("level")||1;_.each(tasks,function(item,index){item.level=level+1;item.dataIndex=index});if(tasks.length>0){this.collection=new mCollection(tasks);this.model.set("collection",this.collection)}},renderAfterCollectData:function(){if(this.model.hasChanged("active")){return}if(this.model.hasChanged("taskName")||this.model.hasChanged("status")||this.model.hasChanged("principalUser")||this.model.hasChanged("isMark")||this.model.hasChanged("deadLine")||this.model.hasChanged("startDate")){this.render();return}this.trigger("modelChange",this.model);this.getCollectionData();this.render();this.trigger("painting")},getCollectionData:function(){if(this.collection.length>0){this.children.each(function(itemView){itemView.getCollectionData()});var collectionData=this.collection.toJSON();this.model.set({tasks:collectionData},{silent:true})}},_moveTopClickHandler:function(ev){ev.stopPropagation();var self=this,parentTaskId=this.model.get("parentTaskId");if(parentTaskId){this.trigger("moveTopAtChild")}else{this.trigger("moveTopAtOutermost")}},onClose:function(){this.dialogView&&this.dialogView.close()}});var TaskListView=Talent.CompositeView.extend({defaults:{id:null,isShowKclass:true,isShowOwnerTag:false,quirkOwnerTag:false,isShowStar:true,objType:7,isShowDelete:false,isChildTask:false,deployAll:true,pageSize:50,isShowCommentTotal:true,isShowTaskTotal:true,isShowExperienceTotal:true,isShowBusinessTripTotal:true,isShowMeetingTotal:true,isShowMoreBtn:false,isShowToggle:false,hasDetailodel:false,addChildViewTop:false,data:false,classComponentViewOptions:{},requestData:function(options){var deferred=new Talent.$.Deferred;return deferred},move:{workId:0,mileStoneId:0,baseOn:0,drag:false,moveTop:false,request:function(params){}}},itemView:TaskListItemView,tagName:"div",className:"tt_planlist tu-font-h5",template:jst["task-list/task-list"],itemViewContainer:".list-container",currentPage:1,ui:{iconCycle:'span[data-name="task-cycle"]',showMore:'[data-name="showmore"]',listContainer:".list-container",tipsy:"[data-toggle=infotip]",date:"[data-name=date]",addTask:"[data-name=add-task]",addWorkTime:"[data-name=add-workTime]",addExperience:"[data-name=add-experience]",addComment:"[data-name=add-comment]",taskName:'[data-name="taskName"]',done:".status_ttpl"},modelEvents:{},events:function(){var events={};events["mouseenter "+this.ui.tipsy]="_showTipsy";events["mouseenter "+this.ui.iconCycle]="_showTitle";events["mouseleave "+this.ui.iconCycle]="_hideTipHandler";events["click "+this.ui.showMore]="_showMore";events["click "+this.ui.addTask]="_addTaskEvent";events["click "+this.ui.date]="_onClickDate";events["click "+this.ui.addWorkTime]="_addWorkTimeEvent";events["click "+this.ui.addExperience]="_getExperienceData";events["click "+this.ui.addComment]="_clickCommentEvent";events["click "+this.ui.taskName]="_onClickName";events["mouseenter "+this.ui.addExperience]="_showTipsy";events["mouseleave "+this.ui.addExperience]="_hideTipHandler";events["mouseenter "+this.ui.addComment]="_showTipsy";events["mouseleave "+this.ui.addComment]="_hideTipHandler";events["click "+this.ui.done]="_changeStatus";return events},initialize:function(options){var self=this;this.childrenModel={};this.settings=_.extend({},this.defaults,options,{childrenModel:this.childrenModel,compositeModel:this.model});if(this.settings.move.drag){this.$el.addClass("tt_planlist_move")}this.on("itemview:move",function(){self.trigger("move")});this.on("itemview:moveTopAtOutermost",function(view){self._resetCollectionOnMoveTop(view)});this.on("itemview:openSub",function(view,node,model){self.trigger("openSub",node,model,self._formatData)});this.on("itemview:deleted",function(view,node,model){self.trigger("deleted",node,model)});this.on("itemview:changeStatue",function(view,node,model){self.trigger("statusChange",self.model.get("counter"))});this.on("itemview:modelChange",function(view,model){self.trigger("modelChange",model)});this.on("itemview:painting",function(view,node,model){self.trigger("painting")});var classComponentViewOptions=this.options["classComponentViewOptions"]||{};this.settings["classComponentViewOptions"]=Talent._.extend({},this.defaults["classComponentViewOptions"],classComponentViewOptions);this._customSettings();if(this.settings.addChildViewTop){this.addChildView=this.addChildViewTop}delete this.settings.model;delete this.settings.collection;this._initData();this.model.set("currentPage",this.currentPage);this.on("itemview:show",function(view){if(self.collection.length>1&&this.settings.move.drag){self._drag()}});this.tQuickComment=null;this.hasNodeActiveId=null;Talent.$(document).on("mousedown.Plan-List-Composite",function(){self.dialogView&&self.dialogView.close()});this.mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"taskId"})}});this._sdkEvent()},_sdkEvent:function(){if(!util_italentSDK())return;window.iTalentSDK.register([{listenEvent:"tita__task-create__requestSubmit",context:this,cb:function(data){this._requestAddTask(data)}},{listenEvent:"tita__OperationStatusView__click_"+this.settings.id,context:this,cb:function(data){this._updateStatus(data)}},{listenEvent:"tita__task-experience__submit",context:this,cb:function(data){this._requestExperience(data.id,data.formatData,data.data)}},{listenEvent:"tita__widget_taskInfo",context:this,cb:function(data){this._changeListItem(data)}}])},_findModelFromCollection:function(id){var model=this.collection.findWhere({taskId:id})&&this.collection.findWhere({taskId:id})[0];if(!model){mapCollection(this.collection)}function mapCollection(collection){for(var i=0;i<collection.length;i++){var item=collection.models[i];if(item.get("taskId")==id){model=item}else if(item.get("collection").length){mapCollection(item.get("collection"))}}}return model},_changeListItem:function(data){var model=this._findModelFromCollection(data.id);model&&model.set(data.model)},_getExperienceData:function(event){var self=this;var node=Talent.$(event.currentTarget),id=node.data("id");if(this.t_getExperience)return;this.t_getExperience=true;this._markActiveNode(id);TaskCollection.newexperience({task_id:id}).done(function(resp){self.t_getExperience=null;if(!resp)return;self._renderTaskListQuickCommontView(id,node,resp,"xinde")}).fail(function(resp){self.t_getExperience=null})},_renderExperienceView:function(node,id,call){var self=this;var model=this.childrenModel[id],taskName=model.get("taskName");var options={id:id+"_task-experience",richEditorOptions:{defaultText:"请输入进展",maxWords:5e3},templateName:"dateRichEditor",requestSubmit:function(formatData,data){call&&call();return self._requestExperience(id,formatData,data)},dataTimeRangeOptions:{isShowDateView:true,isShowCycleView:false,isShowLongView:false,count:2,timePicker:false,rangepickerOptions:{format:"YYYY/MM/DD",timePicker:false}}};this.addExperienceView=new TaskCreateView(options);this.listenTo(this.addExperienceView,"afterSubmitSuccess",function(){this.dialogView&&this.dialogView.close()});this.addExperienceView.render();this._setPos(node,this.addExperienceView.$el,call);this.addExperienceView.onShow()},_requestExperience:function(id,formatData,data){var self=this;var model=this.childrenModel[id];if(!model)return;var deferred=new Talent.$.Deferred;ExperienceCollection.addShare({ObjId:id,Content:formatData["Description"],FileUrls:formatData["FileUrls"],StartDate:data["startDate"],EndDate:data["endDate"],DocumentModels:formatData["documents"]}).done(function(resp){if(self.isClosed)return;var counter=model.get("counter");counter["experienceTotal"]=counter["experienceTotal"]+1;model.unset("counter",{silent:true});model.set("counter",counter);if(util_italentSDK()){window.iTalentSDK.sendMessage({publishEvent:"tita__task-experience__requestSubmit_success"})}deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},_clickCommentEvent:function(event){var node=Talent.$(event.currentTarget),id=node.data("id"),model=this.childrenModel[id];var counter=model.get("counter");var isExternal=model.get("isExternal");this._markActiveNode(id);if(counter.commentTotal){this._showAddCommentEvent(id,node,model)}else{this._renderCommentView(node,id,isExternal)}},_showAddCommentEvent:function(id,node,model){var self=this;var counter=model.get("counter");if(this.t_addComment)return;this.t_addComment=true;CommentV2.getCommentRevGet({feed_id:id,comment_type:0,count:1}).done(function(resp){if(self.isClose)return;self.t_addComment=null;var comment=resp.comments&&resp.comments||[];if(!comment.length)return;self._renderTaskListQuickCommontView(id,node,comment[0])}).fail(function(){self.t_addComment=null})},_renderTaskListQuickCommontView:function(id,node,data,type){var self=this;var model=this.childrenModel[id];var isExternal=model.get("isExternal");var options={content:data.content,createTime:data.createTime,publishUser:data.publishUser};if(util_italentSDK()){var host="//"+location.host+"/widget#sdk/quick-common";window.iTalentSDK&&window.iTalentSDK.showPopup(host,600,352,{quickComment:options,id:id,type:type});return}this.taskListQuickCommontView&&this.taskListQuickCommontView.close();this.taskListQuickCommontView=new TaskListQuickCommontView({type:type||"comment",model:new Talent.Model(options)});this.listenTo(this.taskListQuickCommontView,"openTaskDetail",function(){this._openDetail(id,model);this._markActiveNode();this.commentTipView&&this.commentTipView.destroy()});this.listenTo(this.taskListQuickCommontView,"add",function(){if(type=="xinde"){this._renderExperienceView(node,id)}else{this._renderCommentView(node,id,isExternal)}this.commentTipView&&this.commentTipView.destroy()});this.listenTo(this.taskListQuickCommontView,"closed",function(){this.commentTipView&&this.commentTipView.destroy();this._markActiveNode()});this.taskListQuickCommontView.render();this.commentTipView&&this.commentTipView.close();this.commentTipView=new Infotip;this.listenTo(this.commentTipView,"hide",function(){this._markActiveNode()});this.commentTipView.bindNode(node,{container:this.$el,type:"default",widthlimit:"400px",trigger:"manual",body:this.taskListQuickCommontView.$el});this.commentTipView.show()},_markActiveNode:function(id){if(!id){if(!this.hasNodeActiveId)return;var model=this.childrenModel[this.hasNodeActiveId];model.set("active",false);this.hasNodeActiveId=null;return}var model=this.childrenModel[id];model.set("active",true);this.hasNodeActiveId=id},_hideAddCommentEvent:function(event){var self=this;self.commentTipView&&self.commentTipView.destroy()},_renderCommentView:function(node,id,isExternal){var self=this;var userInfo=Context.getUserInfo();var mblogOptions={submitText:"回复",id:this.feedId,type:"comment",inFocus:true,toUserName:"",commentId:"",isShowAtAll:userInfo.Role==2||userInfo.Role==1||userInfo.Role==4||userInfo.Role==7||userInfo.IsBoss?true:false,isShowAt:!isExternal?true:false,submitRequest:function(node,options,params){options["files"]=options["files"].join(",");var deferred=new Talent.$.Deferred;self._requestFeed(id,node,options,params);deferred.resolve("");return deferred}};this.publistMblogView=new PublistMblogView(mblogOptions);this.publistMblogView.render();this._setPos(node,this.publistMblogView.$el);this.publistMblogView.show();setTimeout(function(){self.publistMblogView.ui.input.focus()},0)},_requestFeed:function(id,node,options,params){if(this.settings["onlyComment"]&&!this.feedId){this.trigger("reply",node,options);return}var self=this;var options={FeedId:id,CommentId:0,Content:options["context"],FileUrl:options["files"],ObjId:options["privateObjId"],ObjType:options["privateObjType"],IsSendSMS:options["isSendSMS"],OtherDocuments:options["YFYDocuments"]};options=Talent._.extend({},options,params);CommentV2.postCommentAdd(options).done(function(resp){var model=self.childrenModel[id],counter=model.get("counter");counter["commentTotal"]=counter["commentTotal"]+1;model.unset("counter",{silent:true});model.set("counter",counter);self.successTip=new Infotip;self.successTip.bindNode(self.publistMblogView.ui.submit,{type:"remind",container:self.publistMblogView.$el,body:"发布成功",trigger:"manual",align:"right",bias:{left:0,top:0},hide:function(){self.dialogView&&self.dialogView.close()}});self.successTip.show()})},_onClickName:function(ev){ev.stopPropagation();ev.preventDefault();var self=this,node=self.$(ev.currentTarget),id=node.attr("id");var model=this.childrenModel[id];this._openDetail(id,model)},_openDetail:function(id,model){if(util_italentSDK()){var host=Context.getGlobal("titaHost");window.iTalentSDK.sendMessage({publishEvent:"TitaQuickScreen_open",data:{id:id,iframeSrc:host+"/widget#more/taskinfo?id="+id+"&topActionFix=true",iframeScroll:"no",type:"task"}})}else{Talent.app.vent.trigger("global-pull-screen",id,"task",model)}},_onClickDate:function(event){this._renderDatePicker(event)},_renderDatePicker:function(event){var node=Talent.$(event.currentTarget),id=node.data("id"),model=this.childrenModel[id];var options={isShowCycleView:false,rangepickerOptions:{startDate:model.get("startDate"),endDate:model.get("deadLine")},taskId:id};if(util_italentSDK()){var host="//"+location.host+"/widget#sdk/date-view";window.iTalentSDK&&window.iTalentSDK.showPopup(host,600,352,options);window.iTalentSDK.register({listenEvent:"tita__date-view__sure",context:this,cb:function(data){this._requestUpdateDate(data.data,data.options.taskId)}});return}this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView(options);

this.listenTo(this.dateTimePickerView,"sure",function(node,data){this._requestUpdateDate(data,id)},this);this.$el.append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.$el,pos:"bottom",leftBias:0})},_requestUpdateDate:function(data,id){var self=this;var model=this.childrenModel[id];TaskCollection.updateTaskDate({task_id:id,Deadline:data["endDate"],StartDate:data["startDate"],IsLongTerm:data["isLongTerm"]}).done(function(resp){if(self.isClose)return;model.set({startDate:resp.startDate,deadLine:resp.deadLine,isDeadLine:resp.isDeadLine,isLongTerm:resp.isLongTerm})}).fail(function(msg){if(self.isClose)return})},_setPos:function(node,view,call){this.dialogView&&this.dialogView.close();this.dialogView=new TDialogView({type:"default",sure:false,cancel:false,showClosed:true,minWidth:500,maxWidth:500,className:"task-hot-add _tt_dialog"});this.listenTo(this.dialogView,"hide",function(){this._markActiveNode();this.addWrokTimeView&&this.addWrokTimeView.close();this.createTaskView&&this.createTaskView.close();this.addExperienceView&&this.addExperienceView.close();call&&call()});this.$el.append(this.dialogView.render().$el);this.dialogView.show(node,view,{container:this.$el,pos:"bottom",leftBias:0,topBias:10,adjust:0})},_addWorkTimeEvent:function(event){var self=this,node=Talent.$(event.currentTarget),id=node.data("id");var model=this.childrenModel[id],taskName=model.get("taskName");this.addWrokTimeView=new TaskCreateView({id:id+"task-list-add_work-hour",templateName:"workhour",nameOptions:{dropdownData:[{name:taskName}],defaultText:"输入工时名称",iconShow:false},dataTimeRangeOptions:{count:1,rangepickerOptions:{timePicker:false,maxDate:moment().format("YYYY/MM/DD"),format:"YYYY/MM/DD"}},requestSubmit:function(formatData,data){var deferred=new Talent.$.Deferred;WorkTimeCollection.addWorkHour({ObjId:id,ObjType:7,Name:data["taskTitle"],Description:data["code"],Time:data["startDate"],Hour:data["hourDate"],Minute:data["minuteDate"],FileUrl:formatData["FileUrls"],Documents:formatData["documents"]}).done(function(resp){if(!resp){deferred.resolve("");return}var counter=model.get("counter");counter["workTimeTotal"]=counter["workTimeTotal"]+resp["hoursTotal"];model.unset("counter",{silent:true});model.set("counter",counter);deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred}});this.listenTo(this.addWrokTimeView,"afterSubmitSuccess",function(){this.dialogView&&this.dialogView.close()});this.addWrokTimeView.render();this._setPos(node,this.addWrokTimeView.$el);this.addWrokTimeView.onShow()},_addTaskEvent:function(event){var self=this;var node=Talent.$(event.currentTarget),id=node.data("id");var model=this.childrenModel[id];var labelType=model.get("labelType");var isPrivate=model.get("isPrivate");var departmentId=model.get("departmentId");var privateValue=isPrivate?2:1;if(departmentId&&isPrivate){privateValue=3}if(labelType==4&&!model.get("isPrivate")){privateValue=1}var options={id:id+"_task-list-add",hourDateOptions:false,extendPersonOptions:false,participatorOptions:{showBorderLeft:false},nameOptions:{showBorderLeft:false},classOptions:false,bottomOptions:{isShowPrivateDropDown:labelType==17||labelType==0?true:false},privateRangeOptions:{privateValue:privateValue},dataTimeRangeOptions:{rangepickerOptions:{startDate:model.get("startDate"),endDate:model.get("deadLine")}}};options["requestSubmit"]=function(options){return self._requestAddTask(options)};this._markActiveNode(id);if(util_italentSDK()){var host="//"+location.host+"/widget#sdk/task-create";window.iTalentSDK&&window.iTalentSDK.showPopup(host,680,500);window.iTalentSDK.register([{listenEvent:"tita__task-create__loaded",context:this,cb:function(data){window.iTalentSDK.sendMessage({publishEvent:"tita__task-create",data:options})}}]);return}this.createTaskView&&this.createTaskView.close();this.createTaskView=new TaskCreateView(options);this.listenTo(this.createTaskView,"afterSubmitSuccess",function(){this.dialogView&&this.dialogView.close()});this.createTaskView.render();this._setPos(node,this.createTaskView.$el);this.createTaskView.onShow()},_requestAddTask:function(options){var self=this;var id=this.hasNodeActiveId;var model=this.childrenModel[id];var deferred=new Talent.$.Deferred;options["LabId"]=model.get("labelId");options["LabType"]=model.get("labelType");options["parentTaskId"]=id;TaskCollection.addTask(options).done(function(resp){if(self.isClosed)return;resp.tasks=[];resp.level=model.get("level")+1;var task=model.get("tasks")||[],counter=model.get("counter"),collection=model.get("collection");self.childrenModel[resp.taskId]=new Talent.Model(resp);task.push(resp);counter.taskTotal=counter.taskTotal+1;model.set({task:task,counter:counter,collection:collection});var taskId=model.get("taskId");model.unset("tasks",{silent:true});model.set("tasks",task);if(util_italentSDK()){window.iTalentSDK.sendMessage({publishEvent:"tita__task-create__requestSubmit_success",data:options})}deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},addNewItemTask:function(taskData){taskData.collection=new this.mCollection;taskData.tasks=[];var data=this.collection.toJSON();data.unshift(taskData);_.each(data,function(item,index){item["dataIndex"]=index});this.collection.reset(data)},_resetCollectionOnDrag:function(params){var collection=this.collection.toJSON(),referenceModel=_.findWhere(collection,{id:+params.referenceObjId}),movingModel=_.findWhere(collection,{id:+params.movingObjId}),positionType=params.positionType;collection.splice(_.indexOf(collection,movingModel),1);if(positionType==1){collection.push(movingModel)}else{var referenceModelIndex=_.indexOf(collection,referenceModel);if(referenceModelIndex){collection.splice(referenceModelIndex,0,movingModel)}else{collection.unshift(movingModel)}}_.each(collection,function(el,index){el.dataIndex=index});this.collection.reset(collection)},_resetCollectionOnMoveTop:function(view){var id=view.model.get("id"),collectionData=this.collection.toJSON(),currentData=[],newData=[],self=this,queryParams;queryParams={workId:this.settings.move.workId,mileStoneId:this.settings.move.mileStoneId,baseOn:this.settings.move.baseOn,referenceObjId:"",movingObjId:id,positionType:3};this._commitNewOrder(queryParams).done(function(resp){if(self.settings.move.pageIndex>1){view.close()}else{currentData=_.findWhere(collectionData,{id:id});newData.push(currentData);_.each(collectionData,function(item){if(item.id!=currentData.id)newData.push(item)});_.each(newData,function(el,index){el.dataIndex=index});self.collection.reset(newData);self.render()}self.settings.move.baseOn=1;var pageIndex=self.settings.move.pageIndex;if(pageIndex>1){self.trigger("move",pageIndex)}else{self.trigger("move")}$("body").find(".tipsy").remove()}).fail(function(msg){})},_customSettings:function(){var tenant_function=Context.getGlobal("tenant_function");if(tenant_function&&typeof tenant_function=="object"){var isShowMeeting=tenant_function.IsUseMeet;var isShowTravel=tenant_function.IsUseBusinessTrip;this.settings.isShowMeetingTotal=isShowMeeting;this.settings.isShowBusinessTripTotal=isShowTravel}},_initData:function(){if(!this.settings["data"]){this._requestData().done(function(data){self._addDataToCollection(data)});return}this._addDataToCollection(this.settings["data"])},_requestData:function(){var self=this;var deferred=new Talent.$.Deferred;this.settings["requestData"](this.model.toJSON()).done(function(data){deferred.resolve(data)}).fail(function(msg){deferred.reject(msg)});return deferred},_addDataToCollection:function(data){var data=data||options["data"];var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"taskId"})}});this.collection=new mCollection;var data=this._formatData(data||[]);this.collection.reset(data)},itemViewOptions:function(item,index){delete this.settings.emptyView;return Talent._.extend({},this.settings,{container:this.$el})},addChildViewTop:function(item,collection,options){var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.children.add(view);view.render();if(!this.$el.find(this.itemViewContainer).children("li:first-child").length){this.$el.find(this.itemViewContainer).append(view.el)}else{this.$el.find(this.itemViewContainer).children("li:first-child").before(view.el)}if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)},onRender:function(){var isShowMoreBtn=this.settings.isShowMoreBtn;if(!isShowMoreBtn){this.hideMoreBtn()}},_drag:function(){var self=this;this.ui.listContainer.sortable({axis:"y",handle:".handle",cursor:"move",revert:false,scroll:true,start:function(event,ui){event.stopPropagation()},stop:function(event,ui){var sortedIDs=$(this).sortable("toArray"),node=ui.item,nodeId=node.attr("id"),ele=$(this);if(sortedIDs.length>1)self._getSortendPosition(node,nodeId,sortedIDs)}}).disableSelection()},_getSortendPosition:function(node,nodeId,sortedIDs){var nodeIndex=0,queryParams,length=sortedIDs.length,self=this;_.each(sortedIDs,function(item,index){if(item==nodeId)nodeIndex=index});if(nodeIndex==length-1){queryParams={workId:this.settings.move.workId,mileStoneId:this.settings.move.mileStoneId,baseOn:this.settings.move.baseOn,referenceObjId:sortedIDs[nodeIndex-1],movingObjId:nodeId,positionType:1}}else{queryParams={workId:this.settings.move.workId,mileStoneId:this.settings.move.mileStoneId,baseOn:this.settings.move.baseOn,referenceObjId:sortedIDs[nodeIndex+1],movingObjId:nodeId,positionType:2}}this._commitNewOrder(queryParams).done(function(resp){self.settings.move.baseOn=1;self._resetCollectionOnDrag(queryParams);self.trigger("move")}).fail(function(msg){self.ui.listContainer.sortable("cancel")})},_commitNewOrder:function(queryParams){var deferred=new Talent.$.Deferred;this.settings.move.request(queryParams).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred.promise()},_showMore:function(ev){var node=this.$(ev.currentTarget),self=this;if(!this.isLoading){node.find("span").text("加载中...");this.currentPage+=1;this.model.set("currentPage",this.currentPage);if(!this.settings["data"]){this._requestData().done(function(data){var data=self._formatData(data);self.collection.add(data);self.trigger("showMore",node,this.currentPage,this._formatData)})}else{this.trigger("showMore",node,this.currentPage,this._formatData)}this.isLoading=true}},loadingCompelte:function(){this.isLoading=false;this.ui.showMore.find("span").text("查看更多")},hideMoreBtn:function(){this.ui.showMore.hide()},showMoreBtn:function(){this.ui.showMore.show()},_formatData:function(data){var data=data||[];if(!data.length)return;var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"taskId"})}});var newData=[];_.each(data,function(item,index){item.collection=new mCollection;item.tasks=[];if(!item.parentTaskId){item["level"]=1;item["dataIndex"]=index;newData.push(item)}});function getPId(newData){Talent._.each(newData,function(item){var item_id=item["taskId"];if(!item_id)return;var children_data=Talent._.where(data,{parentTaskId:item_id});children_data=Talent._.compact(children_data);if(children_data.length){Talent._.each(children_data,function(childItem,index){childItem.level=item.level+1;childItem["dataIndex"]=index});item.collection.push(children_data);item.tasks=item.collection.toJSON()}else{return}getPId(children_data)})}getPId(newData);return newData},_showTipsy:function(ev){var node=Talent.$(ev.currentTarget);var name=node.data("name");var body=node.attr("data-tip");var tipView=new Infotip;var options={container:this.$el,type:"default",body:body};if(name=="set-mark"){options["align"]="right"}tipView.bindNode(node,options);tipView.show()},_hideTipHandler:function(event){var node=Talent.$(event.currentTarget);node.tipsy("hide");this.tipTitle=false},_showTitle:function(event){event.stopPropagation();var self=this;var node=Talent.$(event.currentTarget);var id=node.attr("data-cys");var tipBody=node.attr("data-body");if(tipBody){return}TaskCollection.getCycleTask({cycle_id:id}).done(function(resp){var type=resp.CycType,startDate=resp.CycStartDate,endDate=resp.CycEndDate,chineseNumber={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七"},titles={1:"每天",2:"每个工作日",3:"每周"+(startDate==endDate?chineseNumber[startDate]:chineseNumber[startDate]+"-"+chineseNumber[endDate]),4:"每月"+(startDate==endDate?startDate:startDate+"-"+endDate)};if(!tipBody){node.attr("data-toggle","infotip");node.attr("data-body",titles[type]);var tipView=new Infotip;tipView.bindNode(node,{container:self.$el,type:"default",body:titles[type]});tipView.show()}}).fail(function(resp){TipDialogView(self.ui.icon_cycle,resp,{container:self.$el,topBias:-15})})},_changeStatus:function(event){event.stopPropagation();var self=this,node=Talent.$(event.currentTarget),id=node.attr("data-id");this.cacheClickNode=node;var childModel=this.childrenModel[id];if(!childModel.get("editStatusable")){return}if(util_italentSDK()){var status=childModel.get("status");this._updateStatus({status:status==2?1:2,id:childModel.get("taskId")});return}this.planItemStatusView&&this.planItemStatusView.close();this.planItemStatusView=new OperationStatusView({model:new Talent.Model({status:childModel.get("status"),id:childModel.get("taskId"),isChildTask:childModel.get("isChildTask")})});this.listenTo(this.planItemStatusView,"click:status",function(model){this._updateStatus(model,node)},this);this.planItemStatusView.render();this.$el.append(this.planItemStatusView.$el);this.planItemStatusView.show(node,{container:this.$el,pos:"bottomCenter",topBias:8})},_updateStatus:function(model,node){var self=this;var id=model.id;var childModel=this.childrenModel[id];if(childModel.get("status")==model.status)return;PlanCollection.PutUpdateStatus({plan_item_id:model.id,Status:model.status}).done(function(resp){if(model.status==2&&childModel.get("isAddExperience")){if(util_italentSDK()){childModel.set({status:model.status,editable:false});if(childModel.get("isAddExperience")){var host="//"+location.host+"/widget#sdk/experience?"+"&id="+childModel.get("taskId");window.iTalentSDK&&window.iTalentSDK.showPopup(host,650,330)}return}self._renderExperienceView(node,id,function(){childModel.set({status:model.status,editable:false})})}else{childModel.set({status:model.status,editable:false})}}).fail(function(resp){TipDialogView(self.cacheClickNode,resp,{container:self.$el,topBias:-30,className:"warn"});childModel.set("isApply",true)})},onClose:function(){Talent.$(document).off("click.Plan-List-Composite");this.planItemStatusView&&this.planItemStatusView.close();this.classComponentView&&this.classComponentView.close();this.summaryView&&this.summaryView.close()}});var TaskApplyItemView=Talent.ItemView.extend({defaults:{type:"approval"},className:"apply_item clearfix",template:jst["task-apply/task-apply-item"],initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.i18n=Talent.Context.getI18n();this.model.set("state",1)},ui:{sureItem:'button[data-name="sure-item"]',cancelItem:'button[data-name="cancel-item"]'},events:function(){var events={};events["click "+this.ui.sureItem]="_checkSureNode";events["click "+this.ui.cancelItem]="_onClickCancel";return events},onRender:function(){this.i18n=Context.getI18n();var self=this;setTimeout(function(){self._setApplyTreeHeight()},0)},_setApplyTreeHeight:function(){var height=this.$el.height();if(this.$el.find(".apply_end").length){var height=height-27;this.$el.find(".apply_tree").css({height:height+"px"})}},templateHelpers:function(){var modelObj=this.model.toJSON(),applyType=modelObj.applyType,publishUser=modelObj.publishUser,planName=modelObj.planName,oldLableName=modelObj.oldLableName,taskId=modelObj.planId,taskTxt=this.i18n["task_1"];if(!oldLableName){oldLableName="未分类"}planName='<span id ="'+taskId+'">'+planName+"</span>";if(applyType==1){var oldName=this.model.get("oldName");var newName=this.model.get("newName");oldName='<span id ="'+taskId+'">'+oldName+"</span>";newName='<span id ="'+taskId+'">'+newName+"</span>";var txtTemplate=publishUser.name+":将"+taskTxt+"名称<span>"+oldName+"</span>改成<span>"+newName+"</span>"}else if(applyType==2){var isNewLong=this.model.get("isNewLong");if(isNewLong){var newDeadLine="长期"}else{var newDeadLine=this.model.get("newDeadLine")}var isOldLong=this.model.get("isOldLong");if(isOldLong){var oldDeadLine="长期"}else{var oldDeadLine=this.model.get("oldDeadLine")}if(!this.model.get("oldStartDate")&&!oldDeadLine){var txtTemplate=publishUser.name+":将"+taskTxt+planName+"起止时间修改成<span>"+this.model.get("newStartDate")+" - "+newDeadLine+"</span>"}else{var txtTemplate=publishUser.name+":将"+taskTxt+planName+"起止时间<span>"+this.model.get("oldStartDate")+" - "+oldDeadLine+"</span>修改成<span>"+this.model.get("newStartDate")+" - "+newDeadLine+"</span>"}}else if(applyType==3){var txtTemplate=publishUser.name+":将"+taskTxt+planName+"分类<span>"+oldLableName+"</span>改成<span>"+this.model.get("newLableName")+"</span>"}else if(applyType==4){var txtTemplate=publishUser.name+":将"+taskTxt+planName+"<span>删除了</span>"}else if(applyType==5){var txtTemplate=publishUser.name+":将"+taskTxt+planName+"状态<span>"+this.model.get("oldState")+"</span>改成<span>"+this.model.get("newState")+"</span>"}else if(applyType==15){var oldDescription=this.model.get("oldDescription");if(!oldDescription&&this.model.get("newDescription")){var txtTemplate=publishUser.name+":给"+taskTxt+planName+"添加了描述与备注<span>"+this.model.get("newDescription")+"</span>"}else if(!this.model.get("newDescription")&&oldDescription){var txtTemplate=publishUser.name+":将"+taskTxt+planName+"的描述与备注<span>删除了</span>"}else{var txtTemplate=publishUser.name+":将"+taskTxt+planName+"描述与备注<span>"+oldDescription+"</span>改成<span>"+this.model.get("newDescription")+"</span>"}}var planDate=moment(new Date(this.model.get("planDate")));var startDate=planDate.format("YYYY/MM/DD");var startHour=planDate.format("HH:mm");var endDate=endHour="";var applyDate=this.model.get("applyDate");if(applyDate){var endDate=moment(applyDate,"YYYY/MM/DD HH:mm").format("YYYY/MM/DD"),endHour=moment(applyDate,"YYYY/MM/DD HH:mm").format("HH:mm")}return{txtTemplate:txtTemplate,startDate:Context.formatDate(startDate),startHour:startHour,endDate:Context.formatDate(endDate),endHour:endHour,type:this.settings["type"]}},onShow:function(){},_onClickCancel:function(events){var self=this;var node=Talent.$(events.currentTarget);var html='<div class="task-apply-rejected-titaw"><h2>驳回理由</h2><textarea class="apply_desc" data-name="task-apply-reject-input"></textarea></div>';ConfirmDialogView(node,html,{pos:"bottomRight",type:"dialog",container:this.$el,topBias:-38,sure:function(){self.model.set("state",3);self._requestUpdateState()}})},_checkSureNode:function(events){var self=this;var node=Talent.$(events.currentTarget);ConfirmDialogView(node,"您确定同意该审批项吗？",{pos:"bottomRight",className:"ask",container:this.$el,topBias:-38,sure:function(){self.model.set("state",2);self._requestUpdateState()}})},_requestUpdateState:function(){var self=this;var input=this.$el.find("textarea[data-name=task-apply-reject-input]"),concent="";if(input.length){concent=Talent.$.trim(input.val())}ApplyCollection.UpdateState({ApplyIds:this.model.get("applyId"),State:this.model.get("state"),ApplyContent:concent}).done(function(resp){self.trigger("deleted")}).fail(function(resp){TipDialogView(self.ui.sureItem,resp)})}});var TaskApplyView=Talent.CompositeView.extend({defaults:{type:"approval",isShowAllButton:false},itemView:TaskApplyItemView,itemViewContainer:"div[data-name=task-apply-list]",template:jst["task-apply/task-apply"],className:"task-apply-titaw",ui:{taskName:'[data-name="plan-name"]',buttonAll:"[data-name=task-apply-all]",buttonSure:"[data-name=task-apply-sure-all]",buttonCancel:"[data-name=task-apply-cancel-all]"},events:function(){var events={};events["click "+this.ui.taskName]="_onClickName";events["click "+this.ui.buttonSure]="_onSure";events["click "+this.ui.buttonCancel]="_onCancel";return events},templateHelpers:function(){return{isShowAllButton:this.settings.isShowAllButton}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options)},onRender:function(){var self=this;this.on("itemview:deleted",function(view){self.collection.remove(view.model);self.trigger("afterApplyDeal")});if(this.collection.length>1){this.ui.buttonAll.show()}},itemViewOptions:function(){return{type:this.settings["type"]}},_onSure:function(events){var self=this;var node=Talent.$(events.currentTarget);ConfirmDialogView(node,"您确定同意全部审批项吗？",{pos:"bottomRight",className:"ask",container:this.$el,topBias:-38,sure:function(){self.model.set("state",2);self._requestUpdateState()}})},_onCancel:function(events){var self=this;var node=Talent.$(events.currentTarget);ConfirmDialogView(node,"您确定驳回全部审批项吗？",{pos:"bottomRight",className:"ask",container:this.$el,topBias:-38,sure:function(){self.model.set("state",3);self._requestUpdateState()}})},_requestUpdateState:function(){var self=this;var data=this.collection.toJSON();var id=Talent._.pluck(data,"applyId")||[];ApplyCollection.UpdateState({ApplyIds:id.join(","),State:this.model.get("state"),ApplyContent:""}).done(function(resp){self.collection.reset([]);self.ui.buttonAll.hide()}).fail(function(resp){TipDialogView(self.ui.sureItem,resp)})},onClose:function(){}});var ErrorLayoutMessageView=Talent.ItemView.extend({template:jst["task-detail/error-layout-message"],className:"tt_errotracker",defaults:{content:"暂时没有查看权限"},initialize:function(){var self=this;this.settings=Talent._.extend({},this.defaults,this.options)},templateHelpers:function(){return{content:this.settings["content"]}}});var ShareRangeItemView=Talent.ItemView.extend({tagName:"li",className:"item_sr",template:jst["task-detail/share-range-item"],onRender:function(){var self=this;if(this.model.get("Type")==1){this.$el.addClass("disable")}}});var ShareRangeEmptyView=Talent.ItemView.extend({template:Talent._.template("<%= emptyText%>"),defaults:{},tagName:"li",className:"empty_sr",templateHelpers:function(){return this.settings},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options)}});var ShareRangeView=Talent.CompositeView.extend({className:"tt_sharerange",defaults:{deleteTip:"您确定把ta从关注者里删除？",addBtnTips:"添加关注者",title:"关注者",isEdit:false,isAdd:true,emptyText:"暂无关注者",userSelectOptions:{viewType:"single",input:true,stringLen:{Name:34,Email:30,DepartmentName:30},bias:{left:30,top:-302},muti:true}},template:jst["task-detail/share-range"],itemView:ShareRangeItemView,itemViewContainer:"ul",ui:{add:"a[data-name=add]",deleted:"span[data-name=deleted]",itemLi:"li.item_sr"},events:function(){var events={};events["mouseenter "+this.ui.itemLi]="_liOverHandler";events["mouseleave "+this.ui.itemLi]="_liOutHandler";events["click "+this.ui.deleted]="_deleteShareItem";return events},modelEvents:{"change:isEdit":"render"},templateHelpers:function(){return this.settings},onRender:function(){var self=this;if(!this.collection.length&&!this.model.get("isEdit")){var emptyView=new ShareRangeEmptyView({emptyText:this.settings.emptyText});this.$el.find("ul").html(emptyView.render().$el)}this._addShareUser();this.$el.find("[data-body]").infotip({type:"default",container:this.$el})},initialize:function(){this.settings=Talent.$.extend({},this.defaults,this.options);this.settings["userSelectOptions"]=Talent._.extend({},this.defaults["userSelectOptions"],this.options["userSelectOptions"]);this.model.set(this.settings)},appendHtml:function(collectionView,itemView,index){if(this.model.get("isEdit")){if(this.model.get("isAdd")){collectionView.$el.find("li:last").before(itemView.el)}else{collectionView.$el.find("ul").append(itemView.el)}itemView.$el.attr("data-body","删除："+itemView.model.get("User").Name)}else{itemView.$el.addClass("disable");itemView.$el.find(".del_sr").remove();collectionView.$el.find("ul").append(itemView.el);itemView.$el.attr("data-body",itemView.model.get("User").Name)}},closeView:function(){this.memberSmemberView.deleteView()},_addShareUser:function(event){var self=this;var node=this.ui.add;this.memberSmemberView=new UserSelector({collection:new UserSelectorCollection});var options=util.userSelectorConfig(this.settings["userSelectOptions"]);options["container"]=this.$el;this.memberSmemberView.addNode(node,options);node.on("submit",function(ev,resp){var data,arr=[];if(resp.data){data=resp.data}else{data=[resp]}Talent._.each(data,function(item){if(item.type=="department"){arr.push({Id:item.id,Name:item.name,Email:item.name+":"+item.id+":dep_members"})}else{arr.push({Id:item.Id,Name:item.Name,Email:item.Email})}});self.trigger("add",node,arr)})},_liOverHandler:function(events){var node=Talent.$(events.currentTarget);this.tip=TipInfoView(node,{placement:"top",type:"default",align:"center",container:this.$el})},_liOutHandler:function(events){var node=Talent.$(events.currentTarget);this.tip&&this.tip.destroy()},_deleteShareItem:function(events){events.stopPropagation();events.preventDefault();var node=Talent.$(events.currentTarget);var userId=node.attr("Id");var self=this;Talent.$(".tipsy").remove();var tipInfo=TipInfoView(node,{placement:"top",type:"confirm",body:this.settings.deleteTip,align:"left",container:this.$el,okHide:function(){self.trigger("deleted",node,userId);tipInfo.hide()}})},onClose:function(){this.delDialog&&this.delDialog.close()}});var TaskAcceptPopView=Talent.ItemView.extend({template:jst["task-detail/task-accept-pop"],className:"_tt_dialog task-accept-pop",defaults:{title:"接受todo",classEditable:true,dateEditable:true},modelEvents:{"change:startDate change:endDate change:isLongTerm":"_renderDate"},ui:{sureBtn:"[data-name=task-detail-accept-sure]",cancelBtn:"[data-name=task-detail-accept-cancel]",taskDate:'[data-name="task-detail-accept-date"]',dateConainer:'[data-name="task-detail-accept-date-box"]',dateArea:'[data-name="task-detail-accept-date-area"]'},events:function(){var events={};events["click "+this.ui.sureBtn]="_surePlanType";events["click "+this.ui.cancelBtn]="_cancelPlanType";events["click "+this.ui.taskDate]="_showDatePop";return events},templateHelpers:function(){return{i18n:this.i18n,title:this.settings["title"],classEditable:this.settings["classEditable"]}},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);this.i18n=Talent.Context.getI18n();$(document).on("mousedown.Task-Accept-Pop-View",function(){self.$el.hide()});this.$el.on("mousedown.Task-Accept-Pop-View",function(event){event.stopPropagation()})},open:function(node,options){var defaults={pos:"bottom",topBias:10};var options=Talent._.extend({},defaults,options);Context.setPosition(node,this.$el,options);this.$el.show()},hide:function(){this.$el.hide()},_surePlanType:function(ev){this.trigger("submit");this.$el.hide()},_cancelPlanType:function(){this.trigger("cancel");this.$el.hide()},_showDatePop:function(ev){if(!this.settings.dateEditable)return;if(ev)ev.stopPropagation();var self=this,node=this.$(ev.currentTarget);this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView({viewType:"date",model:this.model,rangepickerOptions:{timePickerOpens:"left",showLong:true,format:"YYYY/MM/DD HH:mm",timePicker:true},isShowDateView:true,isShowCycleView:false,isShowLongView:true,isShowTab:true});this.ui.dateConainer.append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.ui.dateConainer,pos:"bottom",leftBias:-50})},_renderDate:function(){var startDate=this.model.get("startDate"),endDate=this.model.get("endDate"),isLongTerm=this.model.get("isLongTerm");this.ui.taskDate.val(startDate+" - "+(isLongTerm?"长期":endDate))},onClose:function(){if(this.ui.taskDate.data("daterangepicker")){this.ui.taskDate.data("daterangepicker").remove()}$(document).off("mousedown.Task-Accept-Pop-View")}});var TaskDetailUnacceptView=Talent.ItemView.extend({template:jst["task-detail/task-unaccept"],className:"ux_edittask_accept_wrap",initialize:function(options){var self=this;this.options=options;this.i18n=Context.getI18n();this.userInfo=Context.getUserInfo();this.StartDate=this.model.get("weekStartDate");this.EndDate=this.model.get("weekEndDate");this.model.set({isTransfer:false,transferUser:""});this.datePopModel=new Talent.Model},ui:{acceptTask:'[data-name="accept-task"]',sureTransfer:'[data-name="sure-transfer"]',cancelTransfer:'[data-name="cancel-transfer"]',transferTask:'[data-name="transfer-task"]',uxEdittaskAcceptOther:'div[data-name="ux_edittask_accept_other"]',refuseTask:'[data-name="refuse-task"]',participateTask:'[data-name="participate-task"]',acceptContainer:'[data-name="accept-container"]',acceptArea:'[data-name="accept-area"]'},modelEvents:{"change:isTransfer":"render","change:transferUser":"render"},events:function(){var events={};events["click "+this.ui.acceptTask]="_showAcceptPop";events["click "+this.ui.sureTransfer]="_sureTransferTask";events["click "+this.ui.cancelTransfer]="_cancelTransferTask";events["click "+this.ui.refuseTask]="_refuseTaskPop";events["click "+this.ui.participateTask]="_participateTaskPop";return events},templateHelpers:function(){return{i18n:this.i18n,userInfo:this.userInfo}},onRender:function(){var self=this;var options=util.userSelectorConfig(this.options.addUserSelectonOptions);this.userSelectorView=new UserSelector({collection:new UserSelectorCollection});this.userSelectorView.addNode(this.ui.transferTask,options);this.ui.transferTask.on("submit",function(ev,user){ev.stopPropagation();var principalUser=self.model.get("principalUser");if(user.Id==principalUser.userId){TipInfoView(self.ui.transferTask,{placement:"bottom",type:"remind",body:"转交他人不能是自己",align:"center",container:self.ui.acceptContainer,ico:"warn"});return}var applyUser=self.model.get("applyUser");if(applyUser&&applyUser["userId"]==user.Id){TipInfoView(self.ui.transferTask,{placement:"bottom",type:"remind",body:"负责人和审批人不能是同一人",align:"center",container:self.ui.acceptContainer,ico:"warn"});return}var changeUser=self._formatChangeUser(user);self.model.set("transferUser",changeUser);self.model.set("isTransfer",true)})},_refuseTaskPop:function(ev){ev.stopPropagation();var self=this,node=Talent.$(ev.currentTarget),html="参与任务可跟踪任务进展，您确定不参与吗？";TipInfoView(node,{placement:"bottom",type:"confirm",body:html,align:"right",container:this.$el,okHide:function(){self._requestDeleteParticipator(node)}})},_requestDeleteParticipator:function(node){var self=this;TaskCollection.taskDeleteParticipator({task_id:this.model.get("taskId"),to_user_id:this.userInfo.Id}).done(function(resp){if(self.isClosed)return;self.render();self.trigger("notToJoin",node,self.model.toJSON())}).fail(function(msg){TipInfoView(node,{placement:"bottom",type:"remind",body:msg,align:"center",container:self.ui.acceptContainer,ico:"warn"})})},_participateTaskPop:function(ev){ev.stopPropagation();var self=this,node=Talent.$(ev.currentTarget),html="确认参与该任务?";TipInfoView(node,{placement:"bottom",type:"confirm",body:html,align:"right",container:this.$el,okHide:function(){self._requestAccept(node)}})},_requestAccept:function(node){var self=this;TaskCollection.participatorAccept({task_id:this.model.get("taskId")}).done(function(resp){if(self.isClosed)return;self.trigger("takeInTask",self.model.toJSON())}).fail(function(msg){TipInfoView(node,{placement:"bottom",type:"remind",body:msg,align:"center",container:self.ui.acceptContainer,ico:"warn"})})},_showAcceptPop:function(events){events.stopPropagation();var self=this,node=Talent.$(events.currentTarget),startDate=this.model.get("startDate"),endDate=this.model.get("deadLine"),type=node.attr("data-type"),cycleId=this.model.get("cycleId")||0;

this.datePopModel.set({startDate:startDate,endDate:endDate,labelName:this.model.get("labelName"),labelType:this.model.get("labelType"),labelId:this.model.get("labelId"),isLongTerm:this.model.get("isLongTerm"),cycleId:this.model.get("cycleId")});this.setTaskDatePop&&this.setTaskDatePop.close();this.setTaskDatePop=new TaskAcceptPopView({model:this.datePopModel,title:"接受"+this.i18n["task_1"],classEditable:type=="1"?false:true,createPickerOpens:"left",dateEditable:!cycleId?true:false});this.listenTo(this.setTaskDatePop,"submit",function(){TaskCollection.taskAccept({task_id:this.model.get("taskId"),start_date:this.datePopModel.get("startDate"),end_date:this.datePopModel.get("endDate"),parent_task_id:this.datePopModel.get("taskId"),lab_id:this.datePopModel.get("labelId"),lab_type:this.datePopModel.get("labelType"),isLongTerm:this.datePopModel.get("isLongTerm")}).done(function(resp){if(self.isClosed)return;self.trigger("takeInTask",self.model.toJSON())}).fail(function(resp){TipInfoView(self.ui.acceptTask,{placement:"bottom",type:"remind",body:resp,align:"center",container:self.ui.acceptContainer,ico:"warn"})})});this.$el.append(this.setTaskDatePop.render().el);this.setTaskDatePop.open(node,{container:this.$el})},_formatChangeUser:function(user){var PrincipalUser={};PrincipalUser["userId"]=user.Id;PrincipalUser["avatar"]=user.UserAvatar;PrincipalUser["name"]=user.Name;return PrincipalUser},_sureTransferTask:function(){var self=this;var transferUser=this.model.get("transferUser");TaskCollection.updateTaskPrincipalUser({task_id:this.model.get("taskId"),to_user_id:transferUser.userId}).done(function(resp){if(self.isClosed)return;self.trigger("transfer",self.model.toJSON())}).fail(function(resp){TipInfoView(self.ui.sureTransfer,{placement:"bottom",type:"remind",body:resp,align:"center",container:self.ui.acceptContainer,ico:"warn"})})},_cancelTransferTask:function(){this.model.set("isTransfer",false)},onClose:function(){this.setTaskDatePop&&this.setTaskDatePop.close();this.userSelectorView&&this.userSelectorView.close()}});var TaskDetailActionview=Talent.ItemView.extend({template:jst["task-detail/task-action"],className:"tt-task-detail-topbar",ui:{setTaskNotice:'[data-name="set-task-notice"]',setTaskStar:'[data-name="set-task-star"]',setTaskDelete:'[data-name="set-task-deleted"]',setTaskStatus:'[data-name="task-set-status"]',quitTask:'[data-name="quit-task"]',tipsyNode:"[data-infotip-body]",followBtn:'[data-name="follow-btn"]',webim:"[data-name=webim]",taoshang:"[data-name=reward-tao]",dashang:"[data-name=reward-shang]"},modelEvents:{"change:isMark":"render","change:isFollow":"render","change:isRemind":"render"},templateHelpers:function(){var Mapping={0:{iconName:"tu-icon-checkbox-have",tipTxt:"未开始"},1:{iconName:"tu-icon-ing",tipTxt:"进行中"},2:{iconName:"tu-icon-check-active",tipTxt:"已完成"},3:{iconName:"tu-icon-delay",tipTxt:"已延迟"},4:{iconName:"tu-icon-cross2",tipTxt:"已取消"},5:{iconName:"tu-icon-weijieshou",tipTxt:"未接受"},6:{iconName:"tu-icon-pause",tipTxt:"暂停中"}};var status=this.model.get("status");var header=Context.getGlobal("Header")||[];var isOpenReward=util_rewardOpen();var userType=this.userInfo["UserType"]||1;var relation=this.model.get("relation");var isAccept=this.model.get("isAccept");var isExternal=this.model.get("isExternal");this.webimAble=userType==3;var WorkAdvancedSetting=Context.getGlobal("WorkAdvancedSetting");var WorkExternal=WorkAdvancedSetting.WorkFunctionSetting.WorkExternal;return{StatusTip:Mapping[status]["tipTxt"],iconName:Mapping[status]["iconName"],showWbim:this.showWbim,isOpenReward:isOpenReward,webimAble:this.webimAble,starAble:userType!==2&&(relation==1||relation==2||relation==3),daShangeAble:isOpenReward,taoShangAble:false,followAble:userType!==2&&(relation==0||relation==6||relation==4||relation==5),remindAble:userType!==2,quitAble:userType!==2&&isAccept&&relation==2,showCaution:typeof isExternal!=="undefined"&&isExternal&&userType!==2,WorkExternal:WorkExternal}},events:function(){var events={};events["click "+this.ui.setTaskStar]="_renderSetStar";events["click "+this.ui.setTaskDelete]="_onDeleteHandler";events["click "+this.ui.setTaskStatus]="_changeTaskStatus";events["mouseup "+this.ui.setTaskStatus]="_stopMouseupHandler";events["click "+this.ui.quitTask]="_onQuitTaskHandler";events["click "+this.ui.setTaskNotice]="_clickRemindHandler";events["mouseup "+this.ui.setTaskNotice]="_stopMouseupHandler";events["mouseover "+this.ui.tipsyNode]="_showTipHandler";events["mouseout "+this.ui.tipsyNode]="_hideTipHandler";events["mouseenter "+this.ui.dashang]="_mouseInDashangHandler";events["mouseleave "+this.ui.dashang]="_mouseOutDashangHandler";events["click "+this.ui.taoshang]="_clickTaoshangHandler";events["click "+this.ui.dashang]="_clickDashangHandler";events["click "+this.ui.followBtn]="_follow";events["click "+this.ui.webim]="_showWebim";return events},initialize:function(options){var self=this;this.options=options;this.iTask=this.model.get("iTask");this.userInfo=Context.getUserInfo();this.model.set({isFollow:this.model.get("relation")==6?true:false});this.showWbim=false;this.showWbim=Context.getAppHead("951")},onRender:function(){var self=this;if(!this.webimAble)return;this.ui.webim.hide();var webimLoaded=Context.getGlobal("webimLoaded")||false;if(webimLoaded){this.ui.webim.show();this._hasGroup()}else{Talent.app.vent.on("webimLogin:Italent-Layout",function(){self.$el.find("[data-name=webim]").show();self._hasGroup()})}},_clickTaoshangHandler:function(ev){ev.stopPropagation();this._renderRewardAppView("beg")},_clickDashangHandler:function(ev){ev.stopPropagation();this._renderRewardAppView("give")},_renderRewardAppView:function(){var self=this;util_rewardGetFile(function(myReward){var principalUser=self.model.get("principalUser");myReward.renderPayReward({toUserInfo:{name:principalUser.name,avatar:{hasAvatar:principalUser.avatar.HasAvatar,img:principalUser.avatar.Medium,color:principalUser.avatar.Color},id:principalUser.userId},objId:self.options.id,objType:7})})},_showWebim:function(event){if(window.beisenWebim){var beisenWebim=new window.beisenWebim({});beisenWebim.popupTaskPanel({taskId:this.model.get("taskId"),taskTitle:this.model.get("taskName"),appId:1});this.ui.webim.attr("original-title","进入群聊")}},_hasGroup:function(){var self=this;var getGroupId=function(){var objId=self.model.get("taskId");var uid=Talent.Context.getUserInfo().Id;var tid=Talent.Context.getTenantInfo().Id;var url="//webim."+Talent.Context.getGlobal("webPath");$.ajax({url:url+"/api/v1/"+tid+"/"+uid+"/webim/group",type:"GET",data:{objectType:"task",objectId:objId,appId:1},success:function(resp){if(resp.Code!=1)return;if(resp.Data){self.$el.find("[data-name=webim]").attr("original-title","进入群聊")}else{self.$el.find("[data-name=webim]").attr("original-title","创建群聊")}}})};Talent.Context._getXSSAjax("webim",getGroupId)},_stopMouseupHandler:function(event){event.stopPropagation()},_follow:function(ev){var self=this,node=this.$(ev.currentTarget),isFollow=this.model.get("isFollow"),userInfo=this.userInfo,callbackFunc=null;ev.stopPropagation();if(isFollow){function callback(){TaskCollection.deleteFollower({taskId:this.model.get("taskId"),toUserId:userInfo.Id}).done(function(resp){if(self.isClosed)return;self.model.set({isFollow:!isFollow});self.trigger("request")})}callbackFunc=Talent._.bind(callback,this);this._showInfotipView(node,{type:"confirm",trigger:"manual",body:"确定取消关注？取消后进展信息将不再推到动态下",placement:"bottom",align:"right",container:this.$el},function(){callbackFunc();self.cancelFollowComfirmPop.hide()},"cancelFollowComfirmPop")}else{TaskCollection.addFollower({task_id:this.model.get("taskId"),followers:[userInfo]}).done(function(resp){if(self.isClose)return;self._showInfotipView(node,{type:"remind",align:"right",body:"关注成功，默认所有进展将推送到动态下。",placement:"bottom",container:self.$el},function(){},"followSuccessComfirmPop");self.listenTo(self.followSuccessComfirmPop,"hide",function(){self.model.set({isFollow:!isFollow})})}).fail(function(msg){self._showInfotipView(node,{type:"remind",trigger:"manual",ico:"error",body:msg,placement:"bottom",container:self.$el},function(){},"followFailComfirmPop")})}},_onFollowChange:function(){var node=this.ui.followBtn,isFollow=this.model.get("isFollow");node.attr("data-infotip-body",isFollow?"取消关注":"关注")},_clickRemindHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.setNoticeView&&this.setNoticeView.close();this.setNoticeView=new SetNoticeView;this.listenTo(this.setNoticeView,"sure",function(){this.model.set("isRemind",true);node.addClass("active")});this.listenTo(this.setNoticeView,"cancelRemind",function(){this.model.set("isRemind",false);node.removeClass("active")});this.setNoticeView.render();this.setNoticeView.setPosition(node)},_showTipHandler:function(event){var node=Talent.$(event.currentTarget);this.tipView=new Infotip;var txt=node.attr("data-infotip-body");var options={container:this.$el,type:"default",placement:"bottom",align:"center",body:txt,autohide:false};this.tipView.bindNode(node,options);this.tipView.show()},_hideTipHandler:function(){this.tipView&&this.tipView.destroy},_showInfotipView:function(node,options,callback,viewName){this[viewName]&&this[viewName].close();this[viewName]=new Infotip;this[viewName].bindNode(node,options);this[viewName].show();if(callback&&typeof callback=="function"){this.listenTo(this[viewName],"ok",callback)}},_onDeleteHandler:function(events){events.stopPropagation();var self=this,node=Talent.$(events.currentTarget);var text="";var selfUserName=Talent.Context.getUserInfo().Name;var principalUserName=this.model.get("principalUser").name;if(this.model.get("applyUser")&&selfUserName==principalUserName){self._applyWarn(node,4,"该事项将被删除不可恢复，并向审批人发送审批申请，请谨慎操作！").done(function(type){if(type){self._afterDeleteHandler("appplyInfoTipView",node)}else{self._noneApplyDelete(node)}})}else{this._noneApplyDelete(node)}},_noneApplyDelete:function(node){var self=this;this._showInfotipView(node,{type:"confirm",trigger:"manual",body:"该事项将被删除不可恢复！请谨慎操作",placement:"bottom",align:"right",container:this.$el},function(){self._afterDeleteHandler("deleteTaskComfirmPop",node)},"deleteTaskComfirmPop")},_afterDeleteHandler:function(popName,node){this[popName].destroy();this.trigger("deleted",node,this.model.toJSON())},_onQuitTaskHandler:function(events){events.stopPropagation();var self=this,node=Talent.$(events.currentTarget);this._showInfotipView(node,{type:"confirm",trigger:"manual",body:"确定退出吗？退出后将看不到任务进展",placement:"bottom",align:"right",container:this.$el},function(){self.trigger("exit",node,self.model.toJSON())},"quitTaskComfirmPop")},_changeTaskStatus:function(event){event.stopPropagation();var self=this;var node=Talent.$(event.currentTarget);$(".tipsy").hide();this.planItemStatusView&&this.planItemStatusView.hide();this.planItemStatusView=new OperationStatusView({model:new Talent.Model({status:this.model.get("status"),id:this.model.id})});this.listenTo(this.planItemStatusView,"click:status",function(model){var cycleId=this.model.get("cycleId");var statusMapping={2:5,1:7,4:9,3:8,6:16,0:6};if(model.status==2){if(cycleId){this._showInfotipView(node,{type:"confirm",trigger:"manual",body:"您确定完成此循环"+self.iTask+"吗？完成后不可重启",placement:"bottom",align:"left",container:this.$el},function(){self.model.set("status",model.status);self._applyWarn(node,statusMapping[model.status],"修改任务信息，会给审批人发送审批申请哦~").done(function(){self._requestUpStatus(model);self.appplyInfoTipView&&self.appplyInfoTipView.destroy()})},"changeStatusComfirmPop");return}}var selfUserName=Talent.Context.getUserInfo().Name;var principalUserName=this.model.get("principalUser").name;if(this.model.get("applyUser")&&selfUserName==principalUserName){self._applyWarn(node,statusMapping[model.status],"修改任务信息，会给审批人发送审批申请哦~").done(function(){self._requestUpStatus(model);self.appplyInfoTipView&&self.appplyInfoTipView.destroy()})}else{self._requestUpStatus(model);self.appplyInfoTipView&&self.appplyInfoTipView.destroy()}});this.planItemStatusView.render();this.$el.append(this.planItemStatusView.$el);this.planItemStatusView.show(node)},_renderExperience:function(){var self=this;this.experienceView=new ExperienceView({id:self.model.get("taskId"),requestSubmit:function(formatData,data){var deferred=new Talent.$.Deferred;ExperienceCollection.addShare({ObjId:self.model.get("taskId"),Content:data["code"],FileUrls:_.pluck(data["file"],"DfsPath").join(","),StartDate:moment().format("YYYY/MM/DD"),EndDate:moment().format("YYYY/MM/DD"),DocumentModels:formatData["documents"]}).done(function(resp){if(self.isClose)return;self.trigger("changeStatus",self.ui.setTaskStatus,self.model.toJSON());deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred}});this.listenTo(this.experienceView,"hide",function(){this.trigger("changeStatus",this.ui.setTaskStatus,this.model.toJSON())});this.experienceView.show(this.ui.setTaskStatus,{container:this.$el,align:"left"})},_requestUpStatus:function(model){var self=this,node=this.ui.setTaskStatus;TaskCollection.updateStatus({task_id:this.model.get("taskId"),status:model.status}).done(function(resp){if(self.isClose)return;self.model.set("status",model.status);if(self.model.get("relation")==1&&model.status==2){self._renderExperience()}else{self.trigger("changeStatus",self.ui.setTaskStatus,self.model.toJSON())}util.sendMessageBySDK("taskInfo",{id:self.model.get("taskId"),model:{status:model.status}})}).fail(function(resp){if(self.isClose)return;if(self.model.get("applyUser")&&!self.model.get("isApply")){setTimeout(function(){self.model.set("isApply",true);self.render()},3e3);util.sendMessageBySDK("taskInfo",{id:self.model.get("taskId"),model:{isApply:true}});return}self._showInfotipView(node,{type:"remind",trigger:"manual",body:resp,placement:"right",align:"left",ico:"warn",container:self.$el},"failTip")})},_renderSetStar:function(events){var self=this;$("body .tipsy").remove();var isMark=!this.model.get("isMark");var node=Talent.$(events.currentTarget);var type=isMark?1:2;TaskCollection.taskSetMark({task_id:this.model.get("taskId"),type:type}).done(function(resp){if(self.isClose)return;self.model.set("isMark",isMark)})},_applyWarn:function(node,apply_type,remindMsg){var self=this;var deferred=new Talent.$.Deferred;if(!this.model.get("applyUser")){deferred.resolve()}TaskCollection.applyWarn({task_id:this.id,apply_type:apply_type}).done(function(resp){if(resp.Obj==0){deferred.resolve(0)}if(resp.Obj==1){self._showInfotipView(node,{placement:"bottom",type:"confirm",body:remindMsg,align:"left",container:self.$el,trigger:"manual",okHide:function(){deferred.resolve(1)}},function(){},"appplyInfoTipView")}if(resp.Obj==2){self._showInfotipView(node,{placement:"bottom",type:"remind",body:"审批中，暂不可操作",align:"left",container:self.$el,ico:"warn",trigger:"manual",hide:function(){}},function(){},"appplyInfoTipView")}});return deferred},onClose:function(){this.isClose=true;Talent.$(".tipsy").remove();this.planItemStatusView&&this.planItemStatusView.close()}});var TaskInfoView=Talent.Layout.extend({template:jst["task-detail/task-info"],regions:{taskDescEdit:'div[data-name="task-detail-descript-edit"]'},modelEvents:{},ui:{taskNameWrap:'div[data-name="task-detail-name"]',taskName:'div[data-name="task-detail-name"] input',taskNameTxt:'div[data-name="task-name"]',taskDesc:'div[data-name="task-detail-descript"]',taskDescAdd:'a[data-name="task-detail-descript-add"]',taskDescEdit:'div[data-name="task-detail-descript-edit"]',taskDesContainer:"[data-name=description-container]",editExtra:"[data-name=edit-extra]",confirm:"button[data-name=confirm]",cancel:"button[data-name=cancel]",errorTip:"[data-name=error-tip]"},className:"ux-edittask__info",templateHelpers:function(){var taskName=this.model.get("taskName");if(this.model.get("editable")){taskName=taskName.replace(/(\<br\/\>)/g,"\n")}return{taskName:taskName}},events:function(){var events={};events["click "+this.ui.taskNameTxt]="_onTaskNameTxtClick";events["keyup "+this.ui.taskName]="_onKeyup";events["click "+this.ui.taskDescAdd]="_showRichEditor";events["click "+this.ui.taskDesc]="_showRichEditor";events["click "+this.ui.confirm]="_confirmTaskName";events["click "+this.ui.cancel]="_cancelTaskName";return events},initialize:function(options){var self=this;this.setting=Talent._.extend({},this.defaults,options);this.isClose=false;this.isShowRich=false;this.isFocusInName=false;this.isCanSubmit=true;this.descriptionChanged=false},onRender:function(){var self=this;this.richEditorView&&this.richEditorView.close();this.richEditorView=null},onShow:function(){var self=this;if(!this.bindResize){this.bindResize=true}},_showRichEditor:function(events){events.stopPropagation();var self=this;var editable=this.model.get("editable"),getDes="";if(!editable){return}var des=this.model.get("description")||"";this.isShowRich=true;this.ui.taskDesc.hide();this.ui.taskDescAdd.hide();this.ui.taskDescEdit.show();if(!this.richEditorView){this.richEditorView&&this.richEditorView.close();this.richEditorView=new NewRichEditor({containerId:"taskDes"+self.model.get("taskId"),hasBtns:true,maxWords:5e3,placeholder:"请输入任务描述",maxHeight:660});this.richEditorView.show();this.listenTo(this.richEditorView,"editorChange",function(data){getDes=data.html;if(getDes==self.model.get("description")){self.descriptionChanged=false}else{self.descriptionChanged=true}});this.listenTo(this.richEditorView,"editorSubmit",function(){self._hideRichEditor(getDes);self.descriptionChanged=false});this.listenTo(this.richEditorView,"editorConcel",function(){self.descriptionChanged=false;self._hideRichEditor(self.model.get("description"))})}this.richEditorView.fillContent(des);this.richEditorView&&this.richEditorView.focus()},_hideRichEditor:function(des){if(!this.richEditorView)return;if(this.isClose)return;var self=this;var initDescript=this.model.get("description");this.isShowRich=false;var selfUserName=Talent.Context.getUserInfo().Name;var principalUserName=this.model.get("principalUser").name;if(initDescript!=des){if(selfUserName==principalUserName){this._applyWarn(this.ui.taskDesContainer,15,"修改任务信息，会给审批人发送审批申请哦~").done(function(){self._requestDes(des)}).fail(function(){self._descriptShow(initDescript)})}else{self._requestDes(des)}}else{this._descriptShow(initDescript,true)}},_descriptShow:function(des,flag){if(!this.descriptionChanged||flag){if(des==""){this.ui.taskDescAdd.show()}else{this.ui.taskDesc.show()}this.ui.taskDescEdit.hide()}},_requestDes:function(description){var self=this;TaskCollection.UpdateDescription({task_id:this.model.get("taskId"),Description:description}).done(function(resp){if(self.isClose)return;self.model.set("description",description);self.ui.taskDesc.html(description);if(description!=""){self.ui.taskDesc.show()}else{self.ui.taskDescAdd.show()}self.ui.taskDescEdit.hide()}).fail(function(resp){if(self.isClose)return;var initDescript=self.model.get("description");self._descriptShow(initDescript,true)})},_renderDescription:function(){var description=this.model.get("description");if(!Description){this.$el.find('div[data-name="ux-redactor-editor"]').html(description);this.$el.find('div[data-name="ux-redactor-editor"]').hide();this.$el.find('a[data-name="add-task-descript"]').show()}else{this.$el.find('div[data-name="ux-redactor-editor"]').html(description);this.ui.uxRedactorEditor.show()}},_onTaskNameTxtClick:function(ev){var editable=this.model.get("editable");if(!editable)return;ev.stopPropagation();var node=Talent.$(ev.target),taskName=_.unescape(this.model.get("taskName"));node.hide();this.ui.editExtra.slideDown(150);this.ui.taskName.val(taskName).show().focus();this._onKeyup();this.isFocusInName=true;this._descriptShow(this.model.get("description"))},_confirmTaskName:function(ev){ev.stopPropagation();var self=this;this.isFocusInName=false;if(!this.isCanSubmit)return;var selfUserName=Talent.Context.getUserInfo().Name;var principalUserName=this.model.get("principalUser").name;if(this.model.get("applyUser")&&selfUserName==principalUserName){self._applyWarn(this.ui.taskName,1,"修改任务信息，会给审批人发送审批申请哦~").done(function(){self._changeTaskName()}).fail(function(){self._cancelTaskName()})}else{self._changeTaskName()}},_cancelTaskName:function(){var self=this;this.ui.editExtra.slideUp(100,function(){self.ui.taskNameTxt.text(_.unescape(self.model.get("taskName"))).show();self.ui.taskName.hide();self._descriptShow(self.model.get("description"))})},_onKeyup:function(ev){var node=this.ui.taskName,val=Talent.$.trim(node.val());if(val.length==0){var html="任务名称为必填项";this._showErrorTip(html)}else if(val.length>500){var html="您已输入 "+val.length+" 字，最多可输入 500 字";this._showErrorTip(html)}else{this.isCanSubmit=true;this.ui.confirm.removeClass("disabled");this.ui.taskName.removeClass("error");this.ui.errorTip.hide()}},_showErrorTip:function(text){this.isCanSubmit=false;this.ui.errorTip.html(text);this.ui.confirm.addClass("disabled");this.ui.taskName.addClass("error");this.ui.errorTip.show()},_changeTaskName:function(){var self=this;var taskName=_.escape(Talent.$.trim(this.ui.taskName.val())),model_name=this.model.get("taskName");taskName=Context.encodeScript(taskName);taskName=taskName.replace(/[\n\r]/g,"<br/>");TaskCollection.updateTaskName({task_id:this.model.get("taskId"),TaskName:taskName}).done(function(resp){if(self.isClosed)return;self.model.set({taskName:taskName});self._cancelTaskName();util.sendMessageBySDK("taskInfo",{id:self.model.get("taskId"),model:{taskName:taskName}})}).fail(function(resp){if(self.isClose)return;if(self.model.get("applyUser")&&!self.model.get("isApply")){self.model.set("isApply",true);util.sendMessageBySDK("taskInfo",{id:self.model.get("taskId"),model:{isApply:true}})}self._cancelTaskName()})},_showTipDialog:function(node,body,options){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",type:"remind",body:body,trigger:"manual",align:"left",container:this.$el,ico:"warn"};var options=options||{};var settings=Talent._.extend({},defaults,options);this.infoTipView=new Infotip;this.infoTipView.bindNode(node,settings);this.infoTipView.show()},_applyWarn:function(node,applyType,remindMsg){var self=this;var deferred=new Talent.$.Deferred;if(!this.model.get("applyUser")){deferred.resolve()}TaskCollection.applyWarn({task_id:this.model.get("taskId"),apply_type:applyType}).done(function(resp){if(resp.Obj==0){deferred.resolve()}if(resp.Obj==1){self._showTipDialog(node,remindMsg,{placement:"bottom",type:"confirm",align:"left",container:self.$el,ico:"warn",okHide:function(){deferred.resolve();self.infoTipView.hide()}})}if(resp.Obj==2){if(self.model.get("applyUser")&&!self.model.get("isApply")){self.model.set("isApply",true)}self._showTipDialog(node,"审批中，暂不可操作");deferred.reject()}});return deferred},onClose:function(){this.isClose=true;Talent.$(document).off("click.Task-Detail-Info-View")}});var TaskDetailBaseInfoView=Talent.ItemView.extend({defaults:function(){return{id:"",classDialogOptions:{model:new Talent.Model({type:17}),isShowSearch:true,isShowProject:this.model.get("labelEditable")}}},template:jst["task-detail/task-base-info"],className:"ux_editask_base",ui:{tipInfo:"[data-toggle=tip]",changeRelate:"[data-name=task-relate-change]",EditTaskLink:"[data-name=edit-task-link]",setTaskDate:'span[data-name="set-task-date"]',taskAddPartnerDelete:"em[data-name=task-detail-parnter-delete]",taskAddPartner:'[data-name="task-add-partner"]',taskTransferUser:'[data-name="task-transfer-user"]',applyArea:"[data-name=apply-area]",taskApplyWrap:"span[data-name=task-apply-wrap]",taskApplyAdd:"[data-name=task-apply-user-add]",taskDeleteApply:"em[data-name=task-apply-user-delete]",taskApplyEdit:"[data-name=task-apply-user-edit]",taskEditClass:'[data-name="task-edit-class"]',editCycle:'[data-name="task-edit-cycle-edit"]',cycleText:'[data-name="task-edit-cycle"]',dateArea:"[data-name=date-area]",dateEdit:"[data-name=task-detail-date-edit]",cycleArea:"[data-name=cycle-area]",cancelCycle:"[data-name=task-detail-cancel-cycle]",pricalArea:'div[data-name="prical-area"]',classArea:'div[data-name="class-area"]',paticipatorsArea:'div[data-name="participators-area"]',toggle:'div[data-name="task-detail-toggle"]',allInfo:'[data-name="task-detail-all-info"]',kclass:'[data-name="kclass"]',uploaderBtn:"div[data-name=task-detail-attachment-button]",attachemntList:"div[data-name=task-detail-attachment-list]",classContainer:'[data-name="class-container-wrap"]',classText:"[data-name=task-class-text]"},modelEvents:{"change:startDate":"render","change:deadLine":"render","change:principalUser":"render","change:isLongTerm":"render","change:labelName":"render","change:cycleInfo":"render","change:applyUser":"render","change:participators":"render"},events:function(){var events={};events["click "+this.ui.changeRelate]="_changeTaskRelate";events["click "+this.ui.EditTaskLink]="_EditTaskLink";events["click "+this.ui.taskAddPartnerDelete]="_deleteParticipator";events["click "+this.ui.taskDeleteApply]="_deleteApprover";events["click "+this.ui.taskEditClass]="_changeTaskClass";events["mouseup "+this.ui.taskEditClass]="_stopMouseUp";events["click "+this.ui.editCycle]="_editCycleHandler";events["mouseup "+this.ui.editCycle]="_editDateMouseupHandler";events["click "+this.ui.dateEdit]="_editDateHandler";events["mouseup "+this.ui.dateEdit]="_editDateMouseupHandler";events["click "+this.ui.cancelCycle]="_cancleCycleTask";events["mouseup "+this.ui.cancelCycle]="_editDateMouseupHandler";events["click "+this.ui.toggle]="_toggle";events["mouseenter "+this.ui.tipInfo]="_tipInfoShow";events["mouseleave "+this.ui.tipInfo]="_tipInfoHide";events["click "+this.ui.taskTransferUser]="_changeFZR";events["click "+this.ui.taskApplyAdd]="_changeSPR";events["click "+this.ui.taskApplyEdit]="_changeSPR";events["click "+this.ui.taskAddPartner]="_addParnter";return events},templateHelpers:function(){var cycleId=Number(this.model.get("cycleId")),feedType=this.model.get("feedType"),isPrivate=this.model.get("isPrivate"),labelType=this.model.get("labelType"),app=this.model.get("app")||{},appType=app["appType"]||0,objType=0,departmentId=this.model.get("departmentId");var TaskAdvancedSetting=Talent.Context.getGlobal("TaskAdvancedSetting");var TaskParticipants=TaskAdvancedSetting.TaskFunctionSetting.TaskParticipants;var TaskApply=TaskAdvancedSetting.TaskRecommendSetting.TaskApply;var TaskParticipants=this.model.get("participatorsVisible");var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;var TaskApply=this.model.get("applyUserVisible");var parentName=this.model.get("parentName")||"";parentName=parentName.replace(/<br\/>/g,"");if(cycleId>0){var cycleHtml=this._formateCyCleHtml()}if(labelType){objType=labelType}if(departmentId){objType=15}var startDate=this.model.get("startDate"),deadLine=this.model.get("deadLine");return{startDate:Context.formatDate(startDate),deadLine:Context.formatDate(deadLine),cycleHtml:cycleHtml?cycleHtml:"",privateText:_.privateTipText(20,isPrivate,objType,appType),isPackUp:this.model.get("isPackUp"),parentName:_.substring(parentName,30,true),userInfo:Talent.Context.getUserInfo(),TaskParticipants:TaskParticipants,TaskApply:TaskApply,TaskLabel:TaskLabel}},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults(),options);this.id=this.settings["id"];this.userInfo=Context.getUserInfo();this.i18n=Context.getI18n();this.iTask=this.model.get("iTask");this.isClose=false;this.fileCollection=null;if(!this.model.get("isAccept")||this.model.get("isAccept")&&!this.model.get("editable")){this.model.set("isPackUp",true);this.toggleOpen=true}else{this.model.set("isPackUp",false);this.toggleOpen=false}this.model.set({remainTime:this._getRemainTime(this.model.get("deadLine"))});this.showLabelTipsy=false;if(window.top==window.self)return;window.iTalentSDK&&window.iTalentSDK.register([{listenEvent:"tita__task-relate-modal__backTaskList",context:this,cb:function(data){self.model.set({parentName:data["parentName"],parentId:data["parentId"],labelType:data["labelType"],labelId:data["labelId"],labelName:data["labelName"]});self.render()}}])},onRender:function(){var self=this;var applyUser=this.model.get("applyUser");this._renderAttachmentView();this._renderAttachmentList(this.model.get("attachments")||[])},_clickEdit:function(ev){var node=Talent.$(ev.currentTarget);this._editeActiveHandler(node,"addActive")},_tipInfoShow:function(events){var node=$(events.currentTarget),body=node.attr("data-tip");var bias={left:0,top:0};if(node.attr("data-name")=="task-relate-text"){var bias={left:36,top:0}}this._showTipDialog(node,{placement:"top",type:"default",body:body,align:"center",container:this.$el,ico:"default",bias:bias},"TipView")},_tipInfoHide:function(){this.TipView&&this.TipView.destroy()},_changeTaskRelate:function(events){events.stopPropagation();var self=this;var relateEditable=this.model.get("relateEditable");if(!relateEditable)return;var parentId=this.model.get("parentId")||"";if(window.top!==window.self){var host=Talent.Context.getGlobal("titaHost")+"/widget#sdk/task-relate?id="+this.model.get("taskId");window.iTalentSDK&&window.iTalentSDK.showPopup(host,800,500);window.iTalentSDK.register([{listenEvent:"tita__task-relate-modal_loaded",context:this,cb:function(){window.iTalentSDK.sendMessage({publishEvent:"tita__task-relate-modal",data:{taskId:this.model.get("taskId"),parentId:parentId}})}}]);return}this.taskRelateModalView&&this.taskRelateModalView.close();this.taskRelateModalView=new TaskRelateModalView({isShowButtomReset:parentId!=""?true:false,task_id:this.model.get("taskId"),old_parent_task_id:this.model.get("parentId")});this.listenTo(this.taskRelateModalView,"changeRelate",function(resp){this.model.set({parentName:resp["parentName"],parentId:resp["parentId"],labelType:resp["labelType"],labelId:resp["labelId"],labelName:resp["labelName"]});this.render()});this.taskRelateModalView.show()},_requestChangeRelate:function(options,type){var self=this;TaskCollection.changeTask({task_id:this.model.get("taskId"),parent_task_id:options["taskId"],old_parent_task_id:this.model.get("parentId")}).done(function(resp){if(self.isClosed)return;self.model.set({parentName:resp["parentName"],parentId:resp["parentId"],labelType:resp["labelType"],labelId:resp["labelId"],labelName:resp["labelName"]});self.render()}).fail(function(msg){if(self.isClosed)return;var txt=msg;if(type=="change"){txt="不能关联当前任务"}self._showTipDialog(self.ui.text,{placement:"bottom",type:"remind",body:txt,align:"left",container:self.$el,ico:"warn"})})},_EditTaskLink:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),id=node.attr("id");Talent.app.vent.trigger("global-pull-screen",id,"task")},closeUserSelect:function(){this.FZR_userSelectorView&&this.FZR_userSelectorView.deleteView();this.SPR_userSelectorView&&this.SPR_userSelectorView.deleteView();this.CYZ_userSelectorView&&this.CYZ_userSelectorView.deleteView()},_editCycleHandler:function(events){events.stopPropagation();var data=this.model.get("cycleInfo");var starTime=data["CycStartTime"].split(":"),endTime=data["CycEndTime"].split(":");this._renderDatePicker(events,"cycle",{rangepickerOptions:{startDate:this.model.get("startDate"),endDate:this.model.get("deadLine")},isShowDateView:false,isShowCycleView:true,isShowLongView:false,isShowTab:true,viewType:"cycle",model:new Talent.Model({cycType:data["CycType"],cycStartDay:data["CycStartDate"],cycEndDay:data["CycEndDate"],cycStartHour:starTime[0],cycStartMinute:starTime[1],cycEndHour:endTime[0],cycEndMinute:endTime[1]}),leftBias:0})},_requestUpdateCycle:function(data){var cycleInfo=this.model.get("cycleInfo"),self=this;var today=moment().format("YYYY-MM-DD");TaskCollection.UpdateCycleTask({cycle_id:this.model.get("cycleId"),CycType:data["cycType"],CycStartDate:data["cycStartDay"],CycStartTime:today+" "+data["cycStartHour"]+":"+data["cycStartMinute"],CycEndDate:data["cycEndDay"],CycEndTime:today+" "+data["cycEndHour"]+":"+data["cycEndMinute"]}).done(function(resp){if(self.isClose)return;var cycleData=Talent._.extend({},cycleInfo,{CycEndDate:data["cycEndDay"],CycEndTime:data["cycEndHour"]+":"+data["cycEndMinute"],
CycStartDate:data["cycStartDay"],CycStartTime:data["cycStartHour"]+":"+data["cycStartMinute"],CycType:data["cycType"]});self.model.set("cycleInfo",cycleData);var html=self._formateCyCleHtml();self.ui.cycleText.html(html)})},_editDateHandler:function(event){this._renderDatePicker(event,"date",{viewType:this.model.get("isLongTerm")?"long":"date",rangepickerOptions:{startDate:this.model.get("startDate"),endDate:this.model.get("deadLine")},isShowCycleView:false,leftBias:-150})},_editDateMouseupHandler:function(event){event.stopPropagation()},_renderDatePicker:function(event,type,options){var self=this;var node=Talent.$(event.currentTarget);this._editeActiveHandler(node,"addActive");this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView(options);var selfUserName=Talent.Context.getUserInfo().Name;var principalUserName=this.model.get("principalUser").name;this.listenTo(this.dateTimePickerView,"sure",function(dateNode,data){if(type=="date"){if(selfUserName==principalUserName){this._applyWarn(node,2,"修改任务信息，会给审批人发送审批申请哦~").done(function(){self._requestUpdateDate(data)})}else{self._requestUpdateDate(data)}}if(type=="cycle"){if(selfUserName==principalUserName){this._applyWarn(node,2,"修改任务信息，会给审批人发送审批申请哦~").done(function(){self._requestUpdateCycle(data)})}else{self._requestUpdateCycle(data)}}this._editeActiveHandler(node)},this);this.listenTo(this.dateTimePickerView,"cancel",function(sureNode,data){this._editeActiveHandler(node)});this.$el.append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.$el,pos:"bottom",leftBias:options.leftBias})},_editeActiveHandler:function(node,type){if(type&&type=="addActive"){node.addClass("edit-able_active")}else{node.removeClass("edit-able_active")}},_requestUpdateDate:function(data){var self=this;TaskCollection.updateTaskDate({task_id:this.id,Deadline:data["endDate"],StartDate:data["startDate"],IsLongTerm:data["isLongTerm"]}).done(function(resp){if(self.isClose)return;self.model.set(resp);self.render();util.sendMessageBySDK("taskInfo",{id:self.id,model:resp})}).fail(function(msg){if(self.isClose)return;if(self.model.get("applyUser")&&!self.model.get("isApply")){self.model.set("isApply",true);util.sendMessageBySDK("taskInfo",{id:self.id,model:{isApply:true}});return}self._showTipDialog(self.ui.setTaskDate,{placement:"bottom",type:"remind",body:msg,align:"left",container:self.$el,ico:"warn"})})},_renderAttachmentView:function(){var self=this;var template=['<a href="javascript:void(0);" title="" data-name="file" class="upload_node <%if(!openYFY){%>upload_new_file<%}%>">点击添加</a>',"<%if(openYFY){%>",'<div class="tt_upload_type_container" data-name="upload-type">','<dl class="upload_type_item"><span class="upload_new_file">本地上传</span></dl>','<dl class="upload_type_item"><span id="fc_upload" class="fang_cloud_btn">亿方云</span></dl>',"</div>","<%}%>"].join("");var UploaderView=UploaderComponentView.extend({template:Talent._.template(template)});var openYFY=Context.IsOpenYifangyun();this.titaUploadBtn=new UploaderView({container:this.$el,openYFY:openYFY,showPreview:false});this.listenTo(this.titaUploadBtn,"uploadEnd",function(allObj,newObj){this._requestAddAttachment(newObj.dfs,allObj.YFYresp)},this);this.listenTo(this.titaUploadBtn,"FormViewRender",function(){if(!this.attachmentListView){this.titaUploadBtn.fileCollection.reset(this._dealAttachmentData(this.model.get("attachments"))||[]);this.fileCollection=this.titaUploadBtn.fileCollection;this._renderAttachmentList()}},this);this.titaUploadBtn.render()},_dealAttachmentData:function(data){var self=this;if(data.length){_.each(data,function(item){item.uploadStatus=3;item.verifyStatus=true;item.fromStore=true;item.isImage=false;item.name=item.fileName;item.isFromYFY=item.documentSource==3?true:false;var type=item.fileType.toLowerCase();if(/^(jpg|png|gif|jpeg)$/.test(type)){item.fileType=type;!item.isFromYFY&&(item.isImage=true);item.ClientUrl=item.downloadUrl}else{if(/^(exe|pdf|txt|doc|docx|ppt|pptx|xls|xlsx)$/.test(type)){item.fileType=type}else if(/^(rar|zip)$/.test(type)){item.fileType=type}else if(/^(mp3|wma|wav|flac|ape|ogg|aac|m4a)$/.test(type)){item.fileType=type}else if(/^(mp4|mkv|rm|rmvb|avi|3gp|flv|wmv|asf|mpeg|mpg|mov|ts|m4v)$/.test(type)){item.fileType=type}else{item.fileType="none"}}})}return data},_requestAddAttachment:function(dfs_data,yfy_data){var self=this;TaskCollection.addAttachment({objId:this.model.get("taskId"),dfsUrls:dfs_data.join(","),documents:yfy_data}).done(function(data){if(self.isClose)return;var model=self.titaUploadBtn.fileCollection.findWhere({DfsPath:dfs_data[0]});model.set(Talent._.extend({},model.toJSON(),data[0]));self.fileCollection=self.titaUploadBtn.fileCollection}).fail(function(data){})},_updataAttachmentListViewDocumentID:function(data){var self=self;_.each(data,function(item){if(item.documentSource==1){var lastIdx=item.fileName.lastIndexOf("."),fileType=item.fileName.substring(lastIdx+1),dfsFileName=Context.parseUrl(item.downloadUrl).path+"."+fileType;var findModel=self.titaUploadBtn.fileCollection.findWhere({dfsFileName:dfsFileName});if(findModel){findModel.set("documentId",item.documentId);self.fileCollection=self.titaUploadBtn.fileCollection}}})},_requestDeleteAttachment:function(id){var self=this;TaskCollection.deleteAttachment({task_id:this.id,document_id:id}).done(function(data){if(self.isClose)return;self.model.set("attachments",self.attachmentListView.collection.toJSON())})},_renderAttachmentList:function(){this.attachmentListView&&this.attachmentListView.close();this.attachmentListView=new AttachmentListView({collection:this.fileCollection});this.listenTo(this.attachmentListView,"deleted",function(id){this._requestDeleteAttachment(id)});this.ui.attachemntList.html(this.attachmentListView.render().el)},_changeFZR:function(ev){var self=this;var node=Talent.$(ev.currentTarget);ev.stopPropagation();this._editeActiveHandler(node,"addActive");this.closeUserSelect();this.FZR_userSelectorView=new UserSelector({collection:new UserSelectorCollection});var options=util.userSelectorConfig({input:true,muti:false,container:this.$el});this.FZR_userSelectorView.showDialog(options,node);node.off("submit");node.on("submit",function(ev,user){var data={name:user["Name"],type:0,avatar:user["UserAvatar"],userId:user["Id"]};var principalUser=self.model.get("principalUser");if(principalUser["userId"]==data["userId"]){self._showTipDialog(node,{placement:"bottom",type:"remind",body:"不能转交给当前负责人",align:"left",container:self.$el,ico:"warn"});return}self._showTipDialog(node,{placement:"bottom",type:"confirm",body:"此"+self.iTask+"转交给"+user["Name"]+"负责？",align:"left",container:node.parent(),okHide:function(){self._requestFZR(node,data)}});self._editeActiveHandler(node)});this.FZR_userSelectorView.off("close cancel");this.FZR_userSelectorView.on("close cancel",function(){self._editeActiveHandler(node)})},_requestFZR:function(node,user){var self=this;TaskCollection.updateTaskPrincipalUser({task_id:this.id,to_user_id:user["userId"]}).done(function(resp){if(self.isClose)return;self.model.set("principalUser",user);util.sendMessageBySDK("taskInfo",{id:self.id,model:{principalUser:user}});self.trigger("changFZR",self.ui.taskTransferUser)}).fail(function(msg){if(self.isClose)return;self.ui.taskTransferUser.show();self._showTipDialog(node,{placement:"bottom",type:"remind",body:msg,align:"left",container:self.$el,ico:"warn"})})},_changeSPR:function(ev){var node=Talent.$(ev.currentTarget);this.closeUserSelect();ev.stopPropagation();var defaults=util.userSelectorConfig({input:true,muti:false,container:this.$el});this._editeActiveHandler(node,"addActive");var text="您确定修改审批人？",appUser=this.model.get("applyUser"),self=this;if(appUser&&appUser["userId"]){text="您确定添加审批人？"}this.SPR_userSelectorView=new UserSelector({collection:new UserSelectorCollection});this.SPR_userSelectorView.showDialog(defaults,node);node.off("submit");node.on("submit",function(ev,user){var data={};data["userId"]=user["Id"];data["name"]=user["Name"];data["type"]=0;data["avatar"]=user["UserAvatar"];self._requestEditApplyUser(node,data);self._editeActiveHandler(node)});this.SPR_userSelectorView.off("close cancel");this.SPR_userSelectorView.on("close cancel",function(){self._editeActiveHandler(node)})},_addParnter:function(ev){var node=Talent.$(ev.currentTarget),self=this;ev.stopPropagation();this._editeActiveHandler(node,"addActive");this.closeUserSelect();this.CYZ_userSelectorView=new UserSelector({collection:new UserSelectorCollection});this.listenTo(this.CYZ_userSelectorView,"more",function(){node.show()});var options=util.userSelectorConfig({input:true,muti:true,container:this.$el});this.CYZ_userSelectorView.showDialog(options,node);node.off("submit");node.on("submit",function(ev,user){self._requestAddMember(user);self._editeActiveHandler(node)});this.CYZ_userSelectorView.off("close cancel");this.CYZ_userSelectorView.on("close cancel",function(){self._editeActiveHandler(node)})},_requestAddMember:function(user){var self=this;var userList=[];if(user.data){userList=user.data}else{userList.push(user)}var userData=this.model.get("participators");var userListData=this._formatSelectUserData(userList);TaskCollection.taskAddParticipator({task_id:this.id,users:userListData}).done(function(resp){if(self.isClosed)return;if(self.addMemberHasSelf){self.trigger("addPartner",{users:userListData,changeLimit:true});return}Talent._.map(resp,function(item){userData.push({userId:item["userId"],name:item["name"],avatar:item["avatar"]})});self.model.set("participators",userData);self.trigger("addPartner",{users:userListData,changeLimit:false});self.render()}).fail(function(msg){if(self.isClosed)return;self._showTipDialog(self.ui.taskAddPartner.parents("[data-name=partner]"),{placement:"bottom",type:"remind",body:msg,align:"left",container:self.$el,ico:"warn"})})},_formatSelectUserData:function(addUserData){var userListData=[],self=this;Talent._.each(addUserData,function(item){if(item.type=="department"){userListData.push({Email:item.name+":"+item.id+":dep_members",Name:item.name,Id:item.id});if(item.id==self.userInfo.Id){self.addMemberHasSelf=true}}else{userListData.push({Email:item.Email,Name:item.Name,Id:item.Id});if(item.id==self.userInfo.Id){self.addMemberHasSelf=true}}});return userListData},_deleteParticipator:function(events){events.stopPropagation();var self=this;var node=Talent.$(events.currentTarget),id=node.attr("id");this._requestDeleteParnter(node,id)},_requestDeleteParnter:function(node,id){var self=this;TaskCollection.taskDeleteParticipator({task_id:this.id,to_user_id:id}).done(function(){if(self.isClosed)return;var users=self.model.get("participators");var paticipators=Talent._.filter(users,function(item){return item["userId"]!=id});self.model.set("participators",paticipators);if(id==self.userInfo["Id"]){self.trigger("permissionChange")}}).fail(function(msg){if(self.isClosed)return;self._showTipDialog(self.ui.taskAddPartnerDelete,{placement:"bottom",type:"remind",body:msg,align:"left",container:self.$el,ico:"warn"})})},_bindKlassNotice:function(){var labFullName=this.model.get("labFullName"),self=this;this.ui.updateKclassLabel.tipsy({gravity:"s",html:true,title:function(){var labFullName=self.model.get("labFullName");return labFullName?'<div class="class_tip_content">'+self.model.get("labFullName")+"</div>":""}})},_toggle:function(){var node=this.ui.toggle,icon=node.find(".icon"),txt=node.find(".txt"),isPackUp=this.model.get("isPackUp");if(!isPackUp){txt.text("收起");icon.removeClass("tu-icon-arrow-down").addClass("tu-icon-arrow-up");this.ui.allInfo.show();this.model.set("isPackUp",true)}else{txt.text("展开详情");icon.removeClass("tu-icon-arrow-up").addClass("tu-icon-arrow-down");this.ui.allInfo.hide();this.model.set("isPackUp",false)}},_cancleCycleTask:function(events){var self=this;var node=Talent.$(events.currentTarget);this._editeActiveHandler(node,"addActive");this._showTipDialog(node,{placement:"bottom",type:"confirm",body:"您确定要取消此循环吗？此操作将不可恢复",align:"right",container:this.$el,okHide:function(){TaskCollection.cancelCycle({cycle_id:self.model.get("cycleId"),task_id:self.id}).done(function(){self.model.set("cycleId",0);self.model.unset("cycleInfo")})}},"clecycleView");this.listenTo(this.clecycleView,"hide",function(){self._editeActiveHandler(node)})},_stopMouseUp:function(events){events.stopPropagation()},_changeTaskClass:function(events){events.stopPropagation();var self=this;var node=Talent.$(events.currentTarget);var modelData=this.model.toJSON();this._editeActiveHandler(node,"addActive");if(modelData.labelId){var classResultData={id:modelData.labelId,name:modelData.labelName,tabType:modelData.labelType};this.settings.classDialogOptions.resultData=[classResultData]}var options=this.settings.classDialogOptions;this.classComponentView&&this.classComponentView.close();this.classComponentView=new ClassComponentView(options);this.listenTo(this.classComponentView,"submit",function(data){if(!data||data["id"]==0||!data["id"]){return}var selfUserName=Talent.Context.getUserInfo().Name;var principalUserName=this.model.get("principalUser").name;if(selfUserName==principalUserName){self._applyWarn(node,3,"修改任务信息，会给审批人发送审批申请哦~").done(function(){self.settings.classDialogOptions.resultData=[data];self._requestTaskClass(data);self._editeActiveHandler(node)})}else{self.settings.classDialogOptions.resultData=[data];self._requestTaskClass(data);self._editeActiveHandler(node)}});this.listenTo(this.classComponentView,"new",function(options){Talent.app.request("Lable:postAddLableData",{obj_id:this.userInfo["Id"],obj_type:"1",name:options["name"],parent_id:options["parent_id"]}).done(function(resp){options["call"](resp);self._editeActiveHandler(node)})});this.listenTo(this.classComponentView,"reset",function(){var data={tabType:0,id:"",name:"未分类"};this.settings.classDialogOptions.resultData=[];this._requestTaskClass(data);this._editeActiveHandler(node)});this.listenTo(this.classComponentView,"cancel",function(){this._editeActiveHandler(node)});this.ui.classArea.html(this.classComponentView.render().el);this.classComponentView.show(node,{container:this.ui.classContainer,pos:"bottomLeft"})},_requestTaskClass:function(data){var self=this;TaskCollection.updateLable({task_id:this.settings["id"],lab_id:data["id"],lab_type:data["tabType"]}).done(function(resp){if(self.isClose)return;self.model.set({labelType:data["tabType"],labelId:data["id"],labelName:data["name"]})}).fail(function(resp){if(self.isClose)return})},_requestEditApplyUser:function(node,user){var self=this;TaskCollection.updateApplyUser({task_id:this.id,to_user_id:user["userId"]}).done(function(resp){if(self.isClose)return;var applyUser=self.model.get("applyUser");self.model.set({applyUser:user.userId?user:null})}).fail(function(msg){if(self.isClose)return;var applyUser=self.model.get("applyUser");if(!applyUser||!applyUser["userId"]){}self._showTipDialog(node,{placement:"bottom",type:"remind",body:msg,align:"right",container:node.parent(),bias:{left:0,top:10},ico:"warn"})})},_deleteApprover:function(events){events.stopPropagation();var self=this;var node=Talent.$(events.currentTarget),text="您确定删除审批人？";var tipinfo=TipInfoView(node,{placement:"bottom",type:"confirm",body:text,align:"right",container:this.$el,okHide:function(){tipinfo.hide();self._requestEditApplyUser(node,{userId:0})}})},_getRemainTime:function(endDate){var now=new Date,deadLine=new Date(endDate),fromNow=Number(deadLine)-Number(now),oneDay=1e3*60*60*24,total=Math.floor(fromNow/oneDay),last=fromNow-oneDay*total,todayLast=now-new Date(now.getFullYear(),now.getMonth(),now.getDate());if(last>todayLast)total+=1;total+=1;return total},_formateCyCleHtml:function(){var html="";var data=this.model.get("cycleInfo");var CycType=data.CycType;if(CycType==1){html+="每天 "+data.CycStartTime+" —— "+data.CycEndTime}else if(CycType==2){html+="每个工作日 "+data.CycStartTime+" —— "+data.CycEndTime}else if(CycType==3){html+="每周 "+this._getWeek(data.CycStartDate)+" "+data.CycStartTime+" —— "+this._getWeek(data.CycEndDate)+" "+data.CycEndTime}else if(CycType==4){html+="每月"+data.CycStartDate+"日 "+data.CycStartTime+"  —— "+data.CycEndDate+"日 "+data.CycEndTime}return html},_getWeek:function(index){var weeks=["","周一","周二","周三","周四","周五","周六","周日"];return weeks[index]},_showTipDialog:function(node,data,view){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",animation:false,type:"default",body:"",trigger:"manual",hasfoot:true,align:"left",html:true,container:this.$el};view=view?view:"infoTipView";var options=Talent._.extend({},defaults,data);this[view]=new Infotip;this[view].bindNode(node,options);this[view].show()},_applyWarn:function(node,applyType,remindMsg){var self=this;var deferred=new Talent.$.Deferred;if(!this.model.get("applyUser")){deferred.resolve()}TaskCollection.applyWarn({task_id:this.id,apply_type:applyType}).done(function(resp){if(resp.Obj==0){deferred.resolve()}if(resp.Obj==1){self._showTipDialog(node,{placement:"bottom",type:"confirm",body:remindMsg,align:"left",container:self.$el,ico:"warn",okHide:function(){deferred.resolve();self.infoTipView.hide()}})}if(resp.Obj==2){if(self.model.get("applyUser")&&!self.model.get("isApply")){self.model.set("isApply",true)}self._showTipDialog(node,{placement:"bottom",type:"remind",body:"审批中，暂不可操作",align:"left",container:self.$el,ico:"warn"})}});return deferred},onClose:function(){this.isClose=true;this.titaUploadBtn&&this.titaUploadBtn.close();this.classComponentView&&this.classComponentView.close();this.FZR_userSelectorView&&this.FZR_userSelectorView.close();this.SPR_userSelectorView&&this.SPR_userSelectorView.close();this.CYZ_userSelectorView&&this.CYZ_userSelectorView.close();this.cycleTaskView&&this.cycleTaskView.close()}});var TaskDetailTrackView=Talent.Layout.extend({defaults:{id:""},tagName:"div",template:jst["task-detail/task-track"],regions:{trakList:"div[data-name=task-detail-task-track]"},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options)},events:function(){var events={};return events},onShow:function(){this._renderTrackListView()},_renderTrackListView:function(){if(this.feedTrackView)return;var self=this;var data=this.model.get("feedOperations");this.feedTrackView=new FeedTrackView({model:this.model,defaultCount:5});this.listenTo(this.feedTrackView,"showAll",function(){CommentV2.getCommentGet({feed_id:self.settings.id,comment_type:1}).done(function(resp){if(self.isClosed)return;self.feedTrackView.model.set("comments",resp.comments)})});this.trakList.show(this.feedTrackView)},onClose:function(){}});var TaskDetailShareListItemView=Talent.ItemView.extend({tagName:"li",className:"task_item clearfix",template:jst["task-detail/task-share-list-item"],ui:{shareDelete:'[data-name="share-delete"]',attachment:"div[data-name=task-detail-share-attachment]",time:"[data-name=task-detail-share-time]"},templateHelpers:function(){var dateText=this._formatDate();var index=this.model.get("index");var isLast=this.model.get("isLast");var iconClass="tu-icon-tag";if(index==0){iconClass="first tu-icon-coordinate"}return{dateText:dateText,timestamp:this.timestamp,iconClass:iconClass}},initialize:function(options){var self=this;this.timestamp=(new Date).getTime()+"_"+parseInt(Math.random()*1e3+1)},events:function(){var events={};events["click "+this.ui.shareDelete]="_checkShare";events["mouseup "+this.ui.cont]="_stopMouseupHandler";events["click "+this.ui.time]="_showTimePicker";return events},modelEvents:{"change:startDate":"render","change:endDate":"render","change:code":"render"},onRender:function(){var self=this;this._renderAttachmentList()},_stopMouseupHandler:function(event){event.stopPropagation()},_formatDate:function(){var startDate=this.model.get("startDate"),endDate=this.model.get("endDate");startDate=Context.formatDate(startDate);endDate=Context.formatDate(endDate);var dateText=startDate;if(startDate!=endDate){dateText=startDate+"-"+endDate}return dateText},_showTimePicker:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),id=node.attr("id");startDate=this.model.get("startDate"),endDate=this.model.get("endDate");this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView({isShowTab:false,rangepickerOptions:{timePicker:false,startDate:moment(startDate,"YYYY/MM/DD"),endDate:moment(endDate,"YYYY/MM/DD"),format:"YYYY/MM/DD"}});this.listenTo(this.dateTimePickerView,"sure",function(node,options){this.model.set("startDate",options["startDate"]);this.model.set("endDate",options["endDate"]);this._requestEditData(id,options)},this);this.dateTimePickerView.render();this.$el.append(this.dateTimePickerView.el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.$el,pos:"bottomLeft"})},_requestEditData:function(id,options){ExperienceCollection.editShareDate({experience_id:id,startDate:options["startDate"],endDate:options["endDate"]}).done(function(){})},_renderAttachmentList:function(){this.attachmentCollection=new Talent.Collection(this.model.get("attachments")||[]);this.attachmentListView&&this.attachmentListView.close();this.attachmentListView=new AttachmentListView({collection:this.attachmentCollection,isShowDeleted:false});this.$el.append(this.attachmentListView.render().$el)},onClose:function(){Talent.$(document).off("click.Task-Share-List-Item-Share-View")}});var TaskDetailShareListView=Talent.CompositeView.extend({defaults:{id:"",maxLength:5,isShowCreate:true},className:"tt_share_list_container",itemView:TaskDetailShareListItemView,itemViewContainer:"ul[data-name=task-detail-share-list]",template:jst["task-detail/task-share-list"],templateHelpers:function(){return{isShowCreate:this.settings["isShowCreate"]}},ui:{more:'[data-name="task-detail-share-more"]',moreText:'[data-name="task-detail-share-more-text"]',moreIcon:'[data-name="task-detail-share-icon"]',deleted:"[data-name=task-detail-share-delete]",newShare:"div[data-name=task-detail-share-new]",newBox:"div[data-name=task-detail-share-new-box]",listBox:"ul[data-name=task-detail-share-list]",content:"div[data-name=task-detail-share-content]",edit:'span[data-name="task-detail-share-edit"]'},events:function(){var events={};events["click "+this.ui.newShare]="_newShareHandler";events["click "+this.ui.more]="_moreToggle";events["click "+this.ui.deleted]="_deleteHandler";events["click "+this.ui.edit]="_eidtHandler";return events},itemViewOptions:function(){return{emptyContext:"需要分解具体的事吗？试试添加新的进展"}},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);this.allData=this.collection.toJSON();this.collection.model=Talent.Model.extend({idAttribute:"commentId"});this.collection.reset(this.allData.slice(0,this.settings["maxLength"]),{silent:true});this.model.set({isShowMore:this.allData.length>this.settings["maxLength"]?true:false,open:false},{silent:true});if(!this.model.get("experienceTotal")){this.model.set({experienceTotal:this.allData.length||0},{silent:true})}this.$el.on("click",function(event){event.stopPropagation()});this.childViews={}},onRender:function(){var self=this},onBeforeItemAdded:function(itemView){var id=itemView.model.get("commentId");this.childViews[id]=itemView},_eidtHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget),id=node.attr("id"),model=this.collection.get(id),self=this,richEditorContainerId,richEditorContainer;var nodeName="[data-node-name=task-detail-share-content-"+id+"]";this.itemEl=this.$el.find(nodeName);this.richBox=this.itemEl.next();richEditorContainer=this.richBox.find("[data-name=task-detail-share-rich]");if(richEditorContainer.length){richEditorContainerId=richEditorContainer.attr("id")}if(richEditorContainerId==null)return;this.itemId=id;this.richEditor&&this.richEditor.close();this.richEditor=new NewRichEditor({containerId:richEditorContainerId,maxWords:5e3,hasBtns:true,placeholder:"请输入进展"});this.listenTo(this.richEditor,"editorSubmit",function(inputData){if(!inputData.textOnly){TipInfoView(this.richEditor.editor.$okBtn,{placement:"top",type:"remind",ico:"warn",body:"进展不能为空",align:"right",container:this.$el});return}var model=this.collection.get(this.itemId);model.set("content",inputData.html);this.itemEl.show();this.itemEl.html(model.get("content"));this.richEditor.close();this._requestEditContentShare(model)});this.listenTo(this.richEditor,"editorConcel",function(inputData){this.richEditor.close();this.itemEl.show()});this.richEditor.show();this.richEditor.fillContent(model.get("content"));this.richEditor.focus();this.itemEl.hide()},_requestEditContentShare:function(model){var self=this;ExperienceCollection.editShareContent({experience_id:this.itemId,content:model.get("content")}).done(function(resp){if(self.isClosed)return}).fail(function(){})},_deleteHandler:function(event){event.stopPropagation();var node=Talent.$(event.currentTarget);this.id=node.attr("id");var self=this;var tipInfo=TipInfoView(node,{placement:"top",type:"confirm",body:"此操作不可恢复，您确定删除吗？",align:"right",container:node.parent(),okHide:function(){self._requestDeleted();tipInfo.hide()}})},_requestDeleted:function(){var self=this;ExperienceCollection.deleteShare({obj_id:this.settings["id"],experience_id:this.id}).done(function(resp){if(self.isClosed)return;var model=self.collection.get(self.id);self.collection.remove(model);self.model.set("experienceTotal",self.model.get("experienceTotal")-1)})},_moreToggle:function(ev){var open=this.model.get("open"),iconNode=this.ui.moreIcon,moreText=this.ui.moreText;var self=this;iconNode.removeClass("tu-icon-arrow-down tu-icon-arrow-up");if(!open){moreText.text("收起");iconNode.addClass("tu-icon-arrow-up");this.collection.reset(this.allData)}else{moreText.text("展开");iconNode.addClass("tu-icon-arrow-down");var data=this.allData.slice(0,this.settings["maxLength"]);this.collection.reset(this.allData.slice(0,5))}this.model.set({open:!open})},_newShareHandler:function(ev){var self=this;if(!this.taskCreateView){this.taskCreateView=new TaskCreateView({id:this.settings.id+"_task-share",templateName:"dateRichEditor",requestSubmit:function(formatData,data){var deferred=new Talent.$.Deferred;ExperienceCollection.addShare({ObjId:self.settings.id,Content:formatData["Description"],FileUrls:formatData["FileUrls"],StartDate:data["startDate"],EndDate:data["endDate"],DocumentModels:formatData["documents"]}).done(function(resp){console.log(resp);if(self.isClosed)return;var collectionData=self.collection.toJSON();collectionData.unshift(resp);var collectionLen=collectionData.length;collectionData.forEach(function(item,index){item.index=index;item.isLast=collectionLen==index+1});self.collection.reset(collectionData);self.model.set("experienceTotal",self.model.get("experienceTotal")+1);self.ui.newShare.show();self.ui.newBox.hide();self.trigger("add");deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},dataTimeRangeOptions:{isShowDateView:true,isShowCycleView:false,isShowLongView:false,count:2,timePicker:false,rangepickerOptions:{format:"YYYY/MM/DD",timePicker:false}},richEditorOptions:{defaultText:"请输入进展",maxWords:5e3}});this.ui.newBox.html(this.taskCreateView.render().$el);this.taskCreateView.onShow()}this.ui.newShare.hide();this.ui.newBox.show();this.taskCreateView.ui.richEditorDefaultLabel.trigger("click")},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.children.add(view);view.render();if(!this.$el.find(this.itemViewContainer).find("li:first").length){this.$el.find(this.itemViewContainer).append(view.el)}else{this.$el.find(this.itemViewContainer).find("li:first").before(view.el)}if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)},onClose:function(){Talent.$(document).off("mouseup.Task-Share-List-Share-View");this.$el.off("mouseup.Task-Share-List-Share-View")}});var TaskDetailShareView=Talent.Layout.extend({defaults:{id:"",isShowCreate:true},template:jst["task-detail/task-share-detail"],className:"task-detail-share",regions:{taskShareList:'div[data-name="task-detail-share-list"]'},ui:{total:"span[data-name=task-detail-share-total]"},modelEvents:{"change:experienceTotal":"_totalChangeHandler"},_totalChangeHandler:function(){this.ui.total.html(this.model.get("experienceTotal"));this.trigger("countChange","experienceTotal",this.model.get("experienceTotal"))},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);this.model.set("experienceTotal",this.collection.length);if(!this.model.get("isEditAdd")){this.model.get("isEditAdd",false)}},events:function(){var events={};return events},onRender:function(){var self=this},onShow:function(){this._renderTaskShareList()},triggerIn:function(){if(this.taskDetailShareListView){this.taskDetailShareListView.ui.newShare.trigger("click")}},_renderTaskShareList:function(){var self=this;var emptyView=EmptyView.extend({defaults:{emptyContext:"需要分解具体的事吗？试试添加新的进展"}});var collectionLen=this.collection.length;this.collection.each(function(item,index){item.set({index:index,isLast:collectionLen==index+1})});this.taskDetailShareListView=new TaskDetailShareListView({collection:this.collection,id:this.settings["id"],isShowCreate:this.settings["isShowCreate"],emptyView:emptyView});this.taskDetailShareListView.model.on("change:experienceTotal",function(){var total=self.taskDetailShareListView.model.get("experienceTotal");self.model.set("experienceTotal",total)});this.taskShareList.show(this.taskDetailShareListView)}});var TaskDetailCommentView=Talent.Layout.extend({defaults:{id:"",feedType:"",isExternal:false,labelType:0,labelId:0,labelName:""},tagName:"div",template:jst["task-detail/task-feed"],regions:{feedList:"div[data-name=task-detail-task-feed]"},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.userInfo=Context.getUserInfo()},events:function(){var events={};return events},onShow:function(){this._renderCommentView()},_renderCommentView:function(){var self=this;var options={model:this.model,onlyComment:true,isInAppPage:false,mBlogOptions:{defaultValue:"",defaultHide:false,isShowSendSms:true},custom:{more:true,remind:true,collect:true,reply:true},actionMore:{detail:true,deleted:true,setTop:true},isPrivate:false,privateTipText:"",feedType:this.settings.feedType,feedId:this.settings.id,defaultCount:5};var isExternal=this.settings.isExternal;if(this.userInfo.UserType===2&&isExternal){options["mBlogOptions"]=Talent._.extend(options.mBlogOptions,{isShowAt:false})}var feedCommentListView=new FeedItemView(options);this.listenTo(feedCommentListView,"reply",function(length){this.trigger("countChange","commentTotal",length)});this.listenTo(feedCommentListView,"deleted",function(length){this.trigger("countChange","commentTotal",length)});this.feedList.show(feedCommentListView)},onClose:function(){}});var TaskDetailQuickView=Talent.ItemView.extend({template:jst["task-detail/task-quick"],initialize:function(){this.i18n=Context.getI18n();this.map=[{key:"task-apply",name:"审批",icon:"apply",ui:"applyBox",isShow:this.model.get("applys")},{key:"task-list",name:this.i18n["task_1"],icon:"task",ui:"task",isShow:this.model.get("tasks")},{key:"task-work-hour",name:"工时",icon:"hour",ui:"workHour",isShow:this.model.get("workTimes")},{key:"task-meet",name:"会议",icon:"meet",ui:"taskMeet",isShow:this.model.get("meets")},{key:"task-travel",name:"出差",icon:"travel",ui:"taskTravel",isShow:this.model.get("businessTrips")},{key:"task-share",name:"进展",icon:"share",ui:"share",isShow:this.model.get("experience")}]},className:"task-quick-do-titaw",ui:{li:"li",quickDoAll:'div[data-name="task-quick-all"]',quickList:'ul[data-name="task-quick-list"]'
},events:function(){var events={};events["click "+this.ui.quickDoAll]="_changeQuickDo";events["click "+this.ui.li]="_clickRadiusDiv";return events},templateHelpers:function(){var isShow=Talent._.where(this.map,{isShow:true});return{quickList:this.map,isShowAll:isShow.length?true:false}},onRender:function(){this.$el.find("[data-body]").infotip({container:this.$el,placement:"left",width:50})},_clickRadiusDiv:function(ev){var node=Talent.$(ev.currentTarget);var key=node.attr("data-key");var data=Talent._.findWhere(this.map,{key:key});this.trigger("areaPostion",node,data)},_changeQuickDo:function(events){Talent.$(".tipsy").hide();var node=Talent.$(events.currentTarget);if(this.ui.quickDoAll.hasClass("ico-all-active")){this.ui.quickDoAll.removeClass("ico-all-active").attr({"original-title":"收起"});this.ui.quickList.css({visibility:"visible"})}else{this.ui.quickDoAll.addClass("ico-all-active").attr({"original-title":"展开"});this.ui.quickList.css({visibility:"hidden"})}}});var TaskTaskDetailView=Talent.Layout.extend({template:jst["task-detail/task-task-detail"],defaults:{id:"",isShowCreate:false},templateHelpers:function(){return{iTask:this.i18n["task_1"],total:this.collection.length||0,isShowMore:this.collection.length<6?false:true,isShowDetialScroll:this.settings.isShowDetialScroll}},collectionEvents:{reset:"_onChangeTotal",add:"_onChangeTotal",remove:"_onChangeTotal"},regions:{addArea:'[data-name="task-detail-task-add"]',listArea:'[data-name="task-detail-task-list"]'},ui:{total:"span[data-name=task-detail-task-total]",more:"[data-name=task-detail-task-more]",moreText:"[data-name=task-detail-task-more-text]",moreIco:"[data-name=task-detail-task-icon]"},events:function(){var events={};events["click "+this.ui.more]="_showMoreHandler";return events},_onChangeTotal:function(){var total=this.collection.length;this.ui.total.html(total);this.model.set("tasks",this.collection.toJSON(),{silent:true});this.trigger("countChange","taskTotal",total)},initialize:function(options){var self=this;this.i18n=Talent.Context.getI18n();this.settings=Talent._.extend({},this.defaults,options);this.isShowMore=false;this.allData=this.collection.toJSON()},onShow:function(){var self=this;if(this.settings["isShowCreate"]){this._renderCreateView()}this._renderTaskList()},triggerIn:function(){if(this.taskListView){this.$el.find("[data-name=task-create-name]").trigger("focus")}},_showMoreHandler:function(ev){ev.stopPropagation();this.allData=this.collection.toJSON();if(!this.isShowMore){this.taskListView.collection.reset(this.allData);this.ui.moreText.html("收起");this.ui.moreIco.removeClass("tu-icon-arrow-down").addClass("tu-icon-arrow-up");this.isShowMore=true}else{var sliceData=this.allData.slice(0,5);this.taskListView.collection.reset(sliceData);this.ui.moreText.html("展开");this.ui.moreIco.removeClass("tu-icon-arrow-up").addClass("tu-icon-arrow-down");this.isShowMore=false}},_renderCreateView:function(){var labelType=this.model.get("labelType");var isPrivate=this.model.get("isPrivate");var departmentId=this.model.get("departmentId");var privateValue=isPrivate?2:1;if(departmentId&&isPrivate){privateValue=3}if(labelType==4&&!this.model.get("isPrivate")){privateValue=1}var self=this;var options={shape:"line",id:this.settings["id"]+"_task-task",hourDateOptions:false,extendPersonOptions:false,participatorOptions:{showBorderLeft:false},nameOptions:{showBorderLeft:false},classOptions:false,bottomOptions:{isShowPrivateDropDown:labelType==17||labelType==0?true:false},privateRangeOptions:{privateValue:privateValue},dataTimeRangeOptions:{rangepickerOptions:{startDate:moment().format("YYYY/MM/DD 08:00"),endDate:moment().format("YYYY/MM/DD 18:00")}}};options["requestSubmit"]=Talent._.bind(this._addTask,this);var nowTime=moment().format("YYYY/MM/DD HH:mm"),startDate=this.model.get("startDate")||moment().format("YYYY/MM/DD 08:00"),deadLine=this.model.get("deadLine")||moment().format("YYYY/MM/DD 18:00"),isLongTerm=this.model.get("isLongTerm");this.createTaskView=new TaskCreateView(options);this.listenTo(this.createTaskView,"selectDate",function(node,options){if(options.startDate<this.model.get("startDate")||options.endDate>this.model.get("deadLine")){var infoTipView=new Infotip;infoTipView.bindNode(node,{placement:"top",type:"remind",body:"超出了母任务时间",trigger:"manual",align:"right",container:this.createTaskView.$el,ico:"warn"});infoTipView.show()}});this.addArea.show(this.createTaskView)},_addTask:function(options){options["parentTaskId"]=this.settings["id"];var self=this;var deferred=new Talent.$.Deferred;var app=this.model.get("app");options["LabId"]=this.model.get("labelId");options["LabType"]=this.model.get("labelType");options["DepartmentId"]=this.model.get("departmentId");if(app){options["AppId"]=app.appId;options["AppType"]=app.appType}TaskCollection.addTask(options).done(function(resp){if(self.isClosed)return;resp.tasks=[];resp.level=self.model.get("level")+1;self.collection.unshift(resp);self.taskListView.collection.unshift(resp);var collection=self.model.get("collection");if(collection){resp.collection=new Talent.Collection;collection.add(resp,{silent:true})}self.model.set("tasks",self.collection.toJSON());deferred.resolve(resp)}).fail(function(message){deferred.reject(message)});return deferred.promise()},_renderTaskList:function(){var self=this,isLongTerm=this.model.get("isLongTerm");this.taskListView=new TaskListView({model:this.model,data:this.allData.slice(0,5),isShowSetRemind:false,isShowDelete:true,isShowStar:true,isShowKclass:false,isShowOwnerTag:true,pageSize:5});var collection=this.model.get("collection");if(collection&&collection.length){collection.on("change",function(model){self.taskListView.collection.get(model.get("taskId")).set(model.toJSON())})}this.listenTo(this.taskListView,"deleted",function(node,model){var aModel=this.collection.get(model.get("id"));this.collection.remove(aModel);self.model.set("tasks",self.collection.toJSON())});this.listenTo(this.taskListView,"modelChange",function(model){var aModel=this.collection.get(model.get("id"));aModel.set(model.toJSON());self.model.set("tasks",self.collection.toJSON())});this.listArea.show(this.taskListView)}});var TaskApplyDetailView=Talent.Layout.extend({template:jst["task-detail/task-apply-detail"],defaults:{id:"",isShowAllButton:false},templateHelpers:function(){return{total:this.collection.length||0}},collectionEvents:{reset:"_onChangeTotal",add:"_onChangeTotal",remove:"_onChangeTotal"},regions:{listArea:'[data-name="task-detail-apply-list"]'},ui:{total:"span[data-name=task-detail-apply-total]"},_onChangeTotal:function(){var total=this.collection.length;this.ui.total.html(total)},initialize:function(options){var self=this;this.i18n=Talent.Context.getI18n();this.settings=Talent._.extend({},this.defaults,options)},onShow:function(){var self=this;this._renderList()},_renderList:function(){var self=this,isLongTerm=this.model.get("isLongTerm");var emptyView=EmptyView.extend({defaults:{emptyContext:"暂无任何审批"}});this.taskApplyView=new TaskApplyView({collection:this.collection,emptyView:emptyView,isShowAllButton:this.settings.isShowAllButton});this.listenTo(this.taskApplyView,"afterApplyDeal",function(){this.trigger("afterApplyDeal")});this.listArea.show(this.taskApplyView)}});var TaskAddDoView=Talent.ItemView.extend({defaults:{isShowTask:true,isShowWorkTime:true,isShowMeeting:true,isShowTravel:true,isShowShare:true},template:jst["task-detail/task-add-do"],initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.i18n=Talent.Context.getI18n()},className:"task-detial-adddo",ui:{distributeTask:'a[data-name="distribute_task"]',WorkHour:'a[data-name="task-work-hour"]',Travel:'a[data-name="task-travel"]',Meet:'a[data-name="task-meet"]',Share:'a[data-name="task-share"]'},events:function(){var events={};events["click "+this.ui.distributeTask]="_distributeTask";events["click "+this.ui.WorkHour]="_taskWorkHour";events["click "+this.ui.Travel]="_taskTravel";events["click "+this.ui.Meet]="_taskMeet";events["click "+this.ui.Share]="_taskShare";return events},templateHelpers:function(){var talentFunction=Talent.Context.getGlobal("tenant_function"),TaskAdvancedSetting=Talent.Context.getGlobal("TaskAdvancedSetting").TaskFunctionSetting,TaskWorkHour=TaskAdvancedSetting.TaskWorkHour;return{i18n:this.i18n,IsUseMeet:talentFunction["IsUseMeet"],IsUseBusinessTrip:talentFunction["IsUseBusinessTrip"],social:talentFunction["social"],isShowTask:this.settings["isShowTask"],isShowWorkTime:TaskWorkHour,isShowMeeting:this.settings["isShowMeeting"],isShowTravel:this.settings["isShowTravel"],isShowShare:this.settings["isShowShare"]}},_distributeTask:function(){var node=this.ui.distributeTask;if(node.hasClass("btn-disabled"))return;this.trigger("task")},_taskWorkHour:function(event){event.stopPropagation();this.trigger("work_hour")},_taskTravel:function(event){event.stopPropagation();this.trigger("task_travel")},_taskMeet:function(event){event.stopPropagation();this.trigger("task_meet")},_taskShare:function(event){event.stopPropagation();this.trigger("task_share")},onClose:function(){}});var TaskTravelListItemView=Talent.ItemView.extend({tagName:"li",className:"task-detail-common-list-item clearfix",template:jst["task-detail/task-travel-list-item"],ui:{listItemLeft:"[data-name=list-item-left]",toggleItemDetail:'[data-name="toggle-item-detail"]',itemDetail:'[data-name="item-detail"]',itemTitle:'[data-name="item-title"]',itemTitleEdit:'[data-name="item-edit"]',itemTitleInput:'[data-name="item-title-input"]',detailTimeRight:'[data-name="detail-time-right"]',detailTimeContainer:"[data-name=item-time-container]",detailStartDate:'[data-name="startDate"]',detailEndDate:'[data-name="endDate"]',addContactUser:'a[data-name="addContractUser"]',contractUserTitle:".contractUserTitle",contractUserTitleEdit:'[data-name="contract-edit"]',contractUserEditInput:'[data-name="contract-edit-input"]',richeditorAreaWrap:'[data-name="richeditor-area-wrap"]',richeditorContainer:'[data-name="richeditor-area"]',detailDescription:'[data-name="detail-description"]',addDescriptionBtn:'[data-name="add-description-btn"]',attachment:'[data-name="detail-attachment"]',addBtn:'[data-name="file"]',participatorArea:'[data-name="detail-participator"]'},templateHelpers:function(){return{viewType:this.settings["viewType"],startDate:Context.formatDate(this.model.get("startDate")),endDate:Context.formatDate(this.model.get("deadLine")),timestamp:this.timestamp}},initialize:function(options){this.timestamp=(new Date).getTime();this.settings=Talent._.extend({},options);var description=this.model.get("description")||"";this.model.set({code:description,open:false});this.isClose=false;this.isShowRich=false},events:function(){var events={};events["click "+this.ui.toggleItemDetail]="_onToggleDetail";events["click "+this.ui.itemTitle]="_onClickItemTitle";events["blur "+this.ui.itemTitleInput]="_onBlurItemTitleInput";events["click "+this.ui.detailTimeContainer]="_showDatePicker";events["mouseup "+this.ui.detailTimeContainer]="_mouseupDateHandler";events["click "+this.ui.addContactUser]="_focusContactUserInput";events["click "+this.ui.contractUserTitle]="_focusContactUserInput";events["blur "+this.ui.contractUserTitleEdit]="_onBlurContractUserInput";events["click "+this.ui.detailDescription]="_showRichEditor";events["click "+this.ui.addDescriptionBtn]="_showRichEditor";return events},onRender:function(){var self=this;this.$("[data-body]").infotip({placement:"top",container:this.$el});if(this.model.get("editable")){this._renderFileView();this._renderUserListView()}this._renderAttachmentsView()},_focusContactUserInput:function(ev){var self=this,node=this.$(ev.currentTarget);node.hide();this.ui.contractUserTitleEdit.show();this.ui.contractUserEditInput.focus()},_onToggleDetail:function(event){event.stopPropagation();var open=this.model.get("open");if(!open){this.model.set("open",true)}else{this.model.set("open",false)}this.render()},_requestDetailData:function(){var self=this;MeetCollection.getDetail({meet_id:this.model.get("id"),obj_id:this.settings["id"],obj_type:"7"}).done(function(resp){if(self.isClosed)return;self.model.set(resp);self.model.set({code:self.model.get("description")});self.render()}).fail(function(msg){var model=self.userListCompositeView.collection.where({Id:user.Id});self.userListCompositeView.collection.remove(model)})},_renderUserListView:function(){var self=this,users=this.model.get("participantUsers");Talent._.map(users,function(user){user.Id=user.userId;user.Name=user.name;user.UserAvatar=user.avatar});this.userListCompositeView=new AddUserCompositeView({collection:new Talent.Collection(users),addUserSelectonOptions:{muti:true,container:this.settings.container},showType:"nameOnly",title:""});this.listenTo(this.userListCompositeView,"addUser",function(user){self._requestAddUser(user)});this.listenTo(this.userListCompositeView,"deleteUser",function(user){self._requestDeleteUser(user)});this.ui.participatorArea.html(this.userListCompositeView.render().$el)},_requestAddUser:function(user){var self=this;var data=[];if(user.data){for(var i=0;i<user.data.length;i++){var item=user.data[i];data.push({Id:item.id,Name:item.name,Email:item.name+":"+item.id+":dep_members"})}}else{data.push(user)}MeetCollection.addParticipator({meet_id:this.model.get("id"),add_objects:data}).done(function(resp){if(self.isClosed)return;var resp=resp||[];var data=[];Talent._.each(resp,function(item){data.push({Name:item.name,UserAvatar:item.avatar,Avatar:item.avatar,UserId:item.userId,Id:item.userId})});self.userListCompositeView.collection.add(data);var participantUsers=self.model.get("participantUsers");Talent._.each(resp,function(item){participantUsers.push(item)});self.model.set("participantUsers",participantUsers)}).fail(function(msg){TipInfoView(self.userListCompositeView.ui.addUserBtn,{placement:"bottom",type:"remind",body:msg,align:"center",container:self.userListCompositeView.$el,ico:"warn"})})},_requestDeleteUser:function(user){var self=this;MeetCollection.deleteParticipator({meet_id:this.model.get("id"),to_user_id:user.Id}).done(function(){if(self.isClosed)return;var participantUsers=self.model.get("participantUsers");$(participantUsers).each(function(index,el){if(el.userId==user.Id){participantUsers.splice(index,1)}});self.model.set("participantUsers",participantUsers)}).fail(function(msg){var model=self.userListCompositeView.collection.where({Id:user.Id});self.userListCompositeView.collection.add(model)})},_onClickItemTitle:function(ev){if(!this.model.get("editable"))return;var node=this.$(ev.currentTarget);node.hide();this.ui.listItemLeft.toggleClass("tu-bg-hv_m4");this.ui.itemTitleEdit.show();this.ui.itemTitleInput.focus()},_mouseupDateHandler:function(ev){ev.stopPropagation()},_showDatePicker:function(ev){var self=this,node=this.$(ev.currentTarget);if(!this.model.get("editable"))return;ev.stopPropagation();this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView({viewType:"date",rangepickerOptions:{startDate:this.model.get("startDate"),endDate:this.model.get("deadLine")},isShowDateView:true,isShowCycleView:false,isShowLongView:false,isShowTab:false});this.listenTo(this.dateTimePickerView,"sure",function(node,data){this._updateTravalInfo(data).done(function(){self.model.set({startDate:data["startDate"],deadLine:data["endDate"]});self.ui.detailStartDate.html(Context.formatDate(data["startDate"]));self.ui.detailEndDate.html(Context.formatDate(data["endDate"]));self.render()}).fail(function(msg){TipInfoView(self.ui.detailStartDate,{placement:"bottom",type:"remind",body:msg,align:"center",container:self.$el,ico:"warn"});self.model.set({startDate:self.initStartDate,deadLine:self.initDeadLine})})});this.ui.detailTimeRight.append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.ui.detailTimeRight,pos:"bottom",leftBias:-200})},_showRichEditor:function(events){events.stopPropagation();var self=this;this.ui.richeditorContainer.show();this.isShowRich=true;this.ui.addDescriptionBtn.hide();this.ui.detailDescription.hide();if(!this.richEditor){this.richEditor=new NewRichEditor({containerId:"task-travel-list-item-"+this.timestamp,maxWords:5e3,hasBtns:true,placeholder:"请输入备注"});this.listenTo(this.richEditor,"editorSubmit",function(inputData){this.ui.richeditorAreaWrap.hide();this._hideRichEditor(inputData)});this.listenTo(this.richEditor,"editorConcel",function(inputData){var beforeCode=this.model.get("code");this.richEditor.fillContent(beforeCode);if(beforeCode){this.ui.detailDescription.show()}else{this.ui.addDescriptionBtn.show()}this.ui.richeditorAreaWrap.hide()});this.richEditor.show();this.richEditor.fillContent(this.model.get("code"))}else{this.ui.richeditorAreaWrap.show();this.richEditor.editor.restoreSelection()}},_hideRichEditor:function(inputData){var self=this,code=inputData.html||"",beforeCode=this.model.get("code");this.ui.detailDescription.hide();this.isShowRich=false;if(!/(<(img|table)[^>]*>)/g.test(code)){var testDes=code.toLowerCase();testDes=testDes.replace(/(<[^>]*>(<[^>]*>|&nbsp;)?(<\/[^>]*>)?)|&nbsp;/g,"");testDes=Talent.$.trim(testDes);if(testDes==""){code=""}}if(beforeCode!=code){self.model.set("code",code);self.model.set("description",code);this._updateTravalInfo().done(function(){self._changeDescription()}).fail(function(msg){})}else{self.model.set("code",code);this._changeDescription()}},_changeDescription:function(){this.ui.richeditorContainer.hide();var code=this.model.get("code");if(code=="<p><br></p>")code="";if(code){this.ui.detailDescription.html(code).show()}else{this.ui.detailDescription.html("");this.ui.addDescriptionBtn.show()}},_onBlurItemTitleInput:function(ev){var self=this,node=this.$(ev.currentTarget),val=this.ui.itemTitleInput.val();if(val!=this.model.get("title")){this.model.set("title",val);this._updateTravalInfo().done(function(){self.ui.itemTitle.text(val).show();self.ui.itemTitleEdit.hide()}).fail(function(msg){TipInfoView(node,{placement:"bottom",type:"remind",body:msg,align:"center",container:self.$el,ico:"warn"})})}else{this.ui.itemTitle.show();this.ui.itemTitleEdit.hide()}this.ui.listItemLeft.toggleClass("tu-bg-hv_m4")},_onBlurContractUserInput:function(ev){var self=this,node=Talent.$(ev.currentTarget),val=this.ui.contractUserEditInput.val();if(val!=this.model.get("contractUser")){self.model.set("contractUser",val);this._updateTravalInfo().done(function(){self.ui.contractUserTitle.html(val).show();self.ui.contractUserTitleEdit.hide()}).fail(function(msg){TipInfoView(node,{placement:"bottom",type:"remind",body:msg,align:"center",container:self.$el,ico:"warn"})})}if(!val){this.ui.addContactUser.show()}else{this.ui.contractUserTitle.show()}this.ui.contractUserTitleEdit.hide()},_updateTravalInfo:function(data){var deferred=new Talent.$.Deferred,modelObj=this.model.toJSON();MeetCollection.updateMeet({MeetType:this.settings.viewType,meet_id:modelObj.id,Title:modelObj.title,StartDate:data&&data.startDate||modelObj.startDate,DeadLine:data&&data.endDate||modelObj.deadLine,ContractUser:modelObj.contractUser,Description:modelObj.description}).done(function(resp){deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred},_renderAttachmentsView:function(){this.attachmentView=new AttachmentListView({collection:new Talent.Collection(this.model.get("attachments")),isShowDeleted:this.model.get("editable")});this.listenTo(this.attachmentView,"deleted",function(id){this._deleteAttachment(id)});this.attachmentView.render();this.ui.attachment.append(this.attachmentView.el)},_renderFileView:function(){var self=this;var template=['<a href="javascript:void(0);" title="" data-name="file" class="upload_node <%if(!openYFY){%>upload_new_file<%}%>">上传</a>',"<%if(openYFY){%>",'<div class="tt_upload_type_container" data-name="upload-type">','<dl class="upload_type_item"><span class="upload_new_file">本地上传</span></dl>','<dl class="upload_type_item"><span id="fc_upload" class="fang_cloud_btn">亿方云</span></dl>',"</div>","<%}%>",'<div class="error_container"></div>','<div class="loading_container"></div>'].join("");var UploaderView=UploaderComponentView.extend({template:Talent._.template(template)});var openYFY=Context.IsOpenYifangyun();this.uploaderView=new UploaderView({container:this.$el,openYFY:openYFY});this.uploaderView.render();this.uploaderView.on("uploadEnd",function(allObj,newObj){self._addAttachment(allObj.dfs,allObj.YFYresp)});this.uploaderView.on("error",function(data){self.$el.find('div[id="'+data["timestamp"]+'"]').remove()})},_addAttachment:function(dfs_data,yfy_data){var self=this;MeetCollection.addAttachment({objId:this.model.get("id"),dfsUrls:dfs_data.join(","),documents:yfy_data}).done(function(resp){var attachments=self.model.get("attachments")||[];Talent._.each(resp,function(item){attachments.push(item)});self.model.set("attachments",attachments);self.attachmentView.collection.add(resp)}).fail(function(msg){})},_deleteAttachment:function(id){var self=this;MeetCollection.deleteAttachment({meet_id:this.model.get("id"),document_id:id}).done(function(resp){var attachments=self.model.get("attachments");var newAttachments=[];Talent._.each(attachments,function(item){if(item.DocumentId!=id){newAttachments.push(item)}});self.model.set("attachments",newAttachments)}).fail(function(msg){TipInfoView(self.$el.find(".upload_file_input"),{placement:"bottom",type:"remind",body:msg,align:"center",container:self.$el,ico:"warn"})})},onClose:function(){this.isClose=true;Talent.$(document).off("mouseup.Task-Detail-Travel-View")}});var TaskTravelListView=Talent.CompositeView.extend({itemView:TaskTravelListItemView,itemViewContainer:'[data-name="task-detail-travel-list"]',template:jst["task-detail/task-travel-list"],defaults:{id:"",viewType:1,isShowCreate:true,taskCreateOptions:{classOptions:false,shape:"line",nameOptions:{iconShow:false,defaultText:"出差地点",showBorderLeft:false},hourDateOptions:false,participatorOptions:false,extendPersonOptions:{showBorderLeft:true},replaceOptions:false,principalOptions:false,applyUserOptions:false,bottomOptions:{isShowPrivateBtn:false,isShowMessage:false}}},ui:{taskContainer:'[data-name="task-create-container"]',listContaier:"[data-name=task-detail-travel-list]",itemDelete:'[data-name="item-delete"]'},events:function(){var events={};events["click "+this.ui.itemDelete]="_onDeleteItem";return events},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);if(typeof this.options.taskCreateOptions=="object"){this.settings.taskCreateOptions=Talent._.extend({},this.defaults.taskCreateOptions,this.options.taskCreateOptions)}},onRender:function(){},onShow:function(){var self=this;if(this.settings.isShowCreate){this._renderCreateView()}},_onDeleteItem:function(ev){ev.stopPropagation();var self=this,node=this.$(ev.currentTarget),id=node.attr("id"),li=node.closest("li");TipInfoView(node,{placement:"bottom",type:"confirm",body:"此操作不可恢复，您确定删除吗？",align:"right",container:li,okHide:function(){self._requestDelete(id,li)}})},_requestDelete:function(id,li){var self=this;MeetCollection.deleteMeet({id:id}).done(function(resp){self.collection.remove(self.collection.get(id));self.trigger("deleted",self.collection.toJSON())})},_renderCreateView:function(){var self=this,options=this.settings.taskCreateOptions;options["id"]=this.settings["id"]+"_"+this.settings.viewType;options["extraClass"]="task-travel-create";options["requestSubmit"]=Talent._.bind(this._addMeet,this);options["dataTimeRangeOptions"]={isShowDateView:false,isShowCycleView:false,isShowLongView:true,count:2,isShowTab:false};this.createTaskView=new TaskCreateView(options);this.ui.taskContainer.html(this.createTaskView.render().$el);this.createTaskView.onShow()},_addMeet:function(postData){var self=this;var defeered=new Talent.$.Deferred;MeetCollection.addMeet({ObjId:self.settings["id"],ObjType:7,Title:postData["TaskName"],ContractUser:postData["extend_user"],StartDate:postData["StartDate"],DeadLine:postData["EndDate"],FileUrls:postData["FileUrls"],MeetType:this.settings.viewType,Description:postData["Description"],OtherDocuments:postData["documents"],Participators:postData["Participators"]}).done(function(resp){self.collection.unshift([resp]);defeered.resolve(resp)}).fail(function(message){defeered.reject(message)});return defeered.promise()},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.children.add(view);view.render();if(!this.$el.find(this.itemViewContainer).find("li:first").length){this.$el.find(this.itemViewContainer).append(view.el)}else{this.$el.find(this.itemViewContainer).find("li:first").before(view.el)}if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)},itemViewOptions:function(){delete this.settings.model;delete this.settings.collection;this.$el.css("position","relative");this.settings.container=this.settings.container||this.$el;return this.settings},onClose:function(){this.createTaskView&&this.createTaskView.close()}});var TaskTravelDetailView=Talent.Layout.extend({defaults:{id:"",isShowCreate:true},template:jst["task-detail/task-travel-detail"],initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options)},regions:{taskTravelList:'div[data-name="task-travel-list"]'},ui:{total:'[data-name="task-detail-travel-total"]'},events:function(){var events={};return events},collectionEvents:{add:"_onChangeTotal",reset:"_onChangeTotal",remove:"_onChangeTotal"},templateHelpers:function(){return{total:this.collection.length}},onShow:function(){var self=this;this._renderTaskTravelList()},triggerIn:function(){if(this.taskTravelListCompositeView){this.$el.find("[data-name=task-create-name]").trigger("focus")}},_onChangeTotal:function(){this.ui.total.text(this.collection.length);this.model.set("businessTrips",this.collection.toJSON());this.trigger("countChange","businessTripTotal",this.collection.length)},_renderTaskTravelList:function(){var emptyView=EmptyView.extend({defaults:{emptyContext:"如果涉及到了出差，不妨记录下来"}});this.taskTravelListCompositeView=new TaskTravelListView({collection:this.collection,emptyView:emptyView,viewType:2,id:this.settings["id"],isShowCreate:this.settings["isShowCreate"]});this.taskTravelList.show(this.taskTravelListCompositeView)}});var TaskMeetDetailView=Talent.Layout.extend({defaults:{id:"",isShowCreate:true},template:jst["task-detail/task-meet-detail"],initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options)},regions:{taskMeetList:'div[data-name="task-travel-list"]'},ui:{total:'[data-name="task-detail-meet-total"]'},modelEvents:{"change:focusForm":"_focusMeet"},events:function(){var events={};return events},collectionEvents:{add:"_onChangeTotal",reset:"_onChangeTotal",remove:"_onChangeTotal"},templateHelpers:function(){return{total:this.collection.length}},onShow:function(){var self=this;this._renderTaskMeetList()},triggerIn:function(){if(this.taskMeetListCompositeView){this.$el.find("[data-name=task-create-name]").trigger("focus")}},_focusMeet:function(){var self=this;setTimeout(function(){self.taskMeetListCompositeView.createTaskView&&self.taskMeetListCompositeView.createTaskView.$el.find("input[name=ux_task_content]").trigger("focus");self.model.set({focusForm:false},{silent:true})},0)},_onChangeTotal:function(){this.ui.total.text(this.collection.length);this.model.set("meets",this.collection.toJSON());this.trigger("countChange","meetTotal",this.collection.length)},_renderTaskMeetList:function(){var emptyView=EmptyView.extend({defaults:{emptyContext:"所有开会记录可以汇总到这里"}});this.taskMeetListCompositeView=new TaskTravelListView({id:this.settings["id"],collection:this.collection,model:this.model,viewType:1,emptyView:emptyView,isShowCreate:this.settings["isShowCreate"],taskCreateOptions:{participatorOptions:{showBorderLeft:false},extendPersonOptions:{showBorderLeft:true},nameOptions:{iconShow:false,defaultText:"会议主题",showBorderLeft:false}}});this.taskMeetList.show(this.taskMeetListCompositeView)}});var TaskDetailWorkHourItemDetail=Talent.ItemView.extend({template:jst["task-detail/task-work-hour-list-item-detail"],className:"work-hour-item-detail",ui:{desAdd:"[data-name=task-detail-workhour-des-add]",desEdit:"[data-name=task-detail-workhour-des-edit]",desRich:"[data-name=task-detail-workhour-des-rich]",attachmentList:"[data-name=task-detail-workhour-attachment-list]",uploader:"[data-name=task-detail-work-hour-attachment-add]",taskDetailWorkhourDesRichWrap:"[data-name=task-detail-workhour-des-rich-wrap]"},events:function(){var events={};events["click "+this.ui.desAdd]="_showRichEditor";events["click "+this.ui.desEdit]="_showRichEditor";return events},templateHelpers:function(){return{timestamp:this.timestamp}},initialize:function(){this.isClose=false;this.isShowRich=false;this.timestamp=(new Date).getTime()+"_"+parseInt(Math.random()*1e3+1)},onRender:function(){var self=this;if(this.model.get("editable")){this._renderAttachmentView()}this._renderAttachmentList(this.model.get("attachments")||[])},_renderAttachmentView:function(){var self=this;var template=['<a href="javascript:void(0);" title="" data-name="file" class="upload_node <%if(!openYFY){%>upload_new_file<%}%>">点击添加</a>',"<%if(openYFY){%>",'<div class="tt_upload_type_container" data-name="upload-type">','<dl class="upload_type_item"><span class="upload_new_file">本地上传</span></dl>','<dl class="upload_type_item"><span id="fc_upload" class="fang_cloud_btn">亿方云</span></dl>',"</div>","<%}%>",'<div class="error_container"></div>','<div class="loading_container"></div>'].join("");var UploaderView=UploaderComponentView.extend({template:Talent._.template(template)});var openYFY=Context.IsOpenYifangyun();this.uploaderView=new UploaderView({container:this.$el,openYFY:openYFY});this.uploaderView.render();this.ui.uploader.prepend(this.uploaderView.$el);this.uploaderView.on("uploadEnd",function(allObj,newObj){self._requestAddAttachment(allObj.dfs,allObj.YFYresp)});this.uploaderView.on("error",function(data){self.$el.find('div[id="'+data["timestamp"]+'"]').remove()})},_requestAddAttachment:function(dfs_data,yfy_data){var self=this;WorkTimeCollection.addAttachment({objId:this.model.get("id"),dfsUrls:dfs_data.join(","),documents:yfy_data}).done(function(data){if(self.isClosed)return;self.attachmentListView.collection.add(data)})},_requestDeleteAttachment:function(id){var self=this;WorkTimeCollection.deleteAttachment({work_time_id:this.model.get("id"),document_id:id}).done(function(data){})},_renderAttachmentList:function(data){var mCollection=Talent.Collection.extend({model:Talent.Model.extend({idAttribute:"documentId"})});this.attachmentListView=new AttachmentListView({collection:new mCollection(data)});this.listenTo(this.attachmentListView,"deleted",function(document_id){this._requestDeleteAttachment(document_id)});this.ui.attachmentList.html(this.attachmentListView.render().el)},_showRichEditor:function(events){events.stopPropagation();var self=this;var editable=this.model.get("editable");if(!editable){return}var des=this.model.get("description");this.ui.desAdd.hide();this.ui.desEdit.hide();this.ui.desRich.show();if(!this.richEditor){this.richEditor=new NewRichEditor({containerId:"task-detail-workhour-des-rich-item-"+this.timestamp,maxWords:5e3,hasBtns:true,placeholder:"请添加工时备注"});this.listenTo(this.richEditor,"editorSubmit",function(inputData){this.ui.taskDetailWorkhourDesRichWrap.hide();var data=inputData.html?inputData.html:"";this._hideRichEditor(data)});this.listenTo(this.richEditor,"editorConcel",function(inputData){var beforeDes=this.model.get("description");this.richEditor.fillContent(beforeDes);if(beforeDes){this.ui.desEdit.show();

this.ui.desRich.hide()}else{this.ui.desAdd.show()}this.ui.taskDetailWorkhourDesRichWrap.hide()});this.richEditor.show();this.richEditor.fillContent(this.model.get("description"))}else{this.ui.taskDetailWorkhourDesRichWrap.show();this.richEditor.editor.restoreSelection()}this.isShowRich=true},_hideRichEditor:function(data){this.isShowRich=false;var self=this;var des=data,initDescription=this.model.get("description");if(!/(<(img|table)[^>]*>)/g.test(des)){var testDes=des.toLowerCase();testDes=testDes.replace(/(<[^>]*>(<[^>]*>|&nbsp;)?(<\/[^>]*>)?)|&nbsp;/g,"");testDes=Talent.$.trim(testDes);if(testDes==""){des=""}}if(!des||des==""){this.ui.desAdd.show()}else{this.ui.desEdit.show()}if(initDescription!=des){this.model.set("description",des);this.trigger("des",this.model.toJSON());this.ui.desEdit.html(des)}},onClose:function(){this.isClose=true;Talent.$(document).off("mouseup.Task-Work-Hour-List-View")}});var TaskDetailWorkHourListItemView=Talent.ItemView.extend({defaults:{id:""},tagName:"li",className:"task_item",template:jst["task-detail/task-work-hour-list-item"],ui:{name:"[data-name=task-detail-workhour-name]",nameInputBox:"[data-name=task-detail-workhour-name-input]",nameInput:"[data-name=task-detail-workhour-name-input] input",detailBox:"[data-name=task-detail-workhour-item-detail-box]",detailBtn:"[data-name=task-detail-workhour-item-detail-btn]",detailIco:"[data-name=task-detail-workhour-item-detail-btn] em"},modelEvents:{"change:time":"render","change:hours":"_changeWorkHourEvent","change:minutes":"_changeWorkHourEvent","change:hoursTotal":"render"},_changeWorkHourEvent:function(){var hours=Number(this.model.get("hours")),minutes=Number(this.model.get("minutes"));if(!minutes){hoursTotal=hours}else{hoursTotal=(hours*60+minutes)/60}this.model.set("hoursTotal",hoursTotal);this.trigger("itemHourTotalChange")},templateHelpers:function(){var name=this.model.get("name"),time=this.model.get("time");return{name:Talent._.substring(name,50,true),time:Context.formatDate(time,true)}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.detailBoxOpen=false;this._judgeCurrentUser();this.isClose=false},events:function(){var events={};events["mouseenter "+this.ui.name]="_overNameHandler";events["mouseleave "+this.ui.name]="_leaveNameHandler";events["click "+this.ui.name]="_clickNameHandler";events["blur "+this.ui.nameInput]="_blurNameHandler";events["click "+this.ui.detailBtn]="_detailToggleHandler";return events},onRender:function(){var self=this;this.detailBtnTxt=this.ui.detailBtn.find(".txt")},_judgeCurrentUser:function(){var currentLoginUserId=Context.getUserInfo()["Id"];var currentUserId=this.model.get("user")["userId"];currentLoginUserId==currentUserId?this.model.set("isLoginUser",true):this.model.set("isLoginUser",false)},_detailToggleHandler:function(ev){ev.stopPropagation();if(!this.detailBoxOpen){this.detailBoxOpen=true;this._requestGetDetail();this.ui.detailBox.show();this.detailBtnTxt.html("收起");this.ui.detailIco.addClass("tu-icon-arrow-up").removeClass("tu-icon-arrow-down")}else{this.detailBoxOpen=false;this.ui.detailBox.hide();this.detailBtnTxt.html("详情");this.ui.detailIco.addClass("tu-icon-arrow-down").removeClass("tu-icon-arrow-up")}},_requestGetDetail:function(){var self=this;WorkTimeCollection.getDetail({obj_id:this.settings["id"],obj_type:7,work_time_id:this.model.get("id")}).done(function(resp){if(self.isClose)return;self._renderItemDetail(resp)})},_renderItemDetail:function(resp){this.TaskDetailWorkHourItemDetail=new TaskDetailWorkHourItemDetail({model:new Talent.Model(resp)});this.listenTo(this.TaskDetailWorkHourItemDetail,"des",function(des){this.trigger("des",des)});this.ui.detailBox.html(this.TaskDetailWorkHourItemDetail.render().$el)},_overNameHandler:function(event){var node=Talent.$(event.currentTarget);var nameLength=this._dealNameLength(this.model.get("name"));if(!node.data["tipsy"]&&nameLength>50){var self=this;node.tipsy({gravity:"s",tirgger:"manual",title:function(){return self.model.get("name")}})}node.tipsy("show");if(!this.model.get("editable"))return;this.ui.name.addClass("editable")},_dealNameLength:function(name){var reg=/[\u4e00-\u9fa5]/,strArr=name.split(""),len=0;Talent._.each(strArr,function(str){if(reg.test(str)){len+=2}else{len+=1}});return len},_leaveNameHandler:function(event){var node=Talent.$(event.currentTarget);node.tipsy("hide");if(!this.model.get("editable"))return;this.ui.name.removeClass("editable")},_clickNameHandler:function(ev){if(!this.model.get("editable"))return;this.ui.name.hide();this.ui.nameInputBox.show();var name=this.model.get("name");this.ui.nameInput.val(name).trigger("focus")},_blurNameHandler:function(ev){var node=Talent.$(ev.currentTarget);var val=Talent.$.trim(node.val());this.model.set("name",val);this.trigger("name",this.model.toJSON());this.ui.name.html(Talent._.substring(val,50,true));this.ui.name.show();this.ui.nameInputBox.hide()},onClose:function(){this.isClose=true}});var TaskDetailWorkHourListView=Talent.CompositeView.extend({defaults:{id:"",pageSize:5},className:"work-hour-list",itemView:TaskDetailWorkHourListItemView,itemViewContainer:"[data-name=task-detail-work-hour-list]",template:jst["task-detail/task-work-hour-list"],ui:{listToggle:"[data-name=task-detail-work-hour-user-toggle]",listToggleTxt:"[data-name=task-detail-work-hour-user-toggle] .txt",listToggleIco:"[data-name=task-detail-work-hour-user-toggle-ico]",listBox:"[data-name=task-detail-work-hour-list-box]",date:"[data-name=task-detail-workhour-date]",hour:"[data-name=task-detail-workhour-hour]",total:"[data-name=task-detail-work-hour-total]",more:"[data-name=task-detail-work-hour-more]",moreText:"[data-name=task-detail-work-hour-more-text]",moreIco:"[data-name=task-detail-work-hour-icon]",deleted:"[data-name=task-detail-workhour-delete]"},events:function(){var events={};events["click "+this.ui.listToggle]="_openListHandler";events["click "+this.ui.date]="_dateHandler";events["click "+this.ui.hour]="_hourHandler";events["click "+this.ui.more]="_showMoreHandler";events["click "+this.ui.deleted]="_deletedHandler";return events},itemViewOptions:function(){return{id:this.options["id"]}},templateHelpers:function(){return{isShowMore:this.allCollection.length>this.settings["pageSize"]}},collectionEvents:{add:"_collectionAdd"},modelEvents:{"change:totalHours":"_modelTotalHours"},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);this.allCollection=new Talent.Collection(this.model.get("workTimes"));var len=this.allCollection.length,pageSize=this.settings["pageSize"];if(len>pageSize){var sliceData=this.allCollection.slice(0,pageSize)}else{var sliceData=this.allCollection.toJSON()}this.collection=new Talent.Collection(sliceData);this.on("itemview:name",function(view,data){this._requestUpdate("name",data)});this.on("itemview:des",function(view,data){this._requestUpdate("des",data)});this.on("itemview:itemHourTotalChange",function(view,data){var hoursTotal=Talent._.pluck(this.collection.toJSON(),"hoursTotal");var totalHours=0;for(var i=0;i<hoursTotal.length;i++){totalHours+=Number(hoursTotal[i])}this.model.set("totalHours",totalHours);this.ui.total.html(totalHours+"h")});this.isShowMore=false;this.isClose=false;this._loginUserShowWorkList()},_loginUserShowWorkList:function(){var loginUid=Context.getUserInfo().Id;var curUid=this.model.get("user")["userId"];var showList=false;if(loginUid==curUid){showList=true}this.model.set("showList",showList)},_modelTotalHours:function(){this.ui.total.html(this.model.get("totalHours")+"h")},_collectionAdd:function(){this.allCollection.unshift(this.collection.toJSON())},_countHourTotal:function(){},_deletedHandler:function(events){events.stopPropagation();var self=this;var node=Talent.$(events.currentTarget),id=node.attr("id");var tipInfo=TipInfoView(node,{placement:"top",type:"confirm",body:"此操作不可恢复，您确定删除吗？",align:"right",container:this.$el,okHide:function(){tipInfo.hide();self._requestDelete(id)}})},_requestDelete:function(id){var self=this;WorkTimeCollection.deleteWorkHour({id:id}).done(function(resp){if(self.isClose)return;var model=self.collection.get(id);self.collection.remove(model);self.allCollection.remove(model);self.model.set("totalHours",self.model.get("totalHours")-model.get("hoursTotal"));self.trigger("remove",model.toJSON())})},_showMoreHandler:function(ev){ev.stopPropagation();if(!this.isShowMore){this.collection.reset(this.allCollection.toJSON());this.ui.moreText.html("收起");this.ui.moreIco.removeClass("tu-icon-arrow-down").addClass("tu-icon-arrow-up");this.isShowMore=true}else{var sliceData=this.allCollection.slice(0,this.settings["pageSize"]);this.collection.reset(sliceData);this.ui.moreText.html("展开");this.ui.moreIco.removeClass("tu-icon-arrow-up").addClass("tu-icon-arrow-down");this.isShowMore=false}},_hourHandler:function(ev){ev.stopPropagation();var self=this,node=this.$(ev.currentTarget);this.nodeId=node.attr("id");var model=this.collection.get(this.nodeId);this.itemViewModel=this.collection.get(this.nodeId);this.workHourVie&&this.workHourVie.close();this.workHourView=new WorkHourView({parentEl:this.$el});this.listenTo(this.workHourView,"sure",function(data){this.itemViewModel.set({hours:data.hourDate,minutes:data.minuteDate});data["id"]=this.nodeId;data["hours"]=model.get("hours");data["minutes"]=model.get("minutes");data["time"]=model.get("time");this._requestUpdate("date",data)},this);this.workHourView.model.set({hourDate:this.itemViewModel.get("hours"),minuteDate:this.itemViewModel.get("minutes")});this.workHourView.show(node,{pos:"bottomRight",container:this.$el})},_dateHandler:function(ev){ev.stopPropagation();var node=Talent.$(ev.currentTarget);this.nodeId=node.attr("id");var model=this.collection.get(this.nodeId);this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView({count:1,isShowDateView:true,isShowCycleView:false,isShowLongView:false,rangepickerOptions:{timePicker:false,format:"YYYY/MM/DD",maxDate:moment().format("YYYY/MM/DD"),startDate:model.get("time")}});this.listenTo(this.dateTimePickerView,"sure",function(node,data){data["id"]=this.nodeId;data["hours"]=model.get("hours");data["minutes"]=model.get("minutes");data["time"]=data["startDate"];model.set("time",data["startDate"]);this._requestUpdate("date",data)},this);this.$el.append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.$el,pos:"bottomRight"})},_openListHandler:function(ev){var isOpen=this.ui.listBox.is(":visible");this.ui.listToggleIco.removeClass("tu-icon-arrow-up tu-icon-arrow-down");if(isOpen){this.ui.listBox.hide();this.ui.listToggleIco.addClass("tu-icon-arrow-down");this.ui.listToggleTxt.html("详情")}else{this.ui.listBox.show();this.ui.listToggleIco.addClass("tu-icon-arrow-up");this.ui.listToggleTxt.html("收起")}},_requestUpdate:function(type,data){var options={ObjId:this.settings["id"],ObjType:7,work_time_id:data["id"]};switch(type){case"name":{options["Name"]=data["name"]}break;case"des":{options["Description"]=data["description"]}break;case"date":{options["Time"]=data["time"];options["Hour"]=data["hours"];options["Minute"]=data["minutes"]}break}var self=this;WorkTimeCollection.updateWokHour(options).done(function(resp){}).fail(function(msg){})},onClose:function(){this.isClose=true}});var TaskDetailWorkHourUserListView=Talent.CompositeView.extend({defaults:{id:"",isShowCreate:true,autoCompleteData:[]},template:Talent._.template('<div class="workhourlist" />'),itemView:TaskDetailWorkHourListView,itemViewContainer:".workhourlist",itemViewOptions:function(){return{id:this.settings["id"]}},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.on("itemview:remove",function(view){this.trigger("remove",view.model.toJSON())})},onShow:function(){if(this.settings["isShowCreate"]){this._renderCreateView()}},_renderCreateView:function(){var self=this,options=this.settings.taskCreateOptions;this.createTaskView=new TaskCreateView({id:this.settings.id+"_work-hour",shape:"line",templateName:"workhour",nameOptions:{dropdownData:this.settings["autoCompleteData"],defaultText:"输入工时名称",iconShow:false},dataTimeRangeOptions:{count:1,rangepickerOptions:{timePicker:false,maxDate:moment().format("YYYY/MM/DD"),format:"YYYY/MM/DD"}},requestSubmit:function(formatData,data){var deferred=new Talent.$.Deferred;WorkTimeCollection.addWorkHour({ObjId:self.settings["id"],ObjType:7,Name:data["taskTitle"],Description:data["code"],Time:data["startDate"],Hour:data["hourDate"],Minute:data["minuteDate"],FileUrl:formatData["FileUrls"],Documents:formatData["documents"]}).done(function(resp){if(!resp){deferred.resolve("");return}self._requestAddWorkHour(resp);self.trigger("add",resp);deferred.resolve(resp)}).fail(function(msg){deferred.reject(msg)});return deferred}});this.$el.prepend(this.createTaskView.render().$el);this.createTaskView.onShow()},_requestAddWorkHour:function(data){var self=this;var hasUser=false;if(!this.collection.length){this.collection.add([{taotal:1,totalHours:data["hoursTotal"],user:data["user"],workTimes:[data]}]);return}this.children.each(function(view){var model=view.model;if(model.get("user")["userId"]==data["user"]["userId"]){hasUser=true;var workTimes=model.get("workTimes");view.collection.unshift(data);view.render();model.set("totalHours",model.get("totalHours")+data["hoursTotal"]);self.model.set("workTimes",workTimes)}});if(!hasUser){this.collection.unshift([{taotal:1,totalHours:data["hoursTotal"],user:data["user"],workTimes:[data]}])}},addChildView:function(item,collection,options){this.closeEmptyView();var ItemView=this.getItemView(item);var index=this.collection.indexOf(item);var itemViewOptions=Marionette.getOption(this,"itemViewOptions");if(_.isFunction(itemViewOptions)){itemViewOptions=itemViewOptions.call(this,item,index)}var view=this.buildItemView(item,ItemView,itemViewOptions);this.addChildViewEventForwarding(view);this.children.add(view);view.render();if(!this.$el.find(this.itemViewContainer).find(".work-hour-list:first-child").length){this.$el.find(this.itemViewContainer).append(view.el)}else{this.$el.find(this.itemViewContainer).find(".work-hour-list:first-child").before(view.el)}if(this._isShown){Marionette.triggerMethod.call(view,"show")}this.triggerMethod("after:item:added",view)}});var TaskDetailWorkHourView=Talent.Layout.extend({defaults:{id:"",isShowCreate:true,autoCompleteData:""},template:jst["task-detail/task-work-hour-detail"],initialize:function(options){var self=this;this.options=options},regions:{taskWorkHourList:'div[data-name="task-detail-work-hour-list"]'},ui:{total:"span[data-name=task-detail-work-hour-total]"},modelEvents:{"change:workHourTotal":"_changeTotal"},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.model.set({workHourTotal:0},{silent:true})},events:function(){var events={};return events},onShow:function(){var self=this;this._countTotal();this._renderTaskWorkHourList()},triggerIn:function(){if(this.taskDetailWorkHourUserListView){this.$el.find("[data-name=task-create-name]").trigger("focus")}},_changeTotal:function(){this.ui.total.html(this.model.get("workHourTotal"));var timeTotal=0,collection=this.collection.toJSON();for(var i=0;i<collection.length;i++){timeTotal+=collection[i].totalHours}this.trigger("countChange","workTimeTotal",timeTotal)},_countTotal:function(){var data=this.collection.toJSON();var total=0;for(var i=0;i<data.length;i++){total+=data[i]["workTimes"].length}this.model.set("workHourTotal",total)},_renderTaskWorkHourList:function(){var emptyView=EmptyView.extend({defaults:{emptyContext:"想了解工作耗费多少时间吗？试试记录工时"}});this.taskDetailWorkHourUserListView=new TaskDetailWorkHourUserListView({collection:this.collection,id:this.settings.id,emptyView:emptyView,isShowCreate:this.settings["isShowCreate"],autoCompleteData:this.settings["autoCompleteData"]});this.listenTo(this.taskDetailWorkHourUserListView,"add",function(data){var total=this.model.get("workHourTotal");this.model.set("workHourTotal",total+1)});this.listenTo(this.taskDetailWorkHourUserListView,"remove",function(data){var total=this.model.get("workHourTotal");this.model.set("workHourTotal",total-1)});this.taskWorkHourList.show(this.taskDetailWorkHourUserListView)}});var TaskRelateModalView=Talent.ItemView.extend({defaults:{overlay:true},template:jst["task-detail/task-relate-modal"],className:"task-relate project-lotSize",modelEvents:{},ui:{filterContainer:"[data-name=task-relate-filter]",listContainer:"[data-name=task-relate-list]",pagination:"[data-name=pagination]"},initialize:function(options){this.options=Talent._.extend({},this.defaults,options);this.userInfo=Talent.Context.getUserInfo();this.startNum=1;this.$el.on("click.task-relate-modal",function(event){event.stopPropagation()})},onRender:function(){this._getInitParameters();this._showPagination()},show:function(){var self=this;var options={backdrop:"static",hasfoot:true,hashead:true,closeBtn:true,excessBtn:this.options.isShowButtomReset?"取消关联":"",width:"800",height:"auto",body:self.render().$el,title:"关联任务",okHide:function(ev){var event=ev||window.event;var taskId=self.multipleTaskListView.model.get("globalTaskIds")[0].taskId,node=$(event.currentTarget);if(taskId!=self.options.old_parent_task_id){self._requestChangeRelate(taskId,"change",node)}else{return true}return false},excessHide:function(){self._requestChangeRelate("","reset")},hidden:function(){self.trigger("closed")}};if(!this.options.overlay){options["bgcolor"]="transparent"}this.modals=$.confirm(options);if(!this.options.old_parent_task_id){this.modals.modal("okToggle","disabled")}this._renderDataFilterView()},_requestChangeRelate:function(taskId,type,node){var self=this;TaskCollection.changeTask({task_id:this.options.task_id,parent_task_id:taskId,old_parent_task_id:this.options.old_parent_task_id}).done(function(resp){self.trigger("changeRelate",resp);self.modals.modal("hide")}).fail(function(msg){if(self.isClosed)return;var txt=msg;if(type=="change"){txt="不可将任务关联到任务自身及任务自身的子任务上"}Talent.$("body").find(".modal-content").addClass("tu-por");self._showTipDialog(node,{placement:"bottom",type:"remind",body:txt,align:"right",container:Talent.$("body").find(".modal-content"),ico:"warn"})})},_showTipDialog:function(node,data,view){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",animation:false,type:"default",body:"",trigger:"manual",hasfoot:true,align:"left",html:true,container:this.$el};view=view?view:"infoTipView";var options=Talent._.extend({},defaults,data);this[view]=new Infotip;this[view].bindNode(node,options);this[view].show()},_getInitParameters:function(){var date=moment().format("YYYY/MM/DD");var self=this;PlanCollection.getPlan({group_id:0,date:date}).done(function(resp){var PlanTableListModels=Talent._.findWhere(resp.taglist,{Active:true}).PlanTableListModels,PlanTableModels=Talent._.findWhere(PlanTableListModels,{Active:true}).PlanTableModels,PlanModels=Talent._.findWhere(PlanTableModels,{Active:true});self.initDateParameters={StartDate:PlanModels.StartDate,EndDate:PlanModels.EndDate,planTableId:PlanModels.PlanTableId,planTableType:PlanModels.PlanTableType};self._getTaskListData(self.initDateParameters)})},_rendLoadView:function(){this.loadingView=new LoadingView;this.ui.listContainer.html(this.loadingView.render().$el);this.ui.pagination.hide()},_getTaskListData:function(data){var self=this;this._rendLoadView();var defaults={type:"personal",count:20,startNum:this.startNum,to_user_id:this.userInfo.Id,fromLevel:1,toLevel:1};var options=Talent._.extend({},defaults,data);PlanCollection.getTaskData(options).done(function(resp){if(self.isClosed)return;self._renderListContainer(resp.tasks,resp.total)})},_renderListContainer:function(tasks,total){this.ui.listContainer.empty();if(tasks&&tasks.length){this.ui.pagination.show();this.ui.pagination.TPagination("updateItemsCount",total);this.ui.pagination.TPagination("goToPage",this.startNum);var taskList=this._combineDataByClass(tasks);this._renderMultipleTaskList(taskList)}else{this.ui.pagination.hide();this.emptyView&&this.emptyView.close();this.emptyView=new EmptyView({emptyContext:"暂无数据"});this.ui.listContainer.append(this.emptyView.render().$el)}},_renderMultipleTaskList:function(tasksData){var self=this;this.multipleTaskListView&&this.multipleTaskListView.close();this.multipleTaskListView=new MultipleTaskListView({multiple:false,isCombine:true,combineName:"labelName",combineId:"labelId",tasks:tasksData,listSpecialStyle:false,model:new Talent.Model({globalTaskIds:[{taskId:self.options.old_parent_task_id}],currentPageExposeNum:0,currentPageChckedNum:0}),subTasksGetResp:function(data){var defeered=new Talent.$.Deferred;var defaults={type:1,parentTaskId:data.taskId,to_user_id:self.userInfo.Id,fromLevel:data.level,toLevel:data.level+1,IsTeam:false},options=Talent._.extend({},defaults,self.initDateParameters,self.filterData);PlanCollection.getSubPlans(options).done(function(resp){defeered.resolve(resp)});return defeered}});this.multipleTaskListView.model.on("change:globalTaskIds",function(model){if(model.get("globalTaskIds")&&model.get("globalTaskIds").length){self.modals.modal("okToggle")}else{self.modals.modal("okToggle","disabled")}});this.ui.listContainer.append(this.multipleTaskListView.render().$el)},_combineDataByClass:function(data){var labelIdList=Talent._.uniq(Talent._.pluck(data,"labelId")),combineTaskList=[];Talent._.each(labelIdList,function(labelId){var obj={labelId:labelId,labelName:Talent._.findWhere(data,{labelId:labelId}).labelName,tasks:Talent._.where(data,{labelId:labelId})||[]};combineTaskList.push(obj)});return combineTaskList},_renderDataFilterView:function(){var self=this;var filterOptions={tab:["status","class","scope","sort","timeDropdown"],tabResizeChange:false,tabOptions:{status:{activeOrder:"0,1,2,3,4,6",isMult:true,data:[{title:"未开始",order:["0"],checked:true},{title:"进行中",order:["1"],checked:true},{title:"已完成",order:["2"],checked:true},{title:"已延迟",order:["3"],checked:true},{title:"已取消",order:["4"],checked:true},{title:"暂停中",order:["6"],checked:true}]},scope:{activeOrder:"1,2,3",rely:"",isMult:true,data:[{title:"我负责的",order:["1"],checked:true},{title:"我派发的",order:["3"],checked:true},{title:"我参与的",order:["2"],checked:true}]},sort:{activeOrder:"1",clickItemHide:true,data:[{title:"默认排序",order:["1"]},{title:"开始时间",order:["3","2"],tip:[{txt:"点击后最晚开始的在最前面",order:"3"},{txt:"点击后最早开始的在最前面",order:"2"}]},{title:"结束时间",order:["5","4"],tip:[{txt:"点击后最晚结束的在最前面",order:"5"},{txt:"点击后最早结束的在最前面",order:"4"}]},{title:"创建时间",order:["7","6"],tip:[{txt:"点击后最晚创建的在最前面",order:"7"},{txt:"点击后最早创建的在最前面",order:"6"}]}],tabLeftLine:true,save:{support:false}},"class":{options:{zIndex:2e3,viewType:"multi",container:$("body").find(".modal-content")}},timeDropdown:{tabTitle:"时间",inResult:true,changeTabTitle:false,tabLeftLine:false}},saveFilterResult:{support:false},search:{show:true,placeholder:"请输入关键字"},afterSearchInResultBar:["timeDropdown"],clickExtendTabCallback:function(tabName,node){var storeData=Talent._.findWhere(this.model.get("storeData"),{tabName:"timeDropdown"});if(storeData){var dateData=storeData.data.dateData}if(!this.timeDropdownView){this.timeDropdownView=new YearMonthWeekDropdown({dateData:dateData||[]});this.listenTo(this.timeDropdownView,"sure",function(data,dateData){data.dateData=dateData;this._dealChoseData(node,tabName,data)});this.listenTo(this.timeDropdownView,"close",function(){this.$el.find(".tab-item-active").removeClass("tab-item-active")});this.$el.append(this.timeDropdownView.render().$el);this.timeDropdownView.bindNode({node:node,container:this.$el})}},dealextendStoreDataCallback:function(tabName,item){var obj={groupName:"timeDropdown",groupTittle:"时间",groupList:{val:item.data.dateAllName,data:item.data}};return obj},dealExtendDeleteCallback:function(data){var groupName=data.groupName,groupData=this._selectCollection.findWhere({tabName:groupName}).get("data"),findInSelectCollectionData=this._selectCollection.findWhere({tabName:groupName}),timeTabData=_.filter(this.model.get("tab"),{tabName:"timeDropdown"})[0],storeData=_.filter(this.model.get("storeData"),{tabName:"timeDropdown"})[0];this._selectCollection.remove(findInSelectCollectionData);if(this.timeDropdownView){this.timeDropdownView.render();this.timeDropdownView._renderUls();this.timeDropdownView.setActivePostion()}else{var storeData=this.model.get("storeData");if(_.isArray(storeData)&&storeData.length>0){this.model.set("storeData",_.filter(storeData,function(item){return item.tabName!="timeDropdown"}))}}this.trigger("result",this._selectCollection.toJSON())}};this.filterView&&this.filterView.close();this.filterView=new SearchSortFilter(filterOptions);this.listenTo(this.filterView,"result",function(data){this.filterKey="";this.startNum=1;this.filterData=Talent._.extend({},this.initDateParameters,this._dealFilterData(data));this._getTaskListData(this.filterData)});this.listenTo(this.filterView,"search",function(val){this.startNum=1;self.filterKey=val;if(val){this._getSearchData(val)}else{this._getTaskListData(this.initDateParameters)}});this.ui.filterContainer.append(this.filterView.render().$el);this.filterView.onShow()},_getSearchData:function(filterKey){var self=this;this._rendLoadView();PlanCollection.getSearchTaskData({FilterKey:filterKey,startNum:this.startNum,count:20,planTableId:this.filterData&&this.filterData.planTableId||this.initDateParameters.planTableId,to_user_id:this.userInfo.Id}).done(function(resp){var taskList=self._searchTaskNameDeal(resp.planItems);self._renderListContainer(resp.planItems,resp.total)})},_searchTaskNameDeal:function(taskList){var self=this;var patt=new RegExp(this.filterKey,"g");Talent._.each(taskList,function(item){var temp=item.taskName;item.taskName=temp.replace(patt,"<span style='color:#c23934'>"+self.filterKey+"</span>")});return taskList},_dealFilterData:function(filterData){if(!_.isArray(filterData)||_.isEmpty(filterData))return;var options={};_.each(filterData,function(item){switch(item.tabName){case"status":{options.Status=item.data.activeOrder}break;case"class":{var classArr=[];_.each(item.data.choseData,function(i){classArr.push({id:i.id,name:i.name,lableType:i.tabType})});options.LableModels=classArr}break;case"scope":{options.RelationType=item.data.activeOrder}break;case"sort":{options.SortType=item.data.activeOrder}break;case"timeDropdown":{options.planTableType=item.data.PlanTableType;options.planTableId=item.data.PlanTableId;options.StartDate=item.data.StartDate;options.EndDate=item.data.EndDate}break}});return options},_showPagination:function(){var self=this;this.ui.pagination.TPagination({styleClass:["pagination-large"],pageSize:20,displayInfoType:"itemsCount",onSelect:function(num){if(num==self.startNum)return;self.startNum=num;if(self.filterKey){self._getSearchData(self.filterKey)}else{self._getTaskListData(Talent._.extend({},self.initDateParameters,self.filterData))}$(".tu-page-container").scrollTop(0)}})}});var TaskDetailView=Talent.Layout.extend({template:jst["task-detail/task-detail-layout"],className:"task-detail-layout",defaults:{isShowTask:true,isShowWorkTime:true,isShowMeeting:false,isShowTravel:false,isShowShare:true,topBias:"0",isShowScroll:true,isShowDetialScroll:true},regions:{taskUnaccept:"div[data-name=task-detail-unaccept]",taskStatus:'div[data-name="task-detail-status"]',action:"div[data-name=task-detail-action]",info:"div[data-name=task-detail-info]",baseInfo:"div[data-name=task-detail-base-info]",evaluation:"div[data-name=task-detail-evaluation]",taskTrack:"div[data-name=task-detail-track]",taskAddDo:"[data-name=task-detail-add-do]",share:"div[data-name=task-detail-share]",comment:"div[data-name=task-detail-comment]",taskTravel:'div[data-name="task-detail-travel"]',taskMeet:"[data-name=task-detail-meet]",task:"[data-name=task-detail-task-list]",workHour:"[data-name=task-detail-work-hour]",taskCustom:'div[data-name="ux-customizetDatas"]',taskFollower:'[data-name="task-detail-follower"]',taskShareUser:'[data-name="task-share-user"]',applyBox:"[data-name=task-apply]",reward:"[data-name=task-detail-reward]"},ui:{share:"div[data-name=task-detail-share]",taskTravel:'div[data-name="task-detail-travel"]',taskMeet:'[data-name="task-detail-meet"]',task:"[data-name=task-detail-task-list]",workHour:"[data-name=task-detail-work-hour]",taskCustom:'div[data-name="ux-customizetDatas"]',taskShareUser:'[data-name="task-share-user"]',taskScoll:"[data-name=task-detail-scroll]",applyBox:"[data-name=task-apply]"},modelEvents:{"change:isApply":"_renderTaskActionview"},templateHelpers:function(){var header=Context.getGlobal("Header")||[];var TaskAdvancedSetting=Context.getGlobal("TaskAdvancedSetting");var TaskFollower=TaskAdvancedSetting.TaskFunctionSetting.TaskFollower;var isOpenReward=Talent._.findWhere(header,{Code:"950"})?true:false;return{isOpenReward:isOpenReward,isShowDetialScroll:this.settings.isShowDetialScroll,TaskFollower:TaskFollower}},_labIdChnageHandler:function(){this._renderTaskDetail()},events:function(){var events={};return events},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);this._customizeSettings();this.id=this.settings["id"]||this.model.get("taskId")||"";this.i18n=Talent.Context.getI18n();this.userInfo=Talent.Context.getUserInfo();if(!this.model){this.model=new Talent.Model}this.model.set({i18n:this.i18n,iTask:this.i18n["task_1"],taskId:this.id},{silent:true});this.experienceColletion=new Talent.Collection;this.businessTripsceColletion=new Talent.Collection;this.tasksCollection=new Talent.Collection;this.meetsColletion=new Talent.Collection;this.applysColletion=new Talent.Collection;this.workTimesColletion=new Talent.Collection;this.commentsModel=new Talent.Model;this.tracksModel=new Talent.Model;this.isClose=false;this.openAdd={1:true,2:true,3:true};this.$el.on("click",function(event){event.stopPropagation();self.taskBaseInfoView&&self.taskBaseInfoView.closeUserSelect();self.shareRangeView&&self.shareRangeView.closeView()});Talent.$(window).on("resize.Task-Detail-Layout-View",function(){self._setScrollAreaHeight()})},onRender:function(){this._getTaskDetailData()},changeCounters:function(counterType,value){if(counterType!="workTimeTotal"){var counter=this.model.get("counter");counter[counterType]=value;this.model.unset(counter);this.model.set({counter:counter})}},_customizeSettings:function(){var tenant_function=Context.getGlobal("tenant_function");if(tenant_function&&typeof tenant_function=="object"){this.settings.isShowMeeting=tenant_function.IsUseMeet;this.settings.isShowTravel=tenant_function.IsUseBusinessTrip}},_getTaskDetailData:function(){var self=this;var id=this.id;TaskCollection.getTaskInfo({task_id:id}).done(function(resp){if(self.isClosed)return;if(resp["code"]==0||resp["code"]==-1){self._showErrowPage(resp["code"]);self.trigger("getDataAfter");return}var newCounter=self.model.get("counter");if(newCounter&&newCounter["workTimeTotal"]!=undefined){resp.counter["workTimeTotal"]=newCounter["workTimeTotal"]}self.model.set(resp);if(resp.cycleId&&resp.cycleId!=""){TaskCollection.getCycleTask({cycle_id:resp.cycleId}).done(function(resp){if(self.isClosed)return;self.model.set("cycleInfo",resp);self._showLayout()})}else{self._showLayout()}self._renderRewardUserListView();self.trigger("getDataAfter")}).fail(function(msg){})},_setScrollAreaHeight:function(){if(!this.settings.isShowScroll)return;var self=this;var acceptHeight=this.taskUnacceptView&&this.taskUnacceptView.$el.outerHeight()||0;var actionHeight=this.taskActionview&&this.taskActionview.$el.outerHeight()||0;var clientHeight=Talent.$(window).height()-this.settings["topBias"];this.ui.taskScoll.height(clientHeight-acceptHeight-actionHeight)},_showLayout:function(){var self=this;if(this.isClose)return;this._renderAllView();this._renderLoadingView();Talent.$.when(this._getTaskInfoObj(),this._getTaskFeed()).done(function(){if(self.isClose)return;self.loadingView&&self.loadingView.close();self._setScrollAreaHeight();

self._rendereQuickView()})},_getTaskInfoObj:function(){var self=this;var id=this.id;var deferred=new Talent.$.Deferred;TaskCollection.getTaskInfoObj({task_id:id}).done(function(resp){if(self.isClose)return;self.tasksCollection.reset(resp.tasks||[]);self.experienceColletion.reset(resp.experience||[]);self.businessTripsceColletion.reset(resp.businessTrips||[]);self.meetsColletion.reset(resp.meets||[]);self.applysColletion.reset(resp.applys||[]);self.workTimesColletion.reset(resp["workTimes"]||[]);self._renderObjView();deferred.resolve()}).fail(function(){deferred.reject()});return deferred.promise()},_getTaskFeed:function(){var self=this;var deferred=new Talent.$.Deferred;UserFeedV2.getFeedById({feed_id:this.id,comment_count:5}).done(function(resp){if(self.isClose)return;self.commentsModel.set(resp["feedComments"]||{});self.tracksModel.set(resp["feedOperations"]||{});self._renderCommentView(resp);self._renderTaskTrackView();deferred.resolve()}).fail(function(){deferred.reject()});return deferred.promise()},_renderRewardUserListView:function(){var principalUser=this.model.get("principalUser");var user={avatar:{big:principalUser.avatar.big,color:principalUser.avatar.Color,hasAvatar:principalUser.avatar.HasAvatar,large:principalUser.avatar.Large,medium:principalUser.avatar.Medium,normal:principalUser.avatar.Normal,original:principalUser.avatar.Original,small:principalUser.avatar.Small},email:principalUser.email,name:principalUser.name,userId:principalUser.userId};this.rewardDetailView=new RewardDetailView({feedId:this.id,feedType:20,user:user});this.reward.show(this.rewardDetailView)},_renderLoadingView:function(){this.loadingView&&this.loadingView.close();this.loadingView=new LoadingView({y:this.height/2});this.ui.taskScoll.append(this.loadingView.render().$el)},_showErrowPage:function(type){var self=this;var content="该"+this.i18n["task_1"]+"不存在";switch(type){case 0:{content="该"+this.i18n["task_1"]+"已被主人删除了~"}break;case-1:{content="该"+this.i18n["task_1"]+"现在是私密状态"}break}this.errorTrackerView=new ErrorLayoutMessageView({content:content,isShowClose:this.settings["isPushScreen"]?true:false});this.listenTo(this.errorTrackerView,"errorLayoutMessageView:close",function(){this.trigger("taskDetailItem:close")});if(this.isClose)return;this.$el.html(this.errorTrackerView.render().el)},_renderAllView:function(){this._renderEvaluationView();this._renderFeedExtraInfoListView();this._rendUnacceptView();this._renderTaskActionview();this._renderInfoView();this._rendBaseInfoView();this._renderPlanShareRangeView()},_renderObjView:function(){this._renderAddDoView();var businessTripsData=this.businessTripsceColletion.toJSON();if(businessTripsData&&businessTripsData.length&&this.settings["isShowTravel"]){this._renderTravelDetailView(businessTripsData)}var meetsData=this.meetsColletion.toJSON();if(meetsData&&meetsData.length&&this.settings["isShowMeeting"]){this._renderMeetDetailView(meetsData)}var taskData=this.tasksCollection.toJSON();if(taskData&&taskData.length&&this.settings["isShowTask"]){this._renderTaskView(taskData)}var shareData=this.experienceColletion.toJSON();if(shareData&&shareData.length&&this.settings["isShowShare"]){this._renderShareView()}var workHourData=this.workTimesColletion.toJSON();if(workHourData&&workHourData.length&&this.settings["isShowWorkTime"]){this._renderWokHourView(workHourData)}var applysData=this.applysColletion.toJSON();if(applysData&&applysData.length){this._renderTaskApplyView()}},_renderTaskApplyView:function(){var isShowAllButton=false;if(this.model.get("applyUser")&&this.model.get("applyUser").userId){isShowAllButton=this.userInfo.Id==this.model.get("applyUser").userId}this.taskApplyDetailView=new TaskApplyDetailView({collection:this.applysColletion,isShowAllButton:isShowAllButton});this.listenTo(this.taskApplyDetailView,"afterApplyDeal",function(){this.render()});this.applyBox.show(this.taskApplyDetailView)},_renderEvaluationView:function(){if(this.model.get("status")!=2)return;var data=this.model.get("evaluateModels")||[];if(!data.length)return;this.evaluationView=new EvaluationView({collection:new Talent.Collection(data),customOptions:this.model.get("evaluateSettingsModel"),evaluationObject:"还没有对"+this.i18n.task_1+"进行评价",isAdd:this.model.get("evaluateable")});this.listenTo(this.evaluationView,"saveEvaluation",function(node,options){this._requestEvaluation(node,options)});this.evaluation.show(this.evaluationView)},_requestEvaluation:function(node,options){var self=this;var evaluateInfos=[];$(options["evaluateInfos"]).each(function(index,item){evaluateInfos.push({evaluateType:item.type,cType:item.cType,value:item.value,name:item.name,goal:item.goal,lvl:item.lvl})});TaskCollection.evaluateTask({objId:this.id,objType:7,evaluateInfo:evaluateInfos,remark:options.remark}).done(function(resp){var evaluateModels=self.model.get("evaluateModels");var resp_user_id=resp.user.UserId;Talent._.each(evaluateModels,function(item){if(item.user.UserId==resp_user_id){item=resp}});self.model.set("evaluateModels",evaluateModels);self.evaluationView&&self.evaluationView.render()}).fail(function(msg){self._showTipDialog(node,msg)})},_renderPlanShareRangeView:function(){var self=this,followers=this.model.get("followers"),newData=this._formatFollowerData(followers),relation=this.model.get("relation");var isEdit=this.model.get("addFollowEnable");this.shareRangeView=new ShareRangeView({collection:new Talent.Collection(newData),isEdit:isEdit,isAdd:isEdit,userSelectOptions:{visibleMode:isEdit}});this.listenTo(self.shareRangeView,"add",function(node,data){self._addShareUser(node,data)});this.listenTo(self.shareRangeView,"deleted",function(node,userId){self._deleteShareUser(node,userId)});this.taskShareUser.show(this.shareRangeView)},_formatFollowerData:function(arr){var newData=[];Talent._.map(arr,function(item){var newItem=null;item.Id=item.userId;item.Name=item.name;item.UserAvatar=item.avatar;newItem={Type:item.type,User:item};newData.push(newItem)});return newData},_rendereQuickView:function(){this.taskDetailQuickView&&this.taskDetailQuickView.close();this.taskDetailQuickView=new TaskDetailQuickView({model:new Talent.Model({applys:this.applysColletion.length?true:false,tasks:this.tasksCollection.length?true:false,workTimes:this.workTimesColletion.length?true:false,meets:this.meetsColletion.length?true:false,businessTrips:this.businessTripsceColletion.length?true:false,experience:this.experienceColletion.length?true:false})});this.listenTo(this.taskDetailQuickView,"areaPostion",function(node,options){this._scrollTo(this.ui[options.ui])});this.$el.append(this.taskDetailQuickView.render().$el)},_deleteShareUser:function(node,userId){var self=this;TaskCollection.deleteFollower({taskId:this.model.get("taskId"),toUserId:userId}).done(function(resp){if(self.isClose)return;var collection=self.shareRangeView.collection,model=null;for(var i=0,len=collection.length;i<len;i++){if(collection.at(i).get("User").Id==userId){model=collection.at(i)}}model&&collection.remove(model)})},_addShareUser:function(node,data){var self=this;TaskCollection.addFollower({task_id:this.model.get("taskId"),followers:data}).done(function(resp){if(self.isClose)return;Talent._.map(resp,function(item){item.avatar=item.avatar;item.type=0;item.name=item.name;item.userId=item.userId});var newData=self._formatFollowerData(resp);self.shareRangeView.collection.add(newData)}).fail(function(msg){if(self.isClose)return;TipInfoView(node,{placement:"top",type:"remind",body:msg,align:"center",container:self.shareRangeView.$el,ico:"warn"})})},_renderFeedExtraInfoListView:function(resp){var data=this.model.get("customizetDatas");if(data&&data.length){this.feedExtraInfoList=new FeedExtraInfoListView({collection:new Talent.Collection(data)});this.taskCustom.show(this.feedExtraInfoList)}else{this.ui.taskCustom.hide()}},_renderAddDoView:function(){var self=this;var relation=this.model.get("relation");if(this.userInfo.UserType==2){return}if(!this.openAdd[relation]||!this.model.get("isAccept")){return}var taskAddDoView=new TaskAddDoView({isShowTask:this.settings["isShowTask"],isShowWorkTime:this.settings["isShowWorkTime"],isShowMeeting:this.settings["isShowMeeting"],isShowTravel:this.settings["isShowTravel"],isShowShare:this.settings["isShowShare"]});this.listenTo(taskAddDoView,"task",function(){this._renderTaskView();this._scrollTo(this.ui.task);this.taskTaskDetailView.triggerIn()});this.listenTo(taskAddDoView,"work_hour",function(){this._renderWokHourView();this._scrollTo(this.ui.workHour);this.taskDetailWorkHourView.triggerIn()});this.listenTo(taskAddDoView,"task_travel",function(){this._renderTravelDetailView();this._scrollTo(this.ui.taskTravel);this.taskTravelDetailView.triggerIn()});this.listenTo(taskAddDoView,"task_meet",function(){this._renderMeetDetailView();this._scrollTo(this.ui.taskMeet);this.taskMeetDetailView.triggerIn()});this.listenTo(taskAddDoView,"task_share",function(){this._renderShareView();this.taskDetailShareView.triggerIn();this._scrollTo(this.ui.share)});this.taskAddDo.show(taskAddDoView)},_renderWokHourView:function(data){var isAccept=this.model.get("isAccept");var relation=this.model.get("relation");var data=data||[];var userType=this.userInfo.UserType;this.taskDetailWorkHourView=new TaskDetailWorkHourView({collection:this.workTimesColletion,id:this.id,isShowCreate:this.openAdd[relation]==true&&isAccept&&userType!==2?true:false,autoCompleteData:[{name:this.model.get("taskName")}]});this.listenTo(this.taskDetailWorkHourView,"countChange",function(type,total){this.changeCounters(type,total)});this.workHour.show(this.taskDetailWorkHourView)},_renderTaskView:function(data){var isAccept=this.model.get("isAccept");var relation=this.model.get("relation");var userType=this.userInfo.UserType;this.taskTaskDetailView=new TaskTaskDetailView({model:this.model,id:this.id,collection:this.tasksCollection,isShowCreate:this.openAdd[relation]==true&&isAccept&&userType!==2?true:false});this.listenTo(this.taskTaskDetailView,"countChange",function(type,total){this.changeCounters(type,total)});this.task.show(this.taskTaskDetailView)},_renderTravelDetailView:function(data){var isAccept=this.model.get("isAccept");var relation=this.model.get("relation");var data=data||[];var userType=this.userInfo.UserType;this.taskTravelDetailView=new TaskTravelDetailView({collection:this.businessTripsceColletion,id:this.id,isShowCreate:this.openAdd[relation]==true&&isAccept&&userType!==2?true:false});this.listenTo(this.taskTravelDetailView,"countChange",function(type,total){this.changeCounters(type,total)});this.taskTravel.show(this.taskTravelDetailView)},_renderMeetDetailView:function(data){var isAccept=this.model.get("isAccept");var relation=this.model.get("relation");var data=data||[];var userType=this.userInfo.UserType;this.taskMeetDetailView=new TaskMeetDetailView({collection:this.meetsColletion,id:this.id,model:this.model,isShowCreate:this.openAdd[relation]==true&&isAccept&&userType!==2?true:false});this.listenTo(this.taskMeetDetailView,"countChange",function(type,total){this.changeCounters(type,total)});this.taskMeet.show(this.taskMeetDetailView)},_renderShareView:function(){var isAccept=this.model.get("isAccept");var relation=this.model.get("relation");var userType=this.userInfo.UserType;this.taskDetailShareView=new TaskDetailShareView({collection:this.experienceColletion,id:this.id,isShowCreate:this.openAdd[relation]==true&&isAccept&&userType!==2?true:false});this.listenTo(this.taskDetailShareView,"countChange",function(type,total){this.changeCounters(type,total)});this.share.show(this.taskDetailShareView)},_renderCommentView:function(resp){var self=this;var commentsData=this.model.get("feedComments")||[];commentsData["feedId"]=this.id;var taskDetailCommentView=new TaskDetailCommentView({model:this.commentsModel,collection:new Talent.Collection(commentsData["comments"]||[]),id:this.id,feedType:resp.feedType,isExternal:this.model.get("isExternal")||false,labelType:this.model.get("labelType"),labelId:this.model.get("labelId"),labelName:this.model.get("labelName")});this.listenTo(taskDetailCommentView,"countChange",function(type,total){this.changeCounters(type,total)});this.comment.show(taskDetailCommentView)},_rendBaseInfoView:function(){this.taskBaseInfoView=new TaskDetailBaseInfoView({model:this.model,id:this.id,container:this.$el,classDialogOptions:{isEdit:false,zIndex:100}});this.listenTo(this.taskBaseInfoView,"changFZR",function(){this.render()});this.listenTo(this.taskBaseInfoView,"addPartner",function(options){if(options.changeLimit){this.render()}this._changeFollowUser(options.users)});this.baseInfo.show(this.taskBaseInfoView)},_changeFollowUser:function(users){var follow=this.model.get("followers");var participators=this.model.get("participators");var data=[];for(var i=0;i<follow.length;i++){var item=follow[i];var res=Talent._.findWhere(participators,{userId:item.userId});if(!res){data.push(item)}}this.model.set("followers",data);var shareData=this._formatFollowerData(data);this.shareRangeView.collection.reset(shareData)},_renderInfoView:function(){this.taskInfoView=new TaskInfoView({model:this.model});this.info.show(this.taskInfoView)},_rendUnacceptView:function(){this.taskUnacceptView=new TaskDetailUnacceptView({model:this.model});this.listenTo(this.taskUnacceptView,"takeInTask",function(){this.render()},this);this.listenTo(this.taskUnacceptView,"transfer",function(){this.render()});this.listenTo(this.taskUnacceptView,"notToJoin",function(){this.render()});this.taskUnaccept.show(this.taskUnacceptView)},_renderTaskActionview:function(){this.taskActionview=new TaskDetailActionview({model:this.model,id:this.id});this.listenTo(this.taskActionview,"deleted",function(node,options){this._requestDeleteTask(node)},this);this.listenTo(this.taskActionview,"exit",function(node,options){this._requestExitTask(node)},this);this.listenTo(this.taskActionview,"changeStatus",function(node,options){this.render()});this.action.show(this.taskActionview)},_renderTaskTrackView:function(){if(!this.tracksModel.get("total"))return;this.taskDetailTrackView=new TaskDetailTrackView({model:this.tracksModel,id:this.id});this.taskTrack.show(this.taskDetailTrackView)},_requestDeleteTask:function(node){var self=this;TaskCollection.taskDelete({task_id:this.model.get("taskId")}).done(function(resp){if(self.isClose)return;self.trigger("deleted",self.model.toJSON());self.render()}).fail(function(msg){if(self.isClose)return;if(self.model.get("isApply")){self._showTipDialog(node,msg)}else{self.render()}})},_requestExitTask:function(){var self=this;TaskCollection.taskDeleteParticipator({task_id:self.model.get("taskId"),to_user_id:self.userInfo.Id}).done(function(){if(self.isClose)return;self.trigger("exit",self.model.toJSON());self.render()}).fail(function(msg){if(self.isClose)return;self._showTipDialog(node,msg)})},_scrollTo:function(node){var self=this,offsetTop=node.offset().top;if(!this.settings["isShowScroll"]){var winHeight=Talent.$(window).height(),top=offsetTop-winHeight/2;$("html,body,.tu-page-container").scrollTop(top)}else{var scrollTop=this.ui.taskScoll.scrollTop(),top=offsetTop-this.ui.taskScoll.offset().top;this.ui.taskScoll.scrollTop(top+scrollTop)}},_showTipDialog:function(node,body,okhideFn){this.infoTipView&&this.infoTipView.destroy();var defaults={placement:"bottom",type:"remind",body:body,trigger:"manual",align:"right",container:this.$el,ico:"warn"};this.infoTipView=new Infotip;this.infoTipView.bindNode(node,defaults);okhideFn&&this.listenTo(this.infoTipView,"hide",function(){okhideFn()});this.infoTipView.show()},onClose:function(){this.isClose=true;Talent.$(".tipsy").hide();Talent.$(window).off("resize.Task-Detail-Layout-View");this.taskBaseInfoView&&this.taskBaseInfoView.close();this.taskInfoView&&this.taskInfoView.close();this.taskDetailQuickView&&this.taskDetailQuickView.close()}});var PullScreenLayoutView=Talent.Layout.extend({defaults:{topBias:0,position:"right",width:820,duration:500,id:"",type:"task",showFullScreenButton:false,status:""},template:JST["pull-screen/push-screen-layout"],className:"pull-screen-container",regions:{detailContainer:"[data-name=pull-screen-content]",loading:"[data-name=pull-screen-load]"},ui:{detailContainer:"[data-name=pull-screen-content]",closed:"[data-name=pull-screen-close]",loading:"[data-name=pull-screen-load]",openScreen:"[data-name=open-full-screen-button]",actionBox:"[data-name=pull-screen-action]"},templateHelpers:function(){return{showFullScreenButton:this.settings["showFullScreenButton"],isShowIfame:this.settings.status=="iframe"?true:false}},events:function(){var events={};events["click "+this.ui.closed]="_closeHandler";return events},initialize:function(options){var self=this;this.settings=Talent._.extend({},this.defaults,options);this.settings.width=this.settings.width;this.height=Talent.$(window).height();this.isOpen=false;this.isCanClosed=true;this.changeUrl=true;this.bias=20;this.$el.on("click",function(event){event.stopPropagation()});Talent.$(document).on("click.Pull-Screen-Region-View",function(event){if(event.button==2){return}if(self.isOpen){self.closed()}});Talent.$(window).on("resize.Pull-Screen-Region-View",function(){self.height=Talent.$(window).height();self.$el.height(self.height);if(self.model.get("type")=="iframe"&&self.iframe){self.iframe&&self.iframe.css("height",self.height)}});this._getRouterData();this._listenGlobalEvent();this.viewModel=new Talent.Model;this._initSet();this.__italentSdk()},onRender:function(){var id=this.model.get("id"),type=this.model.get("type");if(id){this.open()}},onClose:function(){},__italentSdk:function(){var self=this;var eventName__open="TitaQuickScreen_open";var eventName__close="TitaQuickScreen_close";window.iTalentSDK&&window.iTalentSDK.register([{listenEvent:"TitaQuickScreen_open",context:this,cb:function(data){if(data.type=="task"){self.model.set({id:data.id,type:"task"})}else{self.model.set({type:"iframe",id:data.id?data.id:(new Date).getTime(),iframeSrc:data.iframeSrc})}self._idChangeHandler()}}]);window.iTalentSDK&&window.iTalentSDK.register([{listenEvent:eventName__close,context:this,cb:function(data){self.closed()}}])},_initSet:function(){if(this.settings["position"]=="left"){this.$el.css({top:this.settings["topBias"]+"px",left:-(this.settings["width"]+this.bias),width:this.settings["width"],height:this.height-this.settings["topBias"]})}else{this.$el.css({top:this.settings["topBias"],right:-(this.settings["width"]+this.bias),width:this.settings["width"],height:this.height})}},_getRouterData:function(){var self=this;var queryObject=Talent.app.request("history:getQueryObject");var deferred=new Talent.$.Deferred;queryObject.done(function(routerData){self.routerData=routerData||{};var pullScreeId=self.routerData["pullScreeId"]||"";self.routerData["pullScreeId"]=pullScreeId;self.routerData["pullScreenOpen"]=routerData["pullScreenOpen"]||false;self.routerData["pullScreenType"]=routerData["pullScreenType"]||"";if(routerData["pullScreenType"]=="task"){self.model.set("id",pullScreeId,{silent:true});self.model.set("pullScreenOpen",routerData["pullScreenOpen"]);self.model.set("type",routerData["pullScreenType"])}});return deferred},_listenGlobalEvent:function(){var self=this;Talent.app.vent.on("global-pull-screen",function(id,type,model,options){if(!id||id==""){alert("id是必传的")}if(typeof id=="string"&&id=="closed"){if(typeof type=="boolean"&&type==false){self.isCanClosed=false;return}self.isCanClosed=true;self.closed();return}self.changeUrl=true;var id=id||(new Date).getTime();if(type=="task"){var id=id;if(!id||id==""){alert("请给我ivd,不能显示详情页");return}self.viewModel=model||new Talent.Model;self.model.set({id:id,type:type});self._idChangeHandler();return}var options=model;if(options&&typeof options.changeUrl!=="undefined"){self.changeUrl=options.changeUrl}self.model.set({id:id,type:type,view:model});self._idChangeHandler()})},_idChangeHandler:function(){var duration=this.settings["duration"],self=this;var options=this.settings;options["close"]=true;this.trigger("closed",{duration:this.settings.duration,width:this.settings.width});this.$el.stop().animate(this._dealAnimationData(options),options.duration,function(){self._fullScreenUrl();self.open()})},open:function(){var self=this;var id=this.model.get("id");if(!id)return;if(this.changeUrl){Context.changeHash({pullScreeId:id,pullScreenOpen:true,pullScreenType:this.model.get("type")},"add",false)}this.isOpen=true;this.trigger("open",{duration:this.settings.duration,width:this.settings.width});this._pushAnimate().done(function(){self._fullScreenUrl();self._renderViewByType()})},closed:function(event){if(!this.isCanClosed){var modelId=this.model.get("id");if(modelId&&modelId!=""){Talent.app.vent.trigger("global-pull-screen:closed:"+modelId)}return}var self=this;var id=this.model.get("id")||"";if(id&&id!=""){Talent.app.vent.trigger("global-pull-screen:closed:"+id)}if(!this.isCanClosed)return;event&&event.stopPropagation();this.model.set("id","");this._closeAnimate()},_closeAnimate:function(){var options=this.settings,self=this;options["close"]=true;this._closeView();if(this.changeUrl){Context.changeHash(["pullScreeId","pullScreenOpen","pullScreenType"],"deleted",false)}this.isOpen=false;this.trigger("closed",{duration:this.settings.duration,width:this.settings.width});this.$el.stop().animate(this._dealAnimationData(options),options.duration,function(){self.iframe&&self.iframe.hide()})},_closeView:function(){var type=this.model.get("type");if(type=="task"){this.taskDetailView&&this.taskDetailView.close()}else{this.detailContainer.close()}},_renderViewByType:function(){var type=this.model.get("type");this.ui.actionBox.show();if(this.settings.status=="iframe"){this._renderIframe();return}if(type=="iframe"){this._renderIframe();return}if(type=="task"){this.iframe&&this.iframe.remove();this.iframe=null;this._renderTaskDetailView();return}var containerView=this.model.get("view");if(!containerView)return;this.containerView=containerView;this.loadingView&&this.loadingView.close();this.detailContainer.show(this.containerView)},_closeHandler:function(event){this.closed()},_renderLoadingView:function(){this.loadingView=new LoadingView({y:this.height/2});this.loading.show(this.loadingView)},_pushAnimate:function(){this._renderLoadingView();var self=this;var options=this.settings;options["close"]=false;var deferred=new Talent.$.Deferred;this.$el.stop().animate(this._dealAnimationData(options),options.duration,function(){deferred.resolve()});return deferred},_fullScreenUrl:function(){var type=this.model.get("type");var url="";if(type=="task"){url="#more/taskinfo?id="+this.model.get("id")}if(url!=""&&this.settings["showFullScreenButton"]){this.ui.openScreen.attr("href",url).show()}else{this.ui.openScreen.hide()}},_renderTaskDetailView:function(){this.taskDetailView=new TaskDetailView({id:this.model.get("id"),topBias:this.settings["topBias"],model:this.viewModel||new Talent.Model});this.listenTo(this.taskDetailView,"getDataAfter",function(){this.loadingView&&this.loadingView.close()});this.detailContainer.show(this.taskDetailView)},_buildFrame:function(){var iframe=document.createElement("iframe");iframe.id="Tita-Quick-Screen-Iframe";iframe.scrolling="auto";iframe.src="";iframe.width="100%";iframe.height=this.height;iframe.setAttribute("frameborder",0);iframe.setAttribute("border",0);iframe.setAttribute("marginheight",0);iframe.setAttribute("marginwidth",0);this.iframe=$(iframe);this.ui.detailContainer.html(this.iframe)},_renderIframe:function(){if(!this.iframe){this._buildFrame()}var self=this,id=this.model.get("id"),userInfo=Context.getUserInfo();var host=Context.getGlobal("webPath");var src="//www"+"."+host+"/"+userInfo["Id"]+"/ITalentHome?v="+(new Date).getTime()+"#more/taskinfo?Id="+id;if(this.model.get("iframeSrc")){src=this.model.get("iframeSrc")}var iframe=this.iframe[0];if(iframe.attachEvent){iframe.attachEvent("onload",function(){self.loadingView&&self.loadingView.close()})}else{iframe.onload=function(){self.loadingView&&self.loadingView.close()}}iframe.src=src;iframe.style.display="block"},_dealAnimationData:function(options){var obj={};var endPosition;if(options.position==="left"||options.position==="right"){endPosition=options.close?"-"+(options.width+this.bias)+"px":"0px"}else{endPosition=options.close?"-"+(options.height+this.bias)+"px":"0px"}obj[options.position]=endPosition;return obj},onClose:function(){Talent.$(document).off("click.Pull-Screen-Region-View");Talent.$(window).off("resize.Pull-Screen-Region-View")}});function PullScreenView(options){if(!PullScreenLayoutView.instance){PullScreenLayoutView.instance=new PullScreenLayoutView(options)}return PullScreenLayoutView.instance}var MembershipView=Talent.Layout.extend({defaults:{showShare:true,type:0,changeShareRoute:null,changeGroupRoute:null,requestShare:function(){var deferred=new Deferred;deferred.resolve();deferred.reject();return deferred}},template:jst["membership/membership-tab-component"],className:"tu-por",regions:{tabRegion:{selector:"#membership_tab"}},ui:{arrow:".membership_arrow_icon",arrowBtn:".membership_arrow",tab:".membership_tab_title",tabLi:".membership_tab_title li",thumbItem:".thumb-iem"},events:function(){var events={};events["click "+this.ui.arrowBtn]="afterArrowClick";events["mouseenter "+this.ui.arrowBtn]="showTip";events["mouseleave "+this.ui.arrowBtn]="hideTip";events["mouseenter "+this.ui.tabLi]="showTip";events["mouseleave "+this.ui.tabLi]="hideTip";events["click "+this.ui.tabLi]="afterTabClick";events["click "+this.ui.thumbItem]="_stopPropagation";return events},modelEvents:{"change:mode":"afterViewModeChange","change:viewName":"afterViewNameChange"},initialize:function(options){var self=this;this.userInfo=Context.getUserInfo();this.setting=Talent._.extend({},this.defaults,options);this.storage=Context.localStorage();if(!this.storage.hasProperty("rightBarTip_"+this.userInfo.Id)){this.storage.set("rightBarTip_"+this.userInfo.Id,true)}var queryObject=Talent.app.request("history:getQueryObject");var deferred=new Talent.$.Deferred;queryObject.done(function(routerData){self.routerData=routerData;var initData={mode:"narrow",viewName:"membership",showBottom:false,showTab:false};var data=Talent.$.extend({},initData,options);if(typeof self.routerData["viewName"]!=="undefined"&&self.routerData["viewName"]){data["viewName"]=self.routerData["viewName"]}self.model=new Talent.Model(data);self.userInfo["MidAvatar"]=self.userInfo.UserAvatar.Medium;if(!self.options.model)return;self.listenTo(self.options.model,"change:viewName",function(){var oViewName=self.options.model.get("viewName");self.model.set("viewName",oViewName);self.$el.find(".membership_tab_title li").removeClass("active");self.$el.find("li[data-name="+oViewName+"]").addClass("active")})});return deferred},onRender:function(){var self=this;Talent.app.vent.off("membership:show:wide");Talent.app.vent.on("membership:show:wide",function(){self.model.set("mode","wide")});this.$el.off("click.membership");this.$el.on("click.membership",function(ev){if(self.model.get("mode")=="narrow"){self.afterArrowClick(ev)}});if(this.model.get("showTab")==false){this.$el.find(".membership_tab_top").remove()}this._removeRightBarTip();this.afterViewModeChange(true)},_removeRightBarTip:function(){if(!this.storage.get("rightBarTip_"+this.userInfo.Id)){this.$el.find(".rightBar__tip").remove()}},_stopPropagation:function(ev){ev.stopPropagation()},showTip:function(ev){var mode=this.model.get("mode"),tipBody="",placement="",node=Talent.$(ev.currentTarget),dataBody=node.data("body");if(dataBody){tipBody=dataBody;placement="bottom";if(mode=="wide")return}else{placement="left";tipBody=mode=="wide"?"收起隔级查看":"展开隔级查看"}this.infoTip=new TipInfoView(node,{type:"default",body:tipBody,container:"body",align:"center",placement:placement})},hideTip:function(){this.infoTip&&this.infoTip.destroy()},getActiveId:function(){var self=this;var deferred=new Talent.$.Deferred;var queryObject=Talent.app.request("history:getQueryObject");queryObject.done(function(routerData){self.activeId=routerData.to_user_id?routerData.to_user_id:Context.getUserInfo().Id;OrgCollection.getSuperior({id:self.activeId}).done(function(resp){self.activeSuperiorId=parseInt(resp);deferred.resolve(self.activeId)}).fail(function(msg){deferred.resolve(self.activeId)})});return deferred.promise()},renderMembershipView:function(){if(this.model.get("mode")=="wide"){this.renderMembershipTabView()}else{this.renderMembershipTabThumbView()}},renderMembershipTabThumbView:function(){var self=this;this.getActiveId().done(function(id){var loginUserId=Context.getUserInfo().Id;var request=OrgCollection.getSubordinateData({id:loginUserId,type:self.setting.type}).done(function(resp){var activeData=resp[0];var collectionData=resp;collectionData=collectionData.length==1?[]:collectionData;this.subordinate=collectionData;var membershipTabThumbCompositeView=new MembershipTabThumbCompositeView({collection:new Talent.Collection(collectionData),model:new Talent.Model({activeId:id,viewName:"membership",mode:self.model.get("mode")})});membershipTabThumbCompositeView.on("change:mode",function(mode){self.model.set("mode",mode)});self.tabRegion&&self.tabRegion.show(membershipTabThumbCompositeView);self.bindEvents(membershipTabThumbCompositeView)})})},renderMembershipTabView:function(){var self=this;var userId=Context.getUserInfo().Id;this.getActiveId().done(function(id){var middleId=self.activeSuperiorId?self.activeSuperiorId:id;if(!self.membershipTabLayout){self.membershipTabLayout=new MembershipTabLayout({model:new Talent.Model({middleId:middleId,direction:"down",activeId:id,profileId:id,type:self.setting.type})});self.tabRegion.show(self.membershipTabLayout);self.bindEvents(self.membershipTabLayout)}else{self.membershipTabLayout.model.set({middleId:middleId,direction:"down",activeId:id,profileId:id,type:self.setting.type});self.tabRegion.show(self.membershipTabLayout)}})},renderShareView:function(){var self=this;this.getActiveId().done(function(id){this.setting.requestShare().done(function(){var collectionData=resp;self.afterRenderShareView(id,collectionData)})})},afterRenderShareView:function(id,collectionData){collectionData=collectionData&&collectionData.length?collectionData:[];var shareView=new MembershipTabThumbCompositeView({collection:new Talent.Collection(collectionData),model:new Talent.Model({activeId:id,viewName:"share",mode:this.model.get("mode")})});var mode=this.model.get("mode");this.tabRegion.show(shareView);this.bindEvents(shareView);this.$el.find(".membership_empty_tips").toggleClass("empty__magin",mode=="wide")},renderNarrowViewByData:function(){var self=this;this.ui.arrow.removeClass("membership_arrow_right").addClass("membership_arrow_left");this.$el.find(".membership_right").addClass("short");this.$el.find(".membership_tab_title").fadeIn("fast");this.getActiveId().done(function(id){this.setting.requestShare().done(function(resp){var shareCollectionData=resp||[];OrgCollection.getSubordinateData({id:id}).done(function(result){var activeData=result[0]&&result[0].subordinate;var membershipCollectionData=result;var viewName="membership";var collectionData=!membershipCollectionData.length||membershipCollectionData.length==1?[]:membershipCollectionData;if(membershipCollectionData.length==1||membershipCollectionData.length==0){if(shareCollectionData.length){viewName="share";collectionData=shareCollectionData}}var compositeView=new MembershipTabThumbCompositeView({collection:new Talent.Collection(collectionData),model:new Talent.Model({activeId:id,viewName:viewName})});self.tabRegion.show(compositeView);self.bindEvents(compositeView);self.model.set("viewName",viewName,{silent:true});if(viewName=="share"){self.ui.tab.find(".active").removeClass("active");self.ui.tab.find("li[data-name=share]").addClass("active")}else{self.ui.tab.find(".active").removeClass("active");self.ui.tab.find("li[data-name=membership]").addClass("active")}})})})},afterArrowClick:function(ev){ev.stopPropagation();this.storage.set("rightBarTip_"+this.userInfo.Id,false);this._removeRightBarTip();var self=this;var mode=this.model.get("mode")=="wide"?"narrow":"wide";

this.model.set("mode",mode)},afterViewModeChange:function(flag){this.tabRegion.close();var self=this;var mode=this.model.get("mode");var showTab=this.model.get("showTab");if(mode=="wide"){this.ui.arrow.removeClass("membership_arrow_left").addClass("membership_arrow_right");this.$el.find(".membership_right").removeClass("short");this.$el.find(".membership_tab_title").removeClass("short").fadeIn("fast");this.$el.find(".membership_thumb_img").removeClass("radius_img30").addClass("radius_img50");this.$el.find(".membership_right").animate({width:278},300,function(){self.afterViewNameChange()})}else{this.ui.arrow.removeClass("membership_arrow_right").addClass("membership_arrow_left");this.$el.find(".membership_right").addClass("short");this.$el.find(".membership_tab_title").fadeIn("fast");this.$el.find(".membership_right").animate({width:65},300,function(){self.afterViewNameChange()})}},afterTabClick:function(ev){ev.stopPropagation();var target=Talent.$(ev.currentTarget);if(target.hasClass("active"))return;var name=target.attr("data-name");this.model.set("viewName",name);this.ui.tab.find(".active").removeClass("active");target.addClass("active");var locationHash=decodeURIComponent(location.hash);Talent.app.execute("history:navigate",locationHash,false)},afterViewNameChange:function(){if(this.model.get("viewName")=="membership"){this.renderMembershipView()}else{this.renderShareView()}this.$el.find(".membership_tab_title li").removeClass("active");this.$el.find("li[data-name="+this.model.get("viewName")+"]").addClass("active")},changeRoute:function(id){var self=this;var viewName=this.model.get("viewName");if(viewName=="share"){this.changeShareRoute(id);return}this.changeGroupRoute(id)},changeShareRoute:function(id){if(typeof this.setting.changeShareRoute==="function"){this.setting.changeShareRoute(id);return}var locationHash=decodeURIComponent(location.hash);var to_user_id="to_user_id="+id;if(locationHash.indexOf("to_user_id")!=-1){locationHash=locationHash.replace(/to_user_id=\w+/,to_user_id)}else{locationHash+=locationHash.indexOf("?")<0?"?member-type=share&to_user_id="+id:"&member-type=share&to_user_id="+id}if(locationHash.indexOf("type")!=-1){locationHash=locationHash.replace(/type=\w+/,"type=personal")}Talent.app.execute("history:navigate",locationHash,true)},changeGroupRoute:function(id){if(typeof this.setting.changeGroupRoute==="function"){this.setting.changeGroupRoute(id);return}var locationHash=decodeURIComponent(location.hash);var to_user_id="to_user_id="+id;if(locationHash.indexOf("to_user_id")!=-1){locationHash=locationHash.replace(/to_user_id=\w+/,to_user_id)}else{locationHash+=locationHash.indexOf("?")<0?"?to_user_id="+id:"&to_user_id="+id}Talent.app.execute("history:navigate",locationHash,true)},routerDataChange:function(){if(this.ui.arrow.hasClass("membership_arrow_left")){this.renderMembershipTabThumbView()}},bindEvents:function(view){var self=this;view.off("detailIdChanged");view.on("detailIdChanged",function(id){self.changeRoute(id)})},templateHelpers:function(){var showDailyShare=Context.getGlobal("DailyAdvancedSetting").DailyFunctionSetting.DailyShare,TaskPlanShare=Context.getGlobal("TaskAdvancedSetting").TaskPlanSetting.TaskPlanShare,routerName=this.routerData["iTalentNavCode"];return{showShare:this.setting.showShare,TaskPlanShare:TaskPlanShare,showDailyShare:showDailyShare,routerName:routerName}},onClose:function(){Talent.app.vent.off("membership:show:wide");this.$el.off("click.membership")}});var MembershipCompositeView=Talent.CompositeView.extend({template:jst["membership/membership-tab-composite"],tagName:"ul",initialize:function(options){this.options=options||{};this.itemViewOptions={direction:this.options.direction,middleId:this.options.middleId,activeId:this.options.activeId,hasSuperior:this.model.get("Id")=="0"?false:true};this.dealData();this.collection=this.model.subordinate},onRender:function(){if(this.model.get("level")==1){this.$el.addClass("first_ul")}if(this.model.get("level")==2){this.$el.addClass("second_ul")}if(this.model.get("Id")==this.options.activeId){this.$el.find("div:first").addClass("active")}if(!this.options.hasSuperior){if(this.model.get("subordinateCount")=="0"){this.$el.find(".membership_line").addClass("membership_line_last");this.$el.find(".membership_line").css({width:0})}}else{if(this.model.get("subordinateCount")=="0"&&this.model.get("level")!="3"){this.$el.find(".membership_line").addClass("membership_line_last")}}},appendHtml:function(view,itemView){view.$("li:first").find(".membership_subordinate_container").append(itemView.el)},dealData:function(){var nameLength=12;if(this.model.get("level")==1||this.model.get("level")==2){nameLength=6}this.model.set("subName",this.subString(this.model.get("Name"),nameLength,true))},subString:function(str,len,hasDot){var newLength=0;var newStr="";var chineseRegex=/[^\x00-\xff]/g;var singleChar="";var str=str||"";var strLength=str.replace(chineseRegex,"**").length;for(var i=0;i<strLength;i++){singleChar=str.charAt(i).toString();if(singleChar.match(chineseRegex)!=null){newLength+=2}else{newLength++}if(newLength>len){break}newStr+=singleChar}if(hasDot&&strLength>len){newStr+="..."}return newStr}});var MembershipTabCompositeView=Talent.CollectionView.extend({itemView:MembershipCompositeView,events:{"click .membreship_subordinate_btn":"changeActiveId","click .membership_item_short":"changeActiveId","click .membership_item_long":"changeProfileId"},initialize:function(options){var options=options||{};this.itemViewOptions=this.model.toJSON()},changeActiveId:function(ev){var self=this;var node=Talent.$(ev.target).parents("li");var id=node.attr("data-id");var level=node.attr("level");if(level!=3){var request=OrgCollection.getSuperior({id:id});var direction=level=="1"?"1-3":"2-3";request.done(function(resp){self.trigger("changeActiveId",{middleId:resp,direction:direction,activeId:id})})}else{this.trigger("changeActiveId",{middleId:id,direction:"3-2",activeId:id})}ev.stopPropagation()},changeProfileId:function(ev){var self=this;var node=Talent.$(ev.target).parents("li");var id=node.attr("data-id");var level=node.attr("");this.trigger("changeProfileId",{profileId:id,activeId:id,middleId:this.model.get("middleId")})},onRender:function(){this.$el.find(".second_ul .membership_subordinate_container>ul:last").find(".membership_line").addClass("membership_line_last");if(!this.options.hasSubordinate){var userId=Context.getUserInfo().Id,setSubordinateUrl="/u/"+userId+"/Home#set?page_id=plan";var text='<div class="tu-ft_m2" style="margin-top:120px;"><div>在这里您可以查看下属工作</div><div>快去<a href="'+setSubordinateUrl+'" target="_blank">&nbsp;添加下属&nbsp;</a>吧！</div></div>';this.$el.append(text)}},onShow:function(){this.trigger("allItemShow")}});var regionType=Talent.Region.extend({show:function(view){var self=this;this.ensureEl();var isViewClosed=view.isClosed||_.isUndefined(view.$el);var isDifferentView=view!==this.currentView;if(isDifferentView){this.close()}view.render();if(isDifferentView||isViewClosed){this.open(view).done(function(){self.currentView=view;Marionette.triggerMethod.call(self,"show",view);Marionette.triggerMethod.call(view,"show")})}else{this.currentView=view;Marionette.triggerMethod.call(this,"show",view);Marionette.triggerMethod.call(view,"show")}},open:function(view){var deferred=new $.Deferred;this.$el.empty().append(view.el);addAnimate(view,deferred);return deferred.promise()}});var MembershipTabLayout=Talent.Layout.extend({template:jst["membership/membership-tab-layout"],className:"membership_tab_container",regions:{tab:{selector:".membership_tab_staff_container",regionType:regionType}},ui:{tab:".membership_tab_staff_container",backContainer:".membership_back",backBtn:".membership_back_btn"},events:{"click .membership_back_btn":"showTopStaffView"},modelEvents:{"change:middleId":"renderTabView","change:profileId":"renderProfileView","change:activeId":"renderActive"},initialize:function(options){},onRender:function(){},getTabData:function(){var deferred=new $.Deferred;var self=this;var request=OrgCollection.getDataType({id:this.model.get("middleId"),activeId:this.model.get("activeId"),type:this.model.get("type")}).done(function(resp,rel){deferred.resolve(resp,rel)});return deferred.promise()},renderTabView:function(top){var self=this;var membershipTabModel=Talent.Model.extend({initialize:function(){var subordinate=this.get("subordinate");if(subordinate){this.subordinate=new membershipTabCollection(subordinate);this.unset("subordinate")}}});var membershipTabCollection=Talent.Collection.extend({model:membershipTabModel});this.getTabData().done(function(resp,rel){if(!resp){var membershipTabLimitsView=new MembershipTabLimitsView;self.renderTabBottomStaff(membershipTabLimitsView);self.updateDimension();return}var userId=Context.getUserInfo().Id;var hasSubordinate=rel[userId]&&rel[userId].subordinateCount;if(resp[0].Id==0&&resp[0].subordinate[0].Id==0){self.ui.backBtn.slideUp("slow");self.ui.tab.addClass("membership_top_staff")}else{self.ui.backBtn.slideDown("slow");self.ui.tab.removeClass("membership_top_staff")}self.membershipTabCompositeView=new MembershipTabCompositeView({collection:new membershipTabCollection(resp),model:self.model,hasSubordinate:hasSubordinate});self.renderTabBottomStaff(self.membershipTabCompositeView);self.bindEvents(self.membershipTabCompositeView)})},renderTabBottomStaff:function(membershipTabCompositeView){var self=this;self.tab.show(membershipTabCompositeView);self.topContainer=false},bindEvents:function(view){var self=this;view.on("changeActiveId",function(data){self.model.set(data)});view.on("changeProfileId",function(data){self.model.set(data)});view.on("allItemShow",function(data){self.afterTabAllRender()})},afterTabAllRender:function(){this.updateDimension();var self=this;var resizeDelay=Talent._.debounce(function(){self.updateDimension()},400);$(window).off("resize.membership_page");$(window).on("resize.membership_page",resizeDelay)},renderProfileView:function(){var id=this.model.get("profileId");this.trigger("detailIdChanged",id)},renderActive:function(){var id=this.model.get("activeId");var item=this.ui.tab.find('[data-id="'+id+'"]').find("div:first");if(item.hasClass("active")){return}else{this.ui.tab.find(".active").removeClass("active");item.addClass("active")}},onShow:function(options){this.renderTabView()},showTopStaffView:function(){var userId=Context.getUserInfo().Id;this.model.set({middleId:userId,direction:"2-3"})},getIsMobile:function(){var userAgentInfo=navigator.userAgent;var agents=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod");var flag=true;for(var v=0;v<agents.length;v++){if(userAgentInfo.indexOf(agents[v])>0){flag=false;break}}return flag},updateDimension:function(){var headH=Talent.$("[data-name=header-region]").outerHeight();var containerHeight=Talent.$(window).height()-headH;var listHeight=containerHeight-11-Talent.$(".membership_tab_top").outerHeight()-Talent.$(".membership_back").outerHeight();var scrollNode=this.$el.find("#membership_scroll_container");scrollNode.height(listHeight);var isMobile=this.getIsMobile();if(!isMobile){this.tabScroll=new iScroll("membership_scroll_container",{hScrollbar:false,scrollbarClass:"myScrollbar"})}else{scrollNode.scrollable({setStyle:true})}}});function animate32(level1Init,level1End,level2Init,level2End,el,next){el.level2.css(level2Init);return[function(){el.level1.css(level1Init).animate(level1End,200,next)},function(){el.level2.animate(level2End,300,next)}]}function animate23(level1Init,level1End,level2Init,level2End,el,next){el.level2.css(level2Init);return[function(){el.level1.hide().toggle("slow",next)},function(){el.level2.animate(level2End,200,next)}]}function animateDefault(level1Init,level1End,level2Init,level2End,el,next){if(el.level1.parents("li").attr("data-id")=="0"){el.level2.css(level2Init);return[function(){el.level1.hide().toggle("slow",next)},function(){el.level2.animate(level2End,200,next)}]}else{el.level2.hide();return[function(){el.level1.hide().toggle("slow",next)},function(){el.level2.hide().toggle("slow",next)}]}}function addAnimate(view,deferred){var direction=view.model.get("direction");var el=findEle(view);el.line.hide();el.level3.hide();var animateList=[];var lastAnimateList=[function(){el.level3.toggle("slow",next)},function(){el.line.toggle("slow",next)},function(){deferred.resolve()}];var level1Init={"margin-left":10,"margin-top":10};var level1End={"margin-left":-5,"margin-top":0};if(direction=="3-2"){var level2Init={"margin-left":10,width:200,height:80,"margin-top":10};var level2End={width:el.level2.width(),height:el.level2.height(),"margin-left":0,"margin-top":0}}else{var level2Init={"margin-left":-20};var level2End={"margin-left":0}}var next=function(){view.$el.dequeue("slideList")};switch(direction){case"3-2":animateList=animate32(level1Init,level1End,level2Init,level2End,el,next);break;case"2-3":animateList=animate23(level1Init,level1End,level2Init,level2End,el,next);break;default:animateList=animateDefault(level1Init,level1End,level2Init,level2End,el,next);break}if(el.level1.parents("li").attr("data-id")=="0"){animateList=animateList.slice(1,animateList.length)}if(el.level1.parents("li").attr("data-id")=="0"&&view.$el.find(".second_ul li:first").attr("data-id")==0){el.level2.css(level2End);animateList=animateList.slice(1,animateList.length)}animateList=animateList.concat(lastAnimateList);view.$el.queue("slideList",animateList);next()}function findEle(view){var level2=view.$el.find(".second_ul>li>div:first");return{level1:view.$el.find(".first_ul>li>div:first"),level2:level2,level3:level2.parent().find(".membership_subordinate_container"),line:view.$el.find(".membership_line")}}function slideDown(el,time,next){var $el=el;var height=$el.attr("init-height");$el.attr("init-height",height);$el.css({height:height}).show("slow").slideDown("slow",next)}function slideUp(el,time,next){var $el=el;var height=$el.height();$el.attr("init-height",height);$el.animate({height:0},time,function(){$el.hide();next()})}var MembershipTabLimitsView=Talent.ItemView.extend({template:jst["membership/membership-tip-limits"],tipTemplate:jst["membership/membership-tab-limits-tip"],className:"membership_none_limited",ui:{askForBtn:"a[data-type=askForButton]",successCont:".membership_askfor_success",askForCont:".membership_askfor",helpBtn:".gohelp a"},events:function(){var events={};events["click "+this.ui.askForBtn]="askForOpen";events["click "+this.ui.helpBtn]="showHelp";return events},templateHelpers:function(){var i18n=this.i18n;return{i18n:i18n}},initialize:function(){var self=this;this.i18n=Context.getI18n();Talent.$(document).off("click.Membership-Tab-Limits-Tip:ShowHlep");Talent.$(document).on("click.Membership-Tab-Limits-Tip:ShowHlep",function(){self.helpDialog&&self.helpDialog.hide()})},onClose:function(){Talent.$(document).off("click.Membership-Tab-Limits-Tip:ShowHlep")},askForOpen:function(){var self=this;OrgCollection.getOpenUserOrg({}).done(function(resp){if(resp){self.ui.askForCont.hide();self.ui.successCont.show()}})},showHelp:function(events){events.stopPropagation();this.helpDialog=new Tdialog({sure:false,cancel:true,cancelText:"关闭",type:1});this.helpDialog.render();Talent.$("body").append(this.helpDialog.$el);var i18n=this.i18n;var html=this.tipTemplate({imgUrl:Context.getStaticUrl("images/member-ship-limits-tip.jpg"),i18n:i18n});this.helpDialog.show(this.ui.helpBtn,html,{pos:"bottomCenter",arrow:false})}});var MembershipThumbItemView=Talent.ItemView.extend({template:jst["membership/membership-tab-thumb-item"],tagName:"li",className:"tu-por thumb-iem1",initialize:function(options){this.model.set("mode",options.mode)},onRender:function(){this.$el.attr("data-id",this.model.get("Id"));this.$el.find("[data-body]").infotip({type:"default",container:"body",placement:"left"});var type=this.model.get("Type")?this.model.get("Type"):0;if(type){this.$el.addClass("dotted_radius_parent")}}});var MembershipEmptyView=Talent.ItemView.extend({template:Talent._.template('<div class="membership_empty_tips"><%= text  %></div>'),initialize:function(options){var options=options||{};this.templateHelpers=options}});var MembershipTabThumbCompositeView=Talent.CompositeView.extend({className:"membership_thumb_container",template:jst["membership/membership-tab-thumb-composite"],itemView:MembershipThumbItemView,itemViewContainer:".membership_thumb_container",emptyView:MembershipEmptyView,ui:{emptyContent:"[data-name=empty-content]"},events:{"click .membership_thumb_img":"changeActiveId","click .membership_fold":"changeMode"},initialize:function(){var mode=this.model.get("mode");var userId=Context.getUserInfo().Id,setSubordinateUrl="/u/"+userId+"/Home#set?page_id=plan";this.emptyContent=this.model.get("viewName")=="membership"?'<div class="tu-mb-20">可<br/>查<br/>看<br/>下<br/>属<br/>工<br/>作<br/><br/><a href="'+setSubordinateUrl+'" target="_blank">马<br/>上<br/>添<br/>加</a></div>':"<div>可<br/>查<br/>看<br/>他<br/>人<br/>共<br/>享<br/>的<br/>工<br/>作</div>";if(mode=="wide"){this.emptyContent=this.model.get("viewName")=="membership"?'<div class="tu-mb-20">可查看下属工作，<a href="'+setSubordinateUrl+'" target="_blank">马上添加</a></div>':"<div>可查看他人共享的工作</div>"}if(this.collection.models.length==0){this.itemViewOptions={text:this.emptyContent}}else{this.itemViewOptions={mode:this.model.get("mode")}}},onAfterItemAdded:function(itemView){var id=parseInt(this.model.get("activeId"));if(id==parseInt(itemView.model.get("Id"))||id==parseInt(itemView.model.get("id"))){itemView.$el.find(".membership_thumb_img").addClass("active")}},changeMode:function(){this.trigger("change:mode","wide")},changeActiveId:function(ev){ev.stopPropagation();var node=Talent.$(ev.currentTarget);var id=node.parents("li").attr("data-id");this.$el.find(".membership_thumb_img").removeClass("active");node.addClass("active");this.trigger("detailIdChanged",id)},onRender:function(){if(this.model.get("viewName")=="share"){this.$el.addClass("membership_share_container")}if(this.model.get("viewName")=="membership"){this.$el.find("li").first().after('<div class="membership_fold_container"><div class="membership_fold"><span class="membership_fold_arrow"></span>展开</div></div>')}},onShow:function(){this.updateDimension();var self=this;var resizeDelay=Talent._.debounce(function(){self.updateDimension()},400);$(window).off("resize.membership_page");$(window).on("resize.membership_page",resizeDelay)},updateDimension:function(){var headH=Talent.$("[data-name=header-region]").outerHeight();var containerHeight=Talent.$(window).height()-headH;var listHeight=containerHeight-1-Talent.$(".membership_tab_top").outerHeight()-Talent.$(".membership_bottom").outerHeight();var scrollNode=this.$el.find("#membership_scroll_container");scrollNode.height(listHeight);var isMobile=this.getIsMobile();if(!isMobile){this.tabScroll=new iScroll("membership_scroll_container",{hScrollbar:false,scrollbarClass:"myScrollbar"})}else{scrollNode.scrollable({setStyle:true})}},getIsMobile:function(){var userAgentInfo=navigator.userAgent;var agents=new Array("Android","iPhone","SymbianOS","Windows Phone","iPad","iPod");var flag=true;for(var v=0;v<agents.length;v++){if(userAgentInfo.indexOf(agents[v])>0){flag=false;break}}return flag}});var RewardDetailUserListItemView=Talent.ItemView.extend({template:jst["reward/reward-detail-userlist-item"],tagName:"span",className:"avatar-item",initialize:function(){this.$el.attr({"data-tip":"infotip","data-body":this.model.get("orderRecord"),container:this.$el})}});var RewardDetailUserListView=Talent.CompositeView.extend({template:jst["reward/reward-detail-userlist"],itemView:RewardDetailUserListItemView,itemViewContainer:"div[data-name=user-list]",className:"userlist-box",templateHelpers:function(){return{beyond:this.beyond,total:this.allData.length}},ui:{more:"[data-name=more]",userListBox:"div[data-name=user-list]"},events:function(){var events={};events["click "+this.ui.more]="_moreHandler";return events},initialize:function(){this.allData=this.collection.toJSON();this.beyond=false;this.moreNum=30;if(this.allData.length>this.moreNum){this.collection.reset(this.allData.slice(0,this.moreNum));this.beyond=true}},onShow:function(){$('[data-tip="infotip"]').infotip({delay:{show:100,hide:200},container:this.$el})},appendHtml:function(collectionView,itemView,index){if(this.beyond){this.ui.more.before(itemView.el)}else{this.ui.userListBox.append(itemView.el)}},_moreHandler:function(e){var e=Talent.$(e.currentTarget);this.collection.reset(this.allData);e.hide()}});var RewardDetailView=Talent.ItemView.extend({defatuls:{feedId:"",feedType:"",user:{email:"",name:"",userId:"",avatar:""}},className:"dangshang-userlist",template:_.template(""),templateHelpers:function(){return{}},ui:{},events:function(){var events={};return events},initialize:function(){this.userInfo=Talent.Context.getUserInfo();this.settings=Talent._.extend({},this.defaults,this.options)},onRender:function(){var header=Context.getGlobal("Header")||[];var isOpenReward=Talent._.findWhere(header,{Code:"950"})?true:false;if(!isOpenReward){this.$el.html("");return}this._getDetailData()},onShow:function(){$('[data-tip="infotip"]').infotip({delay:{show:100,hide:200},container:this.$el})},_getObjType:function(feedType){return{1:10,5:8,7:32,20:7,80:26}[feedType]||10},_getDetailData:function(){var self=this;WxpayCollection.getDaShangDetail({objId:this.settings.feedId,objType:this._getObjType(this.settings.feedType)}).done(function(resp){var userList=resp&&resp.orderRecords||[];if(!userList.length)return;self.rewardDetailUserListView&&self.rewardDetailUserListView.close();self.rewardDetailUserListView=new RewardDetailUserListView({collection:new Talent.Collection(userList),model:new Talent.Model(resp)});self.$el.append(self.rewardDetailUserListView.render().$el);self.rewardDetailUserListView.onShow()})}});var NewRichEditor=Talent.ItemView.extend({defaults:{menus:["bold","forecolor","img","quote","fontfamily","fontsize","|","unorderlist","orderlist","alignleft","aligncenter","alignright","|","link","unlink","eraser","table","undo","redo"],menusUI:{"default":{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="wangeditor-menu-img-command"></i></a>',selected:".selected"},bold:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-bold"></i></a>',selected:".selected"},underline:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-underline"></i></a>',selected:".selected"},italic:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-italic"></i></a>',selected:".selected"},forecolor:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-font-color"></i></a>',selected:".selected"},bgcolor:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-backgroundcolor"></i></a>',selected:".selected"},strikethrough:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-strickout"></i></a>',selected:".selected"},eraser:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-clear-style"></i></a>',selected:".selected"},quote:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-quote"></i></a>',selected:".selected"},fontfamily:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-font"></i></a>',selected:".selected"},fontsize:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-font-size"></i></a>',selected:".selected"},head:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-headline"></i></a>',selected:".selected"},orderlist:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-project-number"></i></a>',selected:".selected"},unorderlist:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-project-list"></i></a>',selected:".selected"},alignleft:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-flush-left"></i></a>',selected:".selected"},aligncenter:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-flush-center"></i></a>',selected:".selected"},alignright:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-flush-right"></i></a>',selected:".selected"},link:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-link"></i></a>',selected:".selected"},unlink:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-unlink"></i></a>',selected:".selected"},img:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-picture"></i></a>',selected:".selected"},undo:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-back"></i></a>',selected:".selected"},redo:{normal:'<a href="javascript:void(0)" tabindex="-1"><i class="tu-icon-cancle"></i></a>',selected:".selected"},table:{normal:'<a href="#" tabindex="-1"><i class="tu-icon-form"></i></a>',selected:".selected"}},zIndex:1,placeholder:"",containerId:"",hasBtns:false,maxWords:0,customUpload:true,hideLinkImg:true,height:145,maxHeight:300},initialize:function(options){this.settings=Talent._.extend({},this.defaults,options);this.inputData={};if(this.isIE()){var index=_.indexOf(this.settings.menus,"img");this.settings.menus.splice(index,1);this.settings.customUpload=false}},isIE:function(){var ua=navigator.userAgent;var s="MSIE";var i=ua.indexOf(s);var isIE=false;if(i>=0){var ver=Number(ua.substr(i+s.length));isIE=ver>9?false:true}return isIE},show:function(){var self=this;if(!this.settings.containerId||!$("#"+this.settings.containerId).length){return}this.editor=new wangEditor(this.settings.containerId);$.each(this.settings,function(k,v){self.editor.config[k]=v});self.editor.UI.menus=this.settings.menusUI;this._editorDataDeal();this.editor.onchange=function(){self._editorDataDeal()};this.editor.create();if(this.settings.hasBtns){self.editor.$okBtn.off("click");this.editor.$okBtn.on("click",function(){self.trigger("editorSubmit",self.inputData)});self.editor.$concelBtn.off("click");this.editor.$concelBtn.on("click",function(){self.trigger("editorConcel",self.inputData)})}},fillContent:function(content){this.editor&&this.editor.fillContent(content)},_richHtmlTrim:function(data){var $html=$(data.html);var table=$html.find("table").length,img=$html.find("img").length,li=$html.find("li").length;if(data.html){data.html=data.html.replace(/(^(\<p\>\<br\>\<\/p\>)*)|((\<p\>\<br\>\<\/p\>)*$)/gim,"");data.html=data.html.replace(/(^(\<p\>&nbsp;\<\/p\>)*)|((\<p\>&nbsp;\<\/p\>)*$)/gim,"")}if(!$.trim(data.textOnly)&&!table&&!img&&!li){data.html=""}return data},_editorDataDeal:function(){var text=this.editor.txt.$txt.text(),text=$.trim(text),html=this.editor.txt.$txt.html();var data={textOnly:text,html:html};this.inputData=this._richHtmlTrim(data);this.trigger("editorChange",data)},focus:function(){var range=this.editor.currentRange();this.editor&&this.editor.restoreSelection(range)},onClose:function(){this.editor&&this.editor.close();delete this.editor}});function TipInfoView(node,data){var defaults={placement:"bottom",type:"default",body:"",trigger:"manual",align:"center",container:"",ico:""};var options=Talent._.extend({},defaults,data);var infoTipView=new Infotip;infoTipView.bindNode(node,options);infoTipView.show();return infoTipView}var TimeItemView=Talent.ItemView.extend({template:jst["year-month-week-dropdown/year-month-week-dropdown-item"],modelEvents:{"change:Active":"render"},templateHelpers:function(){return{type:this.options.type}}});var TimeCompoiseView=Talent.CompositeView.extend({itemView:TimeItemView,template:Talent._.template(""),tagName:"ul",className:"tt-timeDropdown__list",initialize:function(options){},ui:{select:"[data-name=select]"},events:function(){var events=[];events["click "+this.ui.select]="_selectHanlder";return events},onRender:function(){if(this.options.type=="month"||this.options.type=="week"){this.$el.addClass("tt-timeDropdown__borderLfet")}},itemViewOptions:function(){return{type:this.options.type}},_selectHanlder:function(ev){var node=$(ev.currentTarget),type=node.data("type"),id=node.data("id"),timeTargetModal=[],modalNameMapping={year:"PlanTableListModels",month:"PlanTableModels"},idMapping={year:"GroupId",month:"TagId",week:"PlanTableId"};this.collection.each(function(itemModel){if(id==itemModel.get(idMapping[type])){itemModel.set("Active",true);timeTargetModal=modalNameMapping[type]&&itemModel.get(modalNameMapping[type])}else{itemModel.set("Active",false)}});this.trigger("changeSelect",{type:type,id:id,timeTargetModal:timeTargetModal,newList:this.collection.toJSON()})},setActivePostion:function(){var node=this.$el.find(".tt-timeDropdown__list-active");var activeNodeTop=node.offset().top,itemContainerTop=this.$el.offset().top;this.$el.scrollTop(activeNodeTop-itemContainerTop)}});var YearMonthWeekDropdown=Talent.Layout.extend({template:jst["year-month-week-dropdown/year-month-week-dropdown"],className:"tt-timeDropdown tu-poa",initialize:function(options){var self=this;Talent.$(document).off("mousedown.Year-Month-Week-Close");Talent.$(document).on("mousedown.Year-Month-Week-Close",function(){self._hideView()});this.$el.off("mousedown.Year-Month-Week-open");this.$el.on("mousedown.Year-Month-Week-open",function(ev){ev.stopPropagation()});this.$el.off("click.Year-Month-Week");this.$el.on("click.Year-Month-Week",function(ev){ev.stopPropagation()})},ui:{select:"[data-name=select]",ulContainer:"[data-name=timeDropdown__content]",sure:"[data-name=sure]"},events:function(){var events={};events["click "+this.ui.sure]="_sureHandler";return events},onRender:function(){if(_.isEmpty(this.options.dateData)){this._getTimeData()}else{this.timeDataDeal(this.options.dateData)}},bindNode:function(options){var self=this;Talent.Context.setPosition(options.node,this.$el,{container:options.container||"body",pos:options.pos||"bottom",topBias:options.topBias,leftBias:options.leftBias});this._renderUls();this.setActivePostion();this.$el.show();Talent.$(options.node).off("click.TimeDropdown");Talent.$(options.node).on("click.TimeDropdown",function(ev){self.$el.show()})},setActivePostion:function(){var ulTypeList=["year","month","week"];for(var i=0;i<ulTypeList.length;i++){var viewName=ulTypeList[i]+"CompositeView";this[viewName].setActivePostion()}},_hideView:function(){this.$el.hide();this.trigger("close")},_renderUls:function(){var ulTypeList=["year","month","week"];for(var i=0;i<ulTypeList.length;i++){var viewName=ulTypeList[i]+"CompositeView";this[viewName]&&this[viewName].close();this[viewName]=new TimeCompoiseView({type:ulTypeList[i],collection:new Talent.Collection(this.model.get(ulTypeList[i]+"List"))});this.ui.ulContainer.append(this[viewName].render().$el);this.listenTo(this[viewName],"changeSelect",function(type,id,timeTargetModal){this._afterSelectDataDeal(type,id,timeTargetModal)})}},_getTimeData:function(data){var date=data&&data.date||moment().format("YYYY/MM/DD"),group_id=data&&data.group_id||0,self=this;PlanCollection.getPlan({group_id:group_id,date:date}).done(function(resp){var activeMonthList=Talent._.findWhere(resp.taglist,{Active:true}).PlanTableListModels,activeMonthId=Talent._.findWhere(activeMonthList,{Active:true}).TagId;if(activeMonthId==14){activeMonthList[0].Active=false;activeMonthList[1].Active=true;activeMonthList[1].PlanTableModels[0].Active=true}self.timeDataDeal(resp.taglist)})},timeDataDeal:function(data){var yearList=data,monthList=Talent._.findWhere(yearList,{Active:true}).PlanTableListModels,weekList=Talent._.findWhere(monthList,{Active:true}).PlanTableModels,selectYear=Talent._.findWhere(yearList,{Active:true}).GroupName,selectMonth=Talent._.findWhere(monthList,{Active:true}).TagName,selectWeek=Talent._.findWhere(weekList,{Active:true}).Name,currentTime=Talent._.findWhere(weekList,{Active:true});this.model.set("yearList",yearList);this.model.set("monthList",monthList);this.model.set("weekList",weekList);this.model.set("currentTime",currentTime);this.model.set("selectYear",selectYear);this.model.set("selectMonth",selectMonth);this.model.set("selectWeek",selectWeek)},_afterSelectDataDeal:function(data){var currentYear=moment().year(),currentMonth=moment().month()+1,currentWeek=moment().week(),yearList=this.model.get("yearList");

switch(data.type){case"year":{var activeYear=Talent._.findWhere(data.newList,{Active:true}).GroupName;if(activeYear==currentYear){this._getTimeData()}else{this._getTimeData({date:activeYear+"/00/00"})}this["monthCompositeView"].collection.reset(this.model.get("monthList"));this["weekCompositeView"].collection.reset(this.model.get("weekList"));this["monthCompositeView"].setActivePostion()}break;case"month":{var activeYear=Talent._.findWhere(yearList,{Active:true}).GroupName,activeMonth=Talent._.findWhere(data.newList,{Active:true}).TagId-1;if(activeYear==currentYear&&activeMonth==currentMonth){this._getTimeData()}else{this._getTimeData({date:activeYear+"/0"+activeMonth+"/00"})}this["weekCompositeView"].collection.reset(this.model.get("weekList"))}break;case"week":{var yearList=this.model.get("yearList"),PlanTableListModels=Talent._.findWhere(yearList,{Active:true}).PlanTableListModels;Talent._.findWhere(PlanTableListModels,{Active:true}).PlanTableModels=data.newList;this.model.set("weekList",data.newList);this.model.set("currentTime",Talent._.findWhere(data.newList,{Active:true}));this.model.set(yearList,"yearList")}break}},_sureHandler:function(){var currentTime=this.model.get("currentTime"),selectYear=this.model.get("selectYear"),selectMonth=this.model.get("selectMonth"),selectWeek=this.model.get("selectWeek"),dateAllName="";switch(currentTime.PlanTableType){case 1:{dateAllName=selectYear+currentTime.Name}break;case 2:{dateAllName=selectYear+"年"+currentTime.Name}break;case 3:{dateAllName=selectYear+"年"+selectMonth}break;case 4:{dateAllName=selectYear+"年"+selectMonth+currentTime.Name}break}currentTime.dateAllName=dateAllName;this.trigger("sure",currentTime,this.model.get("yearList"));this._hideView()}});var MultipleTaskListItem=Talent.CompositeView.extend({tagName:"li",template:jst["multiple-task-list/multiple-task-list-item"],itemViewContainer:".project-lotSize__task-childern",ui:{changeChecked:"[data-name=changeCheck]",hideChildern:"[data-name=hideChildern]",showChildern:"[data-name=showChildern]",taskChildern:"[data-name=task-childern]"},events:function(){var events={};events["click "+this.ui.changeChecked]="_changeChecked";events["click "+this.ui.hideChildern]="_hideChildern";events["click "+this.ui.showChildern]="_showChildern";return events},modelEvents:{"change:checked":"render","change:showChildren":"render"},itemViewOptions:function(){return{taskGlobalModal:this.taskGlobalModal,multiple:this.options.multiple,listSpecialStyle:this.options.listSpecialStyle}},initialize:function(options){this.collection=this.model.get("collection");var self=this;this.taskGlobalModal=options.taskGlobalModal;this.on("itemview:showInfoTip",function(view,data){self.trigger("showInfoTip",data)})},templateHelpers:function(){var Mapping={0:{tipTxt:"未开始"},1:{tipTxt:"进行中"},2:{tipTxt:"已完成"},3:{tipTxt:"已延迟"},4:{tipTxt:"已取消"},5:{tipTxt:"未开始"},6:{tipTxt:"暂停中"}};var status=this.model.get("status");var titaHost=Context.getGlobal("titaHost");var userInfo=Context.getUserInfo();var host=titaHost+"/u/"+userInfo.Id+"/Home#more/taskinfo?";var multiple=this.options.multiple,checkedIcons={checked:multiple?"tu-icon-check-active":"tu-icon-singlebox-avtive",unchecked:multiple?"tu-icon-checkbox-have":"tu-icon-singlebox-have"};var rawTaskName=this._stripHtml(this.model.get("taskName"));return{statusName:Mapping[status].tipTxt,startDate:this.model.get("startDate").substr(0,10),deadLine:this.model.get("deadLine").substr(0,10),hasChildern:this.collection&&this.collection.length||0,host:host,rawTaskName:rawTaskName,showTip:Talent.Context.getStrLength(rawTaskName)>40,checkedIcons:checkedIcons,listSpecialStyle:this.options.listSpecialStyle,isApply:this.model.get("isApply")||""}},onRender:function(){this.$el.css("position","relative");this.$el.find("[data-body]").infotip({type:"default",placement:"top",align:"left",container:this.$el})},_stripHtml:function(html){return html.replace(/(<([^>]+)>)/gi,"")},_changeChecked:function(ev){var node=Talent.$(ev.currentTarget),checked=!this.model.get("checked"),globalTaskIds=this.taskGlobalModal.get("globalTaskIds"),currentPageChckedNum=this.taskGlobalModal.get("currentPageChckedNum"),taskId=this.model.get("taskId"),data=this._globalTaskIdsDeal(checked,globalTaskIds,currentPageChckedNum),status=this.model.get("status");if((status==2||status==5)&&checked){this.trigger("showInfoTip",{node:node,finishNum:status==2,unreceivedNum:status==5,type:"item"})}this.model.set("checked",checked);this.taskGlobalModal.unset("globalTaskIds",{silent:true}).set("globalTaskIds",data.globalTaskIds);this.taskGlobalModal.set("currentPageChckedNum",data.currentPageChckedNum)},_showChildern:function(ev){var node=Talent.$(ev.currentTarget),currentPageExposeNum=this.taskGlobalModal.get("currentPageExposeNum"),currentPageChckedNum=this.taskGlobalModal.get("currentPageChckedNum"),globalTaskIds=this.taskGlobalModal.get("globalTaskIds"),childrenLength=this.collection.length,isExpose=false,self=this;if(childrenLength){this.collection.reset(itemDeal(this.collection.toJSON()));this.taskGlobalModal.set("currentPageExposeNum",currentPageExposeNum);this.taskGlobalModal.set("currentPageChckedNum",currentPageChckedNum);this.taskGlobalModal.unset("globalTaskIds").set("globalTaskIds",globalTaskIds)}else{this.taskGlobalModal.get("subTasksGetResp")(this.model.toJSON()).done(function(resp){if(resp.length){self.collection.add(itemDeal(resp,true));self.taskGlobalModal.set("currentPageExposeNum",currentPageExposeNum);self.taskGlobalModal.set("currentPageChckedNum",currentPageChckedNum);self.taskGlobalModal.unset("globalTaskIds").set("globalTaskIds",globalTaskIds)}})}function itemDeal(data,initial){var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"taskId"})}});Talent._.each(data,function(item){if(initial){item.level=self.model.get("level")+1;item.showChildren=false;item.collection=new mCollection;var hasChecked=Talent._.where(globalTaskIds,{taskId:item.taskId}).length||0;if(hasChecked){item.checked=true;currentPageChckedNum++}else{item.checked=false}}if(item.checked){currentPageChckedNum++}if(!item["isApply"]||!self.options.listSpecialStyle){item["isExpose"]=true;currentPageExposeNum++}if(item.showChildren&&item.collection.length){var data=itemDeal(item.collection.toJSON(),false);item.collection.reset(data)}});return data}this.model.set("showChildren",true);this.model.set("collection",this.collection)},_hideChildern:function(ev){var currentPageExposeNum=this.taskGlobalModal.get("currentPageExposeNum");var currentPageChckedNum=this.taskGlobalModal.get("currentPageChckedNum");var collectionD=itemDeal(this.collection.toJSON());this.collection.reset(collectionD);function itemDeal(collection){Talent._.each(collection,function(itemModel){itemModel.isExpose=false;currentPageExposeNum--;if(itemModel.checked){currentPageChckedNum--}if(itemModel.collection.length){var data=itemDeal(itemModel.collection.toJSON());itemModel.collection.reset(data)}});return collection}this.model.set("showChildren",false);this.taskGlobalModal.set("currentPageExposeNum",currentPageExposeNum);this.taskGlobalModal.set("currentPageChckedNum",currentPageChckedNum)},_globalTaskIdsDeal:function(state,globalTaskIds,currentPageChckedNum){var taskId=this.model.get("taskId");if(state){if(!this.options.multiple){globalTaskIds=[]}globalTaskIds.push(this.model.toJSON());currentPageChckedNum++}else{globalTaskIds=Talent._.filter(globalTaskIds,function(item){return item.taskId!=taskId});currentPageChckedNum--}return{globalTaskIds:globalTaskIds,currentPageChckedNum:currentPageChckedNum}}});var MultipleTaskCompositeView=Talent.CompositeView.extend({tagName:"li",template:jst["multiple-task-list/multiple-task-list-composite"],itemViewContainer:".project-lotSize__task-list",ui:{},modelEvents:{"change:allChecked":"render"},initialize:function(options){var self=this;this.itemView=options.TaskListItemView||MultipleTaskListItem;this.collection=this.model.get("collection");this.model.set("allChecked",options.allChecked);this.taskGlobalModal=options.taskGlobalModal;this.on("itemview:showInfoTip",function(view,data){self.trigger("showInfoTip",data)});this.$el.on("click",function(ev){ev.stopPropagation()})},templateHelpers:function(){var modelData=this.model.toJSON();return{combineName:modelData[this.options.combineName],combineId:modelData[this.options.combineId]}},itemViewOptions:function(){return{taskGlobalModal:this.taskGlobalModal,multiple:this.options.multiple,listSpecialStyle:this.options.listSpecialStyle}}});var MultipleTaskListView=Talent.CompositeView.extend({template:jst["multiple-task-list/multiple-task-list-main"],className:"project-lotSize__task",itemViewContainer:".project-lotSize__task-milepost",defaults:{multiple:false,isCombine:true,combineName:"",combineId:"",listSpecialStyle:true,TaskListItemView:""},ui:{changeAllCheck:"[data-name=changeAllCheck]",changeChecked:"[data-name=changeCheck]"},events:function(){var events={};events["click "+this.ui.changeAllCheck]="_changeAllCheck";events["click "+this.ui.changeChecked]="_changeChecked";return events},initialize:function(options){var self=this,data;this.settings=Talent._.extend({},this.defaults,options);this.settings.checkedIcons={checked:this.settings.multiple?"tu-icon-check-active":"tu-icon-singlebox-avtive",unchecked:this.settings.multiple?"tu-icon-checkbox-have":"tu-icon-singlebox-have"};this.model.set("currentPageExposeNum",0,{silent:true});this.model.set("currentPageChckedNum",0,{silent:true});this.model.set("subTasksGetResp",this.settings.subTasksGetResp);this.model.on("change:globalTaskIds",function(model){self.trigger("globalTaskIdsChange")});this.itemView=this.settings.isCombine?MultipleTaskCompositeView:MultipleTaskListItem;if(this.settings.isCombine){data=this._dealData(options.tasks)}else{data=this._formatData(options.tasks)}this.collection=new Talent.Collection(data);this.on("itemview:showInfoTip",function(view,data){self.trigger("showInfoTip",data)});this.$el.on("click.multiple-task-list",function(ev){ev.stopPropagation()})},itemViewOptions:function(){return{taskGlobalModal:this.model,multiple:this.settings.multiple,checkedIcons:this.settings.checkedIcons,combineName:this.settings.combineName,combineId:this.settings.combineId,listSpecialStyle:this.settings.listSpecialStyle,TaskListItemView:this.settings.TaskListItemView||""}},templateHelpers:function(){return{multiple:this.settings.multiple,listSpecialStyle:this.settings.listSpecialStyle}},onRender:function(){var self=this;this._modelOnHandler()},_modelOnHandler:function(){var self=this;if(this.settings.multiple){this.model.on("change:currentPageChckedNum change:currentPageExposeNum",function(model){var currentPageChckedNum=model.get("currentPageChckedNum"),currentPageExposeNum=model.get("currentPageExposeNum");if(currentPageChckedNum==currentPageExposeNum){model.set("allCheckedState",true,{silent:true})}else{model.set("allCheckedState",false,{silent:true})}self._domChange()})}else{this.model.on("change:currentPageChckedNum",function(model){var globalTaskIds=model.get("globalTaskIds");if(globalTaskIds[0]){self._radioCheckedDeal(globalTaskIds[0].taskId)}})}},_changeAllCheck:function(ev){var self=this;var node=Talent.$(ev.currentTarget);var allCheckedState=!this.model.get("allCheckedState");this.model.set("allCheckedState",allCheckedState);this._allCheckedDataDeal(allCheckedState);var hasCheckedFinish=this.model.get("hasCheckedFinish")||0;var hasCheckedUnreceived=this.model.get("hasCheckedUnreceived")||0;if(allCheckedState&&(hasCheckedFinish||hasCheckedUnreceived)){self.trigger("showInfoTip",{node:node,finishNum:hasCheckedFinish,unreceivedNum:hasCheckedUnreceived,type:"all"})}this._domChange()},_domChange:function(){if(this.model.get("allCheckedState")){this.ui.changeAllCheck.removeClass("tu-icon-checkbox-have").addClass("tu-icon-check-active")}else{this.ui.changeAllCheck.removeClass("tu-icon-check-active").addClass("tu-icon-checkbox-have")}},_dealData:function(data){var collectionData=[],self=this;Talent._.each(data,function(item){if(item.tasks&&item.tasks.length){item.collection=new Talent.Collection(self._formatData(item.tasks)||[]);collectionData.push(item)}});return collectionData},_formatData:function(data){if(!data.length)return;var exposeNum=this.model.get("currentPageExposeNum")||0,globalTaskIds=this.model.get("globalTaskIds")||[],currentPageChckedNum=this.model.get("currentPageChckedNum")||0,self=this;var mCollection=Talent.Collection.extend({initialize:function(){this.model=Talent.Model.extend({idAttribute:"taskId"})}});_.each(data,function(item){var hasChecked=Talent._.where(globalTaskIds,{taskId:item.taskId}).length||0;if(!item["isApply"]||!self.settings.listSpecialStyle){item["isExpose"]=true;exposeNum++}if(hasChecked){item.checked=true;currentPageChckedNum++}else{item.checked=false}item["collection"]=new mCollection;item["level"]=1;item.showChildren=false});this.model.set("currentPageExposeNum",exposeNum,{silent:true});this.model.set("currentPageChckedNum",currentPageChckedNum);if(exposeNum&&currentPageChckedNum&&exposeNum==currentPageChckedNum){self.model.set("allCheckedState",true)}else{self.model.set("allCheckedState",false)}return data},_allCheckedDataDeal:function(checkedStatus){var mileCollection=this.collection.toJSON(),hasCheckedFinish=0,hasCheckedUnreceived=0,globalTaskIds=this.model.get("globalTaskIds"),currentPageChckedNum=this.model.get("currentPageChckedNum"),self=this;var itemCollectionChange=function(collection){var collection=collection.toJSON();if(collection.length){Talent._.each(collection,function(item){var hasChecked=Talent._.where(globalTaskIds,{taskId:item.taskId}).length||0;if(item.isExpose){item.checked=checkedStatus;if(hasChecked){if(!checkedStatus){currentPageChckedNum--;globalTaskIds=Talent._.filter(globalTaskIds,function(taskItem){return taskItem.taskId!=item.taskId})}}else{currentPageChckedNum++;globalTaskIds.push(item)}if(checkedStatus&&item.status==2){hasCheckedFinish++}if(checkedStatus&&item.status==5){hasCheckedUnreceived++}}item.collection.reset(itemCollectionChange(item.collection))})}return collection};this._combineCollectionHandler(itemCollectionChange);this.model.unset("globalTaskIds",{silent:true}).set("globalTaskIds",globalTaskIds);this.model.set("currentPageChckedNum",currentPageChckedNum);this.model.set("hasCheckedFinish",hasCheckedFinish);this.model.set("hasCheckedUnreceived",hasCheckedUnreceived)},_radioCheckedDeal:function(checkedId){var itemCollectionDeal=function(data){var collection=data.toJSON();Talent._.each(collection,function(item){if(item.taskId!=checkedId){item.checked=false}if(item.collection.length>0){var resetData=itemCollectionDeal(item.collection);item.collection.reset(resetData)}});return collection};this._combineCollectionHandler(itemCollectionDeal)},_combineCollectionHandler:function(fn){var collection=this.collection.toJSON(),self=this;if(this.settings.isCombine){Talent._.each(collection,function(item){item.collection.reset(fn(item.collection))});this.collection.reset(collection)}else{this.collection.reset(fn(this.collection))}},onClose:function(){this.model.off()}});var ListItemView=Talent.ItemView.extend({template:JST["search-sort-filter/drop-down-list-item"],templateHelpers:function(){var activeOrder=String(this.model.get("activeOrder")).split(","),order=this.model.get("order"),isMult=this.model.get("isMult"),tip=this.model.get("tip"),title=this.model.get("title"),showTip=tip&&_.isArray(tip)&&tip.length>0,tipOrderIndex=-1,tipTxt,itemActive;if(showTip){tipTxt=tip[0].txt;if(tip.length>1){_.each(tip,function(el,index){if(el.order==activeOrder){tipOrderIndex=index}});if(tipOrderIndex>-1&&!tipOrderIndex){tipTxt=tip[1].txt}}}if(isMult){if(this.model.get("title")!="baseline"&&this.model.get("checked")&&activeOrder&&_.indexOf(activeOrder,String(order[0]))>-1)itemActive=true}else{if(_.isArray(order)&&order.length>1){itemActive=activeOrder&&_.indexOf(order,String(activeOrder))>-1}else{itemActive=activeOrder&&_.indexOf(activeOrder,String(order))>-1}}return{itemActive:itemActive,showTip:showTip,tipTxt:tipTxt,nowOrder:title!="baseline"&&(order&&order.length>1&&activeOrder&&_.indexOf(order,String(activeOrder))>-1?_.without(order,String(activeOrder))[0]:order&&order[0])}},renderInfo:function(container){var infotipView=new Infotip;this.$el.css("position","relative");infotipView.bindNode(this.$el.find('[data-toggle="infotip"]'),{container:container})}});var DorpDownListView=Talent.CompositeView.extend({itemView:ListItemView,itemViewContainer:"[data-name=list-container]",defaults:{pos:"bottom",width:"170",container:$("body"),isMult:false},template:JST["search-sort-filter/drop-down-list"],className:"tt-new-filter-dropdownlist",ui:{listItem:"[data-name=list-item]",saveBtn:"[data-name=save-btn]",multEnter:"[data-name=mult-enter]",checkall:"[data-name=checkall]",singleBox:".single-box"},events:function(){var events={};events["click "+this.ui.listItem]="_itemClickHandler";events["click "+this.ui.saveBtn]="_saveBtnClickHandler";events["click "+this.ui.multEnter]="_multEnterClickHandler";events["click "+this.ui.checkall]="_checkallClickHandler";return events},modelEvents:{change:"render"},collectionEvents:{change:"_checkChecked"},templateHelpers:function(){return{save:this.model.get("save")&&this.model.get("save")["support"],activeOrder:this.model.get("activeOrder"),isMult:this.settings.isMult}},itemViewOptions:function(model,index){model.set("activeOrder",this.model.get("activeOrder"));model.set("isMult",this.model.get("isMult"))},initialize:function(){var self=this;this.timestamp=(new Date).getTime();this.settings=Talent._.extend({},this.defaults,this.options);Talent.$(document).off("mousedown.okr-drop-down-list-"+this.timestamp);Talent.$(document).on("mousedown.okr-drop-down-list-"+this.timestamp,function(){self.$el.hide();if(self.settings.isMult){_.each(self.originCheckedStatus,function(item){_.findWhere(self.model.get("data"),{title:item.title}).checked=item.checked});self.model.set("activeOrder",self.originActiveOrder,{silent:true});self.collection.reset(self.model.get("data"));self.model.set("checkAll",self._checkAllChecked())}self.trigger("close")});this.$el.off("mousedown.okr-drop-down-list-"+this.time);this.$el.on("mousedown.okr-drop-down-list-"+this.time,function(ev){ev.stopPropagation()});if(this.settings.isMult){this.model.set("checkAll",this._checkAllChecked())}this.collection.set(this.model.get("data"));this.on("itemview:render",function(view){view.renderInfo(self.$el)})},onRender:function(){this._checkChecked()},setOriginData:function(){var self=this;this.originCheckedStatus=[];this.originActiveOrder=this.model.get("activeOrder");_.each(this.model.get("data"),function(item){self.originCheckedStatus.push({title:item.title,checked:item.checked})})},_checkAllChecked:function(){var checkAll=true,activeOrder=this.model.get("activeOrder").split(",");_.each(this.model.get("data"),function(item){item.isMult=true;if(item.title!="baseline"){if(activeOrder&&_.indexOf(activeOrder,String(item.order[0]))>-1){item.checked=true}else{item.checked=false;checkAll=false}}});return checkAll},show:function(options){var options=Talent._.extend({},this.defaults,options),self=this;this.setOriginData();this.$el.css({width:options.width});this.$el.show();this.setPosition(options);this._setActivePostion()},_setActivePostion:function(){if(this.model.get("isMult"))return;var activeNode=this.$el.find(".active");if(!activeNode.length)return;var itemContainer=this.ui.singleBox,activeNodeTop=activeNode.offset().top,itemContainerTop=itemContainer.offset().top;if(activeNodeTop-itemContainerTop>=300){itemContainer.scrollTop(activeNodeTop-itemContainerTop-300+30)}},_checkChecked:function(){if(!this.settings.isMult)return;var allChecked=[];_.each(this.collection.toJSON(),function(item){if(item.title!="baseline"&&item.checked)allChecked.push(item)});if(allChecked.length){this.ui.multEnter.removeClass("disabled").addClass("tu-btn-sure")}else{this.ui.multEnter.removeClass("tu-btn-sure").addClass("disabled")}},_itemClickHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),nowOrder=node.data("order"),nowtitle=String(node.data("title")),itemData=this.model.get("data"),itemOrder=_.findWhere(itemData,{title:nowtitle}).order,clickItemHide=this.model.get("clickItemHide"),isMult=this.settings.isMult,triggerData;if(isMult){clickItemHide=false;var checked=node.data("checked");this.collection.findWhere({title:nowtitle}).set("checked",!checked);if(checked){node.removeClass("active")}else{node.addClass("active")}node.data("checked",!checked);if(this.collection.findWhere({checked:false})){this.model.set("checkAll",false,{silent:true});this.ui.checkall.removeClass("active")}else{this.model.set("checkAll",true,{silent:true});this.ui.checkall.addClass("active")}}else{clickItemHide=clickItemHide==undefined?true:clickItemHide;this.model.set("activeOrder",String(nowOrder));if(itemOrder.length>1){node.data("order",_.without(itemOrder,String(nowOrder))[0]);_.indexOf(itemOrder,String(nowOrder))?nowtitle+='<span class="tu-icon-simple-sort-up"></span>':nowtitle+='<span class="tu-icon-simple-sort-down"></span>'}triggerData={modelData:this.model.toJSON(),title:nowtitle};$(this.ui.listItem).removeClass("active");node.addClass("active");this.render();this.trigger("chose",triggerData);if(clickItemHide){this.$el.hide();this.trigger("close")}}},_checkallClickHandler:function(ev){ev.stopPropagation();var checkall=this.model.get("checkAll"),node=$(ev.currentTarget),activeOrder=[];if(checkall){node.removeClass("active")}else{node.addClass("active")}var data=this.collection.toJSON();_.each(data,function(item){item.checked=!checkall;if(!checkall&&item.title!="baseline"){activeOrder.push(item.order[0])}});this.model.set("activeOrder",activeOrder.join(","));this.model.set("data",data,{silent:true});this.collection.reset(data);this.model.set("checkAll",!checkall)},_saveBtnClickHandler:function(ev){ev.stopPropagation();var triggerData=[{activeOrder:this.model.get("activeOrder"),tabName:this.model.get("tabName"),savaRequest:this.model.get("save")["saveRequest"]}],saveSuccessInfo=this.model.get("saveSuccessInfo");this.trigger("saveSort",triggerData,saveSuccessInfo);this.$el.hide();this.trigger("close")},_multEnterClickHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),self=this;if(node.hasClass("disabled"))return;this.model.set("data",this.collection.toJSON());this.model.set("activeOrder",this._getMultActiveOrder());this.setOriginData();this.trigger("chose",{modelData:this.model.toJSON()});this.$el.hide();this.trigger("close")},_getMultActiveOrder:function(){var activeOrder=[];_.each(this.model.get("data"),function(item){if(item.checked&item.title!="baseline")activeOrder.push(item.order[0])});return activeOrder.join(",")},setPosition:function(options){Talent.Context.setPosition(options.node,this.$el,{container:options.container,pos:options.pos,topBias:options.topBias,leftBias:options.leftBias})},onClose:function(){this.$el.off("mousedown.okr-drop-down-list-"+this.timestamp);Talent.$(document).off("mousedown.okr-drop-down-list-"+this.timestamp)}});var ScreenResultGroupItemView=Talent.ItemView.extend({template:JST["search-sort-filter/filter-result-group-item"],className:"result-group-item",ui:{closeBtn:"[data-name=close-btn]"},events:function(){var events={};events["click "+this.ui.closeBtn]="_closeBtnClickHandler";return events},templateHelpers:function(){return{isValid:this.model.get("data")&&this.model.get("data").isValid}},initialize:function(){},_closeBtnClickHandler:function(ev){ev.stopPropagation();this.close()}});var ScreenResultGroupView=Talent.CompositeView.extend({template:JST["search-sort-filter/filter-result-group"],tagName:"dl",className:"result-group",itemView:ScreenResultGroupItemView,itemViewContainer:"[data-name=result-group-list]",initialize:function(){var self=this;this.collection.set(this.model.get("groupList"));this.on("itemview:close",function(view){self.collection.remove(view.model);self.trigger("closeItem",{modelData:view.model.toJSON(),groupName:self.model.get("groupName")})})},onRender:function(){}});var FilterResultView=Talent.CompositeView.extend({template:JST["search-sort-filter/filter-result"],className:"tt-new-filter-result",itemView:ScreenResultGroupView,itemViewContainer:"[data-name=filter-result-wrap]",templateHelpers:function(){},ui:{filterResultWrap:"[data-name=filter-result-wrap]",clearBtn:"[data-name=clear-btn]",saveBtn:"[data-name=save-btn]",cancelSaveBtn:"[data-name=cancel-save-btn]"},events:function(){var events={};events["click "+this.ui.input]="_inputFocusHandler";events["click "+this.ui.clearBtn]="_clearBtnClickHandler";events["click "+this.ui.saveBtn]="_saveBtnClickHandler";events["click "+this.ui.cancelSaveBtn]="_cancelSaveBtnClickHandler";return events},initialize:function(){var self=this;this.settings=Talent._.extend({},this.defaults,this.options);this.on("itemview:closeItem",function(view,data){self._dealCloseData(view,data)})},onRender:function(){this._appendHandleBtn()},_appendHandleBtn:function(){this.clearEl=$('<a href="javascript:;" class="handle-btn" data-name="clear-btn" data-placement="top" data-toggle="infotip" data-body="清空本次选择">清空所选</a>');this.saveEl=$('<a href="javascript:;" class="handle-btn" data-name="save-btn" data-toggle="infotip">记住选择</a>');this.cancelSaveEl=$('<a href="javascript:;" class="handle-btn" data-name="cancel-save-btn" data-toggle="infotip">取消记住</a>');this.ui.filterResultWrap.append(this.clearEl);var clearInfotipView=new Infotip;clearInfotipView.bindNode(this.clearEl,{container:this.$el});if(this.settings.saveResult.support){this.ui.filterResultWrap.append(this.clearEl,this.saveEl,this.cancelSaveEl);this.settings.fromeStore?this.saveEl.hide():this.cancelSaveEl.hide();var saveInfotipView=new Infotip;var cancelInfotipView=new Infotip;saveInfotipView.bindNode(this.saveEl,{container:this.$el,body:"下次进入显示以上条件"});cancelInfotipView.bindNode(this.cancelSaveEl,{container:this.$el,body:"不再显示以上条件"})}},_dealCloseData:function(view,data){var groupName=data.groupName;this.cancelSaveEl.hide();this.saveEl.show();if(view.collection.length){this.collection.findWhere({groupName:groupName}).set("groupList",view.collection.toJSON())}else{this.collection.remove(view.model);if(!this.collection.length){this.close()}}this.trigger("closeItem",data)},_clearBtnClickHandler:function(ev){ev.stopPropagation();this.collection.reset();this.trigger("clear");this.close()},_saveBtnClickHandler:function(ev){ev.stopPropagation();this.trigger("save");this.$el.find("[data-name=save-btn]").hide();this.$el.find("[data-name=cancel-save-btn]").show()},_cancelSaveBtnClickHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget);this.trigger("cancelSave",node)}});var FilterTabListView=Talent.ItemView.extend({template:JST["search-sort-filter/search-filter-tab-list"],className:"tt-new-filtter-tab-list",tagName:"ul",ui:{tabItem:"[data-name=tab-item]",moreTabList:"[data-name=more-tab-list]",moreTabListItem:"[data-name=more-tab-list-item]",tabMoreBtn:"[data-name=tab-more-btn]",tabItemWrap:"[data-name=tab-item]"},modelEvents:{change:"render"},events:function(){var events={};events["click "+this.ui.tabItem]="_tabClickHandler";events["click "+this.ui.moreTabListItem]="_moreTabItemClickHandler";events["mousedown "+this.ui.moreTabList]="_moreTabListMousedownHandler";return events},initialize:function(){},onRender:function(){},templateHelpers:function(){var TaskAdvancedSetting=Talent.Context.getGlobal("TaskAdvancedSetting");var TaskLabel=TaskAdvancedSetting.TaskPlanSetting.TaskLabel;return{TaskLabel:TaskLabel}},onShow:function(){var self=this;if(this.model.get("tabResizeChange")){this._getTabItemWith();this._rebuildTabs();this.resizeDelay=Talent._.debounce(function(){self._rebuildTabs()},50);$(window).off("resize.filter-tab-list");$(window).on("resize.filter-tab-list",function(){self.resizeDelay()})}},_getTabItemWith:function(){var self=this;this.normalTabWidthArr=[];this.hasLeftLineTabWidth=0;_.each(this.ui.tabItemWrap,function(node){var el=$(node),elWidth=el.width();if(el.data("leftlist")){self.hasLeftLineTabWidth+=elWidth}else{self.normalTabWidthArr.push(elWidth)}})},_rebuildTabs:function(){var self=this,listWidth=this.$el.width(),filterRightWrap=$(".filter-right-wrap").width(),validListWidth=listWidth-this.hasLeftLineTabWidth-200-filterRightWrap,allTabs=this.model.get("allTabs"),newNormalTabList=[],moreTabList=[],minWidth=0;_.each(this.normalTabWidthArr,function(width,index){minWidth+=width;if(minWidth<=validListWidth){newNormalTabList.push(allTabs[index])}else{moreTabList.push(allTabs[index])}});if(moreTabList.length){newNormalTabList.push({tabLeftLine:false,tabName:"more",tabTitle:"more",moreData:moreTabList})}this.model.set("normalTabListData",newNormalTabList)},_moreTabListMousedownHandler:function(ev){ev.stopPropagation()},_moreTabItemClickHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),tabName=node.data("tab-name");this.trigger("tabItemClick",tabName,this.ui.tabMoreBtn.parent());this.ui.moreTabList.hide()},_tabClickHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),tabName=node.data("tab-name");node.addClass("tab-item-active");if(tabName=="more"){this.ui.moreTabList.show();var self=this;Talent.$(document).on("mousedown.filter-tab-list-view",function(e){Talent.$(document).off("mousedown.filter-tab-list-view");if(self.ui.moreTabList){self.ui.moreTabList.hide();self.ui.tabMoreBtn.parent().removeClass("tab-item-active")}})}else{this.trigger("tabItemClick",tabName,node)}},onClose:function(){$(window).off("resize.filter-tab-list");Talent.$(document).off("mousedown.filter-tab-list-view")}});var FilterTabView=Talent.Layout.extend({template:JST["search-sort-filter/search-filter-tab"],className:"tt-new-filtter-tab",templateHelpers:function(){},ui:{tabItem:"[data-name=tab-item]"},regions:{resultWrap:"[data-name=result-wrap]",filterTabList:"[data-name=filter-tab-list]"},modelEvents:{"change:tag":"render"},events:function(){var events={};return events},initialize:function(){var tab=this.model.get("tab"),storeData=this.model.get("storeData"),self=this;if(_.isArray(storeData)&&!_.isEmpty(storeData)){_.each(storeData,function(item){if(item.data&&item.data.isMult){var tabData=_.filter(tab,function(i){return i.tabName==item.tabName}),arr=[];if(tabData.length){_.each(tabData[0].data,function(i){if(i.title!="baseline"&&item.data.activeOrder.indexOf(i.order[0])<0){i.checked=false}arr.push(i)})}item.data.data=arr}})}this._selectCollection=new Talent.Collection;this.listenTo(this._selectCollection,"change add reset set",function(){this._checkRely()});this._changeTabTitleByDefaultOrder(tab,storeData);this.extendResultData=new Talent.Collection;this.dealextendStoreDataCallback=this.model.get("dealextendStoreDataCallback");this.clickExtendTabCallback=this.model.get("clickExtendTabCallback");this.dealExtendDeleteCallback=this.model.get("dealExtendDeleteCallback")},onRender:function(){var tabs=this.model.get("tab"),storeData=this.model.get("storeData"),self=this;Talent._.each(tabs,function(item){if(item.tabName=="department"||item.tabName=="staff"){self._dealUserSelectViewCollection(item.tabName)}});if(_.isArray(storeData)&&storeData.length>0){this._renderFilterResultBySroreData(storeData)}this._setTabTitleByRely(tabs,storeData)},onShow:function(){this._renderFilterTabListView()},_renderFilterTabListView:function(){var tabs=this.model.get("tab"),normalTabListData=[],hasLeftlineTabListData=[];_.each(tabs,function(item){if(item.tabLeftLine){hasLeftlineTabListData.push({tabLeftLine:item.tabLeftLine,tabName:item.tabName,tabTitle:item.tabTitle})}else{normalTabListData.push({tabLeftLine:item.tabLeftLine,tabName:item.tabName,tabTitle:item.tabTitle})}});var filterTabListViewModel=new Talent.Model({normalTabListData:normalTabListData,hasLeftlineTabListData:hasLeftlineTabListData,allTabs:normalTabListData.concat(hasLeftlineTabListData),tabResizeChange:this.model.get("tabResizeChange")});this.filterTabListView&&this.filterTabListView.close();

this.filterTabListView=new FilterTabListView({model:filterTabListViewModel});this.listenTo(this.filterTabListView,"tabItemClick",function(tabName,node){this._tabClickHandler(tabName,node)});this.filterTabList.show(this.filterTabListView)},_changeTabTitleByDefaultOrder:function(tab,storeData){var self=this;_.each(tab,function(item){var activeOrder=item.activeOrder;if(activeOrder!==undefined&&item.changeTabTitle){var itemIndex=_.indexOf(tab,item),saveOrder,newTabTitle;if(_.isArray(storeData)&&storeData.length>0){_.each(storeData,function(i,index){if(i.tabName==item.tabName)saveOrder=i.data.activeOrder})}_.each(item.data,function(el){if(el.tabTitle!="baseline"){var activeOrderIndex=_.indexOf(el.order,saveOrder!==undefined?String(saveOrder):String(activeOrder));if(activeOrderIndex>-1){if(_.isArray(el.order)&&el.order.length>1){var iconTxt=activeOrderIndex?'<span class="tu-icon-simple-sort-up"></span>':'<span class="tu-icon-simple-sort-down"></span>';newTabTitle=el.title+iconTxt;item.tabTitle=newTabTitle}else{item.tabTitle=el.title}tab.splice(itemIndex,1,item);self.model.set("tab",tab)}}})}})},_renderFilterResultBySroreData:function(data){var self=this,fromeStoreData=true;_.each(data,function(item){var model=new Talent.Model(item);self._selectCollection.push(model)});this._renderFilterResultView(fromeStoreData)},_setTabTitleByRely:function(tab,storeData){var self=this,relyData=_.filter(tab,function(item){return item.rely!==undefined&&item.rely!=""});Talent._.each(relyData,function(item){var data;if(_.isArray(storeData)&&storeData.length>0){_.each(storeData,function(el,index){if(el.tabName==item.rely)data=el.data})}if(data===undefined){var scopeTabEl=self.$el.find("[data-tab-name="+item.tabName+"]");if(scopeTabEl)scopeTabEl.addClass("disable")}})},_checkRely:function(){var self=this,tab=this.model.get("tab"),relyData=_.filter(tab,function(item){return item.rely!==undefined&&item.rely!=""});if(relyData.length){relyByObjData=_.filter(this._selectCollection.toJSON(),function(item){return item.tabName==relyData[0].rely});if(relyByObjData.length){var scopeTabEl=self.$el.find("[data-tab-name="+relyData[0].tabName+"]");if(scopeTabEl)scopeTabEl.removeClass("disable")}}},_tabClickHandler:function(tabName,node){switch(tabName){case"date":{this._renderDateView(node,tabName)}break;case"status":{this._renderDropdownListView(node,tabName)}break;case"source":{this._renderDropdownListView(node,tabName)}break;case"department":{this._showUserSelectView(node,tabName)}break;case"staff":{this._showUserSelectView(node,tabName)}break;case"sort":{this._renderDropdownListView(node,tabName)}break;case"scope":{if(node.hasClass("disable"))return;this._renderDropdownListView(node,tabName)}break;case"class":{this._renderClassView(node,tabName)}break;default:this.clickExtendTabCallback(tabName,node)}},_removeActive:function(){this.$el.find(".tab-item-active").removeClass("tab-item-active")},_renderDateView:function(node,tabName){var tab=this.model.get("tab"),defaultOption={isShowDateView:true,isShowLongView:false,isShowCycleView:false,viewType:"date",rangepickerOptions:{startDate:moment().startOf("month").format("YYYY/MM/DD"),endDate:moment().endOf("month").format("YYYY/MM/DD"),format:"YYYY/MM/DD",timePicker:false}},itemTab=Talent._.filter(tab,function(item){return item.tabName==tabName})[0],options=itemTab.options;options=Talent._.extend({},defaultOption,options);this.dateTimePickerView&&this.dateTimePickerView.close();this.dateTimePickerView=new DateTimePickerView(options);this.listenTo(this.dateTimePickerView,"sure",function(dateNode,data){itemTab.choseData=data;this._dealChoseData(node,tabName,itemTab);this._removeActive()},this);this.listenTo(this.dateTimePickerView,"cancel",function(){this._removeActive()});this.$el.append(this.dateTimePickerView.render().el);this.dateTimePickerView.onShow();this.dateTimePickerView.show(node,{container:this.$el,pos:"bottom"})},_renderDropdownListView:function(node,tabName){var tab=this.model.get("tab"),options=_.extend({},Talent._.filter(tab,function(item){return item.tabName==tabName})[0]),dorpDownListView="dorpDownList"+tabName+"View",storeData=this.model.get("storeData");if(_.isArray(storeData)&&storeData.length>0){_.each(storeData,function(item){if(item.tabName==tabName&&item.data&&item.data.activeOrder!==undefined&&item.data.activeOrder!==""){if(item.data.isMult){_.each(options.data,function(i){if(i.title!="baseline"&&item.data.activeOrder.indexOf(i.order[0])<0){i.checked=false}})}options.activeOrder=item.data.activeOrder}})}if(!this[dorpDownListView]){this[dorpDownListView]=new DorpDownListView({model:new Talent.Model(options),isMult:options.isMult||false});this.listenTo(this[dorpDownListView],"chose",function(data){this._dealChoseData(node,tabName,data)});this.listenTo(this[dorpDownListView],"close",function(data){this._removeActive()});this.listenTo(this[dorpDownListView],"saveSort",function(data,infoTxt){this._saveFilterData("sort",data,infoTxt)});this.$el.append(this[dorpDownListView].render().$el)}this[dorpDownListView].show({container:this.$el,node:node})},_dealUserSelectViewCollection:function(tabName){var node=this.$el.find("[data-tab-name="+tabName+"]"),viewName="select"+tabName+"View",viewNameCollection=tabName+"userSelectorCollection",self=this,tab=this.model.get("tab"),itemTab=Talent._.filter(tab,function(item){return item.tabName==tabName})[0];this[viewNameCollection]=new UserSelectorCollection;if(itemTab.options.getContactAPI){this[viewNameCollection].getContact=itemTab.options.getContactAPI}this[viewNameCollection].getDepartmentData=function(){var self=this;var deferred=new $.Deferred;var collectionData=[];$.ajax({url:Talent.Context.getApiUrl("department/All"),type:"GET",success:function(resp){if(resp&&resp.Code==1){var collectionData=resp.Data||[];Talent._.map(collectionData,function(value,key){value.count=value.TotalUserCount;value.Data=[];value.type="department"});deferred.resolve(collectionData)}else{deferred.resolve([])}}});return deferred.promise()}},_renderClassView:function(node,tabName){var tab=this.model.get("tab"),defaultOption={viewType:"multi"},options=Talent._.filter(tab,function(item){return item.tabName==tabName})[0].options;options=Talent._.extend({},defaultOption,options);this.classView&&this.classView.close();options.resultData=this._getClassData();this.classView=new ClassComponentView(options);this.listenTo(this.classView,"submit",function(data){if(_.isArray(data)&&!_.isEmpty(data))this._dealChoseData(node,tabName,data);this._removeActive()});this.listenTo(this.classView,"reset",function(){var classModel=this._selectCollection.findWhere({tabName:"class"});this._removeActive();if(classModel){this._selectCollection.remove(classModel);this._renderFilterResultView();this.trigger("result",this._selectCollection.toJSON())}this.classView.close()});this.listenTo(this.classView,"cancel",function(){this._removeActive()});(options.container||this.$el).append(this.classView.render().$el);this.classView.show(node,{container:options.container||this.$el,pos:"bottom"})},_getClassData:function(){var classData=_.findWhere(this._selectCollection.toJSON(),{tabName:"class"}),arr=[];if(classData){_.each(classData.data.choseData,function(item){arr.push({id:item.id,name:item.name})})}return arr},_showUserSelectView:function(node,tabName){var self=this,tab=this.model.get("tab"),viewNameCollection=tabName+"userSelectorCollection",defaultOption={department:{muti:true,showTab:true,viewType:"muti",listType:"Department",tab:["Department"],input:false,hasSerchBtn:false,titleName:"选择部门",searchTitle:"已选",emptyText:{Department:""},focusinListType:"Department",getDepartmentPeople:false,container:this.$el},staff:{viewType:"single",muti:true,container:this.$el}},viewName="select"+tabName+"View",options=Talent._.filter(tab,function(item){return item.tabName==tabName})[0].options;options=_.extend({},defaultOption[tabName],options);if(!this[viewName]){this[viewName]=new UserSelector({collection:this[viewNameCollection]})}this.listenTo(this[viewName],"submit",function(user){this.stopListening(this[viewName],"submit");if(user.data){this._dealChoseData(node,tabName,user.data)}else{var arr=[];arr.push(user);this._dealChoseData(node,tabName,arr)}this._removeActive()});this.listenTo(this[viewName],"close",function(user){this.stopListening(this[viewName],"close");this._removeActive()});this[viewName].showDialog(util.userSelectorConfig(options),node)},_addParticipator:function(node,type,data){var self=this,noTotalUserCount=Talent._.filter(data,function(item){if(type=="staff"&&item["type"]&&item["type"]=="department"){return item["allItem"]["count"]==0}}),hasTotalUserCount=Talent._.filter(data,function(item){if(type=="staff"&&item["type"]&&item["type"]=="department"){return item["allItem"]["count"]!=0}else{return item}});if(noTotalUserCount&&noTotalUserCount.length){var noTotalUserCountName=Talent._.pluck(noTotalUserCount,"name"),body="所选的 "+noTotalUserCountName.join("、")+" 部门人员为空,不能添加!";this.infoTipView&&this.infoTipView.destroy();this.infoTipView=new InfoTipView;this.listenTo(this.infoTipView,"hide",function(){});this.infoTipView.bindNode(node,{type:"remind",placement:"bottom",container:this.$el,ico:"warn",trigger:"manual",body:body});this.infoTipView.show()}return Talent._.map(hasTotalUserCount,function(item){return{id:item["id"]||item["Id"],email:item["type"]=="department"?item["name"]+":"+item["id"]+":dep_members":item["Email"],name:(item["name"]||item["Name"])+(item["type"]=="department"&&type=="Staff"?"的人员":""),color:item["UserAvatar"]?item["UserAvatar"]["Color"]:"#7890bd",avatarsUrl:item["UserAvatar"]?item["UserAvatar"]["Small"]:"",department:item["type"]=="department"?true:false}})},_dealChoseData:function(node,tabName,data){var self=this,fromeStoreData=false,itemTab=_.filter(this.model.get("tab"),function(item){return item.tabName==tabName})[0];if(tabName=="department"||tabName=="staff"){var data=this._addParticipator(node,tabName,data);if(!data.length)return}if(this._selectCollection.findWhere({tabName:tabName})){if(tabName=="department"||tabName=="staff"||tabName=="class"){var choseData=this._delRepeatData(tabName,data).choseData;data=new Object(itemTab);data.choseData=choseData}this._selectCollection.findWhere({tabName:tabName}).set({tabName:tabName,data:data.modelData?data.modelData:data})}else{var model=new Talent.Model({tabName:tabName,data:data.modelData?data.modelData:data});if(tabName=="department"||tabName=="staff"||tabName=="class"){model.set("data",_.extend({},itemTab,{choseData:data}))}else{model.set("data",data.modelData?data.modelData:data)}this._selectCollection.push(model)}this.trigger("result",this._selectCollection.toJSON());this._changeTabTittleByResult(data);if(!itemTab.inResult)return;this._renderFilterResultView(fromeStoreData)},_delRepeatData:function(name,data){var oldData=this._selectCollection.findWhere({tabName:name}).get("data");Talent._.each(data,function(item){var hasData=false;Talent._.each(oldData.choseData,function(i){if(i.id==item.id)hasData=true});if(!hasData)oldData.choseData.push(item)});return oldData},_changeTabTittleByResult:function(data){var modelData=data.modelData||{},title=data.title;if(modelData.changeTabTitle){this.$el.find("[data-tab-name="+modelData.tabName+"]").find("[data-name=item-name]").html(title)}},addResultFromExtend:function(extendResultData,status){status=status||"update";var hasData=this.extendResultData.findWhere({groupName:extendResultData.groupName});if(hasData){this.extendResultData.remove(hasData)}if(status=="update"){this.extendResultData.push(extendResultData)}this._renderFilterResultView(false)},_renderFilterResultView:function(fromeStore){var self=this;this._showInResultCollection=new Talent.Collection;Talent._.each(this._selectCollection.toJSON(),function(item){var model=new Talent.Model,obj=self._dealResultModel(item);if(obj){model.set(obj);if(item.data.inResult){self._showInResultCollection.add(model)}}});var extendResultData=this.extendResultData.toJSON();if(!_.isEmpty(extendResultData)){this._showInResultCollection.push(extendResultData)}if(!this._showInResultCollection.length){this.filterResultView&&this.filterResultView.close();return}this.filterResultView&&this.filterResultView.close();this.filterResultView=new FilterResultView({collection:this._showInResultCollection,fromeStore:fromeStore,saveResult:this.model.get("saveFilterResult")});this.listenTo(this.filterResultView,"closeItem",function(data){this.trigger("closeItem",data);this._dealDelItem(data)});this.listenTo(this.filterResultView,"clear",function(){var sortData=_.findWhere(this._selectCollection.toJSON(),{tabName:"sort"}),storeData=this.model.get("storeData")||[];if(sortData){this._selectCollection.reset(sortData);this.model.set("storeData",[sortData])}else{this._selectCollection.reset();this.model.unset("storeData")}this.trigger("clear",this._selectCollection.toJSON())});this.listenTo(this.filterResultView,"save",function(node){this._saveFilterData("filter",this._selectCollection.toJSON())});this.listenTo(this.filterResultView,"cancelSave",function(node){this._unSaveFilterData(node)});this.resultWrap.show(this.filterResultView)},_saveFilterData:function(name,data,infoTxt){var options={},saveAPI,queryParams,self=this,saveRequest;if(name=="filter"){if(!_.isArray(data)||_.isEmpty(data))return;saveRequest=this.model.get("saveFilterResult").saveRequest}else if(name=="sort"){saveRequest=data[0].savaRequest}saveRequest(data).done(function(resp){if(infoTxt){self.saveInfotipView&&self.saveInfotipView.destroy();self.saveInfotipView=new InfoTipView;self.saveInfotipView.bindNode(self.$el.find("[data-tab-name=sort]"),{type:"remind",placement:"bottom",container:self.$el,ico:"success",trigger:"manual",body:infoTxt});self.saveInfotipView.show()}}).fail(function(msg){})},_unSaveFilterData:function(node){var unSaveFilterInfotip=new InfoTipView,self=this;unSaveFilterInfotip.bindNode(node,{placement:"bottom",align:"right",container:this.$el,type:"confirm",trigger:"manual",body:"确定取消吗？取消后将不再记住以上条件",okHide:function(){var unSaveRequest=self.model.get("saveFilterResult").unSaveRequest;unSaveRequest().done(function(resp){self.filterResultView.$el.find("[data-name=save-btn]").show();self.filterResultView.$el.find("[data-name=cancel-save-btn]").hide()}).fail(function(msg){});unSaveFilterInfotip.destroy()}});unSaveFilterInfotip.show()},_dealResultModel:function(item){var tabName=item.tabName,obj,groupList,activeOrderArr;switch(tabName){case"date":{obj={groupTittle:this._getFilterGroupTittle(item.data,tabName),groupName:tabName,groupList:[{val:item.data.choseData.startDate+"-"+item.data.choseData.endDate,data:item.data}]}}break;case"department":{obj={groupTittle:this._getFilterGroupTittle(item,tabName),groupName:tabName,groupList:[]};groupList=[];Talent._.each(item.data.choseData,function(i){groupList.push({val:i["name"],data:i})});obj.groupList=groupList}break;case"staff":{obj={groupTittle:this._getFilterGroupTittle(item.data,tabName),groupName:tabName,groupList:[]};groupList=[];Talent._.each(item.data.choseData,function(i){groupList.push({val:i["name"],data:i})});obj.groupList=groupList;var scopeTabEl=this.$el.find("[data-tab-name=Scope]");if(scopeTabEl)scopeTabEl.removeClass("disable")}break;case"class":{obj={groupTittle:this._getFilterGroupTittle(item,tabName),groupName:tabName,groupList:[]};groupList=[];Talent._.each(item.data.choseData,function(i){if(i.type){i.tabType=i.type}groupList.push({val:i["name"],data:i})});obj.groupList=groupList}break;case"status":{obj={groupTittle:"状态",groupName:tabName,groupList:[]};activeOrderArr=item.data.activeOrder!=""?String(item.data.activeOrder).split(","):[];if(item.data.isMult){_.each(item.data.data,function(i){if(_.indexOf(activeOrderArr,String(i.order[0]))>-1&&i.title!="baseline"){obj.groupList.push({val:i.title,data:item.data})}});obj.isMult=true}else{obj.groupList=[{val:this._getFilterGroupItemValByOrder(item.data.activeOrder,tabName),data:item.data}]}}break;case"source":{obj={groupTittle:"来源",groupName:tabName,groupList:[]};activeOrderArr=item.data.activeOrder!=""?String(item.data.activeOrder).split(","):[];if(item.data.isMult){_.each(item.data.data,function(i){if(_.indexOf(activeOrderArr,String(i.order[0]))>-1&&i.title!="baseline"){obj.groupList.push({val:i.title,data:item.data})}});obj.isMult=true}else{obj.groupList=[{val:this._getFilterGroupItemValByOrder(item.data.activeOrder,tabName),data:item.data}]}}break;case"scope":{obj={groupTittle:this._getFilterGroupTittle(item,tabName),groupName:tabName,groupList:[]};activeOrderArr=item.data.activeOrder!=""?String(item.data.activeOrder).split(","):[];if(item.data.isMult){_.each(item.data.data,function(i){if(_.indexOf(activeOrderArr,String(i.order[0]))>-1&&i.title!="baseline"){obj.groupList.push({val:i.title,data:item.data})}});obj.isMult=true}else{obj.groupList=[{val:this._getFilterGroupItemValByOrder(item.data.activeOrder,tabName),data:item.data}]}}break;case"sort":{obj={groupTittle:this._getFilterGroupTittle(item,tabName),groupName:tabName,groupList:[{val:this._getFilterGroupItemValByOrder(item.data.activeOrder,tabName),data:item.data}]}}break;default:var hasData=this.extendResultData.findWhere({groupName:tabName});if(hasData){this.extendResultData.remove(hasData)}this.extendResultData.push(this.dealextendStoreDataCallback(tabName,item))}return obj},_getFilterGroupTittle:function(item,tabName){return Talent._.filter(this.model.get("tab"),function(i){return i.tabName==tabName})[0].tabTitle},_getFilterGroupItemValByOrder:function(order,tabName){var tab=this.model.get("tab"),data=_.findWhere(tab,{tabName:tabName}).data,tabTitle;_.each(data,function(item){var inThisOrder=false;if(_.indexOf(item.order,String(order))>-1){tabTitle=item.title}});return tabTitle},_dealDelItem:function(data){var groupName=data.groupName,groupData=this._selectCollection.findWhere({tabName:groupName}).get("data"),findInSelectCollectionData=this._selectCollection.findWhere({tabName:groupName});switch(groupName){case"date":{this._selectCollection.remove(this._selectCollection.findWhere({tabName:groupName}))}break;case"department":{var depArr=[];Talent._.each(groupData.choseData,function(i){if(data.modelData["data"]["id"]!=i["id"])depArr.push(i)});if(depArr.length){var oldData=this._selectCollection.findWhere({tabName:"department"}).get("data");oldData.choseData=depArr;this._selectCollection.findWhere({tabName:"department"}).set("data",oldData)}else{this._selectCollection.remove(this._selectCollection.findWhere({tabName:"department"}))}}break;case"staff":{var userArr=[];Talent._.each(groupData.choseData,function(i){if(data.modelData["data"]["id"]!=i["id"])userArr.push(i)});if(userArr.length){var oldData=this._selectCollection.findWhere({tabName:"staff"}).get("data");oldData.choseData=userArr;this._selectCollection.findWhere({tabName:"staff"}).set("data",oldData)}else{this._selectCollection.remove(this._selectCollection.findWhere({tabName:"staff"}));this._showInResultCollection.remove(this._showInResultCollection.findWhere({groupName:"scope"}));this._selectCollection.remove(this._selectCollection.findWhere({tabName:"scope"}));var scopeTabData=_.findWhere(_.flatten(this.model.get("tab")),{tabName:"scope"});if(this.dorpDownListscopeView){this.dorpDownListscopeView.model.set("activeOrder",scopeTabData.activeOrder);this.dorpDownListscopeView.render()}else{var storeData=this.model.get("storeData");if(_.isArray(storeData)&&storeData.length>0){this.model.set("storeData",_.filter(storeData,function(item){return item.tabName!="scope"}))}}var scopeTabEl=this.$el.find("[data-tab-name=scope]");if(scopeTabEl)scopeTabEl.addClass("disable")}}break;case"class":{var classArr=[];Talent._.each(groupData.choseData,function(i){if(data.modelData["data"]["id"]!=i["id"])classArr.push(i)});if(classArr.length){var oldData=this._selectCollection.findWhere({tabName:"class"}).get("data");oldData.choseData=classArr;this._selectCollection.findWhere({tabName:"class"}).set("data",oldData)}else{this._selectCollection.remove(this._selectCollection.findWhere({tabName:"class"}))}}break;case"status":{var satausTabData=_.filter(this.model.get("tab"),{tabName:"status"})[0],storeData=_.filter(this.model.get("storeData"),{tabName:"status"})[0];if(groupData.isMult){var dropDownData;if(this.dorpDownListstatusView){dropDownData=this.dorpDownListstatusView.model.toJSON().data}else{dropDownData=satausTabData.data}var self=this,activeOrder=[],allNotChecked=true;if(!self.dorpDownListstatusView){_.each(dropDownData,function(item){if(item.title!="baseline"&&storeData.data.activeOrder.indexOf(item.order[0])<0)item.checked=false})}_.each(dropDownData,function(item){if(item.title==data.modelData.val){item.checked=false;allChecked=false}if(item.checked&&item.title!="baseline")activeOrder.push(item.order[0]);if(item.title!="baseline"&&item.checked)allNotChecked=false});if(allNotChecked){_.each(dropDownData,function(item){if(item.title!="baseline"){item.checked=true;activeOrder.push(item.order[0])}});this._selectCollection.remove(findInSelectCollectionData)}else{findInSelectCollectionData.set("isMult",true);var oldData=findInSelectCollectionData.get("data");oldData.data=dropDownData;oldData.activeOrder=activeOrder.join(",")}if(this.dorpDownListstatusView){this.dorpDownListstatusView.model.set("data",dropDownData).set("activeOrder",activeOrder.join(","));this.dorpDownListstatusView.setOriginData()}}else{this._selectCollection.remove(findInSelectCollectionData);if(this.dorpDownListstatusView){this.dorpDownListstatusView.model.set("activeOrder",satausTabData.activeOrder);this.dorpDownListstatusView.render()}else{var storeData=this.model.get("storeData");if(_.isArray(storeData)&&storeData.length>0){this.model.set("storeData",_.filter(storeData,function(item){return item.tabName!="status"}))}}var title=_.filter(satausTabData.data,function(item){if(item.order){return _.indexOf(item.order,satausTabData.activeOrder)>-1}});if(findInSelectCollectionData.get("data").changeTabTitle){if(title.length>0){this.$el.find("[data-tab-name=status]").find("[data-name=item-name]").html(title[0].title)}else{this.$el.find("[data-tab-name=status]").find("[data-name=item-name]").html(satausTabData.title)}}}}break;case"source":{var satausTabData=_.filter(this.model.get("tab"),{tabName:"source"})[0],storeData=_.filter(this.model.get("storeData"),{tabName:"source"})[0];if(groupData.isMult){var dropDownData;if(this.dorpDownListsourceView){dropDownData=this.dorpDownListsourceView.model.toJSON().data}else{dropDownData=satausTabData.data}var self=this,activeOrder=[],allNotChecked=true;if(!self.dorpDownListsourceView){_.each(dropDownData,function(item){if(item.title!="baseline"&&storeData.data.activeOrder.indexOf(item.order[0])<0)item.checked=false})}_.each(dropDownData,function(item){if(item.title==data.modelData.val){item.checked=false;allChecked=false}if(item.checked&&item.title!="baseline")activeOrder.push(item.order[0]);if(item.title!="baseline"&&item.checked)allNotChecked=false});if(allNotChecked){_.each(dropDownData,function(item){if(item.title!="baseline"){item.checked=true;activeOrder.push(item.order[0])}});this._selectCollection.remove(this._selectCollection.findWhere({tabName:groupName}))}else{this._selectCollection.findWhere({tabName:groupName}).set("isMult",true);var oldData=this._selectCollection.findWhere({tabName:groupName}).get("data");oldData.data=dropDownData;oldData.activeOrder=activeOrder.join(",")}if(this.dorpDownListsourceView){this.dorpDownListsourceView.model.set("data",dropDownData).set("activeOrder",activeOrder.join(","));this.dorpDownListsourceView.setOriginData()}}else{this._selectCollection.remove(this._selectCollection.findWhere({tabName:groupName}));if(this.dorpDownListsourceView){this.dorpDownListsourceView.model.set("activeOrder",satausTabData.activeOrder);this.dorpDownListsourceView.render()}else{var storeData=this.model.get("storeData");if(_.isArray(storeData)&&storeData.length>0){this.model.set("storeData",_.filter(storeData,function(item){return item.tabName!="source"}))}}var title=_.filter(satausTabData.data,function(item){if(item.order){return _.indexOf(item.order,satausTabData.activeOrder)>-1}});if(findInSelectCollectionData.get("data").changeTabTitle){if(title.length>0){this.$el.find("[data-tab-name=source]").find("[data-name=item-name]").html(title[0].title)}else{this.$el.find("[data-tab-name=source]").find("[data-name=item-name]").html(satausTabData.title)}}}}break;case"sort":{this._selectCollection.remove(this._selectCollection.findWhere({tabName:groupName}))}break;case"scope":{var scopeTabData=_.findWhere(_.flatten(this.model.get("tab")),{tabName:"scope"}),storeData=_.filter(this.model.get("storeData"),{tabName:"scope"})[0];if(groupData.isMult){var dropDownData;if(this.dorpDownListscopeView){dropDownData=this.dorpDownListscopeView.model.toJSON().data}else{dropDownData=scopeTabData.data}var self=this,activeOrder=[],allNotChecked=true;if(!self.dorpDownListscopeView){_.each(dropDownData,function(item){if(item.title!="baseline"&&storeData.data.activeOrder.indexOf(item.order[0])<0)item.checked=false})}_.each(dropDownData,function(item){if(item.title==data.modelData.val){item.checked=false;allChecked=false}if(item.checked&&item.title!="baseline")activeOrder.push(item.order[0]);if(item.title!="baseline"&&item.checked)allNotChecked=false});if(allNotChecked){_.each(dropDownData,function(item){if(item.title!="baseline"){item.checked=true;activeOrder.push(item.order[0])}});this._selectCollection.remove(this._selectCollection.findWhere({tabName:groupName}))}else{this._selectCollection.findWhere({tabName:groupName}).set("isMult",true).get("data").data=dropDownData;var oldData=this._selectCollection.findWhere({tabName:groupName}).get("data");oldData.data=dropDownData;oldData.activeOrder=activeOrder.join(",")}if(this.dorpDownListscopeView){this.dorpDownListscopeView.model.set("data",dropDownData).set("activeOrder",activeOrder.join(","));this.dorpDownListscopeView.setOriginData()}}else{this._selectCollection.remove(this._selectCollection.findWhere({tabName:groupName}));if(this.dorpDownListscopeView){this.dorpDownListscopeView.model.set("activeOrder",scopeTabData.activeOrder);this.dorpDownListscopeView.render()}else{var storeData=this.model.get("storeData");if(_.isArray(storeData)&&storeData.length>0){this.model.set("storeData",_.filter(storeData,function(item){return item.tabName!="scope"}))}}}}break;default:{this.dealExtendDeleteCallback(data);return}}this.trigger("result",this._selectCollection.toJSON())}});var dropDownDataMapping={status:[{title:"进行中",order:["1"],checked:true},{title:"已完成",order:["2"],checked:true},{title:"baseline"},{title:"审批中",order:["3"],checked:true},{title:"已驳回",order:["4"],checked:true},{title:"已过期",order:["5"],checked:true},{title:"已撤销",order:["6"],checked:true}],source:[{title:"工作计划",order:["1"],checked:true},{title:"招聘",order:["203"],checked:true},{title:"绩效管理",order:["400"],checked:true},{title:"目标管理",order:["402"],checked:true},{title:"客户支持",order:["600"],checked:true},{title:"职业发展",order:["500"],checked:true}],scope:[{title:"ta负责的",order:["1"],checked:true},{title:"ta关注的",order:["2"],checked:true},{title:"ta审批的",order:["3"],checked:true},{title:"ta分管的",order:["4"],checked:true}],sort:[{title:"创建时间",order:["1","2"],tip:[{txt:"点击后最晚创建的在最前面",order:"1"},{txt:"点击后最早创建的在最前面",order:"2"}]},{title:"开始时间",order:["3","4"],tip:[{txt:"点击后最晚开始的在最前面",order:"3"},{txt:"点击后最早开始的在最前面",order:"4"}]},{title:"结束时间",order:["5","6"],tip:[{txt:"点击后最晚结束的在最前面",order:"5"},{txt:"点击后最早结束的在最前面",order:"6"}]},{title:"完成时间",order:["8","7"],tip:[{txt:"点击后最晚完成的在最前面",order:"7"},{txt:"点击后最早完成的在最前面",order:"8"}]}]};var SearchSortFilter=Talent.Layout.extend({template:JST["search-sort-filter/search-filter"],className:"tt-search-filter",ui:{searchWrap:"[data-name=search-wrap]",chartBtn:"[data-name=chart-btn]"},regions:{filterWrap:"[data-name=filter-tab-wrap]"},events:function(){var events={};events["click "+this.ui.chartBtn]="_chartBtnClickHandler";return events},defaults:{tab:["data","status","source","department","staff","scope","class","sort"],tabResizeChange:true,tabOptions:{date:{tabTitle:"时间",tabLeftLine:false,inResult:true,options:{}},department:{tabTitle:"部门",tabLeftLine:false,inResult:true,options:{}},staff:{tabTitle:"人员",inResult:true,tabLeftLine:false,options:{}},"class":{tabTitle:"分类",inResult:true,tabLeftLine:false,options:{zIndex:1030}},status:{tabTitle:"状态",inResult:true,isMult:false,allCheckedName:"全部状态",data:[],viewType:"dropDownList",changeTabTitle:false,tabLeftLine:false,activeOrder:""},source:{tabTitle:"来源",inResult:true,isMult:true,allCheckedName:"全部来源",data:[],viewType:"dropDownList",changeTabTitle:false,tabLeftLine:false,activeOrder:""},sort:{tabTitle:"排序",inResult:false,changeTabTitle:true,data:[],viewType:"dropDownList",activeOrder:"",clickItemHide:false,tabLeftLine:false,saveSuccessInfo:"",save:{support:false,saveRequest:function(){}}},scope:{activeOrder:"",tabTitle:"范围",inResult:true,isMult:true,allCheckedName:"全部范围",changeTabTitle:false,rely:"",data:[],viewType:"dropDownList",tabLeftLine:false}},storeData:[],saveFilterResult:{support:false,saveRequest:function(){},unSaveRequest:function(){}},search:{show:true,placeholder:"请输入关键字"},chart:{show:false},afterSearchInResultBar:[],extendTab:[],dealextendStoreDataCallback:function(tabName,data){},clickExtendTabCallback:function(tabName,node){},dealExtendDeleteCallback:function(data){}},initialize:function(){this._initOptions(this.options);this.$el.off("click.tt-search-filter");this.$el.on("click.tt-search-filter",function(ev){ev.stopPropagation()})},_initOptions:function(options){var self=this,opt=options,defOpt=this.defaults.tabOptions,tab;if(_.isArray(opt.tab)){tab=opt.tab}else{tab=this.defaults.tab}var tabArr=[];Talent._.each(tab,function(item){var obj=Talent._.extend({},defOpt[item],opt.tabOptions&&opt.tabOptions[item]||{},{tabName:item});if(obj.viewType==="dropDownList"){var data=obj.data,mappingData=dropDownDataMapping[item],arr=[];if(_.isEmpty(data)){arr=mappingData}else{Talent._.each(data,function(i){if(self._isNumber(i)){Talent._.each(mappingData,function(j){if(_.indexOf(j.order,String(i))>-1){arr.push(j)}})}if(_.isArray(i)&&!_.isEmpty(i)){Talent._.each(mappingData,function(j){if(_.indexOf(j.order,String(i[0]))>-1){arr.push(j)}})}if(_.isObject(i)&&!_.isArray(i)&&!_.isEmpty(i)){arr.push(i)}})}obj.data=arr}tabArr.push(obj)});this.options.tab=tabArr;this.settings=Talent._.extend({},this.defaults,this.options);if(_.isArray(this.settings.extendTab)&&!_.isEmpty(this.settings.extendTab)){this.settings.tab=this.settings.tab.concat(this.settings.extendTab)}delete this.settings.tabOptions;this.model=new Talent.Model(this.settings)},_isNumber:function(val){if(!_.isObject(val)&&_.isNumber(+val)&&!_.isNaN(+val)){return true}else{return false}},onRender:function(){if(this.settings.search["show"]){this._renderSearchView()}},onShow:function(){this._renderFilterTabView();$("body").trigger("OEMGlobalFind.loadSuccess")},_renderFilterTabView:function(){this.filterTabView&&this.filterTabView.close();this.filterTabView=new FilterTabView({model:this.model});this.listenTo(this.filterTabView,"clear",function(data){this._renderFilterTabView();if(this.settings.search.show)this._renderSearchView();this.trigger("result",data)});this.listenTo(this.filterTabView,"closeItem",function(data){this.trigger("closeItem",data)});this.listenTo(this.filterTabView,"result",function(data){if(this.settings.search.show)this._renderSearchView();this.trigger("result",data)});this.filterWrap.show(this.filterTabView)},_renderSearchView:function(){this.searchView&&this.searchView.close();this.searchView=new FilterSearchView({placeholder:this.settings.search["placeholder"],type:this.settings.search["type"]});this.listenTo(this.searchView,"search",function(val){this.model.set("storeData",[]);this.model.set("storeData",this._afterSearchDeal());this._renderFilterTabView();this.trigger("search",val)});this.listenTo(this.searchView,"cancel",function(){this.model.set("storeData",this._afterSearchDeal());this._renderFilterTabView();this.trigger("search");

});this.ui.searchWrap.append(this.searchView.render().$el)},_afterSearchDeal:function(){var selectCollection=this.filterTabView._selectCollection&&this.filterTabView._selectCollection.toJSON()||[];afterSearchInResultBar=this.model.get("afterSearchInResultBar"),storeData=this.model.get("storeData")||[],newStoreData=[];if(!storeData.length&&selectCollection.length&&afterSearchInResultBar.length){Talent._.each(selectCollection,function(item){var r=afterSearchInResultBar.indexOf(item.tabName);if(r>-1){newStoreData.push(item)}});storeData=newStoreData}return storeData},_chartBtnClickHandler:function(ev){ev.stopPropagation();if(this.settings.chart.show){var node=$(ev.currentTarget);this.trigger("chartClick",node)}}});var FilterSearchView=Talent.ItemView.extend({template:JST["search-sort-filter/search"],className:"tt-new-filter-search",defaults:{placeholder:"请输入关键字",isShowDelete:true},templateHelpers:function(){return{searchName:(new Date).getTime(),placeholder:this.settings.placeholder,isShowDelete:this.settings.isShowDelete,type:this.settings.type}},ui:{searchBody:"[data-name=search-body]",input:"[data-name=input]",searchBtn:"[data-name=search-btn]",cancelBtn:"[data-name=cancel-btn]",searchBox:"[data-name=search-box]",placeholder:"[data-name=placeholder]"},events:function(){var events={};events["focus "+this.ui.input]="_inputFocusHandler";events["blur "+this.ui.input]="_inputBlurHandler";events["input "+this.ui.input]="_inputInputHandler";events["keydown "+this.ui.input]="_inputKeydownHandler";events["click "+this.ui.searchBtn]="_searchBtnClickHandler";events["click "+this.ui.cancelBtn]="_cancelBtnClickHandler";events["mousedown "+this.ui.searchBox]="_stopProp";return events},initialize:function(){this.settings=Talent._.extend({},this.defaults,this.options);this.isSearch=false;this.$el.on("mousedown",function(ev){ev.stopPropagation()})},onRender:function(){var self=this;this.ui.input.bind("propertychange",function(event){self._inputInputHandler(event,self)})},inputFocus:function(){this.ui.input.focus()},_stopProp:function(ev){ev.stopPropagation()},_inputFocusHandler:function(ev){ev.stopPropagation();this.ui.searchBody.addClass("tu-input-focus");this.ui.cancelBtn.show()},_inputBlurHandler:function(ev){ev.stopPropagation();var node=$(ev.currentTarget),val=node.val();if(val==""){this.ui.searchBody.removeClass("tu-input-focus");this.ui.cancelBtn.hide();this.ui.placeholder.show();if(this.isSearch){this.isSearch=false;this.trigger("cancel",val)}}},_inputInputHandler:function(ev,that){ev.stopPropagation();var node=$(ev.currentTarget),val=node.val(),self=ev.type=="propertychange"?that:this;if(val==""){self.ui.placeholder.show()}else{self.ui.placeholder.hide()}},_inputKeydownHandler:function(ev){ev.stopPropagation();var val=$.trim(this.ui.input.val());if(ev&&ev.keyCode==13){if(val){this._searchBtnClickHandler(ev)}else{this.trigger("cancel",val);this.isSearch=false}}},_searchBtnClickHandler:function(ev){ev.stopPropagation();var val=$.trim(this.ui.input.val());if(val){this.isSearch=true;this.trigger("search",val)}else{this.isSearch=false}},_cancelBtnClickHandler:function(ev){ev.stopPropagation();var val=$.trim(this.ui.input.val());if(this.isSearch){this.isSearch=false;this.trigger("cancel",val)}this.render()}});var titaWidget={PublistMblogView:PublistMblogView,TaskTrackVIew:FeedTrackView,TrackView:FeedTrackView,CommentListView:CommitListView,FeedListView:FeedListView,FeedExtraInfoListView:FeedExtraInfoListView,TaskCreateView:TaskCreateView,TaskListView:TaskListView,TaskDetailView:TaskDetailView,PullScreenView:PullScreenView,TipDialogView:TipDialogView,ConfirmDialogView:ConfirmDialogView,TDialogView:TDialogView,TipInfoView:TipInfoView,UploaderComponentView:UploaderComponentView,AttachmentListView:AttachmentListView,DateTimePickerView:DateTimePickerView,ClassComponentView:ClassComponentView,PlanDataJson:PlanDataJson,MembershipView:MembershipView,SetPosition:Context.setPosition,EmotionView:EmotionView,SetNoticeView:SetNoticeView,RewardDetailView:RewardDetailView,ShareRangeView:ShareRangeView,SearchView:SearchView,LoadingView:LoadingView,RedRemindView:RedRemindView,TagItemView:TagItemView,TagAddDialogView:TagAddDialogView,TagAddView:TagAddView,SearchFormView:SearchFormView,EvaluationView:EvaluationView,ImgPreviewView:ImgPreviewView,YearMonthWeekDropdown:YearMonthWeekDropdown,MultipleTaskListView:MultipleTaskListView,SearchSortFilter:SearchSortFilter,ErrorMessageView:ErrorLayoutMessageView,TaskRelateModalView:TaskRelateModalView,util:util,OperationStatusView:OperationStatusView,TaskListQuickCommontView:TaskListQuickCommontView};return titaWidget});