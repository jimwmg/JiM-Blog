/*! tita-web-v4 - v0.4.0 - 2018-07-09 20:51 */
function NoticeSettingTita(a){this.conf=a,this._init()}function NoticeSettingTitaSingleton(a){return new NoticeSettingTita(a)}function dhtmlxEvent(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,c)}function dataProcessor(a){return this.serverProcessor=a,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this._headers=null,this._payload=null,this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhx4._eventable(this),this}!function(a){function b(b){this.itemsCount=b.itemsCount,this.pageSize=b.pageSize,this.displayPage=b.displayPage<5?5:b.displayPage,this.pages=Math.ceil(b.itemsCount/b.pageSize)||1,this.total=a.isNumeric(b.pages)&&(this.pages=b.pages),this.currentPage=b.currentPage,this.styleClass=b.styleClass,this.onSelect=b.onSelect,this.showCtrl=b.showCtrl||!1,this.remote=b.remote,this.displayInfoType=b.displayInfoType}b.prototype={_draw:function(){for(var a='<div class="tu-pagination-container tu-clearfix"><div class="tu-pagination-total"></div><div class="tu-pagination',b=0;b<this.styleClass.length;b++)a+=" "+this.styleClass[b];a+='"></div></div>',this.hookNode.html(a),this._drawInner(),this._drawTotal()},_drawTotal:function(){if(this.itemsCount&&this.displayInfoType){var a=this.hookNode.find(".tu-pagination-total"),b=this.pageSize*this.currentPage-this.pageSize+1,c=this.currentPage==this.pages?this.itemsCount:this.pageSize*this.currentPage,d="显示 <span>"+b+"</span>－<span>"+c+"</span> 项，共<span>"+this.itemsCount+"</span>项";a.html(d)}},_drawInner:function(){var a=this.hookNode.find(".tu-pagination"),b='<ul><li class="prev'+(this.currentPage-1<=0?" disabled":" ")+'"><a href="javascript:void(0)"  data="'+(this.currentPage-1)+'">&lt;</a></li>';if(this.pages<=this.displayPage||this.pages==this.displayPage+1)for(var c=1;c<this.pages+1;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>";else if(this.currentPage<this.displayPage-1){for(var c=1;c<this.displayPage;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>";b+='<li class="dotted"><span>...</span></li>',b+='<li><a href="javascript:void(0)"  data="'+this.pages+'">'+this.pages+"</a></li>"}else if(this.currentPage>this.pages-this.displayPage+2&&this.currentPage<=this.pages){b+='<li><a href="javascript:void(0)"  data="1">1</a></li>',b+='<li class="dotted"><span>...</span></li>';for(var c=this.pages-this.displayPage+2;c<=this.pages;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>"}else{b+='<li><a href="javascript:void(0)"  data="1">1</a></li>',b+='<li class="dotted"><span>...</span></li>';var d,e,f=(this.displayPage-3)/2;(this.displayPage-3)%2==0?d=e=f:(d=Math.floor(f),e=Math.ceil(f));for(var c=this.currentPage-d;c<=this.currentPage+e;c++)b+=c==this.currentPage?'<li class="active"><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>":'<li><a href="javascript:void(0)"  data="'+c+'">'+c+"</a></li>";b+='<li class="dotted"><span>...</span></li>',b+='<li><a href="javascript:void(0)"  data="'+this.pages+'">'+this.pages+"</a></li>"}b+='<li class="next'+(this.currentPage+1>this.pages?" disabled":" ")+'"><a href="javascript:void(0)"  data="'+(this.currentPage+1)+'">&gt;</a></li></ul>',1==this.pages&&(b=""),this.showCtrl&&(b+=this._drawCtrl()),a.html(b)},_drawCtrl:function(){var a='<div>&nbsp;<span>&nbsp;到&nbsp;<input type="text" class="page-num"/><button class="page-confirm">确定</button>&nbsp;页</span></div>';return a},_ctrl:function(){function b(){var b=parseInt(d.find(".page-num").val());a.isNumeric(b)&&b<=c.pages&&b>0&&(c.remote||(c.currentPage=b,c._drawInner()),a.isFunction(c.onSelect)&&c.onSelect.call(a(this),b))}var c=this,d=c.hookNode.children(".tu-pagination");d.on("click",".page-confirm",function(a){b.call(this)}),d.on("keypress",".page-num",function(a){13==a.which&&b.call(this)})},_select:function(){var b=this;b.hookNode.find(".tu-pagination").on("click","a",function(c){c.preventDefault();var d=parseInt(a(this).attr("data"));a(this).parent().hasClass("disabled")||a(this).parent().hasClass("active")||(b.remote||(b.currentPage=d,b._drawInner(),b._drawTotal()),a.isFunction(b.onSelect)&&b.onSelect.call(a(this),d))})},init:function(a,b){return this.hookNode=b,this._draw(),this._select(),this.showCtrl&&this._ctrl(),this},updateItemsCount:function(b,c){this.itemsCount=b,a.isNumeric(b)&&(this.pages=Math.ceil(b/this.pageSize)),this.currentPage=this.currentPage>this.pages?this.pages:this.currentPage,a.isNumeric(c)&&(this.currentPage=c),this._drawInner(),this._drawTotal()},updatePages:function(b,c){a.isNumeric(b)&&(this.pages=b),this.currentPage=this.currentPage>this.pages?this.pages:this.currentPage,a.isNumeric(c)&&(this.currentPage=c),this._drawInner(),this._drawTotal()},goToPage:function(b){a.isNumeric(b)&&b<=this.pages&&b>0&&(this.currentPage=b,this._drawInner(),this._drawTotal())}};var c=a.fn.TPagination;a.fn.TPagination=function(c){var d=a.extend({},a.fn.TPagination.defaults,"object"==typeof c&&c);"string"==typeof c&&(args=a.makeArray(arguments),args.shift());var e=a(this),f=e.data("tu-pagination");return f?"string"==typeof c&&f[c].apply(f,args):e.data("tu-pagination",f=new b(d).init(d,a(this))),f},a.fn.TPagination.Constructor=b,a.fn.TPagination.noConflict=function(){return a.fn.pagination=c,this},a.fn.TPagination.defaults={pageSize:20,pages:null,displayPage:8,currentPage:1,itemsCount:0,displayInfoType:!0,styleClass:[],onSelect:null,remote:!1}}(window.jQuery),define("$.pagination",["$"],function(){}),jQuery(function(a){a.datepicker.regional["zh-CN"]={clearText:"清除",clearStatus:"清除已选日期",closeText:"关闭",closeStatus:"不改变当前选择",prevText:"<上月",prevStatus:"显示上月",prevBigText:"<<",prevBigStatus:"显示上一年",nextText:"下月>",nextStatus:"显示下月",nextBigText:">>",nextBigStatus:"显示下一年",currentText:"今天",currentStatus:"显示本月",monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthNamesShort:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],monthStatus:"选择月份",yearStatus:"选择年份",weekHeader:"周",weekStatus:"年内周次",dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesShort:["周日","周一","周二","周三","周四","周五","周六"],dayNamesMin:["日","一","二","三","四","五","六"],dayStatus:"设置 DD 为一周起始",dateStatus:"选择 m月 d日, DD",dateFormat:"yy/mm/dd",firstDay:1,initStatus:"请选择日期",chooseTime:"请选择时间",timeText:"时间：",hourText:"小时：",minuteText:"分钟：",secondText:"秒：",isRTL:!1},a.datepicker.setDefaults(a.datepicker.regional["zh-CN"])}),define("datePickerZH",["jquery.ui"],function(a){return function(){var b;return b||a.$.datePicker}}(this));var curTrigger="";if(NoticeSettingTita.prototype={_define:function(){this.id=this.conf.id||"tita",this.wrap=this.conf.wrap,this.trigger=this.conf.trigger,this.loginUserId=this.conf.loginUserId,this.tenantId=this.conf.tenantId,this.apiPath=this.conf.apiPath,this.submitCallback=this.conf.submitCallback&&"function"==typeof this.conf.submitCallback?this.conf.submitCallback:null,this.setTimeCallback=this.conf.setTimeCallback&&"function"==typeof this.conf.setTimeCallback?this.conf.setTimeCallback:null,this.resetTimeCallback=this.conf.resetTimeCallback&&"function"==typeof this.conf.resetTimeCallback?this.conf.resetTimeCallback:null,this.timer=null,this.cacheData={},this.notice=!1,this.curTrigger,this.triggerData={},this.opsType="add",this.conf.fetchNotice&&(this.fetchNotice=this.conf.fetchNotice)},_init:function(){this._define(),this.render(),this.addPublicEvent()},getApiUrl:function(a){var b=this.loginUserId,c=this.tenantId,d=this.apiPath;return d+"/api/v1/"+c+"/"+b+"/"+a},render:function(a){if(!this.wrap||!this.wrap.length){this.wrap=$(this.tplLayout()).attr("id","noticesetting_"+this.id);var b=$("body").find("#noticesetting_"+this.id);b.length?this.wrap=b:this.wrap.appendTo(document.body)}this.build()},build:function(){this.wrap.html(this.tpl()),this.dayE=this.wrap.find(".day_time_nst"),this.dayinputE=this.dayE.find("label"),this.daytimewrapE=this.dayE.find(".day_timewrap_nst"),this.dayvaluesE=this.dayE.find(".dayvalues_nst"),this.weektimevalueE=this.dayE.find(".weektimevalue_nst"),this.monthtimevalueE=this.dayE.find(".monthtimevalue_nst"),this.dayTimepickerE=this.dayE.find(".day_timepicker_nst"),this.nomoretimeE=this.dayE.find(".nomoretime_nst"),this.hisE=this.wrap.find(".his_time_nst"),this.timeinputE=this.wrap.find(".timecur_nst"),this.timevaluesE=this.hisE.find(".timevalues_nst"),this.miniteE=this.wrap.find(".minite_time_nst"),this.minitecurE=this.wrap.find(".minitecur_nst"),this.miniteinputE=this.wrap.find(".minitecur_nst"),this.minitevaluesE=this.wrap.find(".minitevalues_nst"),this.descE=this.wrap.find(".desc_nst"),this.descInput=this.wrap.find("textarea"),this.sureE=this.wrap.find(".sure_btn_nst"),this.cancelE=this.wrap.find(".cancel_btn_nst"),this.clearE=this.wrap.find(".clear_btn_nst"),this.tipE=this.wrap.find(".tip_nst");var a=new Date,b=a.getFullYear(),c=a.getMonth(),d=a.getDate(),e=a.getHours(),f=this._cumsumTime();23==e&&(d+=1);var g=this;this.dayTimepickerE.datepicker({minDate:new Date(b,c,d),maxDate:new Date(f.year,f.month,f.day,0,0),dateFormat:"yy/mm/dd",onSelect:function(a){g.dayinputE.html(a),g.dayinputE.attr({cyctype:0,uservalue:a}),g.dayvaluesE.find("li,dd").removeClass("cur_nst"),g.dayvaluesE.find("li[uservalue^='"+a+"']").addClass("cur_nst"),g.hideSubview()},onClose:function(){}}),this._addPrivateEvent()},addPublicEvent:function(){var a=this;this.trigger.off("click.notice"),this.trigger.off("focus"),this.trigger.on("click.notice",function(b){var c=$(this);if(b.stopPropagation(),a.curTrigger=c,curTrigger=c,a.notice=c.attr("notice"),a.notice)a.notice=!0,a.fetchNotice(),a.wrap.find(".cancel_btn_nst").html("清除");else{var d=c.attr("data");if(!d)return;d=$.parseJSON(d),a.triggerData=d,a.fetchNotice({obj_id:d.objid,obj_type:d.objType},c)}var e=a.curTrigger.parents(".name_mltali");e.length&&a.curTrigger.css("visibility","visible")}).bind("focus",function(){var a=$(this);a.blur()}),this.wrap.unbind("mouseover"),this.wrap.bind("mouseover",function(){$(this)})},fetchNotice:function(a,b){var c=this;$.ajax({url:c.getApiUrl("RemindV2/Get"),type:"get",dataType:"json",data:a,success:function(d){if(1==d.Code){var e=d.Data;if(d.Data){e=d.Data[0];var f=c.wrap.attr("id"),g="Notice:"+f;$(document).trigger(g,e.Users)}c.resetData(e,a),c.resetView(e,b)}}})},resetData:function(a,b){if(0==a.Id)this.opsType="add",this.build(),this.wrap.attr("opsType","add"),this.wrap.attr("noticeid","0"),this.wrap.find(".clear_btn_nst").hide();else{this.opsType="update",this.wrap.attr("opsType","update"),this.wrap.attr("noticeid",a.Id),this.wrap.attr({objType:a.ObjType,objid:a.OjbId});var c=a.Content.split("<b>");1==c.length&&(c=a.Content.split("(")),this.wrap.find("textarea").val($.trim(c[0])),this.wrap.find(".clear_btn_nst").show();var d=a.CycType;d||(d="0"),d=""+d;var e=d.split("_");d=e[0];var f,g,h,i,j=a.Date;if(j&&(dateArr=j.split(" "),f=dateArr[0].replace(/-/g,"/"),g=dateArr[1].substr(0,2),i=dateArr[1].substr(3,5)),1==d)this.dayE.find(".everyday_nst").trigger("click"),h=f;else if(2==d)this.dayE.find(".everyworkday_nst").trigger("click");else if(3==d)this.weektimevalueE.find("dd[uservalue='"+e[1]+"']").trigger("click");else if(4==d)this.monthtimevalueE.find("dd[uservalue='"+e[1]+"']").trigger("click");else{ymdArr=f.split("/"),hArr=g.split(":");var k=new Date(ymdArr[0],parseInt(ymdArr[1])-1,ymdArr[2],hArr[0]);k<new Date;var l=f;this.wrap.find(".day_time_nst label").html(l).attr({uservalue:l,cyctype:0});var m=this.wrap.find(".dayvalues_nst li[uservalue='"+f+" 00:00']");m.length?m.trigger("click"):this.dayTimepickerE.datepicker("setDate",f)}this.wrap.find(".timevalues_nst li[label='"+g+"']").trigger("click"),this.minitevaluesE.find("li[label='"+i+"']").trigger("click");a.Date}},hideView:function(){if(this.hideSubview(),this.wrap.hide(),this.curTrigger&&this.curTrigger.length){var a=this.curTrigger.parents(".name_mltali");a.length&&this.curTrigger.css("visibility","")}},_addPrivateEvent:function(){var a=this,b=this.dayvaluesE.find(".other_nst"),c=this.dayvaluesE.find(".weektime_nst"),d=this.dayvaluesE.find(".monthtime_nst");this.dayE.bind("click",function(b){var c=$(this);b.stopPropagation(),c.addClass("cur_day_time_nst"),a.dayinputE.focus(),a.hideSubview(),a.daytimewrapE.show()}),this.dayinputE.bind("blur",function(){a.dayE.removeClass("cur_day_time_nst")});var e=this.dayvaluesE.find("li,dd"),f=this.dayvaluesE.find("li:not(.other_nst,.weektime_nst,.monthtime_nst)");f.bind("click",function(b){var c=$(this);b.stopPropagation(),a.dayE.removeClass("cur_day_time_nst");var d=c.attr("uservalue"),f=d.split(" ");a.descE.css("visibility","visible"),a.hisE.css("visibility","visible"),c.hasClass("everyday_nst")?(a.dayinputE.html(c.attr("label")),a.dayinputE.attr({cyctype:1,uservalue:a.formatDate(new Date,"yyyy/MM/dd")})):c.hasClass("everyworkday_nst")?(a.dayinputE.html(c.attr("label")),a.dayinputE.attr({cyctype:2,uservalue:a.formatDate(new Date,"yyyy/MM/dd")})):c.hasClass("nomoretime_nst")?(a.dayinputE.val(c.attr("label")),a.dayinputE.attr({cyctype:-1,uservalue:0}),a.descE.css("visibility","hidden"),a.hisE.css("visibility","hidden")):(a.dayinputE.html(f[0]),a.dayinputE.attr({cyctype:0,uservalue:f[0]})),a.daytimewrapE.hide(),e.removeClass("cur_nst"),c.addClass("cur_nst")}).bind("mouseover",function(e){e.stopPropagation(),a.weektimevalueE.hide(),a.monthtimevalueE.hide(),a.dayTimepickerE.hide(),b.find("a:first").removeClass("a_hover"),c.find("a:first").removeClass("a_hover"),d.find("a:first").removeClass("a_hover")}),b.bind("mouseover",function(e){$(this);e.stopPropagation(),a.weektimevalueE.hide(),a.monthtimevalueE.hide(),a.dayTimepickerE.show(),b.find("a:first").addClass("a_hover"),c.find("a:first").removeClass("a_hover"),d.find("a:first").removeClass("a_hover"),a.dayE.removeClass("cur_day_time_nst")}),c.bind("mouseover",function(e){$(this);e.stopPropagation(),a.weektimevalueE.show(),a.monthtimevalueE.hide(),a.dayTimepickerE.hide(),b.find("a:first").removeClass("a_hover"),c.find("a:first").addClass("a_hover"),d.find("a:first").removeClass("a_hover"),a.dayE.removeClass("cur_day_time_nst")}),d.bind("mouseover",function(e){$(this);e.stopPropagation(),a.weektimevalueE.hide(),a.monthtimevalueE.show(),a.dayTimepickerE.hide(),b.find("a:first").removeClass("a_hover"),c.find("a:first").removeClass("a_hover"),d.find("a:first").addClass("a_hover"),a.dayE.removeClass("cur_day_time_nst")});var g=c.find("dd");g.bind("click",function(b){var d=$(this);b.stopPropagation(),a.dayinputE.html("每"+d.attr("label")),a.dayinputE.attr({cyctype:3,uservalue:d.attr("uservalue")}),a.daytimewrapE.hide(),e.removeClass("cur_nst"),d.addClass("cur_nst"),c.find("a:first").addClass("a_hover"),a.dayE.removeClass("cur_day_time_nst")});var h=d.find("dd");h.bind("click",function(b){var c=$(this);b.stopPropagation(),a.dayinputE.html("每月"+c.attr("uservalue")+"号"),a.dayinputE.attr({cyctype:4,uservalue:c.attr("uservalue")}),a.daytimewrapE.hide(),e.removeClass("cur_nst"),c.addClass("cur_nst"),d.find("a:first").addClass("a_hover"),a.dayE.removeClass("cur_day_time_nst")});var i=this.timevaluesE.find("li");this.hisE.bind("click",function(b){var c=$(this);b.stopPropagation(),c.addClass("cur_his_time_nst"),a.timeinputE.focus(),a.hideSubview(),a.timevaluesE.show()}),this.timeinputE.bind("blur",function(){a.hisE.removeClass("cur_his_time_nst")}),i.bind("click",function(b){var c=$(this);b.stopPropagation(),a.timeinputE.attr({label:c.attr("label"),uservalue:c.attr("uservalue")}).html(c.attr("label")),a.timevaluesE.hide(),i.removeClass("cur_nst"),c.addClass("cur_nst"),a.hisE.removeClass("cur_his_time_nst")}),this.miniteE.bind("click",function(b){var c=$(this);b.stopPropagation(),c.addClass("cur_minite_time_nst"),a.miniteinputE.focus(),a.hideSubview(),a.minitevaluesE.show()}),this.miniteinputE.bind("blur",function(){a.miniteE.removeClass("cur_minite_time_nst")});var j=this.minitevaluesE.find("li");j.bind("click",function(b){var c=$(this);b.stopPropagation(),a.miniteinputE.attr({label:c.attr("label"),uservalue:c.attr("uservalue")}).html(c.attr("label")),a.minitevaluesE.hide(),j.removeClass("cur_nst"),c.addClass("cur_nst"),a.miniteE.removeClass("cur_minite_time_nst")}),this.descInput.bind("focus",function(a){var b=$(this),c=b.val(),d=b.attr("defaultvalue");c==d&&b.val(""),b.removeClass("default_nst"),b.addClass("cur_desc_nst")}).bind("blur",function(a){var b=$(this),c=b.val();""==c&&(b.val(b.attr("defaultvalue")),b.addClass("default_nst")),b.removeClass("cur_desc_nst")}),this.sureE.bind("click",function(){var b=a.validateData(),c=a.wrap.attr("opsType");if(b.isValidate){var d="";a.notice?(a.tipE.html(""),a.hideView(),a.setTimeCallback(b.data)):(d="update"==c?a.getApiUrl("RemindV2/UpdateReminds"):a.getApiUrl("RemindV2/Add"),a._submit(b.data,d))}}),this.cancelE.bind("click",function(){a.hideView(),a.notice&&a.resetTimeCallback()}),this.clearE.bind("click",function(){var b=a.getApiUrl("RemindV2/DeleteReminds"),c=a.wrap.attr("objtype"),d=a.wrap.attr("objid");a.clearDate({obj_id:d,obj_type:c},b)}),this.wrap.bind("click",function(b){b.stopPropagation(),a.hideSubview()}),this.daytimewrapE.bind("click",function(a){a.stopPropagation()})},clearDate:function(a,b){var c=this,d=this.triggerData.objid,e=this.triggerData.objType;d&&e||(d=a.obj_id,e=a.obj_type),$.ajax({url:b+"?obj_id="+d+"&obj_type="+e,dataType:"json",type:"get",success:function(a){c.hideView(),curTrigger.removeClass("notice_settinged"),"function"==typeof c.submitCallback&&(curTrigger.time="",c.submitCallback(curTrigger))},error:function(a){c._showErrorTip(a)}})},_showErrorTip:function(a){var b=this;this.tipE.html('<span class="error">'+a+"</span>"),setTimeout(function(){b.tipE.html("")},1e3)},validateData:function(){var a={isValidate:!0,data:{}},b=$.trim(this.descInput.val()),c=this;if(b.replace(/[^\x00-\xff]/g,"**").length>40)return this.tipE.html('<span class="error">提醒内容不能超过20个汉字或40个字符</span>'),setTimeout(function(){c.tipE.html("")},1e3),a.isValidate=!1,a;var d=this.descInput.attr("defaultvalue");b==d&&(b=""),a.data.content=b;var e=this.dayinputE.attr("cyctype"),f=this.timeinputE.attr("label"),g=this.dayinputE.attr("uservalue"),h=this.miniteinputE.attr("uservalue"),i=f+":"+h;if(1==e||2==e)a.data.cyc_type=e,a.data.time=g+" "+i;else if(3==e||4==e){var j=new Date,k=j.getFullYear(),l=j.getMonth()+1,m=j.getDate();10>l&&(l="0"+l),10>m&&(m="0"+m);var n=k+"/"+l+"/"+m+" ";a.data.cyc_type=e+"_"+g,a.data.time=n+i}else if(-1==e)a.data.cyc_type=e,a.data.time="";else if(a.data.cyc_type=e,a.data.time=g+" "+i+":00",new Date>new Date(a.data.time))return this.tipE.html('<span class="error">不能设置过去的时间</span>'),setTimeout(function(){c.tipE.html("")},1e3),a.isValidate=!1,a;return a},_submit:function(a,b){var c=this,d=a,e=new Array,f=this.wrap.find(".ux_user_area");curTrigger.idLen=f.length;for(var g=0;g<f.length;g++)e.push(f[g].id);var h=e.join(",");d.obj_id=this.triggerData.objid,d.obj_type=this.triggerData.objType,d.obj_id||d.obj_type||(d.obj_id=this.wrap.attr("objid"),d.obj_type=this.wrap.attr("objtype")),d.remind_user_ids=h,$.ajax({url:b+"?time="+d.time,dataType:"json",type:"post",data:d,success:function(a){return 0==a.Code?void c.tipE.html('<span class="success">'+a.Message+"</span>"):(c.tipE.html('<span class="success">设置提醒成功</span>'),void setTimeout(function(){c.tipE.html(""),c.hideView(),d.remind_user_ids||(d.time=""),c.setTrigger(d),"function"==typeof c.submitCallback&&(curTrigger.time=d.time,c.submitCallback(curTrigger))},1e3))},error:function(){}})},setTrigger:function(a){a.time?curTrigger.addClass("notice_settinged"):curTrigger.removeClass("notice_settinged"),this.notice&&this.trigger("setTime",a)},resetView:function(a,b){this.wrap.show();var c=this.wrap.width(),d=b.offset(),e=b.innerWidth(),f=b.innerHeight(),g=this.wrap.find(".sa_nst"),h=g.position().left,i=g.find("em").innerWidth(),j=g.find("em").innerHeight(),k=d.left+e/2-h-i/2,l=d.top+f+j/2,m=document.documentElement||document.body,n=m.clientWidth;m.clientHeight;0>k&&(g.css({left:d.left+e/2}),k=0),c+k>n&&(k=n-c,g.css({left:d.left-k-2.5})),this.wrap.css({left:k,top:l}),this.tipE.html("")},hideSubview:function(){this.daytimewrapE.hide(),this.weektimevalueE.hide(),this.monthtimevalueE.hide(),this.dayTimepickerE.hide(),this.timevaluesE.hide(),this.minitevaluesE.hide()},showView:function(){},_cumsumTime:function(){var a=new Date,b=432e8,c=a.getTime()+b;a.setTime(c);var d=a.getFullYear(),e=a.getMonth(),f=a.getDate();return{year:d,month:e,day:f}},tpl:function(){for(var a="yyyy/MM/dd hh:mm",b=new Date,c=b.getFullYear(),d=b.getMonth(),e=b.getDate(),f=b.getHours(),g=(b.getSeconds(),b.getDay()),h=f,i=[],j={6:"六",0:"日",1:"一",2:"二",3:"三",4:"四",5:"五"},k="",l="",m=0;7>m;m++){var n=new Date(c,d,e+m).getDay();l="",23==h?g>n?k="下周"+j[n]:n==g?(l="cur_nst",k="明天"):k="本周"+j[n]:g>n?k="下周"+j[n]:n==g?(l="cur_nst",k="今天"):k=n==g+1?"明天":"本周"+j[n],i.push('<li class="'+l+'" label="'+k+'" uservalue="'+this.formatDate(new Date(c,d,e+m),a)+'"><a href="javascript:void(0)">'+k+"</a></li>")}for(var o=[],m=0;31>m;m++)o.push('<dd uservalue="'+(m+1)+'" label="'+(m+1)+'"><a href="javascript:void(0)">'+(m+1)+"</a></dd>");for(var p=[],q="",m=0;24>m;m++)q=10>m?"0"+m:m,p.push('<li label="'+q+'" uservalue="'+m+'"><a href="javascript:void(0)">'+q+"</a></li>");for(var r=["00","05","10","15","20","25","30","35","40","45","50","55"],s=[],m=0;m<r.length;m++)s.push('<li label="'+r[m]+'" uservalue="'+r[m]+'"><a href="javascript:void(0)">'+r[m]+"</a></li>");var t=this.formatDate(new Date(c,d,e,f,m),"yyyy/MM/dd"),u=23==h?f:f+1,v=10>u?"0"+u:u,w=['	<div class="outer_nst">','		<div class="sa_nst"><em>◆</em><span>◆</span></div>','		<div class="content_nst">','			<div class="wrap_time_nst clearfix">','				<span class="timelabel_nst mylock">提醒时间</span>','				<div class="day_time_nst">','					<a class="triday_nst" href="javascript:void(0)"></a>','					<label cyctype="0" uservalue="'+t+'">'+t+"</label>",'					<div class="day_timewrap_nst">','						<div class="day_timepicker_nst"></div>','						<ul class="dayvalues_nst">',i.join(""),'							<li label="其它日期" uservalue="0" class="other_nst">','								<a href="javascript:void(0)">其它日期</a>',"							</li>",'							<li class="everyday_nst" label="每天" uservalue="1"><a href="javascript:void(0)">每天</a></li>','							<li class="everyworkday_nst" label="每个工作日" uservalue="2"><a href="javascript:void(0)">每个工作日</a></li>','							<li label="每周" uservalue="3" class="weektime_nst">','								<a href="javascript:void(0)">每周</a>','								<dl class="weektimevalue_nst">','									<dd uservalue="2" label="周一"><a href="javascript:void(0)">周一</a></dd>','									<dd uservalue="3" label="周二"><a href="javascript:void(0)">周二</a></dd>','									<dd uservalue="4" label="周三"><a href="javascript:void(0)">周三</a></dd>','									<dd uservalue="5" label="周四"><a href="javascript:void(0)">周四</a></dd>','									<dd uservalue="6" label="周五"><a href="javascript:void(0)">周五</a></dd>','									<dd uservalue="7" label="周六"><a href="javascript:void(0)">周六</a></dd>','									<dd uservalue="1" label="周日"><a href="javascript:void(0)">周日</a></dd>',"								</dl>","							</li>",'							<li label="每月" uservalue="11" class="monthtime_nst">','								<a href="javascript:void(0)">每月</a>','								<dl class="monthtimevalue_nst">',o.join(""),"								</dl>","							</li>","						</ul>","					</div>","				</div>",'				<div class="his_time_nst">					','					<a class="tritime_nst" href="javascript:void(0)"></a>','					<label class="timecur_nst" uservalue="'+u+'" label="'+v+'">'+v+"</label>",'					<ul class="timevalues_nst">',p.join(""),"					</ul>					",'				</div><div style="float:left;font-weight:bold;line-height:30px;margin-left:3px;margin-right:-7px;">:</div>','				<div class="minite_time_nst">','					<a class="triminite_nst" href="javascript:void(0)"></a>','					<label class="minitecur_nst" uservalue = "00" label="00">00</label>','					<ul class="minitevalues_nst">',s.join(""),"					</ul>","				</div>","			</div>",'			<div data-name="person-list"></div>','			<div class="desc_nst">','				<textarea class="default_nst" defaultValue="提醒内容">提醒内容</textarea>',"			</div>",'			<div class="tip_nst"></div>','			<div class="btn_nst">','				<a class="clear_btn_nst" href="javascript:void(0)">取消提醒</a>','				<a class="sure_btn_nst" href="javascript:void(0)">确定</a>','				<a class="cancel_btn_nst" href="javascript:void(0)">取消</a>',"			</div>","		</div>","	</div>"];return w.join("")},tplLayout:function(){var a=['<div class="wrap_noticesetting_tita" noticeid="0">',"</div>"];return a.join("")},formatDate:function(a,b){var c={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var d in c)new RegExp("("+d+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?c[d]:("00"+c[d]).substr((""+c[d]).length)));return b}},define("$.notice.set",["jquery.ui","datePickerZH"],function(a){return function(){var b;return b||a.NoticeSettingTitaSingleton}}(this)),define("views/common/plan/plan-item-status-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/plan/plan-item-status"],className:"tt_changestatusview",events:function(){var a={};return a["click li"]="changeStatusFun",a},templateHelpers:function(){var a=!1,b=this.model.get("isChildTask");return void 0!=typeof b&&(a=b),{isChildTask:a}},changeStatusFun:function(b){b.stopPropagation();var c=a.$(b.currentTarget),d=c.attr("status");this.hide(),this.model.set("status",parseInt(d)),this.trigger("click:status",this.model.toJSON())},show:function(b,c){this.$el.css({position:"absolute"}),this.$el.show(),a.Context.setPosition(b,this.$el,{container:c,pos:"bottomCenter",topBias:10,leftBias:-3})},hide:function(){this.$el.hide()}})}),define("views/more/tasks/task-list-composite-view",["talent","templates/more","$.notice.set","tdialog","views/common/plan/plan-item-status-view"],function(a,b,c,d,e){var f=a.ItemView.extend({defaults:{isShowStar:!0},ui:{setnotice:".notice_setting"},tagName:"li",className:"task_item clearfix",template:b["more/tasks/task-list"],ui:{icon_cycle:".icon-task-cycle"},onRender:function(){this.$el.attr({"data-id":this.model.get("FeedId")});var a=this.ui.icon_cycle,b=this;this.hasRequested=!1,a.on("mouseenter",function(a){b._showTitle()})},modelEvents:{"change:Status":"render"},templateHelpers:function(){var b=(this.model.toJSON(),{1:"进行中 ",2:"已完成",3:"已延迟",4:"已取消",0:"未开始",6:"暂停中",5:"未接受"}),c=this.model.get("Status");return a._.extend({},this.options,{StatusTip:b[c]})},_showTitle:function(){var b=this;b.hasRequested||a.app.request("Task:getCycleTask",{cycle_id:this.model.get("CycleId")}).done(function(a){var c=a.CycType,d=a.CycStartDate,e=a.CycEndDate,f={0:"零",1:"一",2:"二",3:"三",4:"四",5:"五",6:"六",7:"七"},g={1:"每天",2:"每个工作日",3:"每周"+(d==e?f[d]:f[d]+"-"+f[e]),4:"每月"+(d==e?d:d+"-"+e)};b.ui.icon_cycle.attr({"original-title":g[c]}),b.ui.icon_cycle.tipsy({gravity:"s"}),b.ui.icon_cycle.trigger("mouseenter"),b.hasRequested=!0}).fail(function(a){b._tipMessage(b.ui.icon_cycle,a)})},_tipMessage:function(a,b,c){this.failDialog||(this.failDialog=new d({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"bottomCenter",arrow:!1,autoHide:!0,className:c||"warn"})}}),g=a.CompositeView.extend({template:b["more/tasks/task-compsite"],itemViewContainer:".task_list_container ul",itemView:f,ui:{taskListContainer:".task_list_container"},events:{"click .sublist_ml li":"_readTabFun","click .task_status_icon":"_changeStatus"},initialize:function(){this.i18n=a.Context.getI18n(),this.iTask=this.i18n.task_1,this._gropuCollection()},onRender:function(){this.$el.find("[original-title]").tipsy({gravity:"s"}),this.$el.find(".task_item:odd").addClass("gray_item")},_gropuCollection:function(){var b=this.collection,c=_.size(b);if(c>20){for(var d=this,e=(new a.Collection,20),f=[],g=Math.ceil(c/e),h=0;g>h;h++){var i=h*e,j=i+e;f.push(b.slice(i,j))}var k=0;this.collection=new a.Collection;var l=setInterval(function(){d.collection.push(f[k]),k++,k>g&&clearInterval(l)},300)}},_changeStatus:function(b){b.stopPropagation();var c=this,d=a.$(b.currentTarget),f=d.parents("li").attr("data-id"),g=this.collection.get(f);g.get("IsEditStatus")&&($(".tipsy").hide(),a.$(".tt_changestatusview").length&&a.$(".tt_changestatusview").hide(),this.planItemStatusView?this.planItemStatusView.model.set({status:g.get("Status"),id:f}):(this.planItemStatusView=new e({model:new a.Model({status:g.get("Status"),id:f})}),this.listenTo(this.planItemStatusView,"click:status",function(b){var d=c.collection.get(b.id);d.get("Status")!=b.status&&a.app.request("Plan:updateStatusData",{queryUrl:"plan_item_id="+b.id+"&Status="+b.status}).done(function(a){var d=c.collection.get(b.id);d.set("Status",b.status),c.trigger("_changeStatus")}).fail(function(a){c._tipDialog(c.$el.find("li[data-id="+b.id+"] .task_status_icon"),a,"warn")})}),this.planItemStatusView.render(),this.ui.taskListContainer.append(this.planItemStatusView.$el),a.$(document).on("click.Plan-List-Composite:PlanItemStatus",function(){c.planItemStatusView.hide()})),this.planItemStatusView.show(d,this.$el))},_tipDialog:function(a,b,c){this.tipDialog=new d({type:"tipsy",sure:!1,cancel:!1}),$("body").append(this.tipDialog.render().$el),this.tipDialog.show(a,b,{pos:"topCenter",className:c||"success",arrow:!1,autoHide:!0})},showDialogArrow:function(b,c,e){var f=this;f.tDialogViewError||(f.tDialogViewError=new d({fixed:!1,type:"tipsy",cancel:!1,sure:!1}),f.tDialogViewError.render().$el.appendTo("body")),f.tDialogViewError.show(a.$(b),c,{arrow:1,pos:"bottomCenter",height:300,topBias:8,leftBias:-10,arrowBias:10,className:e,autoHide:!0})},onAfterClose:function(a,b){var c=this.getModel(b);c.set({Status:"2"}),this.initCount(),this.updateCollectionData(c.toJSON())},onAfterStart:function(a,b){var c=this.getModel(b);c.set({Status:"1"}),this.initCount(),this.updateCollectionData(c.toJSON())},getModel:function(a){return this.collection.where({FeedId:a})[0]},initCount:function(){var a=this.collection.where({Status:"2"}).length;this.model.set({done:a,undone:this.collection.models.length-a})},updateCollectionData:function(b){var c=this.collectionData;c=a._.map(c,function(a){return a.FeedId==b.FeedId?a=b:a}),this.collectionData=c}});return g}),define("views/more/tasks/task-tab-composite-view",["talent","templates/more"],function(a,b){var c=a.CompositeView.extend({template:b["more/tasks/task-tablist"],itemViewContainer:"ul",events:{"click li":"_clickLiHandler"},onRender:function(){var a=this.model.get("relation");this.$el.find("li").removeClass("current"),this.$el.find("li[data-type="+a+"]").addClass("current")},_clickLiHandler:function(b){var c=a.$(b.currentTarget);this.$el.find("li").removeClass("current"),c.addClass("current");var d={relation:c.attr("data-type")};this.trigger("click:tabItem",d)}});return c}),define("views/more/tasks/task-list-compent-view",["talent","templates/more","views/more/tasks/task-list-composite-view"],function(a,b,c){var d=a.ItemView.extend({template:b["more/tasks/task-list-compent"],ui:{taskList:"div[data-name=task-list]"},onRender:function(){this._renderTaskListView()},_renderTaskListView:function(){var b=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"FeedId"})}});this.taskListCompositeView||(this.taskListCompositeView=new c({collection:new b(this.model.get("TaskModels"))
}),this.ui.taskList.append(this.taskListCompositeView.render().$el))}}),e=a.CollectionView.extend({itemView:d,itemViewContainer:this.$el,events:{"click li":"_clickLiHandler"},_clickLiHandler:function(b){var c=a.$(b.currentTarget);this.$el.find("li").removeClass("current"),c.addClass("current");var d={relation:c.find("a").attr("relation")};this.trigger("click:tabItem",d)}});return e}),define("views/common/bs-tab/bs-tab",["talent"],function(a){return a.ItemView.extend({template:_.template(),initialize:function(a){this.$el=a.el,a.getActiveNodeByData&&(this.getActiveNodeByData=a.getActiveNodeByData),a.getActiveNodeByNode&&(this.getActiveNodeByNode=a.getActiveNodeByNode),a.getEventTriggerNode&&(this.getEventTriggerNode=a.getEventTriggerNode);var b=a.eventNode||"a",c=_.debounce(this.onTabClick,300,!0),d=this.$el.data("bb-cid");d&&this.$el.off(".delegateEvents"+d),this.$el.data("bb-cid",this.cid),this.events=function(){var a={};return a["click "+b]=c,a},this.activeClassName=a.activeClassName?a.activeClassName:"active"},setDefault:function(a){this.$el.find("."+this.activeClassName).removeClass(this.activeClassName);var b=this.getActiveNodeByData(a);this.activeNode=b,b.addClass(this.activeClassName)},onTabClick:function(b){var c=this,d=a.$(b.currentTarget);d.attr("outside")||(c.activeNode&&c.activeNode.removeClass(c.activeClassName),c.activeNode=c.getActiveNodeByNode(d),c.activeNode.addClass(c.activeClassName),c.options.eventTriggerName&&a.app.vent.trigger("tab:"+c.options.eventTriggerName+":change",c.getEventTriggerNode(d)))},getEventTriggerNode:function(a){return a},getActiveNodeByData:function(b){var c="";a._.each(b,function(a,b){c+=b+"="+a+"&"}),c=c.slice(0,c.length-1);var d=this.getActiveNodeByNode(this.$el.find('a[href$="'+c+'"]'));return d},getActiveNodeByNode:function(a){return a.parent()},getActiveNode:function(){return this.activeNode}})}),define("views/common/empty-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{emptyContext:""},template:b["common/empty"],className:"tt_common_emptyinit",initialize:function(a){this.settings=Talent._.extend({},this.defaults,a)},templateHelpers:function(){var a=this.settings.emptyContext?this.settings.emptyContext:this.model.get("emptyContext"),b=0;return a&&(b=a.replace(/<[^>].*?>/g,"").replace(/[&nbsp;]/g,"").length),{emptyContext:a,className:b>24?"small_content_emptyinit":"content_emptyinit"}}})}),define("views/more/tasks/index-page-view",["talent","templates/more","$.pagination","views/more/tasks/task-list-composite-view","views/more/tasks/task-tab-composite-view","views/more/tasks/task-list-compent-view","views/common/bs-tab/bs-tab","views/common/loading-view","views/common/empty-view"],function(a,b,c,d,e,f,g,h,i){var j=a.Layout.extend({template:b["more/tasks/index-page"],className:"_tt_page_container",regions:{tabList:".ms_tablist",compositeList:".meslist",isReadTab:".ms_isreadtab"},ui:{pagelist:"[data-name=pagelist]"},pageSize:20,templateHelpers:{i18n:a.Context.getI18n()},initialize:function(){this.i18n=a.Context.getI18n(),this.iTask=this.i18n.task_1,this.pageIndex=1,a.Context.setPageTitle(this.iTask),this._getRouterData()},onRender:function(){this.renderAppTabView(),this._getData()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject");c.done(function(a){b.routerData=a||{},b.routerData.relation=a.relation||1})},_getData:function(){this._rendLoadView(),this.controlPageList(1);var b=this;a.app.request("TaskCenter:getTaskListData",{relation:this.routerData.relation,pageNum:b.pageIndex,pageSize:20}).done(function(a){if(a&&a.length)b.renderTaskListCompentView(a,"task");else if(0==a.length){var c=["一个“"+b.iTask+"”会有负责人、参与人，如果是我负责的话，这个"+b.iTask+"就会显示在这","别人负责的事情，可能也会让我参与，这就是“我参与的"+b.iTask+"”","我可以布置"+b.iTask+"让别人负责完成，这就是“我给别人的"+b.iTask+"”","暂无数据","","目前没有关注任何"+b.iTask],d=new i({emptyContext:c[b.routerData.relation-1]});b.compositeList.show(d)}else if(a.FinishTaskModels)b.renderTaskListCompentView(a,"finish");else{var d=new i({emptyContext:"我完成的"+b.iTask+"都会按完成时间显示在这里"});b.compositeList.show(d)}})},renderAppTabView:function(){this.tabView=new e({collection:new a.Collection,model:new a.Model(this.routerData)}),this.listenTo(this.tabView,"click:tabItem",function(a){this.routerData.relation=a.relation,this._getData()},this),this.tabList.show(this.tabView)},_renderCompositeListView:function(b){var c=this.routerData,e=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"FeedId"})}});this.compsiteView=new d({collection:new e(b),model:new a.Model(c)}),this.compositeList.show(this.compsiteView),this.controlPageList(1)},_rendLoadView:function(){this.loadingView=new h,this.compositeList.show(this.loadingView)},renderTaskListCompentView:function(b,c){var d=this.routerData;if("finish"==c){var e=b.FinishTaskModels,g=b.Total;this.controlPageList(g)}else{var e=b;this.controlPageList(1)}this.compsiteView=new f({collection:new a.Collection(e),model:new a.Model(d)}),this.compositeList.show(this.compsiteView)},controlPageList:function(a){var b=this;this.routerData;20>=a?this.ui.pagelist.hide():(this.ui.pagelist.TPagination({styleClass:["pagination-large"],itemsCount:a,displayInfoType:"itemsCount",onSelect:function(a){b.pageIndex=a,b._getData()}}),this.ui.pagelist.show())}});return a.BasePageView.extend({mainViewClass:j,layout:window.self===window.top?"master-layout":"empty-layout"})}),define("views/common/indicatormsg/indicator-msg-view",["talent","templates/more","TitaWidget","views/common/empty-view"],function(a,b,c,d){return a.Layout.extend({template:b["more/indicatormsg/index-page"],className:"tt_fromindicator",regions:{feedList:".feedlist"},ui:{feedList:".feedlist"},pageSize:20,initialize:function(a){this._titleDeal(a)},onRender:function(){this.bulidFeed()},_titleDeal:function(b){this.routerData=b;var c=this.routerData.indicatorType,d={5:"最新回复我的",7:"最新@我的",12:"最新公告",11:"最新@项目",14:"最新@部门",8:"最新@团队",13:"最新向我讨赏"};this.model.set("pagetitle",d[c]||"最新@我的"),this.model.set("indicatorType",c),a.Context.setPageTitle(d[c]||"最新@我的")},bulidFeed:function(){var b=this;if(!this.FeedComponentView){var e=new a.$.Deferred;a.app.request("Feed:getIndicatorTypeData",{type:b.routerData.indicatorType}).done(function(e){if(e.data.length){var f={IsEnd:e.isEnd,LastId:e.lastId,feeds:e.data};b.feedItemCompositeView=new c.FeedListView({model:new a.Model(f),actionMore:{detail:!1,deleted:!0,setTop:!0},addTag:{support:!0,container:b.ui.feedList}}),b.feedList.show(b.feedItemCompositeView),b.delIndicator()}else{var g="尚无"+b.model.get("pagetitle"),h=b.routerData.indicatorType;5==h?g+=',<a href="#home?feedType=aboutme-replyme">查看所有回复我的</a>':7==h?g+=',<a href="#home?feedType=aboutme-tome">查看所有@我的</a>':8==h?g+=',<a href="#home?feedType=aboutme-tome">查看所有@我的</a>':11==h?g+=',<a href="#home?feedType=aboutme-tome">查看所有@我的</a>':12==h?g+=',<a href="#home?feedType=aboutme-tome">查看所有@我的</a>':14==h?g+=',<a href="#home?feedType=aboutme-tome">查看所有@我的</a>':13==h&&(g+=',<a href="#home?feedType=aboutme-tome">查看所有向我讨赏</a>');var i=new d({emptyContext:g});b.feedList.show(i)}}).fail(function(a){e.reject(a)})}},delIndicator:function(){var a=this.routerData.indicatorType,b="mLeaveAllIndicator",c={7:"mLeaveIndicator",5:"mCommentIndicator",12:"mLeaveAllIndicator",11:"mLeaveWorkIndicator",14:"mLeaveDepartmentIndicator",8:"mLeaveTeamIndicator"};Talent.app.vent.trigger("GlobalIndicatorDelete",{indicatorType:c[a]?c[a]:b,messageType:0})}})}),define("views/more/indicatormsg/index-page-view",["talent","templates/more","TitaWidget","views/common/empty-view","views/common/indicatormsg/indicator-msg-view"],function(a,b,c,d,e){var f=a.Layout.extend({template:a._.template(),onRender:function(){var b=a.Context.parseUrl(decodeURIComponent(location.hash));this.indicatormsgView&&this.indicatormsgView.close(),this.indicatormsgView=new e(b),this.$el.append(this.indicatormsgView.render().$el)}});return a.BasePageView.extend({mainViewClass:f,layout:window.top==window.self?"master-layout":"empty-layout"})}),define("views/more/archives/archives-side-nav-view",["talent","templates/more","views/common/bs-tab/bs-tab"],function(a,b,c){return a.CompositeView.extend({template:b["more/archives/italent-settings-side-nav"],templateHelpers:function(){return{routerData:this.routerData}},initialize:function(){this.userInfo=a.Context.getUserInfo(),this._routerData()},_routerData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a,b.routerData.appid=a.appid?a.appid:1,b.routerData.apptype=a.apptype?a.apptype:1,b.routerData.to_user_id=a.to_user_id?a.to_user_id:b.userInfo.Id,b.routerData.isMySelf=b.routerData.to_user_id==b.userInfo.Id,d.resolve()}),d}})}),define("views/more/archives/index-page-view",["talent","templates/more","views/more/archives/archives-side-nav-view","views/common/bs-tab/bs-tab"],function(a,b,c,d){var e=a.Layout.extend({template:b["more/archives/index-page"],className:"tu-row-fuild",initialize:function(){this.fetching=this._getSubNavData(),a.Context.setPageTitle("设置"),this.oriOverflow=a.$("html").css("overflow-y"),this.oriMinHeight=a.$("#main-region").css("min-height"),a.$("#main-region").css("min-height",""),this.$el.css("padding",0)},regions:{subNav:"._tt_layout_tabnav",main:"._tt_page_container"},ui:{pageTitle:".app_pagetitle",iframe:"#italent_settings_iframe",load:"._tt_loading_m"},events:function(){var a={};return a},onRender:function(){var a=this;this.collection=this.fetching.done(function(b){b.items&&b.items.length&&(a.dataList=b,a._getPageHtml(b))})},onShow:function(){this._setClientHeight(),this.bindResizeFrame=a._.bind(this.resizeFrame,this),a.$(window).on("resize",this.bindResizeFrame)},onClose:function(){a.$("html").css("overflow-y",this.oriOverflow),a.$(window).off("resize",this.bindResizeFrame),a.app.vent.off("tab:italent_settings_subnav:change")},resizeFrame:function(){a.$(window).height();this.$el.find("iframe").height()},_getPageHtml:function(){var b=this,c=this.dataList.items[0].key||"";a.app.request("history:getQueryObject").done(function(d){b.routerData=d,d.key&&""!=d.key?d.url=d.key:b.routerData.key=c,b.activeData=a._.findWhere(b.dataList.items,{key:b.routerData.key}),b._bulidPage();var e=Math.max(a.$("._tt_layout_container").height(),b.$el.height());b.$el.find("iframe").height(e)})},_bulidPage:function(){var a=this;this.ui.pageTitle.html(this.activeData.name),this._renderSubNavView(this.dataList);var b=decodeURIComponent(this.activeData.editurl),c=this.ui.iframe[0];return this.ui.load.show(),this.ui.iframe.hide(),this.ui.iframe.attr("src",b),c.attachEvent?void c.attachEvent("onload",function(){var b=c.contentWindow.document||c.document;a._iframeOnload(b)}):void(c.onload=function(){var b=c.contentWindow.document||c.document;a._iframeOnload(b)})},_iframeOnload:function(a){this.ui.iframe.show(),this.ui.load.remove()},_renderSubNavView:function(b){var e=this;this.sideNavView||(this.sideNavView=new c({model:new a.Model(b)}),this.subNav.show(this.sideNavView),this.sideBarTab=new d({el:this.$el.find("._tt_side_subnav"),eventTriggerName:"italent_settings_subnav"}),a.app.vent.on("tab:italent_settings_subnav:change",function(b){e.routerData=a.Context.parseUrl(b.attr("href")),e.activeData=a._.findWhere(e.dataList.items,{key:e.routerData.key}),e._bulidPage(),e.ui.iframe.hide(),e.ui.load.show()}),this.sideBarTab.setDefault({key:e.routerData.key}))},_getSubNavData:function(){var b=a.$.Deferred();return a.Context.getData("iTalent/user/view/recordeditmenu").done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)}),b.promise()},_setClientHeight:function(){var b=this.$el.find("._tt_layout_container"),c=a.Context.setMainRegionsHeight;c(b);var d=a._.debounce(function(){c(b)},300);$(window).off("resize.Italent-settings-IndexPageView"),$(window).on("resize.Italent-settings-IndexPageView",d)}});return a.BasePageView.extend({mainViewClass:e,refreshSidebar:!0,layout:window.top==window?"master-layout":"empty-layout",layoutViewOptions:{hideSubMenu:!1}})}),define("views/more/dailyinfo/index-page-view",["talent","templates/more","views/daily/detail/detail-index-page-view","tdialog"],function(a,b,c){var d=a.Layout.extend({template:b["more/dailyinfo/index-page"],className:"tt_shareinfo",regions:{feedList:".feedlist"},initialize:function(){a.Context.setPageTitle("日报");var b=this,c=a.app.request("history:getQueryObject");c.done(function(a){b.routerData=a})},onShow:function(){var a=this;this.detailIndexPageView=new c({id:a.routerData.id,isShowScroll:!1,isShowClosed:!1}),this.feedList.show(this.detailIndexPageView)}});return a.BasePageView.extend({mainViewClass:d,layout:window.top==window?"master-layout":"empty-layout"})}),define("views/more/shareinfo/index-page-view",["talent","templates/more","TitaWidget","$.caret"],function(a,b,c){var d=a.Layout.extend({template:b["more/shareinfo/index-page"],className:"",regions:{feedList:".feedlist"},initialize:function(){a.Context.setPageTitle("分享");var b=this,c=a.app.request("history:getQueryObject");c.done(function(a){b.routerData=a})},onShow:function(){this.requestData()},requestData:function(){var b=this;a.app.request("Feed:getItemFeed",{feed_id:this.routerData.id,comment_count:4}).done(function(d){if(!d){var e=a.Context.getEmptyTemplate("该分享不存在");return void a.$(b.regions.feedList).html(e)}var f={IsEnd:!0,LastId:"",feeds:new Array(d)};b.feedItemCompositeView=new c.FeedListView({model:new a.Model(f),actionMore:{detail:!1,deleted:!0,setTop:!0}}),b.feedList.show(b.feedItemCompositeView)})}});return a.BasePageView.extend({mainViewClass:d,layout:window.self===window.top?"master-layout":"empty-layout"})}),define("views/more/pay/you-hui-quan-view",["talent","templates/more"],function(a,b,c,d,e,f){return MainView=a.Layout.extend({template:b["more/pay/you-hui-quan"],className:"",ui:{select:"[data-name=drop-list]"},events:function(){var a={};return a["change "+this.ui.select]="_onSelect",a},_onSelect:function(b){var c=a.$(b.currentTarget);this.trigger("selectd",c.val())}})}),define("views/more/pay/pay-buy-view",["talent","templates/more","tdialog","views/more/pay/you-hui-quan-view"],function(a,b,c,d){return a.ItemView.extend({template:b["more/pay/pay-buy"],className:"tt_buyingprocess",ui:{inputWrap:"div[data-name=person-num]",input:"div[data-name=person-num] input",label:"div[data-name=person-num] label",button:"button[data-name=submit]",personTotal:"[data-name=person-total]",grossPrice:"[data-name=gross-price]",youHuiQuanBox:"div[data-name=you-hui-quan-box]",totalPrice:"[data-name=total-price]"},events:function(){var a={};return a["click "+this.ui.label]="_labelClickHander",a["focus "+this.ui.input]="_focusDownHander",a["keydown "+this.ui.input]="_keydownDownHander",a["keyup "+this.ui.input]="_keyupHander",a["blur "+this.ui.input]="_blurHander",a["click "+this.ui.button]="_submitData",a},initialize:function(){this.model.set("isBuyTrain",!1),this.model.set("personNum",0),this.price=0,this.activeYHJ=null},onRender:function(){this._getYouHuiQuanData()},_getYouHuiQuanData:function(){var a=this;Talent.app.request("Discountcard:discountCard").done(function(b){var c=b||[];a.youHuiQuanData=c,a._renderYouhuiquanView()})},_renderYouhuiquanView:function(a){var a=this.youHuiQuanData;if(a&&a.length){var b=this._activeYHQ(a);this.youHuiQuanView=new d({model:new Talent.Model({youHuiQuan:b,activeYHJ:this.activeYHJ})}),this.listenTo(this.youHuiQuanView,"selectd",function(a){for(var b=this.youHuiQuanData,c=0;c<b.length;c++){var d=b[c];d.id==a&&d.total>0&&!d.isDeadLine&&(this.activeYHJ=d)}this._totalPrice()},this),this.ui.youHuiQuanBox.html(this.youHuiQuanView.render().$el)}},_totalPrice:function(){var a=this.price;this.activeYHJ&&(a+=this.activeYHJ.price),this.ui.totalPrice.html(a.toFixed(2))},_activeYHQ:function(){var a=this.youHuiQuanData,b=!1,c=[];this.activeYHJ=null;for(var d=0;d<a.length;d++){var e=a[d];e.active=!1,this.price>=e.min&&this.price<=e.max&&e.total>0&&!e.isDeadLine&&(e.active=!0,b=!0,this.activeYHJ=e,c.push(e)),this.price>=e.min&&0==e.max&&e.total>0&&!e.isDeadLine&&0==e.max&&(e.active=!0,b=!0,this.activeYHJ=e,c.push(e))}return b?c:[]},_labelClickHander:function(){this.ui.input.focus()},_focusDownHander:function(b){a.$(b.currentTarget)},_keydownDownHander:function(b){var c=(a.$(b.currentTarget),b.keyCode);return this.ui.label.hide(),96>c||c>105?(48>c||c>57)&&8!=c?!1:!0:void 0},_keyupHander:function(b){var c=a.$(b.currentTarget),d=c.val();if(this.model.set("personNum",d),1==this.model.get("type")){d.length>10&&c.val(d.substring(0,10)),(/\s/g.test(d)||""==d)&&(d=0);var e=this.model.get("DaysLeft");this.ui.personTotal.html(d);var f=30*e*d;return this.ui.grossPrice.html(f.toFixed(2)),this.price=f,this._renderYouhuiquanView(),void this._totalPrice()}d&&d<this.model.get("OnJobUserNum")?(this.ui.inputWrap.addClass("input-error"),this.$el.find(".errortip_qbp").show()):(this.ui.inputWrap.removeClass("input-error"),this.$el.find(".errortip_qbp").hide())},_blurHander:function(b){if(1!=this.model.get("type")){var c=a.$(b.currentTarget),d=c.val();""!=d?this.ui.inputWrap.removeClass("input-error").addClass("input-blur"):this.ui.inputWrap.removeClass("input-error").removeClass("input-focus")}},_trainToggleHandler:function(b){var c=a.$(b.currentTarget),d=this.model.get("isBuyTrain");d?(this.model.set("isBuyTrain",!1),c.removeClass("checkbox-checked")):(this.model.set("isBuyTrain",!0),c.addClass("checkbox-checked"))},_submitData:function(b){var c=a.$(b.currentTarget),d=this.model.get("personNum");if(0==d)return void this.ui.inputWrap.addClass("input-error");var e=this;c.html("正在提交…");var f=[];this.activeYHJ;var g={Total:d,ProductId:this.model.get("keyCode")},h=[];this.activeYHJ&&(h=[{CardId:this.activeYHJ.id,Total:this.activeYHJ.total}]),f.push(g),a.app.request("Pay:postOrderData",{PackageId:this.model.get("PackageId"),Description:this.model.get("OrderTypeDescription"),Products:f,Cards:h}).done(function(a){c.html("提交"),e.trigger("submit",a)}).fail(function(a){c.html("提交"),e._tipDialog(c,a)})},_tipDialog:function(a,b){this.tipDialog||(this.tipDialog=new c({fixed:!1,type:"tipsy",sure:!1,cancel:!1}),this.tipDialog.render().$el.appendTo("body")),this.tipDialog.show(a,b,{arrow:!1,pos:"topCenter",arrowBias:0,autoHide:!0,className:"warn"})}})}),define("views/more/pay/pay-new-buy-view",["talent","templates/more","tdialog"],function(a,b,c){return a.ItemView.extend({template:b["more/pay/pay-new-buy"],className:"tt_buyingprocess",ui:{inputWrap:"div[data-name=ren-amount]",button:"button[data-name=submit]",chooseBtn:'span[data-name="choose-price"]',input:'div[data-name="ren-amount"] input',average:'[data-name="average"]',msgAmount:'[data-name="msg-amount"]'},events:function(){var a={};return a["focus "+this.ui.input]="_focusDownHander",a["keydown "+this.ui.input]="_keydownDownHander",a["keyup "+this.ui.input]="_keyupHander",a["blur "+this.ui.input]="_blurHander",a["click "+this.ui.button]="_submitData",a["click "+this.ui.chooseBtn]="_choosePrice",a},initialize:function(){this.model.set("personNum",0),this.msgAmount=1200},_choosePrice:function(a){var b=this.ui.chooseBtn,c=$(a.target),d=b.index(c),e={0:{amount:1200,price:100},1:{amount:2500,price:200},2:{amount:6300,price:500},3:{amount:13e3,price:1e3}},f=e[d].amount,g=(e[d].price/f).toFixed(3);this.msgAmount=f,this.ui.chooseBtn.removeClass("active"),c.addClass("active"),this.ui.msgAmount.text(f+"条"),this.ui.average.text("(折合"+g+"元/条)")},_labelClickHander:function(){this.ui.inputWrap.addClass("input-focus"),this.ui.input.focus()},_focusDownHander:function(b){a.$(b.currentTarget);this.ui.inputWrap.addClass("input-focus")},_keydownDownHander:function(b){var c=(a.$(b.currentTarget),b.keyCode);return 96>c||c>105?(48>c||c>57)&&8!=c?!1:!0:void 0},_keyupHander:function(b){var c=a.$(b.currentTarget),d=c.val();this.model.set("personNum",d),1!=this.model.get("type")&&(d&&d<this.model.get("OnJobUserNum")?(this.ui.inputWrap.addClass("input-error"),this.$el.find(".errortip_qbp").show()):(this.ui.inputWrap.removeClass("input-error"),this.$el.find(".errortip_qbp").hide()))},_blurHander:function(b){var c=a.$(b.currentTarget),d=c.val();""!=d?this.ui.inputWrap.removeClass("input-error").addClass("input-blur"):this.ui.inputWrap.removeClass("input-error").removeClass("input-focus")},_submitData:function(b){var c=a.$(b.currentTarget),d=this;c.html("正在提交…");var e=[],f=this.model.get("name");"renewal"==f?e.push({ProductId:this.model.get("keyCode"),TotalPrice:this.ui.input.val()}):e.push({ProductId:this.model.get("keyCode"),Total:this.msgAmount}),a.app.request("Pay:postOrderData",{PackageId:this.model.get("PackageId"),Description:this.model.get("Description"),Products:e}).done(function(a){c.html("提交"),d.trigger("submit",a)}).fail(function(a){c.html("提交"),d._tipDialog(c,a)})},_tipDialog:function(a,b){this.tipDialog||(this.tipDialog=new c({fixed:!1,type:"tipsy",sure:!1,cancel:!1}),this.tipDialog.render().$el.appendTo("body")),this.tipDialog.show(a,b,{arrow:!1,pos:"topCenter",arrowBias:0,autoHide:!0,className:"warn"})}})}),define("views/more/pay/pay-buy-layout-view",["talent","templates/more","views/more/pay/pay-buy-view","views/more/pay/pay-new-buy-view"],function(a,b,c,d){return a.Layout.extend({template:b["more/pay/pay-buy-layout"],className:"tt_buyingprocess",initialize:function(){},regions:{enterprise:'div[data-name="enterprise-pay"]'},templateHelpers:function(){var b=a.Context.getGlobal("tenantAuthentication").Version;return{advisorInfo:1==b?"咨询客服":"咨询顾问：小冬",advisor:1==b?"185 1139 1190":"185 1139 1191"}},onRender:function(){var a=this.model.get("keyCode");"7DFB0DAF-BBB9-47EC-ACD2-387345E4C05E"==a?this._renderPayNewBuyView():"0D0E3C93-C605-4DFA-8EBE-94FD469EE6A7"==a?this._renderPayNewBuyView("renewal"):this._getBuyTitaInfo()},_getBuyTitaInfo:function(){var b=this;a.app.request("Pay:getBuyTypeData",{order_type:this.model.get("order_type")}).done(function(a){a=a||{},a.type=b.model.get("order_type"),a.PackageId=b.model.get("PackageId"),a.keyCode=b.model.get("keyCode"),b._renderPayBuyView(a)})},_renderPayNewBuyView:function(b){this.payNewBuyView=new d({model:new a.Model({name:b,Description:"renewal"==b?"GCDF培训费":"短信",PackageId:this.model.get("PackageId"),keyCode:this.model.get("keyCode")})}),this.enterprise.show(this.payNewBuyView),this.listenTo(this.payNewBuyView,"submit",function(a){this.trigger("submit",a)},this)},_renderPayBuyView:function(b){this.payBuyView=new c({model:new a.Model(b)}),this.enterprise.show(this.payBuyView),this.listenTo(this.payBuyView,"submit",function(a){this.trigger("submit",a)},this)}})}),define("views/more/pay/order/pay-order-pop-view",["talent","templates/more"],function(a,b){return a.ItemView.extend({template:b["more/pay/order/pay-order-pop"],className:"tt_paypop",ui:{otherPay:"a[data-name=other-pay]"},templateHelpers:function(){a.Context.getUserInfo();return{tmUrl:a.Context.getGlobal("tm")||""}},events:function(){var a={};return a["click "+this.ui.otherPay]="_clickOhterPayHandler",a},_clickOhterPayHandler:function(){this.trigger("click:ohterpay")}})}),define("$.dialog",["talent"],function(a){var b=a.$(document),c=navigator.userAgent.toLowerCase(),d=a.$(window),e={ieQuirks:null,msie:/msie/.test(c)&&!/opera/.test(c),opera:/opera/.test(c)};e.ie6=e.msie&&/msie 6./.test(c)&&"object"!=typeof window.XMLHttpRequest,e.ie7=e.msie&&/msie 7.0/.test(c);var f={focus:!1,opacity:50,overlayId:"simplemodal-overlay",overlayCss:{backgroundColor:"black"},containerId:"simplemodal-container",containerCss:{},dataId:"simplemodal-data",dataCss:{},minHeight:null,minWidth:null,maxHeight:null,maxWidth:null,autoResize:!1,autoPosition:!0,zIndex:1e3,close:!0,closeHTML:'<a class="modalCloseImg" title="Close"></a>',closeClass:"simplemodal-close",escClose:!1,overlayClose:!1,fixed:!0,position:null,persist:!1,modal:!0,onOpen:null,onShow:null,onClose:null},g=0;return a.View.extend({initialize:function(){this.d=[],this.dTemp=[],this.wTemp=[],e.ieQuirks=e.msie&&!$.support.boxModel;var a=$.extend({},f),b=g++;a.overlayId=f.overlayId+"-"+b,a.containerId=f.containerId+"-"+b,a.dataId=f.dataId+"-"+b,this.o=$.extend(a,this.options),this.zIndex=this.o.zIndex,this.occb=!1},render:function(a){return this.$el.empty(),a?this.o.data=a:a=this.options.data,"object"==typeof a?(a=a instanceof $?a:$(a),this.d.placeholder=!1,a.parent().parent().size()>0&&(a.before($("<span></span>").attr("id","simplemodal-placeholder").css({display:"none"})),this.d.placeholder=!0,this.display=a.css("display"),this.o.persist||(this.d.orig=a.clone(!0)))):"string"==typeof a||"number"==typeof a?a=$("<div></div>").html(a):alert("SimpleModal Error: Unsupported data type: "+typeof a),this.create(a),this.open(),$.isFunction(this.o.onShow)&&this.o.onShow.apply(this,[this.d]),this.$el},create:function(a){this.getDimensions();var b=this,c=this.dTemp,d=this.wTemp;b.o.modal&&e.ie6&&(b.d.iframe=$('<iframe src="javascript:false;"></iframe>').css($.extend(b.o.iframeCss,{display:"none",opacity:0,position:"fixed",height:d[0],width:d[1],zIndex:b.o.zIndex,top:0,left:0})).appendTo(b.$el)),b.d.overlay=$("<div></div>").attr("id",b.o.overlayId).addClass("simplemodal-overlay").css($.extend(b.o.overlayCss,{display:"none",opacity:b.o.opacity/100,filter:"alpha(opacity="+b.o.opacity+")",height:"100%",width:b.o.modal?c[1]:0,position:"fixed",left:0,top:0,zIndex:b.o.zIndex+1})).appendTo(b.$el),b.d.container=$("<div></div>").attr("id",b.o.containerId).addClass("simplemodal-container").css($.extend({position:b.o.fixed?"fixed":"absolute"},b.o.containerCss,{display:"none",zIndex:b.o.zIndex+2})).append(b.o.close&&b.o.closeHTML?$(b.o.closeHTML).addClass(b.o.closeClass):"").appendTo(b.$el),b.d.wrap=$("<div></div>").attr("tabIndex",-1).addClass("simplemodal-wrap").css({height:"100%",outline:0,width:"100%"}).appendTo(b.d.container),b.d.data=a.attr("id",a.attr("id")||b.o.dataId).addClass("simplemodal-data").css($.extend(b.o.dataCss,{display:"none"})).appendTo("body"),a=null,b.setContainerDimensions(),b.d.data.appendTo(b.d.wrap),(e.ie6||e.ieQuirks)&&b.fixIE()},bindEvents:function(){var a=this,c=this.dTemp,f=this.wTemp;a.$el.find("."+a.o.closeClass).bind("click.simplemodal",function(b){b.preventDefault(),setTimeout(function(){a.close()},10)}),a.o.modal&&a.o.close&&a.o.overlayClose&&a.d.overlay.bind("click.simplemodal",function(b){b.preventDefault(),a.close()}),b.bind("keydown.simplemodal",function(b){a.o.modal&&9===b.keyCode?a.watchTab(b):a.o.close&&a.o.escClose&&27===b.keyCode&&(b.preventDefault(),a.close())}),d.bind("resize.simplemodal orientationchange.simplemodal",function(){a.getDimensions(),a.o.autoResize?a.setContainerDimensions():a.o.autoPosition&&a.setPosition(),e.ie6||e.ieQuirks?a.fixIE():a.o.modal&&(a.d.iframe&&a.d.iframe.css({height:f[0],width:f[1]}),a.d.overlay.css({height:c[0],width:c[1]}))})},unbindEvents:function(){$("."+this.o.closeClass).unbind("click.simplemodal"),b.unbind("keydown.simplemodal"),d.unbind(".simplemodal"),this.d.overlay.unbind("click.simplemodal")},fixIE:function(){if(e.ie6&&e.ie7){var a=this,b=a.o.position;this.dTemp,this.wTemp;$.each([a.d.iframe||null,a.o.modal?a.d.overlay:null,"fixed"===a.d.container.css("position")?a.d.container:null],function(a,c){if(c){var d="document.body.clientHeight",e="document.body.clientWidth",f="document.body.scrollHeight",g="document.body.scrollLeft",h="document.body.scrollTop",i="document.body.scrollWidth",j="document.documentElement.clientHeight",k="document.documentElement.clientWidth",l="document.documentElement.scrollLeft",m="document.documentElement.scrollTop",n=c[0].style;if(n.position="absolute",2>a)n.removeExpression("height"),n.removeExpression("width"),n.setExpression("height",""+f+" > "+d+" ? "+f+" : "+d+' + "px"'),n.setExpression("width",""+i+" > "+e+" ? "+i+" : "+e+' + "px"');else{var o,p;if(b&&b.constructor===Array){var q=b[0]?"number"==typeof b[0]?b[0].toString():b[0].replace(/px/,""):c.css("top").replace(/px/,"");if(o=-1===q.indexOf("%")?q+" + (t = "+m+" ? "+m+" : "+h+') + "px"':parseInt(q.replace(/%/,""))+" * (("+j+" || "+d+") / 100) + (t = "+m+" ? "+m+" : "+h+') + "px"',b[1]){var r="number"==typeof b[1]?b[1].toString():b[1].replace(/px/,"");p=-1===r.indexOf("%")?r+" + (t = "+l+" ? "+l+" : "+g+') + "px"':parseInt(r.replace(/%/,""))+" * (("+k+" || "+e+") / 100) + (t = "+l+" ? "+l+" : "+g+') + "px"'}}else o="("+j+" || "+d+") / 2 - (this.offsetHeight / 2) + (t = "+m+" ? "+m+" : "+h+') + "px"',p="("+k+" || "+e+") / 2 - (this.offsetWidth / 2) + (t = "+l+" ? "+l+" : "+g+') + "px"';n.removeExpression("top"),n.removeExpression("left"),n.setExpression("top",o),n.setExpression("left",p)}}})}},focus:function(a){var b=this,c=a&&-1!==$.inArray(a,["first","last"])?a:"first",d=$(":input:enabled:visible:"+c,b.d.wrap);setTimeout(function(){d.length>0?d.focus():b.d.wrap.focus()},10)},getDimensions:function(){var a="undefined"==typeof window.innerHeight?d.height():window.innerHeight;this.dTemp=[b.height(),b.width()],this.wTemp=[a,d.width()]},getVal:function(a,b){var c=this.wTemp;return a?"number"==typeof a?a:"auto"===a?0:a.indexOf("%")>0?parseInt(a.replace(/%/,""))/100*("h"===b?c[0]:c[1]):parseInt(a.replace(/px/,"")):null},update:function(a,b){var c=this;return c.d.data?(c.d.origHeight=c.getVal(a,"h"),c.d.origWidth=c.getVal(b,"w"),c.d.data.hide(),a&&c.d.container.css("height",a),b&&c.d.container.css("width",b),c.setContainerDimensions(),c.d.data.show(),c.o.focus&&c.focus(),c.unbindEvents(),void c.bindEvents()):!1},setContainerDimensions:function(){var a=this,b=e.ie6||e.ie7,c=(a.o.position,this.dTemp,this.wTemp),d=a.d.origHeight?a.d.origHeight:e.opera?a.d.container.height():a.getVal(b?a.d.container[0].currentStyle.height:a.d.container.css("height"),"h"),f=a.d.origWidth?a.d.origWidth:e.opera?a.d.container.width():a.getVal(b?a.d.container[0].currentStyle.width:a.d.container.css("width"),"w"),g=a.d.data.outerHeight(!0),h=a.d.data.outerWidth(!0);a.d.origHeight=a.d.origHeight||d,a.d.origWidth=a.d.origWidth||f;var i=a.o.maxHeight?a.getVal(a.o.maxHeight,"h"):null,j=a.o.maxWidth?a.getVal(a.o.maxWidth,"w"):null,k=i&&i<c[0]?i:c[0],l=j&&j<c[1]?j:c[1],m=a.o.minHeight?a.getVal(a.o.minHeight,"h"):"auto";d=d?a.o.autoResize&&d>k?k:m>d?m:d:g?g>k?k:a.o.minHeight&&"auto"!==m&&m>g?m:g:m;var n=a.o.minWidth?a.getVal(a.o.minWidth,"w"):"auto";f=f?a.o.autoResize&&f>l?l:n>f?n:f:h?h>l?l:a.o.minWidth&&"auto"!==n&&n>h?n:h:n,a.d.container.css({height:d,width:f}),a.d.wrap.css({overflow:g>d||h>f?"auto":"visible"}),a.o.autoPosition&&a.setPosition()},showHere:function(a){var b=a.offset();this.setPosition([b.top,b.left])},setPosition:function(a){var b,c,e=(this.dTemp,this.wTemp),f=this,g=e[0]/2-f.d.container.outerHeight(!0)/2,h=e[1]/2-f.d.container.outerWidth(!0)/2,i="fixed"!==f.d.container.css("position")?d.scrollTop():0;f.o.position&&"[object Array]"===Object.prototype.toString.call(f.o.position)?(b=i+(f.o.position[0]||g),c=f.o.position[1]||h):(b=i+g,c=h),a&&(b=a[0],c=a[1]),f.d.container.css({left:c,top:b})},watchTab:function(a){var b=this;if($(a.target).parents(".simplemodal-container").length>0){if(b.inputs=$(":input:enabled:visible:first, :input:enabled:visible:last",b.d.data[0]),!a.shiftKey&&a.target===b.inputs[b.inputs.length-1]||a.shiftKey&&a.target===b.inputs[0]||0===b.inputs.length){a.preventDefault();var c=a.shiftKey?"last":"first";b.focus(c)}}else a.preventDefault(),b.focus()},open:function(){var a=this;a.d.iframe&&a.d.iframe.show(),$.isFunction(a.o.onOpen)?a.o.onOpen.apply(a,[a.d]):(a.d.overlay.show(),a.d.container.show(),a.d.data.show()),a.o.focus&&a.focus(),a.bindEvents()},close:function(){var a=this;return a.d.data?(a.unbindEvents(),void($.isFunction(a.o.onClose)&&!a.occb?(a.occb=!0,a.o.onClose.apply(a,[a.d])):setTimeout(function(){if(a.d.placeholder){var b=$("#simplemodal-placeholder");a.o.persist?b.replaceWith(a.d.data.removeClass("simplemodal-data").css("display",a.display)):(a.d.data.hide().remove(),b.replaceWith(a.d.orig))}else a.d.data.hide().remove();a.d.container.hide().remove(),a.d.overlay.hide(),a.d.iframe&&a.d.iframe.hide().remove(),a.d.overlay.remove(),a.d={}},0))):!1}})}),define("views/more/pay/order/pay-order-view",["talent","templates/more","views/more/pay/order/pay-order-pop-view","tdialog","$.dialog"],function(a,b,c,d,e){
return a.CompositeView.extend({defaults:{isShowPayWay:!0},template:b["more/pay/order/pay-order"],className:"tt_page_container",ui:{inputWrap:"div[data-name=mobile]",input:"div[data-name=mobile] input",bankList:"ul[data-name=bankList]",goPay:"a[data-name=gopay]",bank:"input[name=bank]",concatService:"a[data-name=concat-service]",bankPay:"input[data-name=bank]",isNeedInvoice:".checkbox"},events:function(){var a={};return a["focus "+this.ui.input]="_focusDownHander",a["keydown "+this.ui.input]="_keydownDownHander",a["keyup "+this.ui.input]="_keyupHander",a["blur "+this.ui.input]="_blurHander",a["click "+this.ui.bank]="_checkedBankHandler",a["click "+this.ui.bankPay]="_clickBankPayHandler",a["click "+this.ui.goPay]="_goToPayHandler",a["click "+this.ui.concatService]="_concatServiceHandler",a["click "+this.ui.isNeedInvoice]="_isNeedInvoiceHandler",a},templateHelpers:function(){return{isShowPayWay:this.settings.isShowPayWay}},initialize:function(){this.aliModel=this.model.get("AliModel"),this.payData={order_id:this.model.get("Id"),mobile:"",default_bank:this.aliModel.PayCode,default_bank_name:this.aliModel.PayName,IsContactCustomerService:!1},this.settings=a._.extend({},this.defaults,this.options)},_focusDownHander:function(b){a.$(b.currentTarget);this.ui.inputWrap.removeClass("input-blur").addClass("input-focus")},_keydownDownHander:function(b){var c=(a.$(b.currentTarget),b.keyCode);return 96>c||c>105?(48>c||c>57)&&8!=c?!1:!0:void 0},_keyupHander:function(b){var c=a.$(b.currentTarget),d=c.val();this.payData.mobile=d,this._changeGoPayHref(),this.ui.inputWrap.removeClass("input-error")},_blurHander:function(b){var c=a.$(b.currentTarget),d=c.val();""!=d?this.ui.inputWrap.removeClass("input-error").addClass("input-blur"):this.ui.inputWrap.addClass("input-error").removeClass("input-focus")},_regMobile:function(a){var b=/^[\d\-()+]{7,20}$/;return b.test(a)?!0:!1},_clickBankPayHandler:function(){var a=$("input[data-name="+this.aliModel.PayCode+"]");a.prop("checked",!1),this.ui.bankList.slideDown();var b=this.ui.bankList.find("input:first");b.prop("checked",!0),this.payData.default_bank=b.attr("id"),this.payData.default_bank_name=b.attr("title"),this._changeGoPayHref()},_checkedBankHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("data-name");d==this.aliModel.PayCode&&(this.ui.bankPay.prop("checked",!1),this.ui.bankList.slideUp()),this.payData.default_bank=c.attr("id"),this.payData.default_bank_name=c.attr("title"),this._changeGoPayHref()},_goToPayHandler:function(b){var c=a.$(b.currentTarget),d=this.payData.mobile;return""==d?(this.ui.inputWrap.addClass("input-error").removeClass("input-focus").removeClass("input-blur"),this._tipDialog(c,"请填写手机号"),void b.preventDefault()):this._regMobile(d)?void this._overDialog():(this.ui.inputWrap.addClass("input-error").removeClass("input-focus").removeClass("input-blur"),this._tipDialog(c,"请填写正确的手机号"),void b.preventDefault())},_changeGoPayHref:function(){var a=encodeURIComponent(this.payData.default_bank_name),b="/app/payorder?orderid="+this.payData.order_id+"&mobile="+this.payData.mobile+"&defcode="+this.payData.default_bank+"&defCodeName="+a+"&IsContactCustomerService="+this.payData.IsContactCustomerService;this.ui.goPay.attr("href",b)},_tipDialog:function(a,b){this.tipDialog||(this.tipDialog=new d({fixed:!1,type:"tipsy",sure:!1,cancel:!1}),this.tipDialog.render().$el.appendTo("body")),this.tipDialog.show(a,b,{arrow:!1,pos:"topCenter",autoHide:!0,className:"warn",leftBias:30})},_overDialog:function(){this.payOrderPopView=new c,this.listenTo(this.payOrderPopView,"click:ohterpay",function(){this.popView&&this.popView.close()},this),this.popView=new e,this.popView.render(this.payOrderPopView.render().$el).appendTo(this.$el)},_concatServiceHandler:function(b){var c=a.$(b.currentTarget),d=this.payData.mobile;return""==d?(this.ui.inputWrap.addClass("input-error").removeClass("input-focus").removeClass("input-blur"),this._tipDialog(c,"请填写手机号"),void b.preventDefault()):this._regMobile(d)?void a.app.request("Pay:getOffLinePayData",{order_id:this.payData.order_id,mobile:this.payData.mobile}).done(function(){c.html("已提交客服，我们将尽快联系您")}):(this._tipDialog(c,"请填写正确的手机号"),void b.preventDefault())},_isNeedInvoiceHandler:function(b){var c=a.$(b.currentTarget);c.hasClass("checkbox-checked")?(c.removeClass("checkbox-checked"),this.payData.IsContactCustomerService=!1):(c.addClass("checkbox-checked"),this.payData.IsContactCustomerService=!0),this._changeGoPayHref()}})}),define("views/more/pay/expire/index-page-view",["talent","templates/more","views/more/pay/pay-buy-layout-view","views/more/pay/order/pay-order-view"],function(a,b,c,d){var e=a.Layout.extend({template:b["more/pay/index-page"],className:"_tt_page_container",regions:{main:".tt_buyingprocess"},initialize:function(){a.Context.setPageTitle("tita-购买"),this.payBuyLayoutView=new c,this.listenTo(this.payBuyLayoutView,"submit",function(b){this.payOrderView=new d({model:new a.Model(b)}),this.main.show(this.payOrderView)},this)},onRender:function(){this.main.show(this.payBuyLayoutView)}});return a.BasePageView.extend({mainViewClass:e,hideSidebar:!0,layout:"empty-layout"})}),define("views/more/pay/order/index-page-view",["talent","templates/more","views/more/pay/order/pay-order-view","views/common/empty-view"],function(a,b,c,d){var e=a.Layout.extend({template:b["more/pay/order/index-page"],className:"tt_page_container",regions:{main:".tt_payorderdetail"},onShow:function(){this._getRouterData(),this._getOrderByIdData()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a,b.routerData.id=b.routerData.id}),d},_getOrderByIdData:function(){if(!this.routerData.id||""==this.routerData.id){var b=new d({emptyContext:"您所查询的订单不存在"});return void this.main.show(b)}var e=this;a.app.request("Pay:getOrderByIdData",{order_id:this.routerData.id}).done(function(b){e.payOrderView=new c({model:new a.Model(b),isShowPayWay:!1}),e.main.show(e.payOrderView)})}});return a.BasePageView.extend({mainViewClass:e,hideSidebar:!0,layout:self===top?"master-layout":"empty-layout"})}),define("views/more/pay/index-page-view",["talent","templates/more","views/more/pay/pay-buy-layout-view","views/more/pay/order/pay-order-view","views/more/pay/expire/index-page-view","views/more/pay/order/index-page-view"],function(a,b,c,d,e,f){var g=a.Layout.extend({template:b["more/pay/index-page"],className:"_tt_page_container",regions:{main:".tt_buyingprocess"},initialize:function(){a.Context.setPageTitle("tita-购买"),this.maping={"C1B497A9-8121-4EFC-9505-9F018A614911":"PayLayoutView","826E58FD-2350-464B-A1EA-D9F254314535":"PayLayoutView","7DFB0DAF-BBB9-47EC-ACD2-387345E4C05E":"PayLayoutView","0D0E3C93-C605-4DFA-8EBE-94FD469EE6A7":"PayLayoutView"}},onRender:function(){var a=this;this._getRouterData().done(function(){a._getPageData()})},_renderPayLayoutView:function(){if("826E58FD-2350-464B-A1EA-D9F254314535"==this.keyCode)var b=1;else{var e=a.Context.getGlobal("tenantAuthentication");if(2==e.Version)var b=3;else var b=2}if("7DFB0DAF-BBB9-47EC-ACD2-387345E4C05E"==this.keyCode)var f="message";else if("0D0E3C93-C605-4DFA-8EBE-94FD469EE6A7"==this.keyCode)var f="renewal";else var f="";this.payBuyLayoutView=new c({model:new a.Model({order_type:b,keyCode:this.keyCode,PackageId:this.routerData.package_id,typeName:f})}),this.listenTo(this.payBuyLayoutView,"submit",function(b){this.payOrderView=new d({model:new a.Model(b)}),this.main.show(this.payOrderView)},this),this.main.show(this.payBuyLayoutView)},_getPageData:function(){var b=this,c=this.routerData.package_id;a.app.request("Pay:getPackageData",{package_id:c}).done(function(a){var c=a[0];b.keyCode=c,b["_render"+b.maping[c]]&&b["_render"+b.maping[c]]()})},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(c){c.from&&"fromdue"==c.from&&a.app.request("Pay:tenantAuthorizeSet").done(function(){a.Context.setGlobal("deadLineRemind",!1)}),b.routerData=c,d.resolve(b.routerData)}),d}}),h=a.Context.getGlobal("tenantAuthentication");return h&&h.ExpireType&&2==h.ExpireType?a.BasePageView.extend({mainViewClass:g,hideSidebar:!0,layout:"empty-layout"}):a.BasePageView.extend({mainViewClass:g,layout:window.top==window?"master-layout":"empty-layout",hideSidebar:!0})}),define("views/more/messages/message-sidebar-view",["talent","templates/more","TitaWidget"],function(a,b,c){var d=a.ItemView.extend({template:b["more/messages/sidebar-item"],tagName:"li",className:"item-nav tu-por",ui:{redRemind:'[data-name="head-to-do-indicator"]'},modelEvents:{"change:total":"_showRed"},templateHelpers:function(){return this.options},initialize:function(){},onRender:function(){this.options.tabAppId==this.model.get("appId")&&(this.$el.addClass("active"),this.trigger("changeSidebar",this.model.get("appName")))},_showRed:function(){var a=this.model.get("total");c.RedRemindView.updateIndicatorNum(this.ui.redRemind,a)}});return a.CompositeView.extend({template:b["more/messages/sidebar"],ui:{item:'[data-name="router"]',li:"li"},itemView:d,itemViewContainer:".sub-menu",className:"message-sidebar",events:function(){var a={};return a["click "+this.ui.item]="_onRoute",a},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),this.on("itemview:changeSidebar",function(a){b.model.set("currentPageTitle",a.model.get("appName"))})},_onRoute:function(b){var c=this.$(b.currentTarget),d=c.data("appid"),e=-1==Number(d)?c:c.parent();a.app.vent.trigger("tab:_tita_message:change"),this.$el.find(".active").removeClass("active"),e.addClass("active"),this.model.set("currentPageTitle",c.text())},itemViewOptions:function(){return{tabAppId:this.model.get("tabAppId"),messageType:this.model.get("messageType")}},onClose:function(){}})}),define("views/common/loading-circle-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({defaults:{isShowText:!1,textContent:"",position:"fixed",container:"",leftBias:0,topBias:0},template:b["common/loading-circle"],className:"tt_common_loading_circle",initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.isShowGIF=this._isShowGIF()},ui:{loadContainer:".loading-container",loadContent:".loading-content",textContent:".text-loading",loadMark:".loading-mask"},templateHelpers:function(){return{isShowText:this.settings.isShowText,textContent:this.settings.textContent,isShowGIF:this.isShowGIF,ImgUrl:a.Context.getStaticUrl("images/loading.gif")}},_isShowGIF:function(){var a=navigator.userAgent,b=a.indexOf("MSIE")>-1,c=b?/\d+/.exec(a.split(";")[1]):!1;return c&&(c=8>=c?!0:!1),c},close:function(){this.$el.remove()},show:function(){this._conShowLoading(),this._setPosition()},_conShowLoading:function(){this.settings.container.append(this.render().$el)},_setPosition:function(){var a=(this.settings.leftBias,this.settings.topBias,this.settings.container);"body"==a.selector||"main-region"==a[0].id?(containerH=$("#main-region").height(),containerW=$("#main-region").width(),this.ui.loadContent.css({position:this.settings.position})):(containerH=a.height(),containerW=a.width()),this.ui.loadContainer.css({width:containerW,height:containerH,top:-containerH,left:0}),this.ui.loadMark.css({width:containerW,height:containerH});var b=this.ui.loadContent.height(),c=this.ui.loadContent.width();this.ui.loadContent.css({"margin-top":-b/2-this.settings.topBias,"margin-left":-c/2-this.settings.leftBias})}})}),define("views/common/messages/message-applist-view",["talent","templates/common","views/common/empty-view","views/common/loading-circle-view"],function(a,b,c,d){var e=a.ItemView.extend({template:b["common/messages/message-approval"],initialize:function(){this.i18n=a.Context.getI18n()},ui:{checkItem:'a[data-name="check-item"]',taskContent:"[data-name=task-content]",planContent:"[data-name=plan-conent]"},templateHelpers:function(){var a=this.model.get("lableSets"),b=Talent._.pluck(a,"LableFullName");return{lableSets:a.length?b.join("、"):"所有范围",i18n:this.i18n}},onRender:function(){var a=this.model.get("planTasks")||[];a.length||this._renderEmptyView(this.ui.planContent,"暂无"+this.i18n.plan_1+"管理设置");var b=this.model.get("planApplySets")||[],c=this.model.get("lableSets"),d=_.filter(b,function(a){return a.Value?a:void 0});0==c.length&&0==d.length&&this._renderEmptyView(this.ui.taskContent,"暂无"+this.i18n.task_1+"审批审批")},_renderEmptyView:function(a,b){var d=new c({emptyContext:"暂无设置"+this.i18n.task_1+"审批"});a.html(d.render().$el)}});return a.CompositeView.extend({template:b["common/messages/message-approval-layout"],className:"superior-rules",initialize:function(b){this.i18n=a.Context.getI18n(),this.settings=a._.extend({},this.defaults,b),this.$el.on("click",function(a){a.stopPropagation()})},onShow:function(){var a=this;Talent.$(window).off("resize.Message-AppList-View"),Talent.$(window).on("resize.Message-AppList-View",function(){a.setPosition()});var b=new d;this.ui.content.html(b.render().$el),Talent.app.request("Message:getMessageApproval",{}).done(function(b){a.isClosed||a._renderContentView(b)}),this.setPosition()},ui:{content:"[data-name=content]",title:"[data-name=title]"},_renderContentView:function(a){for(var b=a.ReportRules,c={},d=0;d<b.length;d++){var f=b[d];8==f.ReportType&&(c.day=f.SubmitDate),26==f.ReportType&&(c.week=f.SubmitDate),27==f.ReportType&&(c.month=f.SubmitDate)}for(var g=a.PlanTasks,h={},d=0;d<g.length;d++){var f=g[d];11==f.ObjSettingType&&(h.day=f.ObjSettingValue||"暂无规定"),12==f.ObjSettingType&&(h.week=f.ObjSettingValue||"暂无规定"),13==f.ObjSettingType&&(h.month=f.ObjSettingValue||"暂无规定")}this.contentView=new e({model:new Talent.Model({lableSets:a.ApplySetModel.LableSets||[],planApplySets:a.ApplySetModel.PlanApplySets||[],dailyRules:c,planTasks:g||[],planRules:h})}),this.ui.content.html(this.contentView.render().$el)},setPosition:function(){var a=Talent.$(window).height()-41-this.ui.title.outerHeight();this.ui.content.height(a)},onClose:function(){Talent.$(window).off("resize.Message-AppList-View")}})}),function(a){function b(a){for(var b=0,c=0;c<a.length;c++){var d=a.charCodeAt(c);d>=1&&126>=d||d>=65376&&65439>=d?b++:b+=2}return b}function c(a,b){for(var c=0,d=0;d<a.length;d++){var e=a.charCodeAt(d);if(!(b>c))return d;e>=1&&126>=e||e>=65376&&65439>=e?c++:c+=2}return a.length}var d=/(\s*\S+|\s)$/,e=/^(\S*)/;a.truncate=function(b,c){return a("<div></div>").append(b).truncate(c).html()},a.fn.truncate=function(f){a.isNumeric(f)&&(f={length:f});var g=a.extend({},a.truncate.defaults,f);return this.each(function(){var f=a(this);g.noBreaks&&f.find("br").replaceWith(" ");var h=f.text(),i=b(h),j=i-g.length;if(g.stripTags&&f.text(h),g.words&&j>0){var k=h.slice(0,g.length).replace(d,"").length;j=g.keepFirstWord&&0===k?i-e.exec(h)[0].length-1:i-k-1}0>j||!j&&!g.truncated||a.each(f.contents().get().reverse(),function(d,e){var f=a(e),h=f.text(),i=b(h);if(j>=i)return g.truncated=!0,j-=i,void f.remove();if(3===e.nodeType){if(g.finishBlock)a(e.splitText(i)).replaceWith(g.ellipsis);else{var k=c(h,i-j-1);a(e.splitText(k)).replaceWith(g.ellipsis)}return!1}return f.truncate(a.extend(g,{length:i-j})),!1})})},a.truncate.defaults={stripTags:!1,words:!1,keepFirstWord:!1,noBreaks:!1,finishBlock:!1,length:1/0,ellipsis:"…"}}(jQuery),define("$.truncate",function(){}),define("views/common/daiban-message-together/message-list-composite-view",["talent","templates/common","views/common/messages/message-applist-view","views/common/empty-view","helpers/context","TitaWidget","simplemodal","$.cookie","$.infotip","$.truncate"],function(a,b,c,d,e,f,g,h,i){var j=a.ItemView.extend({template:b["common/daiban-message-together/message-list"],daibanTemplate:b["common/daiban-message-together/daiban-item"],tagName:"li",className:"list_ml__item",modelEvents:{"change:isOnPush":"_changeOnPush"},ui:{thkReward:"[data-name=thk-reward]",sendInviteMinde:"[data-name=send-remind]"},events:function(){var a={};return a["click "+this.ui.sendInviteMinde]="_sendInviteMinde",a},initialize:function(){this.initIntroNum="";var b=this;messageUrl=decodeURIComponent(location.hash),this.model.set({id:this.model.get("objId")});var c=this.model.get("isNewTemplate");if(c&&(57==this.model.get("messageType")?this.model.set("lead_messageUrl",messageUrl+"&messageType="+this.model.get("messageType")+"&messageId="+this.model.get("messageId")):this.model.set("lead_messageUrl",null),62==this.model.get("messageType")&&this.model.set("workUrl","#work?work_id="+this.model.get("objId")),63==this.model.get("messageType")&&this.model.set("workUrl","#work?create=true&work_id="+this.model.get("objId")),58==this.model.get("messageType"))){var d=a.app.request("history:getQueryObject");d.done(function(a){var c="#more/messages?isRead="+a.isRead+"&appid="+a.appid;a.apptype&&(c=c+"&apptype="+a.apptype),b.model.set("planDetailUrl",c+"&plan_item_id="+b.model.get("objId"))})}28==this.model.get("messageType")&&(this.thkReward=!0,this.model.set("messageName","打赏通知")),1==this.options.msgType&&(this.template=this.daibanTemplate),this._extendDataDeal()},_extendDataDeal:function(){var a=this.model.get("extendDatas"),b=this;a=a&&JSON.parse(a)||[],a&&a.length&&(Talent._.each(a,function(a){a.label&&(a.labelText=b._stripHtml(a.label),a.hasLabelInfoTip=Talent.Context.getStrLength(b._dealSpacing(a.labelText))>12,a.hasLabelInfoTip&&(a.label=$.truncate(a.label,{length:12}))),a.value&&(a.valueText=b._stripHtml(a.value),a.hasValueInfoTip=Talent.Context.getStrLength(b._dealSpacing(a.valueText))>50,a.hasValueInfoTip&&(a.value=$.truncate(a.value,{length:50})))}),this.model.set("extendDatas",a))},_dealSpacing:function(a){return a.replace(/(\&nbsp\;)+/gi,"")},_stripHtml:function(a){return a.replace(/(<([^>]+)>)/gi,"")},_getHost:function(){var a=Talent.Context.getGlobal("titaHost"),b=Talent.Context.getUserInfo();return a+=/tita/.test(a)?"/u/"+b.Id+"/Home":"/"+b.Id+"/ITalentHome"},_thkRewardHandler:function(a){this.thkReward&&this._renderSimplemodal()},_randomText:function(){var a=["多谢赏赐，已开启拼命三郎工作模式","谢谢打赏，我会十二分努力哒","多谢打赏，明天一定比今天更努力","谢主隆恩，微臣会继续加油哒","多谢打赏，工作交给我妥妥的","多谢打赏，我会全力以赴的"],b=Math.floor(Math.random()*a.length);this.initIntroNum==b&&(b+=1,b>a.length&&(b-=1),this.initIntroNum=b);var c=a[b]||a[0];return c},_renderSimplemodal:function(){var b=this,c="@["+this.model.get("user").name+":"+this.model.get("user").email+"]",d=this._randomText();this.publistMblogView&&this.publistMblogView.close(),this.publistMblogView=new f.PublistMblogView({submitText:"发表",id:this.model.get("objId"),inFocus:!0,commentId:"",isShowRange:!1,isShowSendSms:!1,isShowAttachment:!1,isShowAtAll:!1,isShowAt:!1,value:d,autoResize:!1,submitRequest:function(d,e){var f=new a.$.Deferred;return Talent.app.request("Comment:newAddComment",{Content:c+e.context,ObjType:e.privateObjType,ObjId:e.privateObjId,FeedId:b.model.get("objId"),CommentId:b.model.get("commentId")}).done(function(a){b.thkReward=!1,b.ui.thkReward.html("已谢赏"),b.ui.thkReward.addClass("thk-btn-disabled"),b.simplemodal.close(),f.resolve(a),b._infoTip(b.ui.thkReward,'<span><span class="tu-icon-check" style="color: #59B37E;"></span>谢赏成功，去&nbsp;<a href="#set?page_id=capital">提现</a></span>',"attention")}).fail(function(a){f.reject(a)}),f}}),this.simplemodal&&this.simplemodal.close(),this.simplemodal=new g({autoResize:!1,escClose:!0,minWidth:"500px",minHeight:"152px",fixed:!1,zIndex:1009,overlayClose:!1,containerCss:{background:"#fff",padding:"10px","border-radius":"3px"}}),this.simplemodal.render(this.publistMblogView.render().$el).appendTo("body"),this.publistMblogView.$el.before('<div style="font-size: 12px; color: #aaa; line-height: 24px;">回复: '+this.model.get("user").name+" </div>")},_sendInviteMinde:function(b){var c=a.$(b.currentTarget),d=c.data(),e=this;Talent.app.request("externalUser:sendInvitation",{workId:d.workid,invitationType:d.type,invitions:[{id:"",value:d.useridentity}]}).done(function(){e._infoTip(c,"发送成功")}).fail(function(a){e._infoTip(c,a,"","warn")})},_infoTip:function(a,b,c,d){this.$el.parent().css("position","relative"),this.infoTipView&&this.infoTipView.destroy(),this.infoTipView=new i,this.infoTipView.bindNode(a,{animation:!1,type:c||"remind",trigger:"manual",ico:d||"success",placement:"top",align:"right",hashead:!1,hasfoot:!1,html:!0,container:this.$el.parent(),body:b}),this.infoTipView.show()},_changeBtnStatus:function(){var a=this.model.get("timestamp"),b=$.cookie(a);1==b?(this.ui.thkReward.addClass("thk-btn-disabled"),this.ui.thkReward.html("已谢赏")):(this.ui.thkReward.removeClass("thk-btn-disabled"),this.ui.thkReward.html("谢赏~"))},onShow:function(){},templateHelpers:function(){var a=_.template(this.options.itemUrl)(this.model.toJSON()),b=this.model.get("objId"),c=this.model.get("messageType"),d=this._getHost();if(1==this.options.msgType){var e=this.model,f=e.get("todoType"),a=e.get("objUrl")?e.get("objUrl"):d+"#more/messages?messageType=1";1==f?a=e.get("objUrl"):2==f?a=d+"#more/apply?name=plan":3==f?a=d+"#work?relation=4&app_id="+this.model.get("appId")+"&app_type="+this.model.get("appId")+"&to_user_id="+Talent.Context.getUserInfo().Id+"&tabIndex=2":4==f&&(a=e.get("objUrl"))}(28==c||55==c)&&(a=d+"#more/shareinfo?id="+b),(this.model.get("openTaskBlank")||2==this.options.msgType)&&(a=this.model.get("objUrl"));var g=Talent.Context.getUserInfo();return _.extend(this.options,{url:a,host:d,titaHost:Talent.Context.getGlobal("titaHost"),isExternal:2==g.UserType})},_changeOnPush:function(){var a=this.model.get("isOnPush");this.$el.removeClass("active"),a&&this.$el.addClass("active")}});return a.CompositeView.extend({template:b["common/daiban-message-together/message-compsite"],emptyView:d,defaults:{msgType:2},itemViewContainer:".list_ml",itemView:j,className:"tu-por",ui:{taskName:'[data-name="push"]',dailyName:'[data-name="daily-push"]',superiorRules:"[data-name=superior-rules]",dailyPullscreen:"[data-open=daily-pullscreen]",taskDetail:"[data-open=task-detail-pullscreen]",superiorRulesPullscreen:"[data-open=superior-rules-pullscreen]"},events:function(){var a={};return a["click "+this.ui.taskName]="_onClickName",a["click "+this.ui.dailyName]="_onClickDaily",a["click "+this.ui.superiorRules]="_onSuperiorRules",a["click "+this.ui.taskDetail]="_onClickName",a["click "+this.ui.dailyPullscreen]="_onClickDaily",a["click "+this.ui.superiorRulesPullscreen]="_onSuperiorRules",a},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),delete this.settings.model,delete this.settings.collection,a.app.vent.on("taskDetailClosed",function(a){var c=b._getModelById(a);c&&c.set("isOnPush",!1)})},onRender:function(){var a=this;this.model.toJSON();0==this.collection.length&&this.$(".list_ml").css("border","none"),setTimeout(function(){a._getRouterData()},600),this.$el.find("[data-body]").infotip({type:"default",container:this.$el})},_getRouterData:function(){var b=this;a.app.request("history:getQueryObject").done(function(a){if(b.routerData=a,a.pullScreeId&&a.pullScreenOpen){var c=b._getModelById(a.pullScreeId);c&&c.set("isOnPush",!0)}})},_getModelById:function(a){for(var b=this.collection,c=null,d=0,e=b.length;e>d;d++)if(c=b.at(d),c.get("objId")==a)return c},_onClickName:function(b){b.stopPropagation();var c=this,d=c.$(b.currentTarget),e=d.attr("task-id");this.collection.each(function(a){a.set({isOnPush:!1})}),Talent.app.vent.trigger("global-pull-screen",e,"task"),a.app.vent.trigger("global-headview-PopClose");var f=c._getModelById(e);f&&f.set("isOnPush",!0)},_onClickDaily:function(a){a.stopPropagation();var b=this,c=b.$(a.currentTarget),d=c.attr("daily-id"),e=Number(c.attr("data-messageType")),f=this.collection.findWhere({objId:d});isNew=f.get("isNew"),69==e&&0==isNew?Talent.app.vent.trigger("global-pull-screen",d,"task",f):Talent.app.vent.trigger("global-daily-detail-pull-screen",d)},_onSuperiorRules:function(){this.messageApprovalView=new c({}),Talent.app.vent.trigger("global-pull-screen","Daily-Superior-Rules","dailySuperiorRules",this.messageApprovalView,{changeUrl:!1})},itemViewOptions:function(){return a._.extend({},this.settings,{isRead:this.model.get("isRead"),emptyContext:1==this.model.get("msgType")?"暂无待办":"暂无消息"})},onClose:function(){}})}),define("views/common/daiban-message-together/message-atReply-composite-view",["talent","templates/common","views/common/empty-view","$.infotip"],function(a,b,c){var d=a.ItemView.extend({template:b["common/daiban-message-together/message-atReply-item"],className:"atReply__item tu-por tu-clearfix",modelEvents:{},ui:{feedDetial:"[data-name=feed-detial]",skipToback:"[data-tm=staff]"},events:function(){var a={};return a["click "+this.ui.feedDetial]="_feedDetialHandler",a["click "+this.ui.skipToback]="_skipToback",a},templateHelpers:function(){var a=this.model.get("feed");return this.feedTypeMapping={1:"分享",3:"绩效管理",20:"任务",4:"计划",5:a&&8==a.subType?"日报":a&&26==a.subType?"周报":"月报",6:"项目",80:"移动签到",7:"考核",9:"审批",10:"项目"},{feedTypeMapping:this.feedTypeMapping,feedObj:this._getFeedName()||"",feedAvatar:this._getFeedAvatar(),titaHost:Talent.Context.getGlobal("titaHost")}},onRender:function(){this.$el.find("[data-body]").infotip({type:"default",container:this.$el})},_skipToback:function(){var b=a.Context.getGlobal("tm");window.open(b)},_feedDetialHandler:function(){var b=a.Context.getGlobal("titaHost")+"/"+a.Context.getUserInfo().Id+"/ITalentHome",c=b+"#more/shareinfo?id="+this.model.get("feedId");window.open(c)},_getFeedName:function(){var b=this.model.get("feed");return 9!=b.feedType&&8!=b.feedType&&3!=b.feedType||a._.isEmpty(b.app)?{name:this.feedTypeMapping[b.feedType],title:b.name.replace(/(<br\/>)/g,"")}:{name:b.app.appObj.appObjName,title:b.app.appObj.appObjTitle}},_getFeedAvatar:function(){var b=this.model.get("feed");return 8!=b.feedType&&3!=b.feedType||a._.isEmpty(b.app)?{avatarImg:b.user.avatar.small,avatarColor:b.user.avatar.color}:{avatarImg:b.app.appLogo,avatarColor:""}}});return a.CompositeView.extend({template:_.template('<div class="atReply"></div>'),emptyView:c,itemViewContainer:".atReply",itemView:d,className:"tu-por message-atReply",ui:{taskName:'[data-name="push"]',dailyName:'[data-name="daily-push"]'},events:function(){var a={};return a["click "+this.ui.taskName]="_onClickName",a["click "+this.ui.dailyName]="_onClickDaily",a},itemViewOptions:function(){return{emptyContext:"暂无消息"}},initialize:function(){},onRender:function(){}})}),define("views/common/daiban-message-together/message-layout-view",["talent","templates/more","$.notice.set","views/common/daiban-message-together/message-list-composite-view","views/common/daiban-message-together/message-atReply-composite-view","$.pagination"],function(a,b,c,d,e){return a.Layout.extend({template:b["common/daiban-message-together/message-layout"],regions:{container:'[data-name="list-container"]'},templateHelpers:{i18n:a.Context.getI18n()},ui:{readType:'[data-name="read-type"]',messageSubNav:"[data-name=message-sub]",pagination:"[data-name=pagination]"},events:function(){var a={};return a["click "+this.ui.messageSubNav]="_messageSubNavHanlder",a},modelEvents:{},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.i18n=a.Context.getI18n(),this.pageSize=this.model.get("pageSize")},onRender:function(){this._getData(),this._subNavCountDeal()},_messageSubNavHanlder:function(a){var b=$(a.currentTarget),c=b.data("type");this.model.set("messageSubNav",c),this.render()},_subNavCountDeal:function(){var a=this.model.get("messageSubNav"),b=this.model.get("allTotal"),c=this.model.get("atReplyCount"),b=1==a?0:b,c=2==a?0:c;this.model.set({atReplyCount:c,allTotal:b})},_getData:function(){2==this.model.get("messageType")&&1==this.model.get("isRead")?this.pageSize=1e3:this.pageSize=this.model.get("pageSize");var b=this.model.toJSON(),c=b.hasMessageSubNav&&2==b.messageSubNav?"getAtReply":1==b.messageType?"getDaiban":"getMessage",d={app_type:b.tabAppType,app_id:b.tabAppId,page_num:b.pageIndex,page_size:this.pageSize,status:b.isRead};a.Context.changeHash({isRead:this.model.get("isRead"),messageSubNav:this.model.get("messageSubNav")}),b.hasMessageSubNav&&2==b.messageSubNav&&(d={page_num:b.pageIndex,page_size:this.pageSize,status:b.isRead}),this._respControl(c,d)},_respControl:function(b,c){var d=this;a.app.request("Message:"+b,c).done(function(a){d.isClosed||("getAtReply"==b?d.renderAtReplyCompositeView(a&&a.messages):d.renderCompositeListView(a&&(a.messags||a.todos),a.total),a&&a.total>d.pageSize&&(d.controlPageList(a.total),d.ui.pagination.TPagination("updateItemsCount",a.total),d.ui.pagination.TPagination("goToPage",d.model.get("pageIndex"))))})},renderAtReplyCompositeView:function(b){this.messageAtReplyCompositeView&&this.messageAtReplyCompositeView.close(),this.messageAtReplyCompositeView=new e({collection:new a.Collection(b)}),1==this.model.get("isRead")&&this.trigger("clearMsg",17),this.container&&this.container.show(this.messageAtReplyCompositeView)},renderCompositeListView:function(b,c){var e=this.model.get("openTaskBlank")||!1,f=this,g=this.model.toJSON();e&&Talent._.each(b,function(a){a.objId&&a.isPush&&(a.isPush=!1,a.objUrl=Talent.Context.getGlobal("titaHost")+"/"+f.userInfo.Id+"/ITalentHome/#more/taskinfo?id="+a.objId)}),Talent._.each(b,function(a){var b=new Date;a.timestamp=b.getTime()});var h=new d({collection:new a.Collection(b),model:this.model,msgType:this.model.get("messageType")});this.container&&this.container.show(h),2==g.messageType&&1==g.isRead&&this.trigger("clearMsg")},controlPageList:function(a){var b=this;this.model.get("pageIndex");this.ui.pagination.TPagination({styleClass:["pagination-large"],pageSize:this.pageSize,displayInfoType:"itemsCount",onSelect:function(a){a!=b.model.get("pageIndex")&&(b.model.set("pageIndex",a),b._getData(),$(".tu-page-container").scrollTop(0))}})}})}),define("views/common/daiban-message-together/message-main-view",["talent","templates/common","views/common/daiban-message-together/message-layout-view","TitaWidget"],function(a,b,c,d){return a.Layout.extend({template:b["common/daiban-message-together/message-main"],defaults:{tabAppType:-1,tabAppId:-1,isRead:1,pageSize:20,pageIndex:1,messageType:1,openTaskBlank:!1,hasTitle:!0,messageSubNav:1,allTotal:0,atReplyCount:0},regions:{compositeList:".meslist"},templateHelpers:{i18n:a.Context.getI18n()},ui:{messageType:'[data-name="msg-tab"]',daibanNum:'[data-name="daiban-num"]',msgNum:'[data-name="msg-num"]'},events:function(){var a={};return a["click "+this.ui.messageType]="_changeType",a},modelEvents:{"change:messageType":"_renderLayout"},initialize:function(b){this.userInfo=a.Context.getUserInfo(),this.i18n=a.Context.getI18n();var c=a._.extend({},this.defaults,b,this.model.toJSON());c.hasMessageSubNav=2==c.messageType&&-1==c.tabAppId,this.model.set(c)},onRender:function(){this._renderLayout()},_changeType:function(a){var b=this.$(a.currentTarget),c=b.attr("data-type");this.ui.messageType.removeClass("active"),b.addClass("active"),this.model.set("pageIndex",1),this.model.set("isRead",c),this._setSubNav(c),this.render()},_setSubNav:function(a){1==a&&this.model.get("atReplyCount")>0?this.model.set("messageSubNav",2):this.model.set("messageSubNav",1)},_renderLayout:function(){var a=(this.model.get("messageType"),new c({model:this.model}));this.compositeList.show(a),this.listenTo(a,"clearMsg",function(a){this.trigger("clearMsg",a)})}})}),define("views/common/sdk/sdk-view",["talent","templates/common","views/common/loading-view"],function(a,b,c){return a.ItemView.extend({defaults:{iTalentFrame:"",iTalentFrameType:"",iTalentNavId:"",iTalentNavCode:"",iTalentWidgetUpdateSize:!1},template:a._.template(""),className:"tu-height-full",regions:{},templateHelpers:function(){return{i18n:this.i18n}},initialize:function(){this.routerData={iTalentFrame:"",iTalentFrameType:"",iTalentNavId:"",iTalentWidgetUpdateSize:!1,iTalentNavCode:""},this.routerData=a._.extend({},this.routerData,{iTalentFrame:this.options.iTalentFrame,iTalentFrameType:this.options.iTalentFrameType,iTalentNavId:this.options.iTalentNavId,iTalentWidgetUpdateSize:this.options.iTalentWidgetUpdateSize||!1,iTalentNavCode:this.options.iTalentNavCode}),this._getRouterData(),
this.oriOverflow=a.$("html").css("overflow-y"),this.registerSDK&&this.registerSDK()},onRender:function(){this._renderLoadingView(),this._setIfrmeUrl()},onShow:function(){this.onShowAfter&&this.onShowAfter(),a.app.vent.trigger("__Italent_MasterLayout_OnShow")},isIEVersion:function(){var a=0,b=/MSIE (\d+\.\d+);/.test(navigator.userAgent),c=!!navigator.userAgent.match(/Trident\/7.0/),d=navigator.userAgent.indexOf("rv:11.0");return b&&(a=new Number(RegExp.$1)),-1!=navigator.appVersion.indexOf("MSIE 10")&&(a=10),c&&-1!=d&&(a=11),a},onClose:function(){var b=this.isIEVersion();if(b>0){var c=this.$el.find("#iTalentFrame")[0];c&&(c.setAttribute("src",""),c.parentNode.removeChild(c))}var d=a.Context.getGlobal("usingNewMenu")||!1;d||(a.$("html").css("overflow-y",this.oriOverflow),a.$(window).off("resize",this.bindResizeFrame),a.$("#main-region").css("height","")),this.onCloseAfter&&this.onCloseAfter()},_getRouterData:function(){for(var a=decodeURIComponent(location.hash),a=a.slice(a.indexOf("?")+1),b=a.split("&"),c=0;c<b.length;c++){var d=b[c].split("=");this.routerData[d[0]]=d[1]}this.routerData.iTalentFrame&&""!=this.routerData.iTalentFrame&&this._formatUrl(this.routerData.iTalentFrame)},_formatUrl:function(a){var b=decodeURIComponent(a);this.routerData.iTalentFrame=b},_renderLoadingView:function(){this.loadingView=new c,this.$el.html(this.loadingView.render().$el)},_setIfrmeUrl:function(){function b(){if(0===f){var b=d.routerData.iTalentFrame;e.data=d.routerData,e.data.webimLoaded=a.Context.getGlobal("webimLoaded")||!1,iframe.contentWindow.name=JSON.stringify(e),d.loadingView&&d.loadingView.close(),iframe.contentWindow.location.href=b,f=1}}function c(){d.loadingView.close()}var d=this,e={__iTalentFrameId:"iTalentFrame",__iTalentFrameType:this.routerData.iTalentFrameType,__iTalentLocationHref:"//"+location.host+location.pathname+"#widget/italent",__iTalentWidgetUpdateSize:this.routerData.iTalentWidgetUpdateSize,__iTalentNavCode:this.routerData.iTalentNavCode,__iTalentNavId:this.routerData.iTalentNavId},f=0;return iframe=document.createElement("iframe"),src="//"+location.host+"/italent-transfer-data.html",iframe.src=src,iframe.setAttribute("frameborder",0),iframe.setAttribute("marginwidth",0),iframe.setAttribute("marginheight",0),iframe.setAttribute("scrolling","auto"),iframe.setAttribute("width","100%"),iframe.setAttribute("height","100%"),iframe.setAttribute("id","iTalentFrame"),iframe.setAttribute("allowfullscreen","true"),iframe.style.verticalAlign="top",iframe.style.fontSize=0,iframe.onmousedown=function(a){a.currentTarget.setPointerCapture(!0)},iframe.attachEvent?(iframe.attachEvent("onload",b),iframe.attachEvent("error",c)):(iframe.onload=b,iframe.error=c),this.$el.html(iframe),iframe}})}),define("views/more/messages/index-page-view",["talent","templates/more","views/more/messages/message-sidebar-view","views/common/daiban-message-together/message-main-view","views/common/sdk/sdk-view","helpers/context"],function(a,b,c,d,e,f){var g=a.Layout.extend({template:b["more/messages/index-page"],defaults:{tabAppType:-1,tabAppId:-1,autoApply:!1,isRead:1,pageSize:20,pageIndex:1,messageType:1,messageIndicator:0,todoIndicator:0,messageCount:0,messageSubNav:1},regions:{sidebar:'[data-name="tt-sidebar"]',main:'[data-name="message-main"]'},templateHelpers:{i18n:a.Context.getI18n()},ui:{main:'[data-name="message-main"]',pageTitle:"[data-name=page-title]"},className:"tu-row-fuild",modelEvents:{"change:currentPageTitle":"_changePageTitle"},initialize:function(){this.userInfo=a.Context.getUserInfo(),this.i18n=a.Context.getI18n();var b=a.Context.parseUrl(decodeURIComponent(location.hash)).messageType;a.Context.setPageTitle(1==b?"待办中心":"消息中心");this.model.set({daibanNum:0,msgNum:0}),this.appCollection=new a.Collection,this.appIndicatorMap=[{appId:-1,daiban:"todoIndicator",msg:"messageIndicator"},{appId:1,daiban:"todotitaIndicator",msg:"mWorkIndicator"},{appId:500,daiban:"tSuccessionIndicator",msg:"mSuccessionIndicator"},{appId:501,daiban:"t360Indicator",msg:"m360Indicator"},{appId:203,daiban:"tRecruitIndicator",msg:"mRecruitIndicator"},{appId:200,daiban:"tRecommendIndicator",msg:"mRecommendIndicator"},{appId:400,daiban:"tEMPIndicator",msg:"mEMPIndicator"},{appId:401,daiban:"tTalentReviewIndicator",msg:"mTalentReviewIndicator"},{appId:402,daiban:"tGoalIndicator",msg:"mGoalIndicator"},{appId:600,daiban:"tUserSupportIndicator",msg:"mUserSupportIndicator"},{appId:901,daiban:"tApprove",msg:"mApprove"},{appId:902,daiban:"tWorkFlow",msg:"mWorkFlow"},{appId:950,msg:"mtitadashang"},{appId:502,msg:"mCP"},{appId:501,msg:"m360"},{appId:503,msg:"mStaff"},{appId:906,msg:"mBeisenCloudDemo"},{appId:907,msg:"mApprovalCentre",daiban:"tApprovalCentre"},{appId:908,msg:"mBeisenCloudHr",daiban:"tCloudHr"},{appId:960,msg:"mCompensation",daiban:"tCompensation"},{appId:917,msg:"mPPS",daiban:"tPPS"},{appId:909,msg:"mJiaqin",daiban:"tJiaqin"},{appId:930,daiban:"tOcean",msg:"mOcean"},{appId:925,msg:"mCRM",daiban:"tCRM"},{appId:99,msg:"mSigninIndicator"},{appId:963,msg:"mYSYY",daiban:"tYSYY"},{appId:966,msg:"mLT",daiban:"tLT"},{appId:967,msg:"mBLN",daiban:"tBLN"},{appId:962,msg:"mYG",daiban:"tYG"},{appId:921,msg:"mXXZX",daiban:"tXXZX"},{appId:927,msg:"mZHZX",daiban:"tZHZX"},{appId:970,msg:"mELearning",daiban:"tELearning"},{appId:1025,msg:"mMeeting",daiban:"tMeeting"},{appId:926,msg:"mAppconnect"},{appId:1020,msg:"mAssess",daiban:"tAssess"},{appId:1024,msg:"mAssessmentDemo",daiban:"tAssessmentDemo"},{appId:1030,msg:"mBusinessRuleEngine",daiban:"tBusinessRuleEngine"},{appId:969,msg:"mMedal,mAnnouncement"},{appId:1021,msg:"mBeisenNPS",daiban:"tMeeting"},{appId:1042,msg:"mDianziqian",daiban:"tDianziqian"}],a.app.vent.off("tab:_tita_message:change"),a.app.vent.on("tab:_tita_message:change",this._onTabClick,this)},onRender:function(){var b=this,c=a.app.request("history:getQueryObject");c.done(function(c){b.routerData=a._.extend({},b.defaults,c),b.model.set(b.routerData,{silent:!0});var d=1==b.routerData.messageType?"全部待办":"全部消息";b.model.set("currentPageTitle",d,{silent:!0}),b._getSideBarData().done(function(c){var d=a._.findWhere(c,{appId:907})||{},e=d&&d.total;b.appCollection.reset(c||[]),1==b.routerData.messageType&&(e&&"true"==b.routerData.autoApply||907==b.routerData.tabAppId)?(b._renderApplySdkView(),b.model.set("tabAppId",907)):(-2==b.routerData.tabAppId&&(b.model.set("tabAppId",-1),b.model.set("tabAppType",-1)),b._renderMainView()),b._renderSideBarView()}),a.app.vent.off("GlobalIndicatorUpdate"),a.app.vent.on("GlobalIndicatorUpdate",b._onIndicator,b),b.routerData.pullScreenOpen&&b.routerData.pullScreenType&&b.routerData.pullScreeId&&a.app.vent.trigger("global-pull-screen",b.routerData.pullScreeId,b.routerData.pullScreenType),b._setClientHeight()})},_setClientHeight:function(){var b=(this.$el.find("._tt_layout_tabnav").height(),this.$el.find("._tt_layout_container")),c=f.setMainRegionsHeight;c(b);var d=a._.debounce(function(){c(b)},300);$(window).off("resize.Message-Indepx-PageView"),$(window).on("resize.Message-Indepx-PageView",d)},_onIndicator:function(a){if(!this.isClosed){var b=this,c=this.model.get("messageType"),d=(this.appCollection.toJSON(),this.model.get("messageIndicator")),e=this.model.get("todoIndicator");this.indicatorCollection=a;var f=this.indicatorCollection.findWhere({type:"messageIndicator"})&&this.indicatorCollection.findWhere({type:"messageIndicator"}).get("value")||d,g=this.indicatorCollection.findWhere({type:"todoIndicator"})&&this.indicatorCollection.findWhere({type:"todoIndicator"}).get("value")||e,h=1==c?g!=e:f>0;h&&this._getSideBarData().done(function(a){b.appCollection.reset(a)}),this.model.set("messageIndicator",f),this.model.set("todoIndicator",g)}},_setCurrentMsg:function(){var b=this.model.get("tabAppId"),c=null;if(this.appCollection.each(function(a){a.get("appId")==b&&(c=a)}),-1!=b&&c)this.model.set({total:c.get("total")});else if(this.indicatorCollection){var d=1==this.messageType?"todoIndicator":"messageIndicator",e=this.indicatorCollection.findWhere({type:d}),f=e&&e.get("value")||0;if(2==this.messageType){var g=a._.findWhere(this.indicatorCollection,{indicatorType:17})||{},h=g.value||0;this.model.set("atReplyCount",g.value||0,{silent:!0}),f-=h}this.model.set({allTotal:h})}},_onTabClick:function(){var b=this;setTimeout(function(){a.app.request("history:getQueryObject").done(function(a){b.model.set(a,{silent:!0}),b._setCurrentMsg(),1==a.messageType&&907==a.tabAppId?b._renderApplySdkView():b._renderMainView()})},100)},_autoTab:function(){var b=this,c=b.model.toJSON(),d=c.tabAppId,e=a._.findWhere(this.appCollection.toJSON(),{appId:Number(d)}),f=-1==d?c.allTotal:e&&e.total||0;c.messageType;2==c.messageType?-1==d?(c.isRead=f||c.atReplyCount?1:2,c.messageSubNav=c.atReplyCount>0&&!f?2:c.messageSubNav||1):c.isRead=f?1:2:c.isRead=1,b.model.set({isRead:c.isRead,messageSubNav:c.messageSubNav},{silent:!0})},_getSideBarData:function(){var b=new a.$.Deferred,c=this;return a.app.request("Message:getMessageSubMenulist",{message_type:1==this.model.get("messageType")?2:1}).done(function(a){var d=a.apps,e=a.total||0,f=a.commentTotal||0;c.model.set({allTotal:e,atReplyCount:f}),b.resolve(d)}),b},_renderApplySdkView:function(){var a=this.appCollection.findWhere({appId:907}).get("url"),b=Talent.Context.getGlobal("titaHost"),c=b+"/"+this.userInfo.Id+"/SignRedirect?appId=907&redirectUrl="+encodeURI(a),d=encodeURI(encodeURI(c));this.sdkView||(this.sdkView=new e({iTalentFrame:d,iTalentFrameType:'"iframe"',iTalentNavId:"",iTalentWidgetUpdateSize:!0})),window.iTalentSDK.register([{listenEvent:"ITalent_Message_ScrollTop",context:this,cb:function(){$("[data-name=main-container-region]").scrollTop(0)}}]),"object"==typeof this.main&&this.main.show(this.sdkView)},_renderSideBarView:function(){var a=this;this.sidebarItemView=new c({model:this.model,collection:this.appCollection}),a.sidebar&&a.sidebar.show(a.sidebarItemView)},_renderMainView:function(){this.model.get();this._autoTab(),this.mainView=new d({model:this.model}),"object"==typeof this.main&&this.main.show(this.mainView),this.listenTo(this.mainView,"clearMsg",function(a){this.deleteIndicator(a)})},deleteIndicator:function(b){var c=this.model.toJSON(),d=Number(c.tabAppId),e={},f=null;if(this.appCollection.each(function(a){a.get("appId")==d&&-1!=d&&a.set("total",0),-1==d&&a.set("total",0)}),-1!=d)if(e.messageType=0,950==d)e.indicatorType="mtitadashang,mTaoShangIndicator";else{if(f=a._.findWhere(this.appIndicatorMap,{appId:d}),!f)return;e.indicatorType=f?f.msg:""}else e={messageType:17==b?0:1,indicatorType:b+""||"",indicatorNum:this.model.get("msgNum")};Talent.app.vent.trigger("GlobalIndicatorDelete",e),this.model.set("messageIndicator",0);var g=this.appCollection,h=null;this.model.set({msgNum:0});for(var i=0,j=g.length;j>i;i++)h=g.at(i),(-1==d||h.get("appId")==d)&&h.set({msgNum:0})},_changePageTitle:function(){this.$el.find("[data-name=page-title]").text(this.model.get("currentPageTitle"))},onClose:function(){$(window).off("resize.Message-Indepx-PageView")}});return a.BasePageView.extend({mainViewClass:g,layout:window.top==window?"master-layout":"empty-layout",layoutViewOptions:{hideSubMenu:!1}})}),define("views/more/taskinfo/index-page-view",["talent","templates/more","TitaWidget"],function(a,b,c){var d=a.Layout.extend({template:b["more/taskinfo/index-page"],className:"tt_shareinfo",regions:{taskInfoBox:"div[data-name=task-info-box]"},templateHelpers:function(){return{i18n:this.i18n}},initialize:function(){this.i18n=a.Context.getI18n(),this.iTask=this.i18n.task_1,a.Context.setPageTitle(this.iTask),this._getRouterData()},onRender:function(){this._renderEditTaskLayout()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a||{},b.routerData.id=a.Id||a.id||"",b.routerData.topActionFix=1==a.topActionFix?!0:!1}),d},_renderEditTaskLayout:function(){var b=a.Context.getGlobal("tenant_function"),d=!1,e=!1;b&&"object"==typeof b&&(d=b.IsUseMeet||!1,e=b.IsUseBusinessTrip||!1),this.taskDetailView=new c.TaskDetailView({id:this.routerData.id,isShowScroll:this.routerData.topActionFix,isShowMeeting:d,isShowTravel:e,isShowDetialScroll:this.routerData.topActionFix,isShowShare:!0,isShowTask:!0}),this.listenTo(this.taskDetailView,"getDataAfter",function(){this.loadingView&&this.loadingView.close()}),this.taskInfoBox.show(this.taskDetailView),this.taskDetailView.$el.on("click",function(){Talent.app.vent.trigger("global-pull-screen","closed")})}});return a.BasePageView.extend({mainViewClass:d,layout:self===top?"master-layout":"empty-layout"})}),function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(require("../index")):"function"==typeof define&&define.amd?define("momentZH",["moment"],b):b(a.moment)}(this,function(a){"use strict";var b=a.defineLocale("zh-cn",{months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),longDateFormat:{LT:"Ah点mm分",LTS:"Ah点m分s秒",L:"YYYY-MM-DD",LL:"YYYY年MMMD日",LLL:"YYYY年MMMD日LT",LLLL:"YYYY年MMMD日ddddLT",l:"YYYY-MM-DD",ll:"YYYY年MMMD日",lll:"YYYY年MMMD日LT",llll:"YYYY年MMMD日ddddLT"},meridiemParse:/凌晨|早上|上午|中午|下午|晚上/,meridiemHour:function(a,b){return 12===a&&(a=0),"凌晨"===b||"早上"===b||"上午"===b?a:"下午"===b||"晚上"===b?a+12:a>=11?a:a+12},meridiem:function(a,b,c){var d=100*a+b;return 600>d?"凌晨":900>d?"早上":1130>d?"上午":1230>d?"中午":1800>d?"下午":"晚上"},calendar:{sameDay:function(){return 0===this.minutes()?"[今天]Ah[点整]":"[今天]LT"},nextDay:function(){return 0===this.minutes()?"[明天]Ah[点整]":"[明天]LT"},lastDay:function(){return 0===this.minutes()?"[昨天]Ah[点整]":"[昨天]LT"},nextWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()-b.unix()>=604800?"[下]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},lastWeek:function(){var b,c;return b=a().startOf("week"),c=this.unix()<b.unix()?"[上]":"[本]",0===this.minutes()?c+"dddAh点整":c+"dddAh点mm"},sameElse:"LL"},ordinalParse:/\d{1,2}(日|月|周)/,ordinal:function(a,b){switch(b){case"d":case"D":case"DDD":return a+"日";case"M":return a+"月";case"w":case"W":return a+"周";default:return a}},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},week:{dow:1,doy:4}});return b}),define("views/common/gantt/gantt-config",["talent","moment","momentZH"],function(a,b,c){function d(){Ext.override(Sch.tooltip.Tooltip,{update:function(a,b,c){if(this.startDate-a!==0||this.endDate-b!==0||this.valid!==c){this.startDate=a,this.endDate=b,this.valid=c;var d=Ext.Date.format(a,"Y年m月d日 H:i"),e=Ext.Date.format(b,"Y年m月d日 H:i");"calendar"!==this.mode||0!==b.getHours()||0!==b.getMinutes()||b.getYear()===a.getYear()&&b.getMonth()===a.getMonth()&&b.getDate()===a.getDate()||(b=Sch.util.Date.add(b,Sch.util.Date.DAY,-1)),this.callParent([this.template.apply({valid:c,startDate:a,startText:d,endText:e,endDate:b})])}}})}function e(){a.Context.getWebUrl("/Home#more/gantt-print");Ext.require(["Sch.plugin.Printable"],function(){Sch.plugin.Printable.override({getGridContent:function(b){var c,d,e=b.normalGrid,f=b.lockedGrid,g=f.getView(),h=e.getView();this.beforePrint(b);var i=g.store.getRange();c=g.tpl.apply(g.collectData(i,0)),d=h.tpl.apply(h.collectData(i,0)),this.afterPrint(b);var j=(new Date).getTime();j=a.Context.formatDate(j,"yyyy年MM月dd日");var k=a.Context.getUserInfo().Name;return{normalHeader:e.headerCt.el.dom.innerHTML,lockedHeader:f.headerCt.el.dom.innerHTML,lockedRows:c,normalRows:d,allWidth:f.getWidth()+e.headerCt.el.dom.scrollWidth,allHeight:f.getHeight(),lockedWidth:f.getWidth(),printertime:j,printer:k,normalWidth:e.getWidth(),headerHeight:e.headerCt.getHeight(),innerLockedClasses:f.view.el.dom.className,innerNormalClasses:e.view.el.dom.className,width:b.getWidth()}},print:function(){var b=this.scheduler;if(!(this.mainTpl instanceof Ext.Template)){this.mainTpl=Ext.create("Ext.XTemplate",this.mainTpl,{compiled:!0,disableFormats:!0})}var c,d=(b.getView(),this.getStylesheets()),e=Ext.get(Ext.core.DomHelper.createDom({tag:"div"}));d.each(function(a){e.appendChild(a.dom.cloneNode(!0))}),c=e.dom.innerHTML+"";var f=this.getGridContent(b),g=this.mainTpl.apply(Ext.apply({waitText:this.waitText,docType:this.docType,htmlClasses:"",bodyClasses:Ext.getBody().dom.className,componentClasses:b.el.dom.className,title:b.title||"",styles:c,totalWidth:b.getWidth(),setupScript:"("+this.setupScript.toString()+")();"},f)),h=a.$(window).width(),i=a.$(window).height(),j=null,k=a.Context.getWebUrl("/u/"+a.Context.getGlobal("loginUserInfo").Id+"/home#more/gantt-print");j=Ext.isChrome?window.open(k,"_blank"):window.open(k,"_blank","width="+h+";height="+i+";"),j.document.write(g),j.document.close()}})})}function f(){Ext.override(Ext.tree.Column,{initComponent:function(){var a=this.renderer||this.defaultRenderer,b=this.scope||window;this.renderer=function(c,d,e,f,g,h,i){for(var j=[],k=Ext.String.format,l=e.getDepth(),m=Ext.baseCSSPrefix+"tree-",n=m+"elbow-",o=m+"expander",p='<img src="{1}" class="{0}" />',q='<input type="button" role="checkbox" class="{0}" {1} />',r=a.apply(b,arguments),s=e.get("href"),t=e.get("hrefTarget"),u=e.get("cls");e;)(!e.isRoot()||e.isRoot()&&i.rootVisible)&&(e.getDepth()===l?(j.unshift(k(p,m+"icon "+m+"icon"+(e.get("icon")?"-inline ":e.isLeaf()?"-leaf ":"-parent ")+(e.get("iconCls")||""),e.get("icon")||Ext.BLANK_IMAGE_URL)),null!==e.get("checked")&&(j.unshift(k(q,m+"checkbox"+(e.get("checked")?" "+m+"checkbox-checked":""),e.get("checked")?'aria-checked="true"':"")),e.get("checked")&&(d.tdCls+=" "+Ext.baseCSSPrefix+"tree-checked")),e.isLast()?e.isExpandable()?j.unshift(k(p,n+"end-plus "+o,Ext.BLANK_IMAGE_URL)):j.unshift(k(p,n+"end",Ext.BLANK_IMAGE_URL)):e.isExpandable()?j.unshift(k(p,n+"plus "+o,Ext.BLANK_IMAGE_URL)):j.unshift(k(p,m+"elbow",Ext.BLANK_IMAGE_URL))):e.isLast()||0===e.getDepth()?j.unshift(k(p,n+"empty",Ext.BLANK_IMAGE_URL)):0!==e.getDepth()&&j.unshift(k(p,n+"line",Ext.BLANK_IMAGE_URL))),e=e.parentNode;return s&&(r=k('<a href="{0}" target="{1}">{2}</a>',s,t,r)),u&&(d.tdCls+=" "+u),r},this.callParent(arguments)}}),Ext.override(Ext.data.TreeStore,{hasFilter:!1,filter:function(a,b){Ext.isString(a)&&(a={property:a,value:b});for(var c=this,d=c.decodeFilters(a),e=0,f=d.length;f>e;e++)c.filters.replace(d[e]);c.snapshot=c.snapshot||c.getRootNode().copy(null,!0),Ext.Array.each(c.filters.items,function(a){Ext.Object.each(c.tree.nodeHash,function(b,c){a.filterFn?a.filterFn(c)||c.remove():c.data[a.property]!=a.value&&c.remove()})}),c.hasFilter=!0},clearFilter:function(){var a=this;a.filters.clear(),a.hasFilter=!1,a.load()},isFiltered:function(){return this.hasFilter},getCount:function(){var a=this.tree.nodeHash,b=_.keys(a);return b.length-1}})}function g(){Ext.define("designResource",{extend:"Sch.model.Resource",idProperty:"Id",fields:[{name:"Id"},{name:"Name"},{name:"ResourceId"},{name:"parentId"},{name:"LabName"},{name:"LabType"},{name:"UserName"},{name:"hasTask"},{name:"level"},{name:"StartDate"},{name:"DeadLine"},{name:"timeDate"},{name:"IsLongTerm"},{name:"ganttType"}]}),Ext.require(["Sch.view.SchedulerTreeView"],function(){Sch.view.SchedulerTreeView.override({initComponent:function(){this.callParent(arguments);var a=this;if(Ext.isArray(a.eventTpl)){var b=Ext.Array.clone(a.eventTpl),c=b.join("").replace("{{evt-prefix}}",this.eventPrefix);a.eventTpl=Ext.create("Ext.XTemplate",c)}var d=this.eventStore;d.self.mixin("storeadaptions",Sch.data.EventStoreAdaptions),d.adaptEventStore(),this.configureFunctionality(),this.setupEventListeners()}})})}var h=a._.template(['<% if(ganttType == "category") { %>','<div class="g_parent" style="padding-left: <%= (level -1) * 20 + 3 %>px">',"	<% if(expandable && expanded) { %>",'<span class="icon-minus-square x-tree-elbow-plus x-tree-expander"></span>',"	<% } else if(expandable && !expanded){ %>",'<span class="icon-plus-square x-tree-elbow-plus x-tree-expander"></span>',"	<% } %>","<% if(!LabName) {%>",'	<span title="未分类">未分类</span>',"<% } %>",'	<span title="<%= LabName %>"><%= LabName %></span>',"</div>","<% } %>"].join("")),i=["<tpl if=\"ganttType != 'category'\">",'	<div class="gc_child">','		<span title="{UserName}">{UserName}</span>',"	</div>","</tpl>","<tpl if=\"ganttType == 'category'\">",'	<div class="g_parent"></div>',"</tpl>"],j=a._.template(['<% if(ganttType != "category"){ %>',"<% if(hasTask) { %>","<% if(expandable && expanded) { %>",'<div resourceId=<%= ResourceId %> class="gc_child">','<span class="icon-minus-square x-tree-elbow-plus x-tree-expander"></span>','<span class="gc_child_span"><%= Name %></span>',"</div>","<% } else if(expandable && !expanded){ %>",'<div resourceId=<%= ResourceId %> class="gc_child">','<span class="icon-plus-square x-tree-elbow-plus x-tree-expander"></span>','<span class="gc_child_span"><%= Name %></span>',"</div>","<% } else { %>",'<div resourceId=<%= ResourceId %> class="gc_child">','<span title="<%= Name %>" class="gc_child_span"><%= Name %></span>',"</div>","<% } %>","<% } else { %>",'	<div class="gc_child">','		<span class="pgFlagP pgFlag2"></span><span><%= Name %></span>',"	</div>","<% } %>","<% } else { %>",'<div class="g_parent"></div>',"<% } %>"].join("")),k=["<tpl if=\"ganttType != 'category'\">",'<div class="gc_child">','   <tpl if="IsLongTerm">',"	<span>长期</span>","	</tpl>",'	<tpl if="IsLongTerm == false">','		<span title="{timeDate}">{timeDate}</span>',"	</tpl>","</div>","</tpl>","<tpl if=\"ganttType == 'category'\">",'<div class="g_parent"></div>',"</tpl>"],l=["<tpl if=\"ganttType != 'category'\">",'	<div class="task_child">','		<span title="{UserName}">{UserName}</span>',"	</div>","</tpl>","<tpl if=\"ganttType == 'category'\">",'	<div class="g_parent"></div>',"</tpl>"],m=['<h4 class="tipHeader" style="font-size:12px;font-weight:normal">{Name}</h4>','<table class="taskTip">','<tr><td>开始:</td> <td align="left">{[Ext.Date.format(values.StartDate, "Y年m月d日 H:i")]}</td></tr>','<tr><td>结束:</td> <td align="left">{[Ext.Date.format(values.DeadLine, "Y年m月d日 H:i")]}</td></tr>',"</table>"],n=['<tpl for=".">','<div unselectable="on" id="{{evt-prefix}}{id}" style="left:{left}px;top:11px;height:18px;width:{width}px;{style}" class="sch-event x-unselectable {internalcls} {cls}">',"{body}","</div>","</tpl>"],o=a.Context.getI18n(),p=new a.$.Deferred;return require(["sch"],function(){Ext.ns("App"),Ext.onReady(function(){d(),f(),g(),e(),p.resolve()}),Ext.EventManager.fireDocReady()}),{planGroup:{getColumn:function(){return[{header:"类别",sortable:!1,width:110,dataIndex:"LabName",xtype:"treecolumn",renderer:function(a,b,c){return h(c.data)}},{header:o.plan_1+"/"+o.task_1,sortable:!1,width:160,dataIndex:"Name",xtype:"treecolumn",renderer:function(a,b,c){return j(c.data)}},{header:"人员",sortable:!1,width:75,dataIndex:"UserName",xtype:"templatecolumn",tpl:i},{header:"日期",sortable:!1,width:100,dataIndex:"Time",xtype:"templatecolumn",tpl:k}]},toolTipTpl:m,eventTpl:n},planPersonal:{getColumn:function(){return[{header:"类别",sortable:!1,width:110,dataIndex:"LabName",xtype:"treecolumn",renderer:function(a,b,c){return h(c.data)}},{header:o.plan_1+"/"+o.task_1,sortable:!1,width:160,dataIndex:"Name",xtype:"treecolumn",renderer:function(a,b,c){return j(c.data)}},{header:"日期",sortable:!1,width:100,dataIndex:"Time",xtype:"templatecolumn",tpl:k}]},toolTipTpl:m,eventTpl:n},report:{getColumn:function(){return[{header:"类别",sortable:!1,width:110,dataIndex:"LabName",xtype:"treecolumn",renderer:function(a,b,c){return h(c.data)}},{header:o.plan_1+"/"+o.task_1,sortable:!1,width:160,dataIndex:"Name",xtype:"treecolumn",renderer:function(a,b,c){return j(c.data)}},{header:"人员",sortable:!1,width:75,dataIndex:"UserName",xtype:"templatecolumn",tpl:i},{header:"日期",sortable:!1,width:100,dataIndex:"Time",xtype:"templatecolumn",tpl:k}]},toolTipTpl:m,eventTpl:n},task:{getColumn:function(){return[{header:o.task_1,sortable:!1,width:160,dataIndex:"Name",xtype:"treecolumn",renderer:function(a,b,c){return j(c.data)}},{header:"人员",sortable:!1,width:80,dataIndex:"UserName",xtype:"templatecolumn",tpl:l},{header:"日期",sortable:!1,width:100,dataIndex:"Time",xtype:"templatecolumn",tpl:k}]},toolTipTpl:m,eventTpl:n},activeViewType:"monthAndYear",config:{tabConfig:function(a,c){var d=(b(a).toDate().getFullYear(),b(a).toDate().getMonth());3*Math.floor(d/3);return[{text:"年",className:"icon-calendar year",startDate:b(a).startOf("month").subtract("year",0).toDate(),endDate:b(c).endOf("month").add("year",0).toDate(),viewPreset:"year",pressed:!1},{text:"季",className:"icon-calendar quarter",startDate:b(a).startOf("year").toDate(),endDate:b(a).endOf("month").add("month",0).toDate(),viewPreset:"quarter",pressed:!1},{text:"月",className:"icon-calendar month",startDate:b(a).startOf("month").toDate(),endDate:b(c).endOf("month").add("months",1).toDate(),viewPreset:"monthAndYear",pressed:!1},{text:"周",className:"icon-calendar week",startDate:b(a).startOf("week").toDate(),endDate:b(c).endOf("week").add("weeks",1).toDate(),viewPreset:"weekAndMonth",pressed:!1},{text:"天",className:"icon-calendar day",startDate:b(a).startOf("day").toDate(),endDate:b(c).endOf("day").add("days",2).toDate(),viewPreset:"dayAndWeek",pressed:!1}]},monthNames:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["日","一","二","三","四","五","六"]},getEventConfig:function(a){var b;switch(a){case"11":b={lines:[{color:"#b4b4b4"},{color:null},{color:"#b4b4b4"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""}]};break;case"12":b={lines:[{color:"#b4b4b4"},{color:"#00a813"},{color:"#00a813"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"#fff",taskColor:"#fff",text:"提前完成",style:"border-top: 1px dashed #969696;border-bottom: 1px dashed #969696;",textStyle:"color: #646464;"}]};break;case"16":b={lines:[{color:"#b4b4b4"},{color:"#f99e00"},{color:"#f99e00"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"#ddd",taskColor:"#ddd",text:"暂停中",style:"background-color:#e6e6e6;",textStyle:"color: #646464;"}]};break;case"13":b={lines:[{color:"#b4b4b4"},{color:"#cb6efc"},{color:"#cb6efc"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"#ddd",taskColor:"#ddd",text:"已延迟",style:"background-color:#e6e6e6;",textStyle:"color: #646464;"}]};break;case"14":b={lines:[{color:"#b4b4b4"},{color:"#646464"},{color:"#646464"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"#ddd",taskColor:"#ddd",text:"已取消",style:"background-color:#e6e6e6;",textStyle:"color: #646464;"}]};break;case"21":b={lines:[{color:"#b4b4b4"},{color:"#b4b4b4"},{color:null}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"red",taskColor:"red",text:"",style:"",textStyle:"color: #fff;"}]};break;case"22":b={lines:[{color:"#b4b4b4"},{color:"#b4b4b4"},{color:"red"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"red",taskColor:"red",text:"延期完成",style:"",textStyle:"color: #fff;"}]};break;case"26":b={lines:[{color:"#b4b4b4"},{color:"#b4b4b4"},{color:"#f99e00"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"red",taskColor:"red",text:"暂停中",style:"",textStyle:"color: #fff;"}]};break;case"23":b={lines:[{color:"#b4b4b4"},{color:"#b4b4b4"},{color:"#cb6efc"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"red",taskColor:"red",text:"已延迟",style:"",textStyle:"color: #fff;"}]};break;case"24":b={lines:[{color:"#b4b4b4"},{color:"#b4b4b4"},{color:"#646464"}],blocks:[{planColor:"#74bdff",taskColor:"#77dfd0",text:"",style:"",textStyle:""},{planColor:"red",taskColor:"red",text:"已取消",style:"",textStyle:"color: #fff;"}]}}return b},schDeferred:p.promise()}}),define("views/common/gantt/main-view",["talent","templates/common","views/common/gantt/gantt-config","moment","tdialog","momentZH","$.tipsy"],function(a,b,c,d,e,f){return a.Layout.extend({template:b["common/gantt/index-page"],eventTemplate:b["common/gantt/event"],legendTemplate:b["common/gantt/gantt-legend"],defaults:{queryObject:{},endDate:null,startDate:null,allData:[],type:null,url:null,postData:{},leftWidth:0,showTab:!0,scrollLeft:null,activeViewType:"monthAndYear",config:{},labels:[],beforeInitData:function(a){return{allData:a.Data,startDate:a.StartDate,endDate:a.EndDate}}},initialize:function(a){this.nowDate=d().toDate(),this.options=Talent._.extend({},this.defaults,a),_.bindAll(this,"resizeEvent","print","lengendHandler")},getChartData:function(){var b=this,c=new Talent.$.Deferred;return this.options.url?Talent.$.ajax({url:this.options.url,data:this.options.postData,type:"get"}).done(function(d){var e=b.options.beforeInitData(d);b.options=a._.extend({},b.options,e),c.resolve()}):c.resolve(),c.promise()},onShow:function(){var a=this,b=c.schDeferred;b.done(function(){a.renderSchedule()})},renderSchedule:function(){this.localize();var a=this;a.preset(),a.getChartData().done(function(){a.initData(),a.showScheduleView(),a.trigger("gant:aftershow")}),window.__resizeScheduleAction=_.bind(a.resizeSchedule,a),$(window).off("resize",window.__resizeScheduleAction),$(window).on("resize",window.__resizeScheduleAction)},showScheduleView:function(a){var b=this.model.get("startDate"),c=this.model.get("endDate"),d=this.model.get("eventData"),e=this.model.get("lodData"),f=this;if(f.$el.find("._tt_loading_m").hide(),e&&d&&d.length>0){this.createScheduler(d,b,c,e);var g=this.scheduler.getResourceStore();if(g.proxy.data=e,g.load(),this.bindSchViewScrollEvents(),e){var h=g.getCount();this.scheduler.setHeight(38*h+124)}else this.scheduler.setHeight(60)}else this.$el.find(".gantt_empty").show()},resizeSchedule:function(){var a=this.getScheduleWidth();this.scheduler&&this.scheduler.setWidth(a)},onClose:function(){$(window).off("resize",window.__resizeScheduleAction),window.__resizeScheduleAction=null},createScheduler:function(b,d,e){var f,g,h,i,j,k,l=(this.options.queryObject,this.options.type),m=this,n=c[l]||{},o=n.getColumn(),p=Ext.create("Ext.data.TreeStore",{model:"designResource",proxy:{type:"memory"}}),q=this.getEventStore(b),d=this.model.get("startDate"),e=this.model.get("endDate");leftWidth=this.leftWidth;var r=this.getTbaData(d,e);f=r.viewPreset,g=r.startDate,h=r.endDate,i=r.tabData,j=this.getScheduleWidth(),k=r.scrollToDate,node=this.$el.find("#grid-configuration").get(0);var s=this.options.viewConfig||{forceFit:!1,enableEventDragDrop:!0,enableDragCreation:!1,allowOverlap:!1,readOnly:!1,constrainDragToResource:!0},t=a._.extend({height:600,width:j,border:!0,renderTo:node,viewPreset:f,startDate:g,endDate:h,listeners:{eventresizeend:this.resizeEvent,eventdrop:this.resizeEvent,scop:this,beforedragcreate:function(a,b){var c=b.get("EditStatusable");return c},beforeeventdrag:function(a,b){var c=b.get("EditStatusable");return c},beforeeventresize:function(a,b){var c=b.get("EditStatusable");return c}},resizeValidatorFn:function(a,b,c,d){var e=c.getTime(),f=b.get("FinishDate")?b.get("FinishDate").getTime():0,g=b.get("DeadLine").getTime(),h=b.get("EditStatusable");return(e>f||e>g||!h)&&0!=f?!1:!0},dndValidatorFn:function(a,b){return b.get("EditStatusable")},eventRenderer:function(a){var b,d,e,f=a.getStartDate().getTime(),g=a.get("EndDate").getTime(),h=a.get("FinishDate")?a.get("FinishDate").getTime():a.get("FinishDate"),i=a.get("DeadLine").getTime(),j=parseInt(a.get("Status"));0==j&&(h=null),h&&1!=j&&5!=j?0>i-h?(d=(h-i)/(h-f)*100,e=[100-d,d],b="2"+j):(d=(g-h)/(g-f)*100,e=[100-d,d],b="1"+j):i-g>=0?(b="11",d=0,e=[100]):(b="21",d=(g-i)/(g-f)*100,e=[100-d,d]);var k=c.getEventConfig(b);return m.eventTemplate({config:k,percentArr:e,finishTime:h,EditStatusable:a.get("EditStatusable"),isTask:"task"==a.get("ganttType")?!0:!1})},eventTpl:n.eventTpl,tooltipTpl:new Ext.XTemplate(n.toolTipTpl),tipCfg:{trackMouse:!0,showDelay:100,hideDelay:0,autoHide:!0},plugins:[Ext.create("Sch.plugin.CurrentTimeLine",{template:new Ext.XTemplate('<tpl for=".">','<div title="{[this.getTipText(values)]}" class="sch-timeline {uniquecls} {Cls}" style="left:{left}px;top:{top}px;height:{height}px;width:2px"></div>',"</tpl>",{
getTipText:function(a){var b=m.scheduler.getSchedulingView();return b.getFormattedDate(a.Date)+" "+(a.Text||"")}}),autoUpdate:!1}),Ext.create("Sch.plugin.Printable",{beforePrint:function(a){var b=a.getSchedulingView();this.oldRenderer=b.eventRenderer,b.eventRenderer=this.printRenderer},setupScript:"function(){}",docType:'<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">',mainTpl:'{docType}	<html class="x-border-box {htmlClasses}" style="overflow: auto;"><head><meta content="text/html; charset=UTF-8" http-equiv="Content-Type" /><title>{title}</title>{styles}</head><body class="sch-print-body {bodyClasses}"><div id="grid-configuration"><div style="color:#8a8a8a;height:20px;margin-top:10px;margin-bottom:10px;"><div style="float:left;">打印人：</div><div style="float:left;">{printer}</div><div style="float:left;padding-left:15px;">打印时间：</div><div style="float:left;">{printertime}</div></div><div class="sch-print-ct x-panel-body   x-grid-body x-panel-body-default x-panel-body-default x-box-layout-ct" style="width:{allWidth}px"><div class="x-box-inner" role="presentation" id="ext-gen1067" style="width: {allWidth}px; height: {allHeight}px;"><div class="sch-print-headerbg" style="border-left-width:{allWidth}px;height:{headerHeight}px;"></div><div></div><div><div class="sch-print-lockedheader x-grid-header-ct x-grid-header-ct-default x-docked x-docked-top x-grid-header-ct-docked-top x-grid-header-ct-default-docked-top x-box-layout-ct x-docked-noborder-top x-docked-noborder-right x-docked-noborder-left">{lockedHeader}</div><div style="left:{lockedWidth}px" class="sch-print-normalheader x-grid-header-ct x-grid-header-ct-default x-docked x-docked-top x-grid-header-ct-docked-top x-grid-header-ct-default-docked-top x-box-layout-ct x-docked-noborder-top x-docked-noborder-right x-docked-noborder-left">{normalHeader}</div></div><div style="width:{lockedWidth}px;top:{headerHeight}px;" class="sch-print-locked-rows-ct {innerLockedClasses} x-grid-inner-locked">{lockedRows}</div><div style="left:{[Ext.isIE ? values.lockedWidth : 0]}px;top:{headerHeight}px;" class="x-component x-grid-view x-fit-item x-component-default sch-timelineview sch-timelinetreeview x-unselectable sch-schedulerview">{normalRows}</div></div></div></div><script type="text/javascript">{setupScript}</script></body></html>',afterPrint:function(a){a.getSchedulingView().eventRenderer=this.oldRenderer},printRenderer:function(a,b,d,e){var f,g,h,i=a.getStartDate().getTime(),j=a.get("EndDate").getTime(),k=a.get("FinishDate")?a.get("FinishDate").getTime():a.get("FinishDate"),l=a.get("DeadLine").getTime(),n=parseInt(a.get("Status"));0==n&&(k=null),k&&1!=n&&5!=n?0>l-k?(g=(k-l)/(k-i)*100,h=[100-g,g],f="2"+n):(g=(j-k)/(j-i)*100,h=[100-g,g],f="1"+n):l-j>=0?(f="11",g=0,h=[100]):(f="21",g=(j-l)/(j-i)*100,h=[100-g,g]);var o=c.getEventConfig(f);return m.eventTemplate({config:o,percentArr:h,finishTime:k,EditStatusable:a.get("EditStatusable"),isTask:"task"==a.get("ganttType")?!0:!1})}})],columns:o,resourceStore:p,eventStore:q,tbar:i,viewConfig:s},this.options.config),u=Ext.create("Sch.panel.SchedulerTree",t);return setTimeout(function(){if(m.options.scrollLeft){var a=m.scheduler.getHorizontalScroller();a.setScrollLeft(m.options.scrollLeft)}else m.scheduler.scrollToDate(k,!0);var b=m.$el.find(".gantt_btn"),c=parseInt(b.css("left"));b.css({left:c-50})},1e3),this.scheduler=u,this.scheduler.on("eventtreeclick",this.infoBarClick,this),this.scheduler.on("eventclick",this.infoBarClick,this),u},infoBarClick:function(a,b,c,d){if(b.data.EditStatusable){var e=b.data.Id,f=this.scheduler.items.items[0],g=f.items.items[0],h=g.node.childNodes,i=this.getNodeById(h,e);i&&g.toggle(i)}},getNodeById:function(a,b){for(var c=this,d=0,e=a.length;e>d;d++){var f=a[d],g=f.data,h=null;if(b==g.Id){h=f;break}var i=f.childNodes;if(i.length>0&&(h=c.getNodeById(i,b)))break}return h},getTbaData:function(b,d){var e,f,g=this,h=this.options.activeViewType,i=this.options.queryObject||{},j=c.config.tabConfig(b,d);f=i.month&&i.year?"dayAndWeek":i.year?"quarter":h,e=Talent._.findWhere(j,{viewPreset:f}),e.pressed=!0;var k=["->"];a._.each(j,function(a){var b={text:a.text,toggleGroup:"presets",iconCls:a.className,enableToggle:!0,pressed:a.pressed,handler:function(){g.scheduler.switchViewPreset(a.viewPreset,a.startDate,a.endDate),g.scheduler.scrollToDate(a.scrollToDate,!0)}};k.push(b)});var l=[{text:"打印",iconCls:"icon-calendar print",cls:"operate-left-print",handler:function(a){g.scheduler.print()}}],m=[{text:"图例说明？",iconCls:"",cls:"gantt_btn",handler:function(a){g.lengendHandler()}}],n=[{xtype:"buttongroup",items:[{text:"显示开始和结束日期",iconCls:"icon-calendar displayPlan",scope:this,enableToggle:!0,cls:"operate-left",handler:function(a){var b,c=g.scheduler.lockedGrid.columns;_.each(c,function(a){"Time"==a.dataIndex&&(b=a)}),a.pressed?b.setVisible(!1):b.setVisible(!0);var d=g.$el.find(".gantt_btn"),e=parseInt(d.css("left"));d.css({left:e-50})}}]}];return k=a._.union(n,k),k=a._.union(l,k,m),e.tabData=k,this.options.showTab||(e.tabData=[]),e},getScheduleWidth:function(){var a,b=this.options.leftWidth,c=this.options.styWidth||0;return a=this.options.url?document.body.offsetWidth>1380?document.body.offsetWidth-210-10-c:document.body.offsetWidth-b-c:document.body.offsetWidth>1380?document.body.offsetWidth-(.15*(document.body.offsetWidth-150)+150+60)-10-c:document.body.offsetWidth-b-10-c},initData:function(){function b(){if(""==!document.cookie){for(var a={},b=document.cookie.split("; "),c=b.length,d=0;c>d;d++)a[b[d].split("=")[0]]=b[d].split("=")[1];return a.ganttLog?!0:!1}return!1}function c(a,b){for(var c=!0,d=b.length-1;d>=0;d--){var e=b[d];e.Id===a.Id&&(c=!1)}return c}function e(b,d){var g,h=a._.findWhere(j,{id:b.LabId});b.ganttType="category",b.level=1,b.leaf=!1,b.expandable=!0,b.expanded=!0,b.Id=(new Date).getTime()+parseInt(1e4*Math.random());var i=f(b.PlanItems);if(b.children=i,0==b.LabType||4==b.LabType)return b;if(h&&"0"!=h.parent_id){b.level=parseInt(h.lvl);var k=a._.findWhere(j,{id:h.parent_id});if(k)if(g=a._.findWhere(o,{LabId:h.parent_id})){f(g.PlanItems),g.children=g.PlanItems;var l=c(b,g.children);l&&g.children.push(b)}else g={LabName:k.name,LabType:17,LabId:k.id,PlanItems:[b]},o.push(g);return m.push(h.parent_id),e(g,!0)}return b}function f(b){return a._.map(b,function(b){if(b.ResourceId=b.Id,b.StartDate=d(b.StartDate).toDate(),b.DeadLine=d(b.DeadLine).toDate(),b.FinishDate=b.FinishDate?d(b.FinishDate).toDate():b.FinishDate,b.hasTask=b.hasOwnProperty("Tasks")?!0:!1,b.UserName=b.PrincipalUser?b.PrincipalUser.Name:"",b.timeDate=Ext.Date.format(b.StartDate,"Y/m/d")+"-"+Ext.Date.format(b.DeadLine,"Y/m/d"),b.ganttType)return b;b.ganttType=b.hasTask?"plan":"task",k.push(b),l.push(b);var c=[],e=[];return b.Tasks&&b.Tasks.length>0?(a._.each(b.Tasks,function(a){a.Name=a.Name,a.Id=a.Id,a.ResourceId=a.Id,a.DeadLine?a.DeadLine=d(a.DeadLine).toDate():a.DeadLine=d(b.DeadLine).toDate(),a.StartDate||(a.StartDate=b.StartDate),a.UserName=a.PrincipalUser&&a.PrincipalUser.Name,a.ganttType="task",a.StartDate=d(a.StartDate).toDate(),a.FinishDate=a.FinishDate?d(a.FinishDate).toDate():a.FinishDate,a.hasTask=a.hasOwnProperty("Tasks")?!0:!1,a.timeDate=Ext.Date.format(a.StartDate,"Y/m/d")+"-"+Ext.Date.format(a.DeadLine,"Y/m/d"),a.expandable=!1,a.parentId=b.Id,e.push(a),l.push(a),c.push(a)}),b.children=e,b.expandable=!0,b.expanded=!0):(b.leaf=!0,b.expandable=!1,b.children=[]),b}),b}var g,h=JSON.stringify(this.options.allData),i=JSON.parse(h),j=this.options.labels,k=[],l=[],m=[],n=[];if(this.options.lodData&&(k=this.options.lodData),this.options.eventData&&(l=this.options.eventData),!this.options.lodData||!this.options.eventData)if("task"!=this.options.type){var o=a._.filter(i,function(a){return 0!=a.LabType&&4!=a.LabType}),p=a._.filter(i,function(a){return 0==a.LabType}),q=a._.filter(i,function(a){return 4==a.LabType});a._.each(o,function(b){var d=b.LabId;if(-1==a._.indexOf(m,d)){m.push(d);var f=e(b),g=c(f,n);g&&n.push(f)}}),q.length>0&&a._.each(q,function(a){var b=e(a),d=c(b,n);d&&n.push(b)}),p.length>0&&n.push(e(p[0])),g={Id:0,children:n};b()}else{f(i),g={Id:0,children:k};b()}this.model.set({labels:j,lodData:g,eventData:l,startDate:this.options.startDate,endDate:this.options.endDate})},sucessModify:function(a){a.setDirty(),a.beginEdit(),a.set("tempDeadLine",a.get("DeadLine")),a.set("tempStartDate",a.get("StartDate")),a.endEdit();var b=this.scheduler.getResourceStore(),c=b.tree.nodeHash[a.get("ResourceId")];if(c){c.beginEdit();var d=Ext.Date.format(a.get("StartDate"),"Y/m/d")+"-"+Ext.Date.format(a.get("DeadLine"),"Y/m/d");c.set("timeDate",d),c.endEdit()}},cancelModify:function(a){a.setDirty(),a.beginEdit(),a.set("DeadLine",a.get("tempDeadLine")),a.set("StartDate",a.get("tempStartDate"));var b=this.getEndDate(a.get("DeadLine"),a.get("FinishDate"),a.get("Status"));a.set("EndDate",b),a.endEdit(),this.TipDialog.close()},sureModify:function(a,b){var c=a&&a.data&&a.get("ResourceId");if(c){var e=a.get("DeadLine").getTime(),f=(a.get("FinishDate")?a.get("FinishDate").getTime():0,this.getEndDate(a.get("DeadLine"),a.get("FinishDate"),a.get("Status"))),g=a.get("EndDate").getTime()-f.getTime(),e=e+g;a.beginEdit(),a.set("DeadLine",d(e).toDate()),f=this.getEndDate(a.get("DeadLine"),a.get("FinishDate"),a.get("Status")),a.set("EndDate",f),a.endEdit(),this.trigger("gantt:resizeend",{hasTask:a.get("hasTask"),Id:a.get("ResourceId"),StartDate:d(a.get("StartDate")).format("YYYY/MM/DD HH:mm:ss"),DeadLine:d(a.get("DeadLine")).format("YYYY/MM/DD HH:mm:ss"),nodeId:b})}a.get("hasTask")&&(this.TipDialog.hide(),this.TipDialog.close())},resizeEvent:function(a,b){b instanceof Array&&(b=b[0]),this.resizeModel=b;var c=this,d=this.$el.find("#"+a.id+"-"+this.resizeModel.internalId),f="#"+a.id+"-"+this.resizeModel.internalId;if(this.resizeModel.get("hasTask")){this.TipDialog&&this.TipDialog.close(),this.TipDialog=new e({type:"tipsy",cancel:function(){c.cancelModify(c.resizeModel)},sure:function(){c.sureModify(c.resizeModel,f)}});d.position()||{top:30};this.TipDialog.render().$el.appendTo("body"),this.TipDialog.show(d,"确定要修改计划的时间吗？",{pos:"topCenter",className:"ask",arrow:!1})}else this.sureModify(c.resizeModel)},preset:function(){var a=this;Sch.preset.Manager.registerPreset("year",{timeColumnWidth:110,rowHeight:38,resourceColumnWidth:110,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{bottom:{unit:"QUARTER",renderer:function(a,b,c){return Ext.String.format("季度{0}",Math.floor(a.getMonth()/3)+1)}},middle:{unit:"YEAR",dateFormat:"Y年"}}}),Sch.preset.Manager.registerPreset("quarter",{timeColumnWidth:180,rowHeight:38,resourceColumnWidth:180,displayDateFormat:"Y-m-d",shiftUnit:"YEAR",shiftIncrement:1,defaultSpan:1,timeResolution:{unit:"MONTH",increment:1},headerConfig:{bottom:{unit:"QUARTER",renderer:function(a,b,c){return Ext.String.format("季度{0}",Math.floor(a.getMonth()/3)+1)}},middle:{unit:"YEAR",dateFormat:"Y年"}}}),Sch.preset.Manager.registerPreset("dayAndWeek",{timeColumnWidth:36,rowHeight:38,resourceColumnWidth:36,displayDateFormat:" G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:5,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"DAY",dateFormat:"d"},top:{unit:"MONTH",renderer:function(a,b,c){return Ext.Date.format(a,"M")}}}}),Sch.preset.Manager.registerPreset("monthAndYear",{timeColumnWidth:110,rowHeight:38,resourceColumnWidth:110,displayDateFormat:"Y-m-d",shiftIncrement:3,shiftUnit:"MONTH",defaultSpan:12,timeResolution:{unit:"DAY",increment:1},headerConfig:{middle:{unit:"MONTH",dateFormat:"M"},top:{unit:"YEAR",renderer:function(a,b,c){var d=Ext.Date.format(a,"Y");return d+"年"}}}}),Sch.preset.Manager.registerPreset("weekAndMonth",{timeColumnWidth:253,rowHeight:38,resourceColumnWidth:253,displayDateFormat:"Y-m-d G:i",shiftUnit:"DAY",shiftIncrement:1,defaultSpan:12,timeResolution:{unit:"HOUR",increment:1},headerConfig:{middle:{unit:"WEEK",renderer:function(b,c,d){var e=b.getYear(),f=b.getMonth()+1,g=b.getDate(),h=a.getWeekMonth(e,f,g);return"第"+h+"周"}},top:{unit:"MONTH",renderer:function(a,b,c){return c.align="left",Ext.Date.format(a,"Y年m月")}}}})},getWeekMonth:function(a,b,c){var d=new Date(a,parseInt(b)-1,c),e=d.getDay(),f=d.getDate();return Math.ceil((f+6-e)/7)},localize:function(){Ext.Date&&(Ext.Date.monthNames=c.config.monthNames,Ext.Date.dayNames=c.config.dayNames,Ext.Date.formatCodes.a="(this.getHours() < 12 ? '上午' : '下午')",Ext.Date.formatCodes.A="(this.getHours() < 12 ? '上午' : '下午')")},print:function(){var b=Ext.pluck(this.scheduler.getEventStore().data.items,"data"),c=Ext.pluck(this.scheduler.getResourceStore().data.items,"data"),d=this.scheduler.getHorizontalScroller(),e=[];b=a._.each(b,function(b){var c=a._.clone(b);c.StartDate=c.StartDate.getTime(),c.FinishDate=a._.isDate(c.FinishDate)?c.FinishDate.getTime():null,c.DeadLine=c.DeadLine.getTime(),e.push(c)}),a.$.ajax({url:a.Context.getApiUrl("HelpUI/save"),type:"POST",data:{content:JSON.stringify({startDate:this.model.get("startDate"),endDate:this.model.get("endDate"),type:this.options.type,eventData:e,lodData:c,activeViewType:this.scheduler.viewPreset,scrollLeft:d.scrollEl.dom.scrollLeft,showTab:!1,leftWidth:this.options.leftWidth})},success:function(b){var c=a.$(window).width(),d=a.$(window).height();if(1==b.Code){var e=b.Data,f=a.Context.getWebUrl("/u/"+a.Context.getGlobal("loginUserInfo").Id+"/home#more/gantt-print?key="+e);Ext.isChrome?window.open(f,"_self"):window.open(f,"_blank","width="+c+";height="+d+";")}else alert("数据预存失败，请重试！")}})},getEventStore:function(b){var c=this,b=a._.map(b,function(a){var b=(a.StartDate=a.tempStartDate=d(a.StartDate).toDate(),a.DeadLine=a.tempDeadLine=d(a.DeadLine).toDate()),e=a.FinishDate=d(a.FinishDate).toDate(),f=(e.getTime(),c.getEndDate(b,e,a.Status));return a.EndDate=a.tempEndDate=f,a});return Ext.create("Ext.data.JsonStore",{model:"Sch.model.Event",data:b})},bindSchViewScrollEvents:function(){a.$(".sch-schedulerview").off("scroll.schedule-header"),a.$(".sch-schedulerview").on("scroll.schedule-header",function(){for(var b=a.$(this),c=a.$(".sch-column-header-inner .sch-column-header"),d=0;d<c.length;d++){var e=$(c[d]),f=e.position().left,g=f+e.width()/2;g<=b.scrollLeft()?e.find("div").css("text-align","right"):e.find("div").css("text-align","center")}})},getEndDate:function(a,b,c){var c=parseInt(c);(1==c||5==c)&&(b=null);var d,a=a,b=b,e=b?b.getTime():0,f=this.nowDate;return d=e?e>a.getTime()?b:a:a.getTime()>=f.getTime()?a:f},lengendHandler:function(b){var c=this,d=this.$el.find(".gantt_btn"),f=this.legendTemplate();if(!this.legendViewIsShow){this.legendViewIsShow=!0,this.lengedView=new e({fixed:!1,type:"modal",sure:!1,cancel:!1}),this.lengedView.render().$el.appendTo("body");var g={arrow:1,arrowBias:187,topBias:0,leftBias:-5,autoHide:!1};this.lengedView.show(d,f,g),a.$("body").off("click.legendIntroduce"),a.$("body").on("click.legendIntroduce",function(b){var d=a.$(b.target);d.hasClass("gantt_btn")||0!=d.parents(".gantt_btn").length||c.lengedView&&(c.lengedView.hide(),c.legendViewIsShow=!1)})}}})}),define("views/more/gantt-print/index-page-view",["talent","views/common/gantt/main-view"],function(a,b){var c=a.Layout.extend({template:a._.template('<div class="gantt-main"></div>'),regions:{main:".gantt-main"},initialize:function(){$("body").addClass("sch-print-body")},onShow:function(){},renderScheduler:function(a){var c=this;this.getData(a).done(function(a){a.config={eventRenderer:function(a,b,c,d){return d%2===0?c.cls+=" specialEventType sch-print-normal-rows-ct":c.cls+=" normalEvent  sch-print-normal-rows-ct",c.style=Ext.String.format("border-right-width:{0}px;",c.width),c.style+="overflow:visible",Ext.Date.format(a.get("StartDate"),"M d")}};var d=new b(a);c.main.show(d),c.listenTo(d,"gant:aftershow",function(){c.$el.find("#grid-configuration").attr("id",""),setTimeout(function(){var a=c.$el.find(".x-grid-table").height(),b=d.sched.normalGrid.headerCt.getHeight();d.sched.setHeight(b+a),window.print()},2e3)})})},getData:function(b){var c=new a.$.Deferred;return a.app.request("TempStorage:getData",{key:b}).done(function(a){var b=JSON.parse(a);c.resolve(b)}),c.promise()}});return a.BasePageView.extend({mainViewClass:c,hideSidebar:!0,layout:"empty-layout"})}),define("views/common/apply/apply-list-composite-new-view",["talent","templates/common","tdialog","views/common/empty-view","moment","momentZH"],function(a,b,c,d,e,f){var g=a.ItemView.extend({tagName:"div",className:"apply_item",template:b["common/apply/apply-item"],initialize:function(b){this.options=b,this.model.set("state",this.model.get("ApplyState")),this.model.set("apply_content",""),this.i18n=a.Context.getI18n()},ui:{sureItem:'button[data-name="sure-item"]',cancelItem:'button[data-name="cancel-item"]',tabA:'a[data-name="plan-name"]'},events:function(){var a={};return a["click "+this.ui.sureItem]="_checkSureNode",a["click "+this.ui.cancelItem]="_onClickCancel",a["click "+this.ui.tabA]="_clickTabName",a},onRender:function(){var a=this;setTimeout(function(){a._setApplyTreeHeight()},0)},_setApplyTreeHeight:function(){if(1!=this.model.get("state")||1==this.model.get("state")&&0==this.model.get("IsEditApplyAble")){var a=this.$el.find(".apply_detail").height();if(a>20){var a=a-27;this.$el.find(".apply_tree").css({height:a+"px"})}}},templateHelpers:function(){var a=this.model.toJSON(),b=a.ApplyType,c=a.PublishUser,d=a.PlanName,f=a.OldLableName,g=a.PlanId,h=this.i18n.task_1;if(f||(f="未分类"),this.options.showPullPushScreen)var i="<span class='taskName' data-name='plan-name' id='"+g+"'>"+d+"</span>";else var i=d;if(1==b){if(this.options.showPullPushScreen)var j="<span class='taskName' data-name='plan-name' id='"+g+"'>"+this.model.get("OldName")+"</span>",k="<span class='taskName' data-name='plan-name' id='"+g+"'>"+this.model.get("NewName")+"</span>";else var j=this.model.get("OldName"),k=this.model.get("NewName");var l=c.Name+":将"+h+"名称<span>"+j+"</span>改成<span>"+k+"</span>"}else if(2==b){var m=this.model.get("IsNewLong");if(m)var n="长期";else var n=this.model.get("NewDeadLine");var o=this.model.get("IsOldLong");if(o)var p="长期";else var p=this.model.get("OldDeadLine");if(this.model.get("OldStartDate")||p)var l=c.Name+":将"+h+"<span>"+i+"</span>起止时间<span>"+this.model.get("OldStartDate")+" - "+p+"</span>修改成<span>"+this.model.get("NewStartDate")+" - "+n+"</span>";else var l=c.Name+":将"+h+"<span>"+i+"</span>起止时间修改成<span>"+this.model.get("NewStartDate")+" - "+n+"</span>"}else if(3==b)var l=c.Name+":将"+h+"<span>"+i+"</span>分类<span>"+f+"</span>改成<span>"+this.model.get("NewLableName")+"</span>";else if(4==b)var l=c.Name+":将"+h+"<span>"+i+"</span><span>删除了</span>";else if(5==b)var l=c.Name+":将"+h+"<span>"+i+"</span>状态<span>"+this.model.get("OldState")+"</span>改成<span>"+this.model.get("NewState")+"</span>";else if(15==b){var q=this.model.get("OldDescription");if(!q&&this.model.get("NewDescription"))var l=c.Name+":给"+h+"<span>"+i+"</span>添加了描述与备注<span>"+this.model.get("NewDescription")+"</span>";else if(!this.model.get("NewDescription")&&q)var l=c.Name+":将"+h+"<span>"+i+"</span>的描述与备注<span>删除了</span>";else var l=c.Name+":将"+h+"<span>"+i+"</span>描述与备注<span>"+q+"</span>改成<span>"+this.model.get("NewDescription")+"</span>"}var r=this.model.get("PlanDate"),s=e(r).format("YYYY/MM/DD");if(e(r).minute()<=9)var t="0"+e(r).minute();else var t=e(r).minute();var u=e(r).hour()+":"+t,v=this.model.get("ApplyDate"),w=y="";if(v){var w=e(v).format("YYYY/MM/DD");if(e(v).minute()<=9)var x="0"+e(v).minute();else var x=e(v).minute();var y=e(v).hour()+":"+x}return{txtTemplate:l,t_start_date:s,t_start_hour:u,t_end_date:w,t_end_hour:y}},onShow:function(){this.model.get("state")==this.options.stateDefault&&this.model.get("IsEditApplyAble")?(this.$el.css({"line-height":"30px"}),this.$el.find(".apply_status").css({"margin-top":"6px"})):this.$el.find(".apply_msg:first").css({"line-height":"20px"})},_onClickCancel:function(b){var d=this,e=a.$(b.currentTarget);this.cancelTipDialog||(this.cancelTipDialog=new c({fixed:!1,type:"tipsy",cancel:!0,minWidth:366,sure:function(){d.cancelTipDialog.$el.hide(),d.model.set("state",3);var a=d.cancelTipDialog.$el.find(".apply_desc").val();d.model.set("apply_content",Talent._.escape(a)),d._requestUpdateState()}}),this.$el.parent().append(this.cancelTipDialog.render().$el)),this.cancelTipDialog.show(e,'<div class="apply_pop"><h2>驳回理由</h2><textarea class="apply_desc" style="resize:none;"></textarea></div>',{pos:"bottomRight",arrow:!1,container:this.$el.parent()})},_checkSureNode:function(b){var d=this,e=a.$(b.currentTarget);this.tipDialog||(this.tipDialog=new c({fixed:!1,type:"tipsy",cancel:!0,sure:function(){d.tipDialog.$el.hide(),d.model.set("state",2),d._requestUpdateState()}}),this.$el.parent().append(this.tipDialog.render().$el)),this.tipDialog.show(e,"您确定同意该审批项吗？",{pos:"bottomCenter",className:"ask",arrow:!1,container:this.$el.parent()})},_requestUpdateState:function(){var b=this;a.app.request("Apply:updateApplyBatchState",{ApplyIds:this.model.get("ApplyId"),State:this.model.get("state"),ApplyContent:this.model.get("apply_content")}).done(function(a){b.model.set("state",2),b.trigger("deleteItem")}).fail(function(a){b._tipMessage(b.ui.sureItem,a)})},_tipMessage:function(a,b,d){this.failDialog||(this.failDialog=new c({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:d||"warn"})},_clickTabName:function(){this.trigger("clickName")},onClose:function(){this.cancelTipDialog&&this.cancelTipDialog.close(),this.tipDialog&&this.tipDialog.close()}});return a.CollectionView.extend({defaults:{textWaiting:"暂无待审批的任务",textSure:"暂无同意任何审批",textCancel:"暂无驳回任何审批",textDefault:"暂无任何审批",stateDefault:1,stateSure:2,stateCancel:3,showPullPushScreen:!1},itemView:g,emptyView:d,className:"apply_common_list",ui:{taskName:".tit_ttpl",taskName:'[data-name="plan-name"]'},events:function(){var a={};return a["click "+this.ui.taskName]="_onClickName",a},initialize:function(b){this.setting=a._.extend({},this.defaults,b)},onRender:function(){var a=this;this.on("itemview:deleteItem",function(b){a.collection.remove(b.model),a.trigger("removeModel",b.model)}),this.on("itemview:clickName",function(b){a.trigger("clickName",b.model.get("PlanId"))})},_onClickName:function(a){a.stopPropagation();var b=this,c=b.$(a.currentTarget),d=c.attr("id");Talent.app.vent.trigger("global-pull-screen",d,"task")},itemViewOptions:function(){var a=this._getEmptyContext();return{emptyContext:a,stateDefault:this.setting.stateDefault,stateSure:this.setting.stateSure,stateCancel:this.setting.stateCancel,showPullPushScreen:this.setting.showPullPushScreen}},_getEmptyContext:function(){var a=this.model.get("state");if(a==this.setting.stateDefault)var b=this.setting.textWaiting;else if(a==this.setting.stateSure)var b=this.setting.textSure;else if(a==this.setting.stateCancel)var b=this.setting.textCancel;else var b=this.setting.textDefault;return b},onClose:function(){}})}),define("views/common/apply/apply-batch-view",["talent","templates/common","tdialog"],function(a,b,c){return a.ItemView.extend({defaults:{sureBatchContent:"您确定同意全部审批项吗？",cancelBatchContent:"您确定驳回全部审批项吗？"},className:"apply_all",template:b["common/apply/apply-batch"],initialize:function(a){},ui:{sureBtn:'button[data-name="sure-all"]',cancelBtn:'button[data-name="cancel-all"]'},events:function(){var a={};return a["click "+this.ui.sureBtn]="_checkNode",a["click "+this.ui.cancelBtn]="_checkNode",a},onRender:function(){},_checkNode:function(b){var d=this,e=a.$(b.currentTarget),f=e.attr("data-name");if(!e.hasClass("btn-disabled")){if(this.tipDialog&&this.tipDialog.close(),this.tipDialog=new c({fixed:!1,type:"tipsy",cancel:!0,sure:function(){d.tipDialog.$el.hide(),e.text("正提交...").addClass("btn-disabled"),"sure-all"==f?d.trigger("sure"):d.trigger("refuse")}}),this.$el.append(this.tipDialog.render().$el),"sure-all"==f)var g=this.defaults.sureBatchContent;else var g=this.defaults.cancelBatchContent;this.tipDialog.show(e,g,{pos:"bottomRight",className:"ask",arrow:!1,container:this.$el})}},_tipMessage:function(a,b,d){this.failDialog||(this.failDialog=new c({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:d||"warn"})},onClose:function(){this.failDialog&&this.failDialog.close(),this.tipDialog&&this.tipDialog.close()}})}),define("views/more/apply/index-page-view",["talent","templates/more","tdialog","views/common/apply/apply-list-composite-new-view","views/common/apply/apply-batch-view"],function(a,b,c,d,e){var f=a.Collection.extend({initialize:function(){this.model=a.Model.extend({idAttribute:"ApplyId"})}}),g=a.Layout.extend({defaults:{state:1},className:"_tt_layout_subnav_fluid",template:b["more/apply/index-page"],ui:{sureBtn:'button[data-name="sure-all"]',cancelBtn:'button[data-name="cancel-all"]',tabLi:".ms_tablist li",pageTitle:'span[data-name="page-title"]'},regions:{applyList:'div[data-name="apply-common-list"]',batch:'div[data-name="apply-betch"]'},initialize:function(){this.i18n=a.Context.getI18n(),this.mapping={plan:{name:"我的"+this.i18n.task_1+"审批"}},this._routerData()},events:function(){var a={};return a["click "+this.ui.tabLi]="_clickTab",a},onRender:function(){this._renderListView()},_renderListView:function(){var a=this;this._getPageData().done(function(b){b||(b=[]),a.pageData=b,a.model.get("state")==a.defaults.state&&a.pageData.length>1&&1==a.pageData[0].IsEditApplyAble?a._renderAppLyBatchView():a.applyBatchView&&a.applyBatchView.close(),a._renderListCompositeView(),a._deleteIndicator()})},_clickTab:function(b){var c=a.$(b.currentTarget);this.$el.find(".ms_tablist li").removeClass("current"),c.addClass("current");var d=c.attr("state");this.model.set("state",d),this._renderListView()},_renderAppLyBatchView:function(){var a=this;this.applyBatchView=new e,this.batch.show(this.applyBatchView),this.listenTo(this.applyBatchView,"sure",function(){a._requestUpdateState(state="2")}),this.listenTo(this.applyBatchView,"refuse",function(){a._requestUpdateState(state="3")})},_requestUpdateState:function(b){var c=this,d=this.applyListCompositeView&&this.applyListCompositeView.collection?this.applyListCompositeView.collection:new a.Collection;if(d.length){var e=_.map(d.models,function(a){return a.get("ApplyId")});a.app.request("Apply:updateApplyBatchState",{ApplyIds:e.join(","),State:b,name:this.routerData.name}).done(function(a){c.isClosed||c.render()}).fail(function(a){if(!c.isClosed){if(2==b)var d=c.ui.sureBtn;else var d=c.ui.cancelBtn;c._tipMessage(d,a)}})}},_tipMessage:function(a,b,d){this.failDialog||(this.failDialog=new c({type:"tipsy"}),$("body").append(this.failDialog.render().$el)),this.failDialog.show(a,b,{pos:"topCenter",arrow:!1,autoHide:!0,className:d||"warn"})},_renderListCompositeView:function(){var a=this;"plan"==this.routerData.name&&(this.applyListCompositeView=new d({collection:new f(this.pageData),model:this.model,showPullPushScreen:!0}),this.applyList.show(this.applyListCompositeView),this.applyListCompositeView.on("removeModel",function(){var b=a.applyListCompositeView.collection;b.length<2&&a.applyBatchView&&a.applyBatchView.close()})),this.applyListCompositeView.on("removeModel",function(){var b=a.applyListCompositeView.collection;b.length<2&&a.applyBatchView&&a.applyBatchView.close()})},_getPageData:function(){var b=this.routerData,c=(a.Context.getUserInfo().Id,7),d=a.app.request("Apply:getGroupApplyList",{state:this.model.get("state"),obj_type:c,name:b.name}),e=new a.$.Deferred;return d.done(function(a){self.isClosed||e.resolve(a)}),e},_routerData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(c){if(!b.isClosed){var d=c.name||"plan";b.routerData=c,b.routerData.pageTitle="",b.routerData.name=d,b.routerData.pageTitle=b.mapping[d].name,b.routerData.state=c.state||b.defaults.state,b.model.set(b.routerData),a.Context.setPageTitle("tita-"+b.routerData.pageTitle)}}),d},_deleteIndicator:function(){var b=this.routerData.delindicator;b&&(a.$(document).trigger("clear:Indicator",b),a.app.request("Indicator:deleteData",{indicatorType:b}).done(function(){}))},templateHelpers:function(){return{i18n:this.i18n,wiki:a.Context.getGlobal("titaHost")+"/u/200869416/Home#set?page_id=approvals"}},onClose:function(){this.failDialog&&this.failDialog.close()}});return a.BasePageView.extend({mainViewClass:g,layout:window.top==window?"master-layout":"empty-layout"})}),define("views/more/platformcustomize/platform-list-view",["talent","templates/more"],function(a,b){var c={1:{icon:"icon-big-platform-work",background:"#699eee"},3:{icon:"icon-app-default",background:"#6699ff"},4:{icon:"icon-app-default",background:"#6699ff"},99:{icon:"icon-big-my-attendance",background:"#ff8054"},100:{icon:"icon-app-default",background:"#6699ff"},200:{icon:"icon-recommand",background:"#4c97eb"},201:{icon:"icon-bangbang",background:"#eb71ba"},203:{icon:"icon-big-recruit",background:"#13d7d6"},300:{icon:"icon-app-default",background:"#6699ff"},400:{icon:"icon-big-performance",background:"#a6d331"},401:{icon:"icon-talent-point",background:"#4c97eb"},402:{icon:"icon-target",background:"#2ec1eb"},500:{icon:"icon-big-development",background:"#5fc1f4"},501:{icon:"icon-360",background:"#c167f6"},502:{icon:"icon-big-talent-review",background:"#eb71ba"},503:{icon:"icon-research",background:"#f6ab36"},600:{icon:"icon-support",background:"#2ec1eb"},700:{icon:"icon-book-meetting",background:"#f2854b"},710:{icon:"icon-app-default",background:"#6699ff"},800:{icon:"icon-app-default",background:"#6699ff"},820:{icon:"icon-app-default",background:"#6699ff"},830:{icon:"icon-app-default",background:"#6699ff"},840:{icon:"icon-app-default",background:"#6699ff"},900:{icon:"icon-app-default",background:"#6699ff"},901:{icon:"icon-quik-approval",background:"#13d7d6"},910:{icon:"icon-app-report",background:"#49b7f0"},930:{icon:"icon-ocean",background:"#6699ff"}},d=a.ItemView.extend({template:b["more/platformcustomize/platform-li"],tagName:"li",className:"platform-li",initialize:function(){},ui:{editName:".platform-cursor",blurName:".edit-Name",blurHref:".edit-Href",updateHref:".edit-Href",updateName:".edit-Name"},templateHelpers:function(){var a=c[this.model.get("AppId")]||{icon:"icon-app-default",background:"#6699ff"};return{data:a}},events:function(){var a={};return a["click "+this.ui.editName]="edit",a["blur "+this.ui.blurName]="closeName",a["blur "+this.ui.blurHref]="closeHref",a["keydown "+this.ui.updateName]="updateOnName",a["keydown "+this.ui.updateHref]="updateOnHref",a},edit:function(b){var c=a.$(b.currentTarget);c.addClass("hide-font").siblings().removeClass("editing"),c.siblings(".edit-Name").focus()},updateOnName:function(a){13==a.keyCode&&this.closeName(a)},closeName:function(b){var c=a.$(b.currentTarget),d=c.val();if(d)this.model.set("Name",d);else{var e=this.model.get("Name");this.model.set("Name",e)}c.addClass("editing").siblings(".platform-cursor").removeClass("hide-font"),c.siblings(".edit-Href").focus()},updateOnHref:function(a){13==a.keyCode&&this.closeHref(a)},closeHref:function(b){var c=a.$(b.currentTarget),d=c.val();if(d)this.model.set("Href",d);else{var e=this.model.get("Href");this.model.set("Href",e)}c.addClass("editing").siblings(".platform-cursor").removeClass("editing")}}),e=a.CompositeView.extend({template:b["more/platformcustomize/platform-list"],itemView:d,itemViewContainer:"#show-data",initialize:function(){},ui:{paltformAddSys:".platform-add .sys-link",linkDelete:".platform-li .link-delete",toDelete:".platform-li .link-delete .delete",cancleDelete:".platform-li .link-delete .cancle"},events:function(){var a={};return a["click "+this.ui.paltformAddSys]="paltformAddSys",a["click "+this.ui.linkDelete]="linkDelete",a["click "+this.ui.toDelete]="toDelete",a["click "+this.ui.cancleDelete]="cancleDelete",a},paltformAddSys:function(){a.$(".hide-box").addClass("hide-show")},linkDelete:function(b){"DIV"==b.target.tagName&&(a.$(".platform-li .link-delete ").removeClass("link-delete-ani"),a.$(b.currentTarget).addClass("link-delete-ani"));
},toDelete:function(b){var c=[],d=a.$(b.target).parent().attr("flag");c.push(d),this.trigger("linkListChanged",c)},cancleDelete:function(b){a.$(b.currentTarget).parent().removeClass("link-delete-ani")}});return e}),define("views/more/platformcustomize/platform-title-view",["talent","templates/more"],function(a,b){var c=a.ItemView.extend({template:b["more/platformcustomize/platform-title"],initialize:function(){},ui:{inputChange:".text-edit"},events:function(){var a={};return a["focus "+this.ui.inputChange]="inputFocus",a["blur "+this.ui.inputChange]="inputBlur",a["change "+this.ui.inputChange]="inputChange",a["keydown "+this.ui.inputChange]="inputkeydown",a},inputFocus:function(a){$(a.currentTarget).addClass("input-focus")},inputBlur:function(a){$(a.currentTarget).removeClass("input-focus")},inputChange:function(b){var c=$(b.currentTarget).val(),d=a.$(b.currentTarget).attr("flag"),e={curValue:c,curFlag:d};this.trigger("titleChanged",e)},inputkeydown:function(a){13==a.keyCode&&($(a.currentTarget).removeClass("input-focus"),$(a.currentTarget).blur())}});return c}),define("views/more/platformcustomize/platform-hide-list-view",["talent","templates/more"],function(a,b){var c={1:{icon:"icon-big-platform-work",background:"#699eee"},3:{icon:"icon-app-default",background:"#6699ff"},4:{icon:"icon-app-default",background:"#6699ff"},99:{icon:"icon-big-my-attendance",background:"#ff8054"},100:{icon:"icon-app-default",background:"#6699ff"},200:{icon:"icon-recommand",background:"#4c97eb"},201:{icon:"icon-bangbang",background:"#eb71ba"},203:{icon:"icon-big-recruit",background:"#13d7d6"},300:{icon:"icon-app-default",background:"#6699ff"},400:{icon:"icon-big-performance",background:"#a6d331"},401:{icon:"icon-talent-point",background:"#4c97eb"},402:{icon:"icon-target",background:"#2ec1eb"},500:{icon:"icon-big-development",background:"#5fc1f4"},501:{icon:"icon-360",background:"#c167f6"},502:{icon:"icon-big-talent-review",background:"#eb71ba"},503:{icon:"icon-research",background:"#f6ab36"},600:{icon:"icon-support",background:"#2ec1eb"},700:{icon:"icon-book-meetting",background:"#f2854b"},710:{icon:"icon-app-default",background:"#6699ff"},800:{icon:"icon-app-default",background:"#6699ff"},820:{icon:"icon-app-default",background:"#6699ff"},830:{icon:"icon-app-default",background:"#6699ff"},840:{icon:"icon-app-default",background:"#6699ff"},900:{icon:"icon-app-default",background:"#6699ff"},901:{icon:"icon-quik-approval",background:"#13d7d6"},910:{icon:"icon-app-report",background:"#49b7f0"},930:{icon:"icon-ocean",background:"#6699ff"}},d=a.ItemView.extend({template:b["more/platformcustomize/platform-hide-li"],tagName:"li",initialize:function(){this.listenTo(this.model,"change",this.render)},templateHelpers:function(){return{data:c[this.model.get("AppId")]||{icon:"icon-app-default",background:"#6699ff"}}},ui:{Selected:".hide-div"},events:function(){var a={};return a["click "+this.ui.Selected]="selectedLink",a},selectedLink:function(b){var c=a.$(b.currentTarget);c.toggleClass("hide-div-selected")}}),e=a.CompositeView.extend({template:b["more/platformcustomize/platform-hide-list"],itemView:d,itemViewContainer:"#hide-ul",initialize:function(){},ui:{addLink:".add-btn"},events:function(){var a={};return a["click "+this.ui.addLink]="add",a},onShow:function(){0==this.collection.toJSON().length&&this.$el.find("#hide-ul").html("没有可供添加的导航哦~")},add:function(){var b=this,c=[];a.$(".hide-div").hasClass("hide-div-selected")?(a.$("div.hide-div-selected input:hidden").each(function(){var b=a.$(this).val();c.push(b)}),this.trigger("linkListChanged",c),a.$(".hide-box").removeClass("hide-show"),a.$(".hide-div").removeClass("hide-div-selected")):(this.$el.find(".add-btn").addClass("info-show"),setTimeout(function(){b.$el.find(".add-btn").removeClass("info-show")},3e3))}});return e}),define("views/more/platformcustomize/platform-layout-view",["talent","templates/more","views/more/platformcustomize/platform-list-view","views/more/platformcustomize/platform-title-view","views/more/platformcustomize/platform-hide-list-view"],function(a,b,c,d,e){var f=a.Layout.extend({template:b["more/platformcustomize/platform-layout"],regions:{titleList:"#title",dataList:"#data",hideDataList:".hide-main"},initialize:function(){},ui:{dataSave:".save-btn",closeBox:".close-btn"},events:function(){var a={};return a["click "+this.ui.dataSave]="dataSave",a["click "+this.ui.closeBox]="hideLinkBox",a},hideLinkBox:function(){Talent.$(".hide-box").removeClass("hide-show"),Talent.$(".hide-div").removeClass("hide-div-selected")},onShow:function(){var b=this;a.app.request("Tenant:getPlatformApp",{}).done(function(a){b.model=new Talent.Model(a),b.creatView(a),b.showView(),b.listenToView()}).fail(function(a){b.$el.find(".platformCus-save").html(a),b.$el.find(".platformCus-save").addClass("not-super-admi")})},creatView:function(a){var b=s_.groupBy(a.linkList,"Display")["true"],f=_.groupBy(a.linkList,"Display")["false"];this.listView=new c({collection:new Talent.Collection(b)}),this.listHideView=new e({collection:new Talent.Collection(f)}),this.titleView=new d({model:new Talent.Model({title:a.title,description:a.description})})},listenToView:function(){var a=this;this.listenTo(this.titleView,"titleChanged",function(b){a.model.set(b.curFlag,b.curValue)}),this.listenTo(this.listHideView,"linkListChanged",function(b){a.linkListMap(b)}),this.listenTo(this.listView,"linkListChanged",function(b){a.linkListMap(b)})},showView:function(){this.titleList.show(this.titleView),this.dataList.show(this.listView),this.hideDataList.show(this.listHideView)},linkListMap:function(a){var b=this.dataToJson(this.model).linkList;_.each(a,function(a){_.each(b,function(b){b.AppId==a&&(b.Display=!b.Display)})}),this.model.set("linkList",b),this.creatView(this.dataToJson(this.model)),this.showView(),this.listenToView()},saveStatus:function(a){Talent.$(".callback-save-info").addClass("save-info-"+a);var b=a?"保存成功":"保存失败";Talent.$(".callback-save-info").html(b),setTimeout(function(){Talent.$(".callback-save-info").removeClass("save-info-"+a)},3e3)},dataToJson:function(a){return a.toJSON()},dataSave:function(){var b=this;a.app.request("Tenant:postPlatformApp",{data:this.dataFormat()}).done(function(a){b.saveStatus(a)})},dataFormat:function(){var a={},b=[],c=[];return a.Title=this.dataToJson(this.model).title,a.Description=this.dataToJson(this.model).description,_.map(this.dataToJson(this.model).linkList,function(a){a.Display?b.push(a.AppId):c.push(a.AppId)}),a.DisplayApps=b.join(","),a.HideApps=c.join(","),a}});return f}),define("views/more/platformcustomize/index-page-view",["talent","templates/more","views/more/platformcustomize/platform-layout-view"],function(a,b,c){var d=a.Layout.extend({template:b["more/platformcustomize/index-page"],regions:{main:".platform_main"},initialize:function(){a.Context.setPageTitle("导航页")},onRender:function(){this.main.show(new c)},onShow:function(){this._setClientHeight()},onClose:function(){$(window).off("resize.baseMaterLayout")},_setClientHeight:function(){var b=(this.$el.find(this.regions.sdieBar).height(),this.$el.find(this.regions.main)),c=a.Context.setMainRegionsHeight;c(b);var d=a._.debounce(function(){c(b)},300);$(window).off("resize.baseMaterLayout"),$(window).on("resize.baseMaterLayout",d)}});return Talent.BasePageView.extend({mainViewClass:d})}),define("views/more/due-to-remind/index-page-view",["talent","templates/more","tdialog"],function(a,b,c){var d=a.Layout.extend({template:b["more/due-to-remind/index-page"],className:"tt_homedue",ui:{enterButton:".enter-tita a",renew:'[data-name="renewal"]',kefu:"[data-name=due-to-remind-keku]",buy:"[data-name=buy]",renew:".renew"},templateHelpers:function(){var b=a._.extend({},a.Context.getGlobal("tenantAuthentication")),c=b.DeadLine||null,d=a.Context.getGlobal("loginUserInfo");if(c){c.split("-")}return{helpHost:a.Context.getGlobal("helpHost"),tenantAuthentication:b,loginUserInfo:d,i18n:a.Context.getI18n(),tenantInfo:a.Context.getGlobal("tenantInfo"),webHost:a.Context.getGlobal("titaHost"),homeIndex:a.Context.getGlobal("entryPageId")}},events:function(){var a={};return a["click "+this.ui.enterButton]="_enterHandler",a["click "+this.ui.buy]="_enterHandler",a["click "+this.ui.renew]="_sendEmail",a["click "+this.ui.kefu]="_kefuHandler",a},initialize:function(){this.tAjax=!1;var b=a.Context.getGlobal("tenantAuthentication"),c=b.ExpireType||0,d=a.Context.getGlobal("entryPageId"),e=a.Context.getGlobal("deadLineRemind");return 0!=c||e?void 0:void a.app.execute("history:navigate",d,!0)},_kefuHandler:function(){var b=a.$("#BizQQWAP");b.trigger("click")},_sendEmail:function(b){var c=this,d=a.$(b.currentTarget);this.tAjax||(this.tAjax=!0,a.app.request("Notify:sendEmail",{}).done(function(a){c.tAjax=!1,c._tipDialogView(d,"邮件已发送成功，销售顾问会尽快和您联系")}).fail(function(){c.tAjax=!1}))},_enterHandler:function(b){var c=a.$(b.currentTarget),d=c.attr("link");if(d&&0!=d.indexOf("/")){var e=a.Context.getGlobal("loginUserInfo");window.location.href=a.Context.getGlobal("titaHost")+"/u/"+e.Id+"/Home"+d,window.location.reload(!0)}},_tipDialogView:function(a,b,d){this.tDialogView&&this.tDialogView.close(),this.tDialogView=new c({type:"tipsy"}),this.tDialogView.render().$el.appendTo("body"),this.tDialogView.show(a,b,{arrow:!1,pos:"topCenter",className:"success",autoHide:!0})},onShow:function(){var b=a.Context.getGlobal("tenantInfo"),c=a.Context.getGlobal("titaISVBuyUrl");850==b.Source&&c&&(this.ui.kefu.remove(),this.ui.renew.remove(),this.ui.buy.attr("link",c))}});return Talent.BasePageView.extend({mainViewClass:d,layout:window.top==window?"master-layout":"empty-layout",hideSidebar:!0})}),define("templates/italent",[],function(){return this.JST=this.JST||{},this.JST["italent/app/index-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="";return __p},this.JST["italent/home/edit-user-info"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<table width="100%">\n	<colgroup>\n		<col width="8%"/>\n		<col width="41%"/>\n		<col width="10%"/>\n		<col width="41%"/>\n	</colgroup>\n	<tr>\n		<td class="item-name">姓名</td>\n		<td data-name=\'showItem\'>\n			<div class="tu-input-default" data-name="inputData">\n				<div class="name-show" data-name="name-show">'+(null==(__t=name)?"":__t)+'</div>\n			    <input type=\'text\' id="name" class="hide" value="'+(null==(__t=name)?"":__t)+'">\n			</div>\n			<span class="name_alter alter span-display">请输入真实姓名</span>\n			<span class="name_error error span-display">姓名不能为空</span>\n		</td>\n		<td class="item-name">性别</td>\n		<td class="sex-input" data-name="sex-input">\n			<span class="sex">'+(null==(__t=sex)?"":__t)+'</span>\n			<span class="tu-icon-sort-down sex-down"></span>\n		</td>\n	</tr>\n	<tr>\n		<td class="item-name">职务</td>\n		<td class="sex-input">\n		    <span class="'+(null==(__t=position||!positionDisabled?"hide":"")?"":__t)+' font-color">请联系超管或后台管理员设置职务信息</span>\n		    <span class="font-color">'+(null==(__t=position)?"":__t)+'</span>\n			<a href="javascript:void(0)" data-name="tipsy-position" class="tu-icon-wiki wiki-style"></a>\n		</td>\n		<td class="item-name">电子邮件</td>\n			',isEmailEdit?__p+='\n				<td>\n					<div class="tu-input-default" data-name="inputData">\n					    <label class="placeholder '+(null==(__t=email?"hide":"")?"":__t)+"\" for='email'>输入格式如admin@tita.com</label>\n					    <input type='text' id='email' value=\""+(null==(__t=email)?"":__t)+'">\n					</div>\n					<span class="email_alter alter span-display">输入格式如admin@tita.com</span>\n					<span class="email_error error span-display">邮箱格式有误</span>\n				</td>\n				\n			':(__p+="\n				",email?__p+='\n				<td class="sex-input">\n					<span class="font-color">'+(null==(__t=email)?"":__t)+'</span>\n					<a href="javascript:void(0)" data-name="tipsy-email" class="tu-icon-wiki wiki-style"></a>\n				</td>\n				':(__p+='\n				<td class="sex-input">\n					',__p+=enterpriseQQ?'\n					<span class="font-color">未设置</span>\n					':'\n					<span class="font-color">您尚未绑定邮箱，请用手机 App绑定</span>\n					<a href="http://service.tita.com/pages/viewpage.action?pageId=2261239" target="_blank" data-name="tipsy" class="tu-icon-wiki wiki" original-title="查看如何绑定" style="float:right"></a>\n					',__p+="\n				</td>\n				"),__p+="\n			"),__p+='\n	</tr>\n	<tr>\n		<td class="item-name">手机号码</td>\n		',__p+=isMobileEdit?'\n		<td>\n			<div class="tu-input-default" data-name="inputData">\n			    <label class="placeholder '+(null==(__t=mobile?"hide":"")?"":__t)+"\" for='mobile'>仅限中国大陆</label>\n			    <input type='text' id='mobile' value=\""+(null==(__t=mobile)?"":__t)+'">\n			</div>\n			<span class="mobile_alter alter span-display">请输入11位有效数字</span>\n			<span class="mobile_error error span-display">请输入正确的手机号</span>\n		</td>\n		':'\n		<td class="sex-input">\n			<span class="font-color">'+(null==(__t=mobile)?"":__t)+'</span>\n			<a href="javascript:void(0)" data-name="tipsy" class="tu-icon-wiki wiki-style" original-title="已绑定手机号码，不可更改" style="float:right"></a>\n		</td>\n		',__p+='\n		<td class="item-name">办公电话</td>\n		<td>\n			<div class="tu-input-default" data-name="inputData">\n			    <label class="placeholder '+(null==(__t=workPhone?"hide":"")?"":__t)+"\" for='workPhone'>请输入办公电话</label>\n			    <input type='text' id='workPhone' value=\""+(null==(__t=workPhone)?"":__t)+'">\n			</div>\n			<span class="workPhone_alter alter span-display">仅支持输入数字、”-“</span>\n			<span class="workPhone_error error span-display">请输入正确的办公电话</span>\n		</td>\n	</tr>\n	<tr>\n		<td class="item-name">QQ</td>\n		<td>\n			<div class="tu-input-default" data-name="inputData">\n			    <label class="placeholder '+(null==(__t=qq?"hide":"")?"":__t)+"\" for='qq'>请输入QQ号</label>\n			    <input type='text' id='qq' value=\""+(null==(__t=qq)?"":__t)+'">\n			</div>\n			<span class="qq_alter alter span-display">仅支持输入数字</span>\n			<span class="qq_error error span-display">请输入正确的qq号</span>\n		</td>\n		<td class="item-name">微信</td>\n		<td>\n			<div class="tu-input-default" data-name="inputData">\n			    <label class="placeholder '+(null==(__t=weChat?"hide":"")?"":__t)+"\" for='weChat'>请输入微信号\\QQ号\\手机号</label>\n			    <input type='text' id='weChat' value=\""+(null==(__t=weChat)?"":__t)+'">\n			</div>\n			<span class="weChat_alter alter span-display">仅支持输入数字和字母</span>\n			<span class="weChat_error error span-display">请输入正确的微信号</span>\n		</td>\n	</tr>\n	<tr>\n		<td class="item-name">联系地址</td>\n		<td colspan="3">\n			<div class="tu-input-default" data-name="inputData">\n			    <label class="placeholder '+(null==(__t=address?"hide":"")?"":__t)+"\" for='address'>请输入联系地址</label>\n			    <input type='text' id='address' value=\""+(null==(__t=address)?"":__t)+'">\n			</div>\n		</td>\n	</tr>\n</table>\n';return __p},this.JST["italent/home/empty"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='	<img src="'+(null==(__t=Talent.Context.getStaticUrl("images/italent/home/roundIcon.png"))?"":__t)+'">\n	\n		<!-- <p class="no-permissions">暂未开通此功能，请联系管理员开通</p> -->\n	',(status=1)?__p+="\n		<p>sorry，您没有权限查看哦</p>\n	":2==status&&(__p+="\n		<p>6.15即将重磅升级，敬请期待！</p>\n	"),__p+="\n";return __p},this.JST["italent/home/index-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="tu-col-4" data-name="user-info" data-tu-submenu=\'tu-submenu\'></div>\n<div class="tu-col-12" data-name="widget-wrap"></div>\n';return __p},this.JST["italent/home/profile-iframe"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="";return __p},this.JST["italent/home/profile-user-info"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="main-left-item item-top">\n	<div class="head-icon">\n	\n	',__p+=userId==loginUserId?'\n		<a href="'+(null==(__t=host)?"":__t)+'#set?page_id=avatar" class="icon-area" original-title="设置头像">\n			'+(null==(__t=_.convertImage({className:"",src:avatar.large,size:150,shape:"radius",name:name,bgColor:avatar.color}))?"":__t)+"\n		</a>	\n	":"\n		<span>\n			"+(null==(__t=_.convertImage({className:"",src:avatar.large,size:150,shape:"radius",name:name,bgColor:avatar.color}))?"":__t)+"\n		</span>	\n	",__p+='\n	</div>\n\n	<div class="user-name">\n		'+(null==(__t=name)?"":__t)+"\n		",showWbim&&userId!=loginUserId&&(__p+='\n			<!-- <span class="header-icon-titaim webim" original-title="发消息" data-name="send-message"></span> -->\n			<span class="for-position webim" data-name="send-message" original-title="发消息">\n				<span class="header-icon-titaim edit-able" ></span>\n			</span>\n		'),__p+='\n	</div>\n	<div class="job-title">'+(null==(__t=department)?"":__t),position&&(__p+="·"+(null==(__t=position)?"":__t)),__p+='</div>\n</div>\n<div data-name="loading"></div>\n',isLook&&(__p+='\n	<div class="main-left-item item-bottom">\n		',canEdit&&(__p+="\n		<dl>\n			<button class=\"tu-btn tu-btn-mini tu-btn-sure edit-btn\" data-name='edit-userinfo'>编辑</button>\n		</dl>\n		"),__p+="\n		",_.each(userFields,function(a){__p+='\n			<dl class="tu-clearfix info-list">\n				<dt class="info-tittle">'+(null==(__t=a.name)?"":__t)+'</dt>\n				<dd class="info-cont">'+(null==(__t=a.value)?"":__t)+"</dd>\n			</dl>\n		"}),__p+="\n	</div>\n");return __p},this.JST["italent/home/profile-widget-wrap"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tu-tabbable-line nav-wrap">\n	<ul class="tu-nav-tabs ">\n		',_.each(data,function(a,b){__p+='\n		<li class="',a.code==routerData.code&&(__p+="active"),__p+=' item-tab">\n			',"hash"==a.type?__p+='\n			<a data-href-type="hash" data-name="menu-item" data-trigger="false" href="#italent/home?frameType='+(null==(__t=a.type)?"":__t)+"&code="+(null==(__t=a.code)?"":__t)+"&appid="+(null==(__t=routerData.appid)?"":__t)+"&apptype="+(null==(__t=routerData.apptype)?"":__t)+"&name="+(null==(__t=a.href)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&status="+(null==(__t=a.status)?"":__t)+'">'+(null==(__t=a.title)?"":__t)+"</a>\n			":"iframe"==a.type&&(__p+='\n			<a data-href-type="iframe" data-name="menu-item" data-trigger="false" href="javascript:;" data-href="#italent/home?to_user_id='+(null==(__t=routerData.to_user_id)?"":__t)+"&frameType="+(null==(__t=a.type)?"":__t)+"&code="+(null==(__t=a.code)?"":__t)+"&iTalentFrameType="+(null==(__t=a.type)?"":__t)+"&iTalentNavId="+(null==(__t=a.id)?"":__t)+"&iTalentFrame="+(null==(__t=a.href)?"":__t)+"&status="+(null==(__t=a.status)?"":__t)+'">'+(null==(__t=a.title)?"":__t)+"</a>\n			"),__p+="\n		</li>\n		"}),__p+='\n	</ul>\n	<div class="tu-nav-content"></div>\n</div>\n<div data-name="widget-main-wrap" class="widget-main-wrap"></div>\n';return __p},this.JST["italent/index-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="";return __p},this.JST}),define("views/more/iframe/index-page-view",["talent","templates/italent"],function(a,b){var c=a.Layout.extend({template:b["italent/app/index-page"],className:"_tt_page_container",initialize:function(){this.userInfo=a.Context.getUserInfo()},regions:{},ui:{},events:function(){var a={};return a},resizeFrame:function(){var b=a.$(window).height()-a.$("#header-region").height()-a.$("#footer-region").height();this.$el.find("iframe").height(b)},onClose:function(){a.$("html").css("overflow-y",this.oriOverflow),a.$(window).off("resize",this.bindResizeFrame),a.$("#main-region").css("min-height",this.oriMinHeight)},onShow:function(){var b=this;a.Context.getGlobal("titaHost");a.app.request("history:getQueryObject").done(a._.bind(function(c){var d=this.getUrl(c.appid,c.apptype);c.from||"";b.styleFix(),b.setPageTitle(c);var e="?";if(d.indexOf("?")>-1&&(e="&"),d+=e+"_d="+location.host+"&from=italent",c.url){d=decodeURIComponent(c.url);var f=decodeURIComponent(location.hash),g=f.slice(1);f.indexOf("url="+c.url)>-1&&(g=f.slice(1)),a.app.execute("history:navigate",g,!1)}var h=a.Context.getGlobal("oceanVisitUrl");h&&""!=h&&(d=h,a.Context.setPageTitle("Ocean")),"http://qa.tita.com/Report/Index"==d&&a.Context.setPageTitle("企业运营报表"),this.$el.html('<iframe id="app2_iframe" name="app_iframe" width="100%" frameborder="0" src="'+d+'"></iframe>'),this.resizeFrame()},this))},styleFix:function(){this.oriOverflow=a.$("html").css("overflow-y"),this.oriMinHeight=a.$("#main-region").css("min-height"),a.$("html").css("overflow-y","hidden"),a.$("#main-region").css("min-height",""),this.$el.css("padding",0),this.bindResizeFrame=a._.bind(this.resizeFrame,this),a.$(window).on("resize",this.bindResizeFrame)},getUrl:function(b,c){var d="";return a._.each(a.Context.getGlobal("WebHead").AppHead,function(a){a.AppId==b&&a.AppType==c&&(d=a.Domain)}),d},setPageTitle:function(b){a.Context.setPageTitle("iTalent")}});return a.BasePageView.extend({mainViewClass:c,refreshSidebar:!0,hideSidebar:!0})}),define("views/more/terminal/index-page-view",["talent","templates/more","views/common/sdk/sdk-view"],function(a,b,c){var d=c.extend({onShowAfter:function(){}});return a.BasePageView.extend({mainViewClass:d,layoutViewOptions:{scrolling:"no"},layout:window.top==window?"master-layout":"empty-layout"})}),define("views/more/invite/invite-email-view",["talent","templates/more"],function(a,b){var c=a.ItemView.extend({template:b["more/invite/invite-email"],ui:{},className:"invite-colleague__ways_peremail-content-input tu-dib tu-input-default",events:function(){var a={};return a},initialize:function(){},templateHelpers:function(){return{id:this.model.cid}},onRender:function(){}}),d=a.CollectionView.extend({itemView:c,initialize:function(){}});return d}),function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define("clipboard",[],a);else{var b;b="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,b.Clipboard=a()}}(function(){var a;return function b(a,c,d){function e(g,h){if(!c[g]){if(!a[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};a[g][0].call(k.exports,function(b){var c=a[g][1][b];return e(c?c:b)},k,k.exports,b,a,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b){for(;a&&a.nodeType!==e;){if(a.matches(b))return a;a=a.parentNode}}var e=9;if("undefined"!=typeof Element&&!Element.prototype.matches){var f=Element.prototype;f.matches=f.matchesSelector||f.mozMatchesSelector||f.msMatchesSelector||f.oMatchesSelector||f.webkitMatchesSelector}b.exports=d},{}],2:[function(a,b,c){function d(a,b,c,d,f){var g=e.apply(this,arguments);return a.addEventListener(c,g,f),{destroy:function(){a.removeEventListener(c,g,f)}}}function e(a,b,c,d){return function(c){c.delegateTarget=f(c.target,b),c.delegateTarget&&d.call(a,c)}}var f=a("./closest");b.exports=d},{"./closest":1}],3:[function(a,b,c){c.node=function(a){return void 0!==a&&a instanceof HTMLElement&&1===a.nodeType},c.nodeList=function(a){var b=Object.prototype.toString.call(a);return void 0!==a&&("[object NodeList]"===b||"[object HTMLCollection]"===b)&&"length"in a&&(0===a.length||c.node(a[0]))},c.string=function(a){return"string"==typeof a||a instanceof String},c.fn=function(a){var b=Object.prototype.toString.call(a);return"[object Function]"===b}},{}],4:[function(a,b,c){function d(a,b,c){if(!a&&!b&&!c)throw new Error("Missing required arguments");if(!h.string(b))throw new TypeError("Second argument must be a String");if(!h.fn(c))throw new TypeError("Third argument must be a Function");if(h.node(a))return e(a,b,c);if(h.nodeList(a))return f(a,b,c);if(h.string(a))return g(a,b,c);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function e(a,b,c){return a.addEventListener(b,c),{destroy:function(){a.removeEventListener(b,c)}}}function f(a,b,c){return Array.prototype.forEach.call(a,function(a){a.addEventListener(b,c)}),{destroy:function(){Array.prototype.forEach.call(a,function(a){a.removeEventListener(b,c)})}}}function g(a,b,c){return i(document.body,a,b,c)}var h=a("./is"),i=a("delegate");b.exports=d},{"./is":3,delegate:2}],5:[function(a,b,c){function d(a){var b;if("SELECT"===a.nodeName)a.focus(),b=a.value;else if("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName){var c=a.hasAttribute("readonly");c||a.setAttribute("readonly",""),a.select(),a.setSelectionRange(0,a.value.length),c||a.removeAttribute("readonly"),b=a.value}else{a.hasAttribute("contenteditable")&&a.focus();var d=window.getSelection(),e=document.createRange();e.selectNodeContents(a),d.removeAllRanges(),d.addRange(e),b=d.toString()}return b}b.exports=d},{}],6:[function(a,b,c){function d(){}d.prototype={on:function(a,b,c){var d=this.e||(this.e={});return(d[a]||(d[a]=[])).push({fn:b,ctx:c}),this},once:function(a,b,c){function d(){e.off(a,d),b.apply(c,arguments)}var e=this;return d._=b,this.on(a,d,c)},emit:function(a){var b=[].slice.call(arguments,1),c=((this.e||(this.e={}))[a]||[]).slice(),d=0,e=c.length;for(d;e>d;d++)c[d].fn.apply(c[d].ctx,b);return this},off:function(a,b){var c=this.e||(this.e={}),d=c[a],e=[];if(d&&b)for(var f=0,g=d.length;g>f;f++)d[f].fn!==b&&d[f].fn._!==b&&e.push(d[f]);return e.length?c[a]=e:delete c[a],this}},b.exports=d},{}],7:[function(b,c,d){!function(e,f){if("function"==typeof a&&a.amd)a(["module","select"],f);else if("undefined"!=typeof d)f(c,b("select"));else{var g={exports:{}};f(g,e.select),e.clipboardAction=g.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{"default":a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var e=c(b),f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=function(){function a(b){d(this,a),this.resolveOptions(b),this.initSelection()}return g(a,[{key:"resolveOptions",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action=a.action,this.emitter=a.emitter,this.target=a.target,this.text=a.text,this.trigger=a.trigger,this.selectedText=""}},{key:"initSelection",value:function(){this.text?this.selectFake():this.target&&this.selectTarget()}},{key:"selectFake",value:function(){var a=this,b="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandlerCallback=function(){return a.removeFake()},this.fakeHandler=document.body.addEventListener("click",this.fakeHandlerCallback)||!0,this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="absolute",this.fakeElem.style[b?"right":"left"]="-9999px";var c=window.pageYOffset||document.documentElement.scrollTop;this.fakeElem.style.top=c+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,e["default"])(this.fakeElem),this.copyText()}},{key:"removeFake",value:function(){this.fakeHandler&&(document.body.removeEventListener("click",this.fakeHandlerCallback),this.fakeHandler=null,this.fakeHandlerCallback=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)}},{key:"selectTarget",value:function(){this.selectedText=(0,e["default"])(this.target),this.copyText()}},{key:"copyText",value:function(){var a=void 0;try{a=document.execCommand(this.action)}catch(b){a=!1}this.handleResult(a)}},{key:"handleResult",value:function(a){this.emitter.emit(a?"success":"error",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})}},{key:"clearSelection",value:function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()}},{key:"destroy",value:function(){this.removeFake()}},{key:"action",set:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"copy";if(this._action=a,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(a){if(void 0!==a){if(!a||"object"!==("undefined"==typeof a?"undefined":f(a))||1!==a.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&a.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(a.hasAttribute("readonly")||a.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=a}},get:function(){return this._target}}]),a}();a.exports=h})},{select:5}],8:[function(b,c,d){!function(e,f){if("function"==typeof a&&a.amd)a(["module","./clipboard-action","tiny-emitter","good-listener"],f);else if("undefined"!=typeof d)f(c,b("./clipboard-action"),b("tiny-emitter"),b("good-listener"));else{var g={exports:{}};f(g,e.clipboardAction,e.tinyEmitter,e.goodListener),e.clipboard=g.exports}}(this,function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{"default":a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function i(a,b){var c="data-clipboard-"+a;if(b.hasAttribute(c))return b.getAttribute(c)}var j=e(b),k=e(c),l=e(d),m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),n=function(a){function b(a,c){f(this,b);var d=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));return d.resolveOptions(c),d.listenClick(a),d}return h(b,a),m(b,[{key:"resolveOptions",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof a.action?a.action:this.defaultAction,this.target="function"==typeof a.target?a.target:this.defaultTarget,this.text="function"==typeof a.text?a.text:this.defaultText}},{key:"listenClick",value:function(a){var b=this;this.listener=(0,l["default"])(a,"click",function(a){return b.onClick(a)})}},{key:"onClick",value:function(a){var b=a.delegateTarget||a.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new j["default"]({action:this.action(b),target:this.target(b),text:this.text(b),trigger:b,emitter:this})}},{key:"defaultAction",value:function(a){return i("action",a)}},{key:"defaultTarget",value:function(a){var b=i("target",a);return b?document.querySelector(b):void 0}},{key:"defaultText",value:function(a){return i("text",a)}},{key:"destroy",value:function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)}}],[{key:"isSupported",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],b="string"==typeof a?[a]:a,c=!!document.queryCommandSupported;return b.forEach(function(a){c=c&&!!document.queryCommandSupported(a)}),c}}]),b}(k["default"]);a.exports=n})},{"./clipboard-action":7,"good-listener":4,"tiny-emitter":6}]},{},[8])(8)}),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");
+function(a){"use strict";var b=a.fn.jquery.split(" ")[0].split(".");if(b[0]<2&&b[1]<9||1==b[0]&&9==b[1]&&b[2]<1||b[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(jQuery),+function(a){"use strict";function b(c,d){this.$body=a(document.body),this.$scrollElement=a(a(c).is(document.body)?window:c),this.options=a.extend({},b.DEFAULTS,d),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",a.proxy(this.process,this)),this.refresh(),this.process()}function c(c){return this.each(function(){var d=a(this),e=d.data("bs.scrollspy"),f="object"==typeof c&&c;e||d.data("bs.scrollspy",e=new b(this,f)),"string"==typeof c&&e[c]()})}b.VERSION="3.3.7",b.DEFAULTS={offset:10},b.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},b.prototype.refresh=function(){var b=this,c="offset",d=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),a.isWindow(this.$scrollElement[0])||(d=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var b=a(this),e=b.data("target")||b.attr("href"),f=/^#./.test(e)&&a(e);return f&&f.length&&f.is(":visible")&&[[f[c]().top+d,e]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){b.offsets.push(this[0]),b.targets.push(this[1])})},b.prototype.process=function(){var a,b=this.$scrollElement.scrollTop()+this.options.offset,c=this.getScrollHeight(),d=this.options.offset+c-this.$scrollElement.height(),e=this.offsets,f=this.targets,g=this.activeTarget;if(this.scrollHeight!=c&&this.refresh(),b>=d)return g!=(a=f[f.length-1])&&this.activate(a);if(g&&b<e[0])return this.activeTarget=null,this.clear();for(a=e.length;a--;)g!=f[a]&&b>=e[a]&&(void 0===e[a+1]||b<e[a+1])&&this.activate(f[a])},b.prototype.activate=function(b){this.activeTarget=b,this.clear();var c=this.selector+'[data-target="'+b+'"],'+this.selector+'[href="'+b+'"]',d=a(c).parents("li").addClass("active");d.parent(".dropdown-menu").length&&(d=d.closest("li.dropdown").addClass("active")),d.trigger("activate.bs.scrollspy")},b.prototype.clear=function(){a(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var d=a.fn.scrollspy;a.fn.scrollspy=c,a.fn.scrollspy.Constructor=b,a.fn.scrollspy.noConflict=function(){return a.fn.scrollspy=d,this},a(window).on("load.bs.scrollspy.data-api",function(){a('[data-spy="scroll"]').each(function(){var b=a(this);c.call(b,b.data())})})}(jQuery),define("bootstrap-scrollspy",function(){}),define("views/more/invite/invite-main-view",["talent","templates/more","views/more/invite/invite-email-view","clipboard","$.infotip","bootstrap-scrollspy"],function(a,b,c,d,e){var f=a.ItemView.extend({template:b["more/invite/invite-main"],ui:{inputCon:".tu-input-default",input:"input",addMoreEmails:"[data-name=add-more-emails]",peremails:"[data-name=peremails]",peremailsRight:"[data-name=peremails-right]",batchInvite:"[data-name=batch-invitation]",dataTrigger:"[data-trigger=false]",emailContainer:"[data-name=invite-mails-container]",reInvite:"[data-name=reinvite]",remove:"[data-name=remove]",groupInvite:"[data-name=group-emails-btn]",groupEmailInput:"[data-name=groupmails]"},events:function(){var a={};return a["focusin "+this.ui.inputCon]="_focusHandler",a["focusout "+this.ui.inputCon]="_blurHandler",a["input "+this.ui.input]="_inputHandler",a["keydown "+this.ui.input]="_keydownHandler",a["click "+this.ui.addMoreEmails]="_addMoreEmails",a["click "+this.ui.batchInvite]="_batchInviteHandler",a["click "+this.ui.dataTrigger]="_preventDefault",a["click "+this.ui.reInvite]="_reInviteHandler",a["click "+this.ui.remove]="_removeHandler",a["click "+this.ui.groupInvite]="_groupInviteHandler",a},initialize:function(){},onShow:function(){this._setHeightChange(),this._bindNavChange()},onRender:function(){var a=this;this.ui.input.bind("propertychange",function(b){a._inputHandler(b,a)}),this._renderEmailCollection(),this._bindCopyAction()},templateHelpers:function(){var a=1==Talent.Context.getGlobal("tenantAuthentication").Version,b=2==Talent.Context.getGlobal("loginUserInfo").Role;return{isShowTip:a&&b,isOnTrial:a}},_preventDefault:function(a){return!1},_focusHandler:function(a){var b=$(a.currentTarget);b.removeClass("tu-input-error").addClass("tu-input-focus")},_blurHandler:function(a){var b=$(a.currentTarget);b.removeClass("tu-input-focus"),this._checkPhoneNum(b)},_inputHandler:function(a,b){var c=$(a.currentTarget),d=$.trim(c.val());"propertychange"==a.type?b:this;""==d?c.prev().show():c.prev().hide()},_renderEmailCollection:function(){this.inviteEmailView&&this.InviteEmailView.close(),this.inviteEmailView=new c({collection:new Talent.Collection([{},{},{},{},{}])}),this.ui.emailContainer.append(this.inviteEmailView.render().$el)},_keydownHandler:function(a){var b=$(a.currentTarget);$.trim(b.val())},_checkPhoneNum:function(a){var b=$.trim(a.find("input").val()),c=/^1[0-9]{10}$/,d=c.test(b);d||""===b?a.removeClass("tu-input-error"):this._showErrorMsg(a)},_setHeightChange:function(){var a=this.ui.peremails.height();this.ui.peremailsRight.height(a)},_bindNavChange:function(){$("[data-name=main-container-region]").scrollspy({target:".navbar",offset:150})},_addMoreEmails:function(){this.inviteEmailView.collection.add([{},{},{}]),this._setHeightChange(),$("[data-name=main-container-region]").scrollspy("refresh")},_requestSendPhone:function(a,b,c){var d=this;a=a instanceof Array?a:[a],Talent.app.request("Invite:inviteAccountsByMobile",{invitions:a}).done(function(a){d.isClosed||d._dealDiffCode(a,b,c)}).fail(function(a){var c={errorCode:2,body:a};d._dealDiffCode(c,b)})},_showErrorMsg:function(a,b){return void 0==b&&(b="手机号格式错误"),a.find(".error-tip").text(b),a.addClass("tu-input-error"),a},_dealDiffCode:function(a,b,c){var d=this;switch(a.errorCode){case 0:if(d._tipInfo("sendSuccess",b,{type:"remind",body:"发送成功",align:"left"}),c){var e=d.ui.emailContainer.find("input");e.each(function(a){$(this).val("").prev().show()})}break;case 1:a.errorList.forEach(function(a){if("reinvite"==b.data("name")){var c=b;d._tipInfo("sendError2",c,{type:"remind",body:a.errMsg,align:"left",ico:"warn"})}else{var e="input#"+a.id,c=d.ui.emailContainer.find(e).parent();d._showErrorMsg(c,a.errMsg)}});break;case 2:d._tipInfo("sendError",b,{type:"remind",body:a.body,align:"left",ico:"warn"})}},_bindCopyAction:function(){var a=this,b=new d("[data-name=copy]");b.on("success",function(b){a._tipInfo("copySuccess",$(b.trigger),{type:"remind",body:"复制成功，发送给同事一起提高工作效率吧！",align:"right"}),b.clearSelection()})},_batchInviteHandler:function(){var a=this.ui.emailContainer.find("input"),b=/^1[0-9]{10}$/,c=1,d=[];if(a.each(function(a){var b=$.trim($(this).val()),c=$(this).attr("id");""!==b&&d.push({value:b,id:c})}),0==d.length?c=0:_.each(d,function(a){b.test(a.value)||(c=-1)}),1==c){var e=this.ui.batchInvite;this._requestSendPhone(d,e,!0)}else this._tipInfo("checkError",this.ui.batchInvite,{type:"remind",body:-1==c?"请输入正确的手机号格式":"请至少输入一个手机号",align:"left",ico:"error"})},_reInviteHandler:function(a){var b=$(a.currentTarget),c=b.data("email");this._requestSendPhone({value:c,id:Date.parse(new Date)},b)},_removeHandler:function(a){var b=$(a.currentTarget),c=b.parent().parent(),d=b.data("email");Talent.app.request("Invite:removeInviteEmail",{invitedEmail:d}).done(function(a){self.isClosed||c.slideUp(500)}).fail(function(a){})},_tipInfo:function(a,b,c){var d={placement:"top",animation:!1,type:"default",ico:"default",body:"",trigger:"manual",hasfoot:!0,align:"center",html:!0,container:this.$el};c=Talent._.extend({},d,c),this[a]&&this[a].destroy(),this[a]=new e,this[a].bindNode(b,c),this[a].show()}});return f}),define("views/more/invite/invite-empty-view",["talent","templates/more"],function(a,b){var c=a.ItemView.extend({template:b["more/invite/invite-empty"],ui:{},className:"invite-colleague__empty",events:function(){var a={};return a},initialize:function(a){this.managers=a.managers},templateHelpers:function(){return{managers:this.managers}},onRender:function(){}});return c}),define("views/more/invite/index-page-view",["talent","templates/more","views/more/invite/invite-main-view","views/more/invite/invite-empty-view"],function(a,b,c,d){var e=a.Layout.extend({template:b["more/invite/index-page"],className:"invite-colleague",regions:{inviteMain:"[data-name=invite-main]"},ui:{},initialize:function(){this.canInvite=!1},onRender:function(){this._requestData()},_renderEntry:function(a){this.canInvite?this._renderMainView(a):this._renderEmptyView(a.managers)},_renderMainView:function(a){this.inviteMainView&&this.inviteMainView.close(),this.inviteMainView=new c({model:new Talent.Model(a)}),this.inviteMain.show(this.inviteMainView)},_renderEmptyView:function(a){this.inviteEmptyView&&this.inviteEmptyView.close(),this.inviteEmptyView=new d({managers:a}),this.inviteMain.show(this.inviteEmptyView)},_requestData:function(){var a=this;Talent.app.request("Invite:getInviteData",{}).done(function(b){a.isClosed||(a.canInvite=b.isAuth,a._renderEntry(b))}).fail(function(a){})}});return a.BasePageView.extend({mainViewClass:e,layout:window.top==window?"master-layout":"empty-layout",pageTitle:"邀请同事"})}),define("templates/work",[],function(){return this.JST=this.JST||{},this.JST["work/common/approval-del-radio"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<li class="tu-fl '+(null==(__t="modal"==showType?"tu-ml-20 tu-mr-5":"tu-mt-10")?"":__t)+'  tu-ft_m2" data-name="radio-change" data-type="0"><span class="tu-icon-singlebox-'+(null==(__t="0"==deleteType?"avtive":"have")?"":__t)+' tu-pr-5"></span>不删除项目下的任务</li>\n<li class="tu-fl  '+(null==(__t="modal"==showType?"tu-ml-20 tu-mr-5":"tu-mt-10")?"":__t)+'  tu-ft_m2" data-name="radio-change" data-type="1"><span class="tu-icon-singlebox-'+(null==(__t="1"==deleteType?"avtive":"have")?"":__t)+' tu-pr-5"></span>同时删除项目下所有任务<span class="del-radio__wiki tu-icon-warning" data-body="审批中的任务将不会被删除" data-toggle="infotip"></span></li>\n<li class="tu-fl '+(null==(__t="modal"==showType?"tu-ml-20 tu-mr-5":"tu-mt-10")?"":__t)+'  tu-ft_m2" data-name="radio-change" data-type="2"><span class="tu-icon-singlebox-'+(null==(__t="2"==deleteType?"avtive":"have")?"":__t)+' tu-pr-5"></span>同时删除我负责，我参与的，我派发的任务<span class="del-radio__wiki tu-icon-warning" data-body="审批中的任务将不会被删除" data-toggle="infotip"></span></li>\n    ';return __p},this.JST["work/common/approval-input"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tu-por tu-container tu-clearfix ',"p-undo"!=type&&(__p+="tu-mb-20"),__p+='">\n	',isShowApplyUser&&(__p+='\n	<div class="tu-col-2 tu-font-a1 approval-operation-box__title tu-tar">\n		',isRequired&&(__p+='\n			<span class="approval-operation-box__required tu-vam tu-mr-5">*</span>\n		'),__p+='\n		<span class="tu-pr-10">\n			'+(null==(__t=inputTitle)?"":__t)+"\n		</span>\n	</div>\n	"),__p+='\n	<div class="',isShowApplyUser&&(__p+="tu-col-14"),__p+='">\n		<div class="tu-input-default " data-name="input-containter">\n			<label class="placeholder" for="q">'+(null==(__t=inputText)?"":__t)+'</label>\n			<textarea id="q" class="tu-scroll textarea tu-ft_m1" data-name="reject-input" style="resize:none;max-height:120px;line-height:24px;">'+(null==(__t=defaultValue)?"":__t)+'</textarea>\n			<div class="right-action tu-clearfix">\n				<span  class="tu-icon-cross '+(null==(__t=defaultValue?"tu-dib":"")?"":__t)+'" data-name="delAll"></span>\n			</div>\n			<div class="error-tip">已输入 <span data-name="over"></span> 字，最多可输入 '+(null==(__t=maxText)?"":__t)+" 字</div>\n		</div>\n	</div>\n	\n</div>\n\n";return __p},this.JST["work/common/approval-operation"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+="";return __p},this.JST["work/common/approval-time"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tu-por tu-container tu-mb-20 tu-clearfix">\n	',isShowApplyUser&&(__p+='\n		<div class="tu-col-2 tu-tar tu-font-a1 approval-operation-box__title"><span class="tu-mr-20 ">起止时间</span></div>\n	'),__p+='\n	<div class="',isShowApplyUser&&(__p+="tu-col-14"),__p+='">\n		<div class="tu-input-default " data-name="input-container">\n			',__p+=IsUseWork&&startDate?'\n				<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+"</div>\n			":startDate&&endDate&&!isLong?'\n				<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+" - "+(null==(__t=endDate)?"":__t)+"</div>\n			":startDate&&isLong?'\n				<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+" - 长期</div>\n			":'\n				<div class="input"  data-name="time"></div>\n			',__p+='\n			<div class="right-action tu-clearfix">\n		        <span class="tu-icon-sort-down"></span>\n		    </div>\n		</div>\n	</div>\n</div>\n';return __p},this.JST["work/common/approver"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="approval_item_container clearfix  approval_member">\n	<span class="approval_item_title tu-ft_m2" style="resize:none;line-height:40px;">\n		',approvalFlowInfo.isCustomized&&(__p+='\n			<span class="red-star">*</span>\n		'),__p+='\n		审批人\n	</span>\n	<div class="approval_input_container ">\n		<div class="tu-input-default tu-por" data-name="approver-containter" style="resize:none;line-height:40px;">\n			<ul class="approval_member_container tu-scroll">\n				',_.each(users,function(a,b){__p+="\n					<li  data-id = "+(null==(__t=a.userId||a.Id)?"":__t)+" >\n						",0==approvalFlowInfo.flowType&&(__p+='\n							<a data-toggle="infotip" data-body="删除 '+(null==(__t=a.Name||a.name)?"":__t)+'" class="approval_delete_member_btn tu-icon-close" data-name="delete-approver" href="javascript:;">\n							</a>\n						'),__p+="\n						"+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:a.UserAvatar?a.UserAvatar.Small:a.avatar.Small,size:30,shape:"radius",name:a.name||a.Name,bgColor:a.UserAvatar?a.UserAvatar.Color:a.avatar.Color}))?"":__t)+"\n					</li>\n					",4!==b&&(__p+='\n						<span class="tu-icon-simple-sort-right tu-ft_m3 tu-ml-5" style="font-size: 18px"></span>\n					'),__p+="\n				"}),__p+='\n				<!-- 自由审批，添加人满 -->\n				<a class="tu-btn-add tu-btn tu-btn-mini tu-icon-add" data-name="approver-show-userSelector" href="javascript:;" ',(1==approvalFlowInfo.flowType||users&&users.length==approvalFlowInfo.maxApplyUserCount)&&(__p+='style="display:none;"'),__p+='>\n				</a>\n				<label class="place_apply_holder" data-name="apply-user-default" ',users&&users.length&&(__p+='style="display:none;"'),__p+=">\n				",approvalFlowInfo.isCustomized?(__p+=" \n					",__p+=0==approvalFlowInfo.flowType?"\n						企业已设置审批，请添加审批人\n					":"\n						企业已内置审批流程\n					",__p+="\n				"):__p+="\n					不添加审批人，默认不审批。\n				",__p+='</label>\n			</ul>\n			<div class="error-tip" data-name="error-tip">审批人为必填项</div>\n		</div>\n	</div>\n</div>\n';return __p},this.JST["work/common/project-update-progress"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="progress-input">\n	<dt>进度</dt>\n	<dd>\n		<div class="tu-input-default">\n		    <input type="text"  id="progress" data-name="input" value="'+(null==(__t=progress)?"":__t)+'">\n		    <div class="right-action tu-clearfix">\n		   		<span class="persent">%</span>\n		    </div>\n			<div class="error-tip">请输入0-100之间的数字、“.”，支持小数点后两位</div>\n		</div>\n		<!-- <div class="alter-tip">请输入0-100之间的数字、“.”，支持小数点后两位</div> -->\n	</dd>\n</div>\n\n<div class="description-input">\n	<dt>进度描述</dt>\n	<dd>\n		<div class="tu-input-default">\n			<!-- 内联css为了ie能在五行内出现滚动条 -->\n		    <textarea id="description" class="tu-scroll textarea" data-name="input" style="resize:none;max-height:120px;line-height:24px;">'+(null==(__t=description)?"":__t)+'</textarea>\n		    <label class="placeholder" for="description" style="display:',__p+=description?"none":"block",__p+='">输入项目进展情况，例如：项目阶段性成果、项目总结、当前阶段障碍点</label>\n		    <div class="error-tip">已输入 <span data-name="overMax"></span>字，最多可输入 500 字</div>\n		    <div class="right-action tu-clearfix">\n		        <span class="tu-icon-cross" data-name="delAll"></span>\n		    </div>\n		</div>\n	</dd>\n</div>\n';return __p},this.JST["work/common/target-approval-del-radio"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<li class="tu-fl '+(null==(__t="modal"==showType?"tu-ml-20 tu-mr-5":"tu-mt-10")?"":__t)+'  tu-ft_m2" data-name="radio-change" data-type="0"><span class="tu-icon-singlebox-'+(null==(__t="0"==deleteType?"avtive":"have")?"":__t)+' tu-pr-5"></span>不删除目标下的任务</li>\n<li class="tu-fl  '+(null==(__t="modal"==showType?"tu-ml-20 tu-mr-5":"tu-mt-10")?"":__t)+'  tu-ft_m2" data-name="radio-change" data-type="1"><span class="tu-icon-singlebox-'+(null==(__t="1"==deleteType?"avtive":"have")?"":__t)+' tu-pr-5"></span>同时删除目标下所有任务<span class="del-radio__wiki tu-icon-warning" data-body="审批中的任务将不会被删除" data-toggle="infotip"></span></li>\n<li class="tu-fl '+(null==(__t="modal"==showType?"tu-ml-20 tu-mr-5":"tu-mt-10")?"":__t)+'  tu-ft_m2" data-name="radio-change" data-type="2"><span class="tu-icon-singlebox-'+(null==(__t="2"==deleteType?"avtive":"have")?"":__t)+' tu-pr-5"></span>同时删除我负责，我参与的，我派发的任务<span class="del-radio__wiki tu-icon-warning" data-body="审批中的任务将不会被删除" data-toggle="infotip"></span></li>\n    ';return __p},this.JST["work/common/target-update-progress"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="progress-input">\n	<dt>进度</dt>\n	<dd>\n		<div class="tu-input-default">\n		    <input type="text"  id="progress" data-name="input" value="'+(null==(__t=progress)?"":__t)+'">\n		    <div class="right-action tu-clearfix">\n		   		<span class="persent">%</span>\n		    </div>\n			<div class="error-tip">请输入0-100之间的数字、“.”，支持小数点后两位</div>\n		</div>\n		<!-- <div class="alter-tip">请输入0-100之间的数字、“.”，支持小数点后两位</div> -->\n	</dd>\n</div>\n\n<div class="description-input">\n	<dt>进度描述</dt>\n	<dd>\n		<div class="tu-input-default">\n			<!-- 内联css为了ie能在五行内出现滚动条 -->\n		    <textarea id="description" class="tu-scroll textarea" data-name="input" style="resize:none;max-height:120px;line-height:24px;">'+(null==(__t=description)?"":__t)+'</textarea>\n		    <label class="placeholder" for="description" style="display:',__p+=description?"none":"block",__p+='">输入目标进展情况，例如：目标阶段性成果、目标总结、当前阶段障碍点</label>\n		    <div class="error-tip">已输入 <span data-name="overMax"></span>字，最多可输入 500 字</div>\n		    <div class="right-action tu-clearfix">\n		        <span class="tu-icon-cross" data-name="delAll"></span>\n		    </div>\n		</div>\n	</dd>\n</div>\n';return __p},this.JST["work/common/upload-files"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tu-mt-20" data-name="attachment">\n	<div class="upload-title tu-clearfix">\n		',isShowApplyUser&&(__p+='\n			<div class=" tu-col-2 tu-tar tu-font-a1 approval-operation-box__title"><span class="tu-mr-20 ">上传附件</span></div>\n		'),__p+='\n		<div class="uploader_container  ',isShowApplyUser&&(__p+="tu-col-14"),__p+='" >\n			<div class="tu-font-a1 upload-files_button tu-dib tu-mr-5" data-name="upload-files-button"></div>\n			<span class="tu-ft-m3 tu-font-a2 tu-ft_m3 ">请上传不超过50MB大小的文件，最多可上传 9 个</span>\n		</div>\n	</div>\n	<div class="attachments-container" data-name="attachments-container">\n		<div class="tu-col-2">&nbsp;</div>\n		<div class="tu-col-14" data-name="attachment-list">\n			<div id="attachmentViewBox_homeMblog" class="error_container"></div>\n			<div id="attachmentViewBox_homeMblog" class="preview_container"></div>\n			<div id="attachmentViewBox_homeMblog" class="loading_container"></div>\n		</div>\n	</div>\n	\n</div>\n<!-- <a href="javascript:void(0)" data-name="file"></a>\n	<div id="attachmentViewBox_homeMblog" class="error_container"></div>\n	<div id="attachmentViewBox_homeMblog" class="loading_container"></div> -->';return __p},this.JST["work/copy-project/index-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="steps" data-name="copyPjt__steps">\n\n</div>\n\n<div class="copyPjt__main tu-mt-30" data-name="copyPjt__main">\n\n</div>';return __p},this.JST["work/copy-project/milepost/milepost-copy"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div data-name="milepost_copy_select" class="milepost_copy_select"></div>\n<div data-name="milepost_list"></div>\n<div data-name="milepost_list_mask" class="milepost_list_mask"></div>\n';return __p},this.JST["work/copy-project/milepost/milepost-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<a class="milepost_item__avatar tu-cp  '+(null==(__t=editable?"cursor":"")?"":__t)+"\" data-body='"+(null==(__t=user.Name)?"":__t)+"' ",editable&&(__p+='data-name="milepost_item__avatar" '),__p+=" >\n"+(null==(__t=_.convertImage({className:"radius_img50 img_hover",src:user.Avatar.Medium,size:50,shape:"radius",name:user.Name,bgColor:user.Avatar.Color}))?"":__t)+'\n</a>\n<span class="tu-icon-edit tu-bg_m6 tu-cp" data-name="tu-icon-edit"></span>\n<!-- 向左的三角形 -->\n<div class="triangle-left"></div>\n<div class="milepost_item__title ',editable||(__p+="milepost_item__disable"),__p+='">\n	<div class="milepost-connect"></div>\n	<div class="milepost_item__right">\n		<div class="tu-input-default cursor milepost_input_time" data-name="input-container">\n			<span class="milepost_item__time-icon tu-icon-calendar" data-name="time"></span>\n			<div class="input"  ',editable&&(__p+='data-name="milepost_item__time"'),__p+=">"+(null==(__t=startDate)?"":__t)+" - "+(null==(__t=endDate)?"":__t)+'</div>\n		</div>\n	</div>\n	<div class="milepost_item__left">\n		<div class="milepost_input_container" data-name="milepost_input_container">\n			<div class="tu-input-default input-left-show" data-name="input-container">\n				<textarea id="milepost_item__name" class="tu-scroll textarea milepost_item__name" data-type="workName"  autocomplete="off" style="resize:none;max-height:120px; background: #F5F8FA" ',__p+=editable?'data-name="milepost_item__name" ':' disabled="true" ',__p+=' autocomplete="off">'+(null==(__t=mileStoneName)?"":__t)+'</textarea>\n				<label class="placeholder ',editable&&(__p+="hide"),__p+=' " ',editable&&(__p+=' for="milepost_item__name" '),__p+='  data-name="placeholder"></label>\n				<div class="right-action tu-clearfix">\n					<span class="tu-icon-cross ',editable,__p+='" data-type="description" data-name=\'delAll\' style="resize:none;" data-toggle="infotip" data-body="清除全部"></span>\n				</div>\n				<div class="error-tip"><span class="error-tip-count" data-name="error-tip-count"></span></div>\n			</div>\n		</div>\n	</div>\n</div>\n\n\n\n';return __p},this.JST["work/copy-project/milepost/milepost-list"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)milepostLength?__p+='\n	<ul class="milepost_list">\n	\n	</ul>\n':(__p+="\n   <div>",console.log(milepostLength),__p+='</div>\n	<div class="milepost-empty tu-font-h4">\n		<p>然项目流程把控更严格，让任务进程更清晰，</p>\n		<p>像贴便签一样转移任务，<a href="javascript:;">了解更多</a></p>\n		<img src="'+(null==(__t=Talent.Context.getStaticUrl("images/work/milepost-empty.png"))?"":__t)+'" alt="">\n	</div>\n'),__p+="\n";return __p},this.JST["work/copy-project/optional-bar-composite"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<div class="tu-dib tu-mr-20">'+(null==(__t=title)?"":__t)+'</div>\n<ul class="tu-dib"></ul>';return __p},this.JST["work/copy-project/optional-bar-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<i class="tu-icon-singlebox-'+(null==(__t=checked?"avtive":"have")?"":__t)+' tu-cp tu-mr-5"></i>'+(null==(__t=singleContent)?"":__t);return __p},this.JST["work/copy-project/steps-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="'+(null==(__t=stepDisabled?"disabled-st":stepType+"-st")?"":__t)+' tu-font-a1 tu-tac">\n    <label>\n        ',"finished"==stepType&&(__p+='\n            <span class="tu-icon-check-active tu-icon-a1 tu-pr-5 tu-vam"></span>\n        '),__p+="   \n        "+(null==(__t=stepName)?"":__t)+"\n    </label>\n    ",stepStage+1<stepLength&&(__p+='\n        <i class="triangle-right-bg"></i>\n        <i class="triangle-right"></i>\n    '),__p+="\n</div>";return __p},this.JST["work/copy-project/task-copy/task-copy-list-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj){if(__p+='<!-- 未接受，已完成审批中任务置灰显示 status 2 已完成，status 5 未接受 isApply 审批中-->\n<div class="tu-clearfix tu-font-a1 tu-ft_m1 tu-por tu-input-default copyTask_padding" data-name="task-item">\n    <div class="copyTask__taskName tu-dib tu-ft_m2">\n        ',level>2){__p+="\n            ";for(var i=0;i<2*(level-2);i++)__p+='\n                <a href="javascript:void(0)" class="project-lotSize__task-icon-empty"></a>\n            ';__p+="\n        "}__p+="\n\n        ",1!=level&&(__p+='\n            <span class="tu-icon-fold-arrow project-lotSize__task-icon_size tu-ft_m4 tu-pl-20"></span>\n        '),__p+="\n\n        <!-- 只显示5层 -->\n        ",showChildIcon&&level<5?(__p+="\n            ",__p+=showChildren?'\n                <span class="tu-icon-pack-up tu-ft_m3 tu-cp project-lotSize__task-icon_size" data-name="hideChildern"></span>\n            ':'\n                <span class="tu-icon-open tu-ft_m3 tu-cp project-lotSize__task-icon_size" data-name="showChildern"></span>\n            ',__p+="\n        "):__p+='\n            <a href="javascript:void(0)" class="project-lotSize__task-icon-empty"></a>\n        ',__p+="\n        ",__p+=disabled?'\n            <div class="copyTask__textarea copyTask__textarea_'+(null==(__t=level)?"":__t)+' tu-dib tu-por copyDisabled">\n                '+(null==(__t=taskName)?"":__t)+"\n            </div>\n        ":'\n            <div class="copyTask__textarea copyTask__textarea_'+(null==(__t=level)?"":__t)+' tu-dib tu-por">\n                <textarea id="textarea" class="textarea tu-scroll tu-por" autocomplete="off" style="resize:none;max-height:120px;" data-name="textarea">'+(null==(__t=taskName)?"":__t)+'</textarea>\n                <div class="error-tip" data-name="error-tip">已输入 561 字，最多可输入 50 字</div>\n                <div class="right-action tu-clearfix">\n                    <span class="tu-icon-cross" data-name="textarea-del"></span>\n                </div>\n            </div>\n        ',__p+='\n    </div>\n\n    <div class="tu-ft_m2 tu-dib copyTask__taskPrincipal  dashedBorder  '+(null==(__t=disabled?"copyDisabled":"tu-cp")?"":__t)+'" data-name="setPrincipal" ><i class="tu-icon-assigner tu-vam tu-icon-a1 '+(null==(__t=disabled?"":"tu-ft_c3")?"":__t)+' tu-pl-10 tu-pr-5"></i><span data-name="principal">'+(null==(__t=_.substring(principalUser.name,6,!0))?"":__t)+'</span></div>\n    \n    <div class="tu-ft_m2 tu-dib  dashedBorder tu-tac  '+(null==(__t=disabled?"copyDisabled":"tu-cp")?"":__t)+'" data-name="setDate">\n        <i class="tu-icon-calendar tu-vam tu-icon-a1  '+(null==(__t=disabled?"":"tu-ft_c3")?"":__t)+' tu-pl-10 tu-pr-5"></i><span data-name="time">'+(null==(__t=startDate)?"":__t)+" - "+(null==(__t=isLongTerm?"长期":deadLine)?"":__t)+'</span>\n    </div>\n</div>\n<ul class="project-lotSize__task-childern '+(null==(__t=showChildIcon&&showChildren?"tu-db":"tu-dn")?"":__t)+'" data-name="task-childern"></ul>\n    '}return __p},this.JST["work/copy-project/task-copy/task-copy-list"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="copyTask__bar" data-name="copyTask__bar"></div>\n<div class="copyTask__list" data-name="copyTask__list"></div>\n<div data-name="pagination"></div>';return __p},this.JST["work/create-target/target-create-roles"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+="\n\n\n",_.each(workUsers,function(a){__p+="\n	",WorkFollwer&&"3"==a.roleType||(__p+='\n	<div class="project_item_container clearfix  project_member ',4==a.roleType&&(__p+="project_applyUser"),__p+="  ",9==a.roleType&&(__p+="tu-dn"),__p+='">\n		<span class="project_item_title">\n				'+(null==(__t=a.roleName)?"":__t)+'\n		</span>\n		<div class="project_input_container">\n			',9!=a.roleType&&(__p+='\n				<div class="tu-input-default" data-name="containter" style="resize:none;line-height:40px;">\n				',1==a.roleType?(__p+='\n					<a href="javascript:void(0)" class="responsible_avatar" data-order="'+(null==(__t=a.order)?"":__t)+'" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="showUserSelector" data-toggle="infotip" data-body="修改'+(null==(__t=a.roleName)?"":__t)+'">\n					',_.each(a.users,function(a){__p+="\n						"+(null==(__t=_.convertImage({className:"radius_img30 responsible_img",name:a.Name,src:a.UserAvatar.Small,size:30,shape:"radius",bgColor:a.UserAvatar.Color}))?"":__t)+'\n						<span class="principal_name" >'+(null==(__t=a.Name)?"":__t)+"</span>\n					"}),__p+="\n					</a>\n\n				"):1!==a.roleType&&4!==a.roleType&&(__p+='\n					<a class="tu-btn-add tu-btn tu-btn-mini tu-icon-add" data-order="'+(null==(__t=a.order)?"":__t)+'" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="showUserSelector" href="javascript:;">\n					</a>\n					<ul class="project_member_container tu-scroll" data-name='+(null==(__t="project-"+a.roleType+"-list")?"":__t)+" >\n							",_.each(a.users,function(b){__p+="\n								",__p+="undefined"!=typeof b.type&&"department"==b.type?"\n									<li data-id="+(null==(__t=b.id)?"":__t)+'>\n										<a data-toggle="infotip" data-body="删除 '+(null==(__t=b.name)?"":__t)+'" class="project_delete_member_btn tu-icon-close" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="project-delete-member" href="javascript:;">\n										</a>\n										'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:"",size:30,shape:"radius",name:b.name,bgColor:"#7890BD"}))?"":__t)+"\n\n									</li>\n								":"\n									<li data-id="+(null==(__t=b.Id)?"":__t)+'>\n										<a data-toggle="infotip" data-body="删除 '+(null==(__t=b.Name)?"":__t)+'" class="project_delete_member_btn tu-icon-close" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="project-delete-member" href="javascript:;">\n										</a>\n\n										'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:b.UserAvatar.Small,size:30,shape:"radius",name:b.Name,bgColor:b.UserAvatar.Color}))?"":__t)+"\n									</li>\n								",__p+="\n							"}),__p+='\n					</ul>\n					<div class="right-action tu-clearfix">\n						<span class="tu-icon-cross" data-order="'+(null==(__t=a.order)?"":__t)+'" data-type="'+(null==(__t=a.roleType)?"":__t)+"\" data-name = 'delAll' style=\"",__p+=a.users&&a.users.length?"display:block":"display:none",__p+='" data-toggle="infotip" data-body="清除全部"></span>\n					</div>\n					'),__p+="\n				</div>\n			"),__p+="\n		</div>\n	</div>\n	",3==a.roleType&&(__p+='\n	<div class="project-approver-box" data-name="project-approver-box"></div>\n	'),__p+="\n")}),__p+="\n";return __p},this.JST["work/create-target/target-create"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="project_create_bottom_container">\n	<div class="project_item_container clearfix">\n		<span class="project_item_title">\n		<span class="red-star">*</span>\n			名称\n		</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default" data-name="input-container">\n				<input id="project_name" data-type="workName" data-name="input" autocomplete="off"/>\n				<label class="placeholder ',workName&&(__p+="hide"),__p+='" for="project_name" data-name="placeholder">名称最多50个字</label>\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-cross ',workName&&(__p+="showBlock"),__p+='" data-type="workName" data-name = \'delAll\' data-toggle="infotip" data-body="清除全部"></span>\n			    </div>\n				<div class="error-tip" data-name="error-tip"></div>\n			</div>\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">\n			起止时间\n		</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default cursor" data-name="input-container">\n				',
__p+=IsUseWork&&startDate?'\n					<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+"</div>\n				":startDate&&endDate&&!isLong?'\n					<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+" - "+(null==(__t=endDate)?"":__t)+"</div>\n				":startDate&&isLong?'\n					<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+" - 长期</div>\n				":'\n					<div class="input"  data-name="time"></div>\n				',__p+='\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-sort-down" data-name="time"></span>\n			    </div>\n			</div>\n		</div>\n	</div>\n	\n	<div class="project_item_container clearfix">\n		<span class="project_item_title">\n			衡量标准\n		</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default" data-name="input-container">\n				<textarea id="projectDescription" class="tu-scroll textarea" data-type="description" data-name="input" autocomplete="off" style="resize:none;max-height:120px;">'+(null==(__t=description)?"":__t)+'</textarea>\n				<label class="placeholder ',description&&(__p+="hide"),__p+='" for="projectDescription" data-name="placeholder" style="resize:none;">请输入详细信息</label>\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-cross ',description&&(__p+="showBlock"),__p+='" data-type="description" data-name=\'delAll\' style="resize:none;" data-toggle="infotip" data-body="清除全部"></span>\n			    </div>\n				<div class="error-tip"></div>\n\n			</div>\n		</div>\n	</div>\n	<div class="roles-container" data-name="roles"></div>\n	<div class="project_item_container clearfix project_range" style="margin-bottom:0">\n		<span class="project_item_title">\n			可见范围\n		</span>\n		<a class="radio_item radio_item1" href="javascript:;" data-type="private" data-name="select-visible">\n			<span class="',__p+=2==isVisible?"tu-icon-singlebox-avtive":"tu-icon-singlebox-have",__p+='"  ></span>',__p+=IsUseWork?"private":"私密",__p+='												\n		</a>\n		<a class="radio_item radio_item2" href="javascript:;" data-type="public" data-name="select-visible">\n			<span class="',__p+=1==isVisible?"tu-icon-singlebox-avtive":"tu-icon-singlebox-have",__p+='" ></span>',__p+=IsUseWork?"public":"公开",__p+='\n		</a>\n	</div>\n\n	<textarea id="text" style="position:absolute;top: -1000px;"></textarea>\n</div>';return __p},this.JST["work/create/project-create-roles"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+="\n\n\n",_.each(workUsers,function(a){__p+="\n	",WorkFollwer&&"3"==a.roleType||(__p+='\n	<div class="project_item_container clearfix  project_member ',4==a.roleType&&(__p+="project_applyUser"),__p+="  ",9==a.roleType&&(__p+="tu-dn"),__p+='">\n		<span class="project_item_title">\n				'+(null==(__t=a.roleName)?"":__t)+'\n		</span>\n		<div class="project_input_container">\n			',9!=a.roleType&&(__p+='\n				<div class="tu-input-default" data-name="containter" style="resize:none;line-height:40px;">\n				',1==a.roleType?(__p+='\n					<a href="javascript:void(0)" class="responsible_avatar" data-order="'+(null==(__t=a.order)?"":__t)+'" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="showUserSelector" data-toggle="infotip" data-body="修改'+(null==(__t=a.roleName)?"":__t)+'">\n					',_.each(a.users,function(a){__p+="\n						"+(null==(__t=_.convertImage({className:"radius_img30 responsible_img",name:a.Name,src:a.UserAvatar.Small,size:30,shape:"radius",bgColor:a.UserAvatar.Color}))?"":__t)+'\n						<span class="principal_name" >'+(null==(__t=a.Name)?"":__t)+"</span>\n					"}),__p+="\n					</a>\n\n				"):1!==a.roleType&&4!==a.roleType&&(__p+='\n					<a class="tu-btn-add tu-btn tu-btn-mini tu-icon-add" data-order="'+(null==(__t=a.order)?"":__t)+'" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="showUserSelector" href="javascript:;">\n					</a>\n					<ul class="project_member_container tu-scroll" data-name='+(null==(__t="project-"+a.roleType+"-list")?"":__t)+" >\n							",_.each(a.users,function(b){__p+="\n								",__p+="undefined"!=typeof b.type&&"department"==b.type?"\n									<li data-id="+(null==(__t=b.id)?"":__t)+'>\n										<a data-toggle="infotip" data-body="删除 '+(null==(__t=b.name)?"":__t)+'" class="project_delete_member_btn tu-icon-close" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="project-delete-member" href="javascript:;">\n										</a>\n										'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:"",size:30,shape:"radius",name:b.name,bgColor:"#7890BD"}))?"":__t)+"\n\n									</li>\n								":"\n									<li data-id="+(null==(__t=b.Id)?"":__t)+'>\n										<a data-toggle="infotip" data-body="删除 '+(null==(__t=b.Name)?"":__t)+'" class="project_delete_member_btn tu-icon-close" data-type="'+(null==(__t=a.roleType)?"":__t)+'" data-name="project-delete-member" href="javascript:;">\n										</a>\n\n										'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:b.UserAvatar.Small,size:30,shape:"radius",name:b.Name,bgColor:b.UserAvatar.Color}))?"":__t)+"\n									</li>\n								",__p+="\n							"}),__p+='\n					</ul>\n					<div class="right-action tu-clearfix">\n						<span class="tu-icon-cross" data-order="'+(null==(__t=a.order)?"":__t)+'" data-type="'+(null==(__t=a.roleType)?"":__t)+"\" data-name = 'delAll' style=\"",__p+=a.users&&a.users.length?"display:block":"display:none",__p+='" data-toggle="infotip" data-body="清除全部"></span>\n					</div>\n					'),__p+="\n				</div>\n			",WorkExternal&&(__p+="\n				",2==a.roleType&&(__p+='\n					<div class="tu-pl-10 tu-dib tu-font-a2 tu-ft_m3">如果有"企业外部人员"想要了解项目进展，或需要参与协作支持，可以创建项目后在"外部联系人"模块添加ta哦~</div>\n					'),__p+="\n				"),__p+="\n			"),__p+="\n		</div>\n	</div>\n	",3==a.roleType&&(__p+='\n	<div class="project-approver-box" data-name="project-approver-box"></div>\n	'),__p+="\n")}),__p+="\n";return __p},this.JST["work/create/project-create"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="project_create_bottom_container">\n	<div class="project_item_container clearfix">\n		<span class="project_item_title">\n		<span class="red-star">*</span>\n		',__p+=IsUseWork?"\n			Name\n		":"\n			名称\n		",__p+='</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default" data-name="input-container">\n				<input id="project_name" data-type="workName" data-name="input" autocomplete="off"/>\n				<label class="placeholder ',workName&&(__p+="hide"),__p+='" for="project_name" data-name="placeholder">项目名称最多50个字</label>\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-cross ',workName&&(__p+="showBlock"),__p+='" data-type="workName" data-name = \'delAll\' data-toggle="infotip" data-body="清除全部"></span>\n			    </div>\n				<div class="error-tip" data-name="error-tip"></div>\n			</div>\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Date\n			":"\n				起止时间\n			",__p+='\n		</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default cursor" data-name="input-container">\n				',__p+=IsUseWork&&startDate?'\n					<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+"</div>\n				":startDate&&endDate&&!isLong?'\n					<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+" - "+(null==(__t=endDate)?"":__t)+"</div>\n				":startDate&&isLong?'\n					<div class="input"  data-name="time">'+(null==(__t=startDate)?"":__t)+" - 长期</div>\n				":'\n					<div class="input"  data-name="time"></div>\n				',__p+='\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-sort-down" data-name="time"></span>\n			    </div>\n			</div>\n		</div>\n	</div>\n\n	',TaskLabel&&(__p+='\n		<div class="project_item_container clearfix project_name" >\n			<span class="project_item_title">\n				',__p+=IsUseWork?"\n					Type\n				":"\n					分类\n				",__p+='\n				</span>\n			<div class="project_input_container" data-name="project_input_container">\n				<div class="tu-input-default cursor" data-name="input-container">\n					<div data-name="lable-trigger">\n						<div class="input" id="project_label" data-name="lable">'+(null==(__t=lableName)?"":__t)+'</div>\n						<label class="placeholder cursor ',lableName&&(__p+="hide"),__p+='">请选择类别</label>\n					</div>\n					<div class="right-action tu-clearfix">\n						<span class="tu-icon-sort-down" data-name="lable-trigger"></span>\n						<span class="tu-icon-cross ',lableName&&(__p+="showBlock"),__p+='" data-type="lable" data-name = \'delAll\' data-toggle="infotip" data-body="清除全部"></span>\n					</div>\n				</div>\n			</div>\n		</div>\n	'),__p+='\n\n	<div class="project_item_container clearfix project_name">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Team\n			":"\n				所属部门\n			",__p+='\n		</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default cursor" data-name="input-container">\n				<div class="input"  data-name="department">'+(null==(__t=departmentName)?"":__t)+'</div>\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-cross ',departmentName&&(__p+="showBlock"),__p+='" data-type="department" data-name = \'delAll\' data-toggle="infotip" data-body="清除全部"></span>\n			        <span class="tu-icon-sort-down" data-name="department"></span>\n			    </div>\n			</div>\n		</div>\n	</div>\n	\n	<div class="roles-container" data-name="roles"></div>\n\n	<div class="project_item_container clearfix">\n		<span class="project_item_title">',__p+=IsUseWork?"\n			Objective\n		":"\n			目标\n		",__p+='</span>\n		<div class="project_input_container" data-name="project_input_container">\n			<div class="tu-input-default" data-name="input-container">\n				<textarea id="projectDescription" class="tu-scroll textarea" data-type="description" data-name="input" autocomplete="off" style="resize:none;max-height:120px;">'+(null==(__t=description)?"":__t)+'</textarea>\n				<label class="placeholder ',description&&(__p+="hide"),__p+='" for="projectDescription" data-name="placeholder" style="resize:none;">请输入项目目标</label>\n				<div class="right-action tu-clearfix">\n			        <span class="tu-icon-cross ',description&&(__p+="showBlock"),__p+='" data-type="description" data-name=\'delAll\' style="resize:none;" data-toggle="infotip" data-body="清除全部"></span>\n			    </div>\n				<div class="error-tip"></div>\n\n			</div>\n		</div>\n	</div>\n\n	<div class="project_item_container clearfix project_range" style="margin-bottom:0">\n		<span class="project_item_title">\n			',__p+=IsUseWork?"\n				Visibility\n			":"\n				可见范围\n			",__p+='\n			</span>\n		<a class="radio_item radio_item1" href="javascript:;" data-type="private" data-name="select-visible">\n			<span class="',__p+=2==isVisible?"tu-icon-singlebox-avtive":"tu-icon-singlebox-have",__p+='"  ></span>',__p+=IsUseWork?"private":"私密",__p+='												\n		</a>\n		<a class="radio_item radio_item2" href="javascript:;" data-type="public" data-name="select-visible">\n			<span class="',__p+=1==isVisible?"tu-icon-singlebox-avtive":"tu-icon-singlebox-have",__p+='" ></span>',__p+=IsUseWork?"public":"公开",__p+="\n		</a>\n	</div>\n\n	",isShowInvested&&(__p+='\n	<div class="project_item_container clearfix project_range">\n		<span class="project_item_title">已投资</span>\n		<a class="radio_item radio_item1" href="javascript:;">\n			<span class="radio_blue ',IsInvested&&1==IsInvested&&(__p+="radio_blue_checked"),__p+='"  data-type="investment" data-name=\'invested\'></span>是　\n		</a>\n		<a class="radio_item radio_item2" href="javascript:;">\n			<span class="radio_blue ',IsInvested&&0==IsInvested&&(__p+="radio_blue_checked"),__p+='" data-type="noInvestment" data-name=\'invested\'></span>否\n		</a>\n	</div>\n	'),__p+='\n	<textarea id="text" style="position:absolute;top: -1000px;"></textarea>\n</div>';return __p},this.JST["work/custom/project-custom-detail-layout"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="_tt_loading_m" data-name="page-loading">努力加载中…</div>\n<div data-name="frame-box"></div>';return __p},this.JST["work/custom/project-custom-sidebar"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tt_project_custom_sidebar">\n	<dl class="basic_pcs">\n		<dt><span class="title_pcs">'+(null==(__t=WorkName)?"":__t)+"</span>  \n			",IsEdit&&(__p+='<a href="javascript:void(0)" data-name="edit-project">Edit</a>'),__p+="\n		</dt>\n		<dd>Responsible:"+(null==(__t=Principal.Name)?"":__t)+"</dd>\n		<dd>Team:"+(null==(__t=DepartmentName)?"":__t)+"</dd>\n		<dd>Type:"+(null==(__t=LableName)?"":__t)+"</dd>\n		<dd>Exploring Start Date:"+(null==(__t=StartDate)?"":__t)+'</dd>\n	</dl>\n\n	<div class="_tt_side_subnav">\n		<ul class="worklist_sidenav">\n			',_.each(LableTypes,function(a){__p+='\n			<li>\n				<a title="'+(null==(__t=a.Name)?"":__t)+'" data-trigger="false" class="worknavlist_wlsn" href="'+(null==(__t=a.Url)?"":__t)+'">\n					<i class="name_wlsn">'+(null==(__t=a.Name)?"":__t)+"</i>\n				</a>\n			</li>\n			"}),__p+="\n		</ul>\n	</div>\n</div>";return __p},this.JST["work/detail-target/detail-head/head-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="project-detail-head clearfix">\r\n	<div class="top-inner-box">\r\n		<div data-name="project-user-region" class="user-photo"></div>\r\n		<div data-name="project-name-region"></div>\r\n		<div data-name="project-description-region"></div>\r\n		<div data-name="project-btn-region" class="project-btns-wrap"></div>\r\n		<div data-name="project-tags-region"></div>\r\n	</div>\r\n	<div class="top-inner-box-bottom">\r\n		<div data-name=\'project-time-region\' class=\'project-time-region\'></div>\r\n		<div data-name=\'project-progress-region\' class=\'project-progress-region\'></div>\r\n	</div>\r\n	<div data-name="customize-snippet" class="customize-box"></div>\r\n</div>\r\n<!--以上是头部内容-->\r\n\r\n<!--以下是tab内容-->\r\n<div data-name="project-tabs-region" class="project-tabs-wrap"></div>\r\n';return __p},this.JST["work/detail-target/detail-head/target-opr-btn"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj){if(__p+="<!--审批中(状态图片标示//approvalType 审批类型1 创建项目 2 修改项目时间 3.删除项目4.重启项目5.完成项目；approvalStatus 审批状态 1 审批开始 2 审批完成 3 审批挂起 4 审批撤销 5 审批进行中 6 审批驳回)-->\n",(1==applyState||0!=approvalType&&5==approvalStatus)&&(__p+='\n	<div class="status-img status-agree tu-dib"></div>\n	'),__p+="\n	\n	<!--已驳回(状态图片标示)-->\n	",3==applyState&&(__p+='\n		<div class="status-img status-reject tu-dib"></div>\n	'),__p+="\n	\n	<!--已撤销(状态图片标示)-->\n	",4==applyState&&(__p+='\n		<div class="status-img status-repeal tu-dib"></div>\n	'),__p+="\n	\n	<!--已驳回(重新创建、删除)-->\n	",reCreate&&(__p+='\n		<div class="tu-btn tu-btn-sure tu-btn-small btn-reject tu-dib" data-name="reject" type="reCreate">重新创建</div>\n	'),__p+='\n<!--操作按钮-->\n<div class="tu-btn tu-btn-sure tu-btn-small dropdown-list-btn tu-dib" data-name="self-opr-btn">\n	操作\n	<span class="tu-icon-sort-down"></span>\n</div>\n\n<!--操作按钮附属的下来菜单-->\n<ul class="dropdown-list" data-name="dropdown-list">\n	<!--导入任务-->\n	',mileStone&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="importMilePost">导入里程碑</a>\n		</li>\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="importTask">导入任务</a>\n		</li>\n	'),__p+="\n	<!-- 项目督办 -->\n	",superviseAuth&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="supervise">提醒更新进展</a>\n		</li>\n	'),__p+="\n	<!--重启项目、完成项目-->\n	",projectStatus&&(__p+="\n		",1==progressStatus?__p+='\n			<li class="item" data-name="view-item">\n				<a href="javascript:;" opr-type="p-finished">完成目标</a>\n			</li>\n		':2==progressStatus&&(__p+='\n			<li class="item" data-name="view-item">\n				<a href="javascript:;" opr-type="p-reStart">重启目标</a>\n			</li>\n		'),__p+="\n	"),__p+="\n	<!--删除项目-->\n	",projectDel&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="p-delete">删除目标</a>\n		</li>\n	'),__p+="\n	<!--取消分管、取消督办、取消关注、退出参与、关注（只会显示其中的一个）-->\n	",roleRelation){__p+="\n		";var oprType="取消分管"==roleRelation.description?"cancellCharge":"取消督办"==roleRelation.description?"cancellSupervise":"取消关注"==roleRelation.description?"cancellFollow":"退出参与"==roleRelation.description?"exitParticipation":"关注项目"==roleRelation.description?"toFollow":"";__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="'+(null==(__t=oprType)?"":__t)+'">\n				'+(null==(__t="关注项目"==roleRelation.description?"关注目标":roleRelation.description)?"":__t)+"\n			</a>\n		</li>\n	"}__p+="\n</ul>"}return __p},this.JST["work/detail-target/detail-main/target-message"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+="<!-- ",canEdit&&(__p+='\n<button class="tu-btn tu-btn-small tu-btn-sure update-btn" data-name="update">编辑</button>\n'),__p+=' -->\n<div class="message-containter__main">\n	<dl>\n		<div class="message-containter__item">\n			<dt class="item-title">名称</dt>\n			<dd class="item-content">\n				<p ',canEdit&&(__p+=' data-name="input-show" class="message-containter__item_show"'),__p+=' data-id="workName">\n					'+(null==(__t=workName)?"":__t)+"\n				</p>\n			",canEdit&&(__p+='\n				<div class="message-containter__item_edit tu-input-default" data-name="input-edit">\n					<input type="text" value="'+(null==(__t=workName)?"":__t)+'" data-name="input-handler" data-id="workName">\n				    <div class="right-action tu-clearfix">\n				        <span class="tu-icon-cross" data-name="del-all" data-id="workName" data-body="清除全部"></span>\n				    </div>\n				    <div class="message-containter__extra" data-name="input-extra">\n						<div class="error-tip" data-name="error-tip">您已输入 <span data-name="max-word"></span> 字，最多可输入 '+(null==(__t=maxWord.workName)?"":__t)+' 字</div>\n						<div class="message-containter__extra_btns">\n							<button class="tu-btn tu-btn-small " data-name="cancel" data-id="workName">取消</button>\n							<button class="tu-btn tu-btn-small tu-btn-sure" data-name="confirm" data-id="workName">确定</button>\n						</div>\n					</div>\n				</div>\n			'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item">\n			<dt class="item-title">起止时间</dt>\n			<dd class="editor-pencil item-content">\n				',isLong?__p+="\n					<span>"+(null==(__t=startDate)?"":__t)+"</span> - <span>长期</span>\n				":startDate&&endDate&&!isLong&&(__p+="\n					<span>"+(null==(__t=startDate)?"":__t)+"</span> - <span>"+(null==(__t=endDate)?"":__t)+"</span>\n				"),__p+="\n				",canEdit&&(__p+='\n					<div class="tu-dib tu-ml-10" data-name="date-change">\n						<div class="tu-icon-edit tu-ml-10"  data-body="编辑"></div>\n					</div>\n				'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item">\n			<dt class="item-title">私密性</dt>\n			<dd class="editor-pencil item-content">\n				',__p+=2==isVisible?"\n					私密（仅目标相关人员可见）\n				":"\n					公开 (所有人可见)\n				",__p+="	\n				",canEdit&&(__p+='\n					<div class="tu-icon-edit tu-ml-10" data-name="visible-change" data-body="编辑"></div>\n				'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item message-containter__hover">\n			<dt class="item-title">衡量标准</dt>\n				<dd class="item-content">\n						',description?(__p+='\n							<p class="message-containter__item_show message-containter__description ',description&&canEdit||(__p+="message-containter__item_noborder"),__p+='" ',canEdit&&(__p+=' data-name="input-show" '),__p+='  data-id="description">'+(null==(__t=description)?"":__t)+"</p>\n						"):canEdit&&(__p+='\n							<p class="message-containter__item_show ',description||(__p+="message-containter__item_noborder"),__p+='" ',canEdit&&(__p+=' data-name="input-show" '),__p+='  data-id="description">\n								<a href="javascript:void(0)">请添加</a>\n							</p>\n						'),__p+="\n				",canEdit&&(__p+='\n					<div class="message-containter__item_edit tu-input-default" data-name="input-edit">\n						<textarea type="text" class="tu-scroll textarea" autocomplete="off" style="resize:none;max-height:120px;" data-name="input-handler" data-id="description"></textarea>\n					    <div class="right-action tu-clearfix">\n					        <span class="tu-icon-cross" data-name="del-all" data-id="description" data-body="清除全部"></span>\n					    </div>\n					    <div class="message-containter__extra" data-name="input-extra">\n							<div class="error-tip" data-name="error-tip">您已输入 <span data-name="max-word"></span> 字，最多可输入 '+(null==(__t=maxWord.description)?"":__t)+' 字</div>\n							<div class="message-containter__extra_btns">\n								<button class="tu-btn tu-btn-small " data-name="cancel" data-id="description">取消</button>\n								<button class="tu-btn tu-btn-small tu-btn-sure" data-name="confirm" data-id="description">确定</button>\n							</div>\n						</div>\n					</div>\n				'),__p+='\n				</dd>\n		</div>\n		<!--<div class="message-containter__item">-->\n				<!--<dt class="item-title">外部联系人</dt>-->\n				<!--<dd class="item-content">-->\n					<!--<div class="tu-dib switch-component tu-cp tu-dib tu-clearfix switch-component_'+(null==(__t=isOpenExternal?"on":"off")?"":__t)+" "+(null==(__t=canEdit?"":"disabled")?"":__t)+'" data-name="switch-button">-->\n							<!--<div class="switch-component__button switch-component__button_'+(null==(__t=isOpenExternal?"on":"off")?"":__t)+" tu-"+__e(isOpenExternal?"fr":"fl")+'" data-name="switch-button-radio"></div>-->\n					<!--</div>-->\n					<!--<span class="tu-font-a2 tu-ft_m3">开启后，可在项目中的“外部联系人”模块邀请企业外部协作者加入<a class="tu-ml-10" target="_blank" href="https://blog.tita.com/project-external-member/">了解详情</a></span>-->\n				<!--</dd>-->\n		<!--</div>-->\n		<div class="message-containter__item ">\n				<dt class="item-title tu-vam">附件</dt>\n			\n			<dd class="item-content tu-vam">\n				<div data-name="project-file" class="tu-dib '+(null==(__t=canEdit?"":"tu-pt-20")?"":__t)+'">\n					\n				</div>\n				',canEdit&&(__p+='\n					<div class="tu-ft_m3 tu-font-a2 tu-dib tu-poa" style="top:0;left:50px;">（请上传不超过50MB大小的文件，最多可上传9个）</div>\n				'),__p+="\n				</dd>\n		</div>\n	</dl>\n	\n</div>\n";return __p},this.JST["work/detail-target/detail-main/target-progress"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)canEdit&&(__p+='\n<button class="tu-btn tu-btn-small tu-btn-sure update-btn" data-name="update">更新目标进度</button>\n'),__p+='\n<div class="show-more">\n	<a  data-name="show-more"></a>\n</div>\n<div class="progress-composite" data-name="progresses">\n	<div data-name=\'empty\'></div>\n	<dl class="progresses">\n	</dl>\n</div>\n<div class="communicate" data-name="communicate">\n\n</div>';return __p},this.JST["work/detail-target/project-detail-layout"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)__p+='<div id="project_detail_head_container"></div>\r\n<div id="project_detail_tab_container" data-name="project-detail-top"></div>\r\n<div id="project_detail_container">\r\n	',WorkExternal&&(__p+='\r\n		<div class="external__yellow-tip tu-font-a2 tu-pt-5 tu-pb-5 tu-tac tu-dn" data-name="yellowTip">企业外部联系人加入后，可以查看项目下 全部任务、动态、文件及项目成员，请注意您的信息保密！\r\n				<a href="https://blog.tita.com/project-external-member/" target="_blank">了解详情</a>\r\n			</div>\r\n	'),__p+='\r\n	<div class="project_detail_content" id="project_detail_region">\r\n		<div class="_tt_loading_m">努力加载中…</div>\r\n	</div>\r\n</div>';return __p},this.JST["work/detail/detail-head/head-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="project-detail-head clearfix">\r\n	<div class="top-inner-box">\r\n		<div data-name="project-user-region" class="user-photo"></div>\r\n		<div data-name="project-name-region"></div>\r\n		<div data-name="project-description-region"></div>\r\n		<div data-name="project-btn-region" class="project-btns-wrap"></div>\r\n		<div data-name="project-tags-region"></div>\r\n	</div>\r\n	<div class="top-inner-box-bottom">\r\n		<div data-name=\'project-time-region\' class=\'project-time-region\'></div>\r\n		<div data-name=\'project-progress-region\' class=\'project-progress-region\'></div>\r\n	</div>\r\n	<div data-name="customize-snippet" class="customize-box"></div>\r\n</div>\r\n<!--以上是头部内容-->\r\n\r\n<!--以下是tab内容-->\r\n<div data-name="project-tabs-region" class="project-tabs-wrap"></div>\r\n';return __p},this.JST["work/detail/detail-head/project-description"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<div class=\'project-desc-text\' data-name="project-desc-text" data-body="查看项目目标">\n'+(null==(__t=description)?"":__t)+"\n</div>\n";return __p},this.JST["work/detail/detail-head/project-name"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+="\n",__p+=isEdit?'\n	<input class="project-name-input" data-name="project-name-input" type="text" value="" style="display:none">\n	<span class="project-name-text project-name-shadow" data-name=\'project-name-shadow\'>'+(null==(__t=workName)?"":__t)+'</span>\n\n	<div class="edit-extra" data-name="edit-extra">\n		<span class="error-input" data-name=\'error-input\'></span>\n		<div class="project-btn-group">\n			<button class="tu-btn tu-btn-small " data-name=\'cancel\'>取消</button>\n			<button class="tu-btn tu-btn-small tu-btn-sure" data-name=\'confirm\'>确定</button>\n		</div>\n	</div>\n':'\n	<span class="project-name-text">'+(null==(__t=workName)?"":__t)+"</span>\n",__p+="\n";return __p},this.JST["work/detail/detail-head/project-opr-btn"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj){if(__p+="<!--审批中(状态图片标示//approvalType 审批类型1 创建项目 2 修改项目时间 3.删除项目4.重启项目5.完成项目；approvalStatus 审批状态 1 审批开始 2 审批完成 3 审批挂起 4 审批撤销 5 审批进行中 6 审批驳回)-->\n",(1==applyState||0!=approvalType&&5==approvalStatus)&&(__p+='\n<div class="status-img status-agree tu-dib"></div>\n'),__p+="\n\n<!--已驳回(状态图片标示)-->\n",3==applyState&&(__p+='\n	<div class="status-img status-reject tu-dib"></div>\n'),__p+="\n\n<!--已撤销(状态图片标示)-->\n",4==applyState&&(__p+='\n	<div class="status-img status-repeal tu-dib"></div>\n'),__p+="\n\n<!--已驳回(重新创建、删除)-->\n",reCreate&&(__p+='\n	<div class="tu-btn tu-btn-sure tu-btn-small btn-reject tu-dib" data-name="reject" type="reCreate">重新创建</div>\n'),__p+="\n\n<!-- webim 按钮 -->\n",showWbim&&(__p+='\n	<div class="tu-btn tu-btn-sure tu-btn-small header-icon-titaim webIm tu-dib" data-body="进入群聊" data-name="webim"></div>\n'),__p+='\n\n<!--操作按钮-->\n<div class="tu-btn tu-btn-sure tu-btn-small dropdown-list-btn tu-dib" data-name="self-opr-btn">\n	操作\n	<span class="tu-icon-sort-down"></span>\n</div>\n\n<!--操作按钮附属的下来菜单-->\n<ul class="dropdown-list" data-name="dropdown-list">\n	<!--导入里程碑、导入任务-->\n	',mileStone&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="importMilePost">导入里程碑</a>\n		</li>\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="importTask">导入任务</a>\n		</li>\n	'),__p+="\n	<!-- 复制项目 -->\n	",hasCopyRight&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="p-copy">复制项目</a>\n		</li>\n	'),__p+="\n	<!-- 项目督办 -->\n	",superviseAuth&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="supervise">提醒更新进展</a>\n		</li>\n	'),__p+="\n	<!--重启项目、完成项目-->\n	",projectStatus&&(__p+="\n		",1==progressStatus?__p+='\n			<li class="item" data-name="view-item">\n				<a href="javascript:;" opr-type="p-finished">完成项目</a>\n			</li>\n		':2==progressStatus&&(__p+='\n			<li class="item" data-name="view-item">\n				<a href="javascript:;" opr-type="p-reStart">重启项目</a>\n			</li>\n		'),__p+="\n	"),__p+="\n	<!--查看当前审批详情-->\n	",approvalDetailsPage&&approvalUrl&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="'+(null==(__t=approvalUrl)?"":__t)+'" target="_blank">查看当前审批详情</a>\n		</li>\n	'),__p+="\n	",revokeApproval&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="p-undo">撤销当前审批</a>\n		</li>\n	'),__p+="\n	<!--删除项目-->\n	",projectDel&&(__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="p-delete">删除项目</a>\n		</li>\n	'),__p+="\n	<!--取消分管、取消督办、取消关注、退出参与、关注（只会显示其中的一个）-->\n	",roleRelation){__p+="\n		";var oprType="取消分管"==roleRelation.description?"cancellCharge":"取消督办"==roleRelation.description?"cancellSupervise":"取消关注"==roleRelation.description?"cancellFollow":"退出参与"==roleRelation.description?"exitParticipation":"关注项目"==roleRelation.description?"toFollow":"";__p+='\n		<li class="item" data-name="view-item">\n			<a href="javascript:;" opr-type="'+(null==(__t=oprType)?"":__t)+'">\n				'+(null==(__t=roleRelation.description)?"":__t)+"\n			</a>\n		</li>\n	"}__p+="\n</ul>"}return __p},this.JST["work/detail/detail-head/project-progress"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='\n<div class="project-progress-inner '+(null==(__t=isEdit?"able-to-edit":"")?"":__t)+'">\n	<span class="label-title">进度</span>\n	<a data-trigger="false" href="'+(null==(__t=isShowlink?url:"javascript:;")?"":__t)+'" class="'+(null==(__t=isShowlink?"":"not-link")?"":__t)+'" data-name="go-to-progress">\n		<span class="progress-bar">\n			<span class="progress-finished" style="width:'+(null==(__t=progress)?"":__t)+'">\n				<span class="progress-slider"></span>\n			</span>\n		</span>\n	</a>\n	<span class="progress-num">'+(null==(__t=progress)?"":__t)+'</span>\n	<span class=\'for-position\'>\n		<span class="tu-icon-edit edit-able" data-name="edit-able"></span>\n	</span>\n</div>\n';return __p},this.JST["work/detail/detail-head/project-tabs"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+='<div class="'+(null==(__t="1"==tabType?"tu-tabbable-line":"tu-tabbable-custom tu-tabbable-custom-min")?"":__t)+'" data-name="minor-tab-container">\n\n	<ul class="tu-nav-tabs" id="project-detail-nav">\n		',Talent._.map(normalArray,function(a,b){__p+='\n			<li  class="tu-por item-tab '+(null==(__t=activeRouter==a.router?"active":"")?"":__t)+" "+(null==(__t=a.isAble?"is-able":"is-disable")?"":__t)+'" data-name="tab-item"\n			 data-router="'+(null==(__t=a.router)?"":__t)+'" >\n				<a data-trigger="false" href="'+(null==(__t=a.isAble&&isHash?a.url:"javascript:void(0)")?"":__t)+'">\n					'+(null==(__t=a.name)?"":__t)+"\n						<span data-flag='"+(null==(__t=a.router)?"":__t)+"'>\n							"+(null==(__t=-1!=a.count?a.count:"")?"":__t)+"\n						</span>\n				</a>\n				",a.isNew&&a.isNew.value&&(__p+='\n				<span  class="item-new tu-dib tu-poa" data-name="new-tag" data-type='+__e(a.isNew.type)+"/>\n				"),__p+="\n			</li>\n			"}),__p+="\n				",moreArray&&moreArray.length&&(__p+='\n					<li class="more-tabs" data-name="more-tabs">\n						',moreArrayHasNew&&(__p+='\n						<span class="item-new item-new-more tu-dib tu-poa" data-name="item-new-more"></span>\n						'),__p+='\n						<span class="tu-icon-diot more-tabs-icon"></span>\n						<ul class="dropdown-list" data-name="dropdown-list">\n							',Talent._.map(moreArray,function(a,b){__p+='\n								<li class="tu-por '+(null==(__t=activeRouter==a.router?"active":"")?"":__t)+" "+(null==(__t=a.isAble?"is-able":"is-disable")?"":__t)+'" data-name="tab-item"\n								 data-router="'+(null==(__t=a.router)?"":__t)+'" >\n									<a data-trigger="false" href="'+(null==(__t=a.isAble&&isHash?a.url:"javascript:void(0)")?"":__t)+'">\n										'+(null==(__t=a.name)?"":__t)+"\n											<span data-flag='"+(null==(__t=a.router)?"":__t)+"'>\n												"+(null==(__t=-1!=a.count?a.count:"")?"":__t)+"\n											</span>\n									</a>\n									",a.isNew&&a.isNew.value&&(__p+='\n									<span class="item-new item-new-more-item tu-dib tu-poa"  data-name="new-tag"  data-type='+__e(a.isNew.type)+"</span>\n									"),__p+="\n								</li>\n								"}),__p+="\n						</ul>\n					</li>\n					"),__p+='\n	</ul>\n	<div class="tu-nav-content"></div>\n\n</div>';return __p;
},this.JST["work/detail/detail-head/project-time"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='	\n	<div class="project-time-inner '+(null==(__t=isEdit?"able-to-edit":"")?"":__t)+'">\n		<span class="label-title time-item" data-name="start-time">起止时间</span>\n\n		<span class="time_begin time-span time-item '+(null==(__t=2==status?"finished-time":"")?"":__t)+'" text-origion="何时开始">'+(null==(__t=startDate)?"":__t)+'</span> \n		<span class="time-split-img time-item '+(null==(__t=2==status?"finished-time":"")?"":__t)+'"></span> \n		<span class="time_end time-span time-item '+(null==(__t=2==status?"finished-time":"")?"":__t)+'" text-origion="何时结束">\n			',__p+=2==workType?"\n				长期\n			":"\n				"+(null==(__t=endDate)?"":__t)+"\n			",__p+="\n		</span>\n\n			",2==status?__p+='\n				<span class="time-item finished">已完成</span>\n			':(0!=expireDay||0!=isDeadLine)&&(__p+="\n				",__p+=1==isDeadLine?'\n					<span class="overdue time-item">已过期 <i class="count">'+(null==(__t=expireDay)?"":__t)+"</i> 天</span>\n				":'\n					<span class="time-expire time-item" href="javascript:;">剩余 <i class="count">'+(null==(__t=expireDay)?"":__t)+"</i> 天</span>\n				",__p+="\n			"),__p+="\n		",isEdit&&(__p+='\n			<span class=\'for-position time-item\'>\n				<span class="tu-icon-edit edit-able time-item" data-name="edit-able"></span>\n			</span>\n		'),__p+="\n	</div>\n";return __p},this.JST["work/detail/detail-head/project-user"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)WorkExternal?(__p+="\n	",__p+=isOpenExternal?'\n		<div class="externalAva"><div>外部</div><div>协作</div></div>\n	':'	\n		\n	<div data-name="user-info-edit" class="project-charge-img '+(null==(__t=editAble?"able-edit":"")?"":__t)+'">\n		'+(null==(__t=_.convertImage({className:"",src:iconBgImg,size:80,shape:"radius",name:principalName,bgColor:iconBgColor}))?"":__t)+"\n	</div>\n	",__p+="\n"):__p+='\n	<div data-name="user-info-edit" class="project-charge-img '+(null==(__t=editAble?"able-edit":"")?"":__t)+'">\n		'+(null==(__t=_.convertImage({className:"",src:iconBgImg,size:80,shape:"radius",name:principalName,bgColor:iconBgColor}))?"":__t)+"\n	</div>\n\n	",__p+="\n";return __p},this.JST["work/detail/detail-main/dynamic-composite"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div data-name="pubblog"></div>\n<div class="feed-search-container clearfix">\n	<div data-name="feed-search" class="feed-search">\n		<div class="feed-search-by-user tu-ft_m2 tu-vam tu-tac tu-font-a2" data-name="feed-search-by-user">\n		如需查找 ta 发布的 <a href="javascript:void(0);" data-name="search-by-user">点击这里</a>\n		</div>\n	</div>\n</div>\n<div data-name="feedlist"></div>';return __p},this.JST["work/detail/detail-main/external-member/external-composite"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)externalAddOrInvite&&(__p+='\n    <a href="javascript:void(0);" class="tu-btn tu-btn-mini tu-btn-add tu-icon-add tu-mb-10 tu-mt-20" data-name="add-member">\n    </a>\n<div class="money"  data-name="money-repay" data-body="如您邀请的“外部联系人”其所在公司购买了tita，我们将返给您订单额10%的佣金哦~"></div>\n'),__p+='\n<div class="external__in">\n    <div data-name="external__total" class="tu-font-h4">'+(null==(__t=workInExternalUser.roleName?workInExternalUser.roleName:"已加入")?"":__t)+' <span class="tu-font-h3 tu-ft_f4 external_inTotal">'+(null==(__t=workInExternalUser.total)?"":__t)+'</span></div>\n    <div data-name="external__member-box" class=" tu-clearfix  tu-mt-10 tu-mb-10">\n        ',_.each(workInExternalUser.users,function(a){__p+='\n            <span class="external__member-item tu-mb-20">\n                '+(null==(__t=_.convertImage({className:"external__member-img tu-fl tu-mr-5",src:a.avatar.Medium,size:50,name:a.name,bgColor:a.avatar.Color}))?"":__t)+'\n                <p  data-name="externalName" class="tu-font-a1 external__member-name" data-body="'+(null==(__t=a.mobile||a.email)?"":__t)+'">'+(null==(__t=_.substring(a.name,6,!0))?"":__t)+"</p>\n                ",externalDelete&&(__p+='       \n                    <div class="external__actions">\n                        <a href="javascript:void(0)" class="tu-font-a2 external__member-del" data-type="1" data-value="'+(null==(__t=a.userId)?"":__t)+'" data-name="delExternalUser">删除</a>\n                    </div>\n                '),__p+="\n            </span>\n        "}),__p+='\n    </div>\n</div>\n<div class="external__out">\n    <div data-name="external__total" class="tu-font-h4">'+(null==(__t=workOutExternalUser.roleName?workOutExternalUser.roleName:"待加入")?"":__t)+' <span  class="tu-font-h3 tu-ft_f4 external_outTotal">'+(null==(__t=workOutExternalUser.total)?"":__t)+"</span>\n        ",workOutExternalUser.users.length>0&&externalAddOrInvite&&(__p+='<span class="external__invite-all tu-ml-20" data-name="inviteAllAgain">一键再次邀请</span>'),__p+='\n    </div>\n    <div data-name="external__member-box" class=" tu-clearfix  tu-mt-10 tu-mb-10" >\n        ',_.each(workOutExternalUser.users,function(a,b){__p+='\n            <span class="external__member-item external__member-itemLong  tu-mb-20">\n                '+(null==(__t=_.convertImage({className:"tu-fl tu-mr-5",src:"//st-web.tita.com/titacn/tita/common/images/why_default.png",size:50,name:a.name}))?"":__t)+'\n                <p  data-name="externalName" class="tu-font-a1 external__member-name tu-mt-5" data-body="'+(null==(__t=a.userName)?"":__t)+'">'+(null==(__t=a.userName)?"":__t)+"</p>\n                ",externalDelete&&(__p+='      \n                    <div class="external__actions">\n                        <a href="javascript:void(0)" class="tu-font-a2 external__member-del" data-type="2"  data-value="'+(null==(__t=a.userName)?"":__t)+'" data-name="delExternalUser" data-index="'+(null==(__t=b)?"":__t)+'">删除</a> \n                        <a href="javascript:void(0)" class="tu-font-a2 tu-ml-10 external__member-invite" data-type="'+(null==(__t=a.type)?"":__t)+'" data-value="'+(null==(__t=a.userName)?"":__t)+'" data-name="inviteAgain">再次邀请</a> \n                    </div> \n                '),__p+="\n            </span>\n        "}),__p+="\n    </div>\n</div>\n";return __p},this.JST["work/detail/detail-main/external-member/external-empty"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div>\n    <div class="external__empty-img"></div>\n    <p class="external__empty-text tu-font-h4">'+(null==(__t=emptyHtml)?"":__t)+"</p>\n    ",__p+=externalAddOrInvite?'\n    <div class="external__empty-button" data-name="add-now">立即添加</div>\n    <div class="external__empty-bottom">\n        <div class="external__empty-bottom-redPacket tu-fl">\n            <div class="money-img" ></div>\n        </div>\n        <div class="external__empty-bottom-content tu-fl tu-font-a2 tu-ft_m3">\n            <span>外部联系人不占用企业名额，不限制人数；</span><br/>\n            <span>如您邀请的“外部联系人”，其所在公司购买了tita，我们将返给您订单额10%的佣金哦~</span>\n        </div>\n    </div>\n    ':'\n    <div class="external__empty-noRight tu-font-a2">(可以联系项目负责人添加ta)</div>\n    ',__p+="\n</div>";return __p},this.JST["work/detail/detail-main/extraMember/invite-QR"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<img src="'+(null==(__t=QRUrl)?"":__t)+'" width="180" height="180" class="tu-mb-20"/>\n<div class="QRInvite__hint_waring tu-ft_m3 tu-font-a2">（二维码和链接72小时内有效）</div>\n<div class="tu-mt-10 QRInvite__main">\n    <!-- <div data-name="QRInvite-input" class="QRInvite__input">'+(null==(__t=linkUrl)?"":__t)+'</div> -->\n    <input data-name="QRInvite-input" class="QRInvite__input" value="'+(null==(__t=linkUrl)?"":__t)+'" readonly/>\n    ',__p+="button"==btnType?'\n        <button class="tu-btn tu-btn-small tu-btn-sure" data-name="copyLink">复制链接</button>\n    ':"success"==btnType?'\n        <span class="tu-font-a1 tu-dib QRInvite__tip"><i class="tu-icon-check tu-icon-a1 tu-vam tu-pr-5"></i>复制成功</span>\n    ':'\n        <span class="tu-font-a1 tu-dib QRInvite__tip"><i class="tu-icon-warning tu-icon-a1 tu-vam tu-pr-5"></i>请选中链接后Ctrl+C直接复制</span>\n    ',__p+='\n    \n</div>\n<div class="QRInvite__hint">\n    <div>任何看到此二维码和链接的人都可加入此项目，请谨慎分享<span class="tu-dib tu-ml-5 icon-exclamation"></span></div>\n</div>\n';return __p},this.JST["work/detail/detail-main/extraMember/invite-hadInvited-composite"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="hadInvited__title">\n    <span>选择“已加入企业”的外部联系人：</span>\n    <a class="tu-vam tu-ft-hv_c3 tu-ml-10 tu-font-a2" href="javascript:void(0);" data-name="del-all">清除全部</a>\n</div>\n\n<ul class="tu-clearfix tu-ml-10 tu-mr-20">\n    <li class="tu-btn tu-btn-mini tu-btn-add tu-icon-add tu-fl tu-mt-20 tu-ml-20" data-name="add-member"></li>\n    <div data-name="member-container"></div>\n</ul>\n<div class="extraInvite__sure" >\n    <div class="tu-mb-20 tu-tac tu-ft_error tu-dn" data-name="ajax-tip">\n        <i class="tu-icon-warning tu-ft_error tu-vam tu-icon-a1 tu-mr-5"></i>\n        <span data-name="ajax-error"></span>\n    </div>\n    <button class="tu-btn tu-btn-larger tu-btn-sure extraInvite__btn" data-name="sure-btn">确定</button>\n</div>\n';return __p},this.JST["work/detail/detail-main/extraMember/invite-hadInvited-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<a data-body="删除 '+(null==(__t=name)?"":__t)+'" data-id="'+(null==(__t=id)?"":__t)+'" class="tu-icon-close hadInvited__item_del" href="javascript:;" data-name="del-item">\n</a>\n'+(null==(__t=_.convertImage({className:"radius_img30 img_hover",src:src,size:30,shape:"radius",name:name,bgColor:color}))?"":__t);return __p},this.JST["work/detail/detail-main/extraMember/invite-input"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="specialInput__left tu-fl">\n    <span class="'+(null==(__t=icon)?"":__t)+' tu-icon-a1 tu-ft_m2 tu-pl-15 tu-pr-20 tu-vam tu-dib"></span>\n    ',hasCode&&(__p+="\n        <span>+86</span>\n    "),__p+='\n</div>\n<div class="tu-input-default '+(null==(__t=hasCode?"paddingL_100":"paddingL_50")?"":__t)+'" data-name="input-container">\n    <label class="placeholder" for="'+(null==(__t=inputId)?"":__t)+'" data-name="placeholder">'+(null==(__t=inputLabel)?"":__t)+'</label>\n    <input type="text" id="'+(null==(__t=inputId)?"":__t)+'" data-name="input">\n    <div class="right-action tu-clearfix">\n        <span class="tu-icon-cross tu-dn" data-type="description" data-name="textarea-del" style="resize: none;" data-toggle="infotip" data-body="清除全部"></span>\n    </div>\n    <div class="error-tip" data-name="errorTip">'+(null==(__t=errorTip)?"":__t)+'</div>\n    <div class="errorExtra-tip" data-name="set-errorTip"></div>\n</div>';return __p},this.JST["work/detail/detail-main/extraMember/invite-main"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div data-name="modal-header tu-clearfix" class="tu-clearfix extraInvite__header">\n    <h3 class="extraInvite__header__title tu-fl">添加企业外部联系人</h3>\n    <div class="tu-icon-close tu-fr tu-cp tu-ft_m3 tu-ft-hv_c3 extraInvite__header__close" data-name="close-modal"></div>\n    <div class="extraInvite__header__vertical-line"></div>\n</div>\n\n<ul data-name="sidebar-area" class="extraInvite__sidebar tu-ft_m3 tu-clearfix tu-mb-10">\n    <li data-name="sidebar-item" data-type="phone" class="tu-font-a2 tu-cp tu-pr-10 extraInvite__sidebar-item extraInvite__sidebar_active">手机添加</li>\n    <li data-name="sidebar-item" data-type="mail" class="tu-font-a2 tu-cp tu-pr-10 extraInvite__sidebar-item ">邮箱添加</li>\n    <li data-name="sidebar-item" data-type="QRCode" class="tu-font-a2 tu-cp tu-pr-10 extraInvite__sidebar-item ">二维码邀请</li>\n    <!--<li data-name="sidebar-item" data-type="alreadyHas" class="tu-font-h5 tu-cp tu-pr-10 extraInvite__sidebar-item">添加已有账号</li>-->\n</ul>\n\n<div data-name="main-area"></div>';return __p},this.JST["work/detail/detail-main/extraMember/invite-phoneMail"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<div class="tu-font-a2 tu-tac tu-mt-20 tu-ft_m3">单次最多邀请4人，添加成功后，系统将自动生成“账号和密码”'+(null==(__t=invite)?"":__t)+'通知ta哦~</div>\n<div data-name="inputs"></div>\n<div class="extraInvite__sure">\n    <div class="tu-mb-20 tu-tac tu-ft_error tu-dn" data-name="ajax-tip">\n        <i class="tu-icon-warning tu-ft_error tu-vam tu-icon-a1 tu-mr-5"></i>\n        <span data-name="ajax-error"></span>\n    </div>\n    <button class="tu-btn tu-btn-larger tu-btn-sure extraInvite__btn" data-name="sure-btn">确定</button>\n</div>';return __p},this.JST["work/detail/detail-main/extraMember/invite-success"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="extraInvite__success__content">\n    <img width="140" height="140px" src="//xfile5.tita.com/ux/tita-web-v4/release/app/extras/images/inviteSuccss.png"/>\n    <div class="tu-icon-close tu-cp tu-ft_m3 tu-poa tu-ft-hv_c3 extraInvite__success__close" data-name="close-success-modal"></div>\n    <div class="tu-font-h4 tu-ft_m2 tu-mt-20 tu-mb-10">邀请成功！</div>\n    ',errorList&&errorList.length?(__p+='\n        <div class="tu-pt-10 tu-ft_m2">以下账号已停用，联系管理员启用账号后才能登录哦~</div>\n        <ul class="tu-ft_m3 tu-mt-20">\n            ',Talent._.each(errorList,function(a){__p+='\n                <li class="tu-mb-10">\n                    <span class="tu-dib tu-mr-10"><i class="tu-icon-Exclamation tu-pr-5"></i>'+(null==(__t=Talent._.substring(a.id,6,!0))?"":__t)+'</span>\n                    <span class="tu-dib tu-pl-20">'+(null==(__t=a.value)?"":__t)+"</span>\n                </li>\n            "}),__p+="\n        </ul>\n    "):__p+='\n    <div class=" tu-ft_m3">“账号和密码”已发送给ta啦~</div>\n    ',__p+="\n</div>";return __p},this.JST["work/detail/detail-main/member-layout"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='\n<!-- <div class="project-member">\n	<div data-name="apply-box"></div>\n</div> -->\n<div data-name="project-member"></div>\n<div data-name="follow-member"></div>	\n<div data-name="charge-member"></div>\n<div data-name="supervise-member"></div>';return __p},this.JST["work/detail/detail-main/project-apply"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)__p+="\n<!-- 立项-审批，驳回，撤销，完成项目 不可见-->\n<!-- \napplyState 1 审批进行中 3 驳回 4 撤销 -->\n",1!=applyState&&3!=applyState&&4!=applyState&&2!=status&&(__p+='\n<!-- <button class="tu-btn tu-btn-small tu-btn-sure project-apply__btn" data-name="project-apply-change">发起审批<i class="tu-icon-sort-down"></i></button> -->\n<div data-name="project-apply-minor" class=" project-apply-minor tu-mb-10"></div>\n'),__p+='\n<div class="project-apply__wrap" data-name="project-apply-wrap"></div>';return __p},this.JST["work/detail/detail-main/project-file"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="project-file__wrap" data-name="project-file-wrap"></div>';return __p},this.JST["work/detail/detail-main/project-message"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+="<!-- ",canEdit&&(__p+='\n<button class="tu-btn tu-btn-small tu-btn-sure update-btn" data-name="update">编辑</button>\n'),__p+=' -->\n<div class="message-containter__main">\n	<dl>\n		<div class="message-containter__item">\n			<dt class="item-title">名称</dt>\n			<dd class="item-content">\n				<p ',canEdit&&(__p+=' data-name="input-show" class="message-containter__item_show"'),__p+=' data-id="workName">\n					'+(null==(__t=workName)?"":__t)+"\n				</p>\n			",canEdit&&(__p+='\n				<div class="message-containter__item_edit tu-input-default" data-name="input-edit">\n					<input type="text" value="'+(null==(__t=workName)?"":__t)+'" data-name="input-handler" data-id="workName">\n				    <div class="right-action tu-clearfix">\n				        <span class="tu-icon-cross" data-name="del-all" data-id="workName" data-body="清除全部"></span>\n				    </div>\n				    <div class="message-containter__extra" data-name="input-extra">\n						<div class="error-tip" data-name="error-tip">您已输入 <span data-name="max-word"></span> 字，最多可输入 '+(null==(__t=maxWord.workName)?"":__t)+' 字</div>\n						<div class="message-containter__extra_btns">\n							<button class="tu-btn tu-btn-small " data-name="cancel" data-id="workName">取消</button>\n							<button class="tu-btn tu-btn-small tu-btn-sure" data-name="confirm" data-id="workName">确定</button>\n						</div>\n					</div>\n				</div>\n			'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item">\n			<dt class="item-title">分类</dt>\n			<dd class="editor-pencil item-content">\n				'+(null==(__t=lableName)?"":__t)+"\n				",canEdit&&(__p+='\n					<div class="tu-icon-edit tu-ml-10" data-name="lable-change" data-body="编辑"></div>\n				'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item">\n			<dt class="item-title">起止时间</dt>\n			<dd class="editor-pencil item-content">\n				',isLong?__p+="\n					<span>"+(null==(__t=startDate)?"":__t)+"</span> - <span>长期</span>\n				":startDate&&endDate&&!isLong&&(__p+="\n					<span>"+(null==(__t=startDate)?"":__t)+"</span> - <span>"+(null==(__t=endDate)?"":__t)+"</span>\n				"),__p+="\n				",canEdit&&(__p+='\n					<div class="tu-dib tu-ml-10" data-name="date-change">\n						<div class="tu-icon-edit tu-ml-10"  data-body="编辑"></div>\n					</div>\n				'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item">\n			<dt class="item-title">部门</dt>\n			<dd class="editor-pencil item-content">\n				',departmentId&&(__p+='\n					<div class="message-containter__item_dep '+(null==(__t=canEdit?"tu-bg-hv_m6":"tu-bg-hv_m8")?"":__t)+'">\n						<span>'+(null==(__t=departmentName)?"":__t)+"</span>\n						",canEdit&&(__p+='\n							<em class="tu-icon-cross" data-name="delete-dep"></em>\n						'),__p+="\n					</div>\n				"),__p+="\n				",canEdit&&(__p+='\n					<div class="tu-icon-edit tu-ml-10" data-name="department-change" data-body="编辑"></div>\n				'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item">\n			<dt class="item-title">私密性</dt>\n			<dd class="editor-pencil item-content">\n				',__p+=2==isVisible?"\n					私密（仅项目相关人员可见）\n				":"\n					公开 (所有人可见)\n				",__p+="	\n				",canEdit&&(__p+='\n					<div class="tu-icon-edit tu-ml-10" data-name="visible-change" data-body="编辑"></div>\n				'),__p+='\n			</dd>\n		</div>\n		<div class="message-containter__item message-containter__hover">\n			<dt class="item-title">目标</dt>\n				<dd class="item-content">\n						',description?(__p+='\n							<p class="message-containter__item_show message-containter__description ',description&&canEdit||(__p+="message-containter__item_noborder"),__p+='" ',canEdit&&(__p+=' data-name="input-show" '),__p+='  data-id="description">'+(null==(__t=description)?"":__t)+"</p>\n						"):canEdit&&(__p+='\n							<p class="message-containter__item_show ',description||(__p+="message-containter__item_noborder"),__p+='" ',canEdit&&(__p+=' data-name="input-show" '),__p+='  data-id="description">\n								<a href="javascript:void(0)">添加目标</a>\n							</p>\n						'),__p+="\n				",canEdit&&(__p+='\n					<div class="message-containter__item_edit tu-input-default" data-name="input-edit">\n						<textarea type="text" class="tu-scroll textarea" autocomplete="off" style="resize:none;max-height:120px;" data-name="input-handler" data-id="description"></textarea>\n					    <div class="right-action tu-clearfix">\n					        <span class="tu-icon-cross" data-name="del-all" data-id="description" data-body="清除全部"></span>\n					    </div>\n					    <div class="message-containter__extra" data-name="input-extra">\n							<div class="error-tip" data-name="error-tip">您已输入 <span data-name="max-word"></span> 字，最多可输入 '+(null==(__t=maxWord.description)?"":__t)+' 字</div>\n							<div class="message-containter__extra_btns">\n								<button class="tu-btn tu-btn-small " data-name="cancel" data-id="description">取消</button>\n								<button class="tu-btn tu-btn-small tu-btn-sure" data-name="confirm" data-id="description">确定</button>\n							</div>\n						</div>\n					</div>\n				'),__p+='\n				</dd>\n		</div>\n		<!--<div class="message-containter__item">-->\n				<!--<dt class="item-title">外部联系人</dt>-->\n				<!--<dd class="item-content">-->\n					<!--<div class="tu-dib switch-component tu-cp tu-dib tu-clearfix switch-component_'+(null==(__t=isOpenExternal?"on":"off")?"":__t)+" "+(null==(__t=canEdit?"":"disabled")?"":__t)+'" data-name="switch-button">-->\n							<!--<div class="switch-component__button switch-component__button_'+(null==(__t=isOpenExternal?"on":"off")?"":__t)+" tu-"+__e(isOpenExternal?"fr":"fl")+'" data-name="switch-button-radio"></div>-->\n					<!--</div>-->\n					<!--<span class="tu-font-a2 tu-ft_m3">开启后，可在项目中的“外部联系人”模块邀请企业外部协作者加入<a class="tu-ml-10" target="_blank" href="https://blog.tita.com/project-external-member/">了解详情</a></span>-->\n				<!--</dd>-->\n		<!--</div>-->\n		<div class="message-containter__item ">\n				<dt class="item-title tu-vam">附件</dt>\n			\n			<dd class="item-content tu-vam">\n				<div data-name="project-file" class="tu-dib '+(null==(__t=canEdit?"":"tu-pt-20")?"":__t)+'">\n					\n				</div>\n				',canEdit&&(__p+='\n					<div class="tu-ft_m3 tu-font-a2 tu-dib tu-poa" style="top:0;left:50px;">（请上传不超过50MB大小的文件，最多可上传9个）</div>\n				'),__p+="\n				</dd>\n		</div>\n	</dl>\n	\n</div>\n";return __p},this.JST["work/detail/detail-main/project-progress-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="progress-item-containter">\n	<dt class="progress-time">'+(null==(__t=Talent.Context.subString(createTime,10,!1))?"":__t)+'</dt>\n	<dt class="dot"></dt>\n	<dt class="progress-tip">\n		<div class="progress-content">\n			<div class="progress-persent ',workProgress.length>3&&(__p+="size-small"),__p+='">'+(null==(__t=workProgress)?"":__t)+'</div>\n			<p class="progress-description">'+(null==(__t=workProgressDescription)?"":__t)+'</p>\n		</div>\n		<div class="arrow left" style="display: inherit;"></div>\n	</dt>\n</div>';return __p},this.JST["work/detail/detail-main/project-progress"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)canEdit&&(__p+='\n<button class="tu-btn tu-btn-small tu-btn-sure update-btn" data-name="update">更新项目进度</button>\n'),__p+='\n<div class="show-more">\n	<a  data-name="show-more"></a>\n</div>\n<div class="progress-composite" data-name="progresses">\n	<div data-name=\'empty\'></div>\n	<dl class="progresses">\n	</dl>\n</div>\n<div class="communicate" data-name="communicate">\n\n</div>';return __p},this.JST["work/detail/detail-main/statistics"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)IsEmpty&&(__p+='\n<div class="title"><span>统计</span>  截止于'+(null==(__t=date)?"":__t)+'</div>\n<div class="taskchart">\n	<div class="right_tc">\n		<dl>\n			<dt><i>任务总数</i><span class="num">'+(null==(__t=Pandect.TaskTotal)?"":__t)+'</span></dt>\n			<dd><i>未完成</i><span class="num">'+(null==(__t=Pandect.UndoneTotal)?"":__t)+'</span></dd>\n			<dd><i>已完成</i><span class="num">'+(null==(__t=Pandect.DoneTotal)?"":__t)+'</span></dd>\n		</dl>\n	</div>\n	<div class="left_tc">\n		<h3>任务进展情况总览<span>（完成率    <b>'+(null==(__t=Pandect.CompletionRate)?"":__t)+'%</b>）</span></h3>\n		<div data-name="task-chart"></div>\n	</div>\n	\n</div>\n<div class="personchart">\n	<h3>按负责人统计任务进展状况</h3>\n	<div class="intro_pc">\n		<div class="left_pc">\n			<span class="right_pc">\n				<b></b>已完成\n				<b class="unfinished"></b>未完成\n			</span>\n			柱状图后的数字:（完成数/总数）\n		\n		</div>\n	</div>\n	<div class="chart_pc" data-name="person-chart">\n		\n	</div>\n	\n</div>\n<div class="milepost__chart-container">\n	<div class="legend-info">\n		<span class="legend-tip tu-icon-wiki">图例说明</span>\n	</div>\n	<div data-name="milepostChart">\n		\n	</div>\n</div>\n\n<div class="totalchart">\n	<table>\n		<thead>\n			<tr>\n				<th>人员</th>\n				<th>负责总数</th>\n				<th>已完成</th>\n				<th>完成率</th>\n				<th>评分<a class="icon-help" href="http://blog.tita.com/?p=1077" original-title="什么是评分" target="_blank" ></a></th>\n			</tr>\n		</thead>\n		<tbody>\n			',_.each(StaffProgress,function(a){__p+="\n			<tr>\n				<td>"+(null==(__t=a.PrincipalUser.Name)?"":__t)+"</td>\n				<td>"+(null==(__t=a.TaskTotal)?"":__t)+"</td>\n				<td>"+(null==(__t=a.TaskDone)?"":__t)+"</td>\n				<td>\n					",__p+=0!=a.TaskDoneRate?'\n					<div class="pb_tc">\n						\n						<div class="progressbar"><span style="width:'+(null==(__t=a.TaskDoneRate)?"":__t)+'"></span></div>\n						<span class="num">'+(null==(__t=a.TaskDoneRate)?"":__t)+"</span>\n					</div>\n					":"\n					--\n					",__p+="\n				</td>\n				<td>",__p+="0"!=a.TaskScore?"\n					"+(null==(__t=a.TaskScore)?"":__t)+"\n					":"\n					--\n					",__p+="</td>\n			</tr>\n			"}),__p+="\n		</tbody>\n	</table>\n</div>\n"),__p+="\n<br/><br/><br/>\n\n";return __p},this.JST["work/detail/detail-main/task"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)mileTotal>0&&(__p+='\n<div class="mile-task-tab" data-name="mile-task-tab"></div>\n'),__p+='\n<div class="task-wraper">\n	<div class="task-create" data-name="create"></div>\n	<div class="task-filter" >\n		<div data-name="task-data-filter" ></div>\n		<div class="task-filter__btns" data-name="task-right-btns">\n			\n			<button class="tu-icon-search tu-btn tu-btn-small tu-mr-5 task-filter__btns_style" data-body="搜索" data-name="task-filter-search"></button>\n			',showLotSizeD&&(__p+='\n				<button class="tu-icon-lines---pencil tu-btn tu-btn-small task-filter__btns_style" data-body="批量编辑任务" data-name="lot-size-handler"></button>\n			'),__p+='\n			<a href="'+(null==(__t=exportGanttHref)?"":__t)+'" class="tu-ft-hv_m1 tu-ft_m1  tu-btn tu-btn-small tu-ml-5" data-body="导出任务">\n					导出\n			</a>\n		</div>\n		<div class="task-filter__search tu-dn" data-name="search-area"></div>\n	</div>\n	<div class="task-list-container" data-name="task-list"></div>\n	<div data-name="pagination"></div>\n</div>\n\n';return __p},this.JST["work/detail/detail-main/work-mile-no-class-item"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="principle" data-id="0">\n	<span class="radius_img50" style="background-color:#c5c5c5;">其他</span>\n</div>\n<div class="milepost-item-tt">\n	<span class="icon-left icon-dark-angle-left"></span>\n	<div class="milepost-left">\n		<span class="no-class">未设置里程碑的其他任务</span>\n	</div>\n	<div class="milepost-right">\n		<span class="operate" original-title="操作">\n			<span class="icon icon-arrow-down-2t"></span>\n		</span>\n		<div class="operate-btns">\n			<span class="item" data-name="transfer">转移任务</span>\n		</div>\n	</div>\n</div>\n<div class="sub-container-wraper">\n	<div class="sub-container">\n\n	</div>\n	<span class="packup" data-name="packup">完成转移</span>\n</div>\n\n';return __p},this.JST["work/detail/detail-main/work-mile-task-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape;with(obj)__p+='<span class="mile-task-right">\n	<span class="date">'+(null==(__t=endDate)?"":__t)+'</span>\n	<span class="name">'+(null==(__t=Context.subString(principalUser.Name,6,!0))?"":__t)+'</span>\n	<span class="transfer-task" data-name="transfer-task" task-id="'+(null==(__t=feedId)?"":__t)+'">转移任务</span>\n</span>\n<span class="mile-task-left">\n	'+(null==(__t=taskName)?"":__t)+"\n</span>\n";return __p},this.JST["work/detail/detail-main/work-milepost-composite"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="milepost-create" data-name="create"></div>\n<div class="milepost-container">\n\n</div>\n',__p+='\n<div class="no-class-item">\n	\n</div>\n',__p+="\n\n\n";return __p},this.JST["work/detail/detail-main/work-milepost-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="principle '+(null==(__t=editable?"cursor":"")?"":__t)+'" data-name="principle" data-id="'+(null==(__t=mileStoneId)?"":__t)+'">\n	'+(null==(__t=_.convertImage({className:"icon",src:user.Avatar.Medium,size:50,shape:"radius",name:user.Name,bgColor:user.Avatar.Color}))?"":__t)+"\n	",isLast||(__p+='\n		<span class="icon-dot-top"></span>\n	'),__p+="\n	\n</div>\n",isLast||(__p+='\n	<span class="border-left"></span>\n'),__p+='\n<div class="milepost-item-tt">\n	<span class="sortNum '+(null==(__t=isWarn?"warn":"")?"":__t)+'">'+(null==(__t=index+1)?"":__t)+'</span>\n	<span class="icon-left icon-'+(null==(__t=2==status?"blue":"dark")?"":__t)+'-angle-left"></span>\n	<div class="milepost-right">\n		<span class="status">\n			',1==status?__p+="\n				<strong>未开始</strong>\n			":2==status?__p+='\n				<span class="ing">剩余<span class="num">'+(null==(__t=remainingDays)?"":__t)+"</span>天</span>\n			":3==status?__p+='\n				<span class="warn"><strong>已过期</strong></span>\n			':4==status&&(__p+="\n				<strong>已完成</strong>\n			"),__p+="\n		</span>\n		",__p+=editable?'\n		<span original-title="修改起止时间" data-name="date" class="date cursor '+(null==(__t=isWarn?"warn":"")?"":__t)+'">\n			('+(null==(__t=startDate)?"":__t)+"-"+(null==(__t=endDate)?"":__t)+")\n		</span>\n		":'\n		<span class="date '+(null==(__t=isWarn?"warn":"")?"":__t)+'">\n			('+(null==(__t=startDate)?"":__t)+"-"+(null==(__t=endDate)?"":__t)+")\n		</span>\n\n		",__p+="\n		",transferable&&(__p+='\n		<span class="operate" original-title="操作">\n			<span class="icon icon-arrow-down-2t"></span>\n		</span>\n		'),__p+='\n		<div class="operate-btns">\n			<span class="item" data-name="transfer">转移任务</span>\n			',editable&&(__p+='<span class="item" data-name="deleted">删除里程碑</span>'),__p+='\n		</div>\n	</div>\n	<div class="milepost-left">\n		',__p+=editable?'\n			<textarea original-title="修改名称"  style="resize:none;" class="input_container '+(null==(__t=isWarn?"warn":"")?"":__t)+'">'+(null==(__t=mileStoneName)?"":__t)+"</textarea>\n		":'\n			<span class="name '+(null==(__t=isWarn?"warn":"")?"":__t)+'"><strong>'+(null==(__t=mileStoneName)?"":__t)+"</strong></span>\n		",__p+='\n		\n		<div class="project_btn_group">\n			<a class="btn_blue " href="javascript:;">确定</a>\n			<a class="btn_white " href="javascript:;">取消</a>\n		</div>\n		',__p+=taskTotal>0?'\n			<div class="percent">\n				完成度： <span class="num">\n				'+(null==(__t=finishTaskTotal)?"":__t)+"/"+(null==(__t=taskTotal)?"":__t)+"(<strong>"+(null==(__t=Number((100*finishTaskTotal/taskTotal).toFixed(1)))?"":__t)+"%</strong>)\n			</span>	\n			</div>\n		":'\n			<div class="noTask">暂无任务</div>\n		',__p+='\n			\n	</div>\n	\n</div>\n<div class="sub-container-wraper">\n	<div class="sub-container">\n\n	</div>\n	<span class="packup" data-name="packup">完成转移</span>\n</div>\n\n';return __p},this.JST["work/detail/member/member-list-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='\n<a href="'+(null==(__t=Talent.Context.getUserUrl(userId))?"":__t)+' " class="item-avatar">\n	'+(null==(__t=_.convertImage({className:"project_member_item_img",src:avatar.medium,size:50,name:name,bgColor:avatar.color}))?"":__t)+"\n	",0==jobState&&(__p+="\n		<span class='is-leave'></span>\n	"),__p+='\n</a>\n\n<div class="item-cont tu-clearfix">\n	<span class="item-name">'+(null==(__t=shortName)?"":__t)+"</span><br/>\n	",isDelete&&(__p+='\n		<a href="javascript:void(0);" class="item-del" data-name="member-del" id="'+(null==(__t=userId)?"":__t)+'">删除</a>\n	'),__p+="\n</div>\n\n";return __p},this.JST["work/detail/member/member-list"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)showTitle&&(__p+='\n	<div class="title-pm">\n		'+(null==(__t=title)?"":__t)+'\n		<span class="num-pm" data-name="member-num">'+(null==(__t=total?total:"")?"":__t)+"</span>\n	</div>\n"),__p+='	\n<div class="member-list tu-clearfix ',isAdd||(__p+="add-disabled"),__p+='" data-name="user-list-box">\n	',isAdd&&(__p+='\n		<a \n			href="javascript:void(0);" \n			class="tu-btn tu-btn-mini tu-btn-add tu-icon-add add-pm" \n			data-name="button-add">\n		</a>\n	'),__p+='\n	<ul class="tu-clearfix" data-name="user-list">\n		',total>50&&(__p+='\n			<li class="item-member more-pm">\n				<a href="javascript:void(0);" class="tu-icon-diot more-ico" data-name="more"></a>\n				<a href="javascript:void(0);" class="more-text" data-name="more">显示更多</a>\n			</li>\n		'),
__p+="\n	</ul>\n</div>\n";return __p},this.JST["work/detail/member/special-member-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)(isShowPrincipal||isShowApply)&&(__p+="	\n	",isShowApply&&(__p+='\n		<div class="title-pm">审批人</div> \n	'),__p+='\n		<div class="item-member tu-clearfix">\n			<a href="'+(null==(__t=Talent.Context.getUserUrl(userId))?"":__t)+'" class="item-avatar">\n				'+(null==(__t=_.convertImage({className:"project_member_item_img",src:avatar.Medium,size:50,name:name,bgColor:avatar.Color}))?"":__t)+"\n				",0==jobState&&(__p+="\n					<span class='is-leave'></span>\n				"),__p+='\n			</a>\n			\n			<div class="item-cont tu-clearfix">\n				<span class="item-name">'+(null==(__t=shortName)?"":__t),remark&&""!=remark&&(__p+="（负责人）"),__p+="</span><br>\n				",isChange&&(__p+='\n				<a href="javascript:void(0);"  class="item-del" data-name="member-change" id="'+(null==(__t=userId)?"":__t)+'">转交</a>\n			'),__p+="\n		</div>\n	</div>\n"),__p+="\n";return __p},this.JST["work/detail/project-detail-layout"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)__p+='<div id="project_detail_head_container"></div>\r\n<div id="project_detail_tab_container" data-name="project-detail-top"></div>\r\n<div id="project_detail_container">\r\n	',WorkExternal&&(__p+='\r\n		<div class="external__yellow-tip tu-font-a2 tu-pt-5 tu-pb-5 tu-tac tu-dn" data-name="yellowTip">企业外部联系人加入后，可以查看项目下 全部任务、动态、文件及项目成员，请注意您的信息保密！\r\n				<a href="https://blog.tita.com/project-external-member/" target="_blank">了解详情</a>\r\n			</div>\r\n	'),__p+='\r\n	<div class="project_detail_content" id="project_detail_region">\r\n		<div class="_tt_loading_m">努力加载中…</div>\r\n	</div>\r\n</div>';return __p},this.JST["work/implementation/index-page"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='\n<div class="tu-col-3"  data-tu-submenu="tu-submenu">\n	<div class="tu-col-container tt_side_subnav_wrap tt_staff_subnav">\n        <ul class="subtab_ssw">\n            <li class="active"><a href="#work/implementation?page_type=group" data-trigger="false"><span>团队</span></a></li>\n            <li><a href="#work/implementation?page_type=organ" data-trigger="false"><span>组织</span></a></li>\n        </ul>\n		<div data-name="side-bar" class="side_bar"></div>\n    </div>	\n </div>\n\n<!-- side sub nav end -->\n<div  class="work-container tu-col-13">\n	<div class="tu-col-container tt-project-implamentation">\n		<div class="tt_page_report_container">\n			<div class="report-title">\n				<span class="title-page">项目执行情况</span>\n				<a href="#work" class="back-list">返回项目列表</a>\n			</div>\n			<div class="report_container"  data-name="report-container"></div>\n		</div>\n	</div>	\n</div>\n	';return __p},this.JST["work/implementation/report-legend-tip"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<ul class="legend-list">\n    <li>\n        <div class="legend-border">\n            <div class="legend-1">&nbsp;</div>\n        </div>未完成-延期</li>\n    <li>\n        <div class="legend-border">\n            <div class="legend-2">&nbsp;</div>\n        </div>未完成-当前</li>\n    <li>\n        <div class="legend-border">\n            <div class="legend-3">&nbsp;</div>\n        </div>已完成-按期</li>\n    <li>\n        <div class="legend-border">\n            <div class="legend-4">&nbsp;</div>\n        </div>已完成-延期</li>\n    <li>\n        <div class="legend-border">\n            <div class="legend-5">&nbsp;</div>\n        </div>未开始</li>\n</ul>\n';return __p},this.JST["work/implementation/report-list-sidebar"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<ul class="_tt_side_subnav">            \n    <li><a href="#work/implementation?page_type=group&sidebar_type=myself" data-trigger="false">我自己</a></li>\n    <li><a href="#work/implementation?page_type=group&sidebar_type=mysub" data-trigger="false">我的团队</a></li>\n</ul>';return __p},this.JST["work/implementation/report-work-composite"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="report-work-list">\n</div>\n<div class="showmore" data-name="show-more">\n<a href="javascript:void(0);" >\n	<span>查看更多</span>\n</a>\n</div>';return __p},this.JST["work/implementation/report-work-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+='<div class="panel-title">\n	<div class="panel-name"><a href="#work?work_id='+__e(workId)+"&app_id=1&app_type=1&to_user_id="+__e(principalUser.UserId)+'">'+__e(workName)+'</a></div>\n	<div class="panel-master">\n		<span class="master-name">负责人：<span class="name">'+__e(principalUser.Name)+'</span></span>\n		<span class="master-photo">\n			',__p+=principalUser.Avatar.HasAvatar?'\n				<img src="'+__e(principalUser.Avatar.Small)+'" alt="'+__e(principalUser.Name)+'" />\n			':"\n				"+(null==(__t=_.convertImage({className:"",size:30,shape:"radius",name:principalUser.Name,bgColor:principalUser.Avatar.Color}))?"":__t)+"\n			",__p+='\n		</span>\n	</div>\n</div>\n<div class="panel-container">\n	<div class="milepost-list">\n		<div class="switch-milepost prev">\n			',showPrev&&(__p+='\n			<span class="icon-arrow-left"></span>\n			'),__p+='\n		</div>\n		<div class="switch-milepost next">\n			',showNext&&(__p+='\n			<span class="icon-arrow-right"></span>\n			'),__p+='\n		</div>\n		<ul class="list-milepost">\n			',_.each(workMileStones,function(a,b){b>=showFromIndex&&b<=showToIndex&&(__p+='\n				<li class="chart-milepost-item">\n					',__p+=1==a.status?'\n						<div class="milepost-name unstart" origin-title="'+__e(a.workMileStoneName)+'">\n							'+__e(a.workMileStoneName)+"\n						</div>\n					":4==a.status||5==a.status?'\n						<div class="milepost-name finished" origin-title="'+__e(a.workMileStoneName)+'">\n							'+__e(a.workMileStoneName)+"\n						</div>\n					":'\n					    <div class="milepost-name" origin-title="'+__e(a.workMileStoneName)+'">\n							'+__e(a.workMileStoneName)+"\n						</div>\n					",__p+='\n					<div class="milepost-status status-'+__e(a.status)+'">\n					  ',__p+=2==a.status||3==a.status?'\n						完成率:<span class="complete-rate">'+__e(Math.round(100*(a.finishTaskOnTimeTotal+a.finishTaskDelayTotal)/(a.taskTotal||1)))+"%</span>\n					  ":"\n					  "+__e(statusValue[a.status])+"\n					  ",__p+='\n					  <div class="milepost-time">\n						'+__e(a.startDate.replace(currentYear+"/",""))+"-"+__e(a.endDate.replace(currentYear+"/",""))+"\n					  </div>\n					</div>\n					",viewChart&&(__p+='\n						<div class="chart-item">\n							',1==a.status?__p+='\n								<div class="mile-chart">\n								  <img src="'+(null==(__t=Talent.Context.getStaticUrl("images/milepost-unstart.png"))?"":__t)+'" />\n							    </div>\n							    <ul class="chart-data-list">\n									<li class="chart-data-item">	\n									    <div class="task-value">'+__e(a.taskTotal)+'</div>\n									    <div class="task-label">未完成</div>\n									</li>\n								</ul>\n						    ':(__p+='\n						    <div class="mile-chart" data-index="'+__e(b)+'">\n							\n						    </div>\n						    <ul class="chart-data-list">\n								',0!=a.taskTotal&&(__p+="\n									",(0!=a.unfinishTaskDelayTotal||0!=a.unfinishTaskOnTimeTotal)&&(__p+='\n										<li class="chart-data-item">	\n										    <div class="task-value"><span class="task-count">'+__e(a.unfinishTaskDelayTotal+a.unfinishTaskOnTimeTotal)+'</span>(<span class="delay-color">'+__e(a.unfinishTaskDelayTotal)+"</span>/"+__e(a.unfinishTaskOnTimeTotal)+')</div>\n										    <div class="task-label">未完成(延期/按期)</div>\n										</li>\n									 '),__p+="\n									 ",(0!=a.finishTaskDelayTotal||0!=a.finishTaskOnTimeTotal)&&(__p+='\n										<li class="chart-data-item">	\n										    <div class="task-value"><span class="task-count">'+__e(a.finishTaskDelayTotal+a.finishTaskOnTimeTotal)+'</span>(<span class="delay-color">'+__e(a.finishTaskDelayTotal)+"</span>/"+__e(a.finishTaskOnTimeTotal)+')</div>\n										    <div class="task-label">已完成(延期/按期)</div>\n										</li>\n									 '),__p+="\n								"),__p+='\n								<li class="chart-data-item">	\n								    <div class="task-value"><span class="task-count">'+__e(a.evaluateScore)+"</span>("+__e(a.evaluatePercent)+')</div>\n								    <div class="task-label">质量均分</div>\n								</li>\n							</ul>\n						    '),__p+="\n						</div>\n					"),__p+="\n				</li>\n			")}),__p+='\n		</ul>\n	</div>\n	\n	<div class="show-detail">\n		',__p+=viewChart?'\n		<a href="javascript:void(0)" class="show-more">收起详情<span class="icon tu-icon-arrow-up tu-icon-a1"></span></a>\n		':'\n		<a href="javascript:void(0)" class="show-more">展开详情<span class="icon tu-icon-arrow-down tu-icon-a1"></span></a>\n		',__p+="\n	</div>\n</div>";return __p},this.JST["work/implementation/report-work"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="search-condition">\n	<div data-name="report-filter-component"></div>\n	<div class="report_label">\n		<a class="btn btn-sure" data-name="work-chart" href="javascript:void(0);">生成项目执行图表</a>\n		<a class="btn btn-sure" data-name="work-gant" href="javascript:void(0);" >生成项目甘特图</a>\n	</div>\n</div>\n<div class="legend-info" style="display: none">\n	<span class="legend-tip">图例说明？</span>\n</div>\n<div data-name="report-chart" class="report_chart_container">\n</div>\n';return __p},this.JST["work/index-page"]=function(obj){obj||(obj={});var __p="";_.escape,Array.prototype.join;with(obj)__p+='<!-- side sub nav -->\n<!-- <div class="tu-col-3" data-tu-submenu="tu-submenu">\n	<div class="tu-col-container"  id="work_left_view"></div>\n</div> -->\n<div class="_tt_layout_tabnav tt_staff_sidebar tu-col-3" data-tu-submenu="tu-submenu">\n	<div class="tt_side_subnav_wrap tt_staff_subnav">\n		',openGoal&&(__p+='\n        <div class="subtab_ssw">\n            <li class="active1"><a href="#work?workType=1" data-trigger="false"><span>项目</span></a></li>\n            <li><a href="#work?workType=6" data-trigger="false"><span>目标</span></a></li>\n		</div>\n		'),__p+='\n		<div data-name="side-bar" class="tu-col-container" id="work_left_view"></div>\n    </div>	\n</div>\n<!-- side sub nav end -->\n<div  class="work-container tu-col-13">\n	<div class="tu-col-container"  id="work_main_region">\n		<div class="_tt_loading_m" >努力加载中…</div>	\n	</div>	\n</div>\n<div class="tt_plan_detail_container">\n	\n</div>';return __p},this.JST["work/project-list/approve/approve-record-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)__p+='\n<div class="left" data-name="left">\n	<div class="apply-start"></div>\n	<div class="apply-tree"></div>\n	<div class="apply-status ',2==applyState?__p+="apply_ok":3==applyState&&(__p+="apply_reject"),__p+='"></div>\n</div>\n<div class="right" data-name="right">\n	<div class="apply-message">\n		<div class="time-item">'+(null==(__t=createTime)?"":__t)+'</div>\n		<div class="message-item">\n			<dl>\n				<div class="tu-clearfix">\n					<dt class="item-name">'+(null==(__t=_.substring(addWorkUserName,8,!0))?"":__t)+':</dt>					\n					<dd class="item-context">创建了 ',__p+=2==addWorkIsVisible?"私密项目":"公开项目",__p+=' \n					<a href="'+(null==(__t=href)?"":__t)+'" target="_blank"> '+__e(workName)+'</a></dd>\n				</div>\n				<div class="tu-clearfix">\n					<dt class="item-name">起止时间:</dt>				\n					<dd class="item-context">'+(null==(__t=addWorkStartDate)?"":__t)+" - "+(null==(__t=addWorkEndDate)?"":__t)+"</dd>\n				</div>\n				",addWorkDepartmentName&&(__p+='\n				<div class="tu-clearfix">\n					<dt class="item-name">所属部门:</dt>				\n					<dd class="item-context">'+(null==(__t=addWorkDepartmentName)?"":__t)+"</dd>\n				</div>\n				"),__p+="\n				",workRoles&&(__p+="\n					",_.each(workRoles.workRoleList,function(a){__p+='\n					<div class="tu-clearfix">\n						<dt class="item-name">'+(null==(__t=a.roleName)?"":__t)+':</dt>					\n						<dd class="item-context">'+(null==(__t=a.userList)?"":__t)+"</dd>\n					</div>\n					"}),__p+="\n				"),__p+="\n				",addWorkDescription&&(__p+='\n				<div class="tu-clearfix">\n					<dt class="item-name">项目目标:</dt>					\n					<dd class="item-context workDescription">'+(null==(__t=addWorkDescription)?"":__t)+"</dd>\n				</div>\n				"),__p+='\n			</dl>\n\n		</div>\n	</div>\n	<div class="state-message">\n		<div class="time-item">'+(null==(__t=applyDate)?"":__t)+'</div>\n		<div class="message-item">\n			<dl>\n				<div class="tu-clearfix">\n					<dt class="item-name">'+(null==(__t=_.substring(applyUser.name,8,!0))?"":__t)+":</dt>	\n					",2==applyState?__p+='\n					<dd class="item-context">同意了项目</dd>\n					':3==applyState&&(__p+='\n					<dd class="item-context">驳回了项目</dd>\n					'),__p+="			\n				</div>\n				",applyDescription&&(__p+='\n				<div class="tu-clearfix">\n					<dt class="item-name">驳回理由:</dt>				\n					<dd class="item-context">'+(null==(__t=applyDescription)?"":__t)+"</dd>\n				</div>\n				"),__p+="\n			</dl>\n		</div>\n	</div>\n</div>\n";return __p},this.JST["work/project-list/approve/approve-record"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="search-area" data-name="search-area">\n	<a href="javascript:void(0)" data-name="state-btn">\n		<span data-name="state-text">已同意</span>\n		<span class="icon tu-icon-sort-down"></span>\n	</a>\n</div>\n<div class="records-area" data-name="records-area"></div>\n<div data-name="pagination"></div>';return __p},this.JST["work/project-list/approve/approve-reject-view"]=function(obj){obj||(obj={});var __p="";_.escape;with(obj)__p+='<div class="tu-input-default" data-name="input-containter">\n	<label class="placeholder" for="q">为什么驳回？告诉ta</label>\n	<textarea id="q" class="tu-scroll textarea" data-name="reject-input" style="resize:none;max-height:120px;line-height:24px;"></textarea>\n	<div class="right-action tu-clearfix">\n		<span class="tu-icon-cross" data-name="delAll"></span>\n	</div>\n	<div class="error-tip">已输入 <span data-name="over"></span> 字，最多可输入 5000 字</div>\n</div>\n<div class="button-area">\n	<button class="tu-btn tu-btn-small" data-name="cancel">取消</button>\n	<button class="tu-btn tu-btn-small tu-btn-sure submit " data-name="submit">确定</button>\n</div>';return __p},this.JST["work/project-list/approve/approve-todo-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)userNow&&(__p+="\n	",__p+=done?'\n		<span class="tu-icon-check-active checked" data-status="'+(null==(__t=done)?"":__t)+'" data-name="checked"></span>\n	':' \n		<span class="tu-icon-checkbox-have checked" data-status="'+(null==(__t=done)?"":__t)+'" data-name="checked"></span>\n	',__p+="\n"),__p+='\n<div class="approval-time">\n	<span class="date">'+(null==(__t=createTime)?"":__t)+'</span>\n</div>\n<dl class="approval-list-details">\n	<div class="tu-clearfix">\n		<dt class="item-name">'+(null==(__t=_.substring(addWorkUserName,8,!0))?"":__t)+':</dt>					\n		<dd class="item-context">创建了 ',__p+=2==addWorkIsVisible?"私密项目":"公开项目",__p+=' \n		<a href="'+(null==(__t=href)?"":__t)+'" target="_blank"> '+__e(workName)+'</a></dd>\n	</div>\n	<div class="tu-clearfix">\n		<dt class="item-name">起止时间:</dt>				\n		<dd class="item-context">'+(null==(__t=addWorkStartDate)?"":__t)+" - "+(null==(__t=addWorkEndDate)?"":__t)+"</dd>\n	</div>\n	",addWorkDepartmentName&&(__p+='\n	<div class="tu-clearfix">\n		<dt class="item-name">所属部门:</dt>				\n		<dd class="item-context">'+(null==(__t=addWorkDepartmentName)?"":__t)+"</dd>\n	</div>\n	"),__p+="\n	",workRoles&&(__p+="\n		",_.each(workRoles.workRoleList,function(a){__p+='\n			<div class="tu-clearfix">\n				<dt class="item-name">'+(null==(__t=a.roleName)?"":__t)+':</dt>					\n				<dd class="item-context">'+(null==(__t=a.userList)?"":__t)+"</dd>\n			</div>\n		"}),__p+="\n	"),__p+="\n	",addWorkDescription&&(__p+='\n	<div class="tu-clearfix">\n		<dt class="item-name">项目目标:</dt>					\n		<dd class="item-context workDescription">'+__e(addWorkDescription)+"</dd>\n	</div>\n	"),__p+="\n</dl>\n";return __p},this.JST["work/project-list/approve/approve-todo"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="approval-botton tu-clearfix" data-name="button-area">\n	',userNow&&(__p+="\n		",__p+=allcheck?'\n			<span class="tu-icon-check-active allcheck" data-status="'+(null==(__t=allcheck)?"":__t)+'" data-name="allcheck"></span>\n		':'\n			<span class="tu-icon-checkbox-have allcheck" data-status="'+(null==(__t=allcheck)?"":__t)+'" data-name="allcheck"></span>\n		',__p+='\n		<button class="tu-btn tu-btn-small tu-btn-sure disabled approval-sure" data-name="btn-sure">同意</button>\n		<button class="tu-btn tu-btn-small tu-btn-sure disabled" data-name="btn-reject">驳回</button>\n	'),__p+='\n</div> \n<div class="approval-list-container">\n 		\n</div>\n<div data-name="pagination"></div>';return __p},this.JST["work/project-list/list-tabs"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<ul class="tu-nav-tabs" id="project-detail-nav">\n		',_.each(tabList,function(a,b){__p+='\n			<li class="item-tab '+(null==(__t=activeIndex==b+1?"active":"")?"":__t)+'" data-name="tab-item" data-index="'+(null==(__t=b+1)?"":__t)+'">\n				<a data-trigger="false" href="'+(null==(__t=a.url)?"":__t)+'">\n					'+(null==(__t=a.name)?"":__t)+"\n				</a>\n			</li>\n		"}),__p+='\n</ul>\n<div class="tu-nav-content"></div>\n\n\n';return __p},this.JST["work/project-list/project-list-composite-item"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)showCheckbox&&(__p+='\r\n    <td class="'+(null==(__t=!disabled&&checked?"tu-icon-check-active":"tu-icon-checkbox-have")?"":__t)+" "+(null==(__t=disabled?"checkbox-disabled":"")?"":__t)+" tu-cp\" data-name='checkBox'></td>\r\n"),__p+="\r\n\r\n<td>\r\n    <a ",dataTrigger&&(__p+='data-trigger="false"'),__p+=" ",targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'" class="list-item-name" data-name="project-name">\r\n        \r\n        ',1==approvalStatus?__p+='\r\n            <span class="icon-approval"></span>\r\n        ':3==approvalStatus?__p+='\r\n            <span class="icon-reject"></span>\r\n        ':4==approvalStatus?__p+='\r\n            <span class="icon-repeal"></span>\r\n        ':WorkExternal&&(__p+="\r\n            <!-- 外部联系人列表不显示外标识 -->\r\n            ",!isExterUser&&isOpenExternal&&(__p+='\r\n                <span class="icon-extraproject"></span>\r\n            '),__p+="\r\n        "),__p+="\r\n        "+(null==(__t=workName)?"":__t)+"\r\n        \r\n    </a>\r\n    ",showTags&&(__p+='\r\n    <div style="display: inline;">\r\n        ',_.each(tags,function(a){__p+='\r\n        <div class="tt-tag-container" data-name="tag" data-toggle="infotip" data-body="查看 '+(null==(__t=a.tagName)?"":__t)+' 下所有项目">\r\n            <a href="#work?relation=24&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&tagId="+(null==(__t=a.id)?"":__t)+'">\r\n                <div class="tag-box">\r\n            		<div class="tag-wrap tu-clearfix">\r\n                        <div class="tag-main">\r\n                            <span class="tag-color-wrap">\r\n                                <span class="color'+(null==(__t=a.color)?"":__t)+'"></span>\r\n                            </span>\r\n                			<span class="text">'+(null==(__t=a.tagName)?"":__t)+"</span>\r\n                        </div>\r\n            		</div>\r\n                </div>\r\n            </a>\r\n        </div>\r\n        "}),__p+="\r\n    "),__p+="\r\n    ",counter.taskTotal&&(__p+='\r\n    <div class="total-box">\r\n    <a ',targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'&detail_type=task">\r\n    <span class="icon tu-icon-task" data-toggle="infotip" data-body="任务数" data-name="icon-task"></span>\r\n    <span class="trendTotal">'+(null==(__t=counter.finishTaskTotal)?"":__t)+"/"+(null==(__t=counter.taskTotal)?"":__t)+"</span>\r\n    </a>\r\n    </div>\r\n    "),__p+="\r\n    ",counter.trendTotal&&(__p+='\r\n    <div class="total-box">\r\n    	<a ',targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'&detail_type=feed" >\r\n            <span class="icon-indicate">\r\n                <span class="icon tu-icon-talk" data-toggle="infotip" data-body="沟通数" data-name="icon-talk"></span>\r\n                <span class="trendTotal">'+(null==(__t=counter.trendTotal)?"":__t)+"</span>\r\n            </span>\r\n    	</a>\r\n    </div>\r\n    "),__p+=' \r\n    </div>\r\n</td>\r\n\r\n<td class="no-break text-ellipsis algin-left"><span data-name="progress">'+(null==(__t=progress)?"":__t)+'</span></td>\r\n\r\n<td class="no-break text-ellipsis ',isDeadLine&&3!==approvalStatus&&!isLong&&(__p+="tu-ft_f1"),__p+='">\r\n<span class="cursor-default" data-name="project-time" data-toggle="infotip" data-body="起止时间：'+(null==(__t=startDate)?"":__t)+"-",__p+=isLong?"长期":null==(__t=endDate)?"":__t,__p+='">',__p+=2==status?null==(__t=endDate)?"":__t:null==(__t=dateContent)?"":__t,__p+="</span></td>\r\n\r\n",1==approvalStatus?__p+='\r\n    <td class="no-break text-ellipsis">\r\n        '+(null==(__t=principalUser.name)?"":__t)+"\r\n    </td>\r\n":(__p+="\r\n    ",__p+=3!=approvalStatus&&4!=approvalStatus||(1!=routerData.relation||UserId!=principalUser.userId)&&0!=routerData.relation?'\r\n    <td class="no-break text-ellipsis posRe" style="color:'+(null==(__t=3==approvalStatus?"#ACB7BF":"")?"":__t)+'">\r\n        '+(null==(__t=principalUser.name)?"":__t)+"\r\n    </td>\r\n    ":'\r\n    <td class="no-break posRe" style="color:#ACB7BF">\r\n        <span class="dialog-area" style="position: relative"></span>\r\n        <span class="status-btn-warp">\r\n            <!-- <button type="button" class="tu-btn tu-btn-mini" data-name="del">删除</button> -->\r\n            <!-- <a href="#work?work_id='+(null==(__t=workId)?"":__t)+'&create=true"> -->\r\n            <button type="button" class="tu-btn tu-btn-mini tu-btn-sure" data-name="reCreate">重新创建</button>\r\n            <!-- </a> -->\r\n        </span>\r\n        <span class="status-name text-ellipsis">\r\n        '+(null==(__t=principalUser.name)?"":__t)+"\r\n        </span>\r\n    </td>    \r\n    ",__p+="\r\n"),__p+="\r\n",isOpenLabel&&(__p+='\r\n<td class="no-break"><span data-name="class" data-class-id="'+(null==(__t=lableId)?"":__t)+'">'+(null==(__t=_.substring(lableName,8,!0))?"":__t)+"</span></td>\r\n"),__p+='\r\n<td class="no-break text-ellipsis">'+(null==(__t=departmentName)?"":__t)+"</td>\r\n\r\n\r\n\r\n\r\n";return __p},this.JST["work/project-list/project-list-composite"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tu-table">\r\n	<table class="tu-ft_m2">\r\n		<colgroup>\r\n			',showCheckbox&&(__p+='\r\n				<col span="1" width="35px"></col>\r\n				'),__p+='\r\n					<col span="1"></col>\r\n					<col span="1" width="12%"></col>\r\n					<col span="1" width="17%"></col>\r\n					<col span="1" width="12%"></col>\r\n					',isOpenLabel&&(__p+='\r\n						<col span="1" width="10%"></col>\r\n						'),__p+='\r\n							<col span="1" width="12%"></col>\r\n		</colgroup>\r\n		<thead>\r\n			<tr>\r\n				',showCheckbox&&(__p+='\r\n					<th class="'+(null==(__t=allChecked?"tu-icon-check-active":"tu-icon-checkbox-have")?"":__t)+" tu-cp\" data-name='allCheckedBox'></th>\r\n					"),__p+="\r\n						<th>名称</th>\r\n						<th>项目进度</th>\r\n						<th>截止日期</th>\r\n						<th>负责人</th>\r\n						",isOpenLabel&&(__p+="\r\n							<th>分类</th>\r\n							"),__p+="\r\n								<th>部门</th>\r\n			</tr>\r\n		</thead>\r\n		<tbody>\r\n\r\n		</tbody>\r\n	</table>\r\n</div>";return __p},this.JST["work/project-list/project-list-main"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)25!=routerData.relation&&(__p+='\n	<div class="project_list_top_container">\n		<div class="tu-container-title " data-name="title-box">\n		  		<h2 class="h2">'+(null==(__t=title)?"":__t)+'</h2>\n		  	<div class="top-right">\n		  		<!-- <a href="javascript:;" class="project-list-top-wiki">\n		  			<span class="tu-icon-wiki"></span> <span class="project-list-top-wiki-txt">了解项目</span>\n		  		</a> -->\n			  ',4!=routerData.relation?(__p+="\n				\n\n				",isShowCretae&&!isExterUser&&(__p+='\n					<a href="/u/'+(null==(__t=userId)?"":__t)+'/Home#report" target="_blank" class="all-entrance tu-mr-10">\n						<i class="tu-icon-chart－circle all-entrance__icon"></i>\n						<span>项目统计</span> \n					</a>\n				'),__p+="\n\n		  		",__p+='\n				  \n			  	<a class="all-entrance tu-mr-10 know-part_hover" data-name="know-project">\n					<i class="tu-icon-bulb all-entrance__icon"></i>\n					<span class="tu-icon-bulb-text">了解项目</span>\n				</a>\n\n			  	',24!=routerData.relation&&isShowCretae&&!isExterUser&&(__p+='\n				  	<button type="button" class="tu-btn tu-btn-larger tu-btn-sure project-create-btn" data-name="project-create-btn">创建项目</button>\n			  	'),__p+="\n\n			  	",24==routerData.relation&&(__p+='\n			  		<a href="/u/'+(null==(__t=userId)?"":__t)+'/Home#set?page_id=tag" class="tu-btn tu-btn-larger tu-btn-sure" target="_blank">标签管理</a>\n			  	'),__p+="\n			"):__p+='\n			 	<a href="'+(null==(__t=waitApprovalUrl)?"":__t)+'" target="_blank" class="project_list_top__approval">待我审批的 <i class="tu-icon-angle-right"></i></a>\n			',__p+='\n			 \n			  	<!-- <a href="/u/'+(null==(__t=userId)?"":__t)+'/Home#set?page_id=approvals&type=tenant&subtype=work" class="tu-btn tu-btn-larger tu-btn-sure tu-icon-setting to-approval managemnt-operation"  data-name="to-approval" data-body="项目审批设置" target="_blank"></a> -->\n				  ',isShowWorkSetting&&(__p+='  \n				<button class="tu-btn tu-btn-larger tu-btn-sure tu-icon-setting managemnt-operation" data-name="managemnt-operation"></button>\n				'),__p+='  \n				<div class="tu-dropdown managemnt-operation_main" data-name="managemnt-operation_main">\n					<ul class="tu-dropdown-menu">\n						<a href="'+(null==(__t=workSettingUrl)?"":__t)+'" class="tu-ft_m2 tu-ft-hv_c2"  data-name="managemnt-operation_to-set" data-body="项目规定设置"  target="_blank"><li class="tu-menuitem">项目规定设置</li></a>\n						<a href="/u/'+(null==(__t=userId)?"":__t)+'/Home#set?page_id=approvals&type=tenant&subtype=work" class="managemnt-operation_to-approval  tu-ft_m2 tu-ft-hv_c2"  data-name="managemnt-operation_to-approval" data-body="项目审批设置"  target="_blank"><li class="tu-menuitem">项目审批设置</li></a>\n						',isRoot&&(__p+='\n							<a href="'+(null==(__t=newAdminUrl)?"":__t)+'" class="managemnt-operation_to-admin  tu-ft_m2 tu-ft-hv_c2"  data-name="managemnt-operation_to-admin" data-body="项目管理员设置" target="_blank"><li class="tu-menuitem">项目管理员设置</li></a>\n						'),__p+="\n					</ul>\n				</div>\n		  	</div>\n		</div>\n	</div>\n"),__p+="\n<div "+(null==(__t=25==routerData.relation?"":'class="tt-work-project-list-container"')?"":__t)+' >\n\n	<!-- <div class="project-approval-tabs" data-name="project-approval-tabs"></div> -->\n	<div data-name="project-screen"></div>\n	<div data-name="user-history-warp"></div>\n	',23==routerData.relation&&(__p+='\n		<button class="tu-btn tu-btn-small tu-btn-sure tu-mt-20 disabled" data-name="supervise">一键提醒更新</button>\n	'),__p+='\n	<div data-name="project-list"></div>\n	<div data-name="pagination"></div>\n</div>\n';return __p},this.JST["work/sidebar/project-list-sidebar-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)_.each(data,function(a){__p+='\n	<li class="item-nav">\n		<a title="'+(null==(__t=a.workName)?"":__t)+'" data-work-id="'+(null==(__t=a.workId)?"":__t)+'" data-trigger="false"  class="" title="" href="#work?relation='+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=a.workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'">\n			',1==a.approvalStatus?__p+='\n				<!-- 审批中 -->\n				<span class="icon-approval"></span>\n			':3==a.approvalStatus?__p+='\n				<!-- 驳回 -->\n				<span class="icon-reject"></span>\n			':4==a.approvalStatus?__p+='\n				<!-- 撤销 -->\n				<span class="icon-repeal"></span>\n			':WorkExternal&&(__p+="\n				",a.isOpenExternal&&!isExterUser&&(__p+='\n					<span class="icon-extraproject"></span>\n				'),__p+="\n			"),__p+="\n			",__p+=__e(value?Talent.Context.textMark(value,_.unescape(a.workName)):_.unescape(a.workName)),__p+="\n			",a.counter.indicateTotal>0&&a.counter.indicateTotal<99?__p+='\n			<span class="indicator_wlsn">'+(null==(__t=a.counter.indicateTotal)?"":__t)+"</span>\n			":a.counter.indicateTotal>99&&(__p+='\n			<span class="indicator_wlsn">99+</span>\n			'),__p+=" \n		</a>\n	</li>\n"});return __p},this.JST["work/sidebar/project-list-sidebar-search-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)_.each(data,function(a){__p+='\n	<li class="item-mn">\n		<a title="'+__e(a.workName)+'" data-trigger="false"  class="title-mn ',a.workId==routerData.work_id&&(__p+="active"),__p+='" title="" href="#work?relation='+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=a.workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=a.workType)?"":__t)+'">\n			',__p+=value?null==(__t=Talent.Context.textMark(value,a.workName,{markColor:"#fe5042"}))?"":__t:__e(_.unescape(a.workName)),__p+="\n			",a.counter.trendTotal>0&&a.counter.trendTotal<99?__p+='\n			<span class="indicator_wlsn">'+(null==(__t=a.counter.trendTotal)?"":__t)+"</span>\n			":a.counter.trendTotal>99&&(__p+='\n			<span class="indicator_wlsn">N</span>\n			'),__p+=" \n			",a.IsApply&&(__p+='\n				<span class="icon-approval"></span>\n			'),__p+="\n		</a>\n	</li>\n"});return __p},this.JST["work/sidebar/project-list-sidebar"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div data-name="search-form-wrap" class="search-form-wrap"></div>\r\n<ul id="work_sidebar" class="tu-nav-sub '+(null==(__t=isExterUser?"tu-mt-20":"")?"":__t)+'" data-name="list-wraper">\r\n	',showTagManage&&(__p+='\r\n		<li class="item-mn">\r\n			<a data-relation="24" data-trigger="false" href="#work?relation=24&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" class="title-mn" ><span class="tu-icon-tag siderbar-icon "></span>按标签查看</a>\r\n		</li>\r\n	'),__p+="\r\n	",isShowImplement&&(__p+='\r\n	<li class="item-mn">\r\n		<a href="#work/implementation" class="title-mn" data-disabled="disabled"><span class="tu-icon-chart siderbar-icon"></span>项目执行情况</a>\r\n	</li>\r\n	'),
__p+="\r\n	",navTabs.group1.length>0?(__p+="\r\n		",_.each(navTabs.group1,function(a){__p+='\r\n			<li class="fold-item item-mn"> \r\n				<a data-relation="'+(null==(__t=a.roleType)?"":__t)+'" data-trigger="false" href="#work?relation='+(null==(__t=a.roleType)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" data-name="'+(null==(__t=a.dataName)?"":__t)+'-title" class="title-mn" >',21==a.roleType?__p+="最近查看":(__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+=null==(__t=a.roleName)?"":__t),__p+='</a>\r\n				<span class="arrow-btn tu-icon-arrow-'+(null==(__t=a.isOpen?"up":"down")?"":__t)+'"></span>\r\n				<ul class="worklist_sidenav sub-menu" data-relation="'+(null==(__t=a.roleType)?"":__t)+'" style="display:'+(null==(__t=a.isOpen?"block":"none")?"":__t)+'">\r\n					<div class="loading-content">\r\n						<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n					</div>\r\n				</ul>\r\n			</li>\r\n		'}),__p+="\r\n	"):__p+='\r\n		<li class="item-mn load" style="text-align: center;" data-name="load-pagemark" >\r\n			<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n		</li>\r\n	',__p+="\r\n	",isShowAllAssess&&(__p+='\r\n	<li class="item-mn">\r\n		<a data-relation="23" data-trigger="false" href="#work?relation=23&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" class="title-mn" >公司全部项目</a>\r\n	</li>\r\n	'),__p+="\r\n	",isShowAllApply&&(__p+='\r\n	<li class="item-mn">\r\n		<a data-relation="23" data-trigger="false" href="#work?relation=25&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" class="title-mn" >公司全部项目审批</a>\r\n	</li>\r\n	'),__p+="\r\n\r\n	",navTabs.group2.length>0?(__p+="\r\n		",_.each(navTabs.group2,function(a){__p+='\r\n			<li class="fold-item item-mn"> \r\n				<a data-relation="'+(null==(__t=a.roleType)?"":__t)+'" data-trigger="false" href="#work?relation='+(null==(__t=a.roleType)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" data-name="'+(null==(__t=a.dataName)?"":__t)+'-title" class="title-mn" >',__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+=(null==(__t=a.roleName)?"":__t)+'</a>\r\n				<span class="arrow-btn tu-icon-arrow-'+(null==(__t=a.isOpen?"up":"down")?"":__t)+'"></span>\r\n				<ul class="worklist_sidenav sub-menu" data-relation="'+(null==(__t=a.roleType)?"":__t)+'" style="display:'+(null==(__t=a.isOpen?"block":"none")?"":__t)+'">\r\n					<div class="loading-content">\r\n						<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n					</div>\r\n				</ul>\r\n			</li>\r\n\r\n		'}),__p+="\r\n	"):__p+='\r\n		<li class="item-mn load" style="text-align: center;" data-name="load-pagemark" >\r\n			<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\r\n		</li>\r\n	',__p+="\r\n	",isShowOthers&&(__p+='\r\n	<li class="item-mn"> \r\n		<a data-relation="4" data-trigger="false" href="#work?relation=22&app_id='+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" class="title-mn">所有公开的</a>\r\n	</li>\r\n	'),__p+="\r\n</ul>";return __p},this.JST["work/sidebar/target-list-sidebar"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div data-name="search-form-wrap" class="search-form-wrap"></div>\n<ul id="work_sidebar" style="margin-top: 20px" class="tu-nav-sub '+(null==(__t=isExterUser?"tu-mt-20":"")?"":__t)+'" data-name="list-wraper">\n	',navTabs.length>0?(__p+="\n		",_.each(navTabs,function(a){__p+='\n			<li class="fold-item item-mn"> \n				<a data-relation="'+(null==(__t=a.roleType)?"":__t)+'" data-trigger="false" href="#work?relation='+(null==(__t=a.roleType)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id="+(null==(__t=routerData.to_user_id)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+'" data-name="'+(null==(__t=a.dataName)?"":__t)+'-title" class="title-mn" >',__p+=userId!=user.Id?null==(__t=user.Name)?"":__t:"我",__p+=(null==(__t=a.roleName)?"":__t)+'</a>\n				<span class="arrow-btn tu-icon-arrow-'+(null==(__t=a.isOpen?"up":"down")?"":__t)+'"></span>\n				<ul class="worklist_sidenav sub-menu" data-relation="'+(null==(__t=a.roleType)?"":__t)+'" style="display:'+(null==(__t=a.isOpen?"block":"none")?"":__t)+'">\n					<div class="loading-content">\n						<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\n					</div>\n				</ul>\n			</li>\n\n		'}),__p+="\n	"):__p+='\n		<li class="item-mn load" style="text-align: center;" data-name="load-pagemark" >\n			<img src="'+(null==(__t=imgUrl)?"":__t)+'" width="40" height="25">\n		</li>\n	',__p+="\n</ul>";return __p},this.JST["work/target-list/target-list-composite-item"]=function(obj){obj||(obj={});var __t,__p="",__e=_.escape;Array.prototype.join;with(obj)showCheckbox&&(__p+='\r\n    <td class="'+(null==(__t=!disabled&&checked?"tu-icon-check-active":"tu-icon-checkbox-have")?"":__t)+" "+(null==(__t=disabled?"checkbox-disabled":"")?"":__t)+" tu-cp\" data-name='checkBox'></td>\r\n"),__p+="\r\n<td>\r\n    <a ",dataTrigger&&(__p+='data-trigger="false"'),__p+=" ",targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&workType="+(null==(__t=routerData.workType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'" class="list-item-name" data-name="project-name">\r\n\r\n        ',WorkExternal&&(__p+="\r\n            <!-- 外部联系人列表不显示外标识 -->\r\n            ",!isExterUser&&isOpenExternal&&(__p+='\r\n                <span class="icon-extraproject"></span>\r\n            '),__p+="\r\n        "),__p+="\r\n        "+__e(workName)+"\r\n        \r\n    </a>\r\n    ",counter.taskTotal&&(__p+='\r\n    <div class="total-box">\r\n    <a ',targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'&detail_type=task">\r\n    <span class="icon tu-icon-task" data-toggle="infotip" data-body="任务数" data-name="icon-task"></span>\r\n    <span class="trendTotal">'+(null==(__t=counter.finishTaskTotal)?"":__t)+"/"+(null==(__t=counter.taskTotal)?"":__t)+"</span>\r\n    </a>\r\n    </div>\r\n    "),__p+="\r\n    ",counter.trendTotal&&(__p+='\r\n    <div class="total-box">\r\n    	<a ',targetBlank&&(__p+='target="_blank"'),__p+=' href="',targetBlank&&(__p+=null==(__t=href)?"":__t),__p+="#work?relation="+(null==(__t=routerData.relation)?"":__t)+"&work_id="+(null==(__t=workId)?"":__t)+"&app_id="+(null==(__t=routerData.appId)?"":__t)+"&app_type="+(null==(__t=routerData.appType)?"":__t)+"&to_user_id=",__p+=useHrefFromModel?null==(__t=routerData.to_user_id)?"":__t:null==(__t=principalUser.userId)?"":__t,__p+="&status="+(null==(__t=status)?"":__t)+'&detail_type=feed" >\r\n            <span class="icon-indicate">\r\n                <span class="icon tu-icon-talk" data-toggle="infotip" data-body="沟通数" data-name="icon-talk"></span>\r\n                <span class="trendTotal">'+(null==(__t=counter.trendTotal)?"":__t)+"</span>\r\n            </span>\r\n    	</a>\r\n    </div>\r\n    "),__p+=' \r\n    </div>\r\n</td>\r\n\r\n<td class="no-break text-ellipsis algin-left"><span data-name="progress">'+(null==(__t=progress)?"":__t)+'</span></td>\r\n\r\n<td class="no-break text-ellipsis ',isDeadLine&&!isLong&&(__p+="tu-ft_f1"),__p+='">\r\n<span class="cursor-default" data-name="project-time" data-toggle="infotip" data-body="起止时间：'+(null==(__t=startDate)?"":__t)+"-",__p+=isLong?"长期":null==(__t=endDate)?"":__t,__p+='">',__p+=2==status?null==(__t=endDate)?"":__t:null==(__t=dateContent)?"":__t,__p+='</span></td>\r\n\r\n\r\n\r\n<td class="no-break text-ellipsis posRe">\r\n    '+(null==(__t=principalUser.name)?"":__t)+"\r\n</td>\r\n";return __p},this.JST["work/target-list/target-list-composite"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="tu-table">\r\n	<table class="tu-ft_m2">\r\n		<colgroup>\r\n			',showCheckbox&&(__p+='\r\n			<col span="1" width="35px"></col>\r\n			'),__p+='\r\n			<col span="1"></col>\r\n			<col span="1" width="12%"></col>\r\n			<col span="1" width="17%"></col>\r\n			<col span="1" width="12%"></col>\r\n		</colgroup>\r\n		<thead>\r\n			<tr>\r\n				',showCheckbox&&(__p+='\r\n				<th class="'+(null==(__t=allChecked?"tu-icon-check-active":"tu-icon-checkbox-have")?"":__t)+" tu-cp\" data-name='allCheckedBox'></th>\r\n				"),__p+="\r\n				<th>名称</th>\r\n				<th>进度</th>\r\n				<th>截止日期</th>\r\n				<th>负责人</th>\r\n			</tr>\r\n		</thead>\r\n		<tbody>\r\n\r\n		</tbody>\r\n	</table>\r\n</div>";return __p},this.JST["work/target-list/target-list-main"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<div class="project_list_top_container">\n    <div class="tu-container-title " data-name="title-box">\n            <h2 class="h2">'+(null==(__t=title)?"":__t)+'</h2>\n        <div class="top-right">\n            ',isShowCretae&&!isExterUser&&(__p+='\n                <button type="button" class="tu-btn tu-btn-larger tu-btn-sure project-create-btn" data-name="target-create-btn">创建目标</button>\n            '),__p+='\n        </div>\n    </div>\n</div>\n<div class="tt-work-project-list-container">\n	<div data-name="target-screen"></div>\n	<div data-name="user-history-warp"></div>\n	<div data-name="target-list"></div>\n	<div data-name="pagination"></div>\n</div>\n';return __p},this.JST["work/task-select"]=function(obj){obj||(obj={});var __t,__p="";_.escape,Array.prototype.join;with(obj)__p+='<a class="project_task_select task_responsible_select" type="responsible">\n	<span class="select_text"></span>\n	<span class="drop_icon"></span>\n</a>\n<ul class="dropdown-menu task_responsible_dropdown">\n	<li data-type="all" data-text="所有人"><span class="check"></span>所有人</li>\n	',_.each(members,function(a,b){__p+='\n	<li data-type="'+(null==(__t=a.UserId)?"":__t)+'" data-text="'+(null==(__t=a.Name)?"":__t)+'" title='+(null==(__t=a.Name)?"":__t)+'>\n		<span class="check"></span>'+(null==(__t=_.substring(a.Name,10,!0))?"":__t)+"\n	</li>\n	"}),__p+='\n</ul>\n<a class="project_task_select task_status_select" type="status">\n	<span class="select_text"></span>\n	<span class="drop_icon"></span>\n</a>\n<ul class="dropdown-menu task_status_dropdown">\n	<li data-type="all" data-text="所有状态"><span class="check"></span>所有状态</li>\n	<li data-type="undone" data-text="未完成"><span class="check"></span>未完成</li>\n	<li data-type="done" data-text="已完成"><span class="check"></span>已完成</li>\n</ul>';return __p},this.JST}),define("views/common/new-filter/filter-result/filter-result-view",["talent","templates/common","$.infotip"],function(a,b,c){var d=a.ItemView.extend({template:b["common/new-filter/filter-result/filter-result-group-item"],className:"result-group-item",ui:{closeBtn:"[data-name=close-btn]"},events:function(){var a={};return a["click "+this.ui.closeBtn]="_closeBtnClickHandler",a},templateHelpers:function(){return{isValid:this.model.get("data")&&this.model.get("data").isValid}},initialize:function(){},_closeBtnClickHandler:function(a){a.stopPropagation(),this.close()}}),e=a.CompositeView.extend({template:b["common/new-filter/filter-result/filter-result-group"],tagName:"dl",className:"result-group",itemView:d,itemViewContainer:"[data-name=result-group-list]",initialize:function(){var a=this;this.collection.set(this.model.get("groupList")),this.on("itemview:close",function(b){a.collection.remove(b.model),a.trigger("closeItem",{modelData:b.model.toJSON(),groupName:a.model.get("groupName")})})},onRender:function(){}});return a.CompositeView.extend({template:b["common/new-filter/filter-result/filter-result"],className:"tt-new-filter-result",itemView:e,itemViewContainer:"[data-name=filter-result-wrap]",templateHelpers:function(){},ui:{filterResultWrap:"[data-name=filter-result-wrap]",clearBtn:"[data-name=clear-btn]",saveBtn:"[data-name=save-btn]",cancelSaveBtn:"[data-name=cancel-save-btn]"},events:function(){var a={};return a["click "+this.ui.input]="_inputFocusHandler",a["click "+this.ui.clearBtn]="_clearBtnClickHandler",a["click "+this.ui.saveBtn]="_saveBtnClickHandler",a["click "+this.ui.cancelSaveBtn]="_cancelSaveBtnClickHandler",a},initialize:function(){var b=this;this.settings=a._.extend({},this.defaults,this.options),this.on("itemview:closeItem",function(a,c){b._dealCloseData(a,c)})},onRender:function(){this._appendHandleBtn()},_appendHandleBtn:function(){this.clearEl=$('<a href="javascript:;" class="handle-btn" data-name="clear-btn" data-placement="top" data-toggle="infotip" data-body="清空本次选择">清空所选</a>'),this.saveEl=$('<a href="javascript:;" class="handle-btn" data-name="save-btn" data-toggle="infotip">记住选择</a>'),this.cancelSaveEl=$('<a href="javascript:;" class="handle-btn" data-name="cancel-save-btn" data-toggle="infotip">取消记住</a>'),this.ui.filterResultWrap.append(this.clearEl);var a=new c;if(a.bindNode(this.clearEl,{container:this.$el}),this.settings.saveResult.support){this.ui.filterResultWrap.append(this.clearEl,this.saveEl,this.cancelSaveEl),this.settings.fromeStore?this.saveEl.hide():this.cancelSaveEl.hide();var b=new c,d=new c;b.bindNode(this.saveEl,{container:this.$el,body:"下次进入显示以上条件"}),d.bindNode(this.cancelSaveEl,{container:this.$el,body:"不再显示以上条件"})}},_dealCloseData:function(a,b){var c=b.groupName;this.cancelSaveEl.hide(),this.saveEl.show(),a.collection.length?this.collection.findWhere({groupName:c}).set("groupList",a.collection.toJSON()):(this.collection.remove(a.model),this.collection.length||this.close()),this.trigger("closeItem",b)},_clearBtnClickHandler:function(a){a.stopPropagation(),this.collection.reset(),this.trigger("clear"),this.close()},_saveBtnClickHandler:function(a){a.stopPropagation(),this.trigger("save"),this.$el.find("[data-name=save-btn]").hide(),this.$el.find("[data-name=cancel-save-btn]").show()},_cancelSaveBtnClickHandler:function(a){a.stopPropagation();var b=$(a.currentTarget);this.trigger("cancelSave",b)}})}),define("views/common/new-filter/filter-tab-list-view",["talent","templates/common","TitaWidget","moment","views/common/new-filter/drop-down-list/drop-down-list-view","views/common/new-filter/filter-result/filter-result-view","collections/smember-group-collection","UserSelector","$.infotip"],function(a,b,c,d,e,f,g,h,i){return a.ItemView.extend({template:b["common/new-filter/search-filter-tab-list"],className:"tt-new-filtter-tab-list",tagName:"ul",ui:{tabItem:"[data-name=tab-item]",moreTabList:"[data-name=more-tab-list]",moreTabListItem:"[data-name=more-tab-list-item]",tabMoreBtn:"[data-name=tab-more-btn]",tabItemWrap:"[data-name=tab-item]"},modelEvents:{change:"render"},events:function(){var a={};return a["click "+this.ui.tabItem]="_tabClickHandler",a["click "+this.ui.moreTabListItem]="_moreTabItemClickHandler",a["mousedown "+this.ui.moreTabList]="_moreTabListMousedownHandler",a},initialize:function(){},onRender:function(){},onShow:function(){var b=this;this.model.get("tabResizeChange")&&(this._getTabItemWith(),this._rebuildTabs(),this.resizeDelay=a._.debounce(function(){b._rebuildTabs()},50),$(window).off("resize.filter-tab-list"),$(window).on("resize.filter-tab-list",function(){b.resizeDelay()}))},_getTabItemWith:function(){var a=this;this.normalTabWidthArr=[],this.hasLeftLineTabWidth=0,_.each(this.ui.tabItemWrap,function(b){var c=$(b),d=c.width();c.data("leftlist")?a.hasLeftLineTabWidth+=d:a.normalTabWidthArr.push(d)})},_rebuildTabs:function(){var b=this.$el.width(),c=$(".filter-right-wrap").width(),d=b-this.hasLeftLineTabWidth-200-c,e=this.model.get("allTabs"),f=[],g=[],h=0;_.each(this.normalTabWidthArr,function(a,b){h+=a,d>=h?f.push(e[b]):g.push(e[b])}),g.length&&f.push({tabLeftLine:!1,tabName:"more",tabTitle:"more",moreData:g});var i=a.Context.getGlobal("TaskAdvancedSetting"),j=i.TaskPlanSetting.TaskLabel;if(!j)for(var k=0;k<f.length;k++)"class"==f[k].tabName&&f.splice(k,1);this.model.set("normalTabListData",f)},_moreTabListMousedownHandler:function(a){a.stopPropagation()},_moreTabItemClickHandler:function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.data("tab-name");this.trigger("tabItemClick",c,this.ui.tabMoreBtn.parent()),this.ui.moreTabList.hide()},_tabClickHandler:function(b){b.stopPropagation();var c=$(b.currentTarget),d=c.data("tab-name");if(c.addClass("tab-item-active"),"more"==d){this.ui.moreTabList.show();var e=this;a.$(document).on("mousedown.filter-tab-list-view",function(b){a.$(document).off("mousedown.filter-tab-list-view"),e.ui.moreTabList&&(e.ui.moreTabList.hide(),e.ui.tabMoreBtn.parent().removeClass("tab-item-active"))})}else this.trigger("tabItemClick",d,c)},onClose:function(){$(window).off("resize.filter-tab-list"),a.$(document).off("mousedown.filter-tab-list-view")}})}),define("views/common/new-filter/filter-tab-view",["talent","templates/common","TitaWidget","moment","views/common/new-filter/drop-down-list/drop-down-list-view","views/common/new-filter/filter-result/filter-result-view","views/common/new-filter/filter-tab-list-view","collections/smember-group-collection","UserSelector","$.infotip"],function(a,b,c,d,e,f,g,h,i,j){return a.Layout.extend({template:b["common/new-filter/search-filter-tab"],className:"tt-new-filtter-tab",templateHelpers:function(){},ui:{tabItem:"[data-name=tab-item]"},regions:{resultWrap:"[data-name=result-wrap]",filterTabList:"[data-name=filter-tab-list]"},modelEvents:{"change:tag":"render"},events:function(){var a={};return a},initialize:function(){var b=this.model.get("tab"),c=this.model.get("storeData");_.isArray(c)&&!_.isEmpty(c)&&_.each(c,function(a){if(a.data&&a.data.isMult){var c=_.filter(b,function(b){return b.tabName==a.tabName}),d=[];c.length&&_.each(c[0].data,function(b){"baseline"!=b.title&&a.data.activeOrder.indexOf(b.order[0])<0&&(b.checked=!1),d.push(b)}),a.data.data=d}}),this._selectCollection=new a.Collection,this.listenTo(this._selectCollection,"change add reset set",function(){this._checkRely()}),this._changeTabTitleByDefaultOrder(b,c),this.extendResultData=new a.Collection,this.dealextendStoreDataCallback=this.model.get("dealextendStoreDataCallback"),this.clickExtendTabCallback=this.model.get("clickExtendTabCallback"),this.dealExtendDeleteCallback=this.model.get("dealExtendDeleteCallback")},onRender:function(){var b=this.model.get("tab"),c=this.model.get("storeData"),d=this;a._.each(b,function(a){("department"==a.tabName||"staff"==a.tabName)&&d._dealUserSelectViewCollection(a.tabName)}),_.isArray(c)&&c.length>0&&this._renderFilterResultBySroreData(c),this._setTabTitleByRely(b,c)},onShow:function(){this._renderFilterTabListView()},_renderFilterTabListView:function(){var b=this.model.get("tab"),c=[],d=[];_.each(b,function(a){a.tabLeftLine?d.push({tabLeftLine:a.tabLeftLine,tabName:a.tabName,tabTitle:a.tabTitle}):c.push({tabLeftLine:a.tabLeftLine,tabName:a.tabName,tabTitle:a.tabTitle})});var e=new a.Model({normalTabListData:c,hasLeftlineTabListData:d,allTabs:c.concat(d),tabResizeChange:this.model.get("tabResizeChange")});this.filterTabListView&&this.filterTabListView.close(),this.filterTabListView=new g({model:e}),this.listenTo(this.filterTabListView,"tabItemClick",function(a,b){this._tabClickHandler(a,b)}),this.filterTabList.show(this.filterTabListView)},_changeTabTitleByDefaultOrder:function(a,b){var c=this;_.each(a,function(d){var e=d.activeOrder;if(void 0!==e&&d.changeTabTitle){var f,g,h=_.indexOf(a,d);_.isArray(b)&&b.length>0&&_.each(b,function(a,b){a.tabName==d.tabName&&(f=a.data.activeOrder)}),_.each(d.data,function(b){if("baseline"!=b.tabTitle){var i=_.indexOf(b.order,void 0!==f?String(f):String(e));if(i>-1){if(_.isArray(b.order)&&b.order.length>1){var j=i?'<span class="tu-icon-simple-sort-up"></span>':'<span class="tu-icon-simple-sort-down"></span>';g=b.title+j,d.tabTitle=g}else d.tabTitle=b.title;a.splice(h,1,d),c.model.set("tab",a)}}})}})},_renderFilterResultBySroreData:function(b){var c=this,d=!0;_.each(b,function(b){var d=new a.Model(b);c._selectCollection.push(d)}),this._renderFilterResultView(d)},_setTabTitleByRely:function(b,c){var d=this,e=_.filter(b,function(a){return void 0!==a.rely&&""!=a.rely});a._.each(e,function(a){var b;if(_.isArray(c)&&c.length>0&&_.each(c,function(c,d){c.tabName==a.rely&&(b=c.data)}),void 0===b){var e=d.$el.find("[data-tab-name="+a.tabName+"]");e&&e.addClass("disable")}})},_checkRely:function(){var a=this,b=this.model.get("tab"),c=_.filter(b,function(a){return void 0!==a.rely&&""!=a.rely});if(c.length&&(relyByObjData=_.filter(this._selectCollection.toJSON(),function(a){return a.tabName==c[0].rely}),relyByObjData.length)){var d=a.$el.find("[data-tab-name="+c[0].tabName+"]");d&&d.removeClass("disable")}},_tabClickHandler:function(a,b){switch(a){case"date":this._renderDateView(b,a);break;case"status":this._renderDropdownListView(b,a);break;case"source":this._renderDropdownListView(b,a);break;case"department":this._showUserSelectView(b,a);break;case"staff":this._showUserSelectView(b,a);break;case"sort":this._renderDropdownListView(b,a);break;case"scope":if(b.hasClass("disable"))return;this._renderDropdownListView(b,a);break;case"class":this._renderClassView(b,a);break;default:this.clickExtendTabCallback(a,b)}},_removeActive:function(){this.$el.find(".tab-item-active").removeClass("tab-item-active")},_renderDateView:function(b,e){var f=this.model.get("tab"),g={isShowDateView:!0,isShowLongView:!1,isShowCycleView:!1,viewType:"date",rangepickerOptions:{startDate:d().startOf("month").format("YYYY/MM/DD"),endDate:d().endOf("month").format("YYYY/MM/DD"),format:"YYYY/MM/DD",timePicker:!1}},h=a._.filter(f,function(a){return a.tabName==e})[0],i=h.options;i=a._.extend({},g,i),this.dateTimePickerView&&this.dateTimePickerView.close(),this.dateTimePickerView=new c.DateTimePickerView(i),this.listenTo(this.dateTimePickerView,"sure",function(a,c){h.choseData=c,this._dealChoseData(b,e,h),this._removeActive()},this),this.listenTo(this.dateTimePickerView,"cancel",function(){this._removeActive()}),this.$el.append(this.dateTimePickerView.render().el),this.dateTimePickerView.onShow(),this.dateTimePickerView.show(b,{container:this.$el,pos:"bottom"})},_renderDropdownListView:function(b,c){var d=this.model.get("tab"),f=_.extend({},a._.filter(d,function(a){return a.tabName==c})[0]),g="dorpDownList"+c+"View",h=this.model.get("storeData");_.isArray(h)&&h.length>0&&_.each(h,function(a){a.tabName==c&&a.data&&void 0!==a.data.activeOrder&&""!==a.data.activeOrder&&(a.data.isMult&&_.each(f.data,function(b){"baseline"!=b.title&&a.data.activeOrder.indexOf(b.order[0])<0&&(b.checked=!1)}),f.activeOrder=a.data.activeOrder)}),this[g]||(this[g]=new e({model:new a.Model(f),isMult:f.isMult||!1}),this.listenTo(this[g],"chose",function(a){this._dealChoseData(b,c,a)}),this.listenTo(this[g],"close",function(a){this._removeActive()}),this.listenTo(this[g],"saveSort",function(a,b){this._saveFilterData("sort",a,b)}),this.$el.append(this[g].render().$el)),this[g].show({container:this.$el,node:b})},_dealUserSelectViewCollection:function(b){var c=(this.$el.find("[data-tab-name="+b+"]"),b+"userSelectorCollection"),d=this.model.get("tab"),e=a._.filter(d,function(a){return a.tabName==b})[0];this[c]=new h,e.options.getContactAPI&&(this[c].getContact=e.options.getContactAPI),this[c].getDepartmentData=function(){var b=new $.Deferred;return $.ajax({url:a.Context.getApiUrl("department/All"),type:"GET",success:function(c){if(c&&1==c.Code){var d=c.Data||[];a._.map(d,function(a,b){a.count=a.TotalUserCount,a.Data=[],a.type="department"}),b.resolve(d)}else b.resolve([])}}),b.promise()}},_renderClassView:function(b,d){var e=this.model.get("tab"),f={viewType:"multi"},g=a._.filter(e,function(a){return a.tabName==d})[0].options;g=a._.extend({},f,g),this.classView&&this.classView.close(),g.resultData=this._getClassData(),this.classView=new c.ClassComponentView(g),this.listenTo(this.classView,"submit",function(a){_.isArray(a)&&!_.isEmpty(a)&&this._dealChoseData(b,d,a),this._removeActive()}),this.listenTo(this.classView,"reset",function(){var a=this._selectCollection.findWhere({tabName:"class"});this._removeActive(),a&&(this._selectCollection.remove(a),this._renderFilterResultView(),this.trigger("result",this._selectCollection.toJSON())),this.classView.close()}),this.listenTo(this.classView,"cancel",function(){this._removeActive()}),this.$el.append(this.classView.render().$el),this.classView.show(b,{container:this.$el,pos:"bottom"})},_getClassData:function(){var a=_.findWhere(this._selectCollection.toJSON(),{tabName:"class"}),b=[];return a&&_.each(a.data.choseData,function(a){b.push({id:a.id,name:a.name})}),b},_showUserSelectView:function(b,d){var e=this.model.get("tab"),f=d+"userSelectorCollection",g={department:{muti:!0,showTab:!0,viewType:"muti",listType:"Department",tab:["Department"],input:!1,hasSerchBtn:!1,titleName:"选择部门",searchTitle:"已选",emptyText:{Department:""},focusinListType:"Department",getDepartmentPeople:!1,container:this.$el},staff:{viewType:"single",muti:!0,container:this.$el}},h="select"+d+"View",j=a._.filter(e,function(a){return a.tabName==d})[0].options;j=_.extend({},g[d],j),j=c.util.userSelectorConfig(j),this[h]||(this[h]=new i({collection:this[f]})),this.listenTo(this[h],"submit",function(a){if(this.stopListening(this[h],"submit"),a.data)this._dealChoseData(b,d,a.data);else{var c=[];c.push(a),this._dealChoseData(b,d,c)}this._removeActive()}),this.listenTo(this[h],"close",function(a){this.stopListening(this[h],"close"),this._removeActive()}),this[h].showDialog(j,b)},_addParticipator:function(b,c,d){var e=a._.filter(d,function(a){return"staff"==c&&a.type&&"department"==a.type?0==a.allItem.count:void 0}),f=a._.filter(d,function(a){return"staff"==c&&a.type&&"department"==a.type?0!=a.allItem.count:a});if(e&&e.length){var g=a._.pluck(e,"name"),h="所选的 "+g.join("、")+" 部门人员为空,不能添加!";this.infoTipView&&this.infoTipView.destroy(),this.infoTipView=new j,this.listenTo(this.infoTipView,"hide",function(){}),this.infoTipView.bindNode(b,{type:"remind",placement:"bottom",container:this.$el,ico:"warn",trigger:"manual",body:h}),this.infoTipView.show()}return a._.map(f,function(a){return{id:a.id||a.Id,email:"department"==a.type?a.name+":"+a.id+":dep_members":a.Email,name:(a.name||a.Name)+("department"==a.type&&"Staff"==c?"的人员":""),color:a.UserAvatar?a.UserAvatar.Color:"#7890bd",avatarsUrl:a.UserAvatar?a.UserAvatar.Small:"",department:"department"==a.type?!0:!1}})},_dealChoseData:function(b,c,d){var e=!1,f=_.filter(this.model.get("tab"),function(a){return a.tabName==c})[0];if("department"==c||"staff"==c){var d=this._addParticipator(b,c,d);if(!d.length)return}if(this._selectCollection.findWhere({tabName:c})){if("department"==c||"staff"==c||"class"==c){var g=this._delRepeatData(c,d).choseData;d=new Object(f),d.choseData=g}this._selectCollection.findWhere({tabName:c}).set({tabName:c,data:d.modelData?d.modelData:d})}else{var h=new a.Model({tabName:c,data:d.modelData?d.modelData:d});"department"==c||"staff"==c||"class"==c?h.set("data",_.extend({},f,{choseData:d})):h.set("data",d.modelData?d.modelData:d),this._selectCollection.push(h)}this.trigger("result",this._selectCollection.toJSON()),this._changeTabTittleByResult(d),f.inResult&&this._renderFilterResultView(e)},_delRepeatData:function(b,c){var d=this._selectCollection.findWhere({tabName:b}).get("data");return a._.each(c,function(b){var c=!1;a._.each(d.choseData,function(a){a.id==b.id&&(c=!0)}),c||d.choseData.push(b)}),d},_changeTabTittleByResult:function(a){var b=a.modelData||{},c=a.title;b.changeTabTitle&&this.$el.find("[data-tab-name="+b.tabName+"]").find("[data-name=item-name]").html(c)},addResultFromExtend:function(a,b){b=b||"update";var c=this.extendResultData.findWhere({groupName:a.groupName});c&&this.extendResultData.remove(c),"update"==b&&this.extendResultData.push(a),this._renderFilterResultView(!1)},_renderFilterResultView:function(b){var c=this;if(this.model.get("hasFilterTab")){this._showInResultCollection=new a.Collection,a._.each(this._selectCollection.toJSON(),function(b){var d=new a.Model,e=c._dealResultModel(b);e&&(d.set(e),b.data.inResult&&c._showInResultCollection.add(d))});var d=this.extendResultData.toJSON();if(_.isEmpty(d)||this._showInResultCollection.push(d),!this._showInResultCollection.length)return void(this.filterResultView&&this.filterResultView.close());this.filterResultView&&this.filterResultView.close(),this.filterResultView=new f({collection:this._showInResultCollection,fromeStore:b,saveResult:this.model.get("saveFilterResult")}),this.listenTo(this.filterResultView,"closeItem",function(a){this.trigger("closeItem",a),this._dealDelItem(a)}),this.listenTo(this.filterResultView,"clear",function(){var a=_.findWhere(this._selectCollection.toJSON(),{tabName:"sort"});this.model.get("storeData")||[];a?(this._selectCollection.reset(a),this.model.set("storeData",[a])):(this._selectCollection.reset(),this.model.unset("storeData")),this.trigger("clear",this._selectCollection.toJSON())}),this.listenTo(this.filterResultView,"save",function(a){this._saveFilterData("filter",this._selectCollection.toJSON())}),this.listenTo(this.filterResultView,"cancelSave",function(a){this._unSaveFilterData(a)}),this.resultWrap.show(this.filterResultView)}},_saveFilterData:function(a,b,c){var d,e=this;if("filter"==a){if(!_.isArray(b)||_.isEmpty(b))return;d=this.model.get("saveFilterResult").saveRequest}else"sort"==a&&(d=b[0].savaRequest);d(b).done(function(a){c&&(e.saveInfotipView&&e.saveInfotipView.destroy(),e.saveInfotipView=new j,e.saveInfotipView.bindNode(e.$el.find("[data-tab-name=sort]"),{type:"remind",placement:"bottom",container:e.$el,ico:"success",trigger:"manual",body:c}),e.saveInfotipView.show())}).fail(function(a){})},_unSaveFilterData:function(a){var b=new j,c=this;b.bindNode(a,{placement:"bottom",align:"right",container:this.$el,type:"confirm",trigger:"manual",body:"确定取消吗？取消后将不再记住以上条件",okHide:function(){var a=c.model.get("saveFilterResult").unSaveRequest;a().done(function(a){c.filterResultView.$el.find("[data-name=save-btn]").show(),c.filterResultView.$el.find("[data-name=cancel-save-btn]").hide()}).fail(function(a){}),b.destroy()}}),b.show()},_dealResultModel:function(b){var c,d,e,f=b.tabName;switch(f){case"date":c={groupTittle:this._getFilterGroupTittle(b.data,f),groupName:f,groupList:[{val:b.data.choseData.startDate+"-"+b.data.choseData.endDate,data:b.data}]};break;case"department":c={groupTittle:this._getFilterGroupTittle(b,f),groupName:f,groupList:[]},d=[],a._.each(b.data.choseData,function(a){d.push({val:a.name,data:a})}),c.groupList=d;break;case"staff":c={groupTittle:this._getFilterGroupTittle(b.data,f),groupName:f,groupList:[]},d=[],a._.each(b.data.choseData,function(a){d.push({val:a.name,data:a})}),c.groupList=d;var g=this.$el.find("[data-tab-name=Scope]");g&&g.removeClass("disable");
break;case"class":c={groupTittle:this._getFilterGroupTittle(b,f),groupName:f,groupList:[]},d=[],a._.each(b.data.choseData,function(a){a.type&&(a.tabType=a.type),d.push({val:a.name,data:a})}),c.groupList=d;break;case"status":c={groupTittle:"状态",groupName:f,groupList:[]},e=""!=b.data.activeOrder?String(b.data.activeOrder).split(","):[],b.data.isMult?(_.each(b.data.data,function(a){_.indexOf(e,String(a.order[0]))>-1&&"baseline"!=a.title&&c.groupList.push({val:a.title,data:b.data})}),c.isMult=!0):c.groupList=[{val:this._getFilterGroupItemValByOrder(b.data.activeOrder,f),data:b.data}];break;case"source":c={groupTittle:"来源",groupName:f,groupList:[]},e=""!=b.data.activeOrder?String(b.data.activeOrder).split(","):[],b.data.isMult?(_.each(b.data.data,function(a){_.indexOf(e,String(a.order[0]))>-1&&"baseline"!=a.title&&c.groupList.push({val:a.title,data:b.data})}),c.isMult=!0):c.groupList=[{val:this._getFilterGroupItemValByOrder(b.data.activeOrder,f),data:b.data}];break;case"scope":c={groupTittle:this._getFilterGroupTittle(b,f),groupName:f,groupList:[]},e=""!=b.data.activeOrder?String(b.data.activeOrder).split(","):[],b.data.isMult?(_.each(b.data.data,function(a){_.indexOf(e,String(a.order[0]))>-1&&"baseline"!=a.title&&c.groupList.push({val:a.title,data:b.data})}),c.isMult=!0):c.groupList=[{val:this._getFilterGroupItemValByOrder(b.data.activeOrder,f),data:b.data}];break;case"sort":c={groupTittle:this._getFilterGroupTittle(b,f),groupName:f,groupList:[{val:this._getFilterGroupItemValByOrder(b.data.activeOrder,f),data:b.data}]};break;default:var h=this.extendResultData.findWhere({groupName:f});h&&this.extendResultData.remove(h),this.extendResultData.push(this.dealextendStoreDataCallback(f,b))}return c},_getFilterGroupTittle:function(b,c){return a._.filter(this.model.get("tab"),function(a){return a.tabName==c})[0].tabTitle},_getFilterGroupItemValByOrder:function(a,b){var c,d=this.model.get("tab"),e=_.findWhere(d,{tabName:b}).data;return _.each(e,function(b){_.indexOf(b.order,String(a))>-1&&(c=b.title)}),c},_dealDelItem:function(b){var c=b.groupName,d=this._selectCollection.findWhere({tabName:c}).get("data"),e=this._selectCollection.findWhere({tabName:c});switch(c){case"date":this._selectCollection.remove(this._selectCollection.findWhere({tabName:c}));break;case"department":var f=[];if(a._.each(d.choseData,function(a){b.modelData.data.id!=a.id&&f.push(a)}),f.length){var g=this._selectCollection.findWhere({tabName:"department"}).get("data");g.choseData=f,this._selectCollection.findWhere({tabName:"department"}).set("data",g)}else this._selectCollection.remove(this._selectCollection.findWhere({tabName:"department"}));break;case"staff":var h=[];if(a._.each(d.choseData,function(a){b.modelData.data.id!=a.id&&h.push(a)}),h.length){var g=this._selectCollection.findWhere({tabName:"staff"}).get("data");g.choseData=h,this._selectCollection.findWhere({tabName:"staff"}).set("data",g)}else{this._selectCollection.remove(this._selectCollection.findWhere({tabName:"staff"})),this._showInResultCollection.remove(this._showInResultCollection.findWhere({groupName:"scope"})),this._selectCollection.remove(this._selectCollection.findWhere({tabName:"scope"}));var i=_.findWhere(_.flatten(this.model.get("tab")),{tabName:"scope"});if(this.dorpDownListscopeView)this.dorpDownListscopeView.model.set("activeOrder",i.activeOrder),this.dorpDownListscopeView.render();else{var j=this.model.get("storeData");_.isArray(j)&&j.length>0&&this.model.set("storeData",_.filter(j,function(a){return"scope"!=a.tabName}))}var k=this.$el.find("[data-tab-name=scope]");k&&k.addClass("disable")}break;case"class":var l=[];if(a._.each(d.choseData,function(a){b.modelData.data.id!=a.id&&l.push(a)}),l.length){var g=this._selectCollection.findWhere({tabName:"class"}).get("data");g.choseData=l,this._selectCollection.findWhere({tabName:"class"}).set("data",g)}else this._selectCollection.remove(this._selectCollection.findWhere({tabName:"class"}));break;case"status":var m=_.filter(this.model.get("tab"),{tabName:"status"})[0],j=_.filter(this.model.get("storeData"),{tabName:"status"})[0];if(d.isMult){var n;n=this.dorpDownListstatusView?this.dorpDownListstatusView.model.toJSON().data:m.data;var o=this,p=[],q=!0;if(o.dorpDownListstatusView||_.each(n,function(a){"baseline"!=a.title&&j.data.activeOrder.indexOf(a.order[0])<0&&(a.checked=!1)}),_.each(n,function(a){a.title==b.modelData.val&&(a.checked=!1,allChecked=!1),a.checked&&"baseline"!=a.title&&p.push(a.order[0]),"baseline"!=a.title&&a.checked&&(q=!1)}),q)_.each(n,function(a){"baseline"!=a.title&&(a.checked=!0,p.push(a.order[0]))}),this._selectCollection.remove(e);else{e.set("isMult",!0);var g=e.get("data");g.data=n,g.activeOrder=p.join(",")}this.dorpDownListstatusView&&(this.dorpDownListstatusView.model.set("data",n).set("activeOrder",p.join(",")),this.dorpDownListstatusView.setOriginData())}else{if(this._selectCollection.remove(e),this.dorpDownListstatusView)this.dorpDownListstatusView.model.set("activeOrder",m.activeOrder),this.dorpDownListstatusView.render();else{var j=this.model.get("storeData");_.isArray(j)&&j.length>0&&this.model.set("storeData",_.filter(j,function(a){return"status"!=a.tabName}))}var r=_.filter(m.data,function(a){return a.order?_.indexOf(a.order,m.activeOrder)>-1:void 0});e.get("data").changeTabTitle&&(r.length>0?this.$el.find("[data-tab-name=status]").find("[data-name=item-name]").html(r[0].title):this.$el.find("[data-tab-name=status]").find("[data-name=item-name]").html(m.title))}break;case"source":var m=_.filter(this.model.get("tab"),{tabName:"source"})[0],j=_.filter(this.model.get("storeData"),{tabName:"source"})[0];if(d.isMult){var n;n=this.dorpDownListsourceView?this.dorpDownListsourceView.model.toJSON().data:m.data;var o=this,p=[],q=!0;if(o.dorpDownListsourceView||_.each(n,function(a){"baseline"!=a.title&&j.data.activeOrder.indexOf(a.order[0])<0&&(a.checked=!1)}),_.each(n,function(a){a.title==b.modelData.val&&(a.checked=!1,allChecked=!1),a.checked&&"baseline"!=a.title&&p.push(a.order[0]),"baseline"!=a.title&&a.checked&&(q=!1)}),q)_.each(n,function(a){"baseline"!=a.title&&(a.checked=!0,p.push(a.order[0]))}),this._selectCollection.remove(this._selectCollection.findWhere({tabName:c}));else{this._selectCollection.findWhere({tabName:c}).set("isMult",!0);var g=this._selectCollection.findWhere({tabName:c}).get("data");g.data=n,g.activeOrder=p.join(",")}this.dorpDownListsourceView&&(this.dorpDownListsourceView.model.set("data",n).set("activeOrder",p.join(",")),this.dorpDownListsourceView.setOriginData())}else{if(this._selectCollection.remove(this._selectCollection.findWhere({tabName:c})),this.dorpDownListsourceView)this.dorpDownListsourceView.model.set("activeOrder",m.activeOrder),this.dorpDownListsourceView.render();else{var j=this.model.get("storeData");_.isArray(j)&&j.length>0&&this.model.set("storeData",_.filter(j,function(a){return"source"!=a.tabName}))}var r=_.filter(m.data,function(a){return a.order?_.indexOf(a.order,m.activeOrder)>-1:void 0});e.get("data").changeTabTitle&&(r.length>0?this.$el.find("[data-tab-name=source]").find("[data-name=item-name]").html(r[0].title):this.$el.find("[data-tab-name=source]").find("[data-name=item-name]").html(m.title))}break;case"sort":this._selectCollection.remove(this._selectCollection.findWhere({tabName:c}));break;case"scope":var i=_.findWhere(_.flatten(this.model.get("tab")),{tabName:"scope"}),j=_.filter(this.model.get("storeData"),{tabName:"scope"})[0];if(d.isMult){var n;n=this.dorpDownListscopeView?this.dorpDownListscopeView.model.toJSON().data:i.data;var o=this,p=[],q=!0;if(o.dorpDownListscopeView||_.each(n,function(a){"baseline"!=a.title&&j.data.activeOrder.indexOf(a.order[0])<0&&(a.checked=!1)}),_.each(n,function(a){a.title==b.modelData.val&&(a.checked=!1,allChecked=!1),a.checked&&"baseline"!=a.title&&p.push(a.order[0]),"baseline"!=a.title&&a.checked&&(q=!1)}),q)_.each(n,function(a){"baseline"!=a.title&&(a.checked=!0,p.push(a.order[0]))}),this._selectCollection.remove(this._selectCollection.findWhere({tabName:c}));else{this._selectCollection.findWhere({tabName:c}).set("isMult",!0).get("data").data=n;var g=this._selectCollection.findWhere({tabName:c}).get("data");g.data=n,g.activeOrder=p.join(",")}this.dorpDownListscopeView&&(this.dorpDownListscopeView.model.set("data",n).set("activeOrder",p.join(",")),this.dorpDownListscopeView.setOriginData())}else if(this._selectCollection.remove(this._selectCollection.findWhere({tabName:c})),this.dorpDownListscopeView)this.dorpDownListscopeView.model.set("activeOrder",i.activeOrder),this.dorpDownListscopeView.render();else{var j=this.model.get("storeData");_.isArray(j)&&j.length>0&&this.model.set("storeData",_.filter(j,function(a){return"scope"!=a.tabName}))}break;default:return void this.dealExtendDeleteCallback(b)}this.trigger("result",this._selectCollection.toJSON())}})}),define("views/common/new-filter/search/search-view",["talent","templates/common"],function(a,b){return a.ItemView.extend({template:b["common/new-filter/search/search"],className:"tt-new-filter-search",defaults:{placeholder:"请输入关键字",isShowDelete:!0},templateHelpers:function(){return{searchName:(new Date).getTime(),placeholder:this.settings.placeholder,isShowDelete:this.settings.isShowDelete,type:this.settings.type}},ui:{searchBody:"[data-name=search-body]",input:"[data-name=input]",searchBtn:"[data-name=search-btn]",cancelBtn:"[data-name=cancel-btn]",searchBox:"[data-name=search-box]",placeholder:"[data-name=placeholder]"},events:function(){var a={};return a["focus "+this.ui.input]="_inputFocusHandler",a["blur "+this.ui.input]="_inputBlurHandler",a["input "+this.ui.input]="_inputInputHandler",a["keydown "+this.ui.input]="_inputKeydownHandler",a["click "+this.ui.searchBtn]="_searchBtnClickHandler",a["click "+this.ui.cancelBtn]="_cancelBtnClickHandler",a["mousedown "+this.ui.searchBox]="_stopProp",a},initialize:function(){this.settings=a._.extend({},this.defaults,this.options),this.isSearch=!1,this.$el.on("mousedown",function(a){a.stopPropagation()})},onRender:function(){var a=this;this.ui.input.bind("propertychange",function(b){a._inputInputHandler(b,a)})},inputFocus:function(){this.ui.input.focus()},_stopProp:function(a){a.stopPropagation()},_inputFocusHandler:function(a){a.stopPropagation(),this.ui.searchBody.addClass("tu-input-focus"),this.ui.cancelBtn.show()},_inputBlurHandler:function(a){a.stopPropagation();var b=$(a.currentTarget),c=b.val();""==c&&(this.ui.searchBody.removeClass("tu-input-focus"),this.ui.cancelBtn.hide(),this.ui.placeholder.show(),this.isSearch&&(this.isSearch=!1,this.trigger("cancel",c)))},_inputInputHandler:function(a,b){a.stopPropagation();var c=$(a.currentTarget),d=c.val(),e="propertychange"==a.type?b:this;""==d?e.ui.placeholder.show():e.ui.placeholder.hide()},_inputKeydownHandler:function(a){a.stopPropagation();var b=$.trim(this.ui.input.val());a&&13==a.keyCode&&(b?this._searchBtnClickHandler(a):(this.trigger("cancel",b),this.isSearch=!1))},_searchBtnClickHandler:function(a){a.stopPropagation();var b=$.trim(this.ui.input.val());b?(this.isSearch=!0,this.trigger("search",b)):this.isSearch=!1},_cancelBtnClickHandler:function(a){a.stopPropagation();var b=$.trim(this.ui.input.val());this.isSearch&&(this.isSearch=!1,this.trigger("cancel",b)),this.render()}})}),define("views/common/new-filter/search-filter-view",["talent","templates/common","TitaWidget","moment","views/common/new-filter/drop-down-list/drop-down-list-view","views/common/new-filter/filter-tab-view","views/common/new-filter/search/search-view","$.infotip"],function(a,b,c,d,e,f,g,h){var i={status:[{title:"进行中",order:["1"],checked:!0},{title:"已完成",order:["2"],checked:!0},{title:"baseline"},{title:"审批中",order:["3"],checked:!0},{title:"已驳回",order:["4"],checked:!0},{title:"已过期",order:["5"],checked:!0},{title:"已撤销",order:["6"],checked:!0}],source:[{title:"工作计划",order:["1"],checked:!0},{title:"招聘",order:["203"],checked:!0},{title:"绩效管理",order:["400"],checked:!0},{title:"目标管理",order:["402"],checked:!0},{title:"客户支持",order:["600"],checked:!0},{title:"职业发展",order:["500"],checked:!0}],scope:[{title:"ta负责的",order:["1"],checked:!0},{title:"ta关注的",order:["2"],checked:!0},{title:"ta审批的",order:["3"],checked:!0},{title:"ta分管的",order:["4"],checked:!0}],sort:[{title:"创建时间",order:["1","2"],tip:[{txt:"点击后最晚创建的在最前面",order:"1"},{txt:"点击后最早创建的在最前面",order:"2"}]},{title:"开始时间",order:["3","4"],tip:[{txt:"点击后最晚开始的在最前面",order:"3"},{txt:"点击后最早开始的在最前面",order:"4"}]},{title:"结束时间",order:["5","6"],tip:[{txt:"点击后最晚结束的在最前面",order:"5"},{txt:"点击后最早结束的在最前面",order:"6"}]},{title:"完成时间",order:["8","7"],tip:[{txt:"点击后最晚完成的在最前面",order:"7"},{txt:"点击后最早完成的在最前面",order:"8"}]}]};return a.Layout.extend({template:b["common/new-filter/search-filter"],className:"tt-search-filter",ui:{searchWrap:"[data-name=search-wrap]",chartBtn:"[data-name=chart-btn]"},regions:{filterWrap:"[data-name=filter-tab-wrap]"},events:function(){var a={};return a["click "+this.ui.chartBtn]="_chartBtnClickHandler",a},defaults:{tab:["data","status","source","department","staff","scope","class","sort"],tabResizeChange:!0,tabOptions:{date:{tabTitle:"时间",tabLeftLine:!1,inResult:!0,options:{}},department:{tabTitle:"部门",tabLeftLine:!1,inResult:!0,options:{}},staff:{tabTitle:"人员",inResult:!0,tabLeftLine:!1,options:{}},"class":{tabTitle:"分类",inResult:!0,tabLeftLine:!1,options:{zIndex:1030}},status:{tabTitle:"状态",inResult:!0,isMult:!1,allCheckedName:"全部状态",data:[],viewType:"dropDownList",changeTabTitle:!1,tabLeftLine:!1,activeOrder:""},source:{tabTitle:"来源",inResult:!0,isMult:!0,allCheckedName:"全部来源",data:[],viewType:"dropDownList",changeTabTitle:!1,tabLeftLine:!1,activeOrder:""},sort:{tabTitle:"系统默认排序",inResult:!1,changeTabTitle:!0,data:[],viewType:"dropDownList",activeOrder:"",clickItemHide:!1,tabLeftLine:!1,saveSuccessInfo:"",save:{support:!1,saveRequest:function(){}}},scope:{activeOrder:"",tabTitle:"范围",inResult:!0,isMult:!0,allCheckedName:"全部范围",changeTabTitle:!1,rely:"",data:[],viewType:"dropDownList",tabLeftLine:!1}},storeData:[],saveFilterResult:{support:!1,saveRequest:function(){},unSaveRequest:function(){}},hasFilterTab:!0,search:{show:!0,placeholder:"请输入关键字"},chart:{show:!1},extendTab:[],dealextendStoreDataCallback:function(a,b){},clickExtendTabCallback:function(a,b){},dealExtendDeleteCallback:function(a){}},initialize:function(){this._initOptions(this.options)},_initOptions:function(b){var c,d=this,e=b,f=this.defaults.tabOptions;c=_.isArray(e.tab)?e.tab:this.defaults.tab;var g=[];a._.each(c,function(b){var c=a._.extend({},f[b],e.tabOptions&&e.tabOptions[b]||{},{tabName:b});if("dropDownList"===c.viewType){var h=c.data,j=i[b],k=[];_.isEmpty(h)?k=j:a._.each(h,function(b){d._isNumber(b)&&a._.each(j,function(a){_.indexOf(a.order,String(b))>-1&&k.push(a)}),_.isArray(b)&&!_.isEmpty(b)&&a._.each(j,function(a){_.indexOf(a.order,String(b[0]))>-1&&k.push(a)}),!_.isObject(b)||_.isArray(b)||_.isEmpty(b)||k.push(b)}),c.data=k}g.push(c)}),this.options.tab=g,this.settings=a._.extend({},this.defaults,this.options),_.isArray(this.settings.extendTab)&&!_.isEmpty(this.settings.extendTab)&&(this.settings.tab=this.settings.tab.concat(this.settings.extendTab)),delete this.settings.tabOptions,this.model=new a.Model(this.settings)},_isNumber:function(a){return _.isObject(a)||!_.isNumber(+a)||_.isNaN(+a)?!1:!0},onRender:function(){this.settings.search.show&&this._renderSearchView()},onShow:function(){this._renderFilterTabView(),$("body").trigger("OEMGlobalFind.loadSuccess")},_renderFilterTabView:function(){this.filterTabView&&this.filterTabView.close(),this.filterTabView=new f({model:this.model}),this.listenTo(this.filterTabView,"clear",function(a){this._renderFilterTabView(),this.settings.search.show&&this._renderSearchView(),this.trigger("result",a)}),this.listenTo(this.filterTabView,"closeItem",function(a){this.trigger("closeItem",a)}),this.listenTo(this.filterTabView,"result",function(a){this.settings.search.show&&this._renderSearchView(),this.trigger("result",a)}),this.filterWrap.show(this.filterTabView)},_renderSearchView:function(){this.searchView&&this.searchView.close(),this.searchView=new g({placeholder:this.settings.search.placeholder,type:this.settings.search.type}),this.listenTo(this.searchView,"search",function(a){this.model.set("storeData",[]),this._renderFilterTabView(),this.trigger("search",a)}),this.listenTo(this.searchView,"cancel",function(){this._renderFilterTabView(),this.trigger("search")}),this.ui.searchWrap.append(this.searchView.render().$el)},_chartBtnClickHandler:function(a){if(a.stopPropagation(),this.settings.chart.show){var b=$(a.currentTarget);this.trigger("chartClick",b)}}})}),define("views/common/gantt/gantt-legend-view",["talent","templates/common"],function(a,b){return a.Layout.extend({template:b["common/gantt/gantt-legend"],className:"gantt__lengendTip",defaults:{node:"",container:"body"},initialize:function(b){var c=this;this.settings=a._.extend({},this.defaults,b),a.$(document).off("mousedown.gantt-tip"),a.$(document).on("mousedown.gantt-tip",function(){c.close()}),this.$el.off("mousedown.gantt-tip"),this.$el.on("mousedown.gantt-tip",function(a){a.stopPropagation()})},onRender:function(){a.Context.setPosition(this.settings.node,this.$el,{pos:"leftBottom",container:this.settings.container,leftBias:-90,topBias:5})}})}),"undefined"==typeof window.dhx4&&(window.dhx4={version:"4.1.3",skin:null,skinDetect:function(a){return{10:"dhx_skyblue",20:"dhx_web",30:"dhx_terrace"}[this.readFromCss(a+"_skin_detect")]||null},readFromCss:function(a,b){var c=document.createElement("DIV");c.className=a,null!=document.body.firstChild?document.body.insertBefore(c,document.body.firstChild):document.body.appendChild(c);var d=c[b||"offsetWidth"];return c.parentNode.removeChild(c),c=null,d},lastId:1,newId:function(){return this.lastId++},zim:{data:{},step:5,first:function(){return 100},last:function(){var a=this.first();for(var b in this.data)a=Math.max(a,this.data[b]);return a},reserve:function(a){return this.data[a]=this.last()+this.step,this.data[a]},clear:function(a){null!=this.data[a]&&(this.data[a]=null,delete this.data[a])}},s2b:function(a){return"string"==typeof a&&(a=a.toLowerCase()),1==a||1==a||"true"==a||"1"==a||"yes"==a||"y"==a},s2j:function(s){var obj=null;dhx4.temp=null;try{eval("dhx4.temp="+s)}catch(e){dhx4.temp=null}return obj=dhx4.temp,dhx4.temp=null,obj},absLeft:function(a){return"string"==typeof a&&(a=document.getElementById(a)),this.getOffset(a).left},absTop:function(a){return"string"==typeof a&&(a=document.getElementById(a)),this.getOffset(a).top},_aOfs:function(a){for(var b=0,c=0;a;)b+=parseInt(a.offsetTop),c+=parseInt(a.offsetLeft),a=a.offsetParent;return{top:b,left:c}},_aOfsRect:function(a){var b=a.getBoundingClientRect(),c=document.body,d=document.documentElement,e=window.pageYOffset||d.scrollTop||c.scrollTop,f=window.pageXOffset||d.scrollLeft||c.scrollLeft,g=d.clientTop||c.clientTop||0,h=d.clientLeft||c.clientLeft||0,i=b.top+e-g,j=b.left+f-h;return{top:Math.round(i),left:Math.round(j)}},getOffset:function(a){return a.getBoundingClientRect?this._aOfsRect(a):this._aOfs(a)},_isObj:function(a){return null!=a&&"object"==typeof a&&"undefined"==typeof a.length},_copyObj:function(a){if(this._isObj(a)){var b={};for(var c in a)"object"==typeof a[c]&&null!=a[c]?b[c]=this._copyObj(a[c]):b[c]=a[c]}else for(var b=[],c=0;c<a.length;c++)"object"==typeof a[c]&&null!=a[c]?b[c]=this._copyObj(a[c]):b[c]=a[c];return b},screenDim:function(){var a=navigator.userAgent.indexOf("MSIE")>=0,b={};return b.left=document.body.scrollLeft,b.right=b.left+(window.innerWidth||document.body.clientWidth),b.top=Math.max((a?document.documentElement:document.getElementsByTagName("html")[0]).scrollTop,document.body.scrollTop),b.bottom=b.top+(a?Math.max(document.documentElement.clientHeight||0,document.documentElement.offsetHeight||0):window.innerHeight),b},selectTextRange:function(a,b,c){a="string"==typeof a?document.getElementById(a):a;var d=a.value.length;if(b=Math.max(Math.min(b,d),0),c=Math.min(c,d),a.setSelectionRange)try{a.setSelectionRange(b,c)}catch(e){}else if(a.createTextRange){var f=a.createTextRange();f.moveStart("character",b),f.moveEnd("character",c-d);try{f.select()}catch(e){}}},transData:null,transDetect:function(){if(null==this.transData){this.transData={transProp:!1,transEv:null};var a={MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd",OTransition:"oTransitionEnd",msTransition:"transitionend",transition:"transitionend"};for(var b in a)0==this.transData.transProp&&null!=document.documentElement.style[b]&&(this.transData.transProp=b,this.transData.transEv=a[b]);a=null}return this.transData},_xmlNodeValue:function(a){for(var b="",c=0;c<a.childNodes.length;c++)b+=null!=a.childNodes[c].nodeValue?a.childNodes[c].nodeValue.toString().replace(/^[\n\r\s]{0,}/,"").replace(/[\n\r\s]{0,}$/,""):"";return b}},window.dhx4.isIE=navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isIE6=null==window.XMLHttpRequest&&navigator.userAgent.indexOf("MSIE")>=0,window.dhx4.isIE7=navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0,window.dhx4.isIE8=navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0,window.dhx4.isOpera=navigator.userAgent.indexOf("Opera")>=0,window.dhx4.isChrome=navigator.userAgent.indexOf("Chrome")>=0,window.dhx4.isKHTML=navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0,window.dhx4.isFF=navigator.userAgent.indexOf("Firefox")>=0,window.dhx4.isIPad=navigator.userAgent.search(/iPad/gi)>=0),"undefined"==typeof window.dhx4.ajax&&(window.dhx4.ajax={cache:!1,method:"get",parse:function(a){if("string"!=typeof a)return a;if(a=a.replace(/^[\s]+/,""),window.DOMParser&&!dhx4.isIE)var b=(new window.DOMParser).parseFromString(a,"text/xml");else if(window.ActiveXObject!==window.undefined){var b=new window.ActiveXObject("Microsoft.XMLDOM");b.async="false",b.loadXML(a)}return b},xmltop:function(a,b,c){if("undefined"==typeof b.status||b.status<400){var d=b.responseXML?b.responseXML||b:dhx4.ajax.parse(b.responseText||b);if(d&&null!==d.documentElement&&!d.getElementsByTagName("parsererror").length)return d.getElementsByTagName(a)[0]}return-1!==c&&dhx4.callEvent("onLoadXMLError",["Incorrect XML",arguments[1],c]),document.createElement("DIV")},xpath:function(a,b){if(b.nodeName||(b=b.responseXML||b),dhx4.isIE)return b.selectNodes(a)||[];for(var c,d=[],e=(b.ownerDocument||b).evaluate(a,b,null,XPathResult.ANY_TYPE,null);c=e.iterateNext();)d.push(c);return d},query:function(a){dhx4.ajax._call(a.method||"GET",a.url,a.data||"",a.async||!0,a.callback,null,a.headers)},get:function(a,b){this._call("GET",a,null,!0,b)},getSync:function(a){return this._call("GET",a,null,!1)},put:function(a,b,c){this._call("PUT",a,b,!0,c)},del:function(a,b,c){this._call("DELETE",a,b,!0,c)},post:function(a,b,c){1==arguments.length?b="":2!=arguments.length||"function"!=typeof b&&"function"!=typeof window[b]?b=String(b):(c=b,b=""),this._call("POST",a,b,!0,c)},postSync:function(a,b){return b=null==b?"":String(b),this._call("POST",a,b,!1)},getLong:function(a,b){this._call("GET",a,null,!0,b,{url:a})},postLong:function(a,b,c){2==arguments.length&&(c=b,b=""),this._call("POST",a,b,!0,c,{url:a,postData:b})},_call:function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==d&&(h.onreadystatechange=function(){if(4==h.readyState||1==i&&3==h.readyState){if((200!=h.status||""==h.responseText)&&!dhx4.callEvent("onAjaxError",[h]))return;window.setTimeout(function(){"function"==typeof e&&e.apply(window,[{xmlDoc:h}]),null!=f&&("undefined"!=typeof f.postData?dhx4.ajax.postLong(f.url,f.postData,e):dhx4.ajax.getLong(f.url,e)),e=null,h=null},1)}}),"GET"==a&&1!=this.cache&&(b+=(b.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),h.open(a,b,d),g)for(var j in g)h.setRequestHeader(j,g[j]);else"POST"==a.toUpperCase()||"PUT"==a||"DELETE"==a?h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==a&&(c=null);return h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c),d?void 0:{xmlDoc:h}}}),"undefined"==typeof window.dhx4._eventable&&(window.dhx4._eventable=function(a,b){return"clear"==b?(a.detachAllEvents(),a.dhxevs=null,a.attachEvent=null,a.detachEvent=null,a.checkEvent=null,a.callEvent=null,a.detachAllEvents=null,void(a=null)):(a.dhxevs={data:{}},a.attachEvent=function(a,b){a=String(a).toLowerCase(),this.dhxevs.data[a]||(this.dhxevs.data[a]={});var c=window.dhx4.newId();return this.dhxevs.data[a][c]=b,c},a.detachEvent=function(a){for(var b in this.dhxevs.data){var c=0;for(var d in this.dhxevs.data[b])d==a?(this.dhxevs.data[b][d]=null,delete this.dhxevs.data[b][d]):c++;0==c&&(this.dhxevs.data[b]=null,delete this.dhxevs.data[b])}},a.checkEvent=function(a){return a=String(a).toLowerCase(),null!=this.dhxevs.data[a]},a.callEvent=function(a,b){if(a=String(a).toLowerCase(),null==this.dhxevs.data[a])return!0;var c=!0;for(var d in this.dhxevs.data[a])c=this.dhxevs.data[a][d].apply(this,b)&&c;return c},a.detachAllEvents=function(){for(var a in this.dhxevs.data){for(var b in this.dhxevs.data[a])this.dhxevs.data[a][b]=null,delete this.dhxevs.data[a][b];this.dhxevs.data[a]=null,delete this.dhxevs.data[a]}},void(a=null))},dhx4._eventable(dhx4)),"undefined"==typeof window.dhtmlx&&(window.dhtmlx={extend:function(a,b){for(var c in b)a[c]||(a[c]=b[c]);return a},extend_api:function(a,b,c){var d=window[a];d&&(window[a]=function(a){if(a&&"object"==typeof a&&!a.tagName){var c=d.apply(this,b._init?b._init(a):arguments);for(var e in dhtmlx)b[e]&&this[b[e]](dhtmlx[e]);for(var e in a)b[e]?this[b[e]](a[e]):0===e.indexOf("on")&&this.attachEvent(e,a[e])}else var c=d.apply(this,arguments);return b._patch&&b._patch(this),c||this},window[a].prototype=d.prototype,c&&dhtmlx.extend(window[a].prototype,c))},url:function(a){return-1!=a.indexOf("?")?"&":"?"}}),_isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1,-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,(-1!=navigator.appVersion.indexOf("MSIE 8.0")||-1!=navigator.appVersion.indexOf("MSIE 9.0")||-1!=navigator.appVersion.indexOf("MSIE 10.0")||document.documentMode>7)&&"BackCompat"!=document.compatMode&&(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),"undefined"==typeof window.dhtmlxEvent,null==dhtmlxEvent.touchDelay&&(dhtmlxEvent.touchDelay=2e3),"undefined"==typeof dhtmlxEvent.initTouch&&(dhtmlxEvent.initTouch=function(){function a(){if(c){var a=document.createEvent("HTMLEvents");a.initEvent("dblclick",!0,!0),c.dispatchEvent(a),b=c=null}}var b,c,d,e;dhtmlxEvent(document.body,"touchstart",function(f){c=f.touches[0].target,d=f.touches[0].clientX,e=f.touches[0].clientY,b=window.setTimeout(a,dhtmlxEvent.touchDelay)}),dhtmlxEvent(document.body,"touchmove",function(a){b&&(Math.abs(a.touches[0].clientX-d)>50||Math.abs(a.touches[0].clientY-e)>50)&&(window.clearTimeout(b),b=c=!1)}),dhtmlxEvent(document.body,"touchend",function(a){b&&(window.clearTimeout(b),b=c=!1)}),dhtmlxEvent.initTouch=function(){}}),window.dhtmlx||(window.dhtmlx={}),function(){function a(a,b){var d=a.callback;c(!1),a.box.parentNode.removeChild(a.box),m=a.box=null,d&&d(b)}function b(b){if(m){b=b||event;var c=b.which||event.keyCode;return dhtmlx.message.keyboard&&((13==c||32==c)&&a(m,!0),27==c&&a(m,!1)),b.preventDefault&&b.preventDefault(),!(b.cancelBubble=!0)}}function c(a){c.cover||(c.cover=document.createElement("DIV"),c.cover.onkeydown=b,c.cover.className="dhx_modal_cover",document.body.appendChild(c.cover));document.body.scrollHeight;c.cover.style.display=a?"inline-block":"none"}function d(a,b){var c="dhtmlx_"+a.toLowerCase().replace(/ /g,"_")+"_button";return"<div class='dhtmlx_popup_button "+c+"' result='"+b+"' ><div>"+a+"</div></div>"}function e(a){n.area||(n.area=document.createElement("DIV"),n.area.className="dhtmlx_message_area",n.area.style[n.position]="5px",document.body.appendChild(n.area)),n.hide(a.id);var b=document.createElement("DIV");return b.innerHTML="<div>"+a.text+"</div>",b.className="dhtmlx-info dhtmlx-"+a.type,b.onclick=function(){n.hide(a.id),a=null},"bottom"==n.position&&n.area.firstChild?n.area.insertBefore(b,n.area.firstChild):n.area.appendChild(b),a.expire>0&&(n.timers[a.id]=window.setTimeout(function(){n.hide(a.id)},a.expire)),n.pull[a.id]=b,b=null,a.id}function f(b,c,e){var f=document.createElement("DIV");f.className=" dhtmlx_modal_box dhtmlx-"+b.type,f.setAttribute("dhxbox",1);var g="";if(b.width&&(f.style.width=b.width),b.height&&(f.style.height=b.height),b.title&&(g+='<div class="dhtmlx_popup_title">'+b.title+"</div>"),g+='<div class="dhtmlx_popup_text"><span>'+(b.content?"":b.text)+'</span></div><div  class="dhtmlx_popup_controls">',c&&(g+=d(b.ok||"OK",!0)),e&&(g+=d(b.cancel||"Cancel",!1)),b.buttons)for(var h=0;h<b.buttons.length;h++)g+=d(b.buttons[h],h);if(g+="</div>",f.innerHTML=g,b.content){var i=b.content;"string"==typeof i&&(i=document.getElementById(i)),"none"==i.style.display&&(i.style.display=""),f.childNodes[b.title?1:0].appendChild(i)}return f.onclick=function(c){c=c||event;var d=c.target||c.srcElement;if(d.className||(d=d.parentNode),"dhtmlx_popup_button"==d.className.split(" ")[0]){var e=d.getAttribute("result");e="true"==e||("false"==e?!1:e),a(b,e)}},b.box=f,(c||e)&&(m=b),f}function g(a,d,e){var g=a.tagName?a:f(a,d,e);a.hidden||c(!0),document.body.appendChild(g);var h=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-g.offsetWidth)/2)),i=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-g.offsetHeight)/2));return"top"==a.position?g.style.top="-3px":g.style.top=i+"px",g.style.left=h+"px",g.onkeydown=b,g.focus(),a.hidden&&dhtmlx.modalbox.hide(g),g}function h(a){return g(a,!0,!1)}function i(a){return g(a,!0,!0)}function j(a){return g(a)}function k(a,b,c){return"object"!=typeof a&&("function"==typeof b&&(c=b,b=""),a={text:a,type:b,callback:c}),a}function l(a,b,c,d){return"object"!=typeof a&&(a={text:a,type:b,expire:c,id:d}),a.id=a.id||n.uid(),a.expire=a.expire||n.expire,a}var m=null;document.attachEvent?document.attachEvent("onkeydown",b):document.addEventListener("keydown",b,!0),dhtmlx.alert=function(){var a=k.apply(this,arguments);return a.type=a.type||"confirm",h(a)},dhtmlx.confirm=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",i(a)},dhtmlx.modalbox=function(){var a=k.apply(this,arguments);return a.type=a.type||"alert",j(a)},dhtmlx.modalbox.hide=function(a){for(;a&&a.getAttribute&&!a.getAttribute("dhxbox");)a=a.parentNode;a&&(a.parentNode.removeChild(a),c(!1))};var n=dhtmlx.message=function(a,b,c,d){a=l.apply(this,arguments),a.type=a.type||"info";var f=a.type.split("-")[0];switch(f){case"alert":return h(a);case"confirm":return i(a);case"modalbox":return j(a);default:return e(a)}};n.seed=(new Date).valueOf(),n.uid=function(){return n.seed++},n.expire=4e3,n.keyboard=!0,n.position="top",n.pull={},n.timers={},n.hideAll=function(){for(var a in n.pull)n.hide(a)},n.hide=function(a){var b=n.pull[a];b&&b.parentNode&&(window.setTimeout(function(){b.parentNode.removeChild(b),b=null},2e3),b.className+=" hidden",n.timers[a]&&window.clearTimeout(n.timers[a]),delete n.pull[a])}}(),dataProcessor.prototype={setTransactionMode:function(a,b){"object"==typeof a?(this._tMode=a.mode||this._tMode,
this._headers=this._headers||a.headers,this._payload=this._payload||a.payload):(this._tMode=a,this._tSend=b),"REST"==this._tMode&&(this._tSend=!1,this._endnm=!0)},escape:function(a){return this._utf?encodeURIComponent(a):escape(a)},enableUTFencoding:function(a){this._utf=dhx4.s2b(a)},setDataColumns:function(a){this._columns="string"==typeof a?a.split(","):a},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(a){this._endnm=dhx4.s2b(a)},enablePartialDataSend:function(a){this._changed=dhx4.s2b(a)},setUpdateMode:function(a,b){this.autoUpdate="cell"==a,this.updateMode=a,this.dnd=b},ignore:function(a,b){this._silent_mode=!0,a.call(b||window),this._silent_mode=!1},setUpdated:function(a,b,c){if(!this._silent_mode){var d=this.findRow(a);c=c||"updated";var e=this.obj.getUserData(a,this.action_param);e&&"updated"==c&&(c=e),b?(this.set_invalid(a,!1),this.updatedRows[d]=a,this.obj.setUserData(a,this.action_param,c),this._in_progress[a]&&(this._in_progress[a]="wait")):this.is_invalid(a)||(this.updatedRows.splice(d,1),this.obj.setUserData(a,this.action_param,"")),b||this._clearUpdateFlag(a),this.markRow(a,b,c),b&&this.autoUpdate&&this.sendData(a)}},_clearUpdateFlag:function(a){},markRow:function(a,b,c){var d="",e=this.is_invalid(a);if(e&&(d=this.styles[e],b=!0),this.callEvent("onRowMark",[a,b,c,e])&&(d=this.styles[b?c:"clear"]+d,this.obj[this._methods[0]](a,d),e&&e.details)){d+=this.styles[e+"_cell"];for(var f=0;f<e.details.length;f++)e.details[f]&&this.obj[this._methods[1]](a,f,d)}},getState:function(a){return this.obj.getUserData(a,this.action_param)},is_invalid:function(a){return this._invalid[a]},set_invalid:function(a,b,c){c&&(b={value:b,details:c,toString:function(){return this.value.toString()}}),this._invalid[a]=b},checkBeforeUpdate:function(a){return!0},sendData:function(a){return!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2?(this.obj.editStop&&this.obj.editStop(),"undefined"==typeof a||this._tSend?this.sendAllData():this._in_progress[a]?!1:(this.messages=[],!this.checkBeforeUpdate(a)&&this.callEvent("onValidationError",[a,this.messages])?!1:void this._beforeSendData(this._getRowData(a),a))):void 0},_beforeSendData:function(a,b){return this.callEvent("onBeforeUpdate",[b,this.getState(b),a])?void this._sendData(a,b):!1},serialize:function(a,b){if("string"==typeof a)return a;if("undefined"!=typeof b)return this.serialize_one(a,"");var c=[],d=[];for(var e in a)a.hasOwnProperty(e)&&(c.push(this.serialize_one(a[e],e+this.post_delim)),d.push(e));return c.push("ids="+this.escape(d.join(","))),dhtmlx.security_key&&c.push("dhx_security="+dhtmlx.security_key),c.join("&")},serialize_one:function(a,b){if("string"==typeof a)return a;var c=[];for(var d in a)if(a.hasOwnProperty(d)){if(("id"==d||d==this.action_param)&&"REST"==this._tMode)continue;c.push(this.escape((b||"")+d)+"="+this.escape(a[d]))}return c.join("&")},_sendData:function(a,b){if(a){if(!this.callEvent("onBeforeDataSending",b?[b,this.getState(b),a]:[null,null,a]))return!1;b&&(this._in_progress[b]=(new Date).valueOf());var c=this,d=function(d){var e=[];if(b)e.push(b);else if(a)for(var f in a)e.push(f);return c.afterUpdate(c,d,e)},e=this.serverProcessor+(this._user?dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):"");if("GET"==this._tMode)dhx4.ajax.get(e+(-1!=e.indexOf("?")?"&":"?")+this.serialize(a,b),d);else if("POST"==this._tMode)dhx4.ajax.post(e,this.serialize(a,b),d);else if("REST"==this._tMode){var f=this.getState(b),g=e.replace(/(\&|\?)editing\=true/,""),h="",i="post";if("inserted"==f?h=this.serialize(a,b):"deleted"==f?(i="DELETE",g=g+("/"==g.slice(-1)?"":"/")+b):(i="PUT",h=this.serialize(a,b),g=g+("/"==g.slice(-1)?"":"/")+b),this._payload)for(var j in this._payload)g=g+dhtmlx.url(g)+this.escape(j)+"="+this.escape(this._payload[j]);dhx4.ajax.query({url:g,method:i,headers:this._headers,data:h,callback:d})}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var a=!0,b=0;b<this.updatedRows.length;b++)a&=this.checkBeforeUpdate(this.updatedRows[b]);if(!a&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(var b=0;b<this.updatedRows.length;b++)if(!this._in_progress[this.updatedRows[b]]){if(this.is_invalid(this.updatedRows[b]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[b]),this.updatedRows[b]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(a){for(var b={},c=!1,d=0;d<this.updatedRows.length;d++){var e=this.updatedRows[d];this._in_progress[e]||this.is_invalid(e)||this.callEvent("onBeforeUpdate",[e,this.getState(e),this._getRowData(e)])&&(b[e]=this._getRowData(e,e+this.post_delim),c=!0,this._in_progress[e]=(new Date).valueOf())}return c?b:null},setVerificator:function(a,b){this.mandatoryFields[a]=b||function(a){return""!==a}},clearVerificator:function(a){this.mandatoryFields[a]=!1},findRow:function(a){var b=0;for(b=0;b<this.updatedRows.length&&a!=this.updatedRows[b];b++);return b},defineAction:function(a,b){this._uActions||(this._uActions=[]),this._uActions[a]=b},afterUpdateCallback:function(a,b,c,d){var e=a,f="error"!=c&&"invalid"!=c;if(f||this.set_invalid(a,c),this._uActions&&this._uActions[c]&&!this._uActions[c](d))return delete this._in_progress[e];"wait"!=this._in_progress[e]&&this.setUpdated(a,!1);var g=a;switch(c){case"inserted":case"insert":b!=a&&(this.obj[this._methods[2]](a,b),a=b);break;case"delete":case"deleted":return this.obj.setUserData(a,this.action_param,"true_deleted"),this.obj[this._methods[3]](a),delete this._in_progress[e],this.callEvent("onAfterUpdate",[a,c,b,d])}"wait"!=this._in_progress[e]?(f&&this.obj.setUserData(a,this.action_param,""),delete this._in_progress[e]):(delete this._in_progress[e],this.setUpdated(b,!0,this.obj.getUserData(a,this.action_param))),this.callEvent("onAfterUpdate",[g,c,b,d])},afterUpdate:function(a,b,c){if(window.JSON)try{var d=JSON.parse(b.xmlDoc.responseText),e=d.action||this.getState(c)||"updated",f=d.sid||c[0],g=d.tid||c[0];return a.afterUpdateCallback(f,g,e,d),void a.finalizeUpdate()}catch(h){}var i=dhx4.ajax.xmltop("data",b.xmlDoc);if(!i)return this.cleanUpdate(c);var j=dhx4.ajax.xpath("//data/action",i);if(!j.length)return this.cleanUpdate(c);for(var k=0;k<j.length;k++){var l=j[k],e=l.getAttribute("type"),f=l.getAttribute("sid"),g=l.getAttribute("tid");a.afterUpdateCallback(f,g,e,l)}a.finalizeUpdate()},cleanUpdate:function(a){if(a)for(var b=0;b<a.length;b++)delete this._in_progress[a[b]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(a){this.obj=a,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(a){this.attachEvent("onAfterUpdate",a)},enableDebug:function(a){},setOnBeforeUpdateHandler:function(a){this.attachEvent("onBeforeDataSending",a)},setAutoUpdate:function(a,b){a=a||2e3,this._user=b||(new Date).valueOf(),this._need_update=!1,this._loader=null,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(a,b,c,d){this.afterAutoUpdate(a,b,c,d)}),this.attachEvent("onFullSync",function(){this.fullSync()});var c=this;window.setInterval(function(){c.loadUpdate()},a)},afterAutoUpdate:function(a,b,c,d){return"collision"==b?(this._need_update=!0,!1):!0},fullSync:function(){return 1==this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(a,b){return this._update_busy?!1:(this._update_busy=!0,this._loader=this._loader||new dtmlXMLLoaderObject(!0),this._loader.async=!0,this._loader.waitCall=b,void this._loader.loadXML(a))},_v:function(a){return a.firstChild?a.firstChild.nodeValue:""},_a:function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this._v(a[c]);return b},loadUpdate:function(){var a=this,b=this.obj.getUserData(0,"version"),c=this.serverProcessor+dhtmlx.url(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+b].join("&");c=c.replace("editing=true&",""),this.getUpdates(c,function(){var b=a._loader.doXPath("//userdata");a.obj.setUserData(0,"version",a._v(b[0]));var c=a._loader.doXPath("//update");if(c.length){a._silent_mode=!0;for(var d=0;d<c.length;d++){var e=c[d].getAttribute("status"),f=c[d].getAttribute("id"),g=c[d].getAttribute("parent");switch(e){case"inserted":a.callEvent("insertCallback",[c[d],f,g]);break;case"updated":a.callEvent("updateCallback",[c[d],f,g]);break;case"deleted":a.callEvent("deleteCallback",[c[d],f,g])}}a._silent_mode=!1}a._update_busy=!1,a=null})}},window.Gantt={_seed:0},Gantt.plugin=function(a){this._ganttPlugin.push(a),a(window.gantt)},Gantt._ganttPlugin=[],Gantt.getGanttInstance=function(){function dhtmlxDetachEvent(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent&&a.detachEvent("on"+b,c)}function dhtmlxDnD(a,b){b&&(this._settings=b),dhtmlxEventable(this),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(c){b.original_target={target:c.target||c.srcElement},this.dragStart(a,c)},this))}var gantt={version:"3.3.0"};gantt={version:"3.3.0"},dhtmlxEventable=function(obj){obj._silent_mode=!1,obj._silentStart=function(){this._silent_mode=!0},obj._silentEnd=function(){this._silent_mode=!1},obj.attachEvent=function(a,b,c){return a="ev_"+a.toLowerCase(),this[a]||(this[a]=new this._eventCatcher(c||this)),a+":"+this[a].addEvent(b)},obj.callEvent=function(a,b){return this._silent_mode?!0:(a="ev_"+a.toLowerCase(),this[a]?this[a].apply(this,b):!0)},obj.checkEvent=function(a){return!!this["ev_"+a.toLowerCase()]},obj._eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var a=!0,b=0;b<dhx_catch.length;b++)if(dhx_catch[b]){var c=dhx_catch[b].apply(obj,arguments);a=a&&c}return a};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),ev?dhx_catch.push(ev)-1:!1},z.removeEvent=function(a){dhx_catch[a]=null},z},obj.detachEvent=function(a){if(a){var b=a.split(":");this[b[0]].removeEvent(b[1])}},obj.detachAllEvents=function(){for(var a in this)0===a.indexOf("ev_")&&delete this[a]},obj=null},dhtmlx.copy=function(a){var b,c,d;if(a&&"object"==typeof a){for(d={},c=[Array,Date,Number,String,Boolean],b=0;b<c.length;b++)a instanceof c[b]&&(d=b?new c[b](a):new c[b]);for(b in a)Object.prototype.hasOwnProperty.apply(a,[b])&&(d[b]=dhtmlx.copy(a[b]))}return d||a},dhtmlx.mixin=function(a,b,c){for(var d in b)(!a[d]||c)&&(a[d]=b[d]);return a},dhtmlx.defined=function(a){return"undefined"!=typeof a},dhtmlx.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++,this._seed},dhtmlx.bind=function(a,b){return a.bind?a.bind(b):function(){return a.apply(b,arguments)}},gantt._get_position=function(a){var b=0,c=0;if(a.getBoundingClientRect){var d=a.getBoundingClientRect(),e=document.body,f=document.documentElement,g=window.pageYOffset||f.scrollTop||e.scrollTop,h=window.pageXOffset||f.scrollLeft||e.scrollLeft,i=f.clientTop||e.clientTop||0,j=f.clientLeft||e.clientLeft||0;return b=d.top+g-i,c=d.left+h-j,{y:Math.round(b),x:Math.round(c),width:a.offsetWidth,height:a.offsetHeight}}for(;a;)b+=parseInt(a.offsetTop,10),c+=parseInt(a.offsetLeft,10),a=a.offsetParent;return{y:b,x:c,width:a.offsetWidth,height:a.offsetHeight}},gantt._detectScrollSize=function(){var a=document.createElement("div");a.style.cssText="visibility:hidden;position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;height:110px;min-height:100px;overflow-y:scroll;",document.body.appendChild(a);var b=a.offsetWidth-a.clientWidth;return document.body.removeChild(a),b},window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b,c){var d=document.createElement("DIV");d.id="gantt_"+dhtmlx.uid(),d.style.width="100%",d.style.height="100%",d.cmp="grid",c=c||window.gantt,document.body.appendChild(d),this.attachObject(d.id);var e=this.vs[this.av];e.grid=c,c.init(d.id,a,b),d.firstChild.style.border="none",e.gridId=d.id,e.gridObj=d;var f="_viewRestore";return this.vs[this[f]()].grid}),"undefined"!=typeof window.dhtmlXCellObject&&(dhtmlXCellObject.prototype.attachGantt=function(a,b,c){var d=document.createElement("DIV");d.id="gantt_"+dhtmlx.uid(),d.style.width="100%",d.style.height="100%",d.cmp="grid",document.body.appendChild(d),this.attachObject(d.id),c=c||window.gantt,c.init(d.id,a,b),d.firstChild.style.border="none";return d=null,this.callEvent("_onContentAttach",[]),this.dataObj}),dhtmlxEventable(gantt),dhx4.ajax.cache=!0,gantt._click={},gantt._dbl_click={},gantt._context_menu={},gantt._on_click=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a),d=!0;if(null!==c?d=!gantt.checkEvent("onTaskClick")||gantt.callEvent("onTaskClick",[c,a]):gantt.callEvent("onEmptyClick",[a]),d){var e=gantt._find_ev_handler(a,b,gantt._click,c);if(!e)return;c&&gantt.getTask(c)&&gantt.config.select_task&&gantt.selectTask(c)}},gantt._on_contextmenu=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(b),d=gantt.locate(b,gantt.config.link_attribute),e=!gantt.checkEvent("onContextMenu")||gantt.callEvent("onContextMenu",[c,d,a]);return e||(a.preventDefault?a.preventDefault():a.returnValue=!1),e},gantt._find_ev_handler=function(a,b,c,d){for(var e=!0;b;){var f=gantt._getClassName(b);if(f){f=f.split(" ");for(var g=0;g<f.length;g++)if(f[g]&&c[f[g]]){var h=c[f[g]].call(gantt,a,d,b);e=e&&!("undefined"!=typeof h&&h!==!0)}}b=b.parentNode}return e},gantt._on_dblclick=function(a){a=a||window.event;var b=a.target||a.srcElement,c=gantt.locate(a),d=!gantt.checkEvent("onTaskDblClick")||gantt.callEvent("onTaskDblClick",[c,a]);if(d){var e=gantt._find_ev_handler(a,b,gantt._dbl_click,c);if(!e)return;null!==c&&gantt.getTask(c)&&d&&gantt.config.details_on_dblclick&&gantt.showLightbox(c)}},gantt._on_mousemove=function(a){if(gantt.checkEvent("onMouseMove")){var b=gantt.locate(a);gantt._last_move_event=a,gantt.callEvent("onMouseMove",[b,a])}},dhtmlxDnD.prototype={dragStart:function(a,b){this.config={obj:a,marker:null,started:!1,pos:this.getPosition(b),sensitivity:4},this._settings&&dhtmlx.mixin(this.config,this._settings,!0);var c=dhtmlx.bind(function(b){return this.dragMove(a,b)},this),d=(dhtmlx.bind(function(b){return this.dragScroll(a,b)},this),dhtmlx.bind(function(a){return dhtmlx.defined(this.config.updates_per_second)&&!gantt._checkTimeout(this,this.config.updates_per_second)?!0:c(a)},this)),e=dhtmlx.bind(function(b){return dhtmlxDetachEvent(document.body,"mousemove",d),dhtmlxDetachEvent(document.body,"mouseup",e),this.dragEnd(a)},this);dhtmlxEvent(document.body,"mousemove",d),dhtmlxEvent(document.body,"mouseup",e),document.body.className+=" gantt_noselect"},dragMove:function(a,b){if(!this.config.marker&&!this.config.started){var c=this.getPosition(b),d=c.x-this.config.pos.x,e=c.y-this.config.pos.y,f=Math.sqrt(Math.pow(Math.abs(d),2)+Math.pow(Math.abs(e),2));if(f>this.config.sensitivity){if(this.config.started=!0,this.config.ignore=!1,this.callEvent("onBeforeDragStart",[a,this.config.original_target])===!1)return this.config.ignore=!0,!0;var g=this.config.marker=document.createElement("div");g.className="gantt_drag_marker",g.innerHTML="Dragging object",document.body.appendChild(g),this.callEvent("onAfterDragStart",[a,this.config.original_target])}else this.config.ignore=!0}this.config.ignore||(b.pos=this.getPosition(b),this.config.marker.style.left=b.pos.x+"px",this.config.marker.style.top=b.pos.y+"px",this.callEvent("onDragMove",[a,b]))},dragEnd:function(a){this.config.marker&&(this.config.marker.parentNode.removeChild(this.config.marker),this.config.marker=null,this.callEvent("onDragEnd",[])),document.body.className=document.body.className.replace(" gantt_noselect","")},getPosition:function(a){var b=0,c=0;return a=a||window.event,a.pageX||a.pageY?(b=a.pageX,c=a.pageY):(a.clientX||a.clientY)&&(b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,c=a.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:b,y:c}}},gantt._init_grid=function(){this._click.gantt_close=dhtmlx.bind(function(a,b,c){return this.close(b),!1},this),this._click.gantt_open=dhtmlx.bind(function(a,b,c){return this.open(b),!1},this),this._click.gantt_row=dhtmlx.bind(function(a,b,c){if(null!==b){var d=this.getTask(b);this.config.scroll_on_click&&this.showDate(d.start_date),this.callEvent("onTaskRowClick",[b,c])}},this),this._click.gantt_grid_head_cell=dhtmlx.bind(function(a,b,c){var d=c.getAttribute("column_id");if(this.callEvent("onGridHeaderClick",[d,a])){if("add"==d)return void this._click.gantt_add(a,this.config.root_id);if(this.config.sort){for(var e,f=d,g=0;this.config.columns.length;g++)if(this.config.columns[g].name==d){e=this.config.columns[g];break}if(e&&void 0!==e.sort&&e.sort!==!0&&(f=e.sort,!f))return;var h=this._sort&&this._sort.direction&&this._sort.name==d?this._sort.direction:"desc";h="desc"==h?"asc":"desc",this._sort={name:d,direction:h},this.sort(f,"desc"==h)}}},this),!this.config.sort&&this.config.order_branch&&this._init_dnd(),this._click.gantt_add=dhtmlx.bind(function(a,b,c){if(!this.config.readonly){var d={};return this.createTask(d,b?b:this.config.root_id),!1}},this),this._init_resize&&this._init_resize()},gantt._render_grid=function(){this._is_grid_visible()&&(this._calc_grid_width(),this._render_grid_header())},gantt._calc_grid_width=function(){for(var a=this.getGridColumns(),b=0,c=[],d=[],e=0;e<a.length;e++){var f=parseInt(a[e].width,10);window.isNaN(f)&&(f=50,c.push(e)),d[e]=f,b+=f}if(this.config.autofit||c.length){var g=this._get_grid_width()-b;g/(c.length>0?c.length:d.length>0?d.length:1);if(c.length>0)for(var h=g/(c.length?c.length:1),e=0;e<c.length;e++){var i=c[e];d[i]+=h}else for(var h=g/(d.length?d.length:1),e=0;e<d.length;e++)d[e]+=h;for(var e=0;e<d.length;e++)a[e].width=d[e]}else this.config.grid_width=b},gantt._render_grid_header=function(){for(var a=this.getGridColumns(),b=[],c=0,d=this.locale.labels,e=this.config.scale_height-2,f=0;f<a.length;f++){var g=f==a.length-1,h=a[f];g&&this._get_grid_width()>c+h.width&&(h.width=this._get_grid_width()-c),c+=h.width;var i=this._sort&&h.name==this._sort.name?"<div class='gantt_sort gantt_"+this._sort.direction+"'></div>":"",j=["gantt_grid_head_cell","gantt_grid_head_"+h.name,g?"gantt_last_cell":"",this.templates.grid_header_class(h.name,h)].join(" "),k="width:"+(h.width-(g?1:0))+"px;",l=h.label||d["column_"+h.name];l=l||"";var m="<div class='"+j+"' style='"+k+"' column_id='"+h.name+"'>"+l+i+"</div>";b.push(m)}this.$grid_scale.style.height=this.config.scale_height-1+"px",this.$grid_scale.style.lineHeight=e+"px",this.$grid_scale.style.width=c-1+"px",this.$grid_scale.innerHTML=b.join("")},gantt._render_grid_item=function(a){if(!gantt._is_grid_visible())return null;for(var b=this.getGridColumns(),c=[],d=0;d<b.length;d++){var e,f,g=d==b.length-1,h=b[d];"add"==h.name?f="<div class='gantt_add'></div>":(f=h.template?h.template(a):a[h.name],f instanceof Date&&(f=this.templates.date_grid(f,a)),f="<div class='gantt_tree_content'>"+f+"</div>");var i="gantt_cell"+(g?" gantt_last_cell":""),j="";if(h.tree){for(var k=0;k<a.$level;k++)j+=this.templates.grid_indent(a);var l=this._has_children(a.id);l?(j+=this.templates.grid_open(a),j+=this.templates.grid_folder(a)):(j+=this.templates.grid_blank(a),j+=this.templates.grid_file(a))}var m="width:"+(h.width-(g?1:0))+"px;";dhtmlx.defined(h.align)&&(m+="text-align:"+h.align+";"),e="<div class='"+i+"' style='"+m+"'>"+j+f+"</div>",c.push(e)}var i=a.$index%2===0?"":" odd";if(i+=a.$transparent?" gantt_transparent":"",i+=a.$dataprocessor_class?" "+a.$dataprocessor_class:"",this.templates.grid_row_class){var n=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);n&&(i+=" "+n)}this.getState().selected_task==a.id&&(i+=" gantt_selected");var o=document.createElement("div");return o.className="gantt_row"+i,o.style.height=this.config.row_height+"px",o.style.lineHeight=gantt.config.row_height+"px",o.setAttribute(this.config.task_attribute,a.id),o.innerHTML=c.join(""),o},gantt.open=function(a){gantt._set_item_state(a,!0),this.callEvent("onTaskOpened",[a])},gantt.close=function(a){gantt._set_item_state(a,!1),this.callEvent("onTaskClosed",[a])},gantt._set_item_state=function(a,b){a&&this._pull[a]&&(this._pull[a].$open=b,gantt._refresh_on_toggle_element(a))},gantt._refresh_on_toggle_element=function(a){this.refreshData()},gantt._is_grid_visible=function(){return this.config.grid_width&&this.config.show_grid},gantt._get_grid_width=function(){return this._is_grid_visible()?this._is_chart_visible()?this.config.grid_width:this._x:0},gantt.moveTask=function(a,b,c){var d=arguments[3];if(d){if(d===a)return;c=this.getParent(d),b=this.getTaskIndex(d)}if(a!=c){c=c||this.config.root_id;var e=this.getTask(a),f=this.getParent(e.id),g=(this.getChildren(this.getParent(e.id)),this.getChildren(c));if(-1==b&&(b=g.length+1),f==c){var h=this.getTaskIndex(a);if(h==b)return}if(this.callEvent("onBeforeTaskMove",[a,c,b])!==!1){this._replace_branch_child(f,a),g=this.getChildren(c);var i=g[b];i?g=g.slice(0,b).concat([a]).concat(g.slice(b)):g.push(a),this.setParent(e,c),this._branches[c]=g,e.$level=this.calculateTaskLevel(e),1*b>0?d?e.$drop_target=(this.getTaskIndex(a)>this.getTaskIndex(d)?"next:":"")+d:e.$drop_target="next:"+gantt.getPrevSibling(a):g[1*b+1]?e.$drop_target=g[1*b+1]:e.$drop_target=c,this.callEvent("onAfterTaskMove",[a,c,b])&&this.refreshData()}}},gantt._init_dnd=function(){var a=new dhtmlxDnD(this.$grid_data,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);if(!d)return!1;this.hideQuickInfo&&this._hideQuickInfo();var e=this.locate(c),f=gantt.getTask(e);return gantt._is_readonly(f)?!1:(a.config.initial_open_state=f.$open,this.callEvent("onRowDragStart",[e,c.target||c.srcElement,c])?void 0:!1)},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this._locateHTML(c);a.config.marker.innerHTML=d.outerHTML,a.config.id=this.locate(c);var e=this.getTask(a.config.id);a.config.index=this.getTaskIndex(a.config.id),a.config.parent=e.parent,e.$open=!1,e.$transparent=!0,this.refreshData()},this)),a.lastTaskOfLevel=function(a){for(var b=gantt._order,c=gantt._pull,d=null,e=0,f=b.length;f>e;e++)c[b[e]].$level==a&&(d=c[b[e]]);return d?d.id:null},a._getGridPos=dhtmlx.bind(function(a){var b=this._get_position(this.$grid_data),c=b.x,d=a.pos.y-10;return d<b.y&&(d=b.y),d>b.y+this.$grid_data.offsetHeight-this.config.row_height&&(d=b.y+this.$grid_data.offsetHeight-this.config.row_height),b.x=c,b.y=d,b},this),a.attachEvent("onDragMove",dhtmlx.bind(function(b,c){function d(a,b){return a.$level==b.$level||gantt.config.order_branch_free}var e=a.config,f=a._getGridPos(c);e.marker.style.left=f.x+10+"px",e.marker.style.top=f.y+"px",f=a._getGridPos(c);var g=(f.x,f.y),h=document.elementFromPoint(f.x-document.body.scrollLeft+1,g-document.body.scrollTop),i=this.locate(h),j=this.getTask(a.config.id);if(this.isTaskExists(i)||(i=a.lastTaskOfLevel(gantt.config.order_branch_free?j.$level:0),i==a.config.id&&(i=null)),this.isTaskExists(i)){var k=gantt._get_position(h),l=this.getTask(i);if(k.y+h.offsetHeight/2<g){var m=this.getGlobalTaskIndex(l.id),n=this._pull[this._order[m+1]];if(n){if(n.id==j.id)return;l=n}else if(n=this._pull[this._order[m]],d(n,j)&&n.id!=j.id)return void this.moveTask(j.id,-1,this.getParent(n.id))}for(var m=this.getGlobalTaskIndex(l.id),o=this._pull[this._order[m-1]],p=1;(!o||o.id==l.id)&&m-p>=0;)o=this._pull[this._order[m-p]],p++;if(j.id==l.id)return;d(l,j)&&j.id!=l.id?this.moveTask(j.id,0,0,l.id):l.$level!=j.$level-1||gantt.getChildren(l.id).length?o&&d(o,j)&&j.id!=o.id&&this.moveTask(j.id,-1,this.getParent(o.id)):this.moveTask(j.id,0,l.id)}return!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(){var b=this.getTask(a.config.id);this.callEvent("onBeforeRowDragEnd",[a.config.id,a.config.parent,a.config.index])===!1?(this.moveTask(a.config.id,a.config.index,a.config.parent),b.$drop_target=null):this.callEvent("onRowDragEnd",[a.config.id,b.$drop_target]),b.$transparent=!1,b.$open=a.config.initial_open_state,this.refreshData()},this))},gantt.getGridColumns=function(){return this.config.columns},gantt._has_children=function(a){return this.getChildren(a).length>0},gantt._render_grid_header_resize=function(){for(var a=this.getGridColumns(),b=0,c=this.config.scale_height,d=(this._get_position(this.$grid_scale),0);d<a.length;d++){var e=(d==a.length-1,a[d]);if(b+=e.width,e.resize){var f=document.createElement("div");f.className="gantt_grid_column_resize_wrap",f.style.top="0px",f.style.height=c+"px",f.innerHTML="<div class='gantt_grid_column_resize'></div>",f.setAttribute(this.config.grid_resizer_column_attribute,d),this.$grid_scale.appendChild(f),f.style.left=Math.max(0,b-1-f.offsetWidth/2)+"px"}}if(this.config.grid_resize){var g=document.createElement("div");g.className="gantt_grid_resize_wrap",g.style.top="0px",g.style.height=this.$grid.offsetHeight+"px",g.innerHTML="<div class='gantt_grid_resize'></div>",g.setAttribute(this.config.grid_resizer_attribute,!0),this.$grid_scale.appendChild(g),g.style.left=Math.max(0,this.config.grid_width-1-g.offsetWidth/2)+"px"}},gantt._init_resize=function(){var a=new dhtmlxDnD(this.$grid_scale,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(a.config.sensitivity=this.config.dnd_sensitivity),a.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){var c=this._locateHTML(b,this.config.grid_resizer_column_attribute);if(!c)return!1;var d=this.locate(b,this.config.grid_resizer_column_attribute),e=this.getGridColumns()[d];return gantt.callEvent("onColumnResizeStart",[d,e])===!1?!1:void 0},this)),a.attachEvent("onAfterDragStart",dhtmlx.bind(function(b,c){var d=this.locate(c,this.config.grid_resizer_column_attribute);a.config.marker.innerHTML="",a.config.marker.className+=" gantt_grid_resize_area",a.config.marker.style.height=this.$grid.offsetHeight+"px",a.config.marker.style.top="0px",a.config.drag_index=d},this)),a.attachEvent("onDragMove",dhtmlx.bind(function(b,c){var d=a.config,e=this.getGridColumns(),f=this._get_position(this.$grid_scale),g=parseInt(d.marker.style.left,10),h=this.config.min_grid_column_width,i=this.$grid_data.offsetWidth-this.config.min_grid_column_width*(e.length-d.drag_index-2),j=0,k=0;g-=f.x-1;for(var l=0;l<d.drag_index;l++)h+=e[l].width,j+=e[l].width;return h>g&&(g=h),this.config.keep_grid_width&&g>i&&(g=i),k=g-j,d.marker.style.top=f.y+"px",d.marker.style.left=f.x-1+j+"px",d.marker.style.width=k+"px",d.left=g-1,gantt.callEvent("onColumnResize",[d.drag_index,e[d.drag_index],k-1]),!0},this)),a.attachEvent("onDragEnd",dhtmlx.bind(function(b,c){for(var d=this.getGridColumns(),e=0,f=parseInt(a.config.drag_index,10),g=d[f],h=0;f>h;h++)e+=d[h].width;var i=g.min_width&&a.config.left-e<g.min_width?g.min_width:a.config.left-e;if(gantt.callEvent("onColumnResizeEnd",[f,g,i])!==!1&&g.width!=i){if(g.width=i,this.config.keep_grid_width)for(var h=f+1,j=d.length;j>h;h++)"add"==d[h].name?d[h].width=1*d[h].width||44:d[h].width=null;else{for(var h=f,j=d.length;j>h;h++)e+=d[h].width;this.config.grid_width=e}this.render()}},this));var b=new dhtmlxDnD(this.$grid,{updates_per_second:60});dhtmlx.defined(this.config.dnd_sensitivity)&&(b.config.sensitivity=this.config.dnd_sensitivity),b.attachEvent("onBeforeDragStart",dhtmlx.bind(function(a,b){var c=this._locateHTML(b,this.config.grid_resizer_attribute);return c?gantt.callEvent("onGridResizeStart",[gantt.config.grid_width])===!1?!1:void 0:!1},this)),b.attachEvent("onAfterDragStart",dhtmlx.bind(function(a,c){b.config.marker.innerHTML="",b.config.marker.className+=" gantt_grid_resize_area",b.config.marker.style.height=this.$grid.offsetHeight+"px",b.config.marker.style.top="0px"},this)),b.attachEvent("onDragMove",dhtmlx.bind(function(a,c){for(var d=b.config,e=this.config.columns,f=this._get_position(this.$grid),g=parseInt(d.marker.style.left,10),h=0,i=0;i<e.length;i++)e[i].hide||(h+=e[i].min_width?e[i].min_width:this.config.min_grid_column_width);return g-=f.x-1,h>g&&(g=h),d.marker.style.top=f.y+"px",d.marker.style.left=f.x-1+"px",d.marker.style.width=g+"px",d.left=g-1,gantt.callEvent("onGridResize",[this.config.grid_width,g-1]),!0},this)),b.attachEvent("onDragEnd",dhtmlx.bind(function(a,c){for(var d=this.config.columns,e=0,f=b.config.left,g=0,h=d.length;h>g;g++)d[g].hide||(e+=d[g].width);for(var i=d.length,j=f-e,g=0;i>g;g++)if(!d[g].hide){var k=Math.floor(j*(d[g].width/e));e-=d[g].width;var l=d[g].width+k;(d[g].min_width&&l>=d[g].min_width||!d[g].min_width||l>d[g].width)&&(j-=k,d[g].width=l)}for(var m=j>0?1:-1;j>0&&1===m||0>j&&-1===m;){var n=j;for(g=0;i>g;g++){var o=d[g].width+m;if((d[g].min_width&&o>=d[g].min_width||!d[g].min_width||l>d[g].width)&&(j-=m,d[g].width=o,0==j))break}if(n==j)break}gantt.callEvent("onGridResizeEnd",[this.config.grid_width,f])!==!1&&(this.config.grid_width=f,this.render())},this))},gantt.attachEvent("onGanttRender",function(){gantt._render_grid_header_resize()}),function(){var a=gantt._has_children;gantt._has_children=function(b){return a.apply(this,arguments)?!0:this.isTaskExists(b)?this.getTask(b).$has_child:!1}}(),gantt._need_dynamic_loading=function(a){if(gantt.config.branch_loading&&gantt._load_url){var b=gantt.getUserData(a,"was_rendered");if(!b&&gantt._has_children(a))return!0}return!1},gantt._refresh_on_toggle_element=function(a){gantt._need_dynamic_loading(a)||this.refreshData()},gantt.attachEvent("onTaskOpened",function(a){if(gantt.config.branch_loading&&gantt._load_url&&gantt._need_dynamic_loading(a)){var b=gantt._load_url;b=b.replace(/(\?|&)?parent_id=.+&?/,"");var c=b.indexOf("?")>=0?"&":"?",d=0;this._cached_scroll_pos&&this._cached_scroll_pos.y&&(d=Math.max(this._cached_scroll_pos.y,0)),gantt.load(b+c+"parent_id="+encodeURIComponent(a),this._load_type,function(){d&&gantt.scrollTo(null,d)}),gantt.setUserData(a,"was_rendered",!0)}}),gantt.getGridColumns=function(){for(var a=gantt.config.columns,b=[],c=0;c<a.length;c++)a[c].hide||b.push(a[c]);return b},gantt.getGridColumn=function(a){for(var b=gantt.config.columns,c=0;c<b.length;c++)if(b[c].name==a)return b[c];return null},gantt._scale_helpers={getSum:function(a,b,c){void 0===c&&(c=a.length-1),void 0===b&&(b=0);for(var d=0,e=b;c>=e;e++)d+=a[e];return d},setSumWidth:function(a,b,c,d){var e=b.width;void 0===d&&(d=e.length-1),void 0===c&&(c=0);var f=d-c+1;if(!(c>e.length-1||0>=f||d>e.length-1)){var g=this.getSum(e,c,d),h=a-g;this.adjustSize(h,e,c,d),this.adjustSize(-h,e,d+1),b.full_width=this.getSum(e)}},splitSize:function(a,b){for(var c=[],d=0;b>d;d++)c[d]=0;return this.adjustSize(a,c),c},adjustSize:function(a,b,c,d){c||(c=0),void 0===d&&(d=b.length-1);for(var e=d-c+1,f=this.getSum(b,c,d),g=0,h=c;d>=h;h++){var i=Math.floor(a*(f?b[h]/f:1/e));f-=b[h],a-=i,e--,b[h]+=i,g+=i}b[b.length-1]+=a},sortScales:function(a){function b(a,b){var c=new Date(1970,0,1);return gantt.date.add(c,b,a)-c}a.sort(function(a,c){return b(a.unit,a.step)<b(c.unit,c.step)?1:b(a.unit,a.step)>b(c.unit,c.step)?-1:0})},primaryScale:function(){return gantt._init_template("date_scale"),{unit:gantt.config.scale_unit,step:gantt.config.step,template:gantt.templates.date_scale,date:gantt.config.date_scale,css:gantt.templates.scale_cell_class}},prepareConfigs:function(a,b,c,d){for(var e=this.splitSize(d,a.length),f=c,g=[],h=a.length-1;h>=0;h--){var i=h==a.length-1,j=this.initScaleConfig(a[h]);i&&this.processIgnores(j),this.initColSizes(j,b,f,e[h]),this.limitVisibleRange(j),i&&(f=j.full_width),g.unshift(j)}for(var h=0;h<g.length-1;h++)this.alineScaleColumns(g[g.length-1],g[h]);for(var h=0;h<g.length;h++)this.setPosSettings(g[h]);return g},setPosSettings:function(a){for(var b=0,c=a.trace_x.length;c>b;b++)a.left.push((a.width[b-1]||0)+(a.left[b-1]||0))},_ignore_time_config:function(a){return this.config.skip_off_time?!this.isWorkTime(a):!1},processIgnores:function(a){a.ignore_x={},a.display_count=a.count},initColSizes:function(a,b,c,d){
var e=c;a.height=d;var f=void 0===a.display_count?a.count:a.display_count;f||(f=1),a.col_width=Math.floor(e/f),b&&a.col_width<b&&(a.col_width=b,e=a.col_width*f),a.width=[];for(var g=a.ignore_x||{},h=0;h<a.trace_x.length;h++)g[a.trace_x[h].valueOf()]||a.display_count==a.count?a.width[h]=0:a.width[h]=1;this.adjustSize(e-this.getSum(a.width),a.width),a.full_width=this.getSum(a.width)},initScaleConfig:function(a){var b=dhtmlx.mixin({count:0,col_width:0,full_width:0,height:0,width:[],left:[],trace_x:[]},a);return this.eachColumn(a.unit,a.step,function(a){b.count++,b.trace_x.push(new Date(a))}),b},iterateScales:function(a,b,c,d,e){for(var f=b.trace_x,g=a.trace_x,h=c||0,i=d||g.length-1,j=0,k=1;k<f.length;k++)for(var l=h;i>=l;l++)+g[l]!=+f[k]||(e&&e.apply(this,[j,k,h,l]),h=l,j=k)},alineScaleColumns:function(a,b,c,d){this.iterateScales(a,b,c,d,function(c,d,e,f){var g=this.getSum(a.width,e,f-1),h=this.getSum(b.width,c,d-1);h!=g&&this.setSumWidth(g,b,c,d-1)})},eachColumn:function(a,b,c){var d=new Date(gantt._min_date),e=new Date(gantt._max_date);gantt.date[a+"_start"]&&(d=gantt.date[a+"_start"](d));var f=new Date(d);for(+f>=+e&&(e=gantt.date.add(f,b,a));+e>+f;){c.call(this,new Date(f));var g=f.getTimezoneOffset();f=gantt.date.add(f,b,a),f=gantt._correct_dst_change(f,g,b,a),gantt.date[a+"_start"]&&(f=gantt.date[a+"_start"](f))}},limitVisibleRange:function(a){var b=a.trace_x,c=0,d=a.width.length-1,e=0;if(+b[0]<+gantt._min_date&&c!=d){var f=Math.floor(a.width[0]*((b[1]-gantt._min_date)/(b[1]-b[0])));e+=a.width[0]-f,a.width[0]=f,b[0]=new Date(gantt._min_date)}var g=b.length-1,h=b[g],i=gantt.date.add(h,a.step,a.unit);if(+i>+gantt._max_date&&g>0){var f=a.width[g]-Math.floor(a.width[g]*((i-gantt._max_date)/(i-h)));e+=a.width[g]-f,a.width[g]=f}if(e){for(var j=this.getSum(a.width),k=0,l=0;l<a.width.length;l++){var m=Math.floor(e*(a.width[l]/j));a.width[l]+=m,k+=m}this.adjustSize(e-k,a.width)}}},gantt._scale_helpers.processIgnores=function(a){var b=a.count;if(a.ignore_x={},gantt.ignore_time||gantt.config.skip_off_time){var c=gantt.ignore_time||function(){return!1};b=0;for(var d=0;d<a.trace_x.length;d++)c.call(gantt,a.trace_x[d])||this._ignore_time_config.call(gantt,a.trace_x[d])?(a.ignore_x[a.trace_x[d].valueOf()]=!0,a.ignored_colls=!0):b++}a.display_count=b},gantt._tasks_dnd={drag:null,_events:{before_start:{},before_finish:{},after_finish:{}},_handlers:{},init:function(){this.clear_drag_state();var a=gantt.config.drag_mode;this.set_actions();var b={before_start:"onBeforeTaskDrag",before_finish:"onBeforeTaskChanged",after_finish:"onAfterTaskDrag"};for(var c in this._events)for(var d in a)this._events[c][d]=b[c];this._handlers[a.move]=this._move,this._handlers[a.resize]=this._resize,this._handlers[a.progress]=this._resize_progress},set_actions:function(){var a=gantt.$task_data;dhtmlxEvent(a,"mousemove",dhtmlx.bind(function(a){this.on_mouse_move(a||event)},this)),dhtmlxEvent(a,"mousedown",dhtmlx.bind(function(a){this.on_mouse_down(a||event)},this)),dhtmlxEvent(a,"mouseup",dhtmlx.bind(function(a){this.on_mouse_up(a||event)},this))},clear_drag_state:function(){this.drag={id:null,mode:null,pos:null,start_x:null,start_y:null,obj:null,left:null}},_resize:function(a,b,c){var d=gantt.config,e=this._drag_task_coords(a,c);c.left?(a.start_date=gantt.dateFromPos(e.start+b),a.start_date||(a.start_date=new Date(gantt.getState().min_date))):(a.end_date=gantt.dateFromPos(e.end+b),a.end_date||(a.end_date=new Date(gantt.getState().max_date))),a.end_date-a.start_date<d.min_duration&&(c.left?a.start_date=gantt.calculateEndDate(a.end_date,-1):a.end_date=gantt.calculateEndDate(a.start_date,1)),gantt._init_task_timing(a)},_resize_progress:function(a,b,c){var d=this._drag_task_coords(a,c),e=Math.max(0,c.pos.x-d.start);a.progress=Math.min(1,e/(d.end-d.start))},_move:function(a,b,c){var d=this._drag_task_coords(a,c),e=gantt.dateFromPos(d.start+b),f=gantt.dateFromPos(d.end+b);e?f?(a.start_date=e,a.end_date=f):(a.end_date=new Date(gantt.getState().max_date),a.start_date=gantt.dateFromPos(gantt.posFromDate(a.end_date)-(d.end-d.start))):(a.start_date=new Date(gantt.getState().min_date),a.end_date=gantt.dateFromPos(gantt.posFromDate(a.start_date)+(d.end-d.start)))},_drag_task_coords:function(a,b){var c=b.obj_s_x=b.obj_s_x||gantt.posFromDate(a.start_date),d=b.obj_e_x=b.obj_e_x||gantt.posFromDate(a.end_date);return{start:c,end:d}},on_mouse_move:function(a){this.drag.start_drag&&this._start_dnd(a);var b=this.drag;if(b.mode){if(!gantt._checkTimeout(this,40))return;this._update_on_move(a)}},_update_on_move:function(a){var b=this.drag;if(b.mode){var c=gantt._get_mouse_pos(a);if(b.pos&&b.pos.x==c.x)return;b.pos=c;var d=gantt.dateFromPos(c.x);if(!d||isNaN(d.getTime()))return;var e=c.x-b.start_x,f=gantt.getTask(b.id);if(this._handlers[b.mode]){var g=dhtmlx.mixin({},f),h=dhtmlx.mixin({},f);this._handlers[b.mode].apply(this,[h,e,b]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id,!0),gantt.callEvent("onTaskDrag",[f.id,b.mode,h,g,a]),dhtmlx.mixin(f,h,!0),gantt._update_parents(b.id),gantt.refreshTask(b.id)}}},on_mouse_down:function(a,b){if(2!=a.button){var c=gantt.locate(a),d=null;if(gantt.isTaskExists(c)&&(d=gantt.getTask(c)),!gantt._is_readonly(d)&&!this.drag.mode){this.clear_drag_state(),b=b||a.target||a.srcElement;var e=gantt._getClassName(b);if(!e||!this._get_drag_mode(e))return b.parentNode?this.on_mouse_down(a,b.parentNode):void 0;var f=this._get_drag_mode(e);if(f)if(f.mode&&f.mode!=gantt.config.drag_mode.ignore&&gantt.config["drag_"+f.mode]){if(c=gantt.locate(b),d=dhtmlx.copy(gantt.getTask(c)||{}),gantt._is_readonly(d))return this.clear_drag_state(),!1;if(gantt._is_flex_task(d)&&f.mode!=gantt.config.drag_mode.progress)return void this.clear_drag_state();f.id=c;var g=gantt._get_mouse_pos(a);f.start_x=g.x,f.start_y=g.y,f.obj=d,this.drag.start_drag=f}else this.clear_drag_state();else if(gantt.checkEvent("onMouseDown")&&gantt.callEvent("onMouseDown",[e.split(" ")[0]])&&b.parentNode)return this.on_mouse_down(a,b.parentNode)}}},_fix_dnd_scale_time:function(a,b){function c(a){gantt.isWorkTime(a.start_date)||(a.start_date=gantt.calculateEndDate(a.start_date,-1,gantt.config.duration_unit))}function d(a){gantt.isWorkTime(new Date(a.end_date-1))||(a.end_date=gantt.calculateEndDate(a.end_date,1,gantt.config.duration_unit))}var e=gantt._tasks.unit,f=gantt._tasks.step;gantt.config.round_dnd_dates||(e="minute",f=gantt.config.time_step),b.mode==gantt.config.drag_mode.resize?b.left?(a.start_date=gantt.roundDate({date:a.start_date,unit:e,step:f}),c(a)):(a.end_date=gantt.roundDate({date:a.end_date,unit:e,step:f}),d(a)):b.mode==gantt.config.drag_mode.move&&(a.start_date=gantt.roundDate({date:a.start_date,unit:e,step:f}),c(a),a.end_date=gantt.calculateEndDate(a.start_date,a.duration,gantt.config.duration_unit))},_fix_working_times:function(a,b){var b=b||{mode:gantt.config.drag_mode.move};gantt.config.work_time&&gantt.config.correct_work_time&&(b.mode==gantt.config.drag_mode.resize?b.left?a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}):a.end_date=gantt.getClosestWorkTime({date:a.end_date,dir:"past"}):b.mode==gantt.config.drag_mode.move&&gantt.correctTaskWorkTime(a))},on_mouse_up:function(a){var b=this.drag;if(b.mode&&b.id){var c=gantt.getTask(b.id);if(gantt.config.work_time&&gantt.config.correct_work_time&&this._fix_working_times(c,b),this._fix_dnd_scale_time(c,b),gantt._init_task_timing(c),this._fireEvent("before_finish",b.mode,[b.id,b.mode,dhtmlx.copy(b.obj),a])){var d=b.id;gantt._init_task_timing(c),this._fireEvent("after_finish",b.mode,[d,b.mode,a]),this.clear_drag_state(),gantt.updateTask(c.id)}else b.obj._dhx_changed=!1,dhtmlx.mixin(c,b.obj,!0),gantt.updateTask(c.id)}this.clear_drag_state()},_get_drag_mode:function(a){var b=gantt.config.drag_mode,c=(a||"").split(" "),d=c[0],e={mode:null,left:null};switch(d){case"gantt_task_line":case"gantt_task_content":e.mode=b.move;break;case"gantt_task_drag":e.mode=b.resize,c[1]&&-1!==c[1].indexOf("left",c[1].length-"left".length)?e.left=!0:e.left=!1;break;case"gantt_task_progress_drag":e.mode=b.progress;break;case"gantt_link_control":case"gantt_link_point":e.mode=b.ignore;break;default:e=null}return e},_start_dnd:function(a){var b=this.drag=this.drag.start_drag;delete b.start_drag;var c=gantt.config,d=b.id;c["drag_"+b.mode]&&gantt.callEvent("onBeforeDrag",[d,b.mode,a])&&this._fireEvent("before_start",b.mode,[d,b.mode,a])?delete b.start_drag:this.clear_drag_state()},_fireEvent:function(a,b,c){dhtmlx.assert(this._events[a],"Invalid stage:{"+a+"}");var d=this._events[a][b];return dhtmlx.assert(d,"Unknown after drop mode:{"+b+"}"),dhtmlx.assert(c,"Invalid event arguments"),gantt.checkEvent(d)?gantt.callEvent(d,c):!0}},gantt.roundTaskDates=function(a){var b=gantt._tasks_dnd.drag;b||(b={mode:gantt.config.drag_mode.move}),gantt._tasks_dnd._fix_dnd_scale_time(a,b)},gantt._render_link=function(a){for(var b=this.getLink(a),c=gantt._get_link_renderers(),d=0;d<c.length;d++)c[d].render_item(b)},gantt._get_link_type=function(a,b){var c=null;return a&&b?c=gantt.config.links.start_to_start:!a&&b?c=gantt.config.links.finish_to_start:a||b?a&&!b&&(c=gantt.config.links.start_to_finish):c=gantt.config.links.finish_to_finish,c},gantt.isLinkAllowed=function(a,b,c,d){var e=null;if(e="object"==typeof a?a:{source:a,target:b,type:this._get_link_type(c,d)},!e)return!1;if(!(e.source&&e.target&&e.type))return!1;if(e.source==e.target)return!1;var f=!0;return this.checkEvent("onLinkValidation")&&(f=this.callEvent("onLinkValidation",[e])),f},gantt._render_link_element=function(a){var b=this._path_builder.get_points(a),c=gantt._drawer,d=c.get_lines(b),e=document.createElement("div"),f="gantt_task_link";a.color&&(f+=" gantt_link_inline_color");var g=this.templates.link_class?this.templates.link_class(a):"";g&&(f+=" "+g),this.config.highlight_critical_path&&this.isCriticalLink&&this.isCriticalLink(a)&&(f+=" gantt_critical_link"),e.className=f,e.setAttribute(gantt.config.link_attribute,a.id);for(var h=0;h<d.length;h++){h==d.length-1&&(d[h].size-=gantt.config.link_arrow_size);var i=c.render_line(d[h],d[h+1]);a.color&&(i.firstChild.style.backgroundColor=a.color),e.appendChild(i)}var j=d[d.length-1].direction,k=gantt._render_link_arrow(b[b.length-1],j);return a.color&&(k.style.borderColor=a.color),e.appendChild(k),e},gantt._render_link_arrow=function(a,b){var c=document.createElement("div"),d=gantt._drawer,e=a.y,f=a.x,g=gantt.config.link_arrow_size,h=gantt.config.row_height,i="gantt_link_arrow gantt_link_arrow_"+b;switch(b){case d.dirs.right:e-=(g-h)/2,f-=g;break;case d.dirs.left:e-=(g-h)/2;break;case d.dirs.up:f-=g;break;case d.dirs.down:e+=2*g,f-=g}return c.style.cssText=["top:"+e+"px","left:"+f+"px"].join(";"),c.className=i,c},gantt._drawer={current_pos:null,dirs:{left:"left",right:"right",up:"up",down:"down"},path:[],clear:function(){this.current_pos=null,this.path=[]},point:function(a){this.current_pos=dhtmlx.copy(a)},get_lines:function(a){this.clear(),this.point(a[0]);for(var b=1;b<a.length;b++)this.line_to(a[b]);return this.get_path()},line_to:function(a){var b=dhtmlx.copy(a),c=this.current_pos,d=this._get_line(c,b);this.path.push(d),this.current_pos=b},get_path:function(){return this.path},get_wrapper_sizes:function(a){var b,c=gantt.config.link_wrapper_width,d=(gantt.config.link_line_width,a.y+(gantt.config.row_height-c)/2);switch(a.direction){case this.dirs.left:b={top:d,height:c,lineHeight:c,left:a.x-a.size-c/2,width:a.size+c};break;case this.dirs.right:b={top:d,lineHeight:c,height:c,left:a.x-c/2,width:a.size+c};break;case this.dirs.up:b={top:d-a.size,lineHeight:a.size+c,height:a.size+c,left:a.x-c/2,width:c};break;case this.dirs.down:b={top:d,lineHeight:a.size+2*c,height:a.size+2*c,left:a.x-c/2,width:c}}return b},get_line_sizes:function(a){var b,c=gantt.config.link_line_width,d=gantt.config.link_wrapper_width,e=a.size+c;switch(a.direction){case this.dirs.left:case this.dirs.right:b={height:c,width:e,marginTop:(d-c)/2,marginLeft:(d-c)/2};break;case this.dirs.up:case this.dirs.down:b={height:e,width:c,marginTop:(d-c)/2,marginLeft:(d-c)/2}}return b},render_line:function(a){var b=this.get_wrapper_sizes(a),c=document.createElement("div");c.style.cssText=["top:"+b.top+"px","left:"+b.left+"px","height:"+b.height+"px","width:"+b.width+"px"].join(";"),c.className="gantt_line_wrapper";var d=this.get_line_sizes(a),e=document.createElement("div");return e.style.cssText=["height:"+d.height+"px","width:"+d.width+"px","margin-top:"+d.marginTop+"px","margin-left:"+d.marginLeft+"px"].join(";"),e.className="gantt_link_line_"+a.direction,c.appendChild(e),c},_get_line:function(a,b){var c=this.get_direction(a,b),d={x:a.x,y:a.y,direction:this.get_direction(a,b)};return c==this.dirs.left||c==this.dirs.right?d.size=Math.abs(a.x-b.x):d.size=Math.abs(a.y-b.y),d},get_direction:function(a,b){var c=0;return c=b.x<a.x?this.dirs.left:b.x>a.x?this.dirs.right:b.y>a.y?this.dirs.down:this.dirs.up}},gantt._y_from_ind=function(a){return a*gantt.config.row_height},gantt._path_builder={path:[],clear:function(){this.path=[]},current:function(){return this.path[this.path.length-1]},point:function(a){return a?(this.path.push(dhtmlx.copy(a)),a):this.current()},point_to:function(a,b,c){c=c?{x:c.x,y:c.y}:dhtmlx.copy(this.point());var d=gantt._drawer.dirs;switch(a){case d.left:c.x-=b;break;case d.right:c.x+=b;break;case d.up:c.y-=b;break;case d.down:c.y+=b}return this.point(c)},get_points:function(a){var b=this.get_endpoint(a),c=gantt.config,d=b.e_y-b.y,e=b.e_x-b.x,f=gantt._drawer.dirs;this.clear(),this.point({x:b.x,y:b.y});var g=2*c.link_arrow_size,h=b.e_x>b.x;if(a.type==gantt.config.links.start_to_start)this.point_to(f.left,g),h?(this.point_to(f.down,d),this.point_to(f.right,e)):(this.point_to(f.right,e),this.point_to(f.down,d)),this.point_to(f.right,g);else if(a.type==gantt.config.links.finish_to_start)if(h=b.e_x>b.x+2*g,this.point_to(f.right,g),h)e-=g,this.point_to(f.down,d),this.point_to(f.right,e);else{e-=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.right,g)}else if(a.type==gantt.config.links.finish_to_finish)this.point_to(f.right,g),h?(this.point_to(f.right,e),this.point_to(f.down,d)):(this.point_to(f.down,d),this.point_to(f.right,e)),this.point_to(f.left,g);else if(a.type==gantt.config.links.start_to_finish)if(h=b.e_x>b.x-2*g,this.point_to(f.left,g),h){e+=2*g;var i=d>0?1:-1;this.point_to(f.down,i*(c.row_height/2)),this.point_to(f.right,e),this.point_to(f.down,i*(Math.abs(d)-c.row_height/2)),this.point_to(f.left,g)}else e+=g,this.point_to(f.down,d),this.point_to(f.right,e);return this.path},get_endpoint:function(a){var b=gantt.config.links,c=!1,d=!1;a.type==b.start_to_start?c=d=!0:a.type==b.finish_to_finish?c=d=!1:a.type==b.finish_to_start?(c=!1,d=!0):a.type==b.start_to_finish?(c=!0,d=!1):dhtmlx.assert(!1,"Invalid link type");var e=gantt._get_task_visible_pos(gantt._pull[a.source],c),f=gantt._get_task_visible_pos(gantt._pull[a.target],d);return{x:e.x,e_x:f.x,y:e.y,e_y:f.y}}},gantt._init_links_dnd=function(){function a(a,b,c){var d=gantt._get_task_pos(a,!!b);return d.y+=gantt._get_task_height()/2,c=c||0,d.x+=(b?-1:1)*c,d}function b(a){var b=d(),c=["gantt_link_tooltip"];b.from&&b.to&&(gantt.isLinkAllowed(b.from,b.to,b.from_start,b.to_start)?c.push("gantt_allowed_link"):c.push("gantt_invalid_link"));var e=gantt.templates.drag_link_class(b.from,b.from_start,b.to,b.to_start);e&&c.push(e);var f="<div class='"+e+"'>"+gantt.templates.drag_link(b.from,b.from_start,b.to,b.to_start)+"</div>";a.innerHTML=f}function c(a,b){a.style.left=b.x+5+"px",a.style.top=b.y+5+"px"}function d(){return{from:gantt._link_source_task,to:gantt._link_target_task,from_start:gantt._link_source_task_start,to_start:gantt._link_target_task_start}}function e(){gantt._link_source_task=gantt._link_source_task_start=gantt._link_target_task=null,gantt._link_target_task_start=!0}function f(a,b,c,e){var f=i(),j=d(),k=["gantt_link_direction"];gantt.templates.link_direction_class&&k.push(gantt.templates.link_direction_class(j.from,j.from_start,j.to,j.to_start));var l=Math.sqrt(Math.pow(c-a,2)+Math.pow(e-b,2));if(l=Math.max(0,l-3)){f.className=k.join(" ");var m=(e-b)/(c-a),n=Math.atan(m);2==h(a,c,b,e)?n+=Math.PI:3==h(a,c,b,e)&&(n-=Math.PI);var o=Math.sin(n),p=Math.cos(n),q=Math.round(b),r=Math.round(a),s=["-webkit-transform: rotate("+n+"rad)","-moz-transform: rotate("+n+"rad)","-ms-transform: rotate("+n+"rad)","-o-transform: rotate("+n+"rad)","transform: rotate("+n+"rad)","width:"+Math.round(l)+"px"];if(-1!=window.navigator.userAgent.indexOf("MSIE 8.0")){s.push('-ms-filter: "'+g(o,p)+'"');var t=Math.abs(Math.round(a-c)),u=Math.abs(Math.round(e-b));switch(h(a,c,b,e)){case 1:q-=u;break;case 2:r-=t,q-=u;break;case 3:r-=t}}s.push("top:"+q+"px"),s.push("left:"+r+"px"),f.style.cssText=s.join(";")}}function g(a,b){return"progid:DXImageTransform.Microsoft.Matrix(M11 = "+b+",M12 = -"+a+",M21 = "+a+",M22 = "+b+",SizingMethod = 'auto expand')"}function h(a,b,c,d){return b>=a?c>=d?1:4:c>=d?2:3}function i(){return k._direction||(k._direction=document.createElement("div"),gantt.$task_links.appendChild(k._direction)),k._direction}function j(){k._direction&&(k._direction.parentNode&&k._direction.parentNode.removeChild(k._direction),k._direction=null)}var k=new dhtmlxDnD(this.$task_bars,{sensitivity:0,updates_per_second:60}),l="task_left",m="task_right",n="gantt_link_point",o="gantt_link_control";k.attachEvent("onBeforeDragStart",dhtmlx.bind(function(b,c){var d=c.target||c.srcElement;if(e(),gantt.getState().drag_id)return!1;if(gantt._locate_css(d,n)){gantt._locate_css(d,l)&&(gantt._link_source_task_start=!0);var f=gantt._link_source_task=this.locate(c),g=gantt.getTask(f);if(gantt._is_readonly(g))return e(),!1;var h=0;return gantt._get_safe_type(g.type)==gantt.config.types.milestone&&(h=(gantt._get_visible_milestone_width()-gantt._get_milestone_width())/2),this._dir_start=a(g,!!gantt._link_source_task_start,h),!0}return!1},this)),k.attachEvent("onAfterDragStart",dhtmlx.bind(function(a,c){b(k.config.marker)},this)),k.attachEvent("onDragMove",dhtmlx.bind(function(d,e){var g=k.config,h=k.getPosition(e);c(g.marker,h);var i=gantt._is_link_drop_area(e),j=gantt._link_target_task,l=gantt._link_landing,n=gantt._link_target_task_start,p=gantt.locate(e),q=!0;if(i&&(q=!gantt._locate_css(e,m),i=!!p),gantt._link_target_task=p,gantt._link_landing=i,gantt._link_target_task_start=q,i){var r=gantt.getTask(p),s=gantt._locate_css(e,o),t=0;s&&(t=Math.floor(s.offsetWidth/2)),this._dir_end=a(r,!!gantt._link_target_task_start,t)}else this._dir_end=gantt._get_mouse_pos(e);var u=!(l==i&&j==p&&n==q);return u&&(j&&gantt.refreshTask(j,!1),p&&gantt.refreshTask(p,!1)),u&&b(g.marker),f(this._dir_start.x,this._dir_start.y,this._dir_end.x,this._dir_end.y),!0},this)),k.attachEvent("onDragEnd",dhtmlx.bind(function(){var a=d();if(a.from&&a.to&&a.from!=a.to){var b=gantt._get_link_type(a.from_start,a.to_start),c={source:a.from,target:a.to,type:b};c.type&&gantt.isLinkAllowed(c)&&gantt.addLink(c)}e(),a.from&&gantt.refreshTask(a.from,!1),a.to&&gantt.refreshTask(a.to,!1),j()},this)),gantt._is_link_drop_area=function(a){return!!gantt._locate_css(a,o)}},gantt._get_link_state=function(){return{link_landing_area:this._link_landing,link_target_id:this._link_target_task,link_target_start:this._link_target_task_start,link_source_id:this._link_source_task,link_source_start:this._link_source_task_start}},gantt._init_tasks=function(){function a(a,b,c,d){for(var e=0;e<a.length;e++)a[e].change_id(b,c),a[e].render_item(d)}this._tasks={col_width:this.config.columnWidth,width:[],full_width:0,trace_x:[],rendered:{}},this._click.gantt_task_link=dhtmlx.bind(function(a,b){var c=this.locate(a,gantt.config.link_attribute);c&&this.callEvent("onLinkClick",[c,a])},this),this._click.gantt_scale_cell=dhtmlx.bind(function(a,b){var c=gantt._get_mouse_pos(a),d=gantt.dateFromPos(c.x),e=Math.floor(gantt._day_index_by_date(d)),f=gantt._tasks.trace_x[e];gantt.callEvent("onScaleClick",[a,f])},this),this._dbl_click.gantt_task_link=dhtmlx.bind(function(a,b,c){var b=this.locate(a,gantt.config.link_attribute);this._delete_link_handler(b,a)},this),this._dbl_click.gantt_link_point=dhtmlx.bind(function(a,b,c){var b=this.locate(a),d=this.getTask(b),e=null;return c.parentNode&&gantt._getClassName(c.parentNode)&&(e=gantt._getClassName(c.parentNode).indexOf("_left")>-1?d.$target[0]:d.$source[0]),e&&this._delete_link_handler(e,a),!1},this),this._tasks_dnd.init(),this._init_links_dnd(),this._link_layers.clear();var b=this.addLinkLayer({renderer:this._render_link_element,container:this.$task_links,filter:gantt._create_filter(["_filter_link","_is_chart_visible"])});this._linkRenderer=this._link_layers.getRenderer(b),this._task_layers.clear();var c=this.addTaskLayer({renderer:this._render_task_element,container:this.$task_bars,filter:gantt._create_filter(["_filter_task","_is_chart_visible"])});this._taskRenderer=this._task_layers.getRenderer(c),this.addTaskLayer({renderer:this._render_grid_item,container:this.$grid_data,filter:gantt._create_filter(["_filter_task","_is_grid_visible"])}),this.addTaskLayer({renderer:this._render_bg_line,container:this.$task_bg,filter:gantt._create_filter(["_filter_task","_is_chart_visible","_is_std_background"])}),this._onTaskIdChange&&this.detachEvent(this._onTaskIdChange),this._onTaskIdChange=this.attachEvent("onTaskIdChange",function(b,c){var d=this._get_task_renderers();a(d,b,c,this.getTask(c))}),this._onLinkIdChange&&this.detachEvent(this._onLinkIdChange),this._onLinkIdChange=this.attachEvent("onLinkIdChange",function(b,c){var d=this._get_link_renderers();a(d,b,c,this.getLink(c))})},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&gantt[f].apply(gantt,[b.id,b])!==!1)}return c}},gantt._is_chart_visible=function(){return!!this.config.show_chart},gantt._filter_task=function(a,b){var c=null,d=null;return this.config.start_date&&this.config.end_date&&(c=this.config.start_date.valueOf(),d=this.config.end_date.valueOf(),+b.start_date>d||+b.end_date<+c)?!1:!0},gantt._filter_link=function(a,b){return this.config.show_links?!gantt.isTaskVisible(b.source)||!gantt.isTaskVisible(b.target)||gantt._isAllowedUnscheduledTask(gantt.getTask(b.source))||gantt._isAllowedUnscheduledTask(gantt.getTask(b.target))?!1:this.callEvent("onBeforeLinkDisplay",[a,b]):!1},gantt._is_std_background=function(){return!this.config.static_background},gantt._delete_link_handler=function(a,b){if(a&&this.callEvent("onLinkDblClick",[a,b])){var c=gantt.getLink(a);if(gantt._is_readonly(c))return;var d="",e=gantt.locale.labels.link+" "+this.templates.link_description(this.getLink(a))+" "+gantt.locale.labels.confirm_link_deleting;window.setTimeout(function(){gantt._dhtmlx_confirm(e,d,function(){gantt.deleteLink(a)})},gantt.config.touch?300:1)}},gantt.getTaskNode=function(a){return this._taskRenderer.rendered[a]},gantt.getLinkNode=function(a){return this._linkRenderer.rendered[a]},gantt._get_tasks_data=function(){for(var a=[],b=0;b<this._order.length;b++){var c=this._pull[this._order[b]];c.$index=b,this.resetProjectDates(c),a.push(c)}return a},gantt._get_links_data=function(){var a=[];for(var b in this._lpull)a.push(this._lpull[b]);return a},gantt._render_data=function(){if(this.callEvent("onBeforeDataRender",[]),this._is_render_active()){this._sync_order(),this._update_layout_sizes(),this.config.static_background&&this._render_bg_canvas();for(var a=this._get_tasks_data(),b=this._get_task_renderers(),c=0;c<b.length;c++)b[c].render_items(a);var d=gantt._get_links_data();b=this._get_link_renderers();for(var c=0;c<b.length;c++)b[c].render_items(d);this.callEvent("onDataRender",[])}},gantt._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var b=this.$task_data.childNodes,c=0,d=b.length;d>c;c++){var e=b[c];this._is_layer(e)&&e.style&&(e.style.width=a.full_width+"px")}if(this._is_grid_visible()){for(var f=this.getGridColumns(),g=0,c=0;c<f.length;c++)g+=f[c].width;this.$grid_data.style.width=Math.max(g-1,0)+"px"}},gantt._scale_range_unit=function(){var a=this.config.scale_unit;if(this.config.scale_offset_minimal){var b=this._get_scales();a=b[b.length-1].unit}return a},gantt._init_tasks_range=function(){var a=this._scale_range_unit();if(this.config.start_date&&this.config.end_date)return this._min_date=this.date[a+"_start"](new Date(this.config.start_date)),void(this._max_date=this.date[a+"_start"](new Date(this.config.end_date)));this._get_tasks_data();var b=this.getSubtaskDates();this._min_date=b.start_date,this._max_date=b.end_date,this._max_date&&this._max_date||(this._min_date=new Date,this._max_date=new Date(this._min_date)),this._min_date=this.date[a+"_start"](this._min_date),this._min_date=this.calculateEndDate(this.date[a+"_start"](this._min_date),-1,a),this._max_date=this.date[a+"_start"](this._max_date),this._max_date=this.calculateEndDate(this._max_date,2,a)},gantt._prepare_scale_html=function(a){var b=[],c=null,d=null,e=null;(a.template||a.date)&&(d=a.template||this.date.date_to_str(a.date)),e=a.css||function(){},!a.css&&this.config.inherit_scale_class&&(e=gantt.templates.scale_cell_class);for(var f=0;f<a.count;f++){c=new Date(a.trace_x[f]);var g=d.call(this,c),h=a.width[f],i="",j="",k="";if(h){i="width:"+h+"px;",k="gantt_scale_cell"+(f==a.count-1?" gantt_last_cell":""),j=e.call(this,c),j&&(k+=" "+j);var l="<div class='"+k+"' style='"+i+"'>"+g+"</div>";b.push(l)}}return b.join("")},gantt._get_scales=function(){var a=this._scale_helpers,b=[a.primaryScale()].concat(this.config.subscales);return a.sortScales(b),b},gantt._render_tasks_scales=function(){this._init_tasks_range(),this._scroll_resize(),this._set_sizes();var a="",b=0,c=0,d=0;if(this._is_chart_visible()){var e=this._scale_helpers,f=this._get_scales();d=this.config.scale_height-1;for(var g=this._get_resize_options(),h=g.x?Math.max(this.config.autosize_min_width,0):this.$task.offsetWidth,i=e.prepareConfigs(f,this.config.min_column_width,h,d),j=this._tasks=i[i.length-1],k=[],l=this.templates.scale_row_class,m=0;m<i.length;m++){var n="gantt_scale_line",o=l(i[m]);o&&(n+=" "+o),k.push('<div class="'+n+'" style="height:'+i[m].height+"px;line-height:"+i[m].height+'px">'+this._prepare_scale_html(i[m])+"</div>")}a=k.join(""),b=j.full_width+this.$scroll_ver.offsetWidth+"px",c=j.full_width+"px",d+="px"}this._is_chart_visible()?this.$task.style.display="":this.$task.style.display="none",this.$task_scale.style.height=d,this.$task_data.style.width=this.$task_scale.style.width=b,this.$task_scale.innerHTML=a},gantt._render_bg_line=function(a){var b=gantt._tasks,c=b.count,d=document.createElement("div");if(gantt.config.show_task_cells)for(var e=0;c>e;e++){var f=b.width[e],g="";if(f>0){var h=document.createElement("div");h.style.width=f+"px",g="gantt_task_cell"+(e==c-1?" gantt_last_cell":""),j=this.templates.task_cell_class(a,b.trace_x[e]),j&&(g+=" "+j),h.className=g,d.appendChild(h)}}var i=a.$index%2!==0,j=gantt.templates.task_row_class(a.start_date,a.end_date,a),k="gantt_task_row"+(i?" odd":"")+(j?" "+j:"");return this.getState().selected_task==a.id&&(k+=" gantt_selected"),d.className=k,d.style.height=gantt.config.row_height+"px",d.setAttribute(this.config.task_attribute,a.id),d},gantt._render_bg_canvas=function(){},gantt._adjust_scales=function(){if(this.config.fit_tasks){var a=+this._min_date,b=+this._max_date;if(this._init_tasks_range(),+this._min_date!=a||+this._max_date!=b)return this.render(),this.callEvent("onScaleAdjusted",[]),!0}return!1},gantt.refreshTask=function(a,b){if(this._is_render_active()){var c=this._get_task_renderers(),d=this.getTask(a);if(d&&this.isTaskVisible(a)){for(var e=0;e<c.length;e++)c[e].render_item(d);if(void 0!==b&&!b)return;for(var e=0;e<d.$source.length;e++)gantt.refreshLink(d.$source[e]);for(var e=0;e<d.$target.length;e++)gantt.refreshLink(d.$target[e])}else this._render_data()}},gantt.refreshLink=function(a){if(this._is_render_active())if(this.isLinkExists(a))this._render_link(a);else for(var b=this._get_link_renderers(),c=0;c<b.length;c++)b[c].remove_item(a)},gantt._combine_item_class=function(a,b,c){var d=[a];b&&d.push(b);var e=gantt.getState(),f=this.getTask(c);this._get_safe_type(f.type)==this.config.types.milestone&&d.push("gantt_milestone"),this._get_safe_type(f.type)==this.config.types.project&&d.push("gantt_project"),this._is_flex_task(f)&&d.push("gantt_dependent_task"),this.config.select_task&&c==e.selected_task&&d.push("gantt_selected"),c==e.drag_id&&(d.push("gantt_drag_"+e.drag_mode),e.touch_drag&&d.push("gantt_touch_"+e.drag_mode));var g=gantt._get_link_state();if(g.link_source_id==c&&d.push("gantt_link_source"),g.link_target_id==c&&d.push("gantt_link_target"),this.config.highlight_critical_path&&this.isCriticalTask&&this.isCriticalTask(f)&&d.push("gantt_critical_task"),g.link_landing_area&&g.link_target_id&&g.link_source_id&&g.link_target_id!=g.link_source_id){var h=g.link_source_id,i=g.link_source_start,j=g.link_target_start,k=gantt.isLinkAllowed(h,c,i,j),l="";l=k?j?"link_start_allow":"link_finish_allow":j?"link_start_deny":"link_finish_deny",d.push(l)}return d.join(" ")},gantt._render_pair=function(a,b,c,d){var e=gantt.getState();+c.end_date<=+e.max_date&&a.appendChild(d(b+" task_right")),+c.start_date>=+e.min_date&&a.appendChild(d(b+" task_left"))},gantt._get_task_height=function(){var a=this.config.task_height;return"full"==a&&(a=this.config.row_height-5),a=Math.min(a,this.config.row_height),Math.max(a,0)},gantt._get_milestone_width=function(){return this._get_task_height()},gantt._get_visible_milestone_width=function(){var a=gantt._get_task_height();return Math.sqrt(2*a*a)},gantt.getTaskPosition=function(a,b,c){var d=this.posFromDate(b||a.start_date),e=this.posFromDate(c||a.end_date);e=Math.max(d,e);var f=this.getTaskTop(a.id),g=this.config.task_height;return{left:d,top:f,height:g,width:Math.max(e-d,0)}},gantt._get_task_width=function(a,b,c){return Math.round(this._get_task_pos(a,!1).x-this._get_task_pos(a,!0).x)},gantt._is_readonly=function(a){return a&&a[this.config.editable_property]?!1:a&&a[this.config.readonly_property]||this.config.readonly},gantt._task_default_render=function(a){if(!this._isAllowedUnscheduledTask(a)){var b=this._get_task_pos(a),c=this.config,d=this._get_task_height(),e=Math.floor((this.config.row_height-d)/2);this._get_safe_type(a.type)==c.types.milestone&&c.link_line_width>1&&(e+=1);var f=document.createElement("div"),g=gantt._get_task_width(a),h=this._get_safe_type(a.type);f.setAttribute(this.config.task_attribute,a.id),c.show_progress&&h!=this.config.types.milestone&&this._render_task_progress(a,f,g);var i=gantt._render_task_content(a,g);a.textColor&&(i.style.color=a.textColor),f.appendChild(i);var j=this._combine_item_class("gantt_task_line",this.templates.task_class(a.start_date,a.end_date,a),a.id);(a.color||a.progressColor||a.textColor)&&(j+=" gantt_task_inline_color"),f.className=j;var k=["left:"+b.x+"px","top:"+(e+b.y)+"px","height:"+d+"px","line-height:"+d+"px","width:"+g+"px"];a.color&&k.push("background-color:"+a.color),a.textColor&&k.push("color:"+a.textColor),f.style.cssText=k.join(";");var l=this._render_leftside_content(a);return l&&f.appendChild(l),l=this._render_rightside_content(a),l&&f.appendChild(l),this._is_readonly(a)||(c.drag_resize&&!this._is_flex_task(a)&&h!=this.config.types.milestone&&gantt._render_pair(f,"gantt_task_drag",a,function(a){var b=document.createElement("div");return b.className=a,b}),c.drag_links&&this.config.show_links&&gantt._render_pair(f,"gantt_link_control",a,function(a){var b=document.createElement("div");b.className=a,b.style.cssText=["height:"+d+"px","line-height:"+d+"px"].join(";");var c=document.createElement("div");return c.className="gantt_link_point",b.appendChild(c),b})),f}},gantt._render_task_element=function(a){
var b=this.config.type_renderers,c=b[this._get_safe_type(a.type)],d=this._task_default_render;return c||(c=d),c.call(this,a,dhtmlx.bind(d,this))},gantt._render_side_content=function(a,b,c){if(!b)return null;var d=b(a.start_date,a.end_date,a);if(!d)return null;var e=document.createElement("div");return e.className="gantt_side_content "+c,e.innerHTML=d,e},gantt._render_leftside_content=function(a){var b="gantt_left "+gantt._get_link_crossing_css(!0,a);return gantt._render_side_content(a,this.templates.leftside_text,b)},gantt._render_rightside_content=function(a){var b="gantt_right "+gantt._get_link_crossing_css(!1,a);return gantt._render_side_content(a,this.templates.rightside_text,b)},gantt._get_conditions=function(a){return a?{$source:[gantt.config.links.start_to_start],$target:[gantt.config.links.start_to_start,gantt.config.links.finish_to_start]}:{$source:[gantt.config.links.finish_to_start,gantt.config.links.finish_to_finish],$target:[gantt.config.links.finish_to_finish]}},gantt._get_link_crossing_css=function(a,b){var c=gantt._get_conditions(a);for(var d in c)for(var e=b[d],f=0;f<e.length;f++)for(var g=gantt.getLink(e[f]),h=0;h<c[d].length;h++)if(g.type==c[d][h])return"gantt_link_crossing";return""},gantt._render_task_content=function(a,b){var c=document.createElement("div");return this._get_safe_type(a.type)!=this.config.types.milestone&&(c.innerHTML=this.templates.task_text(a.start_date,a.end_date,a)),c.className="gantt_task_content",c},gantt._render_task_progress=function(a,b,c){var d=1*a.progress||0;c=Math.max(c-2,0);var e=document.createElement("div"),f=Math.round(c*d);if(f=Math.min(c,f),a.progressColor&&(e.style.backgroundColor=a.progressColor,e.style.opacity=1),e.style.width=f+"px",this.templates.progress_class?e.className=this.templates.progress_class(a):e.className="gantt_task_progress",e.innerHTML=this.templates.progress_text(a.start_date,a.end_date,a),b.appendChild(e),this.config.drag_progress&&!gantt._is_readonly(a)){var g=document.createElement("div");g.style.left=f+"px",g.className="gantt_task_progress_drag",e.appendChild(g),b.appendChild(g)}},gantt._get_line=function(a){var b={second:1,minute:60,hour:3600,day:86400,week:604800,month:2592e3,year:31536e3};return b[a]||0},gantt.dateFromPos=function(a){var b=this._tasks;if(0>a||a>b.full_width||!b.full_width)return null;var c=this._findBinary(this._tasks.left,a),d=this._tasks.left[c],e=b.width[c]||b.col_width,f=0;e&&(f=(a-d)/e);var g=0;f&&(g=gantt._get_coll_duration(b,b.trace_x[c]));var h=new Date(b.trace_x[c].valueOf()+Math.round(f*g));return h},gantt.posFromDate=function(a){var b=gantt._day_index_by_date(a);dhtmlx.assert(b>=0,"Invalid day index");var c=Math.floor(b),d=b%1,e=gantt._tasks.left[Math.min(c,gantt._tasks.width.length-1)];return c==gantt._tasks.width.length&&(e+=gantt._tasks.width[gantt._tasks.width.length-1]),d&&(e+=c<gantt._tasks.width.length?gantt._tasks.width[c]*(d%1):1),e},gantt._day_index_by_date=function(a){var b=new Date(a).valueOf(),c=gantt._tasks.trace_x,d=gantt._tasks.ignore_x;if(b<=this._min_date)return 0;if(b>=this._max_date)return c.length;for(var e=gantt._findBinary(c,b),f=+gantt._tasks.trace_x[e];d[f];)f=gantt._tasks.trace_x[++e];return f?e+(a-c[e])/gantt._get_coll_duration(gantt._tasks,c[e]):0},gantt._findBinary=function(a,b){for(var c,d,e,f=0,g=a.length-1;g>=f;)if(c=Math.floor((f+g)/2),d=+a[c],e=+a[c-1],b>d)f=c+1;else{if(!(d>b))return c;if(!isNaN(e)&&b>e)return c-1;g=c-1}return a.length-1},gantt._get_coll_duration=function(a,b){return gantt.date.add(b,a.step,a.unit)-b},gantt._get_x_pos=function(a,b){b=b!==!1;gantt.posFromDate(b?a.start_date:a.end_date)},gantt.getTaskTop=function(a){return this._y_from_ind(this.getGlobalTaskIndex(a))},gantt._get_task_coord=function(a,b,c){b=b!==!1,c=c||0;var d=this._get_safe_type(a.type)==this.config.types.milestone,e=null;e=b||d?a.start_date||this._default_task_date(a):a.end_date||this.calculateEndDate(this._default_task_date(a));var f=this.posFromDate(e),g=this.getTaskTop(a.id);return d&&(b?f-=c:f+=c),{x:f,y:g}},gantt._get_task_pos=function(a,b){b=b!==!1;var c=gantt._get_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._get_task_visible_pos=function(a,b){b=b!==!1;var c=gantt._get_visible_milestone_width()/2;return this._get_task_coord(a,b,c)},gantt._correct_shift=function(a,b){return a-=6e4*(new Date(gantt._min_date).getTimezoneOffset()-new Date(a).getTimezoneOffset())*(b?-1:1)},gantt._get_mouse_pos=function(a){if(a.pageX||a.pageY)var b={x:a.pageX,y:a.pageY};var c=_isIE?document.documentElement:document.body,b={x:a.clientX+c.scrollLeft-c.clientLeft,y:a.clientY+c.scrollTop-c.clientTop},d=gantt._get_position(gantt.$task_data);return b.x=b.x-d.x+gantt.$task_data.scrollLeft,b.y=b.y-d.y+gantt.$task_data.scrollTop,b},gantt._is_layer=function(a){return a&&a.hasAttribute&&a.hasAttribute(this.config.layer_attribute)},gantt._task_renderer=function(a,b,c,d){return this._task_area_pulls||(this._task_area_pulls={}),this._task_area_renderers||(this._task_area_renderers={}),this._task_area_renderers[a]?this._task_area_renderers[a]:(b||dhtmlx.assert(!1,"Invalid renderer call"),c&&c.setAttribute(this.config.layer_attribute,!0),this._task_area_renderers[a]={render_item:function(e,f){var g=gantt._task_area_pulls[a];if(f=f||c,d&&!d(e))return void this.remove_item(e.id);var h=b.call(gantt,e);h&&(g[e.id]?this.replace_item(e.id,h):(g[e.id]=h,f.appendChild(h)))},clear:function(b){this.rendered=gantt._task_area_pulls[a]={},b=b||c,b&&(b.innerHTML="")},render_items:function(a,b){b=b||c,this.clear(b);for(var d=document.createDocumentFragment(),e=0,f=a.length;f>e;e++)this.render_item(a[e],d);b.appendChild(d)},replace_item:function(a,b){var c=this.rendered[a];c&&c.parentNode&&c.parentNode.replaceChild(b,c),this.rendered[a]=b},remove_item:function(a){var b=this.rendered[a];b&&b.parentNode&&b.parentNode.removeChild(b),delete this.rendered[a]},change_id:function(a,b){this.rendered[b]=this.rendered[a],delete this.rendered[a]},rendered:this._task_area_pulls[a],node:c,unload:function(){this.clear(),delete gantt._task_area_renderers[a],delete gantt._task_area_pulls[a]}},this._task_area_renderers[a])},gantt._clear_renderers=function(){for(var a in this._task_area_renderers)this._task_renderer(a).unload()},gantt._render_bg_canvas=function(a){var b=gantt._tasks,c=gantt.$task_bg,d=document.createElement("canvas"),e=gantt.config.row_height,f=b.col_width;if(d.getContext){d.height=e,d.width=f;var g=document.createElement("div"),h=document.createElement("div");g.className="gantt_task_row",h.className="gantt_task_cell",g.style.display=h.style.display="none",c.appendChild(g),g.appendChild(h);var i=d.getContext("2d");i.beginPath(),i.moveTo(0,e),i.lineTo(f,e),i.lineWidth=1,i.strokeStyle=getComputedStyle(g).getPropertyValue("border-bottom-color")||"#ebebeb",i.stroke(),i.beginPath(),i.moveTo(f,e),i.lineTo(f,0),i.lineWidth=1,i.strokeStyle=getComputedStyle(h).getPropertyValue("border-right-color")||"#ebebeb",i.stroke(),b.fill_img=d.toDataURL(),c.style.height=e*gantt._order.length+"px",c.style.backgroundImage="url("+b.fill_img+")",c.removeChild(g)}},gantt.attachEvent("onGanttReady",function(){gantt._task_layers.add(),gantt._link_layers.add()}),gantt._layers={prepareConfig:function(a){"function"==typeof a&&(a={renderer:a});a.id=dhtmlx.uid();return a.container||(a.container=document.createElement("div")),a},create:function(a,b){return{tempCollection:[],renderers:{},container:a,getRenderers:function(){var a=[];for(var b in this.renderers)a.push(this.renderers[b]);return a},getRenderer:function(a){return this.renderers[a]},add:function(a){if(a&&this.tempCollection.push(a),this.container())for(var c=this.container(),d=this.tempCollection,e=0;e<d.length;e++){var a=d[e],f=a.container,g=a.id,h=a.topmost;if(!f.parentNode)if(h)c.appendChild(f);else{var i=b?b():c.firstChild;i?c.insertBefore(f,i):c.appendChild(f)}this.renderers[g]=gantt._task_renderer(g,a.renderer,f,a.filter),this.tempCollection.splice(e,1),e--}},remove:function(a){this.renderers[a].unload(),delete this.renderers[a]},clear:function(){for(var a in this.renderers)this.renderers[a].unload();this.renderers={}}}}},gantt._create_filter=function(a){return a instanceof Array||(a=Array.prototype.slice.call(arguments,0)),function(b){for(var c=!0,d=0,e=a.length;e>d;d++){var f=a[d];gantt[f]&&(c=c&&gantt[f].call(gantt,b.id,b)!==!1)}return c}},gantt._add_generic_layer=function(a,b){return function(c){return void 0===c.filter&&(c.filter=gantt._create_filter(b)),c=gantt._layers.prepareConfig(c),a.add(c),c.id}},gantt._task_layers=gantt._layers.create(function(){return gantt.$task_data},function(){return gantt.$task_links}),gantt._link_layers=gantt._layers.create(function(){return gantt.$task_data}),gantt.addTaskLayer=gantt._add_generic_layer(gantt._task_layers,["_filter_task","_is_chart_visible"]),gantt.removeTaskLayer=function(a){gantt._task_layers.remove(a)},gantt.addLinkLayer=gantt._add_generic_layer(gantt._link_layers,["_filter_link","_is_chart_visible"]),gantt.removeLinkLayer=function(a){gantt._link_layers.remove(a)},gantt._get_task_renderers=function(){return this._task_layers.getRenderers()},gantt._get_link_renderers=function(){return this._link_layers.getRenderers()},gantt._pull={},gantt._branches={},gantt._order=[],gantt._lpull={},gantt._order_full=[],gantt.load=function(a,b,c){this._load_url=a,dhtmlx.assert(arguments.length,"Invalid load arguments"),this.callEvent("onLoadStart",[]);var d="json",e=null;arguments.length>=3?(d=b,e=c):"string"==typeof arguments[1]?d=arguments[1]:"function"==typeof arguments[1]&&(e=arguments[1]),this._load_type=d,dhx4.ajax.get(a,dhtmlx.bind(function(a){this.on_load(a,d),this.callEvent("onLoadEnd",[]),"function"==typeof e&&e.call(this)},this))},gantt.parse=function(a,b){this.on_load({xmlDoc:{responseText:a}},b)},gantt.serialize=function(a){return a=a||"json",this[a].serialize()},gantt.on_load=function(a,b){this.callEvent("onBeforeParse",[]),b||(b="json"),dhtmlx.assert(this[b],"Invalid data type:'"+b+"'");var c=a.xmlDoc.responseText,d=this[b].parse(c,a);this._process_loading(d)},gantt._process_loading=function(a){a.collections&&this._load_collections(a.collections);for(var b,c=a.data,d=0;d<c.length;d++)b=c[d],this._init_task(b),this.callEvent("onTaskLoading",[b])&&(this._order_full.push(b.id),this._pull[b.id]=b);for(var d in this._pull)b=this._pull[d],this.setParent(b,this.getParent(b)||this.config.root_id);for(var d=0;d<this._order_full.length;d++)b=this._pull[this._order_full[d]],this._add_branch(b),b.$level=this.calculateTaskLevel(b);if(this._sync_order(),this._init_links(a.links||(a.collections?a.collections.links:[])),this.callEvent("onParse",[]),this.render(),this.config.initial_scroll){var e=this._order[0]||this.config.root_id;e&&this.showTask(e)}},gantt._init_links=function(a){if(a)for(var b=0;b<a.length;b++)if(a[b]){var c=this._init_link(a[b]);this._lpull[c.id]=c}this._sync_links()},gantt._load_collections=function(a){var b=!1;for(var c in a)if(a.hasOwnProperty(c)){b=!0;var d=a[c],e=this.serverList[c];if(!e)continue;e.splice(0,e.length);for(var f=0;f<d.length;f++){var g=d[f],h=dhtmlx.copy(g);h.key=h.value;for(var i in g)if(g.hasOwnProperty(i)){if("value"==i||"label"==i)continue;h[i]=g[i]}e.push(h)}}b&&this.callEvent("onOptionsLoad",[])},gantt._sync_order=function(a){this._order=[],this._sync_order_item({parent:this.config.root_id,$open:!0,$ignore:!0,id:this.config.root_id}),a||(this._scroll_resize(),this._set_sizes())},gantt.attachEvent("onBeforeTaskDisplay",function(a,b){return!b.$ignore}),gantt._sync_order_item=function(a){if(a.id&&this._filter_task(a.id,a)&&this.callEvent("onBeforeTaskDisplay",[a.id,a])&&this._order.push(a.id),a.$open){var b=this.getChildren(a.id);if(b)for(var c=0;c<b.length;c++)this._sync_order_item(this._pull[b[c]])}},gantt.getTaskCount=function(){return this._order_full.length},gantt.getVisibleTaskCount=function(){return this._order.length},gantt.getTaskIndex=function(a){for(var b=this.getChildren(this.getParent(a)),c=0;c<b.length;c++)if(b[c]==a)return c;return-1},gantt.getGlobalTaskIndex=function(a){dhtmlx.assert(a,"Invalid argument");for(var b=this._order,c=0,d=b.length;d>c;c++)if(b[c]==a)return c;return-1},gantt._get_visible_order=gantt.getGlobalTaskIndex,gantt.eachTask=function(a,b,c){b=b||this.config.root_id,c=c||this;var d=this.getChildren(b);if(d)for(var e=0;e<d.length;e++){var f=this._pull[d[e]];a.call(c,f),this.hasChild(f.id)&&this.eachTask(a,f.id,c)}},gantt.json={parse:function(data){return dhtmlx.assert(data,"Invalid data"),"string"==typeof data&&(window.JSON?data=JSON.parse(data):(gantt._temp=eval("("+data+")"),data=gantt._temp||{},gantt._temp=null)),data.dhx_security&&(dhtmlx.security_key=data.dhx_security),data},_copyLink:function(a){var b={};for(var c in a)b[c]=a[c];return b},_copyObject:function(a){var b={};for(var c in a)"$"!=c.charAt(0)&&(b[c]=a[c],b[c]instanceof Date&&(b[c]=gantt.templates.xml_format(b[c])));return b},serialize:function(){var a=[],b=[];gantt.eachTask(function(b){gantt.resetProjectDates(b),a.push(this._copyObject(b))},gantt.config.root_id,this);for(var c in gantt._lpull)b.push(this._copyLink(gantt._lpull[c]));return{data:a,links:b}}},gantt.xml={_xmlNodeToJSON:function(a,b){for(var c={},d=0;d<a.attributes.length;d++)c[a.attributes[d].name]=a.attributes[d].value;if(!b){for(var d=0;d<a.childNodes.length;d++){var e=a.childNodes[d];1==e.nodeType&&(c[e.tagName]=e.firstChild?e.firstChild.nodeValue:"")}c.text||(c.text=a.firstChild?a.firstChild.nodeValue:"")}return c},_getCollections:function(a){for(var b={},c=dhx4.ajax.xpath("//coll_options",a),d=0;d<c.length;d++)for(var e=c[d].getAttribute("for"),f=b[e]=[],g=dhx4.ajax.xpath(".//item",c[d]),h=0;h<g.length;h++){for(var i=g[h],j=i.attributes,k={key:g[h].getAttribute("value"),label:g[h].getAttribute("label")},l=0;l<j.length;l++){var m=j[l];"value"!=m.nodeName&&"label"!=m.nodeName&&(k[m.nodeName]=m.nodeValue)}f.push(k)}return b},_getXML:function(a,b,c){c=c||"data",b.getXMLTopNode||(b=dhx4.ajax.parse(b));var d=dhx4.ajax.xmltop(c,b.xmlDoc);if(d.tagName!=c)throw"Invalid XML data";var e=d.getAttribute("dhx_security");return e&&(dhtmlx.security_key=e),d},parse:function(a,b){b=this._getXML(a,b);for(var c={},d=c.data=[],e=dhx4.ajax.xpath("//task",b),f=0;f<e.length;f++)d[f]=this._xmlNodeToJSON(e[f]);return c.collections=this._getCollections(b),c},_copyLink:function(a){return"<item id='"+a.id+"' source='"+a.source+"' target='"+a.target+"' type='"+a.type+"' />"},_copyObject:function(a){return"<task id='"+a.id+"' parent='"+(a.parent||"")+"' start_date='"+a.start_date+"' duration='"+a.duration+"' open='"+!!a.open+"' progress='"+a.progress+"' end_date='"+a.end_date+"'><![CDATA["+a.text+"]]></task>"},serialize:function(){for(var a=[],b=[],c=gantt.json.serialize(),d=0,e=c.data.length;e>d;d++)a.push(this._copyObject(c.data[d]));for(var d=0,e=c.links.length;e>d;d++)b.push(this._copyLink(c.links[d]));return"<data>"+a.join("")+"<coll_options for='links'>"+b.join("")+"</coll_options></data>"}},gantt.oldxml={parse:function(a,b){b=gantt.xml._getXML(a,b,"projects");for(var c={collections:{links:[]}},d=c.data=[],e=dhx4.ajax.xpath("//task",b),f=0;f<e.length;f++){d[f]=gantt.xml._xmlNodeToJSON(e[f]);var g=e[f].parentNode;"project"==g.tagName?d[f].parent="project-"+g.getAttribute("id"):d[f].parent=g.parentNode.getAttribute("id")}e=dhx4.ajax.xpath("//project",b);for(var f=0;f<e.length;f++){var h=gantt.xml._xmlNodeToJSON(e[f],!0);h.id="project-"+h.id,d.push(h)}for(var f=0;f<d.length;f++){var h=d[f];h.start_date=h.startdate||h.est,h.end_date=h.enddate,h.text=h.name,h.duration=h.duration/8,h.open=1,h.duration||h.end_date||(h.duration=1),h.predecessortasks&&c.collections.links.push({target:h.id,source:h.predecessortasks,type:gantt.config.links.finish_to_start})}return c},serialize:function(){dhtmlx.message("Serialization to 'old XML' is not implemented")}},gantt.serverList=function(a,b){return b?this.serverList[a]=b.slice(0):this.serverList[a]||(this.serverList[a]=[]),this.serverList[a]},gantt._working_time_helper={units:["year","month","week","day","hour","minute"],hours:[8,17],dates:{0:!1,6:!1},_working_units_cache:{_cache:{},get:function(a,b){if(!a||!b)return-1;var c=this._cache,d=b.getTime(),e=-1;return c&&c[a]&&void 0!==c[a][d]&&(e=c[a][d]),e},put:function(a,b,c){if(!a||!b)return!1;var d=this._cache,e=b.getTime();return c=!!c,d?(d[a]||(d[a]={}),d[a][e]=c,!0):!1},clear:function(){this._cache={}}},_get_unit_order:function(a){for(var b=0,c=this.units.length;c>b;b++)if(this.units[b]==a)return b;dhtmlx.assert(!1,"Incorrect duration unit")},_timestamp:function(a){var b=null;return a.day||0===a.day?b=a.day:a.date&&(b=gantt.date.date_part(new Date(a.date)).valueOf()),b},set_time:function(a){var b=void 0!==a.hours?a.hours:!0,c=this._timestamp(a);null!==c?this.dates[c]=b:this.hours=b,this._working_units_cache.clear()},unset_time:function(a){if(a){var b=this._timestamp(a);null!==b&&delete this.dates[b]}else this.hours=[];this._working_units_cache.clear()},is_working_unit:function(a,b,c){if(!gantt.config.work_time)return!0;var d=this._working_units_cache.get(b,a);return-1==d&&(d=this._check_is_working_unit(a,b,c),this._working_units_cache.put(b,a,d)),d},_check_is_working_unit:function(a,b,c){return void 0===c&&(c=this._get_unit_order(b)),void 0===c?!1:c&&!this.is_working_unit(a,this.units[c-1],c-1)?!1:this["is_work_"+b]?this["is_work_"+b](a):!0},is_work_day:function(a){var b=this.get_working_hours(a);return b instanceof Array?b.length>0:!1},is_work_hour:function(a){for(var b=this.get_working_hours(a),c=a.getHours(),d=0;d<b.length;d+=2){if(void 0===b[d+1])return b[d]==c;if(c>=b[d]&&c<b[d+1])return!0}return!1},get_working_hours:function(a){var b=this._timestamp({date:a}),c=!0;return void 0!==this.dates[b]?c=this.dates[b]:void 0!==this.dates[a.getDay()]&&(c=this.dates[a.getDay()]),c===!0?this.hours:c?c:[]},get_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1,g=0;e.valueOf()<f.valueOf();)this.is_working_unit(e,c)&&g++,e=gantt.date.add(e,d,c);return g},is_work_units_between:function(a,b,c,d){if(!c)return!1;for(var e=new Date(a),f=new Date(b),d=d||1;e.valueOf()<f.valueOf();){if(this.is_working_unit(e,c))return!0;e=gantt.date.add(e,d,c)}return!1},add_worktime:function(a,b,c,d){if(!c)return!1;var e=new Date(a),f=0,d=d||1,b=1*b;if(gantt.config.work_time){for(;b>f;){var g=gantt.date.add(e,d,c);this.is_working_unit(d>0?e:g,c)&&f++,e=g}return e}return gantt.date.add(e,d*b,c)},get_closest_worktime:function(a){if(this.is_working_unit(a.date,a.unit))return a.date;var b=a.unit,c=gantt.date[b+"_start"](a.date),d=new Date(c),e=new Date(c),f=!0,g=3e3,h=0,i="any"==a.dir||!a.dir,j=1;for("past"==a.dir&&(j=-1);!this.is_working_unit(c,b);){i&&(c=f?d:e,j=-1*j);var k=c.getTimezoneOffset();if(c=gantt.date.add(c,j,b),c=gantt._correct_dst_change(c,k,j,b),gantt.date[b+"_start"]&&(c=gantt.date[b+"_start"](c)),i&&(f?d=c:e=c),f=!f,h++,h>g)return dhtmlx.assert(!1,"Invalid working time check"),!1}return(c==e||"past"==a.dir)&&(c=gantt.date.add(c,1,b)),c}},gantt.getTask=function(a){return dhtmlx.assert(a,"Invalid argument for gantt.getTask"),dhtmlx.assert(this._pull[a],"Task not found id="+a),this._pull[a]},gantt.getTaskByTime=function(a,b){var c=this._pull,d=[];if(a||b){a=+a||-(1/0),b=+b||1/0;for(var e in c){var f=c[e];+f.start_date<b&&+f.end_date>a&&d.push(f)}}else for(var e in c)d.push(c[e]);return d},gantt.isTaskExists=function(a){return dhtmlx.defined(this._pull[a])},gantt.isUnscheduledTask=function(a){return!!a.unscheduled||!a.start_date},gantt._isAllowedUnscheduledTask=function(a){return a.unscheduled&&gantt.config.show_unscheduled},gantt.isTaskVisible=function(a){if(!this._pull[a])return!1;var b=this._pull[a];if(!(+b.start_date<+this._max_date&&+b.end_date>+this._min_date||gantt._isAllowedUnscheduledTask(b)))return!1;for(var c=0,d=this._order.length;d>c;c++)if(this._order[c]==a)return!0;return!1},gantt.updateTask=function(a,b){return dhtmlx.defined(b)||(b=this.getTask(a)),this.callEvent("onBeforeTaskUpdate",[a,b])===!1?!1:(this._pull[b.id]=b,this._is_parent_sync(b)||this._resync_parent(b),this._isAllowedUnscheduledTask(b)&&(this._init_task(b),this._sync_links()),this._update_parents(b.id),this.refreshTask(b.id),this.callEvent("onAfterTaskUpdate",[a,b]),this._sync_order(),void this._adjust_scales())},gantt._add_branch=function(a,b){var c=this.getParent(a);this.hasChild(c)||(this._branches[c]=[]);for(var d=this.getChildren(c),e=!1,f=0,g=d.length;g>f;f++)if(d[f]==a.id){e=!0;break}e||(1*b==b?d.splice(b,0,a.id):d.push(a.id)),this._sync_parent(a)},gantt._move_branch=function(a,b,c){this.setParent(a,c),this._sync_parent(a),this._replace_branch_child(b,a.id),this.isTaskExists(c)||c==this.config.root_id?this._add_branch(a):delete this._branches[a.id],a.$level=this.calculateTaskLevel(a),this._sync_order()},gantt._resync_parent=function(a){this._move_branch(a,a.$rendered_parent,this.getParent(a))},gantt._sync_parent=function(a){a.$rendered_parent=this.getParent(a)},gantt._is_parent_sync=function(a){return a.$rendered_parent==this.getParent(a)},gantt._replace_branch_child=function(a,b,c){var d=this.getChildren(a);if(d){for(var e=[],f=0;f<d.length;f++)d[f]!=b?e.push(d[f]):c&&e.push(c);this._branches[a]=e}this._sync_order()},gantt.addTask=function(a,b,c){return dhtmlx.defined(b)||(b=this.getParent(a)||0),this.isTaskExists(b)||(b=0),this.setParent(a,b),a=this._init_task(a),this.callEvent("onBeforeTaskAdd",[a.id,a])===!1?!1:(this._pull[a.id]=a,this._add_branch(a,c),this.refreshData(),this._adjust_scales(),this.callEvent("onAfterTaskAdd",[a.id,a]),a.id)},gantt._default_task_date=function(a,b){var c=b&&b!=this.config.root_id?this.getTask(b):!1,d="";if(c)d=c.start_date;else{var e=this._order[0];d=e?this.getTask(e).start_date?this.getTask(e).start_date:this.getTask(e).end_date?this.calculateEndDate(this.getTask(e).end_date,-this.config.duration_step):"":this.config.start_date||this.getState().min_date}return dhtmlx.assert(d,"Invalid dates"),new Date(d)},gantt._set_default_task_timing=function(a){a.start_date=a.start_date||gantt._default_task_date(a,this.getParent(a)),a.duration=a.duration||this.config.duration_step,a.end_date=a.end_date||this.calculateEndDate(a.start_date,a.duration)},gantt.createTask=function(a,b,c){if(a=a||{},a.id=dhtmlx.uid(),a.start_date||(a.start_date=gantt._default_task_date(a,b)),void 0===a.text&&(a.text=gantt.locale.labels.new_task),void 0===a.duration&&(a.duration=1),b){this.setParent(a,b);var d=this.getTask(b);d.$open=!0}return this.callEvent("onTaskCreated",[a])?(this.config.details_on_create?(a.$new=!0,this._pull[a.id]=this._init_task(a),this._add_branch(a,c),a.$level=this.calculateTaskLevel(a),this.selectTask(a.id),this.refreshData(),this.showLightbox(a.id)):this.addTask(a,b,c)&&(this.showTask(a.id),this.selectTask(a.id)),a.id):null},gantt.deleteTask=function(a){return this._deleteTask(a)},gantt._getChildLinks=function(a){var b=this.getTask(a);if(!b)return[];for(var c=b.$source.concat(b.$target),d=this.getChildren(b.id),e=0;e<d.length;e++)c=c.concat(this._getChildLinks(d[e]));for(var f={},e=0;e<c.length;e++)f[c[e]]=!0;c=[];for(var e in f)c.push(e);return c},gantt._getTaskTree=function(a){var b=this.getTask(a);if(!b)return[];for(var c=[],d=this.getChildren(b.id),e=0;e<d.length;e++)c.push(d[e]),c=c.concat(this._getTaskTree(d[e]));return c},gantt._deleteRelatedLinks=function(a,b){var c=this._dp&&!b,d="",e=c?"off"!=this._dp.updateMode:!1;c&&(d=this._dp.updateMode,this._dp.setUpdateMode("off"));for(var f=0;f<a.length;f++)c&&(this._dp.setGanttMode("links"),this._dp.setUpdated(a[f],!0,"deleted")),this._deleteLink(a[f],!0);c&&(this._dp.setUpdateMode(d),e&&this._dp.sendAllData())},gantt._deleteRelatedTasks=function(a,b){var c=this._dp&&!b,d="";c&&(d=this._dp.updateMode,this._dp.setGanttMode("tasks"),this._dp.setUpdateMode("off"));for(var e=this._getTaskTree(a),f=0;f<e.length;f++){var g=e[f];this._unset_task(g),c&&this._dp.setUpdated(g,!0,"deleted")}c&&this._dp.setUpdateMode(d)},gantt._unset_task=function(a){var b=this.getTask(a);this._update_flags(a,null),delete this._pull[a],this._move_branch(b,this.getParent(b),null)},gantt._deleteTask=function(a,b){var c=this.getTask(a);if(!b&&this.callEvent("onBeforeTaskDelete",[a,c])===!1)return!1;var d=gantt._getChildLinks(a);return this._deleteRelatedTasks(a,b),this._deleteRelatedLinks(d,b),this._unset_task(a),b||(this.callEvent("onAfterTaskDelete",[a,c]),this.refreshData()),!0},gantt.clearAll=function(){this._clear_data(),this.callEvent("onClear",[]),this.refreshData()},gantt._clear_data=function(){this._pull={},this._branches={},this._order=[],this._order_full=[],this._lpull={},this._update_flags(),this.userdata={}},gantt._update_flags=function(a,b){void 0===a?(this._lightbox_id=this._selected_task=null,this._tasks_dnd.drag&&(this._tasks_dnd.drag.id=null)):(this._lightbox_id==a&&(this._lightbox_id=b),this._selected_task==a&&(this._selected_task=b),this._tasks_dnd.drag&&this._tasks_dnd.drag.id==a&&(this._tasks_dnd.drag.id=b))},gantt.changeTaskId=function(a,b){var c=this._pull[b]=this._pull[a];this._pull[b].id=b,delete this._pull[a];for(var d in this._pull){var e=this._pull[d];this.getParent(e)==a&&this.setParent(e,b)}this._update_flags(a,b),this._replace_branch_child(this.getParent(c),a,b),this.callEvent("onTaskIdChange",[a,b])},gantt._get_duration_unit=function(){return 1e3*gantt._get_line(this.config.duration_unit)||this.config.duration_unit},gantt._get_safe_type=function(a){return"task"},gantt._get_type_name=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return b;return"task"},gantt.getWorkHours=function(a){return this._working_time_helper.get_working_hours(a)},gantt.setWorkTime=function(a){this._working_time_helper.set_time(a)},gantt.isWorkTime=function(a,b){var c=this._working_time_helper;return c.is_working_unit(a,b||this.config.duration_unit)},gantt.correctTaskWorkTime=function(a){gantt.config.work_time&&gantt.config.correct_work_time&&(gantt.isWorkTime(a.start_date)?gantt.isWorkTime(new Date(+a.end_date-1))||(a.end_date=gantt.calculateEndDate(a.start_date,a.duration)):(a.start_date=gantt.getClosestWorkTime({date:a.start_date,dir:"future"}),a.end_date=gantt.calculateEndDate(a.start_date,a.duration)))},gantt.getClosestWorkTime=function(a){var b=this._working_time_helper;return a instanceof Date&&(a={date:a}),a.dir=a.dir||"any",a.unit=a.unit||this.config.duration_unit,b.get_closest_worktime(a)},gantt.calculateDuration=function(a,b){var c=this._working_time_helper;return c.get_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt._hasDuration=function(a,b){var c=this._working_time_helper;return c.is_work_units_between(a,b,this.config.duration_unit,this.config.duration_step)},gantt.calculateEndDate=function(a,b,c){var d=this._working_time_helper,e=b>=0?1:-1;return d.add_worktime(a,Math.abs(b),c||this.config.duration_unit,e*this.config.duration_step)},gantt._init_task=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a.start_date&&(a.start_date=gantt.date.parseDate(a.start_date,"xml_date")),a.end_date&&(a.end_date=gantt.date.parseDate(a.end_date,"xml_date")),a.start_date?!a.end_date&&a.duration&&(a.end_date=this.calculateEndDate(a.start_date,a.duration)):a.end_date&&void 0!==a.duration&&(a.start_date=this.calculateEndDate(a.end_date,-a.duration)),this._isAllowedUnscheduledTask(a)&&this._set_default_task_timing(a),gantt._init_task_timing(a),a.start_date&&a.end_date&&gantt.correctTaskWorkTime(a),a.$source=[],a.$target=[],void 0===a.parent&&this.setParent(a,this.config.root_id),dhtmlx.defined(a.$open)||(a.$open=dhtmlx.defined(a.open)?a.open:this.config.open_tree_initially),a.$level=this.calculateTaskLevel(a),a},gantt._init_task_timing=function(a){var b=this._get_safe_type(a.type);void 0===a.$rendered_type?a.$rendered_type=b:a.$rendered_type!=b&&(delete a.$no_end,delete a.$no_start,a.$rendered_type=b),void 0!==a.$no_end&&void 0!==a.$no_start||b==this.config.types.milestone||(b==this.config.types.project?(a.$no_end=a.$no_start=!0,this._set_default_task_timing(a)):(a.$no_end=!(a.end_date||a.duration),a.$no_start=!a.start_date,this._isAllowedUnscheduledTask(a)&&(a.$no_end=a.$no_start=!1))),b==this.config.types.milestone&&(a.end_date=a.start_date),a.start_date&&a.end_date&&(a.duration=this.calculateDuration(a.start_date,a.end_date)),a.duration=a.duration||0},gantt._is_flex_task=function(a){return!(!a.$no_end&&!a.$no_start)},gantt.resetProjectDates=function(a){if(a.$no_end||a.$no_start){var b=this.getSubtaskDates(a.id);this._assign_project_dates(a,b.start_date,b.end_date)}},gantt.getSubtaskDates=function(a){var b=null,c=null,d=void 0!==a?a:gantt.config.root_id;return this.eachTask(function(a){this._get_safe_type(a.type)==gantt.config.types.project||this.isUnscheduledTask(a)||(a.start_date&&!a.$no_start&&(!b||b>a.start_date.valueOf())&&(b=a.start_date.valueOf()),a.end_date&&!a.$no_end&&(!c||c<a.end_date.valueOf())&&(c=a.end_date.valueOf()))},d),{start_date:b?new Date(b):null,end_date:c?new Date(c):null}},gantt._assign_project_dates=function(a,b,c){a.$no_start&&(b&&b!=1/0?a.start_date=new Date(b):a.start_date=this._default_task_date(a,this.getParent(a))),a.$no_end&&(c&&c!=-(1/0)?a.end_date=new Date(c):a.end_date=this.calculateEndDate(a.start_date,this.config.duration_step)),(a.$no_start||a.$no_end)&&this._init_task_timing(a)},gantt._update_parents=function(a,b){if(a){for(var c=this.getTask(a),d=this.getParent(c);!c.$no_end&&!c.$no_start&&d&&this.isTaskExists(d);)c=this.getTask(d),d=this.getParent(c);(c.$no_start||c.$no_end)&&(gantt.resetProjectDates(c),b||this.refreshTask(c.id,!0)),d&&this.isTaskExists(d)&&this._update_parents(d,b)}},gantt.isChildOf=function(a,b){if(!this.isTaskExists(a))return!1;if(b===this.config.root_id)return this.isTaskExists(a);for(var c=this.getTask(a),d=this.getParent(a);c&&this.isTaskExists(d);){if(c=this.getTask(d),c&&c.id==b)return!0;d=this.getParent(c)}return!1},gantt.roundDate=function(a){a instanceof Date&&(a={date:a,unit:gantt._tasks.unit,step:gantt._tasks.step});var b,c,d=a.date,e=a.step,f=a.unit;if(f==gantt._tasks.unit&&e==gantt._tasks.step&&+d>=+gantt._min_date&&+d<=+gantt._max_date){var g=Math.floor(gantt._day_index_by_date(d));c=new Date(gantt._tasks.trace_x[g]),b=new Date(c),gantt._tasks.trace_x[g+1]&&(b=new Date(gantt._tasks.trace_x[g+1]))}else{for(b=gantt.date[f+"_start"](new Date(this._min_date));+d>+b;){b=gantt.date[f+"_start"](gantt.date.add(b,e,f));var h=b.getTimezoneOffset();b=gantt.date.add(b,e,f),b=gantt._correct_dst_change(b,h,b,f),gantt.date[f+"_start"]&&(b=gantt.date[f+"_start"](b))}c=gantt.date.add(b,-1*e,f)}return a.dir&&"future"==a.dir?b:a.dir&&"past"==a.dir?c:Math.abs(d-c)<Math.abs(b-d)?c:b},gantt.attachEvent("onBeforeTaskUpdate",function(a,b){return gantt._init_task_timing(b),!0}),gantt.attachEvent("onBeforeTaskAdd",function(a,b){return gantt._init_task_timing(b),!0}),gantt.calculateTaskLevel=function(a){for(var b=0;this.getParent(a)&&this.isTaskExists(this.getParent(a));)a=this.getTask(this.getParent(a)),b++;return b},gantt.sort=function(a,b,c,d){var e=!d;this.isTaskExists(c)||(c=this.config.root_id),a||(a="order");var f="string"==typeof a?function(b,c){if(b[a]==c[a])return 0;var d=b[a]>c[a];return d?1:-1}:a;if(b){var g=f;f=function(a,b){return g(b,a)}}var h=this.getChildren(c);if(h){for(var i=[],j=h.length-1;j>=0;j--)i[j]=this._pull[h[j]];i.sort(f);for(var j=0;j<i.length;j++)h[j]=i[j].id,this.sort(a,b,h[j],!0)}e&&this.render()},gantt.getNext=function(a){for(var b=0;b<this._order.length-1;b++)if(this._order[b]==a)return this._order[b+1];return null},gantt.getPrev=function(a){for(var b=1;b<this._order.length;b++)if(this._order[b]==a)return this._order[b-1];return null},gantt._get_parent_id=function(a){var b=this.config.root_id;return a&&(b=a.parent),b},gantt.getParent=function(a){var b=null;return a.id?b=a:this.isTaskExists(a)&&(b=gantt.getTask(a)),this._get_parent_id(b)},gantt.setParent=function(a,b){a.parent=b},gantt.getSiblings=function(a){if(!this.isTaskExists(a))return[];var b=this.getParent(a);return this.getChildren(b)},gantt.getNextSibling=function(a){for(var b=this.getSiblings(a),c=0,d=b.length;d>c;c++)if(b[c]==a)return b[c+1]||null;
return null},gantt.getPrevSibling=function(a){for(var b=this.getSiblings(a),c=0,d=b.length;d>c;c++)if(b[c]==a)return b[c-1]||null;return null},gantt._dp_init=function(a){a.setTransactionMode("POST",!0),a.serverProcessor+=(-1!=a.serverProcessor.indexOf("?")?"&":"?")+"editing=true",a._serverProcessor=a.serverProcessor,a.styles={updated:"gantt_updated",inserted:"gantt_inserted",deleted:"gantt_deleted",invalid:"gantt_invalid",error:"gantt_error",clear:""},a._methods=["_row_style","setCellTextStyle","_change_id","_delete_task"],a.setGanttMode=function(b){var c=a.modes||{};a._ganttMode&&(c[a._ganttMode]={_in_progress:a._in_progress,_invalid:a._invalid,updatedRows:a.updatedRows});var d=c[b];d||(d=c[b]={_in_progress:{},_invalid:{},updatedRows:[]}),a._in_progress=d._in_progress,a._invalid=d._invalid,a.updatedRows=d.updatedRows,a.modes=c,a._ganttMode=b},this._sendTaskOrder=function(b,c){c.$drop_target&&(a.setGanttMode("tasks"),this.getTask(b).target=c.$drop_target,a.setUpdated(b,!0,"order"),delete this.getTask(b).$drop_target)},this.attachEvent("onAfterTaskAdd",function(b,c){a.setGanttMode("tasks"),a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterTaskUpdate",function(b,c){a.setGanttMode("tasks"),a.setUpdated(b,!0),gantt._sendTaskOrder(b,c)}),this.attachEvent("onAfterTaskDelete",function(b,c){a.setGanttMode("tasks"),a.setUpdated(b,!0,"deleted"),"off"==a.updateMode||a._tSend||a.sendAllData()}),this.attachEvent("onAfterLinkUpdate",function(b,c){a.setGanttMode("links"),a.setUpdated(b,!0)}),this.attachEvent("onAfterLinkAdd",function(b,c){a.setGanttMode("links"),a.setUpdated(b,!0,"inserted")}),this.attachEvent("onAfterLinkDelete",function(b,c){a.setGanttMode("links"),a.setUpdated(b,!0,"deleted")}),this.attachEvent("onRowDragEnd",function(a,b){gantt._sendTaskOrder(a,gantt.getTask(a))}),a.attachEvent("onBeforeDataSending",function(){var a=this._serverProcessor;if("REST"==this._tMode){var b=this._ganttMode.substr(0,this._ganttMode.length-1);a=a.substring(0,a.indexOf("?")>-1?a.indexOf("?"):a.length),this.serverProcessor=a+("/"==a.slice(-1)?"":"/")+b}else this.serverProcessor=a+window.dhtmlx.url(a)+"gantt_mode="+this._ganttMode;return!0}),this._init_dp_live_update_hooks(a);var b=a.afterUpdate;a.afterUpdate=function(){var c;c=3==arguments.length?arguments[1]:arguments[4];var d=a._ganttMode,e=c.filePath;d="REST"!=this._tMode?-1!=e.indexOf("gantt_mode=links")?"links":"tasks":e.indexOf("/link")>e.indexOf("/task")?"links":"tasks",a.setGanttMode(d);var f=b.apply(a,arguments);return a.setGanttMode(d),f},a._getRowData=dhtmlx.bind(function(b,c){var d;d="tasks"==a._ganttMode?this.isTaskExists(b)?this.getTask(b):{id:b}:this.isLinkExists(b)?this.getLink(b):{id:b},d=dhtmlx.copy(d);var e={};for(var f in d)if("$"!=f.substr(0,1)){var g=d[f];g instanceof Date?e[f]=this.templates.xml_format(g):null===g?e[f]="":e[f]=g}return d.$no_start&&(d.start_date="",d.duration=""),d.$no_end&&(d.end_date="",d.duration=""),e[a.action_param]=this.getUserData(b,a.action_param),e},this),this._change_id=dhtmlx.bind(function(b,c){"tasks"!=a._ganttMode?this.changeLinkId(b,c):this.changeTaskId(b,c)},this),this._row_style=function(b,c){if("tasks"==a._ganttMode&&gantt.isTaskExists(b)){var d=gantt.getTask(b);d.$dataprocessor_class=c,gantt.refreshTask(b)}},this._delete_task=function(a,b){},this._dp=a,gantt._patch_dhx4_ajax()},gantt._patch_dhx4_ajax=function(){var a=parseInt((dhx4.version||"").split(".").join(""),10);413>=a&&(window.dhx4.ajax._call=function(a,b,c,d,e,f,g){var h=window.XMLHttpRequest&&!dhx4.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),i=null!=navigator.userAgent.match(/AppleWebKit/)&&null!=navigator.userAgent.match(/Qt/)&&null!=navigator.userAgent.match(/Safari/);if(1==d&&(h.onreadystatechange=function(){if(4==h.readyState||1==i&&3==h.readyState){if((200!=h.status||""==h.responseText)&&!dhx4.callEvent("onAjaxError",[h]))return;window.setTimeout(function(){"function"==typeof e&&e.apply(window,[{xmlDoc:h,filePath:b}]),null!=f&&("undefined"!=typeof f.postData?dhx4.ajax.postLong(f.url,f.postData,e):dhx4.ajax.getLong(f.url,e)),e=null,h=null},1)}}),"GET"==a&&1!=this.cache&&(b+=(b.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),h.open(a,b,d),g)for(var j in g)h.setRequestHeader(j,g[j]);else"POST"==a.toUpperCase()||"PUT"==a||"DELETE"==a?h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==a&&(c=null);return h.setRequestHeader("X-Requested-With","XMLHttpRequest"),h.send(c),d?void 0:{xmlDoc:h,filePath:b}}),gantt._patch_dhx4_ajax=function(){}},gantt.getUserData=function(a,b){return this.userdata||(this.userdata={}),this.userdata[a]&&this.userdata[a][b]?this.userdata[a][b]:""},gantt.setUserData=function(a,b,c){this.userdata||(this.userdata={}),this.userdata[a]||(this.userdata[a]={}),this.userdata[a][b]=c},gantt._init_link=function(a){return dhtmlx.defined(a.id)||(a.id=dhtmlx.uid()),a},gantt._sync_links=function(){for(var a in this._pull)this._pull[a].$source=[],this._pull[a].$target=[];for(var a in this._lpull){var b=this._lpull[a];this._pull[b.source]&&this._pull[b.source].$source.push(a),this._pull[b.target]&&this._pull[b.target].$target.push(a)}},gantt.getLink=function(a){return dhtmlx.assert(this._lpull[a],"Link doesn't exist"),this._lpull[a]},gantt.getLinks=function(){var a=[];for(var b in gantt._lpull)a.push(gantt._lpull[b]);return a},gantt.isLinkExists=function(a){return dhtmlx.defined(this._lpull[a])},gantt.addLink=function(a){return a=this._init_link(a),this.callEvent("onBeforeLinkAdd",[a.id,a])===!1?!1:(this._lpull[a.id]=a,this._sync_links(),this._render_link(a.id),this.callEvent("onAfterLinkAdd",[a.id,a]),a.id)},gantt.updateLink=function(a,b){return dhtmlx.defined(b)||(b=this.getLink(a)),this.callEvent("onBeforeLinkUpdate",[a,b])===!1?!1:(this._lpull[a]=b,this._sync_links(),this._render_link(a),this.callEvent("onAfterLinkUpdate",[a,b]),!0)},gantt.deleteLink=function(a){return this._deleteLink(a)},gantt._deleteLink=function(a,b){var c=this.getLink(a);return b||this.callEvent("onBeforeLinkDelete",[a,c])!==!1?(delete this._lpull[a],this._sync_links(),this.refreshLink(a),b||this.callEvent("onAfterLinkDelete",[a,c]),!0):!1},gantt.changeLinkId=function(a,b){this._lpull[b]=this._lpull[a],this._lpull[b].id=b,delete this._lpull[a],this._sync_links(),this.callEvent("onLinkIdChange",[a,b])},gantt.getChildren=function(a){return dhtmlx.defined(this._branches[a])?this._branches[a]:[]},gantt.hasChild=function(a){return dhtmlx.defined(this._branches[a])&&this._branches[a].length},gantt.refreshData=function(){this._render_data()},gantt._configure=function(a,b,c){for(var d in b)("undefined"==typeof a[d]||c)&&(a[d]=b[d])},gantt._init_skin=function(){gantt._get_skin(!1),gantt._init_skin=function(){}},gantt._get_skin=function(a){if(!gantt.skin||a)for(var b=document.getElementsByTagName("link"),c=0;c<b.length;c++){var d=b[c].href.match("dhtmlxgantt_([a-z]+).css");if(d){gantt.skin=d[1];break}}gantt.skin||(gantt.skin="terrace");var e=gantt.skins[gantt.skin];this._configure(gantt.config,e.config,a);var f=gantt.getGridColumns();f[1]&&"undefined"==typeof f[1].width&&(f[1].width=e._second_column_width),f[2]&&"undefined"==typeof f[2].width&&(f[2].width=e._third_column_width),e._lightbox_template&&(gantt._lightbox_template=e._lightbox_template),gantt.resetLightbox()},gantt.resetSkin=function(){this.skin="",this._get_skin(!0)},gantt.skins={},gantt._lightbox_methods={},gantt._lightbox_template="<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span></div><div class='gantt_cal_larea'></div>",gantt.showLightbox=function(a){if(a&&!gantt._is_readonly(this.getTask(a))&&this.callEvent("onBeforeLightbox",[a])){var b=this.getTask(a),c=this.getLightbox(this._get_safe_type(b.type));this._center_lightbox(c),this.showCover(),this._fill_lightbox(a,c),this.callEvent("onLightbox",[a])}},gantt._get_timepicker_step=function(){if(this.config.round_dnd_dates){var a=gantt._tasks,b=this._get_line(a.unit)*a.step/60;return(b>=1440||!this._is_chart_visible())&&(b=this.config.time_step),b}return this.config.time_step},gantt.getLabel=function(a,b){for(var c=this._get_typed_lightbox_config(),d=0;d<c.length;d++)if(c[d].map_to==a)for(var e=c[d].options,f=0;f<e.length;f++)if(e[f].key==b)return e[f].label;return""},gantt.updateCollection=function(a,b){b=b.slice(0);var c=gantt.serverList(a);return c?(c.splice(0,c.length),c.push.apply(c,b||[]),void gantt.resetLightbox()):!1},gantt.getLightboxType=function(){return this._get_safe_type(this._lightbox_type)},gantt.getLightbox=function(a){if(void 0===a&&(a=this.getLightboxType()),!this._lightbox||this.getLightboxType()!=this._get_safe_type(a)){this._lightbox_type=this._get_safe_type(a);var b=document.createElement("DIV");b.className="gantt_cal_light";var c=this._is_lightbox_timepicker();(gantt.config.wide_form||c)&&(b.className+=" gantt_cal_light_wide"),c&&(gantt.config.wide_form=!0,b.className+=" gantt_cal_light_full"),b.style.visibility="hidden";for(var d=this._lightbox_template,e=this.config.buttons_left,f=0;f<e.length;f++){var g=this.config._migrate_buttons[e[f]]?this.config._migrate_buttons[e[f]]:e[f];d+="<div class='gantt_btn_set gantt_left_btn_set "+g+"_set'><div dhx_button='1' class='"+g+"'></div><div>"+this.locale.labels[g]+"</div></div>"}e=this.config.buttons_right;for(var f=0;f<e.length;f++){var g=this.config._migrate_buttons[e[f]]?this.config._migrate_buttons[e[f]]:e[f];d+="<div class='gantt_btn_set gantt_right_btn_set "+g+"_set' style='float:right;'><div dhx_button='1' class='"+g+"'></div><div>"+this.locale.labels[g]+"</div></div>"}d+="</div>",b.innerHTML=d,gantt.config.drag_lightbox&&(b.firstChild.onmousedown=gantt._ready_to_dnd,b.firstChild.onselectstart=function(){return!1},b.firstChild.style.cursor="pointer",gantt._init_dnd_events()),document.body.insertBefore(b,document.body.firstChild),this._lightbox=b;var h=this._get_typed_lightbox_config(a);d=this._render_sections(h);for(var i=b.getElementsByTagName("div"),f=0;f<i.length;f++){var j=i[f];if("gantt_cal_larea"==j.className){j.innerHTML=d;break}}this.resizeLightbox(),this._init_lightbox_events(this),b.style.display="none",b.style.visibility="visible"}return this._lightbox},gantt._render_sections=function(a){for(var b="",c=0;c<a.length;c++){var d=this.form_blocks[a[c].type];if(d){a[c].id="area_"+dhtmlx.uid();var e=a[c].hidden?" style='display:none'":"",f="";a[c].button&&(f="<div class='gantt_custom_button' index='"+c+"'><div class='gantt_custom_button_"+a[c].button+"'></div><div>"+this.locale.labels["button_"+a[c].button]+"</div></div>"),this.config.wide_form&&(b+="<div class='gantt_wrap_section' "+e+">"),b+="<div id='"+a[c].id+"' class='gantt_cal_lsection'>"+f+this.locale.labels["section_"+a[c].name]+"</div>"+d.render.call(this,a[c]),b+="</div>"}}return b},gantt.resizeLightbox=function(){var a=this._lightbox;if(a){var b=a.childNodes[1];b.style.height="0px",b.style.height=b.scrollHeight+"px",a.style.height=b.scrollHeight+this.config.lightbox_additional_height+"px",b.style.height=b.scrollHeight+"px"}},gantt._center_lightbox=function(a){if(a){a.style.display="block";var b=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,c=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,d=window.innerHeight||document.documentElement.clientHeight;b?a.style.top=Math.round(b+Math.max((d-a.offsetHeight)/2,0))+"px":a.style.top=Math.round(Math.max((d-a.offsetHeight)/2,0)+9)+"px",document.documentElement.scrollWidth>document.body.offsetWidth?a.style.left=Math.round(c+(document.body.offsetWidth-a.offsetWidth)/2)+"px":a.style.left=Math.round((document.body.offsetWidth-a.offsetWidth)/2)+"px"}},gantt.showCover=function(){if(!this._cover){this._cover=document.createElement("DIV"),this._cover.className="gantt_cal_cover";var a=void 0!==document.height?document.height:document.body.offsetHeight,b=document.documentElement?document.documentElement.scrollHeight:0;this._cover.style.height=Math.max(a,b)+"px",document.body.appendChild(this._cover)}},gantt._init_lightbox_events=function(){gantt.lightbox_events={},gantt.lightbox_events.gantt_save_btn=function(a){gantt._save_lightbox()},gantt.lightbox_events.gantt_delete_btn=function(a){gantt.callEvent("onLightboxDelete",[gantt._lightbox_id])&&(gantt.isTaskExists(gantt._lightbox_id)?gantt.$click.buttons["delete"](gantt._lightbox_id):gantt.hideLightbox())},gantt.lightbox_events.gantt_cancel_btn=function(a){gantt._cancel_lightbox()},gantt.lightbox_events["default"]=function(a,b){if(b.getAttribute("dhx_button"))gantt.callEvent("onLightboxButton",[b.className,b,a]);else{var c,d,e,f=gantt._getClassName(b);-1!=f.indexOf("gantt_custom_button")&&(-1!=f.indexOf("gantt_custom_button_")?(c=b.parentNode.getAttribute("index"),e=b.parentNode.parentNode):(c=b.getAttribute("index"),e=b.parentNode,b=b.firstChild));var g=gantt._get_typed_lightbox_config();c&&(d=gantt.form_blocks[g[c].type],d.button_click(c,b,e,e.nextSibling))}},dhtmlxEvent(gantt.getLightbox(),"click",function(a){a=a||window.event;var b=a.target?a.target:a.srcElement,c=gantt._getClassName(b);if(c||(b=b.previousSibling,c=gantt._getClassName(b)),b&&c&&0===c.indexOf("gantt_btn_set")&&(b=b.firstChild,c=gantt._getClassName(b)),b&&c){var d=dhtmlx.defined(gantt.lightbox_events[b.className])?gantt.lightbox_events[b.className]:gantt.lightbox_events["default"];return d(a,b)}return!1}),gantt.getLightbox().onkeydown=function(a){switch((a||event).keyCode){case gantt.keys.edit_save:if((a||event).shiftKey)return;gantt._save_lightbox();break;case gantt.keys.edit_cancel:gantt._cancel_lightbox()}}},gantt._cancel_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxCancel",[this._lightbox_id,a.$new]),gantt.isTaskExists(a.id)&&a.$new&&this._deleteTask(a.id,!0),this.refreshData(),this.hideLightbox()},gantt._save_lightbox=function(){var a=this.getLightboxValues();this.callEvent("onLightboxSave",[this._lightbox_id,a,!!a.$new])&&(a.$new?(delete a.$new,this.addTask(a)):this.isTaskExists(a.id)&&(dhtmlx.mixin(this.getTask(a.id),a,!0),this.updateTask(a.id)),this.refreshData(),this.hideLightbox())},gantt._resolve_default_mapping=function(a){var b=a.map_to,c={time:!0,time_optional:!0,duration:!0,duration_optional:!0};return c[a.type]&&("auto"==a.map_to?b={start_date:"start_date",end_date:"end_date",duration:"duration"}:"string"==typeof a.map_to&&(b={start_date:a.map_to})),b},gantt.getLightboxValues=function(){var a={};gantt.isTaskExists(this._lightbox_id)&&(a=dhtmlx.mixin({},this.getTask(this._lightbox_id)));for(var b=this._get_typed_lightbox_config(),c=0;c<b.length;c++){var d=document.getElementById(b[c].id);d=d?d.nextSibling:d;var e=this.form_blocks[b[c].type];if(e){var f=e.get_value.call(this,d,a,b[c]),g=gantt._resolve_default_mapping(b[c]);if("string"==typeof g&&"auto"!=g)a[g]=f;else if("object"==typeof g)for(var h in g)g[h]&&(a[g[h]]=f[h])}}return a},gantt.hideLightbox=function(){var a=this.getLightbox();a&&(a.style.display="none"),this._lightbox_id=null,this.hideCover(),this.callEvent("onAfterLightbox",[])},gantt.hideCover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},gantt.resetLightbox=function(){gantt._lightbox&&!gantt._custom_lightbox&&gantt._lightbox.parentNode.removeChild(gantt._lightbox),gantt._lightbox=null},gantt._set_lightbox_values=function(a,b){var c=a,d=b.getElementsByTagName("span");gantt.templates.lightbox_header?(d[1].innerHTML="",d[2].innerHTML=gantt.templates.lightbox_header(c.start_date,c.end_date,c)):(d[1].innerHTML=this.templates.task_time(c.start_date,c.end_date,c),d[2].innerHTML=(this.templates.task_text(c.start_date,c.end_date,c)||"").substr(0,70));for(var e=this._get_typed_lightbox_config(this.getLightboxType()),f=0;f<e.length;f++){var g=e[f];if(this.form_blocks[g.type]){var h=document.getElementById(g.id).nextSibling,i=this.form_blocks[g.type],j=gantt._resolve_default_mapping(e[f]),k=dhtmlx.defined(c[j])?c[j]:g.default_value;i.set_value.call(gantt,h,k,c,g),g.focus&&i.focus.call(gantt,h)}}a.id&&(gantt._lightbox_id=a.id)},gantt._fill_lightbox=function(a,b){var c=this.getTask(a);this._set_lightbox_values(c,b)},gantt.getLightboxSection=function(a){var b=this._get_typed_lightbox_config(),c=0;for(c;c<b.length&&b[c].name!=a;c++);var d=b[c];if(!d)return null;this._lightbox||this.getLightbox();var e=document.getElementById(d.id),f=e.nextSibling,g={section:d,header:e,node:f,getValue:function(a){return gantt.form_blocks[d.type].get_value.call(gantt,f,a||{},d)},setValue:function(a,b){return gantt.form_blocks[d.type].set_value.call(gantt,f,a,b||{},d)}},h=this._lightbox_methods["get_"+d.type+"_control"];return h?h(g):g},gantt._lightbox_methods.get_template_control=function(a){return a.control=a.node,a},gantt._lightbox_methods.get_select_control=function(a){return a.control=a.node.getElementsByTagName("select")[0],a},gantt._lightbox_methods.get_textarea_control=function(a){return a.control=a.node.getElementsByTagName("textarea")[0],a},gantt._lightbox_methods.get_time_control=function(a){return a.control=a.node.getElementsByTagName("select"),a},gantt._init_dnd_events=function(){dhtmlxEvent(document.body,"mousemove",gantt._move_while_dnd),dhtmlxEvent(document.body,"mouseup",gantt._finish_dnd),gantt._init_dnd_events=function(){}},gantt._move_while_dnd=function(a){if(gantt._dnd_start_lb){document.gantt_unselectable||(document.body.className+=" gantt_unselectable",document.gantt_unselectable=!0);var b=gantt.getLightbox(),c=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY];b.style.top=gantt._lb_start[1]+c[1]-gantt._dnd_start_lb[1]+"px",b.style.left=gantt._lb_start[0]+c[0]-gantt._dnd_start_lb[0]+"px"}},gantt._ready_to_dnd=function(a){var b=gantt.getLightbox();gantt._lb_start=[parseInt(b.style.left,10),parseInt(b.style.top,10)],gantt._dnd_start_lb=a&&a.target?[a.pageX,a.pageY]:[event.clientX,event.clientY]},gantt._finish_dnd=function(){gantt._lb_start&&(gantt._lb_start=gantt._dnd_start_lb=!1,document.body.className=document.body.className.replace(" gantt_unselectable",""),document.gantt_unselectable=!1)},gantt._focus=function(a,b){if(a&&a.focus)if(gantt.config.touch);else try{b&&a.select&&a.select(),a.focus()}catch(c){}},gantt.form_blocks={getTimePicker:function(a,b){var c=a.time_format;if(!c){var c=["%d","%m","%Y"];gantt._get_line(gantt._tasks.unit)<gantt._get_line("day")&&c.push("%H:%i")}a._time_format_order={size:0};var d=this.config,e=this.date.date_part(new Date(gantt._min_date.valueOf())),f=1440,g=0;gantt.config.limit_time_select&&(f=60*d.last_hour+1,g=60*d.first_hour,e.setHours(d.first_hour));for(var h="",i=0;i<c.length;i++){var j=c[i];i>0&&(h+=" ");var k="";switch(j){case"%Y":a._time_format_order[2]=i,a._time_format_order.size++;var l,m,n,o;a.year_range&&(isNaN(a.year_range)?a.year_range.push&&(n=a.year_range[0],o=a.year_range[1]):l=a.year_range),l=l||10,m=m||Math.floor(l/2),n=n||e.getFullYear()-m,o=o||n+l;for(var p=n;o>p;p++)k+="<option value='"+p+"'>"+p+"</option>";break;case"%m":a._time_format_order[1]=i,a._time_format_order.size++;for(var p=0;12>p;p++)k+="<option value='"+p+"'>"+this.locale.date.month_full[p]+"</option>";break;case"%d":a._time_format_order[0]=i,a._time_format_order.size++;for(var p=1;32>p;p++)k+="<option value='"+p+"'>"+p+"</option>";break;case"%H:%i":a._time_format_order[3]=i,a._time_format_order.size++;var p=g,q=e.getDate();for(a._time_values=[];f>p;){var r=this.templates.time_picker(e);k+="<option value='"+p+"'>"+r+"</option>",a._time_values.push(p),e.setTime(e.valueOf()+60*this._get_timepicker_step()*1e3);var s=e.getDate()!=q?1:0;p=24*s*60+60*e.getHours()+e.getMinutes()}}if(k){var t=a.readonly?"disabled='disabled'":"",u=b?" style='display:none'":"";h+="<select "+t+u+">"+k+"</select>"}}return h},_fill_lightbox_select:function(a,b,c,d,e){if(a[b+d[0]].value=c.getDate(),a[b+d[1]].value=c.getMonth(),a[b+d[2]].value=c.getFullYear(),dhtmlx.defined(d[3])){var f=60*c.getHours()+c.getMinutes();f=Math.round(f/gantt._get_timepicker_step())*gantt._get_timepicker_step();var g=a[b+d[3]];g.value=f,g.setAttribute("data-value",f)}},template:{render:function(a){var b=(a.height||"30")+"px";return"<div class='gantt_cal_ltext gantt_cal_template' style='height:"+b+";'></div>"},set_value:function(a,b,c,d){a.innerHTML=b||""},get_value:function(a,b,c){return a.innerHTML||""},focus:function(a){}},textarea:{render:function(a){var b=(a.height||"130")+"px";return"<div class='gantt_cal_ltext' style='height:"+b+";'><textarea></textarea></div>"},set_value:function(a,b,c){a.firstChild.value=b||""},get_value:function(a,b){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},select:{render:function(a){for(var b=(a.height||"23")+"px",c="<div class='gantt_cal_ltext' style='height:"+b+";'><select style='width:100%;'>",d=0;d<a.options.length;d++)c+="<option value='"+a.options[d].key+"'>"+a.options[d].label+"</option>";return c+="</select></div>"},set_value:function(a,b,c,d){var e=a.firstChild;!e._dhx_onchange&&d.onchange&&(e.onchange=d.onchange,e._dhx_onchange=!0),"undefined"==typeof b&&(b=(e.options[0]||{}).value),e.value=b||""},get_value:function(a,b){return a.firstChild.value},focus:function(a){var b=a.firstChild;gantt._focus(b,!0)}},time:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a),c=["<div style='height:"+(a.height||30)+"px;padding-top:0px;font-size:inherit;text-align:center;' class='gantt_section_time'>"];return c.push(b),a.single_date?(b=this.form_blocks.getTimePicker.call(this,a,!0),c.push("<span></span>")):c.push("<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"),c.push(b),c.push("</div>"),c.join("")},set_value:function(a,b,c,d){var e=d,f=a.getElementsByTagName("select"),g=d._time_format_order;d._time_format_size;if(e.auto_end_date)for(var h=function(){k=new Date(f[g[2]].value,f[g[1]].value,f[g[0]].value,0,0),l=gantt.calculateEndDate(k,1),this.form_blocks._fill_lightbox_select(f,g.size,l,g,e)},i=0;4>i;i++)f[i].onchange=h;var j=gantt._resolve_default_mapping(d);"string"==typeof j&&(j={start_date:j});var k=c[j.start_date]||new Date,l=c[j.end_date]||gantt.calculateEndDate(k,1);this.form_blocks._fill_lightbox_select(f,0,k,g,e),this.form_blocks._fill_lightbox_select(f,g.size,l,g,e)},get_value:function(a,b,c){var d=a.getElementsByTagName("select"),e=c._time_format_order,f=0,g=0;if(dhtmlx.defined(e[3])){var h=parseInt(d[e[3]].value,10);f=Math.floor(h/60),g=h%60}var i=new Date(d[e[2]].value,d[e[1]].value,d[e[0]].value,f,g);if(f=g=0,dhtmlx.defined(e[3])){var h=parseInt(d[e.size+e[3]].value,10);f=Math.floor(h/60),g=h%60}var j=new Date(d[e[2]+e.size].value,d[e[1]+e.size].value,d[e[0]+e.size].value,f,g);i>=j&&(j=gantt.date.add(i,gantt._get_timepicker_step(),"minute"));var k=gantt._resolve_default_mapping(c),l={start_date:new Date(i),end_date:new Date(j)};return"string"==typeof k?l.start_date:l},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},duration:{render:function(a){var b=this.form_blocks.getTimePicker.call(this,a);b="<div class='gantt_time_selects'>"+b+"</div>";var c=this.locale.labels[this.config.duration_unit+"s"],d=a.single_date?' style="display:none"':"",e=a.readonly?" disabled='disabled'":"",f="<div class='gantt_duration' "+d+"><input type='button' class='gantt_duration_dec' value='-'"+e+"><input type='text' value='5' class='gantt_duration_value'"+e+"><input type='button' class='gantt_duration_inc' value='+'"+e+"> "+c+" <span></span></div>",g="<div style='height:"+(a.height||30)+"px;padding-top:0px;font-size:inherit;' class='gantt_section_time'>"+b+" "+f+"</div>";return g},set_value:function(a,b,c,d){function e(){var b=gantt.form_blocks.duration._get_start_date.call(gantt,a,d),c=gantt.form_blocks.duration._get_duration.call(gantt,a,d),e=gantt.calculateEndDate(b,c);l.innerHTML=gantt.templates.task_date(e)}function f(a){var b=j.value;b=parseInt(b,10),window.isNaN(b)&&(b=0),b+=a,1>b&&(b=1),j.value=b,e()}var g=d,h=a.getElementsByTagName("select"),i=a.getElementsByTagName("input"),j=i[1],k=[i[0],i[2]],l=a.getElementsByTagName("span")[0],m=d._time_format_order;k[0].onclick=dhtmlx.bind(function(){f(-1*this.config.duration_step)},this),k[1].onclick=dhtmlx.bind(function(){f(1*this.config.duration_step)},this),h[0].onchange=e,h[1].onchange=e,h[2].onchange=e,h[3]&&(h[3].onchange=e),j.onkeydown=dhtmlx.bind(function(a){a=a||window.event;var b=a.charCode||a.keyCode||a.which;return 40==b?(f(-1*this.config.duration_step),!1):38==b?(f(1*this.config.duration_step),!1):void window.setTimeout(function(a){e()},1)},this),j.onchange=dhtmlx.bind(function(a){e()},this);var n=gantt._resolve_default_mapping(d);"string"==typeof n&&(n={start_date:n});var o=c[n.start_date]||new Date,p=c[n.end_date]||gantt.calculateEndDate(o,1),q=Math.round(c[n.duration])||gantt.calculateDuration(o,p);gantt.form_blocks._fill_lightbox_select(h,0,o,m,g),j.value=q,e()},_get_start_date:function(a,b){var c=a.getElementsByTagName("select"),d=b._time_format_order,e=0,f=0;if(dhtmlx.defined(d[3])){var g=c[d[3]],h=parseInt(g.value,10);isNaN(h)&&g.hasAttribute("data-value")&&(h=parseInt(g.getAttribute("data-value"),10)),e=Math.floor(h/60),f=h%60}return new Date(c[d[2]].value,c[d[1]].value,c[d[0]].value,e,f)},_get_duration:function(a,b){var c=a.getElementsByTagName("input")[1];return c=parseInt(c.value,10),(!c||window.isNaN(c))&&(c=1),0>c&&(c*=-1),c},get_value:function(a,b,c){var d=gantt.form_blocks.duration._get_start_date(a,c),e=gantt.form_blocks.duration._get_duration(a,c),f=gantt.calculateEndDate(d,e),g=gantt._resolve_default_mapping(c),h={start_date:new Date(d),end_date:new Date(f),duration:e};return"string"==typeof g?h.start_date:h},focus:function(a){gantt._focus(a.getElementsByTagName("select")[0])}},parent:{_filter:function(a,b,c){var d=b.filter||function(){return!0};a=a.slice(0);for(var e=0;e<a.length;e++){var f=a[e];(f.id==c||gantt.isChildOf(f.id,c)||d(f.id,f)===!1)&&(a.splice(e,1),e--)}return a},_display:function(a,b){var c=[],d=[];b&&(c=gantt.getTaskByTime(),a.allow_root&&c.unshift({id:gantt.config.root_id,text:a.root_label||""}),c=this._filter(c,a,b),a.sort&&c.sort(a.sort));for(var e=a.template||gantt.templates.task_text,f=0;f<c.length;f++){var g=e.apply(gantt,[c[f].start_date,c[f].end_date,c[f]]);void 0===g&&(g=""),d.push({key:c[f].id,label:g})}return a.options=d,a.map_to=a.map_to||"parent",gantt.form_blocks.select.render.apply(this,arguments)},render:function(a){return gantt.form_blocks.parent._display(a,!1)},set_value:function(a,b,c,d){var e=document.createElement("div");e.innerHTML=gantt.form_blocks.parent._display(d,c.id);var f=e.removeChild(e.firstChild);return a.onselect=null,a.parentNode.replaceChild(f,a),gantt.form_blocks.select.set_value.apply(gantt,[f,b,c,d])},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(gantt,arguments)}}},gantt._is_lightbox_timepicker=function(){for(var a=this._get_typed_lightbox_config(),b=0;b<a.length;b++)if("time"==a[b].name&&"time"==a[b].type)return!0;return!1},gantt._dhtmlx_confirm=function(a,b,c,d){if(!a)return c();var e={text:a};b&&(e.title=b),d&&(e.ok=d),c&&(e.callback=function(a){a&&c()}),dhtmlx.confirm(e)},gantt._get_typed_lightbox_config=function(a){void 0===a&&(a=this.getLightboxType());var b=this._get_type_name(a);return gantt.config.lightbox[b+"_sections"]?gantt.config.lightbox[b+"_sections"]:gantt.config.lightbox.sections},gantt._silent_redraw_lightbox=function(a){var b=this.getLightboxType();if(this.getState().lightbox){var c=this.getState().lightbox,d=this.getLightboxValues(),e=dhtmlx.copy(this.getTask(c));this.resetLightbox();var f=dhtmlx.mixin(e,d,!0),g=this.getLightbox(a?a:void 0);this._center_lightbox(this.getLightbox()),this._set_lightbox_values(f,g)}else this.resetLightbox(),this.getLightbox(a?a:void 0);this.callEvent("onLightboxChange",[b,this.getLightboxType()])},gantt._extend_to_optional=function(a){var b=a,c={render:b.render,focus:b.focus,set_value:function(a,d,e,f){var g=gantt._resolve_default_mapping(f);if(!e[g.start_date]||"start_date"==g.start_date&&this._isAllowedUnscheduledTask(e)){c.disable(a,f);var h={};for(var i in g)h[g[i]]=e[i];return b.set_value.call(gantt,a,d,h,f)}return c.enable(a,f),b.set_value.call(gantt,a,d,e,f)},get_value:function(a,c,d){return d.disabled?{start_date:null}:b.get_value.call(gantt,a,c,d)},update_block:function(a,b){if(gantt.callEvent("onSectionToggle",[gantt._lightbox_id,b]),a.style.display=b.disabled?"none":"block",b.button){var c=a.previousSibling.firstChild.firstChild,d=gantt.locale.labels,e=b.disabled?d[b.name+"_enable_button"]:d[b.name+"_disable_button"];c.nextSibling.innerHTML=e}gantt.resizeLightbox()},disable:function(a,b){b.disabled=!0,c.update_block(a,b)},enable:function(a,b){b.disabled=!1,c.update_block(a,b)},button_click:function(a,b,d,e){if(gantt.callEvent("onSectionButton",[gantt._lightbox_id,d])!==!1){var f=gantt._get_typed_lightbox_config()[a];f.disabled?c.enable(e,f):c.disable(e,f)}}};return c},gantt.form_blocks.duration_optional=gantt._extend_to_optional(gantt.form_blocks.duration),gantt.form_blocks.time_optional=gantt._extend_to_optional(gantt.form_blocks.time),gantt._init_dp_live_update_hooks=function(a){a.attachEvent("insertCallback",gantt._insert_callback),a.attachEvent("updateCallback",gantt._update_callback),a.attachEvent("deleteCallback",gantt._delete_callback)},gantt._update_callback=function(a,b){var c=a.data||gantt.xml._xmlNodeToJSON(a.firstChild);if(gantt.isTaskExists(b)){var d=gantt.getTask(b);for(var e in c){var f=c[e];switch(e){case"id":continue;case"start_date":case"end_date":f=gantt.templates.xml_date(f);break;case"duration":d.end_date=gantt.calculateEndDate(d.start_date,f)}d[e]=f}gantt.updateTask(b),gantt.refreshData()}},gantt._insert_callback=function(a,b,c,d){var e=a.data||gantt.xml._xmlNodeToJSON(a.firstChild),f={add:gantt.addTask,isExist:gantt.isTaskExists};"links"==d&&(f.add=gantt.addLink,f.isExist=gantt.isLinkExists),f.isExist.call(gantt,b)||(e.id=b,f.add.call(gantt,e))},gantt._delete_callback=function(a,b,c,d){var e={"delete":gantt.deleteTask,isExist:gantt.isTaskExists};"links"==d&&(e["delete"]=gantt.deleteLink,e.isExist=gantt.isLinkExists),e.isExist.call(gantt,b)&&e["delete"].call(gantt,b)},gantt._get_safe_type=function(a){for(var b in this.config.types)if(this.config.types[b]==a)return a;return gantt.config.types.task},gantt.form_blocks.typeselect={render:function(a){var b=gantt.config.types,c=gantt.locale.labels,d=[],e=a.filter||function(){return!0};for(var f in b)!e(f,b[f])==!1&&d.push({key:b[f],label:c["type_"+f]});a.options=d;var g=a.onchange;return a.onchange=function(){gantt.getState().lightbox;gantt.changeLightboxType(this.value),"function"==typeof g&&g.apply(this,arguments)},gantt.form_blocks.select.render.apply(gantt,arguments)},set_value:function(){return gantt.form_blocks.select.set_value.apply(gantt,arguments)},get_value:function(){return gantt.form_blocks.select.get_value.apply(gantt,arguments)},focus:function(){return gantt.form_blocks.select.focus.apply(this,arguments)}},function(){function a(){return gantt._cached_functions.update_if_changed(gantt),gantt._cached_functions.active||gantt._cached_functions.activate(),!0}gantt._cached_functions={cache:{},mode:!1,critical_path_mode:!1,wrap_methods:function(a,b){if(b._prefetch_originals)for(var c in b._prefetch_originals)b[c]=b._prefetch_originals[c];b._prefetch_originals={};for(var c=0;c<a.length;c++)this.prefetch(a[c],b)},prefetch:function(a,b){var c=b[a];if(c){var d=this;b._prefetch_originals[a]=c,b[a]=function(){if(d.active){var b=d.get_arguments_hash(Array.prototype.slice.call(arguments));d.cache[a]||(d.cache[a]={});var e=d.cache[a];if(d.has_cached_value(e,b))return d.get_cached_value(e,b);var f=c.apply(this,arguments);return d.cache_value(e,b,f),f}return c.apply(this,arguments)}}return c},cache_value:function(a,b,c){this.is_date(c)&&(c=new Date(c)),a[b]=c},has_cached_value:function(a,b){return a.hasOwnProperty(b)},get_cached_value:function(a,b){var c=a[b];return this.is_date(c)&&(c=new Date(c)),c},is_date:function(a){
return a&&a.getUTCDate},get_arguments_hash:function(a){for(var b=[],c=0;c<a.length;c++)b.push(this.stringify_argument(a[c]));return"("+b.join(";")+")"},stringify_argument:function(a){var b="";return b=a.id?a.id:this.is_date(a)?a.valueOf():a,b+""},activate:function(){this.clear(),this.active=!0},deactivate:function(){this.clear(),this.active=!1},clear:function(){this.cache={}},setup:function(a){var b=[],c=["isCriticalTask","isCriticalLink","_isProjectEnd","_getProjectEnd"];"auto"==this.mode?a.config.highlight_critical_path&&(b=c):this.mode===!0&&(b=c),this.wrap_methods(b,a)},update_if_changed:function(a){var b=this.critical_path_mode!=a.config.highlight_critical_path||this.mode!==a.config.optimize_render;b&&(this.critical_path_mode=a.config.highlight_critical_path,this.mode=a.config.optimize_render,this.setup(a))}},gantt.attachEvent("onBeforeGanttRender",a),gantt.attachEvent("onBeforeDataRender",a),gantt.attachEvent("onBeforeParse",a),gantt.attachEvent("onDataRender",function(){gantt._cached_functions.deactivate()}),gantt.attachEvent("onBeforeGanttReady",function(){return gantt._cached_functions.update_if_changed(gantt),!0})}(),dhtmlx.assert=function(a,b){a||gantt.config.show_errors&&gantt.callEvent("onError",[b])!==!1&&dhtmlx.message({type:"error",text:b,expire:-1})},gantt.init=function(a,b,c){this.callEvent("onBeforeGanttReady",[]),b&&c&&(this.config.start_date=this._min_date=new Date(b),this.config.end_date=this._max_date=new Date(c)),this._init_skin(),this.date.init(),this.config.scroll_size||(this.config.scroll_size=this._detectScrollSize()),dhtmlxEvent(window,"resize",this._on_resize),this.init=function(a){this.$container&&this.$container.parentNode&&(this.$container.parentNode.removeChild(this.$container),this.$container=null),this._reinit(a)},this._reinit(a)},gantt._reinit=function(a){this._init_html_area(a),this._set_sizes(),this._clear_renderers(),this.resetLightbox(),this._update_flags(),this._init_touch_events(),this._init_templates(),this._init_grid(),this._init_tasks(),this._set_scroll_events(),dhtmlxEvent(this.$container,"click",this._on_click),dhtmlxEvent(this.$container,"dblclick",this._on_dblclick),dhtmlxEvent(this.$container,"mousemove",this._on_mousemove),dhtmlxEvent(this.$container,"contextmenu",this._on_contextmenu),this.callEvent("onGanttReady",[]),this.render()},gantt._init_html_area=function(a){"string"==typeof a?this._obj=document.getElementById(a):this._obj=a,window.gantt!==gantt&&(this._obj.gantt=gantt),dhtmlx.assert(this._obj,"Invalid html container: "+a);var b="<div class='gantt_container'><div class='gantt_grid'></div><div class='gantt_task'></div>";b+="<div class='gantt_ver_scroll'><div></div></div><div class='gantt_hor_scroll'><div></div></div></div>",this._obj.innerHTML=b,this.$container=this._obj.firstChild;var c=this.$container.childNodes;this.$grid=c[0],this.$task=c[1],this.$scroll_ver=c[2],this.$scroll_hor=c[3],this.$grid.innerHTML="<div class='gantt_grid_scale'></div><div class='gantt_grid_data'></div>",this.$grid_scale=this.$grid.childNodes[0],this.$grid_data=this.$grid.childNodes[1],this.$task.innerHTML="<div class='gantt_task_scale'></div><div class='gantt_data_area'><div class='gantt_task_bg'></div><div class='gantt_links_area'></div><div class='gantt_bars_area'></div></div>",this.$task_scale=this.$task.childNodes[0],this.$task_data=this.$task.childNodes[1],this.$task_bg=this.$task_data.childNodes[0],this.$task_links=this.$task_data.childNodes[1],this.$task_bars=this.$task_data.childNodes[2]},gantt.$click={buttons:{edit:function(a){gantt.showLightbox(a)},"delete":function(a){var b=gantt.locale.labels.confirm_deleting,c=gantt.locale.labels.confirm_deleting_title;gantt._dhtmlx_confirm(b,c,function(){var b=gantt.getTask(a);b.$new?(gantt._deleteTask(a,!0),gantt.refreshData()):gantt.deleteTask(a),gantt.hideLightbox()})}}},gantt._calculate_content_height=function(){var a=this.config.scale_height,b=this._order.length*this.config.row_height,c=this._scroll_hor?this.config.scroll_size+1:0;return this._is_grid_visible()||this._is_chart_visible()?a+b+2+c:0},gantt._calculate_content_width=function(){var a=this._get_grid_width(),b=this._tasks?this._tasks.full_width:0;this._scroll_ver?this.config.scroll_size+1:0;return this._is_chart_visible()||(b=0),this._is_grid_visible()||(a=0),a+b+1},gantt._get_resize_options=function(){var a={x:!1,y:!1};return"xy"==this.config.autosize?a.x=a.y=!0:"y"==this.config.autosize||this.config.autosize===!0?a.y=!0:"x"==this.config.autosize&&(a.x=!0),a},gantt._clean_el_size=function(a){return 1*(a||"").toString().replace("px","")||0},gantt._get_box_styles=function(){var a=null;a=window.getComputedStyle?window.getComputedStyle(this._obj,null):{width:this._obj.clientWidth,height:this._obj.clientHeight};var b=["width","height","paddingTop","paddingBottom","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],c={boxSizing:"border-box"==a.boxSizing};a.MozBoxSizing&&(c.boxSizing="border-box"==a.MozBoxSizing);for(var d=0;d<b.length;d++)c[b[d]]=a[b[d]]?this._clean_el_size(a[b[d]]):0;var e={horPaddings:c.paddingLeft+c.paddingRight+c.borderLeftWidth+c.borderRightWidth,vertPaddings:c.paddingTop+c.paddingBottom+c.borderTopWidth+c.borderBottomWidth,borderBox:c.boxSizing,innerWidth:c.width,innerHeight:c.height,outerWidth:c.width,outerHeight:c.height};return e.borderBox?(e.innerWidth-=e.horPaddings,e.innerHeight-=e.vertPaddings):(e.outerWidth+=e.horPaddings,e.outerHeight+=e.vertPaddings),e},gantt._do_autosize=function(){var a=this._get_resize_options(),b=this._get_box_styles();if(a.y){var c=this._calculate_content_height();b.borderBox&&(c+=b.vertPaddings),this._obj.style.height=c+"px"}if(a.x){var d=this._calculate_content_width();b.borderBox&&(d+=b.horPaddings),this._obj.style.width=d+"px"}},gantt._set_sizes=function(){this._do_autosize();var a=this._get_box_styles();if(this._y=a.innerHeight,!(this._y<20)){this.$grid.style.height=this.$task.style.height=Math.max(this._y-this.$scroll_hor.offsetHeight-2,0)+"px";var b=Math.max(this._y-(this.config.scale_height||0)-this.$scroll_hor.offsetHeight-2,0);this.$grid_data.style.height=this.$task_data.style.height=b+"px";var c=Math.max(this._get_grid_width()-1,0);this.$grid.style.width=c+"px",this.$grid.style.display=0===c?"none":"",a=this._get_box_styles(),this._x=a.innerWidth,this._x<20||(this.$grid_data.style.width=Math.max(this._get_grid_width()-1,0)+"px",this.$task.style.width=Math.max(this._x-this._get_grid_width()-2,0)+"px")}},gantt.getScrollState=function(){return this.$task&&this.$task_data?{x:this.$task.scrollLeft,y:this.$task_data.scrollTop}:null},gantt._save_scroll_state=function(a,b){var c={};this._cached_scroll_pos=this._cached_scroll_pos||{},void 0!==a&&(c.x=Math.max(a,0)),void 0!==b&&(c.y=Math.max(b,0)),dhtmlx.mixin(this._cached_scroll_pos,c,!0)},gantt._restore_scroll_state=function(){return this._cached_scroll_pos||null},gantt.scrollTo=function(a,b){1*a==a&&(this.$task.scrollLeft=a,this._save_scroll_state(a,void 0)),1*b==b&&(this.$task_data.scrollTop=b,this.$grid_data.scrollTop=b,this._save_scroll_state(void 0,b));var c=gantt._restore_scroll_state()||{x:0,y:0};this.callEvent("onGanttScroll",[c.x,c.y])},gantt.showDate=function(a){var b=this.posFromDate(a),c=Math.max(b-this.config.task_scroll_offset,0);this.scrollTo(c)},gantt.showTask=function(a){var b=this.getTaskNode(a);if(b){var c=Math.max(b.offsetLeft-this.config.task_scroll_offset,0),d=b.offsetTop-(this.$task_data.offsetHeight-this.config.row_height)/2;this.scrollTo(c,d)}},gantt._on_resize=gantt.setSizes=function(){gantt._set_sizes(),gantt._scroll_resize()},gantt.render=function(){if(this._is_render_active()){this.callEvent("onBeforeGanttRender",[]);var a=dhtmlx.copy(this._restore_scroll_state()),b=null;if(a&&(b=gantt.dateFromPos(a.x+this.config.task_scroll_offset)),this._render_grid(),this._render_tasks_scales(),this._scroll_resize(),this._on_resize(),this._render_data(),this.config.preserve_scroll&&a){var c=gantt._restore_scroll_state(),d=gantt.dateFromPos(c.x);(+b!=+d||c.y!=a.y)&&(b&&this.showDate(b),gantt.scrollTo(void 0,a.y))}this.callEvent("onGanttRender",[])}},gantt._set_scroll_events=function(){function a(a){var c=gantt._get_resize_options();gantt._wheel_time=new Date;var d=b?-20*a.deltaX:2*a.wheelDeltaX,e=b?-40*a.deltaY:a.wheelDelta;if(d&&Math.abs(d)>Math.abs(e)){if(c.x)return!0;var f=d/-40,g=gantt.$task.scrollLeft+30*f;gantt.scrollTo(g,null),gantt.$scroll_hor.scrollTop=h}else{if(c.y)return!0;var f=e/-40;"undefined"==typeof e&&(f=a.detail);var h=gantt.$scroll_ver.scrollTop+30*f;if(!gantt.config.prevent_default_scroll&&gantt._cached_scroll_pos&&gantt._cached_scroll_pos.y==h)return!0;gantt.scrollTo(null,h),gantt.$scroll_ver.scrollTop=h}return a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(new Date-(gantt._wheel_time||0)<100)return!0;if(!gantt._touch_scroll_active){var a=gantt.$scroll_hor.scrollLeft;gantt.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!gantt._touch_scroll_active){var a=gantt.$scroll_ver.scrollTop;gantt.$grid_data.scrollTop=a,gantt.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=gantt.$task.scrollLeft,b=gantt.$scroll_hor.scrollLeft;b!=a&&(gantt.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=gantt.$task_data.scrollTop,b=gantt.$scroll_ver.scrollTop;b!=a&&(gantt.$scroll_ver.scrollTop=a)});var b=_isFF&&!window._KHTMLrv;b?dhtmlxEvent(gantt.$container,"wheel",a):dhtmlxEvent(gantt.$container,"mousewheel",a)},gantt._scroll_resize=function(){if(!(this._x<20||this._y<20)){var a=this._get_grid_width(),b=Math.max(this._x-a,0),c=Math.max(this._y-this.config.scale_height,0),d=this.config.scroll_size+1,e=Math.max(this.$task_data.offsetWidth-d,0),f=this.config.row_height*this._order.length,g=this._get_resize_options(),h=this._scroll_hor=g.x?!1:e>b,i=this._scroll_ver=g.y?!1:f>c,h=h?"block":"none";this.$scroll_hor.style&&this.$scroll_hor.style&&this.$scroll_hor.firstChild&&this.$scroll_ver.firstChild&&(this.$scroll_hor.style.display=h?"block":"none",this.$scroll_hor.style.height=(h?8:0)+"px",this.$scroll_hor.style.width=Math.max(this._x-(i?d:2),0)+"px",this.$scroll_hor.firstChild.style.width=e+a+d+2+"px",this.$scroll_ver.style.display=i?"block":"none",this.$scroll_ver.style.width=(i?8:0)+"px",this.$scroll_ver.style.height=Math.max(this._y-(h?d:0)-this.config.scale_height,0)+"px",this.$scroll_ver.style.top=this.config.scale_height+"px",this.$scroll_ver.firstChild.style.height=this.config.scale_height+f+"px")}},gantt._getClassName=function(a){if(!a)return"";var b=a.className||"";return b.baseVal&&(b=b.baseVal),b.indexOf||(b=""),gantt._trim(b)},gantt.locate=function(a){var b=gantt._get_target_node(a),c=gantt._getClassName(b);if((c||"").indexOf("gantt_task_cell")>=0)return null;for(var d=arguments[1]||this.config.task_attribute;b;){if(b.getAttribute){var e=b.getAttribute(d);if(e)return e}b=b.parentNode}return null},gantt._get_target_node=function(a){var b;return a.tagName?b=a:(a=a||window.event,b=a.target||a.srcElement),b},gantt._trim=function(a){var b=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")};return b.apply(a)},gantt._locate_css=function(a,b,c){void 0===c&&(c=!0);for(var d=gantt._get_target_node(a),e="";d;){if(e=gantt._getClassName(d)){var f=e.indexOf(b);if(f>=0){if(!c)return d;var g=0===f||!gantt._trim(e.charAt(f-1)),h=f+b.length>=e.length||!gantt._trim(e.charAt(f+b.length));if(g&&h)return d}}d=d.parentNode}return null},gantt._locateHTML=function(a,b){var c=gantt._get_target_node(a);for(b=b||this.config.task_attribute;c;){if(c.getAttribute){var d=c.getAttribute(b);if(d)return c}c=c.parentNode}return null},gantt.getTaskRowNode=function(a){for(var b=this.$grid_data.childNodes,c=this.config.task_attribute,d=0;d<b.length;d++)if(b[d].getAttribute){var e=b[d].getAttribute(c);if(e==a)return b[d]}return null},gantt.getState=function(){return{drag_id:this._tasks_dnd.drag.id,drag_mode:this._tasks_dnd.drag.mode,drag_from_start:this._tasks_dnd.drag.left,selected_task:this._selected_task,min_date:new Date(this._min_date),max_date:new Date(this._max_date),lightbox:this._lightbox_id,touch_drag:this._touch_drag}},gantt._checkTimeout=function(a,b){if(!b)return!0;var c=1e3/b;return 1>c?!0:a._on_timeout?!1:(setTimeout(function(){delete a._on_timeout},c),a._on_timeout=!0,!0)},gantt.selectTask=function(a){if(!this.config.select_task)return!1;if(a){if(this._selected_task==a)return this._selected_task;if(!this.callEvent("onBeforeTaskSelected",[a]))return!1;this.unselectTask(),this._selected_task=a,this.refreshTask(a),this.callEvent("onTaskSelected",[a])}return this._selected_task},gantt.unselectTask=function(a){var a=a||this._selected_task;a&&(this._selected_task=null,this.refreshTask(a),this.callEvent("onTaskUnselected",[a]))},gantt.getSelectedId=function(){return dhtmlx.defined(this._selected_task)?this._selected_task:null},gantt.changeLightboxType=function(a){return this.getLightboxType()==a?!0:void gantt._silent_redraw_lightbox(a)},gantt._is_render_active=function(){return!this._skip_render},gantt._correct_dst_change=function(a,b,c,d){var e=gantt._get_line(d)*c;if(e>3600&&86400>e){var f=a.getTimezoneOffset()-b;f&&(a=gantt.date.add(a,f,"minute"))}return a},gantt.batchUpdate=function(a){var b,c=this._dp&&"off"!=this._dp.updateMode;c&&(b=this._dp.updateMode,this._dp.setUpdateMode("off")),this._skip_render=!0;try{a()}catch(d){}this._skip_render=!1,this.render(),c&&(this._dp.setUpdateMode(b),this._dp.sendData())},gantt.date={init:function(){for(var a=gantt.locale.date.month_short,b=gantt.locale.date.month_short_hash={},c=0;c<a.length;c++)b[a[c]]=c;for(var a=gantt.locale.date.month_full,b=gantt.locale.date.month_full_hash={},c=0;c<a.length;c++)b[a[c]]=c},date_part:function(a){var b=new Date(a);return a.setHours(0),this.hour_start(a),a.getHours()&&(a.getDate()<b.getDate()||a.getMonth()<b.getMonth()||a.getFullYear()<b.getFullYear())&&a.setTime(a.getTime()+36e5*(24-a.getHours())),a},time_part:function(a){return(a.valueOf()/1e3-60*a.getTimezoneOffset())%86400},week_start:function(a){var b=a.getDay();return gantt.config.start_on_monday&&(0===b?b=6:b--),this.date_part(this.add(a,-1*b,"day"))},month_start:function(a){return a.setDate(1),this.date_part(a)},year_start:function(a){return a.setMonth(0),this.month_start(a)},day_start:function(a){return this.date_part(a)},hour_start:function(a){return a.getMinutes()&&a.setMinutes(0),this.minute_start(a),a},minute_start:function(a){return a.getSeconds()&&a.setSeconds(0),a.getMilliseconds()&&a.setMilliseconds(0),a},_add_days:function(a,b){var c=new Date(a.valueOf());return c.setDate(c.getDate()+b),b>=0&&!a.getHours()&&c.getHours()&&(c.getDate()<=a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c},add:function(a,b,c){var d=new Date(a.valueOf());switch(c){case"day":d=gantt.date._add_days(d,b);break;case"week":d=gantt.date._add_days(d,7*b);break;case"month":d.setMonth(d.getMonth()+b);break;case"year":d.setYear(d.getFullYear()+b);break;case"hour":d.setTime(d.getTime()+60*b*60*1e3);break;case"minute":d.setTime(d.getTime()+60*b*1e3);break;default:return gantt.date["add_"+c](a,b,c)}return d},to_fixed:function(a){return 10>a?"0"+a:a},copy:function(a){return new Date(a.valueOf())},date_to_str:function(a,b){return a=a.replace(/%[a-zA-Z]/g,function(a){switch(a){case"%d":return'"+gantt.date.to_fixed(date.getDate())+"';case"%m":return'"+gantt.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+gantt.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+gantt.locale.date.day_short[date.getDay()]+"';case"%l":return'"+gantt.locale.date.day_full[date.getDay()]+"';case"%M":return'"+gantt.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+gantt.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+gantt.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+gantt.date.to_fixed(date.getHours())+"';case"%i":return'"+gantt.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+gantt.date.to_fixed(date.getSeconds())+"';case"%W":return'"+gantt.date.to_fixed(gantt.date.getISOWeek(date))+"';default:return a}}),b&&(a=a.replace(/date\.get/g,"date.getUTC")),new Function("date",'return "'+a+'";')},str_to_date:function(a,b){for(var c="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",d=a.match(/%[a-zA-Z]/g),e=0;e<d.length;e++)switch(d[e]){case"%j":case"%d":c+="set[2]=temp["+e+"]||1;";break;case"%n":case"%m":c+="set[1]=(temp["+e+"]||1)-1;";break;case"%y":c+="set[0]=temp["+e+"]*1+(temp["+e+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":c+="set[3]=temp["+e+"]||0;";break;case"%i":c+="set[4]=temp["+e+"]||0;";break;case"%Y":c+="set[0]=temp["+e+"]||0;";break;case"%a":case"%A":c+="set[3]=set[3]%12+((temp["+e+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":c+="set[5]=temp["+e+"]||0;";break;case"%M":c+="set[1]=gantt.locale.date.month_short_hash[temp["+e+"]]||0;";break;case"%F":c+="set[1]=gantt.locale.date.month_full_hash[temp["+e+"]]||0;"}var f="set[0],set[1],set[2],set[3],set[4],set[5]";return b&&(f=" Date.UTC("+f+")"),new Function("date","var set=[0,0,1,0,0,0]; "+c+" return new Date("+f+");")},getISOWeek:function(a){if(!a)return!1;var b=a.getDay();0===b&&(b=7);var c=new Date(a.valueOf());c.setDate(a.getDate()+(4-b));var d=c.getFullYear(),e=Math.round((c.getTime()-new Date(d,0,1).getTime())/864e5),f=1+Math.floor(e/7);return f},getUTCISOWeek:function(a){return this.getISOWeek(a)},convert_to_utc:function(a){return new Date(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())},parseDate:function(a,b){return"string"==typeof a&&(dhtmlx.defined(b)&&(b="string"==typeof b?dhtmlx.defined(gantt.templates[b])?gantt.templates[b]:gantt.date.str_to_date(b):gantt.templates.xml_date),a=a?b(a):null),a}},gantt.date.quarter_start=function(a){gantt.date.month_start(a);var b,c=a.getMonth();return b=c>=9?9:c>=6?6:c>=3?3:0,a.setMonth(b),a},gantt.date.add_quarter=function(a,b){return gantt.date.add(a,3*b,"month")},gantt.config||(gantt.config={}),gantt.config||(gantt.config={}),gantt.templates||(gantt.templates={}),function(){dhtmlx.mixin(gantt.config,{links:{finish_to_start:"0",start_to_start:"1",finish_to_finish:"2",start_to_finish:"3"},types:{task:"task",project:"project",milestone:"milestone"},duration_unit:"day",work_time:!1,correct_work_time:!1,skip_off_time:!1,autosize:!1,autosize_min_width:0,show_links:!0,show_task_cells:!0,static_background:!1,branch_loading:!1,show_loading:!1,show_chart:!0,show_grid:!0,min_duration:36e5,xml_date:"%d-%m-%Y %H:%i",api_date:"%d-%m-%Y %H:%i",start_on_monday:!0,server_utc:!1,show_progress:!0,fit_tasks:!1,select_task:!0,scroll_on_click:!0,preserve_scroll:!0,readonly:!1,date_grid:"%Y-%m-%d",drag_links:!0,drag_progress:!0,drag_resize:!0,drag_move:!0,drag_mode:{resize:"resize",progress:"progress",move:"move",ignore:"ignore"},round_dnd_dates:!0,link_wrapper_width:20,root_id:0,autofit:!1,columns:[{name:"text",tree:!0,width:"*",resize:!0},{name:"start_date",align:"center",resize:!0},{name:"duration",align:"center"},{name:"add",width:"44"}],step:1,scale_unit:"day",scale_offset_minimal:!0,subscales:[],inherit_scale_class:!1,time_step:60,duration_step:1,date_scale:"%d %M",task_date:"%d %F %Y",time_picker:"%H:%i",task_attribute:"task_id",link_attribute:"link_id",layer_attribute:"data-layer",buttons_left:["gantt_save_btn","gantt_cancel_btn"],_migrate_buttons:{dhx_save_btn:"gantt_save_btn",dhx_cancel_btn:"gantt_cancel_btn",dhx_delete_btn:"gantt_delete_btn"},buttons_right:["gantt_delete_btn"],lightbox:{sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"time",type:"duration",map_to:"auto"}],project_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",readonly:!0,map_to:"auto"}],milestone_sections:[{name:"description",height:70,map_to:"text",type:"textarea",focus:!0},{name:"type",type:"typeselect",map_to:"type"},{name:"time",type:"duration",single_date:!0,map_to:"auto"}]},drag_lightbox:!0,sort:!1,details_on_create:!0,details_on_dblclick:!0,initial_scroll:!0,task_scroll_offset:100,order_branch:!1,order_branch_free:!1,task_height:"full",min_column_width:70,min_grid_column_width:70,grid_resizer_column_attribute:"column_index",grid_resizer_attribute:"grid_resizer",keep_grid_width:!1,grid_resize:!1,show_unscheduled:!0,readonly_property:"readonly",editable_property:"editable",type_renderers:{},open_tree_initially:!1,optimize_render:"auto",prevent_default_scroll:!1,show_errors:!0}),gantt.keys={edit_save:13,edit_cancel:27},gantt._init_template=function(a,b,c){var d=this._reg_templates||{};c=c||a,this.config[a]&&d[c]!=this.config[a]&&(b&&this.templates[c]||(this.templates[c]=this.date.date_to_str(this.config[a]),d[c]=this.config[a])),this._reg_templates=d},gantt._init_templates=function(){var a=gantt.locale.labels;a.gantt_save_btn=a.icon_save,a.gantt_cancel_btn=a.icon_cancel,a.gantt_delete_btn=a.icon_delete;var b=this.date.date_to_str,c=this.config;gantt._init_template("date_scale",!0),gantt._init_template("date_grid",!0,"grid_date_format"),gantt._init_template("task_date",!0),dhtmlx.mixin(this.templates,{xml_date:this.date.str_to_date(c.xml_date,c.server_utc),xml_format:b(c.xml_date,c.server_utc),api_date:this.date.str_to_date(c.api_date),progress_text:function(a,b,c){return""},grid_header_class:function(a,b){return""},task_text:function(a,b,c){return c.text},task_class:function(a,b,c){return""},grid_row_class:function(a,b,c){return""},task_row_class:function(a,b,c){return""},task_cell_class:function(a,b){return""},scale_cell_class:function(a){return""},scale_row_class:function(a){return""},grid_indent:function(a){return"<div class='gantt_tree_indent'></div>"},grid_folder:function(a){return"<div class='gantt_tree_icon gantt_folder_"+(a.$open?"open":"closed")+"'></div>"},grid_file:function(a){return"<div class='gantt_tree_icon gantt_file'></div>"},grid_open:function(a){return"<div class='gantt_tree_icon gantt_"+(a.$open?"close":"open")+"'></div>"},grid_blank:function(a){return"<div class='gantt_tree_icon gantt_blank'></div>"},date_grid:function(a,b){return b&&gantt.isUnscheduledTask(b)&&gantt.config.show_unscheduled?gantt.templates.task_unscheduled_time(b):gantt.templates.grid_date_format(a)},task_time:function(a,b,c){return gantt.isUnscheduledTask(c)&&gantt.config.show_unscheduled?gantt.templates.task_unscheduled_time(c):gantt.templates.task_date(a)+" - "+gantt.templates.task_date(b)},task_unscheduled_time:function(a){return""},time_picker:b(c.time_picker),link_class:function(a){return""},link_description:function(a){var b=gantt.getTask(a.source),c=gantt.getTask(a.target);return"<b>"+b.text+"</b> &ndash;  <b>"+c.text+"</b>"},drag_link:function(a,b,c,d){a=gantt.getTask(a);var e=gantt.locale.labels,f="<b>"+a.text+"</b> "+(b?e.link_start:e.link_end)+"<br/>";return c&&(c=gantt.getTask(c),f+="<b> "+c.text+"</b> "+(d?e.link_start:e.link_end)+"<br/>"),f},drag_link_class:function(a,b,c,d){var e="";if(a&&c){var f=gantt.isLinkAllowed(a,c,b,d);e=" "+(f?"gantt_link_allow":"gantt_link_deny")}return"gantt_link_tooltip"+e}}),this.callEvent("onTemplatesReady",[])}}(),window.jQuery&&!function(a){var b=[];a.fn.dhx_gantt=function(c){if(c=c||{},"string"!=typeof c){var d=[];return this.each(function(){if(this&&this.getAttribute)if(this.gantt)d.push("object"==typeof this.gantt?this.gantt:window.gantt);else{var a=window.gantt.$container?Gantt.getGanttInstance():window.gantt;for(var b in c)"data"!=b&&(a.config[b]=c[b]);a.init(this),c.data&&a.parse(c.data),d.push(a)}}),1===d.length?d[0]:d}return b[c]?b[c].apply(this,[]):void a.error("Method "+c+" does not exist on jQuery.dhx_gantt")}}(jQuery),window.dhtmlx&&(dhtmlx.attaches||(dhtmlx.attaches={}),dhtmlx.attaches.attachGantt=function(a,b){var c=document.createElement("DIV");c.id="gantt_"+dhtmlx.uid(),c.style.width="100%",c.style.height="100%",c.cmp="grid",document.body.appendChild(c),this.attachObject(c.id);var d=this.vs[this.av];d.grid=gantt,gantt.init(c.id,a,b),c.firstChild.style.border="none",d.gridId=c.id,d.gridObj=c;var e="_viewRestore";return this.vs[this[e]()].grid}),gantt.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{new_task:"New task",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Task will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},gantt.skins.skyblue={config:{grid_width:350,row_height:27,scale_height:27,link_line_width:1,link_arrow_size:8,lightbox_additional_height:75},_second_column_width:95,_third_column_width:80},gantt.skins.meadow={config:{grid_width:350,row_height:27,scale_height:30,link_line_width:2,link_arrow_size:6,lightbox_additional_height:72},_second_column_width:95,_third_column_width:80},gantt.skins.terrace={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:2,link_arrow_size:6,lightbox_additional_height:75},_second_column_width:90,_third_column_width:70},gantt.skins.broadway={config:{grid_width:360,row_height:35,scale_height:35,link_line_width:1,link_arrow_size:7,lightbox_additional_height:86},_second_column_width:90,_third_column_width:80,_lightbox_template:"<div class='gantt_cal_ltitle'><span class='gantt_mark'>&nbsp;</span><span class='gantt_time'></span><span class='gantt_title'></span><div class='gantt_cancel_btn'></div></div><div class='gantt_cal_larea'></div>",_config_buttons_left:{},_config_buttons_right:{gantt_delete_btn:"icon_delete",gantt_save_btn:"icon_save"}},gantt.config.touch_drag=500,gantt.config.touch=!0,gantt.config.touch_feedback=!0,gantt._touch_feedback=function(){gantt.config.touch_feedback&&navigator.vibrate&&navigator.vibrate(1)},gantt._init_touch_events=function(){"force"!=this.config.touch&&(this.config.touch=this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))),this.config.touch&&(window.navigator.msPointerEnabled?this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(a){return a.pointerType==a.MSPOINTER_TYPE_MOUSE?null:a},function(a){return!a||a.pointerType==a.MSPOINTER_TYPE_MOUSE}):this._touch_events(["touchmove","touchstart","touchend"],function(a){return a.touches&&a.touches.length>1?null:a.touches[0]?{target:a.target,pageX:a.touches[0].pageX,pageY:a.touches[0].pageY,clientX:a.touches[0].clientX,clientY:a.touches[0].clientY}:a},function(){return!1}))},gantt._touch_events=function(a,b,c){function d(a){return a&&a.preventDefault&&a.preventDefault(),(a||event).cancelBubble=!0,!1}function e(a){var b=gantt._task_area_pulls,c=gantt.getTask(a);if(c&&gantt.isTaskVisible(a))for(var d in b)if(c=b[d][a],c&&c.getAttribute("task_id")&&c.getAttribute("task_id")==a){var e=c.cloneNode(!0);return l=c,b[d][a]=e,c.style.display="none",e.className+=" gantt_drag_move ",c.parentNode.appendChild(e),e}}var f,g=0,h=!1,i=!1,j=null,k=null,l=null;this._gantt_touch_event_ready||(this._gantt_touch_event_ready=1,dhtmlxEvent(gantt.$container,a[0],function(a){if(!c(a)&&h){k&&clearTimeout(k);var e=b(a);if(gantt._tasks_dnd.drag.id||gantt._tasks_dnd.drag.start_drag)return gantt._tasks_dnd.on_mouse_move(e),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,!1;if(e&&j){var l=j.pageX-e.pageX,m=j.pageY-e.pageY;if(!i&&(Math.abs(l)>5||Math.abs(m)>5)&&(gantt._touch_scroll_active=i=!0,g=0,f=gantt.getScrollState()),i){gantt.scrollTo(f.x+l,f.y+m);var n=gantt.getScrollState();if(f.x!=n.x&&m>2*l||f.y!=n.y&&l>2*m)return d(a)}}return d(a)}})),dhtmlxEvent(this.$container,"contextmenu",function(a){return h?d(a):void 0}),dhtmlxEvent(this.$container,a[1],function(a){if(!c(a)){if(a.touches&&a.touches.length>1)return void(h=!1);if(h=!0,j=b(a),j&&g){var f=new Date;500>f-g?(gantt._on_dblclick(j),d(a)):g=f}else g=new Date;k=setTimeout(function(){var a=gantt.locate(j);!a||gantt._locate_css(j,"gantt_link_control")||gantt._locate_css(j,"gantt_grid_data")||(gantt._tasks_dnd.on_mouse_down(j),gantt._tasks_dnd.drag&&gantt._tasks_dnd.drag.start_drag&&(e(a),gantt._tasks_dnd._start_dnd(j),gantt._touch_drag=!0,gantt.refreshTask(a),gantt._touch_feedback())),k=null},gantt.config.touch_drag)}}),dhtmlxEvent(this.$container,a[2],function(a){if(!c(a)){k&&clearTimeout(k),gantt._touch_drag=!1,h=!1;var d=b(a);gantt._tasks_dnd.on_mouse_up(d),l&&(gantt.refreshTask(gantt.locate(l)),l.parentNode&&(l.parentNode.removeChild(l),gantt._touch_feedback())),gantt._touch_scroll_active=h=i=!1,l=null}})};for(var i=0;i<Gantt._ganttPlugin.length;i++)Gantt._ganttPlugin[i](gantt);return gantt._internal_id=Gantt._seed++,Gantt.$syncFactory&&Gantt.$syncFactory(gantt),gantt},window.gantt=Gantt.getGanttInstance(),dhtmlx&&(dhtmlx.attaches=dhtmlx.attaches||[],dhtmlx.attaches.attachGantt=function(a,b,c){var d=document.createElement("DIV");return d.id="dhxSchedObj_"+this._genStr(12),d.style.cssText="width:100%; height:100%;",document.body.appendChild(d),this.attachObject(d.id,!1,!0),c=c||(window.gantt.$container?Gantt.getGanttInstance():window.gantt),this.vs[this.av].sched=c,this.vs[this.av].schedId=d.id,c.destructor=function(){},c.init(d.id,a,b),this.vs[this._viewRestore()].sched}),define("gantt",function(a){return function(){var b;return b||a.gantt}}(this)),Gantt.plugin(function(a){a._markers||(a._markers={}),a.config.show_markers=!0,a.attachEvent("onClear",function(){a._markers={}}),a.attachEvent("onGanttReady",function(){function b(b){if(!a.config.show_markers)return!1;if(!b.start_date)return!1;var c=a.getState();if(!(+b.start_date>+c.max_date||+b.end_date&&+b.end_date<+c.min_date||+b.start_date<+c.min_date)){var d=document.createElement("div");d.setAttribute("marker_id",b.id);var e="gantt_marker";a.templates.marker_class&&(e+=" "+a.templates.marker_class(b)),b.css&&(e+=" "+b.css),b.title&&(d.title=b.title),d.className=e;var f=a.posFromDate(b.start_date);if(d.style.left=f+"px",d.style.height=Math.max(a._y_from_ind(a._order.length),0)+"px",b.end_date){var g=a.posFromDate(b.end_date);d.style.width=Math.max(g-f,0)+"px"}return b.text&&(d.innerHTML="<div class='gantt_marker_content' >"+b.text+"</div>"),d}}var c=document.createElement("div");c.className="gantt_marker_area",a.$task_data.appendChild(c),a.$marker_area=c,a._markerRenderer=a._task_renderer("markers",b,a.$marker_area,null)}),a.attachEvent("onDataRender",function(){a.renderMarkers()}),a.getMarker=function(a){return this._markers?this._markers[a]:null},a.addMarker=function(a){return a.id=a.id||dhtmlx.uid(),this._markers[a.id]=a,a.id},a.deleteMarker=function(a){return this._markers&&this._markers[a]?(delete this._markers[a],!0):!1},a.updateMarker=function(a){this._markerRenderer&&this._markerRenderer.render_item(a)},a.renderMarkers=function(){if(!this._markers)return!1;if(!this._markerRenderer)return!1;var a=[];for(var b in this._markers)a.push(this._markers[b]);return this._markerRenderer.render_items(a),!0}}),define("ganttMarker",["gantt"],function(){}),
Gantt.plugin(function(a){a._tooltip={},a._tooltip_class="gantt_tooltip",a.config.tooltip_timeout=30,a.config.tooltip_offset_y=20,a.config.tooltip_offset_x=10,a._create_tooltip=function(){return this._tooltip_html||(this._tooltip_html=document.createElement("div"),this._tooltip_html.className=a._tooltip_class),this._tooltip_html},a._is_cursor_under_tooltip=function(a,b){return a.x>=b.pos.x&&a.x<=b.pos.x+b.width?!0:a.y>=b.pos.y&&a.y<=b.pos.y+b.height?!0:!1},a._show_tooltip=function(b,c){if(!a.config.touch||a.config.touch_tooltip){var d=this._create_tooltip();d.innerHTML=b,a.$task_data.appendChild(d);var e=d.offsetWidth+20,f=d.offsetHeight+40,g=this.$task.offsetHeight,h=this.$task.offsetWidth,i=this.getScrollState();c.y+=i.y;var j={x:c.x,y:c.y};c.x+=1*a.config.tooltip_offset_x||0,c.y+=1*a.config.tooltip_offset_y||0,c.y=Math.min(Math.max(i.y,c.y),i.y+g-f),c.x=Math.min(Math.max(i.x,c.x),i.x+h-e),a._is_cursor_under_tooltip(j,{pos:c,width:e,height:f})&&(j.x+e>h+i.x&&(c.x=j.x-(e-20)-(1*a.config.tooltip_offset_x||0)),j.y+f>g+i.y&&(c.y=j.y-(f-40)-(1*a.config.tooltip_offset_y||0))),d.style.left=c.x+"px",d.style.top=c.y+"px"}},a._hide_tooltip=function(){this._tooltip_html&&this._tooltip_html.parentNode&&this._tooltip_html.parentNode.removeChild(this._tooltip_html),this._tooltip_id=0},a._is_tooltip=function(b){var c=b.target||b.srcElement;return a._is_node_child(c,function(a){return a.className==this._tooltip_class})},a._is_task_line=function(b){var c=b.target||b.srcElement;return a._is_node_child(c,function(a){return a==this.$task_data})},a._is_node_child=function(b,c){for(var d=!1;b&&!d;)d=c.call(a,b),b=b.parentNode;return d},a._tooltip_pos=function(b){if(b.pageX||b.pageY)var c={x:b.pageX,y:b.pageY};var d=_isIE?document.documentElement:document.body,c={x:b.clientX+d.scrollLeft-d.clientLeft,y:b.clientY+d.scrollTop-d.clientTop},e=a._get_position(a.$task_data);return c.x=c.x-e.x,c.y=c.y-e.y,c},a.attachEvent("onMouseMove",function(b,c){if(this.config.tooltip_timeout){document.createEventObject&&!document.createEvent&&(c=document.createEventObject(c));var d=this.config.tooltip_timeout;this._tooltip_id&&!b&&(isNaN(this.config.tooltip_hide_timeout)||(d=this.config.tooltip_hide_timeout)),clearTimeout(a._tooltip_ev_timer),a._tooltip_ev_timer=setTimeout(function(){a._init_tooltip(b,c)},d)}else a._init_tooltip(b,c)}),a._init_tooltip=function(a,b){if(!this._is_tooltip(b)&&(a!=this._tooltip_id||this._is_task_line(b))){if(!a)return this._hide_tooltip();this._tooltip_id=a;var c=this.getTask(a),d=this.templates.tooltip_text(c.start_date,c.end_date,c);return d?void this._show_tooltip(d,this._tooltip_pos(b)):void this._hide_tooltip()}},a.attachEvent("onMouseLeave",function(b){a._is_tooltip(b)||this._hide_tooltip()}),a.templates.tooltip_date_format=a.date.date_to_str("%Y-%m-%d"),a.templates.tooltip_text=function(b,c,d){return"<b>Task:</b> "+d.text+"<br/><b>Start date:</b> "+a.templates.tooltip_date_format(b)+"<br/><b>End date:</b> "+a.templates.tooltip_date_format(c)}}),define("ganttTips",["gantt"],function(){}),gantt.config.day_date="%M %d日 %D",gantt.config.default_date="%Y年 %M %d日",gantt.config.month_date="%Y年 %M",gantt.locale={date:{month_full:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],month_short:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],day_full:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],day_short:["日","一","二","三","四","五","六"]},labels:{dhx_cal_today_button:"今天",day_tab:"日",week_tab:"周",month_tab:"月",new_event:"新建日程",icon_save:"保存",icon_cancel:"关闭",icon_details:"详细",icon_edit:"编辑",icon_delete:"删除",confirm_closing:"请确认是否撤销修改!",confirm_deleting:"是否删除日程?",section_description:"描述",section_time:"时间范围",section_type:"Type",column_text:"Task name",column_start_date:"Start time",column_duration:"Duration",column_add:"",link:"Link",confirm_link_deleting:"will be deleted",link_start:" (start)",link_end:" (end)",type_task:"Task",type_project:"Project",type_milestone:"Milestone",minutes:"Minutes",hours:"Hours",days:"Days",weeks:"Week",months:"Months",years:"Years"}},define("ganttCN",["gantt"],function(){}),define("views/common/gantt/gantt-layout-view",["talent","templates/common","views/common/new-filter/search-filter-view","views/common/gantt/gantt-legend-view","moment","gantt","ganttMarker","ganttTips","ganttCN"],function(a,b,c,d,e,f){return a.ItemView.extend({template:b["common/gantt/gantt-layout"],legendTemplate:b["common/gantt/gantt-legend"],regions:{chart:".gantt-body"},className:"gantt",defaults:{width:1200,height:600,getSubUrl:"",data:{startDate:"",endDate:""},isShowFullScreen:!0,isShowFilter:!0},templateHelpers:function(){return{ganttFullUrl:this.settings.ganttFullUrl,isShowFullScreen:this.settings.isShowFullScreen}},initialize:function(b){var c=this;this.isCategory=b.isCategory?!0:!1,this.storage=a.Context.getLocalStorage(),this.userInfo=a.Context.getUserInfo(),this.localStorageKey="Gantt_Filter_"+this.userInfo.Id,this.storage.removeItem(this.localStorageKey),this.nowDate=e().toDate(),c.model.set("isHideSort",b.isHideSort?!0:!1),this.settings=a._.extend({},this.defaults,b);var d=c.$(".gantt-main"),f=d.width();if(c.settings.data.Data){var g=c.settings.data.Data.tasks;c.model.set("work",!1),g.isWork=!1}else{var g=c.settings.data.tasks;c.model.set("work",!0),g.isWork=!0}var h=0;if(h=620,h=g.length>20?560:25*g.length+60,this.model.set({width:f,height:this.settings.height||h}),g[0])if("score"in g[0]){var i=!0;c.model.set("score",!0)}else{var i=!1;c.model.set("score",!1)}else{var i=!1;c.model.set("score",!1)}this.setGanttConfig(g.isWork,i),this.setGanttTmeplates(),this.overRiderGanttMethod(),this.addGanttMarker(),this.addGanttEvent(),this._setScaleConfig("1")},getBackupColumn:function(){var a={name:"startDate",label:"日期",template:function(a){var b=e(a.backStartDate).format("YYYY-MM-DD"),c=e(a.backEndDate).format("YYYY-MM-DD");return"milestone1"==a.type&&"未设置里程碑"==a.name||a.title?"":b+" - "+c},align:"center",width:160,resize:!0};return a},getBackSorce:function(){var a={name:"score",label:"评分",resize:!0,width:"40",align:"center",template:function(a){return 2==a.status&&!a.score||a.title?"":a.score?a.score:"-"}};return a},getBackComplate:function(){var a={name:"finishProgress",label:"完成度",resize:!0,width:"50",align:"center"};return a},initGantt:function(a,b){this.$el.find(this.ui.ganttBody)[0];f.init("grid-configuration")},setGanttConfig:function(a,b){var c=this;f.config.grid_width=450,f.config.readonly=!0,f.config.row_height=25,f.config.grid_resize=!0;var d=this.isCategory?"类别":"项目/任务名称";d=this.settings.isTarget?"目标/任务名称":d,f.config.columns=[{name:"name",resize:!0,label:d,tree:!0,template:function(a){var b=a.name,d="";return"project"==a.type?d=c.settings.isTarget?"目标:":"项目:":"milestone1"==a.type&&"未设置里程碑"!=b&&(d="里程碑:"),d+b}},{name:"principalUser",width:"65",resize:!0,label:"负责人",align:"center",template:function(a){return a.principalUser?a.principalUser:""}}];var e=c.getBackComplate(),g=c.getBackSorce(),h=c.getBackupColumn();a&&f.config.columns.push(e),b&&f.config.columns.push(g),f.config.columns.push(h)},setGanttTmeplates:function(){var a=this;f.templates.grid_file=function(a){return""},f.templates.grid_folder=function(a){return""},f.templates.progress_text=function(a,b,c){return""},f.templates.grid_header_class=function(a,b){return"gridTitle gridFont"},f.templates.scale_cell_class=function(a,b){return"gridTitle"},f.templates.scale_row_class=function(a){return"gridTitle"},f.templates.task_text=function(a,b,c){var d=c.finishDate,f=c.endTime,g=c.status,h=c.type;return"project"==h||"milestone1"==h||"title"==h?"":"2"==g?e(d).format()==e(f).format()?"按期完成":e(d)<e(f)?"提前完成":"延期完成":"4"==g?"已取消":"6"==g?"已暂停":"0"==g?"未开始":"3"==g?"延迟":"1"==g?"进行中":void 0},f.templates.progress_class=function(a){var b=a.type,c=a.status,d=a.finishDate,f=a.endTime,g=a.startDate,h=a.progress;return"project"==b||"title"==b?"hideTest":"milestone1"==b?"未设置里程碑"==a.name?"hideTest":"heightSmall":"2"==c?e(d).format()==e(f).format()?"testGreen progressGreen":e(d)<e(f)?"gantt_task_progress testGreen":"testGreen":"4"==c?"darkgray":"6"==c?"pause":"0"==c?"gantt_task_progress_blue":"3"==c?e(g)>e(d)?"setdelay":e(d)<e(g)?"setdelay":1==h?"gantt_task_progress_blue":"setdelay":"1"==c?"gantt_task_progress_blue":void 0},f.templates.task_class=function(b,c,d){var f=d.type,g=d.status,h=d.finishDate,i=d.endTime,j=d.startDate;d.progress;return"project"==f||"title"==f?"hideTest":"milestone1"==f?"未设置里程碑"==d.name?"hideTest":"heightSmall":"2"==g?e(h).format()==e(i).format()?"testGreen progressGreen":e(h)<e(j)?"testGreen":e(h)<e(i)?"testGreen cancle":"testRed":"4"==g?e(h)<e(i)?"cancle":"testRed":"6"==g?e(h)>e(i)?"testRed":e(h)<e(j)?"pause":"cancle":"0"==g?e(i)<a.nowDate?"testRed":"gantt_task_progress_blue":"3"==g?e(h)<e(i)?"setdelay":e(j)>e(h)?"setdelay":"testRed":"1"==g?e(i)<a.nowDate?"testRed":"gantt_task_progress_blue":void 0},f.templates.tooltip_text=function(a,b,c){var a=c.startDate,b=c.endDate;return("milestone1"==c.type||"project"==c.type)&&(a=c.backStartDate,b=c.backEndDate),"title"==c.type?"<div class='gantt-tip'><b>名称:</b> "+c.name:"<div class='gantt-tip'><b>名称:</b> "+c.name+"<br/><b>开始时间:</b> "+a+"<br/><b>结束时间:</b> "+b+"</div>"},f.attachEvent("onMouseMove",function(a,b){})},overRiderGanttMethod:function(){f._render_grid_item=function(a){if(!f._is_grid_visible())return null;for(var b=this.getGridColumns(),c=[],d=0;d<b.length;d++){var e,g,h=d==b.length-1,i=b[d];"add"==i.name?g="<div class='gantt_add'></div>":(g=i.template?i.template(a):a[i.name],g instanceof Date&&(g=this.templates.date_grid(g,a)),g="<div class='gantt_tree_content gantt_tree_content_"+a.type+"' >"+g+"</div>");var j="gantt_cell"+(h?" gantt_last_cell":""),k="";if(i.tree){for(var l=0;l<a.$level;l++)k+=this.templates.grid_indent(a);var m=this._has_children(a.id);m?(k+=this.templates.grid_open(a),k+=this.templates.grid_folder(a)):(k+=this.templates.grid_blank(a),k+=this.templates.grid_file(a))}var n="width:"+(i.width-(h?1:0))+"px;";dhtmlx.defined(i.align)&&(n+="text-align:"+i.align+";"),e="<div class='"+j+"' style='"+n+"'>"+k+g+"</div>",c.push(e)}var j=a.$index%2===0?"":" odd";if(j+=a.$transparent?" gantt_transparent":"",j+=a.$dataprocessor_class?" "+a.$dataprocessor_class:"",this.templates.grid_row_class){var o=this.templates.grid_row_class.call(this,a.start_date,a.end_date,a);o&&(j+=" "+o)}var p="";a.title&&(p+=" newGantt_title"),this.getState().selected_task==a.id&&(j+=" gantt_selected");var q=document.createElement("div");return q.className="gantt_row"+j+p,q.style.height=this.config.row_height+"px",q.style.lineHeight=f.config.row_height+"px",q.setAttribute(this.config.task_attribute,a.id),q.innerHTML=c.join(""),q},f._set_scroll_events=function(){function a(a){var c=f._get_resize_options();f._wheel_time=new Date;var d=b?-20*a.deltaX:2*a.wheelDeltaX,e=b?-40*a.deltaY:a.wheelDelta;if(d&&Math.abs(d)>Math.abs(e)){if(c.x)return!0;var g=d/-40,h=f.$task.scrollLeft+30*g;f.scrollTo(h,null),f.$scroll_hor.scrollTop=i}else{if(c.y)return!0;var g=e/-40;"undefined"==typeof e&&(g=a.detail);var i=f.$scroll_ver.scrollTop+30*g;if(!f.config.prevent_default_scroll&&f._cached_scroll_pos&&f._cached_scroll_pos.y==i)return!0;f.scrollTo(null,i),f.$scroll_ver.scrollTop=i}return!1}dhtmlxEvent(this.$scroll_hor,"scroll",function(){if(new Date-(f._wheel_time||0)<100)return!0;if(!f._touch_scroll_active){var a=f.$scroll_hor.scrollLeft;f.scrollTo(a)}}),dhtmlxEvent(this.$scroll_ver,"scroll",function(){if(!f._touch_scroll_active){var a=f.$scroll_ver.scrollTop;f.$grid_data.scrollTop=a,f.scrollTo(null,a)}}),dhtmlxEvent(this.$task,"scroll",function(){var a=f.$task.scrollLeft,b=f.$scroll_hor.scrollLeft;b!=a&&(f.$scroll_hor.scrollLeft=a)}),dhtmlxEvent(this.$task_data,"scroll",function(){var a=f.$task_data.scrollTop,b=f.$scroll_ver.scrollTop;b!=a&&(f.$scroll_ver.scrollTop=a)});var b=_isFF&&!window._KHTMLrv;b?dhtmlxEvent(f.$container,"wheel",a):dhtmlxEvent(f.$container,"mousewheel",a)},f._get_task_pos=function(a,b){b=b!==!1;var c=f._get_milestone_width()/2,d=this._get_task_coord(a,b,c);return"milestone1"==a.type&&(d.y=d.y+11),d},f._has_children=function(a){return this.getChildren(a).length>0||f.getTask(a).isHasChild},f._update_layout_sizes=function(){var a=this._tasks;a.bar_height=this._get_task_height(),this.$task_data.style.height=Math.max(this.$task.offsetHeight-this.config.scale_height,0)+"px",this.$task_bg.style.height="",this.$task_bg.style.backgroundImage="";for(var b=this.$task_data.childNodes,c=0,d=b.length;d>c;c++){var e=b[c];this._is_layer(e)&&e.style&&(e.style.width=a.full_width+"px")}if(this._is_grid_visible())for(var f=this.getGridColumns(),g=0,c=0;c<f.length;c++)g+=f[c].width},f.date._add_days=function(a,b){var c=new Date(a.valueOf());return c.setMilliseconds(c.getMilliseconds()+24*b*60*60*1e3),b>=0&&!a.getHours()&&c.getHours()&&(c.getDate()<=a.getDate()||c.getMonth()<a.getMonth()||c.getFullYear()<a.getFullYear())&&c.setTime(c.getTime()+36e5*(24-c.getHours())),c}},addGanttMarker:function(){var a=this,b=f.date.date_to_str(f.config.task_date),c=new Date(a.nowDate);f.addMarker({start_date:c,css:"today",text:"Today",title:"Today: "+b(c)})},addGanttEvent:function(){var b=this;b.taskOpenEvent=f.attachEvent("onTaskOpened",function(c){var d=f._has_children(c),e=f.getChildren(c).length,g=f.getTask(c),h=g.workId;d&&0>=e&&a.$.ajax({url:b.settings.getSubUrl,data:{partent_id:c,work_id:h},type:"get"}).done(function(a){var d=a.Data;b.dealData(d),b.addTask(d,c)})}),b.taskClickEvent=f.attachEvent("onTaskClick",function(b,c){var d=f.getTask(b),e=$(c.target).hasClass("gantt_tree_icon");return e?!0:("task"==d.type&&a.app.vent.trigger("global-pull-screen",b,"task"),c.cancelBubble=!0,!0)})},removeEvent:function(){var a=this;f.detachEvent(a.taskOpenEvent),f.detachEvent(a.taskClickEvent)},addTask:function(a,b){for(var c=a.length,d=0;c>d;d++){var e=a[d];f.addTask(e,b)}},_setScaleConfig:function(a){var b=this;switch(a){case"1":f.config.scale_unit="month",f.config.step=1,f.config.date_scale="%Y年 %M",f.config.subscales=[{unit:"day",step:1,date:"%j"}],f.config.scale_height=50;break;case"2":var c=function(a){var c=a.getYear(),d=a.getMonth()+1,e=a.getDate(),f=b.getWeekMonth(c,d,e);return"第"+f+"周"};f.config.scale_unit="month",f.config.date_scale="%Y年 %M",f.config.step=1,f.config.subscales=[{unit:"week",step:1,template:c}],f.config.scale_height=50;break;case"3":f.config.scale_unit="year",f.config.date_scale=" %Y",f.config.subscales=[{unit:"month",step:1,date:"%M"}],f.config.scale_height=50,f.templates.date_scale=null;break;case"4":var d=function(a){var b,c=a.getMonth();return b=c>=9?4:c>=6?3:c>=3?2:1,"第"+b+"季度"};f.config.scale_unit="year",f.config.step=1,f.config.date_scale="%Y年",f.config.min_column_width=50,f.config.scale_height=50,f.config.subscales=[{unit:"quarter",step:1,template:d},{unit:"month",step:1,date:"%M"}];break;case"5":var d=function(a){var b,c=a.getMonth();return b=c>=9?4:c>=6?3:c>=3?2:1,"第"+b+"季度"};f.config.scale_unit="year",f.config.step=1,f.config.date_scale="%Y年",f.config.scale_height=50,f.config.subscales=[{unit:"quarter",step:1,template:d},{unit:"month",step:1,date:"%M"}]}},getWeekMonth:function(a,b,c){var d=new Date(a,parseInt(b)-1,c),e=d.getDay(),f=d.getDate();return Math.ceil((f+6-e)/7)},renderGantt:function(){f.config.grid_resize=!0,f.render()},_operateColumn:function(a){f.getGridColumn("finishProgress")&&(f.getGridColumn("finishProgress").hide=!a.completion),f.getGridColumn("score")&&(f.getGridColumn("score").hide=!a.score),f.getGridColumn("startDate").hide=!a.date},bindEvent:function(){var a=this;this.ui.legend.bind("click",function(b){a.lengendHandler(b)})},dealData:function(b){for(var c=this,d=b.length,f=0;d>f;f++){var g=b[f],h=g.type,i=g.status;g.backStartDate=g.startDate,g.backEndDate=g.endDate,g.fullName&&(g.name=a._.escape(g.fullName));var j=g.startDate=g.startTime,k=g.endDate=g.endTime,l=g.finishDate;27!=h&&(0==i||1==i?(g.finishDate=c.nowDate,l=c.nowDate):2==i||4==i||6==i||e(k)<e(c.nowDate)&&(g.finishDate=c.nowDate,l=c.nowDate)),j=e(j),g.start_date=e(g.startTime),k=e(k).valueOf(),l=e(l).valueOf();var m=c.getTimeDur(j,k);if(j>l)g.duration=m,g.progress=0;else{var n=k-l;if(0>n){m=c.getTimeDur(j,l);var o=(k-j)/(l-j).toFixed(2);g.progress=o}else{var o=(l-j)/(k-j).toFixed(2);g.progress=o}g.duration=m}"4"==g.type||"27"==g.type?g.open=!0:g.open=!g.isHasChild,"5"==g.type?g.type="title":"4"==g.type?g.type="project":"27"==h?g.type="milestone1":g.type="task",g.parent=g.parentId,g.order=20}var p={data:b,links:[]};return p},events:function(){},getTimeDur:function(a,b){var c=(b-a)/864e5;return c},lengendHandler:function(a){var b=this.$el.find("#legend"),c={node:b,container:this.ui.ganttTool};this.legendView&&this.legendView.close(),this.legendView=new d(c),this.ui.ganttTool.append(this.legendView.render().el)},ui:{ganttBody:"#grid-configuration",scaleChange:"#gattConfigScale",showDate:"#showDate",exportPDF:"#exportPDF",legend:"#legend",ganttEmpty:".gantt_empty",ganttTool:"#gantt-tool",loading:"._tt_loading_m",allContainer:"#gantt-all-container",filter:"[data-name=filter]",fullScreenBtn:"[data-name=gantt-fullscreen]"},events:function(){var a={};return a},onRender:function(){},_initFilterOptions:function(){var a=[{order:["0"],title:"日期",name:"date",checked:!0}],b=this.model.get("work"),c=this.model.get("score");b&&a.push({order:["1"],title:"评分",name:"score",checked:!0}),c&&a.push({order:["2"],title:"完成度",name:"completion",checked:!0});var d=["scope","status"];!this.model.get("isHideSort")&&d.splice(1,0,"sort");var e={tab:d,tabResizeChange:!1,tabOptions:{scope:{tabTitle:"显示范围",allCheckedName:"全选",isMult:!0,activeOrder:"0,1,2",data:a,viewType:"dropDownList"},sort:{tabTitle:"系统默认排序",activeOrder:"1",data:[{title:"系统默认排序",order:["1"]},{title:"创建时间",order:["6","7"],tip:[{txt:"点击后最早创建的在最前面",order:"6"},{txt:"点击后最晚创建的在最前面",order:"7"}]},{title:"开始时间",order:["2","3"],tip:[{txt:"点击后最早开始的在最前面",order:"2"},{txt:"点击后最晚开始的在最前面",order:"3"}]},{title:"结束时间",order:["4","5"],tip:[{txt:"点击后最早结束的在最前面",order:"4"},{txt:"点击后最晚结束的在最前面",order:"5"}]}]},status:{isMult:!1,activeOrder:"2",inResult:!1,data:[{order:["1"],title:"按日查看",name:"day"},{order:["2"],title:"按周查看",name:"week"},{order:["3"],title:"按月查看",name:"month"},{order:["5"],title:"按季度查看",name:"quarter"},{order:["4"],title:"按年查看",name:"year"}],viewType:"dropDownList",changeTabTitle:!0}},search:{show:!1},storeData:[]};return e},_renderSearchFilterView:function(){var a=this._initFilterOptions(),b={};_.each(this.settings.filterOptions,function(c){b[c.tabName]=c.data,a.storeData.push(c)}),_.extend(a.tabOptions,b),this.searchFilterView&&this.searchFilterView.close(),this.searchFilterView=new c(a),this.listenTo(this.searchFilterView,"result",function(a){var b=this._dealFilterData(a);this._setFullScreenOptions(a),b.scope&&this._operateColumn(b.scope),b.status&&this._setScaleConfig(b.status),b.sort&&this._sortDataByTime({sort_type:b.sort,filterOptions:a}),this.renderGantt()});var d=this.settings.filterOptions&&this._dealFilterData(this.settings.filterOptions);d&&d.scope&&this._operateColumn(d.scope),this._setScaleConfig(d&&d.status||a.tabOptions.status.activeOrder),this.renderGantt(),this.ui.filter.append(this.searchFilterView.render().el),this.searchFilterView.onShow()},_setFullScreenOptions:function(a){this.settings.isShowFullScreen&&this.storage.setItem(this.localStorageKey,JSON.stringify(a))},_sortDataByTime:function(a){var b=this.settings.filterOptions&&_.findWhere(this.settings.filterOptions,{tabName:"sort"}).data.activeOrder;a.sort_type!=b&&this.trigger("filter.gantt",a)},_dealFilterData:function(a){var b={};if(_.each(a,function(a){switch(a.tabName){case"scope":var c={};_.each(a.data.data,function(a){c[a.name]=a.checked}),b.scope=c;break;case"sort":b.sort=a.data.activeOrder;break;case"status":b.status=a.data.activeOrder}}),void 0==b.scope){var c={};c.date=!0,c.score=!0,c.completion=!0,b.scope=c}return b},onShow:function(){var a=this,b={},c=[];a.settings.data.tasks?(a.data=b=a.settings.data,a.tasks=c=a.settings.data.tasks):(a.data=b=a.settings.data.Data,a.tasks=c=a.settings.data.Data.tasks),c.length>0?(a.ui.loading.hide(),a.initGantt(b.startDate,b.endDate),a.bindEvent(),f.parse(a.dealData(c)),a.ui.ganttBody.show(),a.ui.ganttTool.show(),a.settings.isShowFilter&&this._renderSearchFilterView()):(a.ui.loading.hide(),a.ui.ganttEmpty.show(),a.ui.ganttTool.hide(),this.ui.ganttBody.hide())},onClose:function(){this.tasks.length>1&&(f.close(),f.clearAll()),this.storage.removeItem(this.localStorageKey)}})}),define("views/work/detail/detail-main/project-gantt-view",["talent","templates/work","views/common/empty-view","views/common/gantt/gantt-layout-view"],function(a,b,c,d){return a.Layout.extend({template:_.template("<div data-name='gantt-region'></div>"),defaults:{data:"",isShowFullScreen:!0,height:null,filterOptions:{}},regions:{main:"[data-name=gantt-region]"},initialize:function(){this._getRouterData(),this.userInfo=a.Context.getUserInfo(),this.settings=a._.extend({},this.defaults,this.options)},onShow:function(){this._renderGanttView()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a||{}}),d},_renderGanttView:function(){var b=a.Context.getApiUrl("Work/GrantSubTask"),c=$(".project_detail_content"),e=(this.settings.data.tasks,a.Context.getGlobal("titaHost")),f=e+"/u/"+this.userInfo.Id+"/Home#more/ganttinfo?"+$.param(this.routerData);this.gantView=new d({width:c.width(),height:this.settings.height,getSubUrl:b,data:this.settings.data,ganttFullUrl:f,isShowFullScreen:this.settings.isShowFullScreen,filterOptions:this.settings.filterOptions}),this.listenTo(this.gantView,"filter.gantt",function(a){this.trigger("filter.gantt",a)}),this.main.show(this.gantView)}})}),define("views/work/detail-target/detail-main/target-gantt-view",["talent","templates/work","views/common/empty-view","views/common/gantt/gantt-layout-view"],function(a,b,c,d){return a.Layout.extend({template:_.template("<div data-name='gantt-region'></div>"),defaults:{data:"",isShowFullScreen:!0,height:null,filterOptions:{}},regions:{main:"[data-name=gantt-region]"},initialize:function(){this._getRouterData(),this.userInfo=a.Context.getUserInfo(),this.settings=a._.extend({},this.defaults,this.options)},onShow:function(){this._renderGanttView()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){b.routerData=a||{}}),d},_renderGanttView:function(){var b=a.Context.getApiUrl("Work/GrantSubTask"),c=$(".project_detail_content"),e=(this.settings.data.tasks,a.Context.getGlobal("titaHost")),f=e+"/u/"+this.userInfo.Id+"/Home#more/ganttinfo?"+$.param(this.routerData);this.gantView=new d({width:c.width(),height:this.settings.height,getSubUrl:b,data:this.settings.data,ganttFullUrl:f,isShowFullScreen:this.settings.isShowFullScreen,filterOptions:this.settings.filterOptions,isTarget:!0}),this.listenTo(this.gantView,"filter.gantt",function(a){this.trigger("filter.gantt",a)}),this.main.show(this.gantView)}})}),define("views/more/ganttinfo/index-page-view",["talent","templates/more","views/work/detail/detail-main/project-gantt-view","views/work/detail-target/detail-main/target-gantt-view"],function(a,b,c,d){var e=a.Layout.extend({template:b["more/ganttinfo/index-page"],className:"tt_ganttinfo",regions:{ganttInfoBox:"div[data-name=gantt-info-box]"},ui:{workName:"[data-name=workName]"},templateHelpers:function(){},initialize:function(){this.i18n=a.Context.getI18n(),this.iTask=this.i18n.task_1,a.Context.setPageTitle(this.iTask),this.storage=Talent.Context.getLocalStorage(),this.userInfo=Talent.Context.getUserInfo(),this.localStorageKey="Gantt_Filter_"+this.userInfo.Id,this._getRouterData()},onRender:function(){this._requestData()},_getRouterData:function(){var b=this,c=a.app.request("history:getQueryObject"),d=new a.$.Deferred;return c.done(function(a){if(b.routerData=a||{},b.routerData.filterOptions=b._resetFilterOptions(),b.routerData.filterOptions){var c=_.findWhere(b.routerData.filterOptions,{tabName:"sort"});b.routerData.sort_type=c?c.data.activeOrder:""}}),d},_resetFilterOptions:function(){var a=this.storage.getItem(this.localStorageKey);return a?JSON.parse(a):null},_requestData:function(a){var b=this;this.routerData=_.extend(this.routerData,a);var c=Talent.app.request("ProjectDetail:getData",this.routerData);c.done(function(a){b._renderGanttLayout(a),b._getWorkName(a)})},_getWorkName:function(a){var b=this.routerData.work_id,c=a.tasks,d=_.findWhere(c,{id:b});this.ui.workName.text(d.name)},_renderGanttLayout:function(a){var b=25*a.tasks.length+60,e=window.innerHeight-155;b=b>e?e:b,this.projectGanttView&&this.projectGanttView.close();var f={data:a,isShowFullScreen:!1,filterOptions:this.routerData.filterOptions,height:b};this.projectGanttView=6==this.routerData.workType?new d(f):new c(f),this.listenTo(this.projectGanttView,"filter.gantt",function(a){this._requestData(a)}),this.ganttInfoBox.show(this.projectGanttView)}});return a.BasePageView.extend({mainViewClass:e,layout:"empty-layout"})}),define("views/more/adminAuthorization/index-page-view",["talent","templates/more"],function(a,b){var c=a.Layout.extend({template:b["more/adminAuthorization/index-page"],className:"_tt_page_container",initialize:function(){this.userInfo=a.Context.getUserInfo()},regions:{},ui:{},events:function(){var a={};return a},resizeFrame:function(){var b=a.$(window).height()-a.$("#header-region").height()-a.$("#footer-region").height();this.$el.find("iframe").height(b)},onClose:function(){a.$("html").css("overflow-y",this.oriOverflow),a.$(window).off("resize",this.bindResizeFrame),a.$("#main-region").css("min-height",this.oriMinHeight)},getAdminAuthorizationUrl:function(){var b=a.Context.getGlobal("tm"),c=a.Context.getUserInfo().Id;return b+"/"+c+"/indexV2?#/AdminAuthorization"},onShow:function(){var b=this;a.Context.getGlobal("titaHost");a.app.request("history:getQueryObject").done(a._.bind(function(a){var c=this.getUrl(a.appid,a.apptype);a.from||"";b.styleFix(),b.setPageTitle("管理员授权"),c=this.getAdminAuthorizationUrl(),this.$el.html('<iframe id="app2_iframe" name="app_iframe" width="100%" frameborder="0" src="'+c+'"></iframe>'),this.resizeFrame()},this))},styleFix:function(){this.oriOverflow=a.$("html").css("overflow-y"),this.oriMinHeight=a.$("#main-region").css("min-height"),a.$("html").css("overflow-y","hidden"),a.$("#main-region").css("min-height",""),this.$el.css("padding",0),this.bindResizeFrame=a._.bind(this.resizeFrame,this),a.$(window).on("resize",this.bindResizeFrame)},getUrl:function(b,c){var d="";return a._.each(a.Context.getGlobal("WebHead").AppHead,function(a){a.AppId==b&&a.AppType==c&&(d=a.Domain)}),d},setPageTitle:function(b){a.Context.setPageTitle("iTalent")}});return a.BasePageView.extend({mainViewClass:c,refreshSidebar:!0})}),define("views/more/index-page-view",["talent","templates/more","views/more/tasks/index-page-view","views/more/indicatormsg/index-page-view","views/more/archives/index-page-view","views/more/dailyinfo/index-page-view","views/more/shareinfo/index-page-view","views/more/pay/index-page-view","views/more/guide/index-page-view","views/more/messages/index-page-view","views/more/taskinfo/index-page-view","views/more/gantt-print/index-page-view","views/more/apply/index-page-view","views/more/platformcustomize/index-page-view","views/more/due-to-remind/index-page-view","views/more/iframe/index-page-view","views/more/terminal/index-page-view","views/more/invite/index-page-view","views/more/ganttinfo/index-page-view","views/more/adminAuthorization/index-page-view"],function(a,b){var c=a.Layout.extend({template:b["more/index-page"],className:"well span8",initialize:function(){a.Context.setPageTitle("")},regions:{},events:function(){var a={};return a},onRender:function(){}});return a.BasePageView.extend({mainViewClass:c})});
